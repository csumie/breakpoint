define("odsp-next/bundles/odc/Notifications",["require","exports","../../dataSources/notifications/odc/NotificationsDataSource","../../providers/notificationManager/NotificationManager","../../dataSources/notifications/odc/handlers/DeleteAll","../../dataSources/notifications/odc/handlers/FolderExpiration","../../dataSources/notifications/odc/handlers/NewReferral","../../dataSources/notifications/odc/handlers/ProcessReferral","../../dataSources/notifications/odc/handlers/RestoreAll","../../dataSources/notifications/odc/handlers/SharingAbuse"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})});
define("odsp-next/dataSources/notifications/odc/NotificationsDataSource",["require","exports","tslib","@ms/odsp-utilities/lib/async/Promise","@ms/odsp-shared/lib/base/BaseModel","../../../resources/ProviderResourceKeys"],function(e,t,n,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=["NewReferral","ProcessReferral","SharingAbuse"],u=["DeleteAll","FolderExpiration","RestoreAll"],a=function(t){n.__extends(i,t);function i(e){var n=t.call(this,e)||this;n._bundleLoader=n.resources.consume(s.bundleLoader);return n}i.prototype.loadGlobalHandlers=function(t){for(var n=function(n){i._bundleLoader.queueLoad("odsp-next/dataSources/notifications/odc/handlers/"+n,function(){return new r.default(function(t,r){e(["odsp-next/dataSources/notifications/odc/handlers/"+n],t,r)})}).then(t).done()},i=this,s=0,u=o;s<u.length;s++){n(u[s])}};i.prototype.loadPageHandlers=function(t){for(var n=function(n){i._bundleLoader.queueLoad("odsp-next/dataSources/notifications/odc/handlers/"+n,function(){return new r.default(function(t,r){e(["odsp-next/dataSources/notifications/odc/handlers/"+n],t,r)})}).then(t).done()},i=this,s=0,o=u;s<o.length;s++){n(o[s])}};return i}(i.default);t.default=a});
define("odsp-next/providers/notificationManager/NotificationManager",["require","exports","tslib","knockout","@ms/odsp-shared/lib/base/BaseModel","../../resources/ModelResourceKeys","../../resources/ProviderResourceKeys","../../resources/DataSourceResourceKeys","@ms/odsp-utilities/lib/browser/PlatformDetection.key"],function(e,t,n,r,i,s,o,u,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});0;var f=function(e){n.__extends(t,e);function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;n._isFirstProcess=!0;if(!n.resources.consume(o.userInfo).isAuthenticated())return n;if(n.resources.consume(a.platformDetection).isMobile)return n;var r=n.resources.consume(s.userInfoStore);n._userInfo=r.getUserInfo();n._canNotify=!0;n._handlers={};n._notificationProvider=n.resources.consume(o.notification);n._notifications=n.resources.consume(u.notifications);t.isPageLevel||n._notifications.loadGlobalHandlers(n._getLoader());n.createComputed(n._computeProcessNotifications);n.createComputed(n._computeProcessTriggeredNotifications);return n}t.triggerNotification=function(e){this._triggeredNotifications.push(e)};t.prototype.createNotificationHandlers=function(e){this._canNotify&&this._notifications.loadPageHandlers(this._getLoader(e))};t.prototype._getLoader=function(e){var t=this;return function(n){for(var r=e?e(n):new(t.managed(n)),i=0,s=r.types;i<s.length;i++){var o=s[i];t._handlers[o]=r}t._isFirstProcess||t._processHandler(r)}};t.prototype._processHandler=function(e){var t=this._userInfo();if(t){for(var n={},r=0,i=e.types;r<i.length;r++){n[i[r]]=!0}if(t&&t.notifications)for(var s=0,o=t.notifications;s<o.length;s++){var u=o[s];n[u.type]&&this._shouldShowNotification(u,!1)&&this._handleNotification(u)}}};t.prototype._computeProcessNotifications=function(){var e=this._userInfo();if(e&&e.notifications){for(var t=0,n=e.notifications;t<n.length;t++){var r=n[t];this._shouldShowNotification(r,this._isFirstProcess)&&this._handleNotification(r)}this._isFirstProcess=!1}};t.prototype._computeProcessTriggeredNotifications=function(){for(var e=t._triggeredNotifications(),n=0;n<e.length;n++){var r=this._handlers[e[n]];if(r){r.showNotification(e[n]);e.splice(n--,1)}}t._triggeredNotifications(e)};t.prototype._shouldShowNotification=function(e,t){return!(!e||!e.id&&t)&&(!this._notificationProvider.handledNotifications[e.id]&&!this._isExpired(e))};t.prototype._isExpired=function(e){if(e.id&&e.expiryDateTime){var t=new Date(e.expiryDateTime);if((new Date).getTime()>t.getTime()){this._notificationProvider.handledNotifications[e.id]=!0;return!0}}if(e.id&&e.expiryDate){t=new Date(e.expiryDate);if((new Date).getTime()>t.getTime()+864e5){this._notificationProvider.handledNotifications[e.id]=!0;return!0}}return!1};t.prototype._handleNotification=function(e){var t=this._handlers[e.type];if(!t)return!1;t.handleNotification(e);e.id&&(this._notificationProvider.handledNotifications[e.id]=!0);return!0};t._triggeredNotifications=r.observableArray();return t}(i.default);t.default=f});
define("odsp-next/dataSources/notifications/odc/handlers/DeleteAll",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-utilities/lib/string/StringHelper","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../Notifications.resx"],function(e,t,n,r,i,s,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[103];n.listenToCurrentItem=!0;n._notifications=n.resources.consume(o.notification);n._currentItem=n.resources.consume(s.currentItem);n.createComputed(n._proccessItemChanged);return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._text||u.strings.deleteAllStatusUnknownCount})};t.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&e.taskStatus&&e.taskStatus.deleteAllCount){switch(e.taskStatus.deleteAllCount){case-1:this._text=u.strings.deleteAllStatusUnknownCount;break;case 1:this._text=i.format(u.strings.deleteAllOneItemStatus,e.taskStatus.deleteAllCount);break;default:this._text=i.format(u.strings.deleteAllStatus,e.taskStatus.deleteAllCount)}e.taskStatus.deleteAllCount=0;this.showNotification()}};return t}(r.default);t.default=a});
define("odsp-next/dataSources/notifications/odc/handlers/FolderExpiration",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../actions/base/ItemCommandHelper","@ms/odsp-utilities/lib/string/StringHelper","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../../../resources/DataSourceResourceKeys","@ms/odsp-utilities/lib/logging/events/Engagement.event","../../Notifications.resx","../../../../models/item/command/FileSystemItemCommandKeys"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h={},p=function(e){n.__extends(t,e);function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;n.types=[101];n.listenToCurrentItem=!0;n._notifications=n.resources.consume(u.notification);n._currentItem=n.resources.consume(o.currentItem);n._urlDataSource=n.resources.consume(a.url);n._itemCommandHelper=new(n.managed(i.default));n.createBackgroundComputed(n._proccessItemChanged);return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._getDetails(),severity:2,action:this._getAction(),actionText:l.strings.folderExpirationChangeSettings})};t.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&!e.isPlaceholder&&!h[e.id]&&e.dateExpires&&this._itemCommandHelper.isCommandSupported(e,c.changeExpiration)){f.Engagement.logData({name:"Notifications.FolderExpiration.View"});this.showNotification()}};t.prototype._getDetails=function(){var e=this._currentItem.peek();return s.format(l.strings.folderExpirationFormat,e.dateExpires||"")};t.prototype._getAction=function(){var e=this._currentItem.peek(),t=this._urlDataSource.getChangeFolderExpirationUrl(e.id),n=this.resources.consume(o.actionMap);return new(this.managed(n.NavigationAction))({url:t})};return t}(r.default);t.default=p});
define("odsp-next/dataSources/notifications/odc/handlers/NewReferral",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ProviderResourceKeys","../../Notifications.resx","./NotificationHandlerHelper"],function(e,t,n,r,i,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[3];n._userInfoProvider=n.resources.consume(i.userInfo);n._notifications=n.resources.consume(i.notification);var r=new(n.managed(o.default));n._navigationAction=r.getStorageNavigationAction();return n}t.prototype.handleNotification=function(e){e&&this._showNotification()};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:s.strings.inviteFriendNewReferral,action:this._navigationAction,actionText:s.strings.inviteFriendNewReferralButton})};t.prototype._showNotification=function(){var e=this,t=function(){e._userInfoProvider.setUserInfo(3,2,null)};this.showNotification().wait().then(t,t)};return t}(r.default);t.default=u});
define("odsp-next/dataSources/notifications/odc/handlers/NotificationHandlerHelper",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/DataSourceResourceKeys"],function(e,t,n,r,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){n.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.getStorageNavigationAction=function(){var e=this.resources.consume(s.url).getManageStorageUrl()+"?biciid=superbar",t=this.resources.consume(i.actionMap);return new(this.managed(t.NavigationAction))({url:e})};return t}(r.default);t.default=o});
define("odsp-next/dataSources/notifications/odc/handlers/ProcessReferral",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ProviderResourceKeys","../../Notifications.resx","./NotificationHandlerHelper","@ms/odsp-shared/lib/utilities/navigation/Navigation.key","../../../../providers/item/ItemProvider"],function(e,t,n,r,i,s,o,u,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[108];n._notifications=n.resources.consume(i.notification);var r=new(n.managed(o.default));n._navigationAction=r.getStorageNavigationAction();n._processUrl();return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:"Messages comes from server response... it will say something about user referral",action:this._navigationAction,actionText:s.strings.inviteFriendNewReferralButton})};t.prototype._processUrl=function(){var e=this,t=this.resources.consume(u.navigation),n=this.resources.consume(a.resourceKey),r=t.viewParams,i=r.invref,o=r.invsrc;if(i){n.processReferral(i,o).then(function(t){if(t.showIneligiblePopover&&t.ineligiblePopoverMessage){var n={text:t.ineligiblePopoverMessage,action:e._navigationAction,actionText:s.strings.inviteFriendIneligibleButton};e._notifications.requestNotification(n)}},function(e){});delete r.invref;delete r.invsrc}};return t}(r.default);t.default=f});
define("odsp-next/dataSources/notifications/odc/handlers/RestoreAll",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-utilities/lib/string/StringHelper","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../Notifications.resx"],function(e,t,n,r,i,s,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[102];n.listenToCurrentItem=!0;n._notifications=n.resources.consume(o.notification);n._currentItem=n.resources.consume(s.currentItem);n.createComputed(n._proccessItemChanged);return n}t.prototype.handleNotification=function(e){};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._text||u.strings.restoreAllStatusUnknownCount})};t.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&e.taskStatus&&e.taskStatus.restoreAllCount){switch(e.taskStatus.restoreAllCount){case-1:this._text=u.strings.restoreAllStatusUnknownCount;break;case 1:this._text=i.format(u.strings.restoreOneItemStatus,e.taskStatus.restoreAllCount);break;default:this._text=i.format(u.strings.restoreAllStatus,e.taskStatus.restoreAllCount)}e.taskStatus.restoreAllCount=0;this.showNotification()}};return t}(r.default);t.default=a});
define("odsp-next/dataSources/notifications/odc/handlers/SharingAbuse",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../../../resources/DataSourceResourceKeys","../../Notifications.resx"],function(e,t,n,r,i,s,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){n.__extends(t,e);function t(t){var n=e.call(this,t)||this;n.types=[23];n._notifications=n.resources.consume(s.notification);n._createAction();return n}t.prototype.handleNotification=function(e){e&&e.param&&e.param.indexOf("IsNotOwner")>=0&&this.showNotification()};t.prototype.showNotification=function(){return this._notifications.requestNotification({text:u.strings.sharingAbuseDescription,severity:2,action:this._navigationAction,actionText:u.strings.sharingAbuseButtonText})};t.prototype._createAction=function(){var e=this.resources.consume(o.url),t=e.getOwnerId(),n=e.getSharedByUrl(t,t),r=this.resources.consume(i.actionMap);this._navigationAction=new(this.managed(r.NavigationAction))({url:n})};return t}(r.default);t.default=a});