var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Word=function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);

var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function n(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var r=function(){return(r=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var a,s,p=function(){function e(){}return Object.defineProperty(e,"Unknown",{get:function(){return"Unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AppInitError",{get:function(){return"AppInitError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ApiDisabledError",{get:function(){return"ApiDisabledError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CannotLoadFirstPage",{get:function(){return"CannotLoadFirstPage"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CannotLoadScript",{get:function(){return"CannotLoadScript"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageChangeError",{get:function(){return"PageChangeError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZoomChangeError",{get:function(){return"ZoomChangeError"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CannotLoadBundleItem",{get:function(){return"CannotLoadBundleItem"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"InvalidPageIndex",{get:function(){return"InvalidPageIndex"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UnsupportedBundleVersion",{get:function(){return"UnsupportedBundleVersion"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"InvalidWopiInfo",{get:function(){return"InvalidWopiInfo"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TimeoutWacReady",{get:function(){return"TimeoutWacReady"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WacFailed",{get:function(){return"WacFailed"},enumerable:!0,configurable:!0}),e}();!function(e){e[e.ExcelEwaJs=0]="ExcelEwaJs",e[e.WordViewer=301]="WordViewer",e[e.WopiPendingApplication=379]="WopiPendingApplication",e[e.VisioApp=700]="VisioApp",e[e.PptSession=817]="PptSession"}(a||(a={})),function(e){e[e.Spam=200]="Spam",e[e.Verbose=100]="Verbose",e[e.Info=50]="Info",e[e.Warning=15]="Warning",e[e.Error=10]="Error"}(s||(s={}));var c,l=function(){function e(){}return e.assembleFromMessagePayload=function(e,t){if(e&&e.Diagnostics){var i=e.Diagnostics;for(var o in i)t[o]=i[o]}},e.stringifyError=function(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))},e.getLoggableSessionInfo=function(e){var t=JSON.parse(JSON.stringify(e));delete t.UserId,delete t.OwnerId,delete t.WdParams;var i=JSON.parse(JSON.stringify(e.WdParams).toLowerCase());return t.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(e){i[e]&&(t.WdParams[e]=i[e])})),t},e}(),d=function(){function e(){}return e.getApplicationBaseUrl=function(e){var t=e.indexOf("/",8);if(t<0)throw new Error("URL should contain a / after domain");var i=e.indexOf("/",t+1);if(i>=0)return e.substr(0,i+1);throw new Error("URL should contain a / after domain and folder")},e.getParameterValue=function(e,t){var i=e.indexOf("&"+t+"=");if(-1===i&&(i=e.indexOf("?"+t+"=")),-1===i)return"";var o=i+(t.length+2),n=e.indexOf("&",o);return-1===n?e.substr(o):e.substring(o,n)},e.getOrigin=function(e){return e.replace(/^(.*?\/\/[^\/]*).*$/,"$1")},e.addQueryParam=function(e,t,i,o){if(void 0===o&&(o=!1),!i)return e;var n=e,r=n.indexOf("?"),a="&";r===n.length-1||"&"===n.slice(-1)||"&>"===n.slice(-2)?a="":-1===r&&(a="?");var s=t.toLowerCase()+"=",p=n.toLowerCase().indexOf(s,r);if("?"!==a&&p>=0){if(o){var c=n.indexOf("&",p);n=n.substring(0,p)+s+i+(-1===c?"":n.substring(c))}return n}return n.concat(a,s,i)},e.parseQueryParams=function(e){var t={},i=e.indexOf("?");return-1===i||i===e.length-1?t:(e.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(e){if(e){var i=e.indexOf("=");-1!==i&&i!==e.length-1&&(t[e.substring(0,i).toLowerCase()]=e.substring(i+1))}})),t)},e.getBaseDomain=function(e,t){var i=document.createElement("a");if(i.setAttribute("href",e),!i.hostname)throw new Error("Invalid URL. Cannot find domain");if(void 0===t)return i.hostname;if(t<0)throw new Error("subDomainParts should be at least 1");return i.hostname.split(".").slice(-(t+1)).join(".")},e.getApplicationUrl=function(t,i,o,n){var r=e.getOrigin(t);r=r.replace("onenote",i);var a=[];if(n)for(var s in n)n[s]&&a.push(s.concat("=",n[s]));return r.concat(o,"?",a.join("&"),a.length>0?"&":"","<ui=UI_LLCC&><rs=DC_LLCC&><dchat=DISABLE_CHAT&><hid=HOST_SESSION_ID&><showpagestats=PERFSTATS&><IsLicensedUser=BUSINESS_USER&><actnavid=ACTIVITY_NAVIGATION_ID&>")},e.getPageName=function(e){if(null==e)return"";var t=-1===e.indexOf("#")?e.length:e.indexOf("#"),i=e.lastIndexOf("/",t);if(-1!==i&&i+1===e.indexOf("://")+"://".length)return"";i+=1;var o=e.indexOf("?");if(-1!==(o=o>=t?-1:o)&&i>o)return"";var n=-1===o?t:o;return i>=n?"":e.substring(i,n)},e.isFastFoodUrl=function(e){return 8===e.toLowerCase().indexOf("ffc")},e.isMsitUrl=function(e){return 8===e.toLowerCase().indexOf("ppc")},e}();!function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.IE=2]="IE",e[e.Edge=3]="Edge",e[e.Chrome=4]="Chrome",e[e.Safari=5]="Safari",e[e.Unknown=6]="Unknown"}(c||(c={}));var g=function(){function e(){}return e.getBrowserName=function(){if(null!=navigator&&null!=navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return c.Firefox;if(e.indexOf("Opera")>-1)return c.Opera;if(e.indexOf("Trident")>-1)return c.IE;if(e.indexOf("Edge")>-1)return c.Edge;if(e.indexOf("Chrome")>-1)return c.Chrome;if(e.indexOf("Safari")>-1)return c.Safari}return c.Unknown},e.isTouchMode=function(){try{return e.isMobile()||e.hasTouchPoints()}catch(e){return!1}},e.isHighContrast=function(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(e){return!1}},e.isSoftBlockedBrowser=function(){return e.getBrowserName()===c.IE&&!e.isInternetExplorer11AndUp()},e.isAndroid=function(){return navigator.userAgent.indexOf("Android")>=0},e.isIpad=function(){return navigator.userAgent.indexOf("iPad")>=0},e.isMobile=function(){return e.isIpad()||e.isAndroid()},e.hasTouchPoints=function(){return navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},e.isInternetExplorer11AndUp=function(){return e.getBrowserName()===c.IE&&(null!=document.documentMode&&void 0!==document.documentMode&&document.documentMode>=11)},e}(),u=function(){function e(){}return e.createWacFrame=function(t,i,o,n,r){var a=t.ownerDocument.createElement("iframe");a.name=n||e.wacFrameId,a.id=e.wacFrameId,a.src="",a.title="Office Online Frame",a.width="100%",a.height="100%",a.marginWidth="0",a.marginHeight="0",a.style.left="0",a.style.top="0",a.style.right="0",a.style.bottom="0",a.style.display="block",a.style.position="absolute",a.style.backgroundColor="transparent",a.style.border="none",a.frameBorder="0",a.setAttribute("allowfullscreen","true"),a.setAttribute("allowTransparency","true"),o&&a.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox");var s=d.getOrigin(i);return a.setAttribute("allow","microphone "+s+"; camera "+s+";"),r&&(a.onload=r),t.appendChild(a),a},e.createAndSubmitWacFrame=function(t,i,o,n,r){var a=e.createWacFrame(t,i,n,r);return e.submitWacFrame(a,t,i,o)},e.submitWacFrame=function(t,i,o,n){e.addFrameDisplayInfoToPostData(t,n);var r=i.ownerDocument,a=r.createElement("form");for(var s in a.id="office_form",a.name="office_form",a.action=o,a.target=t.name,a.method="POST",n){var p=r.createElement("input");p.type="hidden",p.name=s,p.value=n[s],a.appendChild(p)}return i.appendChild(a),a.submit(),t},e.addFrameDisplayInfoToPostData=function(t,i){i[e.wacFrameComputedHeightPx]=String(t.offsetHeight),i[e.wacFrameComputedWidthPx]=String(t.offsetWidth),i[e.wacFrameTouchMode]=String(g.isTouchMode()),i[e.wacFrameHighContrast]=String(g.isHighContrast())},e.wacReadyTimeoutInMs=5e3,e.completeOrFailTimeoutInMs=5e3,e.wacAppCompleteOrFailTimeoutInMs=15e3,e.postMessageMaxRetries=3,e.wacSessionCompleteAckTimeoutInMs=1e3,e.subDomainPartsForPostMessageHandler=2,e.wacFrameUnloadTimeoutInMs=1e3,e.wacFrameId="WebApplicationFrame",e.wacFrameAccessToken="access_token",e.wacFrameAccessTokenTtl="access_token_ttl",e.wacFrameBundleSource="bundleSrc",e.wacFrameBundleStaleness="bundleStaleness",e.wacFrameFileGetUrl="fileGetUrl",e.wacFrameFileExtension="fileExtension",e.wacFrameFileSize="fileSize",e.wacFrameFileName="fileName",e.wacFrameOwnerId="owner_id",e.wacFrameUserId="user_id",e.wacFrameSessionContext="sc",e.wacFrameHostDiagnostics="host_diagnostics",e.wacFrameHighDpi="highDpi",e.wacFrameComputedHeightPx="frameHeightPx",e.wacFrameComputedWidthPx="frameWidthtPx",e.wacFrameHostFlights="hostFlights",e.wacFrameHighContrast="highContrast",e.wacFrameTouchMode="touchMode",e.wacFrameHostUIControlOverrides="huictrls",e.wacSoftBlockedBrowser="softBlockedBrowser",e.wacFrameHostName="hostName",e.fromWacFrameAppBootState="Wac_AppBootState",e.fromWacFrameInitReady="WacInitialize_Ready",e.fromWacFrameInitFrameLoaded="WacInitialize_FrameLoaded",e.fromWacFrameAppCompleted="Wac_AppCompleted",e.fromWacFrameAppCompletedAck="Wac_AppCompleted_Ack",e.fromWacFrameAppLoadingStatus="App_LoadingStatus",e.fromWacFrameAppFailed="Wac_AppFailed",e.fromWacFrameAppFailedAck="Wac_AppFailed_Ack",e.fromWacFrameSessionCompleteAck="WopiSession_Complete_Ack",e.toWacFrameFailSession="WopiPendingSession_Fail",e.toWacFrameInitReadyAck="WacInitialize_Ready_Ack",e.toWacFramePendingSessionComplete="WopiPendingSession_Complete",e.toWacFrameStartSessionComplete="WopiStartSession_Complete",e.toWacFrameJsApiDiagnostics="JsApiDiagnostics",e.toWacFramePendingAppCompleteReceived="WopiPendingApplicationComplete_Received",e}(),f=function(){function e(e){this.sessionTraces={},this.logger=e}return e.prototype.add=function(e,t){this.sessionTraces[e]=t},e.prototype.get=function(e){return this.sessionTraces[e]},e.prototype.log=function(e){this.logger.ULS.traceTag(596459999,a.WopiPendingApplication,e,"sessionTraces:"+JSON.stringify(this.sessionTraces))},e.prototype.stringify=function(){return JSON.stringify(this.sessionTraces)},e.wopiInitializeTime="wopiInitializeTime",e.wopiPendingInitializeTime="wopiPendingInitializeTime",e.wopiPendingCompleteTime="wopiPendingCompleteTime",e.startSessionStartTime="startSessionStartTime",e.startSessionCompleteTime="startSessionCompleteTime",e.readyMessageReceiveTime="readyMessageReceiveTime",e.completeMessageSendTime="completeMessageSendTime",e.completeMessageCreateTime="completeMessageCreateTime",e}(),m=function(){function e(){}return e.transformApplicationUrl=function(e,t,i,o,n){var a=d.parseQueryParams(e);"teams"!==a.uih&&"owa"!==a.uih||(a.hhdr="1","teams"===a.uih&&(a.jsapisr="1"));var s=e.indexOf("?"),p=-1===s?e.concat("?"):e.substring(0,s+1);t.UiLocale&&(a.ui=encodeURIComponent(t.UiLocale)),t.DataLocale&&(a.rs=encodeURIComponent(t.DataLocale)),t.HostSessionId&&(a.hid=encodeURIComponent(t.HostSessionId)),t.DisableChat&&(a.dchat="1"),t.SessionContext&&(a.sc=encodeURIComponent(t.SessionContext)),i&&i.WopiSrc&&(a.wopisrc=encodeURIComponent(i.WopiSrc)),t.CookieCompliant&&(a.mscc="1"),o&&(o.entryPoint&&(a.wdorigin=encodeURI(o.entryPoint)),o.userClickTime&&(a.wdhostclicktime=o.userClickTime.toString())),a=r({},a,t.WdParams,n);var c={};for(var l in a)c[l.toLowerCase()]=a[l];var g=[];for(var l in c)c[l]&&g.push(l.concat("=",c[l]));return p.concat(g.join("&"))},e.isTopFrameTrusted=function(){return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin},e}(),h=function(){function e(){}return Object.defineProperty(e,"Ack",{get:function(){return"Ack"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SetZoomLevel",{get:function(){return"SetZoomLevel"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SetCurrentPage",{get:function(){return"SetCurrentPage"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UpdatePageCount",{get:function(){return"PageCount"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FrameStateChanged",{get:function(){return"StateChanged"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZoomChangedAck",{get:function(){return"ZoomChanged_Ack"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageChangedAck",{get:function(){return"PageChanged_Ack"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UpdatePageCountAck",{get:function(){return"PageCount_Ack"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Error",{get:function(){return"Error"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HostCacheDiagnostic",{get:function(){return"HostCacheDiagnostic"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AppUnloaded",{get:function(){return"App_Unloaded"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HostUnload",{get:function(){return"Host_Unload"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DocumentReboot",{get:function(){return"App_DocReboot"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SoftReboot",{get:function(){return"App_SoftReboot"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WopiInfoFromUrlRequest",{get:function(){return"App_WopiInfoFromUrl"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WopiInfoFromUrlResponse",{get:function(){return"Host_WopiInfoFromUrl"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TrustFrameRequest",{get:function(){return"App_IsFrameTrusted"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TrustFrameResponse",{get:function(){return"Host_IsFrameTrusted"},enumerable:!0,configurable:!0}),e}(),w=function(){function e(){}return Object.defineProperty(e,"AckExpected",{get:function(){return"ackExpected"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NewZoomLevel",{get:function(){return"newLevel"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NewPageNumber",{get:function(){return"newPage"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageCount",{get:function(){return"pageCount"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"IsDisabled",{get:function(){return"isDisabled"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorType",{get:function(){return"errorType"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ErrorObject",{get:function(){return"errorObject"},enumerable:!0,configurable:!0}),e}(),P=function(){function e(e,t,i,o,n,r,a,s,p){if(this.wacAppCompleteOrFailReceived=!1,this.fastFoodUlsPing=void 0,void 0===t)throw new TypeError("wopiFallbackInfo");if(t.required&&void 0===e.wopiInfo)throw new TypeError("wopiInfo");this.appParams=e,this.wopiFallbackInfo=t,this.logger=n,this.postMessenger=r,this.visibilityMetrics=a,this.fnOnWopiBootSuccess=s,this.fnOnWopiBootFailure=p,this.appInitDiagnostics=i,this.sessionTraces=o,this.sessionTraces.add(f.wopiInitializeTime,Date.now())}return e.prototype.Boot=function(){var t=this;this.logger.ULS.traceTag(596444241,a.WopiPendingApplication,s.Info,"Initializing WAC frame");var i=e.buildApplicationBootUrl(this.appParams,this.wopiFallbackInfo,!0),o=e.buildWacFramePostData(this.appParams,this.logger);if(d.isFastFoodUrl(i)&&this.beginUlsPing(3e3,this.logger),this.postMessenger.registerMessagePayloadHandler(u.fromWacFrameAppBootState,(function(e){t.handleWacAppBootState(e)})),this.postMessenger.registerMessagePayloadHandler(h.TrustFrameRequest,(function(e){t.handleTrustFrameRequest(e)})),this.wopiFallbackInfo.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(i,o),this.wopiFallbackInfo.ignoreWacFramePostMessages){var n=this.getApplicationState();this.fnOnWopiBootSuccess(n)}return this.logger.ULS.traceTag(595661019,a.WopiPendingApplication,s.Info,"Created Wac Frame"),this.innerApplicationFrame},e.prototype.bootWacFrame=function(e,t){this.appInitDiagnostics.officeFrameCreateTime=Date.now(),this.sessionTraces.add("frameCreateStartTime",this.appInitDiagnostics.officeFrameCreateTime);var i=!(!this.appParams.sessionInformation.WdParams||!this.appParams.sessionInformation.WdParams.wdSandboxWacFrame),o=this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.appFrameName;this.appParams.fnCreatePragueFrame?this.innerApplicationFrame=this.appParams.fnCreatePragueFrame(this.appParams):this.innerApplicationFrame=u.createAndSubmitWacFrame(this.appParams.container,e,t,i,o),this.postMessenger.setInnerApplicationFrame(this.innerApplicationFrame)},e.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(u.fromWacFrameAppCompleted,(function(t){e.handleWacCompleteMessage(t)})),this.postMessenger.registerMessagePayloadHandler(u.fromWacFrameAppFailed,(function(t){e.handleWacFailureMessage(t)})),window.setTimeout((function(){return e.timeoutWacAppCompleteOrFail()}),u.wacAppCompleteOrFailTimeoutInMs)},e.prototype.handleWacAppBootState=function(e){var t=e&&e.state?e.state:"unknown";this.logger.ULS.traceTag(595714271,a.WopiPendingApplication,s.Info,"WAC Boot App state:["+t+"]")},e.prototype.handleTrustFrameRequest=function(e){var t=m.isTopFrameTrusted();this.logger.ULS.traceTag(595653903,a.WopiPendingApplication,s.Info,"Top frame is trusted: "+t),this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,h.TrustFrameResponse,{isTopFrameTrusted:t})},e.prototype.handleWacCompleteMessage=function(e){if(this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444234,a.WopiPendingApplication,s.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(u.fromWacFrameAppCompletedAck,{}),this.sendParentPostMessage(u.fromWacFrameAppCompleted,e),l.assembleFromMessagePayload(e,this.appInitDiagnostics),this.logger.ULS.traceTag(595986314,a.WopiPendingApplication,s.Info,"Received wac complete message");var t=this.getApplicationState();this.fnOnWopiBootSuccess(t),this.sendJsApiDiagnosticsToWacFrame(this.appParams.diagnostics),this.fastFoodUlsPing&&this.endUlsPing(),this.logger.ULS.flush()}},e.prototype.getApplicationState=function(){return{innerApplicationFrame:this.innerApplicationFrame}},e.prototype.handleWacFailureMessage=function(e){if(this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444235,a.WopiPendingApplication,s.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(u.fromWacFrameAppFailedAck,{}),this.sendParentPostMessage(u.fromWacFrameAppFailed,e);var t={errorType:p.WacFailed,errorObject:{}};e&&(t.errorObject=e.Error,this.sessionTraces.add("error",t)),this.logger.ULS.traceTag(595986315,a.WopiPendingApplication,s.Error,"Received wac failed message"),this.fnOnWopiBootFailure(t),this.fastFoodUlsPing&&this.endUlsPing(),this.logger.ULS.flush()}},e.prototype.timeoutWacAppCompleteOrFail=function(){this.wacAppCompleteOrFailReceived||this.logger.ULS.traceTag(596444236,a.WopiPendingApplication,s.Warning,"WopiPendingApplication.timeoutWacAppCompleteOrFail() sessionTraces:"+JSON.stringify(this.sessionTraces))},e.prototype.sendJsApiDiagnosticsToWacFrame=function(e){this.sendWacPostMessage(u.toWacFrameJsApiDiagnostics,e)},e.prototype.beginUlsPing=function(e,t){this.fastFoodUlsPing=window.setInterval((function(){t.ULS.traceTag(595724178,a.WopiPendingApplication,s.Info,"FastFood heartbeat ...")}),e)},e.prototype.endUlsPing=function(){window.clearInterval(this.fastFoodUlsPing)},e.buildWacFramePostData=function(t,i){var o={};if(t.wopiInfo&&(o[u.wacFrameAccessToken]=t.wopiInfo.AccessToken,o[u.wacFrameAccessTokenTtl]=e.getAccessTokenTtl(t.wopiInfo)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0)if(o[u.wacFrameBundleSource]=t.wopiPrecheckInfo.BundleInfo.Url,null!=t.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==t.wopiPrecheckInfo.BundleInfo.BundleStaleness){var n=t.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();i.ULS.traceTag(595716227,a.WopiPendingApplication,s.Info,"BuildWacFramePostData: Content bundle staleness - "+n),o[u.wacFrameBundleStaleness]=n}else i.ULS.traceTag(595716228,a.WopiPendingApplication,s.Info,"BuildWacFramePostData: Content bundle staleness does not exit");if(t.wopiPrecheckInfo.FileGetUrl&&(o[u.wacFrameFileGetUrl]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.FileName){var r=t.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==r){var p=t.wopiPrecheckInfo.FileName.substring(r+1);p&&(o[u.wacFrameFileExtension]=p)}o[u.wacFrameFileName]=t.wopiPrecheckInfo.FileName}return t.wopiPrecheckInfo.FileSize&&(o[u.wacFrameFileSize]=t.wopiPrecheckInfo.FileSize.toString()),t.sessionInformation.UserId&&(o[u.wacFrameUserId]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(o[u.wacFrameOwnerId]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(o[u.wacFrameSessionContext]=t.sessionInformation.SessionContext),t.diagnostics&&(o[u.wacFrameHostDiagnostics]=JSON.stringify(t.diagnostics)),t.applicationCustomSettings&&t.applicationCustomSettings.HostUIControls&&(o[u.wacFrameHostUIControlOverrides]=JSON.stringify(t.applicationCustomSettings.HostUIControls)),o[u.wacFrameHighDpi]=String(window.devicePixelRatio>1.24),o[u.wacSoftBlockedBrowser]=String(g.isSoftBlockedBrowser()),o[u.wacFrameHostName]=t.sessionInformation.HostName,o},e.getAccessTokenTtl=function(e){return e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0"},e.buildApplicationBootUrl=function(e,t,i){void 0===i&&(i=!1);var o=t.required?t.applicationUrl:e.applicationUrl,n={jsApi:"1"};return i&&(n.NewSession="1"),n.corrid=e.sessionId,n.usid=e.sessionId,(e.applicationCustomSettings&&e.applicationCustomSettings.IsCore||e.sessionInformation.IsCore)&&(n.core="1"),e.sessionInformation.DisableFocusOnBoot&&(n.disableFocusOnBoot="1"),e.sessionInformation.HighContrastMode&&(n.hcm=encodeURIComponent(e.sessionInformation.HighContrastMode)),e.sessionInformation.SupportsAccessibilityLoop&&(n.accloop="1"),e.sessionInformation.SupportsDocReboot&&(n.sdr="1"),e.sessionInformation.HideHeader&&(n.hhdr="1"),e.applicationCustomSettings&&e.applicationCustomSettings.FixDiagnosticsJson&&(n.fixdiag="1"),e.wopiPrecheckInfo.ReadOnly&&(n.readOnly="1"),e.applicationCustomSettings&&e.applicationCustomSettings.InAppDocumentPreview&&(n.InAppDocPreview="1"),t.required?(t.singleFlushFallback&&(e.isCreateNew||(n.instantedit="1",n.wopicomplete="1")),n.wdRedirectionReason=t.reason):(n.instantedit="1",n.fileSrc=encodeURIComponent(e.sessionInformation.HostName),n.pmOrigin=encodeURIComponent(d.getOrigin(window.location.href)),e.isCreateNew&&(n.new="1",e.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(n.wdTpl="fromhost"))),e.wopiPrecheckInfo.PreseededSessionKey&&(n.preseededSessionKey=encodeURIComponent(e.wopiPrecheckInfo.PreseededSessionKey)),e.wopiPrecheckInfo.PreseededWacSessionId&&(n.preseededWacSessionId=encodeURIComponent(e.wopiPrecheckInfo.PreseededWacSessionId)),e.applicationCustomSettings&&e.applicationCustomSettings.additionalApplicationParameters&&(n=r({},e.applicationCustomSettings.additionalApplicationParameters,n)),m.transformApplicationUrl(o,e.sessionInformation,e.wopiInfo,e.diagnostics.HostInitializeDiagnostics,n)},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,t):this.logger.ULS.traceTag(595955718,a.WopiPendingApplication,s.Info,"Attempted to send postmessage: "+e)},e.prototype.sendParentPostMessage=function(e,t){window.parent!==window&&window.location.href.toLowerCase().indexOf("or=teams")>0&&this.postMessenger.sendPostMessage(window.parent,e,t)},e}(),b=function(){function e(){}return Object.defineProperty(e,"BUILD_NUMBER",{get:function(){return "16.0.12209.32652"},enumerable:!0,configurable:!0}),e}(),S=!1,y=!1;function I(){S=!1}function F(e,t,i,o,n){if(t&&t.ULS.traceTag(595714433,a.WopiPendingApplication,s.Info,"Starting disposing the application. unloadApp:"+e+";disposed:"+S+";unloading:"+y),S||y&&e)t&&t.ULS.traceTag(595714908,a.WopiPendingApplication,s.Info,"Application is already disposed or unloading");else{var r={logger:t,postMessenger:i,innerApplicationFrame:o,onDisposed:n,forceAppUnload:!1,disposeStartTime:Date.now(),appUnloadTimedOut:!1};if(e&&o)return y=!0,r.forceAppUnload=!0,void function(e){e.forceAppUnloadStartTime=Date.now(),e.logger&&(e.logger.ULS.traceTag(595855490,a.WopiPendingApplication,s.Info,"Sending postmessage to unload app"),e.logger.ULS.flush());e.postMessenger.registerMessagePayloadHandler(h.AppUnloaded,(function(t){return function(e,t){e.forceAppUnloadEndTime=Date.now(),e.appUnloadedMessageValues=t,e.logger&&e.logger.ULS.traceTag(595855491,a.WopiPendingApplication,s.Info,"AppUnloaded received from app"),v(e)}(e,t)})),e.postMessenger.sendPostMessage(e.innerApplicationFrame.contentWindow,h.HostUnload,{}),window.setTimeout((function(){return function(e){!y&&S||(e.appUnloadTimedOut=!0,e.logger&&e.logger.ULS.traceTag(595855492,a.WopiPendingApplication,s.Info,"ApplicationUnload timed out, forcing dispose"),v(e))}(e)}),u.wacFrameUnloadTimeoutInMs)}(r);v(r)}}function v(e){if(!S)try{S=!0,y=!1,function(e){if(!e.innerApplicationFrame)return;e.innerApplicationFrame.src="about:blank",window.setTimeout((function(){e.innerApplicationFrame&&e.innerApplicationFrame.parentElement&&e.innerApplicationFrame.parentElement.removeChild(e.innerApplicationFrame)}),0)}(e),function(e){if(!e.logger)return;var t={disposeStartTime:e.disposeStartTime,disposeEndTime:Date.now(),forceAppUnload:e.forceAppUnload,appUnloadTimedOut:e.appUnloadTimedOut};e.forceAppUnloadStartTime&&(t.appUnloadStartTime=e.forceAppUnloadStartTime);e.forceAppUnloadEndTime&&(t.appUnloadEndTime=e.forceAppUnloadEndTime);if(e.appUnloadedMessageValues){var i=e.appUnloadedMessageValues;void 0!==i.sendBeaconFlight&&(t.sendBeaconFlight=i.sendBeaconFlight),void 0!==i.sendBeaconSupported&&(t.sendBeaconSupported=i.sendBeaconSupported);var o=Number(i.hostMessageReceived);e.forceAppUnloadStartTime&&!isNaN(o)&&(t.hostToAppPostMessageLatency=o-e.forceAppUnloadStartTime);var n=Number(i.appMessageSent);!isNaN(n)&&e.forceAppUnloadEndTime&&(t.appToHostPostMessageLatency=e.forceAppUnloadEndTime-n);var r=Number(i.appUnloadStart),p=Number(i.appUnloadEnd);if(isNaN(r)||isNaN(p)||(t.appUnloadLatency=p-r),i.serverTimings){var c=i.serverTimings;for(var l in c)t["st-"+l.toString()]=c[l]}}e.logger.ULS.traceTag(595855436,a.WopiPendingApplication,s.Info,"App disposed "+JSON.stringify(t)),e.logger.ULS.flushOnClose()}(e),e.onDisposed&&e.onDisposed()}catch(t){e.logger&&e.logger.ULS.traceTag(595714434,a.WopiPendingApplication,s.Error,"Error disposing: "+l.stringifyError(t))}}var C=function(){function e(e,t,i,o,n,r,a,s,p){var c=this;this.wacFrameIsLoaded=!1,this.initializeCompleted=!1,this.completeOrFailCalled=!1,this.sessionFailureReason=null,this.parallelizeStartSession=!0,this.wacAcceptsStartSessionComplete=!1,this.wacAppSessionCompletionMessageAck=!1,this.appParams=e,this.wopiFallbackInfo=t,this.appInitDiagnostics=i,this.logger=o,this.postMessenger=n,this.visibilityMetrics=r,this.fnOnWopiBootSuccess=s,this.fnOnWopiBootFailure=p,this.sessionTraces=a,this.sessionTraces.add(f.wopiPendingInitializeTime,Date.now()),I(),this.setTimeout((function(){return c.timeoutCompleteOrFail()}),u.completeOrFailTimeoutInMs)}return e.prototype.Complete=function(e,t){if(this.completeOrFailCalled)this.logger.ULS.traceTag(596444184,a.WopiPendingApplication,s.Warning,"Complete called after Complete/Fail already called");else{this.logger.ULS.traceTag(596444185,a.WopiPendingApplication,s.Info,"WopiPendingApplication.Complete() called."),this.completeOrFailCalled=!0,this.wopiInfo=e,this.sessionTraces.add(f.wopiPendingCompleteTime,Date.now());try{this.wopiFallbackInfo.required?this.completeFallbackFlow():this.completeInstantFlow(),this.wacFrameIsLoaded&&this.sendWacPostMessage(u.toWacFramePendingAppCompleteReceived,{}),this.updateBrowserHistoryForCreateNew(t)}catch(e){this.logger.ULS.traceTag(596444186,a.WopiPendingApplication,s.Error,"WopiPendingApplication.Complete() unexpected script error: "+l.stringifyError(e))}finally{this.logger.ULS.flush()}}},e.prototype.Fail=function(e){this.completeOrFailCalled?this.logger.ULS.traceTag(596444187,a.WopiPendingApplication,s.Warning,"Fail called after Complete/Fail already called"):(this.logger.ULS.traceTag(596444188,a.WopiPendingApplication,s.Warning,"WopiPendingApplication.Fail() called. Reason: "+(e?JSON.stringify(e):"N/A")),this.completeOrFailCalled=!0,this.wopiFallbackInfo.required?this.failFallbackFlow():this.failInstantFlow(e),this.logger.ULS.flush())},e.prototype.Dispose=function(e,t){var i=this;F(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete i.innerApplicationFrame,t&&t()}))},e.prototype.Boot=function(){this.wopiFallbackInfo.required||this.bootInstantFlow(),this.logger.ULS.flush()},e.prototype.bootInstantFlow=function(){var e=this;this.logger.ULS.traceTag(596444231,a.WopiPendingApplication,s.Info,"Initializing Office frame WITHOUT WOPI info available - first step of instant boot flow."),this.setTimeout((function(){return e.timeoutWacReadyMessage()}),u.wacReadyTimeoutInMs),this.populateWacFrameEventHandlersForInstantBoot();var t=new P(this.appParams,this.wopiFallbackInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.visibilityMetrics,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=t.Boot()},e.prototype.populateWacFrameEventHandlersForInstantBoot=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(u.fromWacFrameInitReady,(function(t){e.handleWacReadyMessage(t)})),this.postMessenger.registerMessagePayloadHandler(u.fromWacFrameInitFrameLoaded,(function(t){e.handleWacFrameLoadedMessage(t)})),this.postMessenger.registerMessagePayloadHandler(u.fromWacFrameSessionCompleteAck,(function(t){e.handleWacFrameSessionCompleteAckMessage(t)}))},e.prototype.completeInstantFlow=function(){var e={ParallelizeStartSession:this.parallelizeStartSession,WacFrameIsLoaded:this.wacFrameIsLoaded,WacAcceptsStartSessionComplete:this.wacAcceptsStartSessionComplete};this.logger.ULS.traceTag(596444232,a.WopiPendingApplication,s.Info,"Completing the Office initialized application WITH the WOPI info - second step of instant boot flow. Current app state - "+JSON.stringify(e)),!this.parallelizeStartSession||this.wacFrameIsLoaded&&!this.wacAcceptsStartSessionComplete?this.wacFrameIsLoaded&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},e.prototype.completeFallbackFlow=function(){this.logger.ULS.traceTag(596444233,a.WopiPendingApplication,s.Info,"Initializing Office frame WITH WOPI info available - single step of WOPI boot flow."),this.appParams.wopiInfo=this.wopiInfo;var e=new P(this.appParams,this.wopiFallbackInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.visibilityMetrics,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=e.Boot()},e.prototype.failInstantFlow=function(e){this.wacFrameIsLoaded?(this.logger.ULS.traceTag(595968481,a.WopiPendingApplication,s.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(e)):(this.logger.ULS.traceTag(595968482,a.WopiPendingApplication,s.Warning,"Fail was called on the session prior to WacReady."),this.sessionFailureReason=e)},e.prototype.sendFailurePostMessageToWacFrame=function(e){this.logger.ULS.traceTag(596444189,a.WopiPendingApplication,s.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(u.toWacFrameFailSession,e)},e.prototype.failFallbackFlow=function(){this.logger.ULS.traceTag(596444190,a.WopiPendingApplication,s.Warning,"Fail called during Fallback Boot, calling host failure callback..."),this.fnOnWopiBootFailure({errorType:p.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},e.prototype.setTimeout=function(e,t){window.setTimeout((function(){return e()}),t)},e.prototype.timeoutWacReadyMessage=function(){this.wacFrameIsLoaded||(this.logger.ULS.traceTag(596444191,a.WopiPendingApplication,s.Warning,"WopiPendingApplication.timeoutWacReadyMessage()"),this.fnOnWopiBootFailure({errorType:p.TimeoutWacReady,errorObject:void 0}))},e.prototype.timeoutCompleteOrFail=function(){this.completeOrFailCalled||(this.logger.ULS.traceTag(596444192,a.WopiPendingApplication,s.Warning,"WopiPendingApplication.timeoutCompleteOrFail() sessionTraces:"+this.sessionTraces.stringify()),this.sessionTraces.add("timeoutCompleteOrFail",Date.now()))},e.prototype.timeoutWacSessionCompletionMessageAck=function(e,t,i){this.wacAppSessionCompletionMessageAck||(this.logger.ULS.traceTag(596444193,a.WopiPendingApplication,s.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(e,t,i+1))},e.prototype.handleWacReadyMessage=function(e){if(this.sessionTraces.add(f.readyMessageReceiveTime,Date.now()),this.sendWacPostMessage(u.toWacFrameInitReadyAck,{}),this.wacFrameIsLoaded)this.logger.ULS.traceTag(596444194,a.WopiPendingApplication,s.Info,"Received multiple ready messages - frame is already loaded.");else{this.wacFrameIsLoaded=!0,this.wacAcceptsStartSessionComplete=e&&e.CanAcceptStartSessionComplete;var t={AcceptStartSessionComplete:this.wacAcceptsStartSessionComplete,ParallelizeStartSession:this.parallelizeStartSession,StartSessionResponse:null!=this.startSessionResponse,WopiInfo:null!=this.wopiInfo};this.logger.ULS.traceTag(596444195,a.WopiPendingApplication,s.Info,"HandleWacReadyMessage - "+JSON.stringify(t)),this.completeOrFailCalled&&(this.sessionFailureReason?this.sendFailurePostMessageToWacFrame(this.sessionFailureReason):this.sendWacPostMessage(u.toWacFramePendingAppCompleteReceived,{})),this.parallelizeStartSession&&this.wacAcceptsStartSessionComplete?this.startSessionResponse&&this.startSessionCompleted():this.wopiInfo&&this.sendWopiInfoToWacFrame(),l.assembleFromMessagePayload(e,this.appInitDiagnostics)}},e.prototype.handleWacFrameLoadedMessage=function(e){l.assembleFromMessagePayload(e,this.appInitDiagnostics)},e.prototype.handleWacFrameSessionCompleteAckMessage=function(e){this.wacAppSessionCompletionMessageAck=!0,this.sessionTraces.add("sessionCompleteAckReceivedTime",Date.now())},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,t)},e.prototype.sendSessionCompletionMessageWithRetry=function(e,t){this.sendSessionCompletionMessageWithRetryHelper(e,t,1)},e.prototype.sendSessionCompletionMessageWithRetryHelper=function(e,t,i){var o=this;if(i>u.postMessageMaxRetries)this.logger.ULS.traceTag(596444224,a.WopiPendingApplication,s.Error,"Attempted to call complete, but received no ack from the frame. Time: "+Date.now());else{this.logger.ULS.traceTag(596444225,a.WopiPendingApplication,s.Info,"Sending completion message to frame. Attempt number: "+i+", Time: "+Date.now());var n=Date.now();1===i&&(this.startSessionResponse&&this.startSessionResponse.Diagnostics&&(this.startSessionResponse.Diagnostics.completeMessageCreateTime=n),this.sessionTraces.add(f.completeMessageCreateTime,n)),t.Diagnostics.completeMessageSendTime=n,this.sessionTraces.add(f.completeMessageSendTime,n),this.sendWacPostMessage(e,t),this.setTimeout((function(){return o.timeoutWacSessionCompletionMessageAck(e,t,i)}),u.wacSessionCompleteAckTimeoutInMs)}},e.prototype.makeStartSessionRequest=function(){var t=this;this.logger.ULS.traceTag(596444226,a.WopiPendingApplication,s.Info,"Making parallelized startSession request.");var i=this.buildStartSessionUrl(this.wopiInfo),o={"Content-Type":"application/x-www-form-urlencoded"},n="access_token="+encodeURIComponent(this.wopiInfo.AccessToken)+"&access_token_ttl="+encodeURIComponent(P.getAccessTokenTtl(this.wopiInfo));this.sessionTraces.add(f.startSessionStartTime,Date.now()),e.makeXhrRequest(i,n,o,(function(e){return t.onStartSessionRequestCompleted(e)}))},e.prototype.onStartSessionRequestCompleted=function(e){if(this.sessionTraces.add(f.startSessionCompleteTime,Date.now()),this.sessionTraces.add("startSessionResponseStatus",e.status),this.startSessionResponse={StartSessionResponse:{RequestStatus:e.status,ResponseText:e.responseText},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.get(f.wopiPendingInitializeTime),wopiPendingCompleteTime:this.sessionTraces.get(f.wopiPendingCompleteTime),startSessionStartTime:this.sessionTraces.get(f.startSessionStartTime),startSessionCompleteTime:this.sessionTraces.get(f.startSessionCompleteTime),readyMessageReceiveTime:this.sessionTraces.get(f.readyMessageReceiveTime)}},this.logger.ULS.traceTag(596444227,a.WopiPendingApplication,s.Info,"StartSession request completed with status code: "+this.startSessionResponse.StartSessionResponse.RequestStatus+", Time: "+Date.now()),this.wacFrameIsLoaded&&this.wacAcceptsStartSessionComplete)this.startSessionCompleted();else{var t={WacFrameIsLoaded:this.wacFrameIsLoaded,InitializeCompleted:this.initializeCompleted};this.logger.ULS.traceTag(596444228,a.WopiPendingApplication,s.Info,"StartSessionCompleted not called - "+JSON.stringify(t))}},e.prototype.sendWopiInfoToWacFrame=function(){if(!this.initializeCompleted){this.initializeCompleted=!0,this.logger.ULS.traceTag(596444229,a.WopiPendingApplication,s.Info,"Sending wopi info to the frame.");var e={WopiDetails:{WopiSrc:this.wopiInfo.WopiSrc,AccessToken:this.wopiInfo.AccessToken,AccessTokenTtl:P.getAccessTokenTtl(this.wopiInfo)},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.get(f.wopiPendingInitializeTime),wopiPendingCompleteTime:this.sessionTraces.get(f.wopiPendingCompleteTime),readyMessageReceiveTime:this.sessionTraces.get(f.readyMessageReceiveTime)}};this.sendSessionCompletionMessageWithRetry(u.toWacFramePendingSessionComplete,e)}},e.prototype.startSessionCompleted=function(){200===this.startSessionResponse.StartSessionResponse.RequestStatus?this.initializeCompleted||(this.initializeCompleted=!0,this.sendSessionCompletionMessageWithRetry(u.toWacFrameStartSessionComplete,this.startSessionResponse)):this.sendWopiInfoToWacFrame()},e.prototype.buildStartSessionUrl=function(t){var i=this.appParams.applicationBaseUrl+e.wordEditorStartSessionName,o=P.buildApplicationBootUrl(this.appParams,this.wopiFallbackInfo,!1);return i+="?"+o.substring(o.indexOf("?")+1),i=d.addQueryParam(i,"WOPISrc",encodeURIComponent(t.WopiSrc)),i=d.addQueryParam(i,"build",encodeURIComponent(b.BUILD_NUMBER)),i=d.addQueryParam(i,"WacUserType",encodeURIComponent("WOPI")),this.appParams.wopiPrecheckInfo.FileGetUrl&&(i=d.addQueryParam(i,"fileGetUrlPresent","1")),i},e.prototype.updateBrowserHistoryForCreateNew=function(e){if(this.appParams.isCreateNew){if(!e||!e.NewFilePath)return void this.logger.ULS.traceTag(596444230,a.WopiPendingApplication,s.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",e.NewFilePath),e.UpdatedPageTitle&&(document.title=e.UpdatedPageTitle)}},e.makeXhrRequest=function(e,t,i,o){var n=new XMLHttpRequest,r=t||"";for(var a in n.onreadystatechange=function(){if(n&&4===n.readyState){if(void 0===n.status||0===n.status)return;try{o&&o(n)}finally{null!=n&&(n.onreadystatechange=function(){})}}},n.open("Post",e,!0),i)n.setRequestHeader(a,i[a]);n.send(r)},e.wordEditorStartSessionName="wordeditorstartsession.ashx",e}(),A=function(){function e(){}return Object.defineProperty(e,"BrowserEvent",{get:function(){return"BrowserEvent"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PageChanged",{get:function(){return"PageChanged"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ZoomChanged",{get:function(){return"ZoomChanged"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ContentRefreshBegin",{get:function(){return"ContentRefreshBegin"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ContentRefreshEnd",{get:function(){return"ContentRefreshEnd"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AppClosed",{get:function(){return"UI_Close"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UserEdit",{get:function(){return"Edit_Notification"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FileRename",{get:function(){return"File_Rename"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FileShare",{get:function(){return"UI_Sharing"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowFileVersions",{get:function(){return"UI_FileVersions"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UIWorkflow",{get:function(){return"UI_Workflow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"IsDisabled",{get:function(){return"IsDisabled"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AccessibilityLoopComplete",{get:function(){return"App_AccessibilityLoopComplete"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Unloaded",{get:function(){return"Unloaded"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SwitchMode",{get:function(){return"App_SwitchMode"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DocumentReboot",{get:function(){return"DocReboot"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WopiInfoFromUrl",{get:function(){return"WopiInfoFromUrl"},enumerable:!0,configurable:!0}),e}(),T=function(){function e(e,t,i,o,n,r,a,s,p){this.wacCompleteMessageReceived=!1,this.appInitializeComplete=!1,this.isMobile=!1,this.appInitializeTimeoutInMs=6e4,this.appParams=e,this.wopiFallbackInfo=t,this.appInitDiagnostics=i,this.logger=o,this.postMessenger=n,this.visibilityMetrics=r,this.sessionTraces=a;var c=window.navigator.userAgent;c.indexOf("Mobi")>=0&&c.indexOf("iPad")<0&&(this.isMobile=!0),this.fnOnWopiBootSuccess=s,this.fnOnWopiBootFailure=p,this.fnOnWopiBootSuccessProxy=this.isMobile?s:this.getSuccessCallbackProxy(),this.fnOnWopiBootFailureProxy=this.isMobile?p:this.getFailureCallbackProxy(),this.isCore=!(!this.appParams.applicationCustomSettings||!this.appParams.applicationCustomSettings.IsCore),this.appParams.sessionInformation&&this.appParams.sessionInformation.WdParams&&(this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.ForceAccessibilityMode?this.appParams.sessionInformation.WdParams.wdAccPdf="1":this.isCore&&(this.appParams.sessionInformation.WdParams.wdAccPdf="0")),this.wopiPendingInitializer=new C(this.appParams,t,i,o,n,r,a,this.fnOnWopiBootSuccessProxy,this.fnOnWopiBootFailureProxy)}return e.prototype.Complete=function(e){this.appParams.diagnostics.HostInitializeDiagnostics&&(this.appParams.diagnostics.HostInitializeDiagnostics.hostCompleteCallTime=Date.now()),this.wopiPendingInitializer.Complete(e)},e.prototype.Fail=function(e){this.wopiPendingInitializer.Fail(e)},e.prototype.Dispose=function(e,t){var i=this;F(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete i.innerApplicationFrame,t&&t()}))},e.prototype.Boot=function(){var e=this;this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),this.visibilityMetrics.RegisterEventHandler(this.visibilityChangeHandler),this.isMobile?this.logger.ULS.traceTag(595932544,a.WordViewer,s.Info,"Mobile Endpoint detected, skipping first page viewer optimization"):(this.logger.ULS.traceTag(595989253,a.WordViewer,s.Info,"Boot WordViewer"),this.postMessenger.registerMessagePayloadHandler(h.UpdatePageCount,(function(t){e.handleWacPageCountInit(t)})),this.postMessenger.registerMessagePayloadHandler(A.PageChanged,(function(t){e.handleWacCurrentPageInit(t)})),this.postMessenger.registerMessagePayloadHandler(A.ZoomChanged,(function(t){e.handleWacZoomLevelInit(t)})),this.appParams.wopiPrecheckInfo.BundleInfo?this.kickOffFirstPageOptimization(this.appParams.wopiPrecheckInfo.BundleInfo,this.appParams.container,(function(){e.firstPageOptimizationLoadTime=Date.now(),e.logger.ULS.traceTag(595998873,a.WordViewer,s.Info,"FirstPageFromHostLoadTime: "+e.firstPageOptimizationLoadTime),e.appInitDiagnostics.documentLoadedTime=e.appInitDiagnostics.documentLoadedTime||e.firstPageOptimizationLoadTime,e.innerApplicationFrame&&e.innerApplicationFrame.contentWindow&&e.postFastBootOptimizationTime(e.innerApplicationFrame.contentWindow,e.firstPageOptimizationLoadTime)}),(function(t){e.removeFirstPageContainer(),e.logger.ULS.traceTag(595994571,a.WordViewer,s.Warning,"Cannot load first page from cache"),e.appInitDiagnostics.errorObject=t})):this.logger.ULS.traceTag(596121033,a.WordViewer,s.Warning,"Missing Bundle Info"),window.setTimeout((function(){return e.timeoutAppInitialize()}),this.appInitializeTimeoutInMs))},e.prototype.postFastBootOptimizationTime=function(e,t){this.postMessenger.sendPostMessage(e,h.HostCacheDiagnostic,{HostCacheLoadTime:t})},e.prototype.kickOffFirstPageOptimization=function(e,t,i,o){var n=this;if(this.logger.ULS.traceTag(595989254,a.WordViewer,s.Info,"Kick off OptimizationView"),!this.appParams.applicationCustomSettings||!this.appParams.applicationCustomSettings.ForceAccessibilityMode)if(e.Url){var r=t.ownerDocument;this.firstPageContainer=r.createElement("div"),this.firstPageContainer.id="FirstPageContainer",this.firstPageContainer.style.left="0",this.firstPageContainer.style.textAlign="center",this.firstPageContainer.style.width="1px",this.firstPageContainer.style.bottom="0",this.firstPageContainer.style.zIndex="900",this.firstPageContainer.style.height="1px",this.firstPageContainer.style.position="absolute",this.firstPageContainer.style.padding="0 29px",this.firstPageContainer.style.right="0",this.firstPageContainer.style.overflow="auto",this.firstPageContainer.style.marginLeft="auto",this.firstPageContainer.style.marginRight="auto",this.firstPageContainer.style.maxWidth="100%",this.isCore?this.firstPageContainer.style.top="0":this.firstPageContainer.style.top="90px",t.appendChild(this.firstPageContainer);var c=r.createElement("img");c.id="FirstPageImage",c.style.marginTop="11px",c.style.marginBottom="11px",c.style.maxWidth="100%",c.style.border="solid 1px #d2d5d8",c.draggable=!1,c.onload=function(){n.logger.ULS.traceTag(595989255,a.WordViewer,s.Info,"OptimizationView Loaded"),n.firstPageContainer.style.width="",n.firstPageContainer.style.height="",i()},c.onerror=function(e){o({errorType:p.CannotLoadFirstPage,errorObject:e.returnValue})},c.src=e.Url.replace("{0}","p1.img"),this.firstPageContainer.appendChild(c)}else this.logger.ULS.traceTag(595722645,a.WordViewer,s.Info,"Missing Url in provided Bundle Info, from host: "+this.appParams.sessionInformation.HostName)},e.prototype.tryInitializeApplication=function(){if(!this.appInitializeComplete&&this.wacCompleteMessageReceived&&(!this.isCore||this.currentPage&&this.pageCount&&this.zoomLevel)){this.postMessenger.removeMessageHandler(h.UpdatePageCount),this.postMessenger.removeMessageHandler(A.PageChanged),this.postMessenger.removeMessageHandler(A.ZoomChanged),this.visibilityMetrics.RemoveEventHandler(this.visibilityChangeHandler);var e={isCore:this.isCore,pageCount:this.pageCount,currentPage:this.currentPage,zoomLevel:this.zoomLevel,innerApplicationFrame:this.innerApplicationFrame};this.fnOnWopiBootSuccess(e),this.logger.ULS.traceTag(595989256,a.WordViewer,s.Info,"Word Viewer Initialize Complete"),this.appInitializeComplete=!0,this.logger.ULS.flush()}},e.prototype.getSuccessCallbackProxy=function(){var e=this;return function(t){e.logger.ULS.traceTag(595986312,a.WordViewer,s.Info,"SuccessCallbackProxy called"),e.innerApplicationFrame=t.innerApplicationFrame,e.innerApplicationFrame&&e.innerApplicationFrame.contentWindow&&e.firstPageOptimizationLoadTime&&e.postFastBootOptimizationTime(e.innerApplicationFrame.contentWindow,e.firstPageOptimizationLoadTime),e.removeFirstPageContainer();var i=e.appInitDiagnostics.documentLoadedTime;i&&e.firstPageOptimizationLoadTime&&e.firstPageOptimizationLoadTime<i?(e.appInitDiagnostics.documentLoadedTime=e.firstPageOptimizationLoadTime,e.appInitDiagnostics.documentLoadedFromWopiPrecheckInfo=!0,e.logger.ULS.traceTag(595994572,a.WordViewer,s.Info,"First page load from cache was faster")):e.appInitDiagnostics.documentLoadedFromWopiPrecheckInfo=!1,e.sendAckMessages(),e.wacCompleteMessageReceived=!0,e.logger.ULS.traceTag(595986313,a.WordViewer,s.Info,"WordViewerInitializer received wac complete message"),e.tryInitializeApplication(),e.logger.ULS.flush()}},e.prototype.getFailureCallbackProxy=function(){var e=this;return function(t){e.logger.ULS.traceTag(595972122,a.WordViewer,s.Error,"FailureCallbackProxy called"),e.appInitializeComplete=!0,e.visibilityMetrics.RemoveEventHandler(e.visibilityChangeHandler),e.fnOnWopiBootFailure(t)}},e.prototype.removeFirstPageContainer=function(){this.firstPageContainer&&this.firstPageContainer.parentElement&&this.firstPageContainer.parentElement.removeChild(this.firstPageContainer)},e.prototype.timeoutAppInitialize=function(){if(!this.appInitializeComplete){this.sessionTraces.add("timeoutAppInitialize",Date.now());var e="Didn't receive app initialize post messages. {'appComplete': "+this.wacCompleteMessageReceived+", 'currentPage': "+(void 0!==this.currentPage)+", 'zoomLevel': "+(void 0!==this.zoomLevel)+", 'pageCount': "+(void 0!==this.pageCount)+"}";this.logger.ULS.traceTag(596120771,a.WordViewer,s.Warning,e)}},e.prototype.handleWacPageCountInit=function(e){if(!e||"number"!=typeof e[w.PageCount])throw new TypeError("values: PageCount not found");this.pageCount=e[w.PageCount],this.sendWacPostMessage(h.UpdatePageCountAck,{}),this.tryInitializeApplication()},e.prototype.handleWacCurrentPageInit=function(e){if(!e||"number"!=typeof e[w.NewPageNumber])throw new TypeError("values: CurrentPage not found");this.currentPage=e[w.NewPageNumber],this.sendWacPostMessage(h.PageChangedAck,{}),this.tryInitializeApplication()},e.prototype.handleWacZoomLevelInit=function(e){if(!e||"number"!=typeof e[w.NewZoomLevel])throw new TypeError("values: ZoomLevel not found");this.zoomLevel=e[w.NewZoomLevel],this.sendWacPostMessage(h.ZoomChangedAck,{}),this.tryInitializeApplication()},e.prototype.handleVisibilityChange=function(e){var t="Document visibility changed: "+e.visibility;this.logger.ULS.traceTag(595970189,a.WordViewer,s.Info,t)},e.prototype.sendAckMessages=function(){this.currentPage&&this.sendWacPostMessage(h.PageChangedAck,{}),this.pageCount&&this.sendWacPostMessage(h.UpdatePageCountAck,{}),this.zoomLevel&&this.sendWacPostMessage(h.ZoomChangedAck,{})},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,t):this.logger.ULS.traceTag(595955717,a.WordViewer,s.Info,"Attempted to send WordViewer postmessage: "+e)},e}(),W={};W.wopiInfoByUrl=h.WopiInfoFromUrlResponse;var U,O=function(){function e(e,t){var i=this;if(this.isFastfood=!1,this.isMsit=!1,this.eventHandlers={},!e)throw new Error("Missing origin for PostMessageHandler");this.isFastfood=d.isFastFoodUrl(e),this.isMsit=d.isMsitUrl(e),this.logger=t,this.setOrigin(e),window.addEventListener("message",(function(e){return i.handleWacFramePostMessage(e)}),!1)}return e.prototype.registerMessagePayloadHandler=function(e,t){if(this.eventHandlers[e])throw new Error("Duplicate registration!");this.eventHandlers[e]=t},e.prototype.removeMessageHandler=function(e){delete this.eventHandlers[e]},e.prototype.sendPostMessage=function(e,t,i){if(e){this.logger.ULS.traceTag(596464334,a.WopiPendingApplication,s.Info,"PostMessageHandler - Sending message: "+t);var o={MessageId:t,SendTime:Date.now(),Values:i};this.sendPostMessageInternal(e,JSON.stringify(o),this.origin)}else this.logger.ULS.traceTag(595948308,a.WopiPendingApplication,s.Info,"Missing target for SendPostMessage")},e.prototype.setInnerApplicationFrame=function(e){this.innerApplicationFrame=e},e.prototype.postMessageForCommand=function(e,t,i){var o=function(e){return W[e]}(t);o?(this.logger.ULS.traceTag(595702598,a.WopiPendingApplication,s.Info,"PostCommand: Sending message "+o+" for command "+t),this.sendPostMessage(e,o,i)):this.logger.ULS.traceTag(595702599,a.WopiPendingApplication,s.Warning,"PostCommand: No mapping for command "+t)},e.prototype.dispose=function(){for(var e=0,t=Object.keys(this.eventHandlers);e<t.length;e++){var i=t[e];delete this.eventHandlers[i]}},e.prototype.sendAckBack=function(e,t,i){if(e){var o={MessageId:h.Ack,CorrelationId:i,SendTime:Date.now()};this.logger.ULS.traceTag(595732176,a.WopiPendingApplication,s.Info,"Sending Ack back"),e.postMessage(JSON.stringify(o),t)}else this.logger.ULS.traceTag(595736136,a.WopiPendingApplication,s.Info,"Missing target to send Ack back")},e.prototype.handleWacFramePostMessage=function(e){var t=!1,i=!1,o="",n=!1;if(this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow&&(t=!0,i=e.source===this.innerApplicationFrame.contentWindow),e.origin&&(n=(o=d.getBaseDomain(e.origin,u.subDomainPartsForPostMessageHandler).toLowerCase())===this.receivingDomain),!this.isFastfood&&(!this.isMsit||n&&i)||this.logger.ULS.traceTag(595730526,a.WopiPendingApplication,s.Info,"Window is available: "+t+", window is valid: "+i+", origin is valid: "+n+", expected origin: "+this.receivingDomain+", actual origin: "+o),i||n){var r;try{r=JSON.parse(e.data)}catch(t){return this.logger.ULS.traceTag(596464282,a.WopiPendingApplication,s.Info,"PostMessageHandler - failed to parse event data: "+l.stringifyError(t)+"."),void(this.isFastfood&&this.logger.ULS.traceTag(595732175,a.WopiPendingApplication,s.Info,"string"==typeof e.data?"Length of event data: "+e.data.length+". First 200 characters of event data: "+e.data.substring(0,200):"Event data: "+JSON.stringify(e.data)))}var p=r.MessageId;if(p){this.logger.ULS.traceTag(595714715,a.WopiPendingApplication,s.Info,"PostMessageHandler: received messageId: "+p),p!==u.fromWacFrameAppCompleted&&p!==u.fromWacFrameAppLoadingStatus||this.setOrigin(e.origin),r.Values&&r.Values[w.AckExpected]&&this.sendAckBack(e.source,e.origin,r.CorrelationId);var c=this.eventHandlers[p];c?(this.logger.ULS.traceTag(596464288,a.WopiPendingApplication,s.Info,"PostMessageHandler - processing message: "+p),c(r.Values||{})):this.logger.ULS.traceTag(596464289,a.WopiPendingApplication,s.Info,"PostMessageHandler - no handler found for message id: "+p)}else(this.isFastfood||this.isMsit)&&this.logger.ULS.traceTag(595730520,a.WopiPendingApplication,s.Info,"Could not find message id")}},e.prototype.sendPostMessageInternal=function(e,t,i){e.postMessage(t,i)},e.prototype.setOrigin=function(e){var t=e.toLowerCase();this.origin&&this.origin!==t&&this.logger.ULS.traceTag(596128131,a.WopiPendingApplication,s.Warning,"PostMessageHandler - updating origin"),this.origin=t,this.receivingDomain=d.getBaseDomain(t,u.subDomainPartsForPostMessageHandler),this.isFastfood=d.isFastFoodUrl(t),this.isMsit=d.isMsitUrl(t)},e}();function M(e,t,i,o){var n=e.map((function(e){return function(e,t){var i={};i.G=e.tag,i.T=e.timestamp-t,i.M=e.message,i.C=e.category;var o=e.type*L+e.level;return i.D=o,i}(e,o)})),r=function(e,t,i,o){var n={};return n.T=e,n.L=t,n.S=i,n.I=o,n.V=1,n}(o,n,t,i);return JSON.stringify(r)}!function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(U||(U={}));var L=1e3;var E=function(){function e(t,i){var o=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.isFastFood=!1,this.flushOnClose=function(){o.triggerUpload(!1,!1)},this.flush=function(){o.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(t,i){(window.clearTimeout(o.timeoutId),o.logCache.length>0)&&(o.uploadId+=1,function(e,t,i){if(""!==t)if(navigator&&navigator.sendBeacon)navigator.sendBeacon(t,e);else{var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,i),o.send(e))}}(M(o.logCache,o.userSessionId,o.uploadId,o.timestampBase),o.remoteUrlEndpoint,i),o.logCache=[],o.timestampBase=Date.now());t&&(o.timeoutId=window.setTimeout(o.triggerUploadAsync,e.uploadCadenceInMsSec))},this.isFastFood=d.isFastFoodUrl(i),this.isFastFood&&(e.uploadCadenceInMsSec=5e3,e.uploadTriggerSize=10),this.userSessionId=t,this.remoteUrlEndpoint=i+"?usid="+t,window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)}return e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimedMessage.length)+e.trimedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===s.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimedMessage="... [Trimmed]",e}(),R={getLogger:function(e,t){var i=new E(e,t);return{ULS:{trace:function(e,t,o){return D(i,0,e,t,o)},traceTag:function(e,t,o,n){return D(i,e,t,o,n)},flush:i.flush,flushOnClose:i.flushOnClose}}}};var k=s.Info;function D(e,t,i,o,n){if(!(o>k)){var r={timestamp:Date.now(),category:i,tag:t,level:o,type:U.Trace,message:n};e.handleTrace(r)}}var x,H=[],B=function(){function e(e){this.eventHandlers=[],this.initialize(e)}return e.prototype.initialize=function(e){if("hidden"===document.visibilityState){var t={visibility:document.visibilityState,time:Date.now(),initialState:!0};H.push(t)}var i=void 0!==this.handleVisibilityChange,o=i&&void 0!==this.handleVisibilityChange.bind;o?(this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.visibilityChangeHandler)):e.ULS.traceTag(595718222,a.WopiPendingApplication,s.Warning,"WindowVisibilityMetrics bad initialization isHandleVisibilityChangeDefined:"+i+", isBindDefined:"+o)},e.prototype.RegisterEventHandler=function(e){this.eventHandlers.push(e)},e.prototype.RemoveEventHandler=function(e){if(e){var t=this.eventHandlers.indexOf(e);this.eventHandlers.splice(t,1)}},e.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},e.prototype.GetVisibilityChangeEvents=function(){return H},e.prototype.handleVisibilityChange=function(){var e={visibility:document.visibilityState,time:Date.now(),initialState:!1};H.push(e);for(var t=0,i=this.eventHandlers;t<i.length;t++){var o=i[t];o&&o(e)}},e}(),N=function(){function e(){}return Object.defineProperty(e,"defaultBaseUrl",{get:function(){if(Object({NODE_ENV:"production"}).CDN_CONTENT_SOURCE)return"https://contentstorage.osi.office.net/word/"+b.BUILD_NUMBER+"/";throw"BootstrapperUrl has to be provided for Instant Viewer to work from WAC CDN"},enumerable:!0,configurable:!0}),e.baseUrl=function(t){return Object({NODE_ENV:"production"}).CDN_CONTENT_SOURCE?t+"/word/"+b.BUILD_NUMBER+"/":t+"/wv/s/"+e.contentVersion+"_"},Object.defineProperty(e,"contentVersion",{get:function(){var e=b.BUILD_NUMBER;return e.substr(0,2)+e.substr(5,5)+e.substr(11,5)},enumerable:!0,configurable:!0}),e}(),j={DEBUG_SUFFIX:"",IS_DEBUG:!1,MIN_SUFFIX:".min"},z=function(){function e(e,t,i){this.forceShip=e&&e.forceShip,this.appBundleUrl=this.getBaseUrl(t,e&&e.appBundleCustomUrl),this.logger=i}return e.prototype.getBaseUrl=function(t,i){if(void 0!==i)return i;if(void 0!==t){var o=e.getHost(t);if(o)return N.baseUrl(o)}return N.defaultBaseUrl},Object.defineProperty(e.prototype,"baseUrl",{get:function(){return this.logger&&this.logger.ULS.traceTag(595648662,a.WopiPendingApplication,s.Info,"ApplicationFiles.baseUrl() is called"),this.appBundleUrl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prefetchJsPaths",{get:function(){this.logger&&this.logger.ULS.traceTag(595648663,a.WopiPendingApplication,s.Info,"ApplicationFiles.prefetchJsPaths() is called");var e=["app_scripts/microsoftajax"+this.getDebugSuffix()+".js","app_scripts/wordinstantviewer"+this.getDebugSuffix()+".js","app_scripts/wordinstantviewer"+this.getDebugSuffix()+".dll1.js"];return-1===navigator.userAgent.indexOf("Trident")&&-1===navigator.userAgent.indexOf("IEMobile")&&e.push("app_scripts/compat"+this.getDebugSuffix()+".js"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cssPaths",{get:function(){return this.logger&&this.logger.ULS.traceTag(595648664,a.WopiPendingApplication,s.Info,"ApplicationFiles.cssPaths() is called"),Object({NODE_ENV:"production"}).CDN_CONTENT_SOURCE?["resources/wordviewer.css"]:["resources/1033/wordviewer.css"]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preReqJsPaths",{get:function(){this.logger&&this.logger.ULS.traceTag(595648665,a.WopiPendingApplication,s.Info,"ApplicationFiles.preReqJsPaths() is called");var e=["app_scripts/microsoftajax"+this.getDebugSuffix()+".js"];return-1===navigator.userAgent.indexOf("Trident")&&-1===navigator.userAgent.indexOf("IEMobile")&&e.push("app_scripts/compat"+this.getDebugSuffix()+".js"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appJsPaths",{get:function(){return this.logger&&this.logger.ULS.traceTag(595648666,a.WopiPendingApplication,s.Info,"ApplicationFiles.appJsPaths() is called"),["app_scripts/wordinstantviewer"+this.getDebugSuffix()+".js"]},enumerable:!0,configurable:!0}),e.prototype.getDebugSuffix=function(){return j.DEBUG_SUFFIX&&!this.forceShip?j.DEBUG_SUFFIX:""},e.getHost=function(e){var t=e.match(/^(https?\:\/\/[^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]?t[1]:""},e}();function _(e){return e.indexOf("we/wordeditorframe.aspx")>=0}function V(e,t){var i=e.applicationUrl.toLowerCase(),o=_(i),n=i.indexOf("wv/wordviewerframe.aspx")>=0,r=function(e){return e.indexOf("o/onenoteframe.aspx")>=0}(i),p=function(e,t,i,o){if(e.forceFallback)return{required:!0,applicationUrl:e.applicationUrl,forceFallback:!0,reason:x.forceFallback,ignoreWacFramePostMessages:!1};var n={required:!1,applicationUrl:"",reason:"",ignoreWacFramePostMessages:!1,forceFallback:!1,singleFlushFallback:!1};if(e.disableFallback)return n;if(!t&&e.wopiPrecheckInfo.IrmEnabled)return n.required=!0,n.irmFallback=!0,n.ignoreWacFramePostMessages=!0,n.reason=x.unifiedIrmEnabledFallback,n.applicationUrl=e.applicationUrl,n;if(e.fnCreatePragueFrame)return n.required=!0,n.singleFlushFallback=!0,n.reason=x.unifiedSingleFlushFallback,n.applicationUrl=e.applicationUrl,n.ignoreWacFramePostMessages=!1,n;t||o?(e.wopiInfo||g.getBrowserName()===c.IE)&&(n.required=!0,n.singleFlushFallback=!0,n.reason=x.unifiedSingleFlushFallback,n.applicationUrl=e.applicationUrl,n.ignoreWacFramePostMessages=e.isCreateNew||!1):(n.required=!0,n.ignoreWacFramePostMessages=!0,n.reason=i?x.unifiedViewActionUrlFallback:x.unifiedNotEditOrViewActionUrlFallback,n.applicationUrl=e.applicationUrl);return n}(e,o,n,r);if(p.required){var l={fallbackIsRequired:!0,fallbackReason:p.reason,gotWordEditUrl:o,gotWordViewUrl:n,gotOneNoteUrl:r,irmEnabled:e.wopiPrecheckInfo.IrmEnabled,readOnly:e.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:p.ignoreWacFramePostMessages};t.ULS.traceTag(596444182,a.WopiPendingApplication,l.irmEnabled?s.Warning:s.Info,JSON.stringify(l))}else t.ULS.traceTag(596444183,a.WopiPendingApplication,s.Info,"Received input valid for instant boot.");return p}function q(e){return function(e,t){e.WdParams||(e.WdParams={});if(e.WdParams.wd)return;t.substring(1).split("&").filter((function(t){if(0===t.indexOf("wd")){var i=t.split("=");i[0].length>2&&(e.WdParams[i[0]]=i[1])}}))}(e,window.location.search),e}!function(e){e.unifiedSingleFlushFallback="Unified_SingleFlushFallback",e.unifiedIrmEnabledFallback="Unified_IrmEnabled",e.unifiedViewActionUrlFallback="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrlFallback="Unified_NotEditOrViewActionUrl",e.forceFallback="Force_Fallback"}(x||(x={}));var J=function(){function e(e,t){this.appFactory=e,this.bootstrapperParameters=t}return e.prototype.GetVersion=function(){return b.BUILD_NUMBER},e.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},e.prototype.Prefetch=function(e){if(null!=e&&void 0!==e){var t=document.createElement("link");t.rel="prefetch";var i=e.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),t.href=i;var o=document.getElementsByTagName("head")[0];null!=o&&void 0!==o&&o.appendChild(t)}},e.prototype.InitializeWopiPending=function(t,i,o,n){var c,g,u=this;try{var m=Date.now();e.validateParametersWopiPending(t);var h=o,w=void 0;h||(h=(c=function(){var e=new Uint8Array(31),t=function(e){var t={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){t.crypto=!0;try{return i.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+l.stringifyError(e))}}var o=!1,n=window.performance;try{n&&n.now&&n.now()!==1/0&&(o=!0)}catch(e){t.exceptions.push("perfNow: "+l.stringifyError(e))}for(var r=0;r<e.length;r+=1){try{if(o){t.perfNow=!0;var a=Math.floor(100*n.now())%10;(a<0||a>9)&&(a=0);for(var s=0;s<a;s+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+l.stringifyError(e))}e[r]=Math.floor(16*Math.random())}return t}(e),i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var o=15&e[i];return i+=1,("x"===t?o:3&o|8).toString(16)})),t]}())[0],w=c[1]);var P=function(e,t,i){return{container:e.Container,sessionInformation:q(e.SessionInformation),applicationUrl:e.ApplicationUrl,wopiPrecheckInfo:e.WopiPrecheckInfo,applicationCustomSettings:e.ApplicationCustomSettings,diagnostics:{HostInitializeDiagnostics:e.Diagnostics},fnOnInitializeSuccess:e.FnOnInitializeSuccess,fnOnInitializeFailure:e.FnOnInitializeFailure,applicationFiles:new z(e.ApplicationCustomSettings&&e.ApplicationCustomSettings.appBundleParameters,e.BootstrapperUrl,i),sessionId:t,applicationBaseUrl:d.getApplicationBaseUrl(e.ApplicationUrl),wopiInfo:e.WopiInfo,forceFallback:!1,disableFallback:!1,isCreateNew:(n=e.ApplicationUrl,r=e.WopiPrecheckInfo.IsNewFile,r||"1"===d.getParameterValue(n,"new")),featureManager:(o=e.FnIsFeatureEnabled,{isFeatureEnabled:function(e){return function(e,t){return!!t&&t(e)}(e,o)}})};var o,n,r}(t,h,g=i||R.getLogger(h,d.getApplicationBaseUrl(t.ApplicationUrl)+"RemoteUls.ashx"));this.bootstrapperParameters.fnReportSessionStart&&this.bootstrapperParameters.fnReportSessionStart(P),P.forceFallback=this.bootstrapperParameters.forceFallback,P.fnCreatePragueFrame=this.bootstrapperParameters.fnCreatePragueFrame,P.diagnostics.HostInitializeDiagnostics&&(P.diagnostics.HostInitializeDiagnostics.hostInitializeCallTime=m),g.ULS.traceTag(596464283,a.WopiPendingApplication,s.Info,"ApplicationBootstrapper - initializing session. Build version: "+this.GetVersion()),w&&g.ULS.traceTag(595937313,a.WopiPendingApplication,s.Info,JSON.stringify(w)),P&&P.wopiInfo&&P.wopiInfo.AccessToken&&P.wopiInfo.AccessTokenExpiry?(0===P.wopiInfo.AccessToken.length||P.wopiInfo.AccessTokenExpiry.getTime()<=Date.now())&&g.ULS.traceTag(595894621,a.WopiPendingApplication,s.Error,"ApplicationBootstrapper.InitializeWopiPending: AccessToken is not valid, AccessTokenlength: "+P.wopiInfo.AccessToken.length+", AccessTokenExpiry: "+P.wopiInfo.AccessTokenExpiry+", AccessTokenTTL: "+P.wopiInfo.AccessTokenExpiry.getTime()+", DateNow: "+Date.now()):g.ULS.traceTag(595894553,a.WopiPendingApplication,s.Error,"ApplicationBootstrapper.InitializeWopiPending: there are some missing paramters"),window.addEventListener("beforeunload",(function(){return u.logPageState(g,"OnBeforeUnload",!0)}),{capture:!0}),window.addEventListener("pagehide",(function(){return u.logPageState(g,"OnPageHide",!0)}),{capture:!0}),window.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&u.logPageState(g,"VisibilityChange_Hidden",!0)}),{capture:!0});var S=l.getLoggableSessionInfo(P.sessionInformation);g.ULS.traceTag(596444237,a.WopiPendingApplication,s.Info,JSON.stringify({hostSessionInformation:S})),g.ULS.traceTag(596444238,a.WopiPendingApplication,s.Info,JSON.stringify({hostInitDiagnostics:P.diagnostics.HostInitializeDiagnostics?P.diagnostics.HostInitializeDiagnostics:"N/A"})),this.logFlightInfo(P,g);var y=d.getOrigin(P.fnCreatePragueFrame?window.location.href:t.ApplicationUrl),I=n||new O(y,g),F=new B(g),v=new f(g),W=V(P,g),U=r({},P.diagnostics.HostInitializeDiagnostics,{officeSessionId:P.sessionId,officeBootstrapperVersion:b.BUILD_NUMBER,hostName:P.sessionInformation.HostName}),M=e.getSuccessCallback(U,P.sessionId,I,g,v,F,t.FnOnInitializeSuccess,this.appFactory),L=e.getFailureCallback(U,g,v,F,t.FnOnInitializeFailure);this.addToJSONToPerformanceResource();var E=t&&t.BootstrapperUrl;E&&this.periodicPrefetch(E,g),t.FnOnAppModeSwitched&&I.registerMessagePayloadHandler(A.SwitchMode,t.FnOnAppModeSwitched);var k=!1,D=!1,H=P.applicationUrl.toLowerCase();-1!==H.indexOf("uiembed")&&(k=t.WopiPrecheckInfo.ReadOnly&&-1!==H.indexOf("wordeditorframe"),D=t.WopiPrecheckInfo.IrmEnabled&&-1!==H.indexOf("wordviewerframe"));var N=void 0;if(this.bootstrapperParameters.useViewerInitializer||W.reason===x.unifiedViewActionUrlFallback||k||D)(W.reason===x.unifiedViewActionUrlFallback||k||D)&&t.FnOnAppModeSwitched&&t.FnOnAppModeSwitched({NewMode:"view"}),k&&(P.applicationUrl=this.transformWordEditorUrlToViewerUrl(P.applicationUrl),W={required:!0,applicationUrl:P.applicationUrl,forceFallback:!0,reason:x.forceFallback,ignoreWacFramePostMessages:!1}),D&&(W.ignoreWacFramePostMessages=!1),N=new T(P,W,U,g,I,F,v,M,L);else{(t.WopiPrecheckInfo.ReadOnly||t.WopiPrecheckInfo.IrmEnabled)&&t.FnOnAppModeSwitched&&t.FnOnAppModeSwitched({NewMode:"view"});var j=W.required?W.applicationUrl:P.applicationUrl;if(E&&this.bootstrapperParameters.preloader&&this.bootstrapperParameters.preloader.shouldPreload(j))try{this.bootstrapperParameters.preloader.preload(E,g)}catch(e){g.ULS.traceTag(595943884,a.WopiPendingApplication,s.Error,l.stringifyError(e))}N=new C(P,W,U,g,I,F,v,M,L)}return N.Boot(),N}catch(e){return g&&(g.ULS.traceTag(596459925,a.WopiPendingApplication,s.Error,p.AppInitError+": "+l.stringifyError(e)),g.ULS.flushOnClose()),void t.FnOnInitializeFailure({errorType:p.AppInitError,errorObject:e},void 0)}},e.prototype.transformWordEditorUrlToViewerUrl=function(e){var t=e.toLowerCase();return t=(t=t.replace("word-edit","word-view")).replace("we/wordeditor","wv/wordviewer"),t=d.addQueryParam(t,"WordEditorFailedToLoad","1")},e.prototype.addToJSONToPerformanceResource=function(){"undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}})},e.prototype.periodicPrefetch=function(e,t){var i=this;setInterval((function(){i.Prefetch({BootstrapperUrl:e}),t.ULS.traceTag(595895774,a.WopiPendingApplication,s.Info,"Prefetching "+d.getPageName(e))}),36e5)},e.prototype.logFlightInfo=function(e,t){var i=e.applicationCustomSettings&&e.applicationCustomSettings.InteractiveReadOnlyFlight,o=e.applicationCustomSettings&&e.applicationCustomSettings.InteractiveReadOnlyAAExperiment;i&&t.ULS.traceTag(595953632,a.WopiPendingApplication,s.Warning,"InteractiveReadOnlyFlight: "+i+", InteractiveReadOnlyAAExperiment: "+o)},e.prototype.logPageState=function(e,t,i){if(e){var o="Page lifecycle: "+t+" fired.";o+=i?"Flushing ULS logger":"",e.ULS.traceTag(595957843,a.WopiPendingApplication,s.Info,o),i&&e.ULS.flush()}},e.getSuccessCallback=function(t,i,o,n,r,p,c,d){return function(g){e.traceTabSwitchDiagnostics(t,r,p),r.log(s.Info),n.ULS.traceTag(596448985,a.WopiPendingApplication,s.Info,JSON.stringify(t));var u=d(i,n,o,g);try{c(u,t)}catch(e){n.ULS.traceTag(595719171,a.WopiPendingApplication,s.Error,"Exception thrown from host's success callback: "+l.stringifyError(e))}e.traceJsapiResourceTiming(n)}},e.getFailureCallback=function(t,i,o,n,r){return function(p){e.traceTabSwitchDiagnostics(t,o,n),o.log(s.Warning),i.ULS.traceTag(596448986,a.WopiPendingApplication,s.Error,JSON.stringify({error:p,appInitDiagnostics:t}));try{r(p,t)}catch(e){i.ULS.traceTag(595719172,a.WopiPendingApplication,s.Error,"Exception thrown from host's failure callback: "+l.stringifyError(e))}e.traceJsapiResourceTiming(i)}},e.traceJsapiResourceTiming=function(t){try{if(void 0===window.performance)return void t.ULS.traceTag(595948609,a.WopiPendingApplication,s.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: performance not supported");var i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void t.ULS.traceTag(595948610,a.WopiPendingApplication,s.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: no resources under performance");for(var o=0,n=i;o<n.length;o++){var r=n[o];if(e.bootstrapperURLRegex.test(r.name)){var p=JSON.stringify(r),c=d.getPageName(r.name);return p=p.replace(new RegExp(r.name,"g"),c),void t.ULS.traceTag(595948616,a.WopiPendingApplication,s.Info,p)}}t.ULS.traceTag(595948484,a.WopiPendingApplication,s.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: could not find JSAPI resource timing entry")}catch(e){t.ULS.traceTag(595948617,a.WopiPendingApplication,s.Info,"ApplicationBootstrapper.TraceJsapiResourceTiming: could not trace the resource timing, error is: "+l.stringifyError(e))}},e.traceTabSwitchDiagnostics=function(e,t,i){i.Stop();var o=i.GetVisibilityChangeEvents();null!=o&&o.length>0&&(e.documentLoadedWithTabSwitch=!0,t.add("tabSwitchDiagnostics",JSON.stringify(o)))},e.validateParametersWopiPending=function(e){if(void 0===e)throw new TypeError("initParams");var t=e.Container;if(void 0===t||void 0===t.appendChild)throw new TypeError("Container");var i=e.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");var o=e.ApplicationUrl;if(void 0===o||"string"!=typeof o)throw new TypeError("ApplicationUrl");var n=e.WopiPrecheckInfo;if(void 0===n||void 0===n.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")},e.bootstrapperURLRegex=new RegExp("excel-boot.min.js|word.boot.js|visio.boot.js","i"),e}(),Z=function(){function e(e,t,i,o){this.eventHandlers={},this.sessionId=e,this.logger=t,this.innerApplicationFrame=o.innerApplicationFrame,this.postMessenger=i,this.registerPostMessageHandlers(),I()}return e.prototype.GetApplicationType=function(){throw new Error("Not implemented")},e.prototype.GetVersion=function(){return b.BUILD_NUMBER},e.prototype.GetSessionId=function(){return this.sessionId},e.prototype.RegisterEventHandler=function(e,t){switch(e){case A.AccessibilityLoopComplete:case A.Unloaded:case A.DocumentReboot:case A.WopiInfoFromUrl:if(this.eventHandlers[e])throw new Error("Duplicate registration");this.eventHandlers[e]=t;break;default:this.postMessenger.registerMessagePayloadHandler(e,t)}},e.prototype.RemoveEventHandler=function(e,t){switch(e){case A.AccessibilityLoopComplete:case A.Unloaded:case A.DocumentReboot:case A.WopiInfoFromUrl:if(this.eventHandlers[e]!==t)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.eventHandlers[e];break;default:this.postMessenger.removeMessageHandler(e)}},e.prototype.RegisterErrorHandler=function(e){},e.prototype.RemoveErrorHandler=function(e){},e.prototype.PostCommand=function(e,t){this.postMessenger.postMessageForCommand(this.innerApplicationFrame.contentWindow,e,t)},e.prototype.Dispose=function(e){var t=this;F(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete t.innerApplicationFrame,t.raiseEvent(A.Unloaded,{})}))},e.prototype.registerPostMessageHandlers=function(){this.postMessenger.registerMessagePayloadHandler(A.AccessibilityLoopComplete,this.handleAccessibilityLoopComplete.bind(this)),this.postMessenger.registerMessagePayloadHandler(h.DocumentReboot,this.handleDocumentRebootMessage.bind(this)),this.postMessenger.registerMessagePayloadHandler(h.SoftReboot,this.handleSoftRebootMessage.bind(this)),this.postMessenger.registerMessagePayloadHandler(h.WopiInfoFromUrlRequest,this.handleWopiInfoFromUrlRequest.bind(this))},e.prototype.raiseEvent=function(e,t){var i=this.eventHandlers[e];i&&i(t||{})},e.prototype.handleAccessibilityLoopComplete=function(e){window.parent!==window&&window.location.href.toLowerCase().indexOf("or=teams")>0&&this.postMessenger.sendPostMessage(window.parent,A.AccessibilityLoopComplete,e),this.raiseEvent(A.AccessibilityLoopComplete,e)},e.prototype.handleDocumentRebootMessage=function(e){this.raiseEvent(A.DocumentReboot,e)},e.prototype.handleSoftRebootMessage=function(e){window.location.reload()},e.prototype.handleWopiInfoFromUrlRequest=function(e){this.raiseEvent(A.WopiInfoFromUrl,e)},e}();var G=function(e){function t(t,i,o,n){var r=e.call(this,t,i,o,n)||this;return r.eventUpdateTimeout=5e3,r.innerApplicationFrame=n.innerApplicationFrame,r.postMessenger=o,r.logger=i,r.eventHandlers={},r.isCore=n.isCore,r.page=n.currentPage,r.zoomLevel=n.zoomLevel,r.pageCount=n.pageCount,r.isDisabled=!r.isCore,r.postMessenger.registerMessagePayloadHandler(A.ZoomChanged,r.handleZoomChange.bind(r)),r.postMessenger.registerMessagePayloadHandler(A.PageChanged,r.handlePageChange.bind(r)),r.postMessenger.registerMessagePayloadHandler(h.FrameStateChanged,r.handleIsDisabled.bind(r)),r.postMessenger.registerMessagePayloadHandler(h.Error,r.raiseError.bind(r)),r}return n(t,e),t.prototype.SetCurrentPage=function(e){var t=this;this.isDisabled?this.raiseError({errorType:p.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}):(this.lastRequestedPage=e,this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,h.SetCurrentPage,{newPage:this.lastRequestedPage}),window.setTimeout((function(){t.lastRequestedPage!==t.page&&t.logger&&t.logger.ULS.traceTag(596444179,a.WordViewer,s.Info,'Did not receive the page change update. {"RequestedPage": '+t.lastRequestedPage+', "CurrentPage": '+t.page+"}")}),this.eventUpdateTimeout))},t.prototype.GetPageCount=function(){return this.isDisabled&&this.raiseError({errorType:p.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}),this.pageCount},t.prototype.GetCurrentPage=function(){return this.isDisabled&&this.raiseError({errorType:p.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}),this.page},t.prototype.SetZoomLevel=function(e){var t=this;this.isDisabled?this.raiseError({errorType:p.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}):(this.lastRequestedZoomLevel=Number(e.toFixed(2)),this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,h.SetZoomLevel,{newLevel:this.lastRequestedZoomLevel}),window.setTimeout((function(){t.lastRequestedZoomLevel!==t.zoomLevel&&t.logger&&t.logger.ULS.traceTag(596444180,a.WordViewer,s.Info,'Did not receive the zoom change update. {"RequestedZoom": '+t.lastRequestedZoomLevel+', "CurrentZoom": '+t.zoomLevel+"}")}),this.eventUpdateTimeout))},t.prototype.GetZoomLevel=function(){return this.isDisabled&&this.raiseError({errorType:p.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}),this.zoomLevel},t.prototype.GetIsDisabled=function(){return this.isDisabled},t.prototype.GetApplicationType=function(){return"Word Viewer"},t.prototype.RegisterEventHandler=function(e,t){switch(e){case A.ZoomChanged:case A.PageChanged:case A.IsDisabled:if(this.eventHandlers[e])throw new Error("Duplicate registration");this.eventHandlers[e]=t;break;default:this.postMessenger.registerMessagePayloadHandler(e,t)}},t.prototype.RemoveEventHandler=function(e,t){switch(e){case A.ZoomChanged:case A.PageChanged:case A.IsDisabled:if(this.eventHandlers[e]!==t)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.eventHandlers[e];break;default:this.postMessenger.removeMessageHandler(e)}},t.prototype.RegisterErrorHandler=function(e){this.hostErrorHandler=e},t.prototype.RemoveErrorHandler=function(e){if(this.hostErrorHandler!==e)throw new Error("The handler requested to be removed does not exist");delete this.hostErrorHandler},t.prototype.raiseError=function(e){var t={errorType:"",errorObject:{}};if(t.errorType=e[w.ErrorType],t.errorObject=e[w.ErrorObject],!t.errorType||!t.errorObject)throw new TypeError("Error object is missing errorType or errorObject");this.hostErrorHandler&&this.hostErrorHandler(t)},t.prototype.handleZoomChange=function(e){this.zoomLevel=e[w.NewZoomLevel],this.raiseEvent(A.ZoomChanged,e)},t.prototype.handlePageChange=function(e){this.page=e[w.NewPageNumber],this.raiseEvent(A.PageChanged,e)},t.prototype.handleIsDisabled=function(e){this.isDisabled=e[w.IsDisabled],this.raiseEvent(A.IsDisabled,e)},t}(Z);var X=function(e){function t(t){var i=e.call(this,t)||this;return i.resources=[],i.initResources(),i}return n(t,e),t.prototype.initResources=function(){for(var e=0,t=[{domain:"word-edit",url:"wacbootwe.js"},{domain:"officeapps",url:"MicrosoftAjax"+this.debugSuffix+".js"},{domain:"word-edit",url:"Compat"+this.debugSuffix+".js"},{domain:"word-edit",url:"WordEditor"+this.debugSuffix+".js"},{domain:"word-edit",url:"jSanity"+this.debugSuffix+".js"}];e<t.length;e++){var i=t[e],o=this.resourceHostUrl.replace("word-view",i.domain);"/"!==o[o.length-1]&&(o+="/"),o+="we/s/"+this.buildPrefix+"_App_Scripts/"+i.url,this.resources.push(o)}},t}(function(){function e(t){this.resourceHostUrl=d.getOrigin(t),this.buildPrefix=e.getContentVersion(),this.debugSuffix=e.getDebugSuffix(),this.minSuffix=e.getMinSuffix(),this.resourceHint=e.getResourceHint(),this.bootstrapperPageName=d.getPageName(t)}return e.prototype.preloadResources=function(e){for(var t=0,i=this.resources;t<i.length;t++){var o=i[t];this.preloadResource(o,e)}},e.prototype.preloadResource=function(e,t){var i=document.createElement("link");if(i.setAttribute("crossorigin","anonymous"),i.rel=this.resourceHint,i.href=e,t){i.addEventListener("error",(function(){t.ULS.traceTag(595719107,a.WopiPendingApplication,s.Error,"resource failed to load: "+d.getPageName(e))}))}i.setAttribute("as","script"),document.head.appendChild(i)},e.getContentVersion=function(){var e=b.BUILD_NUMBER;if(j.IS_DEBUG)return e;if(!e)throw new Error("Build number not available");var t=e.split(".");if(4!==t.length)throw new Error("Build number has incorrect format");return t[0]+t[2]+t[3]},e.getDebugSuffix=function(){return j.DEBUG_SUFFIX?j.DEBUG_SUFFIX:""},e.getMinSuffix=function(){return j.MIN_SUFFIX?j.MIN_SUFFIX:""},e.getResourceHint=function(){var e=g.getBrowserName();return e===c.Firefox||e===c.IE?"prefetch":"preload"},e}()),Q=function(){function e(){}return e.prototype.shouldPreload=function(e){return _(e)&&!1},e.prototype.preload=function(e){new X(e).preloadResources()},e}();i.d(t,"Application",(function(){return K})),i.d(t,"Viewer",(function(){return $})),i.d(t,"ApplicationEvents",(function(){return A}));var K=new J((function(e,t,i,o){return new Z(e,t,i,o)}),{forceFallback:!1,preloader:new Q}),$=new J((function(e,t,i,o){return new G(e,t,i,o)}),{forceFallback:!0,useViewerInitializer:!0})}]);

