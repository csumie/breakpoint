(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[3],{26:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(6068),o=n(5214),a=n(1822),s=n(1308),l=n(3748),u=n(5479),c=n(8540),d=n(4192),p=n(7500),g=n(6849),h=n(2506),_=n(1388),f=n(2186),m=function(){return function(e,t){this.Start=0,this.End=0,this.Start=e,this.End=t}}();(0,r.l)(m,"3cf62084$MergeDiffIdx",null,[]);var y=function(){function e(e,t,n,r,i,o){this.baseRevisionMergeBlocks=null,this.updatedRevisionMergeBlocks=null,this.mergeDiffType=0,this.diffIndex=0,this.diffLengthBase=0,this.diffLengthUpdate=0,this._baseDiffNonGranularListIdx=null,this._updateDiffNonGranularListIdx=null,this._baseDiffGranularListIdx=null,this._updateDiffGranularListIdx=null,this._graphNodeComplexMergeFactory=null,this._featureLookup=null,this._mergeableObjectUtilities=null,this._ignoreFormatting=!1,this._graphNodeComplexMergeFactory=r||new f.GraphNodeComplexMergeFactory,this._mergeableObjectUtilities=i||new d.s,this.baseRevisionMergeBlocks=e.shallowClone(),this.updatedRevisionMergeBlocks=t.shallowClone(),this._baseDiffGranularListIdx=new m(0,0),this._updateDiffGranularListIdx=new m(0,0),this._ignoreFormatting=n,this._featureLookup=o,this.CalculateDiffIndexes(),this.SetMergeDiffType()}return e.prototype.get_baseRevisionMergeBlocks=function(){return this.baseRevisionMergeBlocks},e.prototype.get_updatedRevisionMergeBlocks=function(){return this.updatedRevisionMergeBlocks},e.prototype.get_mergeDiffType=function(){return this.mergeDiffType},e.prototype.get_diffIndex=function(){return this.diffIndex},e.prototype.get_diffLengthBase=function(){return this.diffLengthBase},e.prototype.get_diffLengthUpdate=function(){return this.diffLengthUpdate},e.prototype.get_DiffBlocksFromBase=function(){for(var e=new u.o(_.AMergeBlock,null),t=this._baseDiffNonGranularListIdx.Start;t<this._baseDiffNonGranularListIdx.End;t++)e.add(this.get_baseRevisionMergeBlocks().getItemAt(t));return e},e.prototype.get_DiffBlocksFromUpdate=function(){for(var e=new u.o(_.AMergeBlock,null),t=this._updateDiffNonGranularListIdx.Start;t<this._updateDiffNonGranularListIdx.End;t++)e.add(this.get_updatedRevisionMergeBlocks().getItemAt(t));return e},e.prototype.DoesDiffOverlap=function(e){if(this.get_diffIndex()<e.get_diffIndex()){if(this.get_diffIndex()+this.get_diffLengthBase()>e.get_diffIndex())return!0}else if(this.get_diffIndex()>e.get_diffIndex()){if(e.get_diffIndex()+e.get_diffLengthBase()>this.get_diffIndex())return!0}else if(2===this.get_mergeDiffType()&&3===e.get_mergeDiffType()||3===this.get_mergeDiffType()&&2===e.get_mergeDiffType()||2===this.get_mergeDiffType()&&2===e.get_mergeDiffType()||3===this.get_mergeDiffType()&&3===e.get_mergeDiffType())return!0;return!1},e.prototype.ReplaceItemByRange=function(e,t,n,r){e.deleteAt(t),e.insertRange(t,n),r.val+=n.get_length()-1},e.prototype.SplitBlocksIntoMoreGranularBlocks=function(e,t,n,r,i){var o=this.get_baseRevisionMergeBlocks().getItemAt(e),a=this.get_updatedRevisionMergeBlocks().getItemAt(t);if(!o||!a)return!1;if(!o.get_supportsSplitIntoMoreGranularBlocks()&&!a.get_supportsSplitIntoMoreGranularBlocks())return!1;var s=new u.o(_.AMergeBlock,null),l=new u.o(_.AMergeBlock,null);if(o.get_supportsSplitIntoMoreGranularBlocks()){s=o.splitIntoMoreGranularBlocks();var c=n?0:s.get_length()-1;o=s.getItemAt(c)}if(a.get_supportsSplitIntoMoreGranularBlocks()){l=a.splitIntoMoreGranularBlocks();c=n?0:l.get_length()-1;a=l.getItemAt(c)}return!!o.isEquivalentTo(a,this._graphNodeComplexMergeFactory,this._featureLookup,this._ignoreFormatting)&&(s.get_length()&&this.ReplaceItemByRange(this.get_baseRevisionMergeBlocks(),e,s,r),l.get_length()&&this.ReplaceItemByRange(this.get_updatedRevisionMergeBlocks(),t,l,i),!0)},e.prototype.FindFirstUnequalBlockFromStartInternal=function(e,t,n,r,i,o){for(;i.val<=n&&o.val<=r;){var a=e.getItemAt(i.val),s=t.getItemAt(o.val);if(!a.isEquivalentTo(s,this._graphNodeComplexMergeFactory,this._featureLookup,this._ignoreFormatting))break;this._baseDiffGranularListIdx.Start+=a.get_length(),this._updateDiffGranularListIdx.Start+=s.get_length(),i.val++,o.val++}},e.prototype.FindFirstUnequalBlockFromEndInternal=function(e,t,n,r,i,o){for(;i.val>=n&&o.val>=r;){if(!e.getItemAt(i.val).isEquivalentTo(t.getItemAt(o.val),this._graphNodeComplexMergeFactory,this._featureLookup,this._ignoreFormatting))return!0;i.val--,o.val--}return!1},e.prototype.FindFirstUnequalBlockFromStart=function(e,t,n,r){var i=!1;do{this.FindFirstUnequalBlockFromStartInternal(this.get_baseRevisionMergeBlocks(),this.get_updatedRevisionMergeBlocks(),n.val,r.val,e,t),i=this.SplitBlocksIntoMoreGranularBlocks(e.val,t.val,!0,n,r)}while(i)},e.prototype.FindFirstUnequalBlockFromEnd=function(e,t,n,r){var i=!1;do{if(!this.FindFirstUnequalBlockFromEndInternal(this.get_baseRevisionMergeBlocks(),this.get_updatedRevisionMergeBlocks(),e,t,n,r))break;i=this.SplitBlocksIntoMoreGranularBlocks(n.val,r.val,!1,n,r)}while(i)},e.prototype.CalculateDiffIndexes=function(){var e=0,t=0,n=this.get_baseRevisionMergeBlocks().get_length()-1,r=this.get_updatedRevisionMergeBlocks().get_length()-1;this.get_baseRevisionMergeBlocks().getItemAt(n),this.get_updatedRevisionMergeBlocks().getItemAt(r);this.FindFirstUnequalBlockFromStart((0,a.m)((function(){return e}),(function(t){return e=t})),(0,a.m)((function(){return t}),(function(e){return t=e})),(0,a.m)((function(){return n}),(function(e){return n=e})),(0,a.m)((function(){return r}),(function(e){return r=e}))),(e<n||t<r)&&this.FindFirstUnequalBlockFromEnd(e,t,(0,a.m)((function(){return n}),(function(e){return n=e})),(0,a.m)((function(){return r}),(function(e){return r=e}))),n++,r++,this._baseDiffNonGranularListIdx=new m(e,n),this._updateDiffNonGranularListIdx=new m(t,r),this._baseDiffGranularListIdx.End=this._baseDiffGranularListIdx.Start,this._updateDiffGranularListIdx.End=this._updateDiffGranularListIdx.Start;for(var i=e;i<n;i++){var o=this.get_baseRevisionMergeBlocks().getItemAt(i);this._baseDiffGranularListIdx.End+=o.get_length()}for(i=t;i<r;i++){o=this.get_updatedRevisionMergeBlocks().getItemAt(i);this._updateDiffGranularListIdx.End+=o.get_length()}if(c.p.get_instance().traceTag(3993809,1,3,"CalculateDiffIndexes: NonGranularList idxs [Base.Start: {0}] [Base.End: {1}] [Update.Start: {2}] [Update.End: {3}]",e,n,t,r),c.p.get_instance().traceTag(3993810,1,3,"CalculateDiffIndexes: GranularList idxs [Base.Start: {0}] [Base.End: {1}] [Update.Start: {2}] [Update.End: {3}]",this._baseDiffGranularListIdx.Start,this._baseDiffGranularListIdx.End,this._updateDiffGranularListIdx.Start,this._updateDiffGranularListIdx.End),this._baseDiffGranularListIdx.Start<=this._baseDiffGranularListIdx.End&&this._updateDiffGranularListIdx.Start<=this._updateDiffGranularListIdx.End){var s=this.get_baseRevisionMergeBlocks().getItemAt(e),l=this.get_updatedRevisionMergeBlocks().getItemAt(t),u=this.get_baseRevisionMergeBlocks().getItemAt(n),d=this.get_updatedRevisionMergeBlocks().getItemAt(r);c.p.get_instance().traceTag(3993811,1,3,"CalculateDiffIndexes: Merge Blocks [Base.Start: {0}] [Base.End: {1}] [Update.Start: {2}] [Update.End: {3}]",s,u,l,d)}},e.prototype.SetMergeDiffType=function(){this.diffIndex=this._baseDiffGranularListIdx.Start,this.diffLengthBase=this.diffLengthUpdate=0,this._baseDiffGranularListIdx.Start===this._baseDiffGranularListIdx.End&&this._updateDiffGranularListIdx.Start===this._updateDiffGranularListIdx.End?this.mergeDiffType=0:this._baseDiffGranularListIdx.Start===this._baseDiffGranularListIdx.End&&this._updateDiffGranularListIdx.Start<this._updateDiffGranularListIdx.End?(this.mergeDiffType=1,this.diffLengthUpdate=this._updateDiffGranularListIdx.End-this._updateDiffGranularListIdx.Start):this._updateDiffGranularListIdx.Start===this._updateDiffGranularListIdx.End&&this._baseDiffGranularListIdx.Start<this._baseDiffGranularListIdx.End?(this.mergeDiffType=2,this.diffLengthBase=this._baseDiffGranularListIdx.End-this._baseDiffGranularListIdx.Start):(this.mergeDiffType=3,this.diffLengthBase=this._baseDiffGranularListIdx.End-this._baseDiffGranularListIdx.Start,this.diffLengthUpdate=this._updateDiffGranularListIdx.End-this._updateDiffGranularListIdx.Start),c.p.get_instance().traceTag(3993814,1,3,"SetMergeDiffType: [MergeDiffType: {0}] [DiffIndex: {1}] [DiffLengthBase: {2}] [DiffLengthUpdate: {3}]",this.get_mergeDiffType(),this.get_diffIndex(),this.get_diffLengthBase(),this.get_diffLengthUpdate())},e.prototype.IsMergeBlockMetadataEqual=function(e,t){if(!e.isTextOrCharacterRun())return!1;if(!t.isTextOrCharacterRun())return!1;var n=e,r=t;return n.runId===r.runId&&n.paraId===r.paraId},e.prototype.IsSupportedEmbeddedObject=function(e){if(!e.isTextOrCharacterRun())return!1;var t=e;if("\ufffc"!==t.get_text())return!1;var n=t.get_formatObj();if(!n)return!1;var r=n;if(r.hasProperty(h.j.commentObjectId)||r.hasProperty(h.j.bookmarkObjectId)||r.hasProperty(h.j.dynamicRangeId)||r.hasProperty(h.j.footnoteEndnoteKind)||r.hasProperty(h.j.imageType)||r.hasProperty(h.j.isSupportedFieldBegin)||r.hasProperty(h.j.isSupportedFieldEnd))return!0;if(r.hasProperty(h.j.placeholderKind)){var i=this._mergeableObjectUtilities.getPropertyInt32(r,h.j.placeholderKind);if(i&&(36===i||35===i||24===i||23===i||33===i||34===i||44===i||45===i||42===i||43===i))return!0}return!1},e.prototype.IsMergeableTextBlock=function(e){return e.isTextOrCharacterRun()&&!this.IsSupportedEmbeddedObject(e)},e.prototype.CanCopyMetadataFromPreviousBlock=function(){if(2===this.get_mergeDiffType())return!1;var e=this._updateDiffNonGranularListIdx.Start;if(!e)return!1;for(var t=null,n=this._updateDiffNonGranularListIdx.Start;n<this._updateDiffNonGranularListIdx.End;n++){var r=this.get_updatedRevisionMergeBlocks().getItemAt(n);if(this.IsMergeableTextBlock(r)){t=r;break}}if(!t)return!1;for(var i=e-1,o=this.get_updatedRevisionMergeBlocks().getItemAt(i);o&&!this.IsMergeableTextBlock(o);)i--,o=this.get_updatedRevisionMergeBlocks().getItemAt(i);return!(!o||!this.IsMergeBlockMetadataEqual(o,t))},e.prototype.GetGranularListOfMergeBlocks=function(e){for(var t=new u.o(_.AMergeBlock,null),n=0;n<e.get_length();n++)e.get_item(n).get_supportsSplitIntoMoreGranularBlocks()?t.insertRange(t.get_length(),e.get_item(n).splitIntoMoreGranularBlocks()):t.insert(t.get_length(),e.get_item(n));return t},e.prototype.IsMergeDiffReplaceAPureFormattingChange=function(){if(3!==this.get_mergeDiffType())return!1;if(this.get_diffLengthBase()!==this.get_diffLengthUpdate())return!1;var e=this.GetGranularListOfMergeBlocks(this.get_DiffBlocksFromBase()),t=this.GetGranularListOfMergeBlocks(this.get_DiffBlocksFromUpdate());if(e.get_length()!==t.get_length())return!1;for(var n=0;n<e.get_length();n++)if(!e.get_item(n).isEquivalentTo(t.get_item(n),this._graphNodeComplexMergeFactory,this._featureLookup,!0))return!1;return!0},e.prototype.IsMergeDiffASyncDiffChange=function(){if(this.get_mergeDiffType()&&3!==this.get_mergeDiffType())return!1;if(this.get_baseRevisionMergeBlocks().get_length()!==this.get_updatedRevisionMergeBlocks().get_length())return!1;for(var e=!1,t=0;t<this.get_baseRevisionMergeBlocks().get_length();t++){if(!this.get_baseRevisionMergeBlocks().get_item(t).isEquivalentTo(this.get_updatedRevisionMergeBlocks().get_item(t),this._graphNodeComplexMergeFactory,this._featureLookup,!0))return!1;if(3===this.get_baseRevisionMergeBlocks().get_item(t).get_type()||1===this.get_baseRevisionMergeBlocks().get_item(t).get_type()){var n=this.get_baseRevisionMergeBlocks().get_item(t),r=this.get_updatedRevisionMergeBlocks().get_item(t);e=n.runId!==r.runId||n.paraId!==r.paraId||e}}return e},e}();(0,r.l)(y,"39cf84d8$MergeBlockDiff",null,[]);var v=n(1244),S=function(){return function(e,t){this.Id=null,this.Index=0,this.Id=e,this.Index=t}}();(0,r.l)(S,"e06a3ca2$ParagraphStartIndex",null,[]);var I=n(9495);n.d(t,{ParagraphMerge:function(){return C}});var C=function(){function e(e,t,n,r,i,o){this._mergeState=null,this._baseObjects=null,this._unfavoredObjects=null,this._favoredObjects=null,this._mergeableObjectUtilities=null,this._baseFavoredMergeDiff=null,this._baseUnfavoredMergeDiff=null,this._paragraphIds=null,this._resultMergeBlocks=null,this._isInitialized=!1,this._baseRevisionMergeBlocks=null,this._favoredRevisionMergeBlocks=null,this._unfavoredRevisionMergeBlocks=null,this._baseRevisionMergeBlocksStr=null,this._favoredRevisionMergeBlocksStr=null,this._unfavoredRevisionMergeBlocksStr=null,this._featureEnableLookup=null,this._mergeState=e,this._baseObjects=t,this._unfavoredObjects=r,this._favoredObjects=n,this._featureEnableLookup=i,this._mergeableObjectUtilities=o||new d.s}return e.prototype.GetRemovedEops=function(e){var t=new l.f(s.h);return e.get_baseRevisionMergeBlocks().forEach((function(e){return 2===e.get_type()&&t.add(e.graphNodeId),!0})),e.get_updatedRevisionMergeBlocks().forEach((function(e){return 2===e.get_type()&&t.remove(e.graphNodeId),!0})),t},e.prototype.GetMergeDiffParagraphObjectIdOrdering=function(e){var t=new u.o(s.h,null);return e.get_updatedRevisionMergeBlocks().forEach((function(e){return 2===e.get_type()&&t.add(e.graphNodeId),!0})),t},e.prototype.ComputeEopIndices=function(e){var t=new u.o(S,null),n=0,r=0;return e.get_updatedRevisionMergeBlocks().forEach((function(i){if(2===i.get_type()){var o=void 0;o=n<e.get_diffIndex()?n:n<e.get_diffIndex()+e.get_diffLengthUpdate()?e.get_diffIndex():n-e.get_diffLengthUpdate()+e.get_diffLengthBase(),t.add(new S(i.graphNodeId,o)),n=r}return r+=i.get_length(),!0})),t},e.prototype.ComputeParagraphObjectIdOrdering=function(e,t){for(var n=this.ComputeEopIndices(e),r=this.ComputeEopIndices(t),i=this.GetRemovedEops(e),o=this.GetRemovedEops(t),a=new u.o(s.h,null),c=new l.f(s.h),d=0,p=0;p<n.get_length();p++){var g=n.get_item(p);if(d<r.get_length())for(var h=r.get_item(d);d<r.get_length()&&h.Index<=g.Index;){if(h.Id.equals(g.Id)){d++;break}i.contains(h.Id)||c.contains(h.Id)||(a.add(h.Id),c.add(h.Id)),d++,h=r.get_item(d)}o.contains(g.Id)||(a.add(g.Id),c.add(g.Id))}for(;d<r.get_length();){h=r.get_item(d);i.contains(h.Id)||c.contains(h.Id)||(a.add(h.Id),c.add(h.Id)),d++}return a},e.prototype.Initialize=function(){var e=this;if(this._isInitialized){var t=!!this._baseFavoredMergeDiff&&!!this._baseUnfavoredMergeDiff;return this._mergeState.logger.logMergeFailureDetail((0,o.m)(new v.h,{funcSource:"ParagraphMerge.Initialize",info:"MergeDiff objects not initialized"})),t}return this._isInitialized=!0,!!I.ParagraphMergeUtils.CreateMergeBlocksForMergeInputObjects(this._mergeState,this._mergeableObjectUtilities,this._baseObjects,this._favoredObjects,this._unfavoredObjects,!1,!1,this._featureEnableLookup(14),(0,a.m)((function(){return e._baseRevisionMergeBlocks}),(function(t){return e._baseRevisionMergeBlocks=t})),(0,a.m)((function(){return e._favoredRevisionMergeBlocks}),(function(t){return e._favoredRevisionMergeBlocks=t})),(0,a.m)((function(){return e._unfavoredRevisionMergeBlocks}),(function(t){return e._unfavoredRevisionMergeBlocks=t})),(0,a.m)((function(){return e._baseRevisionMergeBlocksStr}),(function(t){return e._baseRevisionMergeBlocksStr=t})),(0,a.m)((function(){return e._favoredRevisionMergeBlocksStr}),(function(t){return e._favoredRevisionMergeBlocksStr=t})),(0,a.m)((function(){return e._unfavoredRevisionMergeBlocksStr}),(function(t){return e._unfavoredRevisionMergeBlocksStr=t})))&&(this._baseFavoredMergeDiff=new y(this._baseRevisionMergeBlocks,this._favoredRevisionMergeBlocks,!1,null,null,this._featureEnableLookup),this._baseUnfavoredMergeDiff=new y(this._baseRevisionMergeBlocks,this._unfavoredRevisionMergeBlocks,!1,null,null,this._featureEnableLookup),!0)},e.prototype.tryDoMerge=function(e){return e.val=null,this.Initialize()&&this.DoMergeInternal()&&!!I.ParagraphMergeUtils.GetMergeableObjectsFromMergeBlocks(this._mergeState,this._mergeableObjectUtilities,this._featureEnableLookup,this._resultMergeBlocks,this._paragraphIds,e)||(this.LogFailedParagraphMerge(!1),!1)},e.prototype.LogFailedParagraphMerge=function(e){var t="ParagraphMergeFailed: [IsCpMerge: "+e+"] BaseRevisionMergeBlocksList: {0}";c.p.get_instance().traceMultiPartMessageTag(4478665,1,1,t,this._baseRevisionMergeBlocksStr),c.p.get_instance().traceMultiPartMessageTag(4478666,1,1,"FavoredRevisionMergeBlocksList: {0}",this._favoredRevisionMergeBlocksStr),c.p.get_instance().traceMultiPartMessageTag(4478667,1,1,"UnfavoredRevisionMergeBlocksList: {0}",this._unfavoredRevisionMergeBlocksStr);var n=new u.o(s.h,null);I.ParagraphMergeUtils.LogFailedObjects(this._mergeableObjectUtilities,"BaseObjects_",this._baseObjects,n),I.ParagraphMergeUtils.LogFailedObjects(this._mergeableObjectUtilities,"FavoredObjects_",this._favoredObjects,n),I.ParagraphMergeUtils.LogFailedObjects(this._mergeableObjectUtilities,"ConflictObjects_",this._unfavoredObjects,n),I.ParagraphMergeUtils.LogFailedFormattingObjects(this._mergeState,this._mergeableObjectUtilities,n)},e.prototype.CalculateGranularListIndicesForUpdate=function(e,t,n){t.val=0,n.val=0,this._baseFavoredMergeDiff.get_mergeDiffType()?1===this._baseFavoredMergeDiff.get_mergeDiffType()?this._baseUnfavoredMergeDiff.get_diffIndex()<this._baseFavoredMergeDiff.get_diffIndex()?t.val=this._baseUnfavoredMergeDiff.get_diffIndex():this._baseUnfavoredMergeDiff.get_diffIndex()===this._baseFavoredMergeDiff.get_diffIndex()?e||1!==this._baseUnfavoredMergeDiff.get_mergeDiffType()?t.val=this._baseUnfavoredMergeDiff.get_diffIndex()+this._baseFavoredMergeDiff.get_diffLengthUpdate():t.val=this._baseUnfavoredMergeDiff.get_diffIndex():t.val=this._baseUnfavoredMergeDiff.get_diffIndex()+this._baseFavoredMergeDiff.get_diffLengthUpdate():2!==this._baseFavoredMergeDiff.get_mergeDiffType()&&3!==this._baseFavoredMergeDiff.get_mergeDiffType()||(this._baseUnfavoredMergeDiff.get_diffIndex()<=this._baseFavoredMergeDiff.get_diffIndex()?t.val=this._baseUnfavoredMergeDiff.get_diffIndex():t.val=this._baseUnfavoredMergeDiff.get_diffIndex()+(this._baseFavoredMergeDiff.get_diffLengthUpdate()-this._baseFavoredMergeDiff.get_diffLengthBase())):t.val=this._baseUnfavoredMergeDiff.get_diffIndex(),2!==this._baseUnfavoredMergeDiff.get_mergeDiffType()&&3!==this._baseUnfavoredMergeDiff.get_mergeDiffType()||(n.val=t.val+this._baseUnfavoredMergeDiff.get_diffLengthBase())},e.prototype.FindNonGranularListIndex=function(e,t,n){if(n.val=0,!t)return!0;for(var r=0,i=0;r<e.get_length();){for(var a=null,s=r;s<e.get_length();s++){r=s;var l=(a=e.get_item(s)).get_length();if(!((i+=l)<t)){if(i>t){if(!a.get_supportsSplitIntoMoreGranularBlocks())return c.p.get_instance().traceTag(3993819,1,1,"ParagraphMerge:FindNonGranularListIndex: ParagraphMerge returned failure as we were unable to find index for [GranularListIndex: {0}] as the block could not be split",t),this._mergeState.logger.logMergeFailureDetail((0,o.m)(new v.h,{funcSource:"FindNonGranularListIndex",eventId:"appd1"})),!1;e.deleteAt(r),e.insertRange(r,a.splitIntoMoreGranularBlocks()),i-=l}break}}if(i===t)return r++,n.val=r,!0}return c.p.get_instance().traceTag(3993820,1,1,"ParagraphMerge:FindNonGranularListIndex: ParagraphMerge returned failure as we were unable to find index for [GranularListIndex: {0}]",t),this._mergeState.logger.logMergeFailureDetail((0,o.m)(new v.h,{funcSource:"FindNonGranularListIndex",eventId:"appd2"})),!1},e.prototype.ApplySyncDiffMetadataToUnfavoredDiff=function(e,t,n){var r=0,i=0,o=!1,a=this._baseUnfavoredMergeDiff.get_DiffBlocksFromUpdate().shallowClone();if(this._baseUnfavoredMergeDiff.CanCopyMetadataFromPreviousBlock())for(var s=t-1;s>=0;s--){var l=e.get_item(s);if(this._baseUnfavoredMergeDiff.IsMergeableTextBlock(l)){r=(c=e.get_item(s)).runId,i=c.paraId,o=!0;break}}if(!o)if((l=e.get_item(n))&&this._baseUnfavoredMergeDiff.IsMergeableTextBlock(l)){var u=l;r=u.runId,i=u.paraId}else r=0,i=0;for(s=0;s<a.get_length();s++){if((l=a.get_item(s)).isTextOrCharacterRun()){var c=l;this._baseUnfavoredMergeDiff.IsMergeableTextBlock(l)?(c.runId=r,c.paraId=i):(c.runId=0,c.paraId=0)}}return a},e.prototype.DoMergeInternal=function(){var e=this._baseFavoredMergeDiff.IsMergeDiffASyncDiffChange();if(!e&&!this._baseFavoredMergeDiff.get_mergeDiffType())return this._resultMergeBlocks=this._baseUnfavoredMergeDiff.get_updatedRevisionMergeBlocks().shallowClone(),this._paragraphIds=this.GetMergeDiffParagraphObjectIdOrdering(this._baseUnfavoredMergeDiff),!0;if(!this._baseUnfavoredMergeDiff.get_mergeDiffType())return this._resultMergeBlocks=this._baseFavoredMergeDiff.get_updatedRevisionMergeBlocks().shallowClone(),this._paragraphIds=this.GetMergeDiffParagraphObjectIdOrdering(this._baseFavoredMergeDiff),!0;if(!e){var t=this._baseFavoredMergeDiff.DoesDiffOverlap(this._baseUnfavoredMergeDiff);if(t&&this._featureEnableLookup(64)&&(c.p.get_instance().traceTag(17326359,1,2,"DoMergeInternal: Diff overlaps when we take formatting ids into account. Running another diff without formatting ids"),this._baseFavoredMergeDiff=new y(this._baseRevisionMergeBlocks,this._favoredRevisionMergeBlocks,!0,null,null,this._featureEnableLookup),this._baseUnfavoredMergeDiff=new y(this._baseRevisionMergeBlocks,this._unfavoredRevisionMergeBlocks,!0,null,null,this._featureEnableLookup),t=this._baseFavoredMergeDiff.DoesDiffOverlap(this._baseUnfavoredMergeDiff)),t)return c.p.get_instance().traceTag(3993821,1,2,"DoMergeInternal: We were unable to merge as there was an overlap in the changes in the 2 revisions"),this._mergeState.logger.logMergeFailureDetail((0,o.m)(new g.y,{funcSource:"ParagraphMerge",eventId:"appd3"})),!1}var n,r,i,s=0;this._paragraphIds=this.ComputeParagraphObjectIdOrdering(this._baseFavoredMergeDiff,this._baseUnfavoredMergeDiff),this.CalculateGranularListIndicesForUpdate(!1,(0,a.m)((function(){return n}),(function(e){return n=e})),(0,a.m)((function(){return r}),(function(e){return r=e})));var l=this._baseFavoredMergeDiff.get_updatedRevisionMergeBlocks().shallowClone();if(!this.FindNonGranularListIndex(l,n,(0,a.m)((function(){return i}),(function(e){return i=e}))))return!1;if((2===this._baseUnfavoredMergeDiff.get_mergeDiffType()||3===this._baseUnfavoredMergeDiff.get_mergeDiffType())&&!this.FindNonGranularListIndex(l,r,(0,a.m)((function(){return s}),(function(e){return s=e}))))return!1;if(2===this._baseUnfavoredMergeDiff.get_mergeDiffType()||3===this._baseUnfavoredMergeDiff.get_mergeDiffType()){this.SetBlockAsProofingRequired(l,s),this.SetBlockAsProofingRequired(l,i-1);for(var u=null,d=s-1;d>=i;d--)2===l.get_item(d).get_type()&&(u=l.get_item(d)),l.deleteAt(d);if(l.get_length()>0){var p=l.get_item(l.get_length()-1);2!==p.get_type()&&4!==p.get_type()&&u&&(this._mergeState.runtime.FeatureHelper.logUniqueFeatureUsage(84),this._mergeState.runtime.FeatureHelper.isFeatureEnabled(84)&&(l.add(u),this._paragraphIds.add(u.graphNodeId)))}c.p.get_instance().traceTag(4019726,1,3,"DoMergeInternal deleted [Length: {0}] merge blocks at [Index: {1}]",s-i-1,i)}if(1===this._baseUnfavoredMergeDiff.get_mergeDiffType()||3===this._baseUnfavoredMergeDiff.get_mergeDiffType()){var h=this._baseUnfavoredMergeDiff.get_DiffBlocksFromUpdate();e&&(h=this.ApplySyncDiffMetadataToUnfavoredDiff(l,i,s)),this.SetBlockAsProofingRequired(l,i-1),this.SetBlockAsProofingRequired(l,i),this.SetBlockAsProofingRequired(h,0),this.SetBlockAsProofingRequired(h,h.get_length()-1),l.insertRange(i,h),c.p.get_instance().traceTag(4019727,1,3,"DoMergeInternal: Inserted merge blocks at [Index: {0}] [Syncdiff merge: {1}] [Merge Blocks: {2}]",i,e,h.logString(" "))}return this._resultMergeBlocks=l,!0},e.prototype.SetBlockAsProofingRequired=function(e,t){if(!(t<0||t>=e.get_length())){var n=e.get_item(t);r.r(p.j,n)&&(n.isPendingProofing=!0)}},e.prototype.updateCpAccordingToIncomingChange=function(e,t,n,r){return n.val=e,r.val=t,!!this.Initialize()&&(this._baseUnfavoredMergeDiff.DoesDiffOverlap(this._baseFavoredMergeDiff)?(this.LogFailedParagraphMerge(!0),this._mergeState.logger.logMergeFailureDetail((0,o.m)(new g.y,{funcSource:"ParagraphMerge",info:"Is a CpMerge"})),!1):!this._baseUnfavoredMergeDiff.get_mergeDiffType()||3===this._baseUnfavoredMergeDiff.get_mergeDiffType()&&this._baseUnfavoredMergeDiff.IsMergeDiffReplaceAPureFormattingChange()?(r.val=t,!0):(this.CalculateGranularListIndicesForUpdate(!0,(0,a.m)((function(){return i}),(function(e){return i=e})),(0,a.m)((function(){return s}),(function(e){return s=e}))),t<i||t===i&&(1!==this._baseUnfavoredMergeDiff.get_mergeDiffType()||1===this._baseUnfavoredMergeDiff.get_mergeDiffType()&&1===this._baseFavoredMergeDiff.get_mergeDiffType()&&t===this._baseFavoredMergeDiff.get_diffIndex()+this._baseFavoredMergeDiff.get_diffLengthUpdate())?r.val=t:(r.val=t+this._baseUnfavoredMergeDiff.get_diffLengthUpdate()-this._baseUnfavoredMergeDiff.get_diffLengthBase(),r.val<i&&(r.val=i)),!0));var i,s},e}();(0,r.l)(C,"4f01bd2$ParagraphMerge",null,[i.v])},135:function(e,t,n){"use strict";n.r(t);var r=n(363),i=n(8192),o=n(6121),a=n(7597),s=n(423),l=(0,s.y)("924469ff$IOfflineLogger"),u=function(){function e(){}return e.prototype.listenNextTag=function(e,t,n){},e.prototype.init=function(){},e.prototype.dispose=function(){},e}();(0,s.l)(u,"2f33fce7$NoOpOfflineLogger",null,[l,Sys.IDisposable]);var c=n(9017),d=n(1822),p=n(1614),g=n(6720),h=n(4993),_=n(5398),f=n(824),m=function(){function e(){}return e.anyTag=0,e}();(0,s.l)(m,"4bb4005b$OfflineLoggerConstants",null,[]);var y=n(2879),v=function(){function e(e,t,n,r,i){this._clientRequestManager=null,this._isNetworkDisconnected=!1,this._offlineStorage=null,this._manifest=null,this._currentOffset=0,this._lastOfflineLogEnd=0,this._currentOfflineLogEnd=0,this._resendTask=null,this._taskManager=null,this._ulsHostHook=null,this._sessionId=null,this._listeningLogTags=null,this._logCache=null,this._disposed=!1,this._offlineStorage=n,this._ulsHostHook=r,this._sessionId=i,this._clientRequestManager=t,this._taskManager=e}return e.prototype.init=function(){this.SetupHook(),this.LoadManifest(),this._isNetworkDisconnected=!1,this._clientRequestManager.addNetworkConnectivityListener(this),this._resendTask=new y.c(3,2,e.TaskIntervalInMs,s.i(this,this.SendOfflineLogs,"SendOfflineLogs"),104,null,!1),this._taskManager.addTask(this._resendTask)},e.prototype.BuildKey=function(t){return e.LogKeyPrefix+t},e.prototype.LoadManifest=function(){var t=this._offlineStorage.getItem(e.ManifestKey);!isNullOrUndefined(t)&&t.length>0&&(this._manifest=e.TryParseString(t)),this._manifest||(this._manifest={}),isNullOrUndefined(this._manifest[e.EndKey])&&(this._manifest[e.EndKey]=0),isNullOrUndefined(this._manifest[e.OffsetKey])&&(this._manifest[e.OffsetKey]=0),this._currentOffset=this._manifest[e.OffsetKey],isFinite(this._currentOffset)||(this._currentOffset=0),this._lastOfflineLogEnd=this._manifest[e.EndKey],isFinite(this._lastOfflineLogEnd)||(this._lastOfflineLogEnd=0),this._currentOfflineLogEnd=this._lastOfflineLogEnd},e.prototype.SetupHook=function(){this._listeningLogTags=new h.w(Boolean),this._logCache=new p.u(g.c.$$(f.i)),this._ulsHostHook.add_onBeforeUlsSent(s.i(this,this.OnUlsReadyToBeSent,"OnUlsReadyToBeSent")),this._ulsHostHook.add_onUlsSentSuccessful(s.i(this,this.OnUlsSentSuccessfully,"OnUlsSentSuccessfully")),this._ulsHostHook.add_onUlsSentFailed(s.i(this,this.OnUlsSentFailed,"OnUlsSentFailed")),this._ulsHostHook.add_onAfterDisposed(s.i(this,this.OnAfterUlsHostDisposed,"OnAfterUlsHostDisposed"))},e.prototype.OnUlsReadyToBeSent=function(e,t){if(!isNullOrUndefined(t)&&!isNullOrUndefined(t.args)){var n=!1;if(!this._listeningLogTags.containsKey(t.args.tag)){if(!this._listeningLogTags.containsKey(m.anyTag))return;n=!0}this._listeningLogTags.remove(n?m.anyTag:t.args.tag),this._logCache.containsKey(t.uploadId)||this._logCache.set_item(t.uploadId,new g.c(f.i)),this._logCache.get_item(t.uploadId).add(t.args)}},e.prototype.OnUlsSentSuccessfully=function(e,t){this._logCache.remove(t.uploadId)},e.prototype.OnUlsSentFailed=function(t,n){if(!isNullOrUndefined(n)&&this._logCache.containsKey(n.uploadId))for(var r=this._logCache.get_item(n.uploadId),i=0,o=r.get_count();i<o;++i){var a=e.Serialize(r.get_item(i),this._sessionId);this.TrySetItem(this.BuildKey(this._currentOfflineLogEnd++),a)}},e.prototype.OnAfterUlsHostDisposed=function(e,t){this.dispose()},e.prototype.TrySetItem=function(e,t){try{return this._offlineStorage.setItem(e,t),!0}catch(e){return a.ULS.sendTraceTag(18614232,222,15,"OfflineLogger SetItem failed with exception: {0}",e.message),!1}},e.prototype.SendOfflineLogs=function(t){if(!this._isNetworkDisconnected){var n,r=this._currentOffset,i=new g.c(f.i),o=null,s=function(){var t,r=l.BuildKey(n),s=l._offlineStorage.getItem(r);if(l._offlineStorage.removeItem(r),isNullOrUndefined(s))return"continue";var u=e.Deserialize(s,(0,d.m)((function(){return t}),(function(e){return t=e})));if(!u)return a.ULS.sendTraceTag(18614233,222,15,"Unable to deserialze the offline log: {0}",s),"continue";if(o){if(t!==o)return"break"}else o=t;i.add(u)},l=this;for(n=r;n<this._lastOfflineLogEnd&&i.get_count()<=e.MaxLogToSendAtOneTime;++n){if("break"===s())break}i.get_count()>0&&this._ulsHostHook.resendLogWithNewSessionId(this,_.Enumerable.toArray(f.i,i),o,null,0,null),this._currentOffset=r=n,r>=this._lastOfflineLogEnd&&(this._taskManager.deleteTask(this._resendTask),this._resendTask=null)}},e.prototype.listenNextTag=function(e,t,n){!this._disposed&&a.ULS.shouldTrace(t,n)&&this._listeningLogTags.set_item(e,!0)},e.prototype.dispose=function(){if(this._disposed)this._disposed=!0;else{this._resendTask&&this._taskManager.deleteTask(this._resendTask);var t=_.Enumerable.toArray(Number,this._logCache.get_keys());t.sort();for(var n=0,r=t;n<r.length;n++)for(var i=r[n],o=this._logCache.get_item(i),a=0,s=o.get_count();a<s;++a){var l=e.Serialize(o.get_item(a),this._sessionId);this.TrySetItem(this.BuildKey(this._currentOfflineLogEnd++),l)}this._currentOffset<this._currentOfflineLogEnd?(this._manifest[e.EndKey]=this._currentOfflineLogEnd,this._manifest[e.OffsetKey]=this._currentOffset,this.TrySetItem(e.ManifestKey,JSON.stringify(this._manifest))):this._offlineStorage.removeItem(e.ManifestKey),this._disposed=!0}},e.prototype.networkDisconnected=function(){this._isNetworkDisconnected=!0},e.prototype.networkResumed=function(){this._isNetworkDisconnected=!1},e.Serialize=function(t,n){var r={};return r[e.TagIdStr]=t.tag,r[e.CategoryStr]=t.category,r[e.LevelStr]=t.level,r[e.MessageStr]=t.message,r[e.LogTypeStr]=t.logType,r[e.SessionStr]=n,r[e.TimestampStr]=t.timestamp,JSON.stringify(r)},e.Deserialize=function(t,n){var r=e.TryParseString(t);if(!r)return n.val=null,null;var i=new f.i(r[e.TimestampStr],r[e.CategoryStr],r[e.TagIdStr],r[e.LevelStr],r[e.MessageStr],r[e.LogTypeStr]);return n.val=r[e.SessionStr],i},e.TryParseString=function(e){try{return JSON.parse(e)}catch(e){a.ULS.sendTraceTag(18614234,222,10,"OfflineLogger TryParseString failed with exception: {0}",e.message)}return null},e.ManifestKey="OfflineLoggerManifest",e.LogKeyPrefix="OfflineLog|",e.EndKey="end",e.OffsetKey="offset",e.MaxLogToSendAtOneTime=5,e.TaskIntervalInMs=2500,e.TagIdStr="t",e.CategoryStr="c",e.LevelStr="l",e.MessageStr="m",e.SessionStr="s",e.LogTypeStr="lt",e.TimestampStr="ts",e}();(0,s.l)(v,"ebec8301$OfflineLoggerImpl",null,[l,Sys.IDisposable,c.d]);var S=function(){return function(e,t,n,r){this.sessionId=null,this.version=null,this.attempt=0,this.logs=null,this.originalUploadId=0,this.sessionId=e,this.version=t,this.attempt=n,this.originalUploadId=r,this.logs=new g.c(f.i)}}();(0,s.l)(S,"baeafbe3$CachedLogUpload",null,[]);var I=function(){return function(e){this.t=e.tag,this.c=e.category,this.l=e.level,this.m=e.message,this.lt=e.logType,this.ts=e.timestamp}}();(0,s.l)(I,"af1c549c$LoggingArgsLocalStorage",null,[]);var C=function(){function e(){}return e.toLoggingArgs=function(e){return isNullOrUndefined(e)?null:new f.i(e.ts,e.c,e.t,e.l,e.m,e.lt)},e}();(0,s.l)(C,"105bdf36$LoggingArgsLocalStorageExtensions",null,[]);var T=function(){return function(e,t,n,r,i){this.t=e,this.s=t,this.v=n,this.i=r,this.a=i,this.op="Log"}}();(0,s.l)(T,"7f64f0ac$LoggingKeyLocalStorage",null,[]);var b=n(9641),A=function(){function e(){}return e.isValidKeyForApp=function(e,t){return!isNullOrUndefined(e)&&!isNullOrUndefined(e.i)&&!isNullOrUndefined(e.t)&&!isNullOrUndefined(e.s)&&"Log"===e.op&&e.t===t&&isFinite(e.t)&&b.l.isValid(e.s)},e}();(0,s.l)(A,"7c6f3ec6$LoggingKeyLocalStorageExtensions",null,[]);var M=n(2575),P=function(){function e(e,t,n,r,i,o,a,s,l,u){this._loggedAttemptToSendLogsFromThisSession=!1,this._loggedAttemptToSendLogsFromOtherSession=!1,this._loggedThatWeCachedLogs=!1,this._isSendOfflineLogsV2ImprovementEnabled=!1,this._clientRequestManager=null,this._officeAppType=0,this._isNetworkDisconnected=!1,this._listenForAllMonitorableLogs=!1,this._offlineStorage=null,this._resendTask=null,this._taskManager=null,this._ulsHostHook=null,this._sessionId=null,this._retentionPeriodInDays=0,this._maxAttempts=0,this._keysToSendFromThisSession=null,this._keysToSendFromOtherSessions=null,this.manifest=null,this.listeningLogTags=null,this.logCache=null,this._disposed=!1,this._keysToSendFromThisSession=new Array(0),this._keysToSendFromOtherSessions=new Array(0),this._offlineStorage=n,this._ulsHostHook=r,this._sessionId=i,this._clientRequestManager=t,this._taskManager=e,this._officeAppType=o,this._retentionPeriodInDays=a,this._maxAttempts=s,this._listenForAllMonitorableLogs=l,this._isSendOfflineLogsV2ImprovementEnabled=u}return e.prototype.get_manifest=function(){return this.manifest},e.prototype.get_listeningLogTags=function(){return this.listeningLogTags},e.prototype.get_logCache=function(){return this.logCache},e.prototype.init=function(){this.SetupHook(),this._isNetworkDisconnected=!1,this._clientRequestManager.addNetworkConnectivityListener(this),this._resendTask=new y.c(3,1,e.TaskIntervalInMs,s.i(this,this.DetermineLogsToSendAtBoot,"DetermineLogsToSendAtBoot"),103,null,!1),this._taskManager.addTask(this._resendTask)},e.prototype.DetermineLogsToSendAtBoot=function(e){this.DetermineLogsToSend(!0)},e.prototype.DetermineLogsToSendOnReconnect=function(e){this.DetermineLogsToSend(!1)},e.prototype.DetermineLogsToSend=function(t){this.EnsureTaskCleared(),this._keysToSendFromThisSession=new Array(0),t&&(this._keysToSendFromOtherSessions=new Array(0));for(var n=0;n<this._offlineStorage.get_length();n++){var r=this._offlineStorage.key(n),i=e.TryParseString(T,r,!1);A.isValidKeyForApp(i,this._officeAppType)&&(i.s===this._sessionId?Array.add(this._keysToSendFromThisSession,r):t&&Array.add(this._keysToSendFromOtherSessions,r))}if(this._keysToSendFromThisSession.length||t&&this._keysToSendFromOtherSessions.length){var o=null;o=this._isSendOfflineLogsV2ImprovementEnabled?s.i(this,this.SortDescendKeysToUpload,"SortDescendKeysToUpload"):s.i(this,this.SortKeysToUpload,"SortKeysToUpload"),this._keysToSendFromThisSession.sort(o),t&&this._keysToSendFromOtherSessions.sort(o),(this._keysToSendFromThisSession.length>0||this._keysToSendFromOtherSessions.length>0)&&(this._resendTask=new y.c(3,2,e.TaskIntervalInMs,s.i(this,this.SendOfflineLogs,"SendOfflineLogs"),105,null,!1),this._taskManager.addTask(this._resendTask))}},e.prototype.SortKeysToUpload=function(e,t){var n=e,r=e;return n.s!==r.s?n.s.localeCompare(r.s):n.i-r.i},e.prototype.SortDescendKeysToUpload=function(e,t){var n=e,r=e;return n.s!==r.s?n.s.localeCompare(r.s):r.i-n.i},e.prototype.BuildKey=function(e,t,n,r){return JSON.stringify(new T(this._officeAppType,t,n,e,r))},e.prototype.SetupHook=function(){this.listeningLogTags=new h.w(Boolean),this.logCache=new p.u(S),this._ulsHostHook.add_onBeforeUlsSent(s.i(this,this.OnUlsReadyToBeSent,"OnUlsReadyToBeSent")),this._ulsHostHook.add_onUlsSentSuccessful(s.i(this,this.OnUlsSentSuccessfully,"OnUlsSentSuccessfully")),this._ulsHostHook.add_onUlsSentFailed(s.i(this,this.OnUlsSentFailed,"OnUlsSentFailed")),this._ulsHostHook.add_onAfterDisposed(s.i(this,this.OnAfterUlsHostDisposed,"OnAfterUlsHostDisposed"))},e.prototype.OnUlsReadyToBeSent=function(e,t){if(!isNullOrUndefined(t)&&!isNullOrUndefined(t.args)){if(this.get_listeningLogTags().containsKey(t.args.tag))this.get_listeningLogTags().remove(t.args.tag);else if(this.get_listeningLogTags().containsKey(m.anyTag))this.get_listeningLogTags().remove(m.anyTag);else if(!(this._listenForAllMonitorableLogs&&t.args.level<50))return;var n;this.get_logCache().tryGetValue(t.uploadId,(0,d.m)((function(){return n}),(function(e){return n=e})))||(n=new S(t.sessionId,t.version,t.attempt,t.originalUploadId),this.get_logCache().set_item(t.uploadId,n)),this.get_logCache().get_item(t.uploadId).logs.add(t.args)}},e.prototype.OnUlsSentSuccessfully=function(e,t){this.get_logCache().remove(t.uploadId)},e.prototype.OnUlsSentFailed=function(e,t){!isNullOrUndefined(t)&&this.get_logCache().containsKey(t.uploadId)&&(this.MoveCachedLogsToLocalStorage(t.uploadId)&&!this._loggedThatWeCachedLogs&&(this._loggedThatWeCachedLogs=!0,a.ULS.sendTraceTag(37290073,222,50,"Added logs to local storage.")))},e.prototype.MoveCachedLogsToLocalStorage=function(t){var n,r=!1;if(this.get_logCache().tryGetValue(t,(0,d.m)((function(){return n}),(function(e){return n=e})))&&n&&n.logs.get_count()>0){if(n.attempt>=this._maxAttempts)return!1;for(var i=n.logs,o=new Array(i.get_count()),a=0,s=i.get_count();a<s;++a)o[a]=new I(i.get_item(a));var l=e.Serialize(o),u=this.BuildKey(n.originalUploadId,n.sessionId,n.version,n.attempt);this.TrySetItem(u,l)&&(this.get_logCache().remove(t),r=!0)}return r},e.prototype.OnAfterUlsHostDisposed=function(e,t){this.dispose()},e.prototype.TrySetItem=function(e,t){try{return this._offlineStorage.setItem(e,t),!0}catch(e){return a.ULS.sendTraceTag(37290074,222,15,"OfflineLogger SetItem failed with exception: {0}",e.message),!1}},e.prototype.SendOfflineLogs=function(t){if(!this._isNetworkDisconnected){var n=this._keysToSendFromThisSession.length>0?this._keysToSendFromThisSession:this._keysToSendFromOtherSessions,r=n.length;if(r)for(;r>0;){M.AFrameworkApplication.logUniqueFlightedSettingUsage("Microsoft.Office.Web.SessionSettings.IWacWordSendOfflineLogsV2ImprovementSettings"),r--;var i=this._isSendOfflineLogsV2ImprovementEnabled?n.pop():n[0];this._isSendOfflineLogsV2ImprovementEnabled||Array.removeAt(n,0);var o=e.TryParseString(T,i,!0);if(A.isValidKeyForApp(o,this._officeAppType)){var s=this._offlineStorage.getItem(i);if(this._offlineStorage.removeItem(i),!isNullOrUndefined(s))if(o.a>this._maxAttempts)a.ULS.sendTraceTag(37290075,222,50,"Log has more attempt {0} than the max allowed {1}.",o.a,this._maxAttempts);else{var l=e.TryParseString(Array,s,!0);if(!isNullOrUndefined(l)&&isFinite(l.length))if(l.length){var u=l[l.length-1],c=(new Date).getTime()-u.ts;if(c<-e.timePerDayInMs)a.ULS.sendTraceTag(37290078,222,50,"Log came from more than a day in the future.  Let's throw it away and not trust it. {0}",u.ts);else{if(!(c>this._retentionPeriodInDays*e.timePerDayInMs)){o.s===this._sessionId?this._loggedAttemptToSendLogsFromThisSession||(this._loggedAttemptToSendLogsFromThisSession=!0,a.ULS.sendTraceTag(37290080,222,50,"Attempted to re-send logs from this session.")):this._loggedAttemptToSendLogsFromOtherSession||(this._loggedAttemptToSendLogsFromOtherSession=!0,a.ULS.sendTraceTag(37290081,222,50,"Attempted to re-send logs from another session {0}.",o.s));for(var d=new Array(l.length),p=0;p<l.length;p++)d[p]=C.toLoggingArgs(l[p]);this._ulsHostHook.resendLogWithNewSessionId(this,d,o.s,o.v,o.a+1,o.i);break}a.ULS.sendTraceTag(37290079,222,50,"Log is older than our retention period of {0} days.  Throwing it away. {1}",this._retentionPeriodInDays,u.ts)}}else a.ULS.sendTraceTag(37290077,222,15,"Deserialize an empty array from local storage: {0}",s);else a.ULS.sendTraceTag(37290076,222,15,"Unable to deserialize the offline log: {0}",s)}}}else this.EnsureTaskCleared()}},e.prototype.listenNextTag=function(e,t,n){!this._disposed&&a.ULS.shouldTrace(t,n)&&this.get_listeningLogTags().set_item(e,!0)},e.prototype.dispose=function(){if(this._disposed)this._disposed=!0;else{this._resendTask&&this._taskManager.deleteTask(this._resendTask);for(var e=0,t=_.Enumerable.toArray(Number,this.get_logCache().get_keys());e<t.length;e++){var n=t[e];this.MoveCachedLogsToLocalStorage(n)}this._disposed=!0}},e.prototype.networkDisconnected=function(){this._isNetworkDisconnected=!0,this.EnsureTaskCleared()},e.prototype.networkResumed=function(){this._isNetworkDisconnected=!1,this.EnsureTaskCleared(),this._resendTask&&this._taskManager.deleteTask(this._resendTask),this._resendTask=new y.c(3,1,e.TaskIntervalInMs,s.i(this,this.DetermineLogsToSendOnReconnect,"DetermineLogsToSendOnReconnect"),102,null,!1),this._taskManager.addTask(this._resendTask)},e.prototype.EnsureTaskCleared=function(){this._resendTask&&(this._taskManager.deleteTask(this._resendTask),this._resendTask=null)},e.Serialize=function(e){return JSON.stringify(e)},e.TryParseString=function(e,t,n){try{return JSON.parse(t)}catch(e){n&&a.ULS.sendTraceTag(37290082,222,10,"OfflineLogger TryParseString failed with exception: {0}",e.message)}return null},e.TaskIntervalInMs=2500,e.timePerDayInMs=864e5,e}();(0,s.l)(P,"3361c7e5$OfflineLoggerImplV2",null,[l,Sys.IDisposable,c.d]);var F=(0,s.y)("b5dc8fd$IOfflineStorage"),w=function(){function e(){localStorage.getItem("{CBEDE940-2407-4B58-BA27-B8CBF0B0DDE6}{5}")}return e.prototype.get_length=function(){try{return localStorage.length}catch(e){return this.HandleError("Length",e),-1}},e.prototype.key=function(e){try{return localStorage.key(e)}catch(e){return this.HandleError("Key",e),null}},e.prototype.getItem=function(e){try{return localStorage.getItem(e)}catch(e){return this.HandleError("GetItem",e),null}},e.prototype.setItem=function(e,t){try{return localStorage.setItem(e,t)}catch(e){return this.HandleError("SetItem",e),null}},e.prototype.removeItem=function(e){try{localStorage.removeItem(e)}catch(e){this.HandleError("RemoveItem",e)}},e.prototype.clear=function(){try{localStorage.clear()}catch(e){this.HandleError("Clear",e)}},e.prototype.HandleError=function(e,t){a.ULS.sendTraceTag(19170128,222,10,"Invoking localStorage function[{0}] failed, message: {1}",e,t.message)},e}();(0,s.l)(w,"7971974$OfflineStorage",null,[F]);var R=function(){function e(){}return e.prototype.create=function(e){var t,n=null;try{isNullOrUndefined(localStorage)||(n=new w)}catch(e){a.ULS.sendTraceTag(18641093,222,50,"window.localStorage is not accessable: {0}",e.message)}return Object.getType(a.ULS.get_host()).implementsInterface(o.r)&&n||(a.ULS.sendTraceTag(18614230,222,50,"OfflineLogger is not supported: offline storage is {0}, ULS host hook is {1}",n?"supported":"not supported",Object.getType(a.ULS.get_host()).implementsInterface(o.r)?"supported":"not supported"),e=0),(t=1===e?new v(M.AFrameworkApplication.get_theTaskManager(),M.AFrameworkApplication.theClientRequestManager,n,a.ULS.get_host(),M.AFrameworkApplication.userSessionId):2===e?new P(M.AFrameworkApplication.get_theTaskManager(),M.AFrameworkApplication.theClientRequestManager,n,a.ULS.get_host(),M.AFrameworkApplication.userSessionId,M.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_officeAppType(),M.AFrameworkApplication.appSettingsManager.getIntAppSetting("OfflineLoggerRetentionInDays",30),M.AFrameworkApplication.appSettingsManager.getIntAppSetting("OfflineLoggerMaxAttempts",5),M.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OfflineLoggerListenForAllMonitorableLogsIsEnabled"),M.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SendOfflineLogsV2ImprovementIsEnabled")):new u).init(),t},e}();(0,s.l)(R,"dc8664ad$OfflineLoggerFactory",null,[]);var E=function(){function e(){}return e.prototype.configure=function(e){},e.prototype.get_name=function(){return"Common.App.OfflineLogger"},e.prototype.init=function(){var e=M.AFrameworkApplication.appSettingsManager,t=0;e.getBooleanAppSetting("OneNoteOfflineLoggerIsEnabled")?t=1:e.getBooleanAppSetting("OfflineLoggerV2IsEnabled")&&(t=2),t&&(M.AFrameworkApplication.theOfflineLogger=(new R).create(t))},e.prototype.dispose=function(){},e}();(0,s.l)(E,"39c2cae3$OfflineLoggerPackage",null,[r.u,i.s]);var k=n(1526);n.d(t,{PackageManager:function(){return D}});var D=function(){function e(){}return e.main=function(){k.o.get_instance().registerPackage(new E,0,!1)},e}();(0,s.l)(D,"45b48945$PackageManager",null,[])},294:function(e,t,n){"use strict";n.d(t,{u:function(){return a}});var r=n(423),i=n(3362),o=n(7518),a=function(){function e(e,t,n){this.propertyDefinition=null,this.oldValue=null,this.newValue=null,this._isDifferent=null,this.propertyDefinition=e,this.oldValue=t,this.newValue=n,this._isDifferent=new i.q(Boolean,r.i(this,this.CheckIfDifferent,"CheckIfDifferent"))}return e.prototype.get_propertyDefinition=function(){return this.propertyDefinition},e.prototype.get_oldValue=function(){return this.oldValue},e.prototype.get_newValue=function(){return this.newValue},e.prototype.get_isAdded=function(){return!isNullOrUndefined(this.get_newValue())&&isNullOrUndefined(this.get_oldValue())},e.prototype.get_isDeleted=function(){return isNullOrUndefined(this.get_newValue())&&!isNullOrUndefined(this.get_oldValue())},e.prototype.get_isDifferent=function(){return this.get_isAdded()||this.get_isDeleted()||this._isDifferent.get_value()},e.prototype.CheckIfDifferent=function(){return!(!this.get_isAdded()&&!this.get_isDeleted())||!o.d.areValuesEqual(this.get_propertyDefinition(),this.get_oldValue(),this.get_newValue())},e}();(0,r.l)(a,"ed9875ce$PropertyDiff",null,[])},342:function(e,t,n){"use strict";n.d(t,{q:function(){return f}});var r=n(3545),i=n(389),o=n(1822),a=n(3290),s=n(4455),l=n(2506),u=n(9154),c=n(5479),d=n(8540),p=n(7518),g=n(9168),h=n(3362),_=n(423),f=function(e){function t(){return e.call(this,null)||this}return(0,r.t)(t,e),t.prototype.get_complexMergerType=function(){return 20},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(s.b.richEditTextUnicode),1),t.set_item(p.d.toPropertyId(s.b.textRunFormatting),1),t.set_item(p.d.toPropertyId(s.b.textRunIndex),1),t.set_item(p.d.toPropertyId(l.j.newlyTypedRuns),1),t.set_item(p.d.toPropertyId(l.j.paraIds),1),t.set_item(p.d.toPropertyId(l.j.runIds),1),t.set_item(p.d.toPropertyId(l.j.wordId),1),t.set_item(p.d.toPropertyId(s.b.spellErrorRuns),1),t.set_item(p.d.toPropertyId(l.j.grammarErrorRuns),1),t.set_item(p.d.toPropertyId(l.j.proofingErrorHints),1),t.set_item(p.d.toPropertyId(s.b.notProofedRuns),1),t.set_item(p.d.toPropertyId(l.j.insertedTrackedChangesRuns),1),t.set_item(p.d.toPropertyId(l.j.deletedTrackedChangesRuns),1),t.set_item(p.d.toPropertyId(l.j.insertedTrackedChangesRunsAuthors),1),t.set_item(p.d.toPropertyId(l.j.deletedTrackedChangesRunsAuthors),1),t.set_item(p.d.toPropertyId(l.j.insertedTrackedChangesRunsTimestamps),1),t.set_item(p.d.toPropertyId(l.j.deletedTrackedChangesRunsTimestamps),1),t.set_item(p.d.toPropertyId(l.j.previousRunFormattingIsTracked),1),t.set_item(p.d.toPropertyId(l.j.trackedPreviousRunFormattingAuthors),1),t.set_item(p.d.toPropertyId(l.j.trackedPreviousRunFormattingTimestamps),1),t.set_item(p.d.toPropertyId(l.j.trackedPreviousRunFormatting),1),t.set_item(p.d.toPropertyId(l.j.changeIds),1),t.set_item(p.d.toPropertyId(u.p.lockId),6),t.set_item(p.d.toPropertyId(u.p.wetChangeLockId),6),t.set_item(p.d.toPropertyId(l.j.clearFormattingFierce),7),t.set_item(p.d.toPropertyId(u.p.lockId),6),t.set_item(p.d.toPropertyId(l.j.skippedRunIds),2),t.set_item(p.d.toPropertyId(u.p.containsInsertedTrackedChange),2),t.set_item(p.d.toPropertyId(u.p.paragraphContainsDeletedTrackedChanges),2),t.set_item(p.d.toPropertyId(l.j.trackedPreviousEndOfParagraphFormatting),2),t.set_item(p.d.toPropertyId(l.j.trackedPreviousEndOfParagraphFormattingAuthor),2),t.set_item(p.d.toPropertyId(l.j.trackedPreviousEndOfParagraphFormattingTimestamp),2),t.set_item(p.d.toPropertyId(l.j.trackedPreviousParagraphProperties),2),t.set_item(p.d.toPropertyId(l.j.trackedPreviousParagraphPropertiesAuthor),2),t.set_item(p.d.toPropertyId(l.j.trackedPreviousParagraphPropertiesTimeStamp),2),t},t.prototype.tryMergeCustomProperty=function(e,n){if(n===p.d.toPropertyId(s.b.richEditTextUnicode)||n===p.d.toPropertyId(s.b.textRunFormatting)||n===p.d.toPropertyId(s.b.textRunIndex)||n===p.d.toPropertyId(l.j.newlyTypedRuns)||n===p.d.toPropertyId(l.j.paraIds)||n===p.d.toPropertyId(l.j.runIds)||n===p.d.toPropertyId(l.j.wordId)||n===p.d.toPropertyId(s.b.spellErrorRuns)||n===p.d.toPropertyId(l.j.grammarErrorRuns)||n===p.d.toPropertyId(l.j.proofingErrorHints)||n===p.d.toPropertyId(s.b.notProofedRuns)||n===p.d.toPropertyId(l.j.insertedTrackedChangesRuns)||n===p.d.toPropertyId(l.j.deletedTrackedChangesRuns)||n===p.d.toPropertyId(l.j.insertedTrackedChangesRunsAuthors)||n===p.d.toPropertyId(l.j.deletedTrackedChangesRunsAuthors)||n===p.d.toPropertyId(l.j.insertedTrackedChangesRunsTimestamps)||n===p.d.toPropertyId(l.j.deletedTrackedChangesRunsTimestamps)||n===p.d.toPropertyId(l.j.previousRunFormattingIsTracked)||n===p.d.toPropertyId(l.j.trackedPreviousRunFormattingAuthors)||n===p.d.toPropertyId(l.j.trackedPreviousRunFormattingTimestamps)||n===p.d.toPropertyId(l.j.trackedPreviousRunFormatting)||n===p.d.toPropertyId(l.j.changeIds)){var r=e.baseConflictDiffLazy.get_value().get_oldObject(),a=e.baseConflictDiffLazy.get_value().get_newObject(),u=e.baseFavoredDiffLazy.get_value().get_newObject();if(e.mergeState.runtime.ChildMergeSkippableIds.contains(r.get_id()))return d.p.get_instance().traceTag(18989579,1,3,"ParagraphNodeComplexMerge: Skipping merge for [Paragraph: {0}] as it was already merged during ChildNodeListMerge.",r.get_id()),!0;var g=new c.o(i.v,null);g.add(r);var h=new c.o(i.v,null);h.add(a);var _,f=new c.o(i.v,null);return f.add(u),t.tryParagraphMerge(e.mergeState,g,f,h,(0,o.m)((function(){return _}),(function(e){return _=e})))?(e.mergedProperties.add(p.d.toPropertyId(s.b.richEditTextUnicode)),e.mergedProperties.add(p.d.toPropertyId(s.b.textRunFormatting)),e.mergedProperties.add(p.d.toPropertyId(s.b.textRunIndex)),e.mergedProperties.add(p.d.toPropertyId(l.j.paraIds)),e.mergedProperties.add(p.d.toPropertyId(l.j.newlyTypedRuns)),e.mergedProperties.add(p.d.toPropertyId(l.j.runIds)),e.mergedProperties.add(p.d.toPropertyId(l.j.wordId)),e.mergedProperties.add(p.d.toPropertyId(s.b.spellErrorRuns)),e.mergedProperties.add(p.d.toPropertyId(l.j.grammarErrorRuns)),e.mergedProperties.add(p.d.toPropertyId(l.j.proofingErrorHints)),e.mergedProperties.add(p.d.toPropertyId(s.b.notProofedRuns)),e.mergedProperties.add(p.d.toPropertyId(l.j.insertedTrackedChangesRuns)),e.mergedProperties.add(p.d.toPropertyId(l.j.deletedTrackedChangesRuns)),e.mergedProperties.add(p.d.toPropertyId(l.j.insertedTrackedChangesRunsAuthors)),e.mergedProperties.add(p.d.toPropertyId(l.j.deletedTrackedChangesRunsAuthors)),e.mergedProperties.add(p.d.toPropertyId(l.j.insertedTrackedChangesRunsTimestamps)),e.mergedProperties.add(p.d.toPropertyId(l.j.deletedTrackedChangesRunsTimestamps)),e.mergedProperties.add(p.d.toPropertyId(l.j.previousRunFormattingIsTracked)),e.mergedProperties.add(p.d.toPropertyId(l.j.trackedPreviousRunFormattingAuthors)),e.mergedProperties.add(p.d.toPropertyId(l.j.trackedPreviousRunFormattingTimestamps)),e.mergedProperties.add(p.d.toPropertyId(l.j.trackedPreviousRunFormatting)),e.mergedProperties.add(p.d.toPropertyId(l.j.changeIds)),e.mergedObject=_.getItemAt(0).mergeableObject,!0):(e.wasNodeLogged=!0,e.mergedObject=null,!1)}return!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t.tryParagraphMerge=function(e,t,n,r,i){return new g.o(e,t,n,r,null,null,null,null).tryDoMerge(i)},t._instance=new h.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(a.s);(0,_.l)(f,"91b0a0a2$ParagraphNodeComplexMerge",a.s,[])},361:function(e,t,n){"use strict";n.r(t);var r=n(5354),i=n(4105),o=n(363),a=n(8192),s=n(3362),l=n(423),u=(0,l.y)("533c39f5$IDocChatClient"),c=n(127),d=n(7597),p=n(4304),g=n(4072),h=function(){function e(e,t){this._chatClientFactory=null,this._chatClientFactoryTask=null,this._readyTcs=null,this._basicChatClient=null,this._stopwatchBuilder=null,this._joinChatThreadStopwatch=null,this._chatThreadJoined=!1,this._chatThreadDisconnected=!1,this._eventSource=new g.f,this._chatClientFactoryTask=e,this._stopwatchBuilder=t}return e.prototype.get_joinChatThreadStopwatch=function(){return this._joinChatThreadStopwatch},e.prototype.add_availabilityChanged=function(t){this._eventSource.addHandler(e.AvailabilityChangedEventKey,t)},e.prototype.remove_availabilityChanged=function(t){this._eventSource.removeHandler(e.AvailabilityChangedEventKey,t)},e.prototype.ready=function(){var t=this;return this._readyTcs?this._readyTcs.get_task():(this._readyTcs=new c.z(Boolean),this._chatClientFactoryTask.CW((function(n){t._chatClientFactory=t._chatClientFactoryTask.get_result(),t._basicChatClient=t._chatClientFactory.create(l.i(t,t.OnClientAvailabilityChanged,"OnClientAvailabilityChanged")),t._basicChatClient.init(),t._basicChatClient.add_paneStateChanged((function(n,r){t._eventSource.raiseEvent(e.PaneStateChangedEventKey,r,null)})),t._basicChatClient.add_unreadConversationsChanged((function(n,r){t._eventSource.raiseEvent(e.UnreadConversationsChangedEventKey,r,null)}))})),this._readyTcs.get_task())},e.prototype.OnClientAvailabilityChanged=function(t,n){var r=2===n.get_clientState()||4===n.get_clientState()||5===n.get_clientState();!this._readyTcs.get_task().get_isCompleted()&&r&&this._readyTcs.trySetResult(!0),this._chatThreadDisconnected=this._chatThreadJoined&&2!==n.get_clientState()&&5!==n.get_clientState(),this._chatThreadJoined=this._chatThreadJoined&&!this._chatThreadDisconnected,this._eventSource.raiseEvent(e.AvailabilityChangedEventKey,new p.e(r,this._chatThreadDisconnected),null)},e.prototype.add_unreadConversationsChanged=function(t){this._eventSource.addHandler(e.UnreadConversationsChangedEventKey,t)},e.prototype.remove_unreadConversationsChanged=function(t){this._eventSource.removeHandler(e.UnreadConversationsChangedEventKey,t)},e.prototype.get_paneState=function(){return this._basicChatClient.get_chatPaneVisible()?1:0},e.prototype.joinConversation=function(e,t,n,r){var i=this;if(e){this._joinChatThreadStopwatch=this._stopwatchBuilder.makeStopwatch("ServerNotification","JoinSkypeChatThreadClient");this._joinChatThreadStopwatch.start(),this._basicChatClient.joinConversation(e.get_chatThreadId(),(function(){i.get_joinChatThreadStopwatch().stop(),i._chatThreadJoined=!0,i._chatThreadDisconnected=!1,t()}),(function(){i.get_joinChatThreadStopwatch().stop(),i._chatThreadJoined=!1,i._chatThreadDisconnected=!1,n()}),r,e.get_chatThreadDiscoveryUri())}else d.ULS.sendTraceTag(18200789,333,10,"Unexpected attempt to join doc chat without any chat thread info!")},e.prototype.hideDocChatPane=function(){this._basicChatClient.hideChatPane()},e.prototype.showDocChatPane=function(){this._basicChatClient.showChatPane()},e.prototype.add_paneStateChanged=function(t){this._eventSource.addHandler(e.PaneStateChangedEventKey,t)},e.prototype.remove_paneStateChanged=function(t){this._eventSource.removeHandler(e.PaneStateChangedEventKey,t)},e.PaneStateChangedEventKey="PSC",e.AvailabilityChangedEventKey="ACE",e.UnreadConversationsChangedEventKey="UCC",e}();(0,l.l)(h,"56cf5ddc$DocChatClient",null,[u]);var _=n(934),f=n(2575),m=n(1526),y=n(2449);n.d(t,{SkypeChatPackage:function(){return v}});var v=function(){function e(){}return e.prototype.get_name=function(){return"Common.App.SkypeChat"},e.prototype.configure=function(e){e.register(h).singleInstance().usingFactory((function(){return new h(y.q.taskFromFuture(r.n,e.resolveFuture(r.n)),f.AFrameworkApplication.get_activeFrame().get_theStopwatchBuilder())})),e.register(_.v).as(i.x).singleInstance().usingFactory((function(){return new _.v(new s.q(h,(function(){return e.resolve(h)})))}))},e.prototype.init=function(){},e.prototype.dispose=function(){},e.main=function(){m.o.get_instance().registerPackage(new e,0,!1)},e}();(0,l.l)(v,"7595db03$SkypeChatPackage",null,[o.u,a.s])},382:function(e,t,n){"use strict";n.d(t,{x:function(){return r}});var r=(0,n(423).y)("73e80724$IMergeFailureDetail")},448:function(e,t,n){"use strict";n.r(t);var r,i=n(423),o=(0,i.y)("eab30ff8$IRealtimeChannel"),a=n(8729),s=n(1822),l=n(3529),u=n(7847),c=n(127),d=n(7597),p=n(2575);!function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(r||(r={})),(0,i.h)("804ffae1$ChannelConnectionState",r);var g=function(){return function(e,t){this.status=0,this.lastStatusChange=null,this.status=e,this.lastStatusChange=t}}();(0,i.l)(g,"733ce568$UserStatusInfo",null,[]);var h=function(){function e(e,t){this.data=null,this.timeStamp=null,this.data=e,this.timeStamp=t}return e.prototype.get_data=function(){return this.data},e.prototype.get_timeStamp=function(){return this.timeStamp},e}();(0,i.l)(h,"aeea7618$PresenceData",null,[]);var _=(0,i.y)("106dac68$IConnectedUsageKpiLogger"),f=function(){function e(t){this._timerSet=!1,this._timerId=0,this._connectingUsageLogged=!1,this._clientDetailsStringForLogging=null,this.setTimeout=null,this.clearTimeout=null,this.logUsageStatement=null,this.setTimeout=e.DefaultSetTimeout,this.clearTimeout=e.DefaultClearTimeout,this.logUsageStatement=i.i(this,this.LogRtcConnectingUsageStatement,"LogRtcConnectingUsageStatement"),this._clientDetailsStringForLogging=t}return e.prototype.onConnectStart=function(){var t=this;this._timerSet||(this._timerId=this.setTimeout((function(){t._timerSet=!1,t.LogRtcConnectingUsage()}),e.TimeToWaitBeforeLoggingRtcConnectionUsage),this._timerSet=!0,this._connectingUsageLogged=!1)},e.prototype.onDisconnectStart=function(){this.ClearTimer()},e.prototype.onSuccessfulConnect=function(){this.LogRtcConnectingUsage()},e.prototype.LogRtcConnectingUsage=function(){this.ClearTimer(),this._connectingUsageLogged||(this._connectingUsageLogged=!0,this.logUsageStatement())},e.prototype.LogRtcConnectingUsageStatement=function(){d.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this._clientDetailsStringForLogging)},e.prototype.ClearTimer=function(){this._timerSet&&this.clearTimeout(this._timerId),this._timerId=0,this._timerSet=!1},e.DefaultSetTimeout=function(e,t){return window.setTimeout(e,t)},e.DefaultClearTimeout=function(e){window.clearTimeout(e)},e.TimeToWaitBeforeLoggingRtcConnectionUsage=8e3,e}();(0,i.l)(f,"93b911e1$ConnectedUsageKpiLogger",null,[_]);var m=(0,i.y)("64d7edae$IAssignRtcMachineStrategy"),y=n(5214),v=n(5734),S=n(9641),I=function(){function e(){this.machineId=null,this.maxRateThrottlerMessageDelay=0,this.maxOutstandingThrottlerTimeToWaitForResponse=0,this.maxOutstandingThrottlerMaxOutstandingMessages=0,this.globalMaxOutstandingThrottlerMaxOutstandingMessages=0,this.isRtcEnabled=!1,this.errorMessage=null,this.connectionUrl=null,this.queryString=null,this.connectionString=null,this.correlationId=null}return e.prototype.get_completeMachineConnectionUrl=function(){return this.connectionUrl+"?"+this.queryString},e}();(0,i.l)(I,"458d6065$FindSessionResponse",null,[]);var C=n(8996),T=function(){function e(){}return e.debugLog=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i]},e.checkAndSerialize=function(e){var t;try{t=C.x.serialize(e)}catch(e){var r=String.format("Failed to JSON-serialize payload : {0}",e);throw d.ULS.sendTraceTag(18637072,500,10,r),Error.argument("payload",r)}if(t.length>n(448).RealtimeChannel.MaxPayloadSizeInCharacters){r=String.format("Payload exceeds maximum length: {0} > {1} : {2}",t.length,n(448).RealtimeChannel.MaxPayloadSizeInCharacters,t);throw d.ULS.sendTraceTag(18637074,500,10,r),Error.argument("payload",r)}return t},e.deserialize=function(t,n,r,i){if(!t)return null;if(Object.getType(t)!==String){var o=void 0;if(i)try{o=e.checkAndSerialize(t)}catch(e){o=String.format("Failed to JSON serialize the object with exception [{0}]",e)}else o="not allowed to log the object";var a=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}]. Object: [{3}].",n,Object.getType(t).getName(),r,o);return d.ULS.sendTraceTag(18637075,500,10,a),null}var s=null,l=t;try{s=C.x.deserialize(l)}catch(e){o=i?l:"not allowed to log the object",a=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}]. Object: [{3}]",n,e,r,o);d.ULS.sendTraceTag(18637077,500,10,a)}return s},e.objectToString=function(e){if(!e)return"";if("string"==typeof e)return e.toString();try{return C.x.serialize(e)}catch(t){return e.toString()}},e.extractDetailsFromSignalRErrorObject=function(e,t,n,r){if(t.val=0,n.val=null,r.val=null,e)try{var i=e,o=i.source;o&&Object.getType(o)===String&&(r.val=o);var a=i.context;a&&(i=a,t.val=i.status?i.status:0,n.val=i.statusText?i.statusText:null)}catch(e){}},e.rtcVerboseLoggingEnabled=!1,e}();(0,i.l)(T,"5c03bc2f$RtcUtils",null,[]);var b=function(){function e(e,t,n,r){this.messageDelayTime=0,this.timeToWaitForResponse=0,this.maxOutstandingMessages=0,this.globalMaxOutstandingMessages=0,this.messageDelayTime=e,this.timeToWaitForResponse=t,this.maxOutstandingMessages=n,this.globalMaxOutstandingMessages=r}return e.prototype.get_messageDelayTime=function(){return this.messageDelayTime},e.prototype.get_timeToWaitForResponse=function(){return this.timeToWaitForResponse},e.prototype.get_maxOutstandingMessages=function(){return this.maxOutstandingMessages},e.prototype.get_globalMaxOutstandingMessages=function(){return this.globalMaxOutstandingMessages},e}();(0,i.l)(b,"880dcbf1$ThrottlerManagerSettings",null,[]);var A=n(9978),M=function(){function e(){}return e.messageDelay="throttling_messageDelay",e.isPresenceEnabled="enabled",e.timeToWaitForResponse="throttling_timeToWaitForResponse",e.maxNumberOfOutstandingMessages="throttling_maxNumberOfOutstandingMessages",e.globalMaxNumberOfOutstandingMessages="throttling_globalMaxNumberOfOutstandingMessages",e.errorMessage="errorMessage",e.signalREndpointUrl="url",e.queryString="queryString",e.connectionString="connectionString",e.serverRtcProtocol="protocolVersion",e}();(0,i.l)(M,"3d6eeeb2$RtcFindSessionOutputFieldNameConstants",null,[]);var P=n(6378),F=function(){function e(t,n,r,i,o,a,s,l,u,c,g,h){var _=this;this._findSessionQueryString=null,this._findSessionUrl=null,this._clientRequestManager=null,this._machineIdTimer=0,this._machineIdTimerSet=!1,this._isOrderlyShutdownInProgress=!1,this._stopwatchBuilder=null,this._rtcEventHub=null,this._clientDetailsStringForLogging=null,this._serverUrl=null,this._findSessionUtils=null,this._findSessionUtilsRequestResolved=!1,this.responseFromFindSessionRequest=null,this.rtcConnectionState=0,this.connectionQueryString=null,this.$$pf_MachineConnectionString=null,this.$$pf_ConnectionString=null,this.$$pf_FindSessionRequestTimeoutInMs=0,this._lastGetMachineIdRequestTime=new Date(0).getTime(),this._currentGetMachineIdDelay=e.InitialGetMachineIdDelayTimeInMs,this._requiredFieldsForSuccessfulResponse=[M.isPresenceEnabled,M.errorMessage,M.signalREndpointUrl,M.connectionString,M.queryString,M.globalMaxNumberOfOutstandingMessages,M.maxNumberOfOutstandingMessages,M.timeToWaitForResponse,M.messageDelay],this._requiredFieldsForFailedResponse=[M.isPresenceEnabled,M.errorMessage];var f=function(){return e.GenerateFindSessionQueryString(g?g():p.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,o,a,s,t,n)};this._stopwatchBuilder=i,this._clientRequestManager=n,this._findSessionUrl=r,this._findSessionQueryString=f(),this._clientDetailsStringForLogging=l,this._rtcEventHub=u,this._findSessionUtils=h,this._findSessionUtilsRequestResolved=!1,this.set_findSessionRequestTimeoutInMs(9e4),c&&c.execute((function(e){e.add_onTokenRefreshed((function(e,t){d.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",_._clientDetailsStringForLogging),_._findSessionQueryString=f(),_.RefreshMachineId()}))}))}return e.prototype.get_machineConnectionString=function(){return this.$$pf_MachineConnectionString},e.prototype.set_machineConnectionString=function(e){return this.$$pf_MachineConnectionString=e,e},e.prototype.get_connectionString=function(){return this.$$pf_ConnectionString},e.prototype.set_connectionString=function(e){return this.$$pf_ConnectionString=e,e},e.prototype.get_findSessionRequestTimeoutInMs=function(){return this.$$pf_FindSessionRequestTimeoutInMs},e.prototype.set_findSessionRequestTimeoutInMs=function(e){return this.$$pf_FindSessionRequestTimeoutInMs=e,e},e.prototype.init=function(){this._rtcEventHub.add_resetMachineIdDelayRequestReceived(i.i(this,this.resetGetMachineIdDelay,"resetGetMachineIdDelay")),this._rtcEventHub.add_connectionStateChanged(i.i(this,this.onConnectionStateChanged,"onConnectionStateChanged"))},e.prototype.onConnectionStateChanged=function(e,t){this.rtcConnectionState=t.get_newState()},e.prototype.getFindSessionRequestQs=function(t){return t.val=this.responseFromFindSessionRequest.correlationId,String.format("{0}&{1}={2}",this.responseFromFindSessionRequest.queryString,e.CorrelationIdQueryParam,P.l.urlKeyValueEncode(t.val))},e.prototype.getRtcMachine=function(e,t,n,r,i){var o=this;this.SendFindSessionRequestToServer((function(){r(i,"GetMachineIdSuccess")&&(d.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",o.get_connectionString(),o._clientDetailsStringForLogging),e(o._serverUrl),n(o.GetThrottlerSettings()))}),(function(e){r(i,"GetMachineIdFailure")&&(d.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",o._clientDetailsStringForLogging),t(e))}),r,i)},e.prototype.disposeMachineId=function(){this.ClearMachineId(),this.IncreaseGetMachineIdDelayOnFailure()},e.prototype.SendFindSessionRequestToServer=function(e,t,n,r){var i=this;if(d.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}] OrderlyShutdownInprogress is [{1}]",this.get_connectionString(),this._isOrderlyShutdownInProgress),this.get_connectionString())e();else{var o=this.CalculateGetMachineIdWaitTime();window.setTimeout((function(){n(r,"RequestMachineId")&&(i._lastGetMachineIdRequestTime=(new Date).getTime(),i.getFindSessionResponseFromTheServer((function(t){i.ParseFindSessionResponse(t),i.SetMachineIdTimer(),e()}),(function(e){i.ClearMachineId(),t(e)}),!1))}),o)}},e.prototype.IncreaseGetMachineIdDelayOnFailure=function(){this._currentGetMachineIdDelay+=e.GetMachineIdDelayIncrementInMs,this._currentGetMachineIdDelay=Math.min(this._currentGetMachineIdDelay,e.MaxGetMachineIdDelayInMs)},e.prototype.CalculateGetMachineIdWaitTime=function(){var e=(new Date).getTime(),t=this._lastGetMachineIdRequestTime+this._currentGetMachineIdDelay-e;return t<0&&(t=0),t},e.prototype.ParseFindSessionResponse=function(e){try{this.responseFromFindSessionRequest=e,this.set_machineConnectionString(e.get_completeMachineConnectionUrl()),this.set_connectionString(e.connectionString),this.connectionQueryString=e.queryString,this._serverUrl=e.connectionUrl}catch(e){d.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",e.toString())}},e.prototype.ClearMachineId=function(){this.set_connectionString(null),this.ClearMachineIdTimer()},e.prototype.SetMachineIdTimer=function(){this.ClearMachineIdTimer(),this._machineIdTimerSet=!0,this._machineIdTimer=window.setTimeout(i.i(this,this.RefreshMachineId,"RefreshMachineId"),e.RefreshMachineIdTimeInMs)},e.prototype.ClearMachineIdTimer=function(){this._machineIdTimerSet&&(window.clearTimeout(this._machineIdTimer),this._machineIdTimerSet=!1)},e.prototype.RefreshMachineId=function(){var e=this;this._machineIdTimerSet=!1,this.getFindSessionResponseFromTheServer((function(t){var n=e.connectionQueryString!==t.queryString,r=e.get_connectionString()!==t.connectionString;if(e.ParseFindSessionResponse(t),e.rtcConnectionState){if(r)return d.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",e.get_connectionString()||"null",t.connectionString),void e._rtcEventHub.raiseRefreshConnectionEvent();e._rtcEventHub.raiseSessionPropertiesChanged(n,r),e.SetMachineIdTimer()}}),(function(t){e.SetMachineIdTimer()}),!0)},e.prototype.resetGetMachineIdDelay=function(){this._currentGetMachineIdDelay=e.InitialGetMachineIdDelayTimeInMs},e.prototype.GetThrottlerSettings=function(){return new b(this.responseFromFindSessionRequest.maxRateThrottlerMessageDelay,this.responseFromFindSessionRequest.maxOutstandingThrottlerTimeToWaitForResponse,this.responseFromFindSessionRequest.maxOutstandingThrottlerMaxOutstandingMessages,this.responseFromFindSessionRequest.globalMaxOutstandingThrottlerMaxOutstandingMessages)},e.prototype.TranslateServerResponseToFindSessionResponse=function(e){if(Object.getType(e)!==Object)return null;var t=e;for(var n in t)t[n];var r=this.CreateFindSessionResponse(t);return r},e.prototype.CreateFindSessionResponse=function(e){if(!(M.isPresenceEnabled in e))return null;for(var t=e[M.isPresenceEnabled],n=0,r=t?this._requiredFieldsForSuccessfulResponse:this._requiredFieldsForFailedResponse;n<r.length;n++){if(!(r[n]in e))return null}var i=(0,y.m)(new I,{isRtcEnabled:e[M.isPresenceEnabled],errorMessage:e[M.errorMessage],correlationId:S.l.create().toString()});return t&&(i.connectionUrl=e[M.signalREndpointUrl],i.queryString=e[M.queryString],i.connectionString=e[M.connectionString],i.globalMaxOutstandingThrottlerMaxOutstandingMessages=e[M.globalMaxNumberOfOutstandingMessages],i.maxOutstandingThrottlerMaxOutstandingMessages=e[M.maxNumberOfOutstandingMessages],i.maxOutstandingThrottlerTimeToWaitForResponse=e[M.timeToWaitForResponse],i.maxRateThrottlerMessageDelay=e[M.messageDelay]),i},e.prototype.GetFindSessionUtilsResponse=function(e,t){var n=this;d.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response"),this._findSessionUtils.get_findSessionRequestSucceeded().CW((function(r){n._findSessionUtils.get_findSessionRequestSucceeded().get_result()?(d.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),e(n._findSessionUtils.get_findSessionServerResponse())):(d.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),t(n._findSessionUtils.get_findSessionServerResponse()))}))},e.prototype.requestSucceededDelegate=function(e,t,n,r,i){var o=this;return function(a){e&&e.stop(),o.LogRequestPerf(a.get_data(),!0,t);var s=T.deserialize(a.get_data().responseData,"FindSession",null,!0);if(s){var l=o.TranslateServerResponseToFindSessionResponse(s);if(l){if(l.isRtcEnabled&&l.queryString&&l.connectionString)return d.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",o._clientDetailsStringForLogging),void n(l);t.FindSessionFailureReason="FindSessionInvalidResponse",t.IsRtcEnabled=l.isRtcEnabled,t.IsQueryStringEmpty=!l.queryString,t.IsConnectionStringEmpty=!l.connectionString,d.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",o._clientDetailsStringForLogging,l.isRtcEnabled,!l.queryString,!l.connectionString)}else t.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",d.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",o._clientDetailsStringForLogging)}else t.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",d.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",o._clientDetailsStringForLogging);o.RaiseRtcConnectFailedEvent(t,i),r(null)}},e.prototype.requestFailedDelegate=function(t,n,r,i){var o=this;return function(a){t&&t.stop(),o._isOrderlyShutdownInProgress=!1,o.LogRequestPerf(a.get_data(),!1,n);var s=null,l="unknown",u="unknown";if(a.get_data()){var c=a.get_data().responseHeaders;c&&(e.RtcErrorCode in c&&(s=c[e.RtcErrorCode].toString()),e.RtcOrderlyShutdownInProgress in c&&(o._isOrderlyShutdownInProgress=!0)),l=v.e[a.get_data().status],u=a.get_data().httpStatus.toString()}n.FindSessionFailureReason="FindSessionRequestFailed",n.HttpErrorCode=u,n.HttpErrorStatus=l,n[e.RtcErrorCode]=s,n[e.RtcOrderlyShutdownInProgress]=o._isOrderlyShutdownInProgress.toString(),d.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}', RtcGracefulShutdownInProgress='{4}'",l,u,o._clientDetailsStringForLogging,s,o._isOrderlyShutdownInProgress),o.RaiseRtcConnectFailedEvent(n,i),r(s)}},e.prototype.getFindSessionResponseFromTheServer=function(t,n,r){var i=this._findSessionUrl+"?"+this._findSessionQueryString,o=null;d.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this._clientDetailsStringForLogging);var a={};if(a.IsNetworkOfflineBeforeSendRequest=this._clientRequestManager.get_isNetworkOffline(),a.HasAvailableConnectionsBeforeSendRequest=this._clientRequestManager.get_hasAvailableConnections(),a.MaxConnectionsAllowed=this._clientRequestManager.get_maxConnections(),a.IsRefreshMachineId=r,this._findSessionUtils&&!this._findSessionUtilsRequestResolved){var s=this.requestSucceededDelegate(null,a,t,n,r),l=this.requestFailedDelegate(null,a,n,r);return this.GetFindSessionUtilsResponse(s,l),void(this._findSessionUtilsRequestResolved=!0)}this._stopwatchBuilder&&(o=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","GetMachineIdFromTheServer")),this._clientRequestManager.addRequestWithHeaderForwarding(i,1,null,{},[e.RtcErrorCode,e.RtcOrderlyShutdownInProgress],!1,1,this.requestSucceededDelegate(o,a,t,n,r),this.requestFailedDelegate(o,a,n,r),null,null,!1,null,this.get_findSessionRequestTimeoutInMs(),"3",null,!1,null,!1,null)},e.prototype.LogRequestPerf=function(t,n,r){r||(r={}),r.IsNetworkOfflineAfterRequestComplete=this._clientRequestManager.get_isNetworkOffline(),r.IsRequestSucceeded=n,t&&(r.EnqueueTime=t.enqueueTime,r.InvokedTime=t.invokedTime,r.CompletedTime=t.completedTime,t.responseHeaders&&e.CorrelationHeaderName in t.responseHeaders&&(r.CorrelationId=t.responseHeaders[e.CorrelationHeaderName])),d.ULS.sendTraceTag(38633565,500,n?50:15,T.objectToString(r))},e.prototype.RaiseRtcConnectFailedEvent=function(e,t){e||(e={}),e.ConnectionState=r[this.rtcConnectionState],t||this._rtcEventHub.raiseRtcConnectFailed(1,e)},e.createInstance=function(t,n,r,i,o,a,s,l,u,c,d){return e.CreateInstanceInternal(t,n,r,i,o,a,s,l,u,c,null,d)},e.createInstanceWithQuerySignatureDelegate=function(t,n,r,i,o,a,s,l,u,c,d,p){return e.CreateInstanceInternal(t,n,r,i,o,a,s,l,u,c,d,p)},e.CreateInstanceInternal=function(t,n,r,i,o,a,s,l,u,c,d,p){var g=new e(t=t||S.l.create().toString(),n,r,i,o,a,s,l,u,c,d,p);return g.init(),g},e.GenerateFindSessionQueryString=function(t,n,r,i,o,a){var s=String.format("{0}={1}",A.l.querySignature,P.l.urlKeyValueEncode(t));s=String.format("{0}&{1}={2}",s,A.l.clientId,P.l.urlKeyValueEncode(i)),s=String.format("{0}&{1}={2}",s,A.l.userSessionId,P.l.urlKeyValueEncode(o)),s=String.format("{0}&{1}={2}",s,A.l.userApp,P.l.urlKeyValueEncode(r.toString())),s=String.format("{0}&{1}={2}",s,A.l.userType,P.l.urlKeyValueEncode("1")),s=String.format("{0}&{1}={2}",s,A.l.userVersion,P.l.urlKeyValueEncode(n)),s=String.format("{0}&{1}={2}",s,A.l.clientRtcProtocol,P.l.urlKeyValueEncode(e.ClientProtocolVersion));var l=e.GetAuthQueryStringPair(r,a);return l&&(s=String.format("{0}&{1}",s,l)),s},e.GetAuthQueryStringPair=function(e,t){return 4===e?String.format("{0}={1}",A.l.noAuthorizationRequired,"1"):t?t.getUserTypeQueryStringPair():null},e.RefreshMachineIdTimeInMs=24e4,e.GetMachineIdDelayIncrementInMs=3e3,e.MaxGetMachineIdDelayInMs=3e5,e.ClientProtocolVersion="1.0",e.InitialGetMachineIdDelayTimeInMs=1e3,e.CorrelationHeaderName="X-CorrelationId",e.CorrelationIdQueryParam="corrid",e.RtcErrorCode="RtcErrorCode",e.RtcOrderlyShutdownInProgress="RtcGracefulShutdownInProgress",e}();(0,i.l)(F,"2f2db91d$FindSessionStrategy",null,[m]);var w,R,E=(0,i.y)("79a370ca$IFrequentLoggingMetrics"),k=n(1158);!function(e){e[e.SendNotification=0]="SendNotification",e[e.SendPersistentState=1]="SendPersistentState",e[e.Last=2]="Last"}(w||(w={})),(0,i.h)("38eff03d$ApiType",w),function(e){e[e.AttemptCount=0]="AttemptCount",e[e.SuccessCount=1]="SuccessCount",e[e.DropCount=2]="DropCount",e[e.FailedCount=3]="FailedCount",e[e.LatencyOverThresholdCount=4]="LatencyOverThresholdCount",e[e.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount",e[e.ThrottledCount=6]="ThrottledCount",e[e.Last=7]="Last"}(R||(R={})),(0,i.h)("217a86a$EventCountType",R);var D=function(){function e(e){this._metrics=null,this._clientRequestManager=null,this._metricsChanged=!1,this._clientRequestManager=e,this.InitializeMetricsArray(),this._metricsChanged=!1}return e.prototype.startLoggingEveryGivenMs=function(e){window.setInterval(i.i(this,this.LogMetricsBatchAndReset,"LogMetricsBatchAndReset"),e)},e.prototype.increaseMetric=function(e,t){window.navigator.onLine&&!this._clientRequestManager.get_isNetworkOffline()&&(this._metrics[e][t]++,this._metricsChanged=!0)},e.prototype.InitializeMetricsArray=function(){this._metrics=new Array(2);for(var e=0;e<2;e++){this._metrics[e]=new Array(7);for(var t=0;t<7;t++)this._metrics[e][t]=0}},e.prototype.BuildMetricsDictionary=function(){for(var e={},t=0;t<2;t++)for(var n=0;n<7;n++){e[w[t]+R[n]]=this._metrics[t][n]}return e},e.prototype.LogMetricsBatchAndReset=function(){if(this._metricsChanged){var e=k.j.toJSON(this.BuildMetricsDictionary());d.ULS.sendTraceTag(50644352,500,15,e);for(var t=0;t<2;t++)for(var n=0;n<7;n++)this._metrics[t][n]=0;this._metricsChanged=!1}},e.get_instance=function(){return e.instance},e.Create=function(t){return e.get_instance()||(e.instance=new e(t)),e.get_instance()},e.instance=null,e}();(0,i.l)(D,"34995a83$FrequentLoggingMetrics",null,[E]);var O=(0,i.y)("a34a0baf$IRealtimeChannelMetrics"),U=n(9017),x=function(){function e(){this.recordConnectionAttempt=this.RecordConnectionAttempt,this.recordConnectionSuccess=this.RecordConnectionSuccess,this.recordConnectionFailure=this.RecordConnectionFailure,this.recordDisconnectedUnexpectedly=this.RecordDisconnectedUnexpectedly,this.recordDisconnectedExplicitly=this.RecordDisconnectedExplicitly,this.recordMetricsToTelemetry=this.RecordMetricsToTelemetry,this.recordMessageSent=this.RecordMessageSent,this.recordMessageLost=this.RecordMessageLost,this.recordMessageReceived=this.RecordMessageReceived,this.recordConnectionErrorDetails=this.RecordConnectionErrorDetails,this.networkDisconnected=this.NetworkDisconnected,this.networkResumed=this.NetworkResumed}return e.prototype.RecordConnectionAttempt=function(){},e.prototype.RecordConnectionSuccess=function(){},e.prototype.RecordConnectionFailure=function(){},e.prototype.RecordDisconnectedUnexpectedly=function(){},e.prototype.RecordDisconnectedExplicitly=function(){},e.prototype.RecordMessageSent=function(){},e.prototype.RecordMessageReceived=function(){},e.prototype.RecordMessageLost=function(){},e.prototype.RecordMetricsToTelemetry=function(){},e.prototype.RecordConnectionErrorDetails=function(e){},e.prototype.NetworkDisconnected=function(){},e.prototype.NetworkResumed=function(){},e}();(0,i.l)(x,"503b1298$NoopRealtimeChannelMetrics",null,[O,U.d]);var L=n(5227),N=function(){function e(){this._numberOfConnectionAttempts=0,this._numberOfSuccessfulConnections=0,this._numberOfFailedConnections=0,this._numberOfDisconnectedConnections=0,this._numberOfExplicitDisconnectedConnections=0,this._numberOfSentMessages=0,this._numberOfReceivedMessages=0,this._numberOfLostMessages=0,this._firstConnectionAttempt=null,this._firstConnectionSuccess=null,this._lastConnectionAttempt=null,this._lastDisconnect=null,this._lastExplicitDisconnect=null,this._lastConnectionSuccess=null,this._lastConnectionFailure=null,this._lastMessageSent=null,this._lastMessageLost=null,this._lastTimeOnline=null,this._lastTimeOffline=null,this._firstMessageReceived=null,this._clientConnectionErrors=0,this._serverConnectionErrors=0,this._maxDisconnectedTimeMs=0,this._maxExplicitDisconnectedTimeMs=0,this._metricsRecorded=!1,this.recordConnectionAttempt=this.RecordConnectionAttempt,this.recordConnectionSuccess=this.RecordConnectionSuccess,this.recordConnectionFailure=this.RecordConnectionFailure,this.recordDisconnectedUnexpectedly=this.RecordDisconnectedUnexpectedly,this.recordDisconnectedExplicitly=this.RecordDisconnectedExplicitly,this.recordMetricsToTelemetry=this.RecordMetricsToTelemetry,this.recordMessageSent=this.RecordMessageSent,this.recordMessageLost=this.RecordMessageLost,this.recordMessageReceived=this.RecordMessageReceived,this.recordConnectionErrorDetails=this.RecordConnectionErrorDetails,this.networkDisconnected=this.NetworkDisconnected,this.networkResumed=this.NetworkResumed}return e.prototype.RecordConnectionAttempt=function(){this._numberOfConnectionAttempts++,this._lastConnectionAttempt=new Date,this._firstConnectionAttempt||(this._firstConnectionAttempt=new Date)},e.prototype.RecordConnectionSuccess=function(){this._numberOfSuccessfulConnections++,this._lastConnectionSuccess=new Date,this._firstConnectionSuccess||(this._firstConnectionSuccess=this._lastConnectionSuccess),this._lastTimeOnline=this._lastConnectionSuccess,this.ComputeDisconnectedTimeMs()},e.prototype.RecordConnectionFailure=function(){this._numberOfFailedConnections++,this._lastConnectionFailure=new Date},e.prototype.RecordDisconnectedUnexpectedly=function(){this._numberOfDisconnectedConnections++,this._lastDisconnect=new Date},e.prototype.RecordDisconnectedExplicitly=function(){this._numberOfExplicitDisconnectedConnections++,this._lastExplicitDisconnect=new Date},e.prototype.RecordMessageSent=function(){this._lastMessageSent=new Date,this._numberOfSentMessages++},e.prototype.RecordMessageReceived=function(){this._firstMessageReceived||(this._firstMessageReceived=new Date),this._numberOfReceivedMessages++},e.prototype.RecordMessageLost=function(){this._lastMessageLost=new Date,this._numberOfLostMessages++},e.prototype.RecordMetricsToTelemetry=function(){if(!this._metricsRecorded&&this._numberOfConnectionAttempts){var e=this.CollectMetrics();d.ULS.sendTraceTag(39321871,500,15,k.j.toJSON(e)),this._metricsRecorded=!0}},e.prototype.RecordConnectionErrorDetails=function(e){var t,n,r;T.extractDetailsFromSignalRErrorObject(e,(0,s.m)((function(){return t}),(function(e){return t=e})),(0,s.m)((function(){return n}),(function(e){return n=e})),(0,s.m)((function(){return r}),(function(e){return r=e}))),t&&t!==L.k.oK_200&&(d.ULS.sendTraceTag(40157596,500,15,k.j.toJSON({HttpErrorCode:t,HttpErrorStatus:n,Exception:r})),L.k.isClientError(t)&&this._clientConnectionErrors++,L.k.isServerError(t)&&this._serverConnectionErrors++)},e.prototype.NetworkDisconnected=function(){this._lastTimeOffline=new Date},e.prototype.NetworkResumed=function(){this._lastTimeOnline=new Date,this._lastDisconnect=this._lastTimeOnline},e.prototype.CollectMetrics=function(){return{numberOfConnectionAttempts:this._numberOfConnectionAttempts,numberOfSuccessfulConnections:this._numberOfSuccessfulConnections,numberOfFailedConnections:this._numberOfFailedConnections,numberOfDisconnectedConnections:this._numberOfDisconnectedConnections,numberOfExplicitDisconnectedConnections:this._numberOfExplicitDisconnectedConnections,numberOfSentMessages:this._numberOfSentMessages,numberOfReceivedMessages:this._numberOfReceivedMessages,numberOfLostMessages:this._numberOfLostMessages,firstConnectionAttempt:this._firstConnectionAttempt?this._firstConnectionAttempt:null,firstMessageReceived:this._firstMessageReceived?this._firstMessageReceived:null,firstConnectionSuccess:this._firstConnectionSuccess?this._firstConnectionSuccess:null,lastConnectionAttempt:this._lastConnectionAttempt?this._lastConnectionAttempt:null,lastConnectionSuccess:this._lastConnectionSuccess?this._lastConnectionSuccess:null,lastConnectionFailure:this._lastConnectionFailure?this._lastConnectionFailure:null,lastMessageSent:this._lastMessageSent?this._lastMessageSent:null,lastMessageLost:this._lastMessageLost?this._lastMessageLost:null,lastDisconnect:this._lastDisconnect?this._lastDisconnect:null,lastExplicitDisconnect:this._lastExplicitDisconnect?this._lastExplicitDisconnect:null,lastTimeOnline:this._lastTimeOnline?this._lastTimeOnline:null,lastTimeOffline:this._lastTimeOffline?this._lastTimeOffline:null,maxDisconnectedTimeMs:this._maxDisconnectedTimeMs,maxExplicitDisconnectedTimeMs:this._maxExplicitDisconnectedTimeMs,clientConnectionErrors:this._clientConnectionErrors,serverConnectionErrors:this._serverConnectionErrors}},e.prototype.ComputeDisconnectedTimeMs=function(){this._firstConnectionAttempt&&1===this._numberOfSuccessfulConnections&&(this._maxDisconnectedTimeMs=Math.max(this._maxDisconnectedTimeMs,this._lastConnectionSuccess.getTime()-this._firstConnectionAttempt.getTime())),this._lastDisconnect&&this._numberOfSuccessfulConnections>1&&(this._maxDisconnectedTimeMs=Math.max(this._maxDisconnectedTimeMs,this._lastConnectionSuccess.getTime()-this._lastDisconnect.getTime())),this._lastExplicitDisconnect&&this._numberOfSuccessfulConnections>1&&(this._maxExplicitDisconnectedTimeMs=Math.max(this._maxExplicitDisconnectedTimeMs,this._lastConnectionSuccess.getTime()-this._lastExplicitDisconnect.getTime()))},e.createInstance=function(t){return e._instance||(e._instance=new e,d.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",t)),e._instance},e._instance=null,e}();(0,i.l)(N,"af731006$RealtimeChannelMetrics",null,[O,U.d]);var B=(0,i.y)("684034f4$IRealtimeChannelProxy"),H=(0,i.y)("dbdefced$IRealtimeChannelClientProxy"),G=(0,i.y)("1a198731$IRealtimeChannelServerProxy"),W=function(){function e(){}return e.updatePresence="presenceUpdated",e.updateNotification="updateNotification",e.persistentStateCleared="persistentStateCleared",e.updatePersistentState="persistentStateUpdated",e}();(0,i.l)(W,"43f7224c$RtcClientMethodNames",null,[]);var V=function(){function e(){}return e.hubName="realtimeChannelHub",e.getCompletePresenceState="GetCompletePresenceState",e.updatePresence="UpdatePresence",e.sendUpdateNotification="SendUpdateNotification",e.getCompletePersistentState="GetCompletePersistentState",e.getCompletePersistentStateWithMetadata="GetCompletePersistentStateWithMetadata",e.updatePersistentState="UpdatePersistentState",e}();(0,i.l)(V,"8ecc0a4a$RtcHubMethodNames",null,[]);var j=function(){function e(e){this._proxy=null,this._proxy=e}return e.prototype.registerPresenceStateUpdated=function(e){this._proxy.on(W.updatePresence,e)},e.prototype.registerUpdateNotificationReceived=function(e){this._proxy.on(W.updateNotification,e)},e.prototype.registerPersistentStateUpdated=function(e){this._proxy.on(W.updatePersistentState,e)},e.prototype.registerPersistentStateCleared=function(e){this._proxy.on(W.persistentStateCleared,e)},e.prototype.unregisterPresenceStateUpdated=function(e){this._proxy.off(W.updatePresence,e)},e.prototype.unregisterUpdateNotificationReceived=function(e){this._proxy.off(W.updateNotification,e)},e.prototype.unregisterPersistentStateUpdated=function(e){this._proxy.off(W.updatePersistentState,e)},e.prototype.unregisterPersistentStateCleared=function(e){this._proxy.off(W.persistentStateCleared,e)},e.prototype.getCompletePresenceState=function(){return this._proxy.invoke(V.getCompletePresenceState)},e.prototype.updatePresence=function(e){return this._proxy.invoke(V.updatePresence,e)},e.prototype.sendUpdateNotification=function(e,t){return this._proxy.invoke(V.sendUpdateNotification,e,t)},e.prototype.getCompletePersistentState=function(e){return this._proxy.invoke(V.getCompletePersistentState,e)},e.prototype.getCompletePersistentStateWithMetadata=function(e){return this._proxy.invoke(V.getCompletePersistentStateWithMetadata,e)},e.prototype.updatePersistentState=function(e,t){return this._proxy.invoke(V.updatePersistentState,e,t)},e}();(0,i.l)(j,"3821aafd$RealtimeChannelProxy",null,[B,H,G]);var q=(0,i.y)("a15058dd$IRealtimeChannelSettings"),z=function(){function e(){this.awayStatusManagerIsEnabled=!1,this.$$pf_AwayStatusOneMinuteTimeoutIsEnabled=!1,this.$$pf_AwayCoauthorThresholdMs=0,this.$$pf_AllowCrossDomainAccessEnabled=!1,this.$$pf_ReconnectionSlowDurationMilliseconds=0,this.$$pf_LogUpdateNotificationHintOnDeserializationFailure=!1,this.$$pf_ShouldLogOnContentNotification=!1,this.$$pf_ClientMetricsEnabled=!1,this.$$pf_RtcClientDisconnectOnDssExipiredOrDeleted=!1,this.$$pf_FindSessionRequestTimeoutInMs=0,this.$$pf_RtcJsClientFrequentlyLogsMetrics=!1,this.$$pf_RtcJsClientFrequentMetricsLatencyThresholdInMS=0,this.$$pf_RtcJsClientFrequentMetricsLogIntervalInMS=0}return e.prototype.get_awayStatusManagerIsEnabled=function(){return this.awayStatusManagerIsEnabled},e.prototype.get_awayStatusOneMinuteTimeoutIsEnabled=function(){return this.$$pf_AwayStatusOneMinuteTimeoutIsEnabled},e.prototype.set_awayStatusOneMinuteTimeoutIsEnabled=function(e){return this.$$pf_AwayStatusOneMinuteTimeoutIsEnabled=e,e},e.prototype.get_awayCoauthorThresholdMs=function(){return this.$$pf_AwayCoauthorThresholdMs},e.prototype.set_awayCoauthorThresholdMs=function(e){return this.$$pf_AwayCoauthorThresholdMs=e,e},e.prototype.get_allowCrossDomainAccessEnabled=function(){return this.$$pf_AllowCrossDomainAccessEnabled},e.prototype.set_allowCrossDomainAccessEnabled=function(e){return this.$$pf_AllowCrossDomainAccessEnabled=e,e},e.prototype.get_reconnectionSlowDurationMilliseconds=function(){return this.$$pf_ReconnectionSlowDurationMilliseconds},e.prototype.set_reconnectionSlowDurationMilliseconds=function(e){return this.$$pf_ReconnectionSlowDurationMilliseconds=e,e},e.prototype.get_logUpdateNotificationHintOnDeserializationFailure=function(){return this.$$pf_LogUpdateNotificationHintOnDeserializationFailure},e.prototype.set_logUpdateNotificationHintOnDeserializationFailure=function(e){return this.$$pf_LogUpdateNotificationHintOnDeserializationFailure=e,e},e.prototype.get_shouldLogOnContentNotification=function(){return this.$$pf_ShouldLogOnContentNotification},e.prototype.set_shouldLogOnContentNotification=function(e){return this.$$pf_ShouldLogOnContentNotification=e,e},e.prototype.get_clientMetricsEnabled=function(){return this.$$pf_ClientMetricsEnabled},e.prototype.set_clientMetricsEnabled=function(e){return this.$$pf_ClientMetricsEnabled=e,e},e.prototype.get_rtcClientDisconnectOnDssExipiredOrDeleted=function(){return this.$$pf_RtcClientDisconnectOnDssExipiredOrDeleted},e.prototype.set_rtcClientDisconnectOnDssExipiredOrDeleted=function(e){return this.$$pf_RtcClientDisconnectOnDssExipiredOrDeleted=e,e},e.prototype.get_findSessionRequestTimeoutInMs=function(){return this.$$pf_FindSessionRequestTimeoutInMs},e.prototype.set_findSessionRequestTimeoutInMs=function(e){return this.$$pf_FindSessionRequestTimeoutInMs=e,e},e.prototype.get_rtcJsClientFrequentlyLogsMetrics=function(){return this.$$pf_RtcJsClientFrequentlyLogsMetrics},e.prototype.set_rtcJsClientFrequentlyLogsMetrics=function(e){return this.$$pf_RtcJsClientFrequentlyLogsMetrics=e,e},e.prototype.get_rtcJsClientFrequentMetricsLatencyThresholdInMS=function(){return this.$$pf_RtcJsClientFrequentMetricsLatencyThresholdInMS},e.prototype.set_rtcJsClientFrequentMetricsLatencyThresholdInMS=function(e){return this.$$pf_RtcJsClientFrequentMetricsLatencyThresholdInMS=e,e},e.prototype.get_rtcJsClientFrequentMetricsLogIntervalInMS=function(){return this.$$pf_RtcJsClientFrequentMetricsLogIntervalInMS},e.prototype.set_rtcJsClientFrequentMetricsLogIntervalInMS=function(e){return this.$$pf_RtcJsClientFrequentMetricsLogIntervalInMS=e,e},e.createInstance=function(t){if(!t){var n=void 0;return(n=new e).awayStatusManagerIsEnabled=!1,n.set_awayStatusOneMinuteTimeoutIsEnabled(!1),n.set_awayCoauthorThresholdMs(9e5),n.set_allowCrossDomainAccessEnabled(!1),n.set_reconnectionSlowDurationMilliseconds(5e3),n.set_logUpdateNotificationHintOnDeserializationFailure(!0),n.set_shouldLogOnContentNotification(!1),n.set_clientMetricsEnabled(!1),n.set_rtcClientDisconnectOnDssExipiredOrDeleted(!0),n.set_findSessionRequestTimeoutInMs(9e4),n}var r;return(r=new e).awayStatusManagerIsEnabled=t.getBooleanAppSetting("AwayStatusManagerIsEnabled"),r.set_awayStatusOneMinuteTimeoutIsEnabled(t.getBooleanAppSetting("AwayStatusOneMinuteTimeoutIsEnabled")),r.set_awayCoauthorThresholdMs(t.getIntAppSetting("AwayCoauthorThresholdMs",9e5)),r.set_allowCrossDomainAccessEnabled(t.getBooleanAppSetting("RtcAllowCrossDomainAccessEnabled")),r.set_reconnectionSlowDurationMilliseconds(t.getIntAppSetting("RTCReconnectionSlowDurationMilliseconds",5e3)),r.set_logUpdateNotificationHintOnDeserializationFailure(t.getBooleanAppSetting("RTCLogUpdateNotificationHintOnDeserializationFailure")),r.set_shouldLogOnContentNotification(t.getBooleanAppSetting("ShouldLogOnContentNotification")),r.set_clientMetricsEnabled(t.getBooleanAppSetting("RtcClientMetricsEnabled")),r.set_rtcClientDisconnectOnDssExipiredOrDeleted(t.getBooleanAppSetting("RtcClientDisconnectOnDssExipiredOrDeleted")),r.set_findSessionRequestTimeoutInMs(t.getIntAppSetting("RtcFindSessionRequestTimeoutInMS",6e4)),r.set_rtcJsClientFrequentlyLogsMetrics(t.getBooleanAppSetting("RtcJsClientFrequentlyLogsMetrics")),r.set_rtcJsClientFrequentMetricsLatencyThresholdInMS(t.getIntAppSetting("RtcJsClientFrequentMetricsLatencyThresholdInMS",1e3)),r.set_rtcJsClientFrequentMetricsLogIntervalInMS(t.getIntAppSetting("RtcJsClientFrequentMetricsLogIntervalInMS",3e5)),r},e}();(0,i.l)(z,"ea680074$RealtimeChannelSettings",null,[q]);var K=(0,i.y)("b24e39ab$IRealtimeChannelEventHub"),Q=n(3545),Z=function(e){function t(t,n){var r=e.call(this)||this;return r.newState=0,r.oldState=0,r.newState=t,r.oldState=n,r}return(0,Q.t)(t,e),t.prototype.get_newState=function(){return this.newState},t.prototype.get_oldState=function(){return this.oldState},t}(Sys.EventArgs);(0,i.l)(Z,"48d3e68b$ChangedConnectionStateEventArgs",Sys.EventArgs,[]);var J=function(e){function t(t){var n=e.call(this)||this;return n.presence=null,n.presence=t,n}return(0,Q.t)(t,e),t.prototype.get_presence=function(){return this.presence},t}(Sys.EventArgs);(0,i.l)(J,"b051c790$MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var X=n(6604),Y=n(7929),ee=n(4541),te=function(e){function t(t,n){var r=e.call(this)||this;return r._type=0,r._updateHint=null,r._type=t,r._updateHint=n,r}return(0,Q.t)(t,e),t.prototype.get_type=function(){return this._type},t.prototype.get_updateHint=function(){return this._updateHint},t}(Sys.EventArgs);(0,i.l)(te,"52899634$UpdateNotificationEventArgs",Sys.EventArgs,[]);var ne=function(e){function t(t){var n=e.call(this)||this;return n.presenceWithMetatdata=null,n.presenceWithMetatdata=t,n}return(0,Q.t)(t,e),t.prototype.get_presenceWithMetatdata=function(){return this.presenceWithMetatdata},t}(Sys.EventArgs);(0,i.l)(ne,"9673a8be$GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);var re=function(e){function t(t,n,r,i,o,a){var s=e.call(this)||this;return s.stopwatch=null,s.existingPersistentState=null,s.clearExistingPersistentState=null,s.connectedUsageKpi=null,s.connectionToken=0,s.verifyConnectionToken=null,s.verifyConnectionToken=t,s.connectionToken=n,s.connectedUsageKpi=r,s.existingPersistentState=o,s.clearExistingPersistentState=i,s.stopwatch=a,s}return(0,Q.t)(t,e),t}(Sys.EventArgs);(0,i.l)(re,"7cc125d8$RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);var ie=function(e){function t(t){var n=e.call(this)||this;return n.hubConnection=null,n.hubConnection=t,n}return(0,Q.t)(t,e),t.prototype.get_hubConnection=function(){return this.hubConnection},t}(Sys.EventArgs);(0,i.l)(ie,"2420f67$RefreshProxyEventArgs",Sys.EventArgs,[]);var oe=function(e){function t(t,n){var r=e.call(this)||this;return r.failureType=0,r.errorMessage=null,r.failureType=t,r.errorMessage=n,r}return(0,Q.t)(t,e),t.prototype.get_failureType=function(){return this.failureType},t.prototype.get_errorMessage=function(){return this.errorMessage},t}(Sys.EventArgs);(0,i.l)(oe,"661bfbee$RtcConnectFailedEventArgs",Sys.EventArgs,[]);var ae=function(e){function t(t,n,r){var i=e.call(this)||this;return i.type=0,i.presence=null,i.tcs=null,i.type=t,i.presence=n,i.tcs=r,i}return(0,Q.t)(t,e),t.prototype.get_type=function(){return this.type},t.prototype.get_presence=function(){return this.presence},t.prototype.get_tcs=function(){return this.tcs},t}(Sys.EventArgs);(0,i.l)(ae,"abb283f8$SendPersistentStateEventArgs",Sys.EventArgs,[]);var se=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.type=0,o.updateHint=null,o.deliverLatestNotificationWhenConnected=!1,o.tcs=null,o.type=t,o.updateHint=n,o.deliverLatestNotificationWhenConnected=r,o.tcs=i,o}return(0,Q.t)(t,e),t.prototype.get_type=function(){return this.type},t.prototype.get_updateHint=function(){return this.updateHint},t.prototype.get_deliverLatestNotificationWhenConnected=function(){return this.deliverLatestNotificationWhenConnected},t.prototype.get_tcs=function(){return this.tcs},t}(Sys.EventArgs);(0,i.l)(se,"35b8d656$SendUpdateNotificationEventArgs",Sys.EventArgs,[]);var le=function(e){function t(t,n){var r=e.call(this)||this;return r.connectionQueryStringChanged=!1,r.machineConnectionStringChanged=!1,r.connectionQueryStringChanged=t,r.machineConnectionStringChanged=n,r}return(0,Q.t)(t,e),t.prototype.get_connectionQueryStringChanged=function(){return this.connectionQueryStringChanged},t.prototype.get_machineConnectionStringChanged=function(){return this.machineConnectionStringChanged},t}(Sys.EventArgs);(0,i.l)(le,"76b2ff6b$SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);var ue=function(e){function t(t){var n=e.call(this)||this;return n.clientsCleared=null,n.clientsCleared=t,n}return(0,Q.t)(t,e),t}(Sys.EventArgs);(0,i.l)(ue,"8532c7fc$UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);var ce=function(e){function t(t,n){var r=e.call(this)||this;return r.type=0,r.updatedClientsWithMetadata=null,r.type=t,r.updatedClientsWithMetadata=n,r}return(0,Q.t)(t,e),t.prototype.get_updatedClientsWithMetadata=function(){return this.updatedClientsWithMetadata},t}(Sys.EventArgs);(0,i.l)(ce,"be352de4$UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var de=n(4072),pe=function(){function e(){this._eventSource=null,this._eventSource=new de.f}return e.prototype.raiseConnectionStateChangedEvent=function(t,n){this._eventSource.raiseEvent(e.ConnectionStateChangedEventKey,new Z(t,n),null)},e.prototype.raiseRefreshProxyEvent=function(t){this._eventSource.raiseEvent(e.RefreshProxyEventKey,new ie(t),null)},e.prototype.raiseRefreshConnectionEvent=function(){this._eventSource.raiseEvent(e.RefreshConnectionEventKey,null,null)},e.prototype.raiseResetMachineIdDelayEvent=function(){this._eventSource.raiseEvent(e.ResetMachineIdDelayEventKey,null,null)},e.prototype.raiseRefreshAllPersistentStateEvent=function(t,n,r,i,o,a){this._eventSource.raiseEvent(e.RefreshAllPersistentStateEventKey,new re(t,n,r,i,o,a),null)},e.prototype.raiseUpdatePersistentStateRequestEventInternal=function(t,n){this._eventSource.raiseEvent(e.UpdatePersistentStateRequestEventKey,new ce(t,n),null)},e.prototype.raisePresenceUpdatedEvent=function(t,n){this._eventSource.raiseEvent(e.PresenceUpdatedEventKey,new ee.m(t,n,null),null)},e.prototype.raiseMyPresenceUpdatedEvent=function(t){this._eventSource.raiseEvent(e.MyPresenceUpdatedEventKey,new J(t),null)},e.prototype.raiseInternalPresenceUpdateEvent=function(t,n){this._eventSource.raiseEvent(e.InternalPresenceUpdateEventKey,new ee.m(t,n,null),null)},e.prototype.raiseSendUpdateNotificationEvent=function(t,n,r,i){return this._eventSource.raiseEvent(e.SendUpdateNotificationEventKey,new se(t,n,r,i),null)},e.prototype.raiseInternalUpdateNotificationReceivedEvent=function(t,n){this._eventSource.raiseEvent(e.InternalUpdateNotificationReceivedEventKey,new te(t,n),null)},e.prototype.raiseUpdateNotificationReceivedEvent=function(t,n){this._eventSource.raiseEvent(e.UpdateNotificationReceivedEventKey,new te(t,n),null)},e.prototype.raiseSendPersistentStateEvent=function(t,n,r){return this._eventSource.raiseEvent(e.SendPersistentStateEventKey,new ae(t,n,r),null)},e.prototype.raisePersistentStateUpdatedEvent=function(t,n){this._eventSource.raiseEvent(e.PersistentStateUpdatedEventKey,new Y.k(t,n),null)},e.prototype.raiseInternalPersistentStateUpdateEvent=function(t,n){this._eventSource.raiseEvent(e.InternalPersistentStateUpdateEventKey,new Y.k(t,n),null)},e.prototype.raisePersistentStateClearedEvent=function(t){this._eventSource.raiseEvent(e.PersistentStateClearedEventKey,new X.m(t),null)},e.prototype.raiseInternalPersistentStateClearedEvent=function(t){this._eventSource.raiseEvent(e.InternalPersistentStateClearedEventKey,new X.m(t),null)},e.prototype.raiseUpdatePersistentStateClearedRequestEvent=function(t){this._eventSource.raiseEvent(e.UpdatePersistentStateClearedRequestEventKey,new ue(t),null)},e.prototype.raiseSessionPropertiesChanged=function(t,n){this._eventSource.raiseEvent(e.SessionPropertiesChangedChangedEventKey,new le(t,n),null)},e.prototype.raiseRtcConnectFailed=function(t,n){this._eventSource.raiseEvent(e.RtcConnectFailedEventKey,new oe(t,n),null)},e.prototype.raiseGotCompletePersistentStateWithMetadataEvent=function(t){this._eventSource.raiseEvent(e.GotCompletePersistentStateWithMetadataEventKey,new ne(t),null)},e.prototype.add_connectionStateChanged=function(t){this._eventSource.addHandler(e.ConnectionStateChangedEventKey,t)},e.prototype.remove_connectionStateChanged=function(t){this._eventSource.removeHandler(e.ConnectionStateChangedEventKey,t)},e.prototype.add_refreshProxy=function(t){this._eventSource.addHandler(e.RefreshProxyEventKey,t)},e.prototype.remove_refreshProxy=function(t){this._eventSource.removeHandler(e.RefreshProxyEventKey,t)},e.prototype.add_refreshConnectionRequired=function(t){this._eventSource.addHandler(e.RefreshConnectionEventKey,t)},e.prototype.remove_refreshConnectionRequired=function(t){this._eventSource.removeHandler(e.RefreshConnectionEventKey,t)},e.prototype.add_resetMachineIdDelayRequestReceived=function(t){this._eventSource.addHandler(e.ResetMachineIdDelayEventKey,t)},e.prototype.remove_resetMachineIdDelayRequestReceived=function(t){this._eventSource.removeHandler(e.ResetMachineIdDelayEventKey,t)},e.prototype.add_refreshAllPersistentState=function(t){this._eventSource.addHandler(e.RefreshAllPersistentStateEventKey,t)},e.prototype.remove_refreshAllPersistentState=function(t){this._eventSource.removeHandler(e.RefreshAllPersistentStateEventKey,t)},e.prototype.add_updatePersistentStateRequestReceived=function(t){this._eventSource.addHandler(e.UpdatePersistentStateRequestEventKey,t)},e.prototype.remove_updatePersistentStateRequestReceived=function(t){this._eventSource.removeHandler(e.UpdatePersistentStateRequestEventKey,t)},e.prototype.add_presenceUpdated=function(t){this._eventSource.addHandler(e.PresenceUpdatedEventKey,t)},e.prototype.remove_presenceUpdated=function(t){this._eventSource.removeHandler(e.PresenceUpdatedEventKey,t)},e.prototype.add_myPresenceUpdated=function(t){this._eventSource.addHandler(e.MyPresenceUpdatedEventKey,t)},e.prototype.remove_myPresenceUpdated=function(t){this._eventSource.removeHandler(e.MyPresenceUpdatedEventKey,t)},e.prototype.add_internalPresenceUpdated=function(t){this._eventSource.addHandler(e.InternalPresenceUpdateEventKey,t)},e.prototype.remove_internalPresenceUpdated=function(t){this._eventSource.removeHandler(e.InternalPresenceUpdateEventKey,t)},e.prototype.add_sendUpdateNotification=function(t){this._eventSource.addHandler(e.SendUpdateNotificationEventKey,t)},e.prototype.remove_sendUpdateNotification=function(t){this._eventSource.removeHandler(e.SendUpdateNotificationEventKey,t)},e.prototype.add_internalUpdateNotificationReceived=function(t){this._eventSource.addHandler(e.InternalUpdateNotificationReceivedEventKey,t)},e.prototype.remove_internalUpdateNotificationReceived=function(t){this._eventSource.removeHandler(e.InternalUpdateNotificationReceivedEventKey,t)},e.prototype.add_updateNotificationReceived=function(t){this._eventSource.addHandler(e.UpdateNotificationReceivedEventKey,t)},e.prototype.remove_updateNotificationReceived=function(t){this._eventSource.removeHandler(e.UpdateNotificationReceivedEventKey,t)},e.prototype.add_persistentStateUpdated=function(t){this._eventSource.addHandler(e.PersistentStateUpdatedEventKey,t)},e.prototype.remove_persistentStateUpdated=function(t){this._eventSource.removeHandler(e.PersistentStateUpdatedEventKey,t)},e.prototype.add_internalPersistentStateUpdated=function(t){this._eventSource.addHandler(e.InternalPersistentStateUpdateEventKey,t)},e.prototype.remove_internalPersistentStateUpdated=function(t){this._eventSource.removeHandler(e.InternalPersistentStateUpdateEventKey,t)},e.prototype.add_persistentStateCleared=function(t){this._eventSource.addHandler(e.PersistentStateClearedEventKey,t)},e.prototype.remove_persistentStateCleared=function(t){this._eventSource.removeHandler(e.PersistentStateClearedEventKey,t)},e.prototype.add_internalPersistentStateCleared=function(t){this._eventSource.addHandler(e.InternalPersistentStateClearedEventKey,t)},e.prototype.remove_internalPersistentStateCleared=function(t){this._eventSource.removeHandler(e.InternalPersistentStateClearedEventKey,t)},e.prototype.add_updatePersistentStateClearedRequestReceived=function(t){this._eventSource.addHandler(e.UpdatePersistentStateClearedRequestEventKey,t)},e.prototype.remove_updatePersistentStateClearedRequestReceived=function(t){this._eventSource.removeHandler(e.UpdatePersistentStateClearedRequestEventKey,t)},e.prototype.add_sendPersistentState=function(t){this._eventSource.addHandler(e.SendPersistentStateEventKey,t)},e.prototype.remove_sendPersistentState=function(t){this._eventSource.removeHandler(e.SendPersistentStateEventKey,t)},e.prototype.add_sessionPropertiesChanged=function(t){this._eventSource.addHandler(e.SessionPropertiesChangedChangedEventKey,t)},e.prototype.remove_sessionPropertiesChanged=function(t){this._eventSource.removeHandler(e.SessionPropertiesChangedChangedEventKey,t)},e.prototype.add_rtcConnectFailed=function(t){this._eventSource.addHandler(e.RtcConnectFailedEventKey,t)},e.prototype.remove_rtcConnectFailed=function(t){this._eventSource.removeHandler(e.RtcConnectFailedEventKey,t)},e.prototype.add_gotCompletePersistentStateWithMetadata=function(t){this._eventSource.addHandler(e.GotCompletePersistentStateWithMetadataEventKey,t)},e.prototype.remove_gotCompletePersistentStateWithMetadata=function(t){this._eventSource.removeHandler(e.GotCompletePersistentStateWithMetadataEventKey,t)},e.getInstance=function(){return e._instance||(e._instance=new e)},e._instance=null,e.ConnectionStateChangedEventKey="CSC",e.RefreshProxyEventKey="RP",e.RefreshConnectionEventKey="RC",e.ResetMachineIdDelayEventKey="RMID",e.RefreshAllPersistentStateEventKey="RPS",e.UpdatePersistentStateRequestEventKey="UPSR",e.PresenceUpdatedEventKey="PU",e.MyPresenceUpdatedEventKey="MPU",e.InternalPresenceUpdateEventKey="IPU",e.SendUpdateNotificationEventKey="SUN",e.InternalUpdateNotificationReceivedEventKey="IUNR",e.UpdateNotificationReceivedEventKey="UNR",e.PersistentStateUpdatedEventKey="PSU",e.InternalPersistentStateUpdateEventKey="IPSU",e.PersistentStateClearedEventKey="PSC",e.InternalPersistentStateClearedEventKey="IPSC",e.UpdatePersistentStateClearedRequestEventKey="UPSC",e.SendPersistentStateEventKey="SP",e.SessionPropertiesChangedChangedEventKey="SPC",e.RtcConnectFailedEventKey="RCF",e.GotCompletePersistentStateWithMetadataEventKey="CPSWM",e}();(0,i.l)(pe,"51ae7d6b$RtcEventHub",null,[K]);var ge=function(){function e(e){this._rtcEventHub=null,this._throttlerManager=null,this.rtcConnectionState=0,this.explicitDisconnectInProgress=!1,this._rtcEventHub=e,this._rtcEventHub.add_connectionStateChanged(i.i(this,this.onConnectionStateChanged,"onConnectionStateChanged"))}return e.prototype.onConnectionStateChanged=function(e,t){this.rtcConnectionState=t.get_newState()},e.prototype.onTooManyUndeliveredMessages=function(){d.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection."),this._rtcEventHub.raiseRefreshConnectionEvent()},e.prototype.initThrottlerManager=function(e){this._throttlerManager.init(e)},e}();(0,i.l)(ge,"9682e28a$ARtcMessageHandler",null,[]);var he=function(){return function(){this.Presence=null,this.TimeStamp=0}}();(0,i.l)(he,"408808f$PresenceDataEntryForClients",null,[]);var _e=(0,i.y)("658d7447$IMessageHandler"),fe=function(){function e(e,t){this.$$pf_MessageId=null,this._sendMessage=null,this._sendMessage=e,this.set_messageId(t)}return e.prototype.send=function(){return this._sendMessage()},e.prototype.get_messageId=function(){return this.$$pf_MessageId},e.prototype.set_messageId=function(e){return this.$$pf_MessageId=e,e},e}();(0,i.l)(fe,"e22d1a2e$MessageHandler",null,[_e]);var me,ye,ve=(0,i.y)("ab6a918b$IMessageStatus");!function(e){e[e.pending=0]="pending",e[e.delivered=1]="delivered",e[e.undelivered=2]="undelivered"}(me||(me={})),(0,i.h)("7f565f43$MessageDeliveryState",me),function(e){e[e.pending=0]="pending",e[e.sent=1]="sent",e[e.dropped=2]="dropped"}(ye||(ye={})),(0,i.h)("686685e3$MessageSendState",ye);var Se=function(){function e(t){this._completed=!1,this._callbackInvoked=!1,this.callback=null,i.m(this,e.$$(t)),this._completedState=i.c(i.f(this,"AppRealtimeChannel.CompletionTask$1").T)}return e.prototype.onCompleted=function(e){this.callback=e,this.TriggerCompletedCallback()},e.prototype.markAsComplete=function(e){this._completed||(this._completed=!0,this._completedState=e,this.TriggerCompletedCallback())},e.prototype.TriggerCompletedCallback=function(){this._completed&&this.callback&&!this._callbackInvoked&&(this._callbackInvoked=!0,this.callback(this._completedState))},e.$$=function(t){return i.o("AppRealtimeChannel.CompletionTask$1",e,[{T:t}],null,[],{})},e}(),Ie=function(){function e(){this._messageSentTask=null,this._messageDeliveredTask=null,this._messageSentTask=new Se(ye),this._messageDeliveredTask=new Se(me)}return e.prototype.onMessageSent=function(e){this._messageSentTask.onCompleted(e)},e.prototype.onMessageDelivered=function(e){this._messageDeliveredTask.onCompleted(e)},e.prototype.markAsSent=function(e){this._messageSentTask.markAsComplete(e)},e.prototype.markAsDelivered=function(e){this._messageDeliveredTask.markAsComplete(e)},e.prototype.markAsCancelled=function(){this.markAsSent(2),this.markAsDelivered(2)},e}();(0,i.l)(Ie,"d5f1fc62$MessageStatus",null,[ve]);var Ce,Te=function(){function e(){this._startTime=null,this._stopTime=null}return e.prototype.get_ageInMilliseconds=function(){return this._startTime?this._stopTime?this._stopTime.getTime()-this._startTime.getTime():(new Date).getTime()-this._startTime.getTime():0},e.prototype.start=function(){this._startTime=new Date},e.prototype.stop=function(){this._stopTime=new Date},e}();(0,i.l)(Te,"aede2ae2$SimpleStopwatch",null,[]),function(e){e[e.contentUpdate=0]="contentUpdate",e[e.editorsTableUpdate=1]="editorsTableUpdate",e[e.fileNameUpdate=2]="fileNameUpdate",e[e.wetContentUpdate=3]="wetContentUpdate",e[e.persistedContentUpdate=4]="persistedContentUpdate",e[e.clientRtcReconnectRequest=5]="clientRtcReconnectRequest",e[e.replicationTelemetry=6]="replicationTelemetry",e[e.lockUpdate=7]="lockUpdate",e[e.collabServiceContentUpdate=8]="collabServiceContentUpdate",e[e.trackChangeSettingUpdate=9]="trackChangeSettingUpdate",e[e.saveTargetUpdate=10]="saveTargetUpdate",e[e.uploadToOcsUpdate=11]="uploadToOcsUpdate",e[e.last=12]="last"}(Ce||(Ce={})),(0,i.h)("804a58ff$UpdateNotificationType",Ce);var be=function(e){function t(t,n,r,o,a,s,u,c,d){var p=this;return p._settings=null,p._proxy=null,p._numOfMessageRoundripTimesRecorded=0,p._numOfRttMessagesRoundripTimesRecorded=0,p._loggedFirstPresenceUpdateNotification=!1,p._clientId=null,p._proxyFactory=null,p._stopwatchBuilder=null,p._messageId=0,p._clientDetailsStringForLogging=null,p._metrics=null,p._frequentMetrics=null,p._pendingNotifications=new l.n(Ce,Object),(p=e.call(this,u)||this)._settings=t,p._numOfMessageRoundripTimesRecorded=0,p._numOfRttMessagesRoundripTimesRecorded=0,p._throttlerManager=n,p._throttlerManager.add_tooManyUndeliveredMessages(i.i(p,p.onTooManyUndeliveredMessages,"onTooManyUndeliveredMessages")),p._clientId=r,p._proxyFactory=a,p._rtcEventHub.add_refreshProxy(i.i(p,p.onRefreshProxyRequired,"onRefreshProxyRequired")),p._rtcEventHub.add_refreshAllPersistentState(i.i(p,p.OnRefreshAllPersistentStateRequest,"OnRefreshAllPersistentStateRequest")),p._rtcEventHub.add_sendUpdateNotification(i.i(p,p.SendUpdateNotification,"SendUpdateNotification")),p._rtcEventHub.add_internalPresenceUpdated(i.i(p,p.OnInternalPresenceUpdated,"OnInternalPresenceUpdated")),p._rtcEventHub.add_internalUpdateNotificationReceived(i.i(p,p.OnInternalUpdateNotificationReceived,"OnInternalUpdateNotificationReceived")),p._rtcEventHub.add_internalPersistentStateUpdated(i.i(p,p.OnInternalPersistentStateUpdated,"OnInternalPersistentStateUpdated")),p._rtcEventHub.add_internalPersistentStateCleared(i.i(p,p.OnInternalPersistentStateCleared,"OnInternalPersistentStateCleared")),p._rtcEventHub.add_sendPersistentState(i.i(p,p.SendPersistentState,"SendPersistentState")),p._stopwatchBuilder=s,p._clientDetailsStringForLogging=o,p._metrics=c,p._frequentMetrics=d,p}return(0,Q.t)(t,e),t.prototype.onRefreshProxyRequired=function(e,t){this._proxy=this._proxyFactory(t.get_hubConnection()),this._throttlerManager.reset(),this._proxy.registerPresenceStateUpdated(i.i(this,this.OnPresenceUpdated,"OnPresenceUpdated")),this._proxy.registerPersistentStateUpdated(i.i(this,this.OnPersistentStateUpdated,"OnPersistentStateUpdated")),this._proxy.registerPersistentStateCleared(i.i(this,this.OnPersistentStateCleared,"OnPersistentStateCleared")),this._proxy.registerUpdateNotificationReceived(i.i(this,this.OnUpdateNotificationReceived,"OnUpdateNotificationReceived"))},t.prototype.onConnectionStateChanged=function(e,t){this.rtcConnectionState=t.get_newState(),2===t.get_newState()&&this.SendPendingUpdateNotifications()},t.prototype.SendPendingUpdateNotifications=function(){for(var e=this._pendingNotifications.$$ge();e.$$mn();){var t=e.$$cu();this.SendUpdateNotification(null,new se(t.get_key(),t.get_value(),!1,new c.z(Object)))}this._pendingNotifications=new l.n(Ce,Object)},t.prototype.OnRefreshAllPersistentStateRequest=function(e,t){t.clearExistingPersistentState();for(var n=0;n<2;++n)this.SendGetCompletePersistentStateRequest(n,t)},t.prototype.SendGetCompletePersistentStateRequest=function(e,t){var n=this;this._proxy.getCompletePersistentStateWithMetadata(e).done((function(r){t.verifyConnectionToken(t.connectionToken,"GetCompletePresenceSuccess")&&(t.connectedUsageKpi.onSuccessfulConnect(),d.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",n._clientDetailsStringForLogging),n._rtcEventHub.raiseResetMachineIdDelayEvent(),n.OnPersistentStateUpdatedWithMetadata(e,r),n._rtcEventHub.raiseGotCompletePersistentStateWithMetadataEvent(r),t.existingPersistentState.containsKey(e)&&n._rtcEventHub.raiseSendPersistentStateEvent(e,t.existingPersistentState.get_item(e),new c.z(Object)))})).fail((function(e){t.verifyConnectionToken(t.connectionToken,"GetCompletePresenceFail")&&(d.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",T.objectToString(e),n._clientDetailsStringForLogging),n._rtcEventHub.raiseRefreshConnectionEvent())})).always((function(){t.stopwatch&&t.stopwatch.stop()}))},t.prototype.SendPersistentState=function(e,t){var n=this,r=t.get_presence(),i=T.checkAndSerialize(r),o=t.get_tcs(),a=new u.w(he);if(a.set_item(this._clientId,(0,y.m)(new he,{Presence:r,TimeStamp:(new Date).getTime()})),this._rtcEventHub.raiseUpdatePersistentStateRequestEventInternal(t.get_type(),a),this._frequentMetrics.increaseMetric(1,0),2!==this.rtcConnectionState)return this._metrics.recordMessageLost(),this._frequentMetrics.increaseMetric(1,2),void o.setResult(null);var s=this._messageId.toString();++this._messageId;var l=new fe((function(){return n.SendPersistentStateInternal(t.get_type(),i,s)}),s),c=this.Throttler(0,t.get_type()).add(l);c.onMessageSent((function(e){2===e&&n._frequentMetrics.increaseMetric(1,6),o.setResult(null)})),c.onMessageDelivered((function(e){}))},t.prototype.SendPersistentStateInternal=function(e,n,r){var i=this,o=null,a=new Te,s=new Ie;return d.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this._clientDetailsStringForLogging),2!==this.rtcConnectionState?(this._metrics.recordMessageLost(),this._frequentMetrics.increaseMetric(1,2),d.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this._clientDetailsStringForLogging),s.markAsCancelled(),s):(this._stopwatchBuilder&&this._numOfMessageRoundripTimesRecorded<t.MaxMessageRoundtripTimesToRecord&&(o=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Send Presence Message"),this._numOfMessageRoundripTimesRecorded++),a.start(),s.markAsSent(1),this._proxy.updatePersistentState(e,n).done((function(){i._metrics.recordMessageSent(),i._frequentMetrics.increaseMetric(1,1),d.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",r,i._clientDetailsStringForLogging),s.markAsDelivered(1),a&&(a.stop(),a.get_ageInMilliseconds()>i._settings.get_rtcJsClientFrequentMetricsLatencyThresholdInMS()?i._frequentMetrics.increaseMetric(1,4):i._frequentMetrics.increaseMetric(1,5))})).fail((function(e){i.explicitDisconnectInProgress||(i._metrics.recordMessageLost(),i._frequentMetrics.increaseMetric(1,3),d.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",r,T.objectToString(e),i._clientDetailsStringForLogging)),s.markAsDelivered(2)})).always((function(){o&&o.stop()})),s)},t.prototype.SendUpdateNotification=function(e,t){var n=this,r=t.get_type(),i=t.get_updateHint(),o=t.get_deliverLatestNotificationWhenConnected(),a=t.get_tcs(),s=T.checkAndSerialize(i);if(this._frequentMetrics.increaseMetric(0,0),2!==this.rtcConnectionState)return o?this._pendingNotifications.set_item(r,i):(this._metrics.recordMessageLost(),this._frequentMetrics.increaseMetric(0,2)),void a.setResult(null);var l=this._messageId.toString();++this._messageId;var u=new fe((function(){return n.SendUpdateNotificationInternal(r,s,l)}),l),c=this.Throttler(1,r).add(u);c.onMessageSent((function(e){2===e&&n._frequentMetrics.increaseMetric(0,6),a.setResult(null)})),c.onMessageDelivered((function(e){}))},t.prototype.SendUpdateNotificationInternal=function(e,n,r){var i=this,o=null,a=new Te,s=new Ie;return d.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this._clientDetailsStringForLogging),2!==this.rtcConnectionState?(this._metrics.recordMessageLost(),this._frequentMetrics.increaseMetric(0,2),d.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this._clientDetailsStringForLogging),s.markAsCancelled(),s):(this._stopwatchBuilder&&3===e&&this._numOfRttMessagesRoundripTimesRecorded<t.MaxMessageRoundtripTimesToRecord&&(o=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Send WetContent Update"),this._numOfRttMessagesRoundripTimesRecorded++),a.start(),s.markAsSent(1),this._proxy.sendUpdateNotification(e,n).done((function(){i._metrics.recordMessageSent(),i._frequentMetrics.increaseMetric(0,1),d.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",r,i._clientDetailsStringForLogging),s.markAsDelivered(1),a&&(a.stop(),a.get_ageInMilliseconds()>i._settings.get_rtcJsClientFrequentMetricsLatencyThresholdInMS()?i._frequentMetrics.increaseMetric(0,4):i._frequentMetrics.increaseMetric(0,5))})).fail((function(e){i.explicitDisconnectInProgress||(i._metrics.recordMessageLost(),i._frequentMetrics.increaseMetric(0,3),d.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",r,T.objectToString(e),i._clientDetailsStringForLogging)),s.markAsDelivered(2)})).always((function(){o&&o.stop()})),s)},t.prototype.unregisterHandlers=function(){this._proxy.unregisterPresenceStateUpdated(i.i(this,this.OnPresenceUpdated,"OnPresenceUpdated")),this._proxy.unregisterPersistentStateUpdated(i.i(this,this.OnPersistentStateUpdated,"OnPersistentStateUpdated")),this._proxy.unregisterPersistentStateCleared(i.i(this,this.OnPersistentStateCleared,"OnPersistentStateCleared")),this._proxy.unregisterUpdateNotificationReceived(i.i(this,this.OnUpdateNotificationReceived,"OnUpdateNotificationReceived"))},t.prototype.OnInternalPresenceUpdated=function(e,t){this.OnPresenceUpdated(t.get_updatedClients(),t.get_disconnectedClients())},t.prototype.OnPresenceUpdated=function(e,t){this._metrics.recordMessageReceived(),this.OnPersistentStateUpdated(0,e)},t.prototype.OnInternalPersistentStateUpdated=function(e,t){this.OnPersistentStateUpdated(t.get_type(),t.get_updatedClients())},t.prototype.OnPersistentStateUpdatedWithMetadata=function(e,t){var n={};for(var r in t){var i={key:r,value:t[r]};n[i.key]=i.value.Presence}this.OnPersistentStateUpdatedInternal(e,n,t)},t.prototype.OnPersistentStateUpdated=function(e,t){this._metrics.recordMessageReceived(),this.OnPersistentStateUpdatedInternal(e,t,null)},t.prototype.OnPersistentStateUpdatedInternal=function(e,t,n){if(d.ULS.shouldTrace(500,100))for(var r in t)var i={key:r,value:t[r]};if(delete t[this._clientId],!k.j.isEmpty(t)){for(var o in t){t[c=(i={key:o,value:t[o]}).key]=T.deserialize(i.value,"Presence",c,!1)}var a=new u.w(he),s=(new Date).getTime();for(var l in t){var c=(i={key:l,value:t[l]}).key,g=void 0;n?(g=n[c]).Presence=i.value:g=(0,y.m)(new he,{Presence:i.value,TimeStamp:s}),a.set_item(c,g)}this._rtcEventHub.raiseUpdatePersistentStateRequestEventInternal(e,a),e?this._rtcEventHub.raisePersistentStateUpdatedEvent(e,t):(this._loggedFirstPresenceUpdateNotification||(d.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this._clientDetailsStringForLogging),this._loggedFirstPresenceUpdateNotification=!0,p.AFrameworkApplication.dataPlumber&&p.AFrameworkApplication.dataPlumber.markAsCoauthSession()),this._rtcEventHub.raisePresenceUpdatedEvent(t,new Array(0)))}},t.prototype.OnInternalPersistentStateCleared=function(e,t){this.OnPersistentStateCleared(t.get_clientsCleared())},t.prototype.OnPersistentStateCleared=function(e){if(this._metrics.recordMessageReceived(),d.ULS.shouldTrace(500,100))for(var t=0;t<e.length;++t);e.length&&(this._rtcEventHub.raiseUpdatePersistentStateClearedRequestEvent(e),this._rtcEventHub.raisePersistentStateClearedEvent(e),this._rtcEventHub.raisePresenceUpdatedEvent({},e))},t.prototype.OnInternalUpdateNotificationReceived=function(e,t){this.OnUpdateNotificationReceived(t.get_type(),t.get_updateHint())},t.prototype.OnUpdateNotificationReceived=function(e,t){if(this._settings.get_shouldLogOnContentNotification()&&!e&&d.ULS.sendTraceTag(40128990,500,100,"Received ContentUpdate notification from the server"),this._metrics.recordMessageReceived(),5===e)return d.ULS.sendTraceTag(18637071,500,50,"Received client reconnection request from the server - rebooting the client connection"),void this._rtcEventHub.raiseRefreshConnectionEvent();var n=T.deserialize(t,String.format("UpdateNotification-{0}",Ce[e]),null,this._settings.get_logUpdateNotificationHintOnDeserializationFailure());this._rtcEventHub.raiseUpdateNotificationReceivedEvent(e,n)},t.prototype.Throttler=function(e,t){return this._throttlerManager.getThrottler(this.GetThrottlerId(e,t))},t.prototype.GetThrottlerId=function(e,t){return e+","+t},t.MaxMessageRoundtripTimesToRecord=20,t}(ge);(0,i.l)(be,"f12474cb$RtcMessageHandler",ge,[]);var Ae=(0,i.y)("c42fd37a$IThrottlerFactory"),Me=(0,i.y)("cc178118$IMaxOutstandingThrottler"),Pe=(0,i.y)("d5396cbc$IThrottle"),Fe=function(){function e(t,n){this._totalMessageCount=0,this._throttledMessageCount=0,this._droppedMessageCount=0,this._sendCallback=null,this._isMessageBeingThrottled=!1,this._throttledMessage=null,this._throttledMessageStatus=null,this._isThrottlerInitialized=!1,this.throttlerId=null,this.setTimeout=null,this._sendCallback=t,this.throttlerId=n,this.setTimeout=e.DefaultSetTimeout,this._totalMessageCount=this._throttledMessageCount=this._droppedMessageCount=0}return e.prototype.recordMetrics=function(){this._totalMessageCount>0&&this._droppedMessageCount>0&&d.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.throttlerId,this._droppedMessageCount,this._totalMessageCount),this._totalMessageCount>0&&this._throttledMessageCount>0&&d.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.throttlerId,this._throttledMessageCount,this._totalMessageCount)},e.prototype.get_isMessageBeingThrottled=function(){return this._isMessageBeingThrottled},e.prototype.setThrottledMessage=function(e,t){this._throttledMessageCount++,this.clearThrottledMessage(!0),this._isMessageBeingThrottled=!0,this._throttledMessage=e,this._throttledMessageStatus=t},e.prototype.clearThrottledMessage=function(e){this._isMessageBeingThrottled=!1,this._throttledMessageStatus&&e&&(this._droppedMessageCount++,this._throttledMessageStatus.markAsCancelled()),this._throttledMessage=null,this._throttledMessageStatus=null},e.debugLog=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i]},e.DefaultSetTimeout=function(e,t){return window.setTimeout(e,t)},e}();(0,i.l)(Fe,"e8ecbcd2$ThrottlerBase",null,[]);var we=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.TimeToWaitForResponse=0,i.maxNumberOfOutstandingMessages=0,i.clearTimeout=null,i._numberOfPendingMessages=0,i._timeoutIds=null,i._isThrottledMessageTimerSet=!1,i._throttledMessageTimerId=0,i._connectionResetCount=0,i._countOfUndeliveredMessages=0,i._eventSource=new de.f,i._numberOfPendingMessages=0,i._timeoutIds=[],i.clearTimeout=t.DefaultClearTimeout,i}return(0,Q.t)(t,e),t.prototype.add=function(e){this._isThrottlerInitialized||this.init(t.defaultTimeToWaitForResponse,t.defaultMaxNumberOfOutstandingMessages),this._totalMessageCount++;var n=new Ie;return this.get_isMessageBeingThrottled()?this.setThrottledMessage(e,n):this._numberOfPendingMessages<this.maxNumberOfOutstandingMessages?this.SendInternal(e,n):(this.setThrottledMessage(e,n),this._isThrottledMessageTimerSet=!1),n},t.prototype.SendInternal=function(e,t){var n=this,r=this._sendCallback(e),o=this.setTimeout(i.i(this,this.OnMessageWaitTimeExpired,"OnMessageWaitTimeExpired"),this.TimeToWaitForResponse);++this._numberOfPendingMessages,Array.add(this._timeoutIds,o);var a=this._connectionResetCount;r.onMessageSent((function(e){t.markAsSent(e)})),r.onMessageDelivered((function(e){n._connectionResetCount===a&&(n.OnMessageResponseReceived(a,o),t.markAsDelivered(e))}))},t.prototype.OnMessageResponseReceived=function(e,t){this._connectionResetCount===e&&(--this._numberOfPendingMessages,this.clearTimeout(t),Array.remove(this._timeoutIds,t),this.get_isMessageBeingThrottled()&&this.SendThrottledMessageAsync())},t.prototype.SendThrottledMessageAsync=function(){this.get_isMessageBeingThrottled()&&(this._isThrottledMessageTimerSet||(this._throttledMessageTimerId=this.setTimeout(i.i(this,this.SendThrottledMessageFromTimer,"SendThrottledMessageFromTimer"),0),this._isThrottledMessageTimerSet=!0))},t.prototype.SendThrottledMessageFromTimer=function(){if(this._isThrottledMessageTimerSet=!1,this.get_isMessageBeingThrottled()){var e=this._throttledMessage,t=this._throttledMessageStatus;this.clearThrottledMessage(!1),this.SendInternal(e,t)}},t.prototype.OnMessageWaitTimeExpired=function(){++this._countOfUndeliveredMessages;var e=Math.floor(this.maxNumberOfOutstandingMessages/2);this._countOfUndeliveredMessages>e&&(this._countOfUndeliveredMessages=t.LargeNegativeNumber,this._eventSource.raiseEvent(t.TooManyUndeliveredMessagesId,null,null))},t.prototype.add_tooManyUndeliveredMessages=function(e){this._eventSource.addHandler(t.TooManyUndeliveredMessagesId,e)},t.prototype.remove_tooManyUndeliveredMessages=function(e){this._eventSource.removeHandler(t.TooManyUndeliveredMessagesId,e)},t.prototype.reset=function(){this._countOfUndeliveredMessages=0,this._totalMessageCount=this._throttledMessageCount=this._droppedMessageCount=0,++this._connectionResetCount;for(var e=0,t=this._timeoutIds;e<t.length;e++){var n=t[e];this.clearTimeout(n)}this._numberOfPendingMessages=0,this._timeoutIds=[],this.clearThrottledMessage(!0),this._isThrottledMessageTimerSet&&(this.clearTimeout(this._throttledMessageTimerId),this._throttledMessageTimerId=0,this._isThrottledMessageTimerSet=!1)},t.prototype.init=function(e,t){this._isThrottlerInitialized||(this.TimeToWaitForResponse=e,this.maxNumberOfOutstandingMessages=t,this._isThrottlerInitialized=!0)},t.createInstance=function(e,n){return new t(e,n)},t.DefaultClearTimeout=function(e){window.clearTimeout(e)},t.TooManyUndeliveredMessagesId="TMUDM",t.defaultTimeToWaitForResponse=15e3,t.defaultMaxNumberOfOutstandingMessages=5,t.LargeNegativeNumber=-1e9,t}(Fe);(0,i.l)(we,"fb13c211$MaxOutstandingThrottler",Fe,[Me,Pe]);var Re=(0,i.y)("26d6b02a$IThrottleMaxRate"),Ee=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.messageDelay=0,r._lastSent=0,r.currentTime=null,r._lastSent=new Date(0).getTime(),r.currentTime=function(){return(new Date).getTime()},r}return(0,Q.t)(t,e),t.prototype.init=function(e){this._isThrottlerInitialized||(this.messageDelay=e,this._isThrottlerInitialized=!0)},t.prototype.add=function(e){this._isThrottlerInitialized||this.init(t.defaultDelay),this._totalMessageCount++;var n=this.currentTime(),r=new Ie;return this._lastSent>n&&(this._lastSent=n),this.get_isMessageBeingThrottled()?(this.clearThrottledMessage(!0),this.setThrottledMessage(e,r)):this._lastSent+this.messageDelay<=n?this.SendInternal(e,r):(this.setThrottledMessage(e,r),this.setTimeout(i.i(this,this.SendThrottledMessage,"SendThrottledMessage"),this._lastSent+this.messageDelay-n)),r},t.prototype.SendThrottledMessage=function(){if(this.get_isMessageBeingThrottled()){var e=this._throttledMessage,t=this._throttledMessageStatus;this.clearThrottledMessage(!1),this.SendInternal(e,t)}},t.prototype.SendInternal=function(e,t){this._lastSent=this.currentTime();var n=this._sendCallback(e);n.onMessageSent((function(e){t.markAsSent(e)})),n.onMessageDelivered((function(e){t.markAsDelivered(e)}))},t.createInstance=function(e,n){return new t(e,n)},t.defaultDelay=200,t}(Fe);(0,i.l)(Ee,"9a5f0b11$MaxRateThrottler",Fe,[Re,Pe]);var ke=function(){function e(){}return e.prototype.createMaxOutstandingThrottler=function(e,t){return we.createInstance(e,t)},e.prototype.createMaxRateThrottler=function(e,t){return Ee.createInstance(e,t)},e}();(0,i.l)(ke,"6f087f33$ThrottlerFactory",null,[Ae]);var De,Oe=(0,i.y)("a8505fd$IThrottlerManager"),Ue=function(){function e(t){var n=this;this._throttlerFactory=null,this._maxRateThrottlers=null,this._maxOutstandingThrottlers=null,this._globalMaxOutstandingThrottler=null,this._settings=null,this._isInitialized=!1,this._eventSource=new de.f,this._maxRateThrottlers=new u.w(Re),this._maxOutstandingThrottlers=new u.w(Me),this._throttlerFactory=t,this._globalMaxOutstandingThrottler=this._throttlerFactory.createMaxOutstandingThrottler((function(e){return e.send()}),"GlobalMaxOustandingThrottler"),this._globalMaxOutstandingThrottler.add_tooManyUndeliveredMessages((function(){n._eventSource.raiseEvent(e.TooManyUndeliveredMessagesId,null,null)}))}return e.prototype.init=function(e){this._isInitialized||(this._settings=e,this._globalMaxOutstandingThrottler.init(this._settings.get_timeToWaitForResponse(),this._settings.get_globalMaxOutstandingMessages()),this._isInitialized=!0)},e.prototype.getThrottler=function(t){var n,r=this;if(this._isInitialized||this.init(new b(Ee.defaultDelay,we.defaultTimeToWaitForResponse,we.defaultMaxNumberOfOutstandingMessages,e.MaxOutstandingMessagesForGlobalMaxOutstandingThrottler)),!this._maxRateThrottlers.tryGetValue(t,(0,s.m)((function(){return n}),(function(e){return n=e})))){var o;if(!this._maxOutstandingThrottlers.tryGetValue(t,(0,s.m)((function(){return o}),(function(e){return o=e})))){var a="MaxOutstandingThrottler-"+t;(o=this._throttlerFactory.createMaxOutstandingThrottler(i.i(this._globalMaxOutstandingThrottler,this._globalMaxOutstandingThrottler.add,"add"),a)).init(this._settings.get_timeToWaitForResponse(),this._settings.get_maxOutstandingMessages()),o.add_tooManyUndeliveredMessages((function(){r._eventSource.raiseEvent(e.TooManyUndeliveredMessagesId,null,null)})),this._maxOutstandingThrottlers.add(t,o)}var l="MaxRateThrottler-"+t;(n=this._throttlerFactory.createMaxRateThrottler(i.i(o,o.add,"add"),l)).init(this._settings.get_messageDelayTime()),this._maxRateThrottlers.add(t,n)}return n},e.prototype.reset=function(){for(var e=this._maxRateThrottlers.getEnumerator();e.$$mn();){(n=e.$$cu()).get_value().recordMetrics()}for(var t=this._maxOutstandingThrottlers.getEnumerator();t.$$mn();){var n;(n=t.$$cu()).get_value().recordMetrics(),n.get_value().reset()}this._globalMaxOutstandingThrottler.recordMetrics(),this._globalMaxOutstandingThrottler.reset()},e.prototype.add_tooManyUndeliveredMessages=function(t){this._eventSource.addHandler(e.TooManyUndeliveredMessagesId,t)},e.prototype.remove_tooManyUndeliveredMessages=function(t){this._eventSource.removeHandler(e.TooManyUndeliveredMessagesId,t)},e.DebugLog=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i]},e.MaxOutstandingMessagesForGlobalMaxOutstandingThrottler=1e3,e.TooManyUndeliveredMessagesId="TMUDM",e}();(0,i.l)(Ue,"22e3f894$ThrottlerManager",null,[Oe]),function(e){e[e.unspecified=0]="unspecified",e[e.word=1]="word",e[e.excel=2]="excel",e[e.powerPoint=3]="powerPoint",e[e.test=4]="test",e[e.wacFrontEnd=5]="wacFrontEnd",e[e.oneNote=6]="oneNote",e[e.visio=7]="visio",e[e.last=8]="last"}(De||(De={})),(0,i.h)("76660681$RtcClientAppName",De);var xe,Le,Ne=function(){function e(){}return e.createInstance=function(t,r,i,o,a,s,l,u,c,d,g){var h=z.createInstance(p.AFrameworkApplication.appSettingsManager),_=p.AFrameworkApplication.buildVersion?p.AFrameworkApplication.buildVersion:"1.0",m=e.GenerateClientDetailsLogString(t,r,s,_),y=h.get_clientMetricsEnabled()?N.createInstance(m):new x,v=D.Create(o);h.get_rtcJsClientFrequentlyLogsMetrics()&&v.startLoggingEveryGivenMs(h.get_rtcJsClientFrequentMetricsLogIntervalInMS());var S="",I=(S=u&&""!==u?u:"/rtc2/")+"signalr",C=S+"findsession",T=V.hubName,b=new ke;d=d||pe.getInstance();var A=new be(h,new Ue(b),t,m,(function(e){return new j(e.createHubProxy(T))}),l,d,y,v);c||(c=F.createInstance(r,o,C,l,_,s,t,m,d,a,g)),c.set_findSessionRequestTimeoutInMs(h.get_findSessionRequestTimeoutInMs());var M=new f(m),P=i?i.split(","):null,w=new(n(448).RealtimeChannel)(t,P,m,l,(function(){return $.hubConnection(I)}),c,A,M,d,y,h,o);return w.init(),w},e.GenerateClientDetailsLogString=function(t,n,r,i){return String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",t,e.CapitalizeFirstLetter(De[r]),e.CapitalizeFirstLetter("browser"),n)},e.CapitalizeFirstLetter=function(e){return e?e.charAt(0).toLocaleUpperCase()+e.substring(1,e.length):e},e}();(0,i.l)(Ne,"f84e7029$RealtimeChannelFactory",null,[]),function(e){e[e.presence=0]="presence",e[e.chat=1]="chat",e[e.last=2]="last"}(xe||(xe={})),(0,i.h)("1b08d671$PersistentStateType",xe),function(e){e[e.connecting=0]="connecting",e[e.connected=1]="connected",e[e.reconnecting=2]="reconnecting",e[e.disconnected=4]="disconnected"}(Le||(Le={})),(0,i.h)("8a073fd1$connectionState",Le),n.d(t,{RealtimeChannel:function(){return Be}});var Be=function(){function e(e,t,n,r,i,o,a,s,c,d,p,g){this._clientId=null,this._connectionId=null,this._connectionState=0,this._settings=null,this._connectionFactory=null,this._connectionToken=1,this._connection=null,this._disposed=!1,this._transportProtocol=null,this._stopwatchBuilder=null,this._connectedUsageKpi=null,this._assignRtcMachineStrategy=null,this._rtcMessageHandler=null,this._clientDetailsStringForLogging=null,this._metrics=null,this._clientRequestManager=null,this._rtcEventHub=null,this._presence=new u.w(l.n.$$(xe,h)),this._lastConnectionStartTime=new Date(0).getTime(),this._clientId=e,this._transportProtocol=t,this._connectionState=0,this._stopwatchBuilder=r,this._connectedUsageKpi=s,this._rtcMessageHandler=a,this._rtcEventHub=c,this._connectionFactory=i,this._assignRtcMachineStrategy=o,this._clientDetailsStringForLogging=n,this._metrics=d,this._settings=p,this._clientRequestManager=g}return e.prototype.get_machineConnectionString=function(){return this._assignRtcMachineStrategy.get_machineConnectionString()},e.prototype.set_machineConnectionString=function(e){return this._assignRtcMachineStrategy.set_machineConnectionString(e),e},e.prototype.get_rtcMessageHandler=function(){return this._rtcMessageHandler},e.prototype.get__rtcEventHub=function(){return this._rtcEventHub},e.prototype.init=function(){var t=this;this.get__rtcEventHub().add_refreshConnectionRequired(i.i(this,this.DisconnectAndCreateNewConnection,"DisconnectAndCreateNewConnection")),this.get__rtcEventHub().add_updatePersistentStateRequestReceived(i.i(this,this.OnUpdatePersistentStateRequestReceivedInternal,"OnUpdatePersistentStateRequestReceivedInternal")),this.get__rtcEventHub().add_updatePersistentStateClearedRequestReceived(i.i(this,this.OnUpdatePersistentStateClearedRequestReceived,"OnUpdatePersistentStateClearedRequestReceived")),this._clientRequestManager.addNetworkConnectivityListener(this._metrics),p.AFrameworkApplication.subscribeToBeforeAppShutDown((function(e,n){t._metrics.recordMetricsToTelemetry()})),this.CreateNewSignalRConnection(),e.SetupLogging(),this.DisableSignalrKeepAlivesForLongPollingProtocol(),this.get__rtcEventHub().add_sessionPropertiesChanged(i.i(this,this.UpdateConnectionQueryString,"UpdateConnectionQueryString"))},e.prototype.DisableSignalrKeepAlivesForLongPollingProtocol=function(){try{var e=$.signalR;if(!e)throw Error.invalidOperation("Failed to retrieve Signalr object");var t=e.version;if(!t)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"!==t)return;var n=e.transports;if(!n)throw Error.invalidOperation("Failed to retrieve transports object");var r=n.longPolling;if(!r)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!r.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");r.supportsKeepAlive=this.CreateSignalrSupportsKeepAliveFunction()}catch(e){d.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",e.message)}},e.prototype.CreateSignalrSupportsKeepAliveFunction=function(){return function(e){return!1}},e.prototype.CreateNewSignalRConnection=function(){var e=this,t=++this._connectionToken;this._lastConnectionStartTime=new Date(0).getTime(),this._connection=this._connectionFactory(),this.get__rtcEventHub().raiseRefreshProxyEvent(this._connection),this._connection.stateChanged((function(n){e.OnConnectionStateChangedSignalR(n,t)})),this._connection.connectionSlow(i.i(this,this.OnSlowConnection,"OnSlowConnection")),this._connection.error(i.i(this,this.OnSignalRError,"OnSignalRError")),this._connection.log=i.i(this,this.OnSignalRLog,"OnSignalRLog")},e.prototype.verifyConnectionToken=function(e,t){return e===this._connectionToken||(d.ULS.sendTraceTag(4309017,500,15,"ConnectionToken verification failed for {0}",t),!1)},e.prototype.connect=function(){2!==this._connectionState&&1!==this._connectionState&&(d.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this._clientDetailsStringForLogging),this._connectedUsageKpi.onConnectStart(),this.OnConnectionStateChanged(1,this._connectionState),this.StartConnecting())},e.prototype.StartConnecting=function(){var e=this._connectionToken;this._metrics.recordConnectionAttempt(),this._assignRtcMachineStrategy.getRtcMachine(i.i(this,this.ConnectSignalrConnection,"ConnectSignalrConnection"),i.i(this,this.OnFailureToConnect,"OnFailureToConnect"),i.i(this.get_rtcMessageHandler(),this.get_rtcMessageHandler().initThrottlerManager,"initThrottlerManager"),i.i(this,this.verifyConnectionToken,"verifyConnectionToken"),e)},e.prototype.OnFailureToConnect=function(e){this._metrics.recordConnectionFailure();var t=null;this._settings.get_rtcClientDisconnectOnDssExipiredOrDeleted()&&e&&("documentsessiondeleted"===(t=e.toLowerCase())||"documentsessionexpired"===t)?(d.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this._clientDetailsStringForLogging,e),this.disconnect()):this.DisconnectAndCreateNewConnection()},e.prototype.DisconnectAndCreateNewConnection=function(){d.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this._connectionId);var e=2===this._connectionState||1===this._connectionState;e&&this.OnConnectionStateChanged(1,this._connectionState),++this._connectionToken,this.get_rtcMessageHandler().unregisterHandlers(),this.StopSignalRConnection(),this._assignRtcMachineStrategy.disposeMachineId(),this.CreateNewSignalRConnection(),e&&this.StartConnecting()},e.prototype.UpdateConnectionQueryString=function(e,t){var n=null,r=this._assignRtcMachineStrategy.getFindSessionRequestQs((0,s.m)((function(){return n}),(function(e){return n=e})));this._connection.qs=r,d.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this._clientDetailsStringForLogging,n)},e.prototype.ConnectSignalrConnection=function(e){var t=this;this._lastConnectionStartTime=(new Date).getTime();var n=null;this._connection.qs=this._assignRtcMachineStrategy.getFindSessionRequestQs((0,s.m)((function(){return n}),(function(e){return n=e}))),this._settings.get_allowCrossDomainAccessEnabled()&&(this._connection.url=e);var i=null;this._stopwatchBuilder&&(i=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","ConnectToServer")),d.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this._clientDetailsStringForLogging);var o={};this._transportProtocol&&(1===this._transportProtocol.length?o.transport=this._transportProtocol[0]:o.transport=this._transportProtocol),this._connection.start(o,null).done((function(e){t._metrics.recordConnectionSuccess(),d.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",e.id,n)})).fail((function(e){d.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, machine connection string: {1}, CorrelationId:{2}, callback parameter:{3} for [{4}]",t._assignRtcMachineStrategy.get_connectionString(),t.get_machineConnectionString(),n,T.objectToString(e),t._clientDetailsStringForLogging),t.OnFailureToConnect(null),t._metrics.recordConnectionErrorDetails(e),t.get__rtcEventHub().raiseRtcConnectFailed(0,{CorrelationId:n,ErrorDetails:e,ConnectionState:r[t._connectionState]})})).always((function(){i&&i.stop()}))},e.prototype.disconnect=function(){this._connectionState?(this._metrics.recordDisconnectedExplicitly(),d.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this._clientDetailsStringForLogging),this.get_rtcMessageHandler().explicitDisconnectInProgress=!0,this._connectedUsageKpi.onDisconnectStart(),this.OnConnectionStateChanged(0,this._connectionState),this.DisconnectAndCreateNewConnection(),this.get_rtcMessageHandler().explicitDisconnectInProgress=!1):d.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this._clientDetailsStringForLogging)},e.prototype.get_transportProtocol=function(){return 2!==this._connectionState?"":this._connection&&this._connection.transport&&this._connection.transport.name?this._connection.transport.name:""},e.prototype.StopSignalRConnection=function(){var e=this.CalculateWaitTimeForStoppingConnection(),t=this._connection,n=this._connectionId,r=function(){t.stop(!0,!0)};e>0?(d.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",n,e),window.setTimeout(r,e)):(d.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",n),r())},e.prototype.CalculateWaitTimeForStoppingConnection=function(){var t=0;return this._connection.state||(t=this._lastConnectionStartTime+e.WaitBeforeStoppingConnectionWhenInConnectingState-(new Date).getTime())<0&&(t=0),t},e.prototype.get_connectionState=function(){return this._connectionState},e.prototype.add_connectionStateChanged=function(e){this.get__rtcEventHub().add_connectionStateChanged(e)},e.prototype.remove_connectionStateChanged=function(e){this.get__rtcEventHub().remove_connectionStateChanged(e)},e.prototype.sendPresence=function(e){return this.sendPersistentState(0,e)},e.prototype.sendPersistentState=function(e,t){var n=new c.z(Object);return this.get__rtcEventHub().raiseSendPersistentStateEvent(e,t,n),n.get_task()},e.prototype.add_myPresenceUpdated=function(e){this.get__rtcEventHub().add_myPresenceUpdated(e)},e.prototype.remove_myPresenceUpdated=function(e){this.get__rtcEventHub().remove_myPresenceUpdated(e)},e.prototype.add_presenceUpdated=function(e){this.get__rtcEventHub().add_presenceUpdated(e)},e.prototype.remove_presenceUpdated=function(e){this.get__rtcEventHub().remove_presenceUpdated(e)},e.prototype.add_persistentStateUpdated=function(e){this.get__rtcEventHub().add_persistentStateUpdated(e)},e.prototype.remove_persistentStateUpdated=function(e){this.get__rtcEventHub().remove_persistentStateUpdated(e)},e.prototype.add_persistentStateCleared=function(e){this.get__rtcEventHub().add_persistentStateCleared(e)},e.prototype.remove_persistentStateCleared=function(e){this.get__rtcEventHub().remove_persistentStateCleared(e)},e.prototype.getMyPresence=function(){return this.getUserPresence(this._clientId)},e.prototype.getUserPresence=function(e){return this._presence.containsKey(e)&&this._presence.get_item(e).containsKey(0)?this._presence.get_item(e).get_item(0).get_data():null},e.prototype.getAllPresence=function(){return this.getAllPersistentState(0)},e.prototype.getAllPersistentState=function(e){for(var t={},n=this._presence.getEnumerator();n.$$mn();){var r=n.$$cu();r.get_value().containsKey(e)&&(t[r.get_key()]=r.get_value().get_item(e).get_data())}return t},e.prototype.OnUpdatePersistentStateRequestReceivedInternal=function(e,t){for(var n=t.get_updatedClientsWithMetadata().getEnumerator();n.$$mn();){var r=n.$$cu();this._presence.containsKey(r.get_key())||this._presence.set_item(r.get_key(),new l.n(xe,h));var i=r.get_value();this._presence.get_item(r.get_key()).set_item(t.type,new h(i.Presence,new Date(i.TimeStamp))),r.get_key()!==this._clientId||t.type||this.get__rtcEventHub().raiseMyPresenceUpdatedEvent(i.Presence)}},e.prototype.OnUpdatePersistentStateClearedRequestReceived=function(e,t){for(var n=0,r=t.clientsCleared;n<r.length;n++){var i=r[n];this._presence.remove(i)}},e.prototype.GetAllMyPersistentState=function(){var e=new l.n(xe,Object);if(!this._presence.containsKey(this._clientId))return e;for(var t=this._presence.get_item(this._clientId).$$ge();t.$$mn();){var n=t.$$cu();e.set_item(n.get_key(),n.get_value().get_data())}return e},e.prototype.sendUpdateNotification=function(e,t,n){var r=new c.z(Object);return this.get__rtcEventHub().raiseSendUpdateNotificationEvent(e,t,n,r),r.get_task()},e.prototype.add_updateNotificationReceived=function(e){this.get__rtcEventHub().add_updateNotificationReceived(e)},e.prototype.remove_updateNotificationReceived=function(e){this.get__rtcEventHub().remove_updateNotificationReceived(e)},e.prototype.setUserStatus=function(e){},e.prototype.getMyStatusInfo=function(){return this.getUserStatusInfo(this._clientId)},e.prototype.getUserStatusInfo=function(e){var t,n;return this._presence.tryGetValue(e,(0,s.m)((function(){return t}),(function(e){return t=e})))&&t.tryGetValue(0,(0,s.m)((function(){return n}),(function(e){return n=e})))?new g(this.GetUserStatus(n),n.get_timeStamp()):null},e.prototype.getAllUsersStatusInfo=function(){for(var e={},t=this._presence.getEnumerator(),n=function(){var n,i=t.$$cu();i.get_value().tryGetValue(0,(0,s.m)((function(){return n}),(function(e){return n=e})))&&(e[i.get_key()]=r.getUserStatusInfo(i.get_key()))},r=this;t.$$mn();)n();return e},e.prototype.get_clientId=function(){return this._clientId},e.prototype.dispose=function(){this._disposed||(this.get_rtcMessageHandler().unregisterHandlers(),this._clientRequestManager.removeNetworkConnectivityListener(this._metrics),this._metrics.recordMetricsToTelemetry(),this._disposed=!0)},e.prototype.OnConnectionStateChangedSignalR=function(e,t){this.verifyConnectionToken(t,"StateChangedSignalR")&&this.OnConnectionStateChanged(this.ConvertSignalRStateToRealTimeChannelState(e.newState),this.ConvertSignalRStateToRealTimeChannelState(e.oldState))},e.prototype.SetConnectionTimeout_DebugOnly=function(e){this._connection.disconnectTimeout=e},e.prototype.OnConnectionStateChanged=function(e,t){if(1!==this._connectionState||t||1!==e){if(this._connectionState!==t){var n=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this._connectionState,t,e]));d.ULS.sendTraceTag(3290053,500,10,n)}}else;if(this._connectionState!==e){switch(e){case 2:this._connectionId=this._connection.id,d.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this._connectionId,this._clientDetailsStringForLogging),this.LogTransportProtocol(this._connection),d.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");var r=null;this._stopwatchBuilder&&(r=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Receive First Presence"));var o=this._connectionToken;this.get__rtcEventHub().raiseRefreshAllPersistentStateEvent(i.i(this,this.verifyConnectionToken,"verifyConnectionToken"),o,this._connectedUsageKpi,i.i(this,this.ClearExistingPersistentState,"ClearExistingPersistentState"),this.GetAllMyPersistentState(),r);break;case 1:2===t&&d.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this._connectionId);break;case 0:if(!this.get_rtcMessageHandler().explicitDisconnectInProgress)return 1===t&&(d.ULS.sendTraceTag(7672737,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this._connectionId),this._metrics.recordDisconnectedUnexpectedly()),2===t&&d.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this._connectionId),void this.DisconnectAndCreateNewConnection();d.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this._connectionId)}this._connectionState=e,this.get__rtcEventHub().raiseConnectionStateChangedEvent(e,t)}},e.prototype.LogTransportProtocol=function(e){if(e&&e.transport&&e.transport.name){var t=e.transport.name,n=t.toLowerCase(),r="Transport name - {0} for [{1}]";"websockets"===n?d.ULS.sendTraceTag(4290723,500,50,r,t,this._clientDetailsStringForLogging):"serversentevents"===n?d.ULS.sendTraceTag(4290752,500,50,r,t,this._clientDetailsStringForLogging):"foreverframe"===n?d.ULS.sendTraceTag(4290753,500,50,r,t,this._clientDetailsStringForLogging):"longpolling"===n?d.ULS.sendTraceTag(4290754,500,50,r,t,this._clientDetailsStringForLogging):"mocktransport"===n||d.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",t)}else d.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")},e.prototype.OnSlowConnection=function(){d.ULS.sendTraceTag(3249544,500,50,"Detected that the connection [{0}] is slow",this._connectionId)},e.prototype.OnSignalRError=function(e){d.ULS.sendTraceTag(3249545,600,10,"SignalR ERROR for connection [{0}]: {1}",this._connectionId,T.objectToString(e)||"<empty>")},e.prototype.OnSignalRLog=function(e,t){},e.prototype.ClearExistingPersistentState=function(){var e,t=new Array(0);this._presence.tryGetValue(this._clientId,(0,s.m)((function(){return e}),(function(t){return e=t})))&&this._presence.remove(this._clientId);for(var n=this._presence.get_keys().$$ge();n.$$mn();){var r=n.$$cu();Array.add(t,r)}for(var i=0,o=t;i<o.length;i++){r=o[i];this._presence.remove(r)}e&&this._presence.set_item(this._clientId,e),this.get__rtcEventHub().raiseInternalPersistentStateClearedEvent(t)},e.prototype.ConvertSignalRStateToRealTimeChannelState=function(e){switch(e){case 0:case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",e,"Unknown SignalR state")}},e.prototype.GetUserStatus=function(e){return e&&e.get_timeStamp()&&(new Date).getTime()-e.get_timeStamp().getTime()>(this._settings.get_awayStatusOneMinuteTimeoutIsEnabled()?6e4:this._settings.get_awayCoauthorThresholdMs())?2:1},e.createInstance=function(e,t,n,r,i,o,a,s,l,u,c){return Ne.createInstance(e,t,n,r,i,o,a,s,l,u,c)},e.SetupLogging=function(){},e.debugLog=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i]},e.MaxPayloadSizeInCharacters=8e3,e.WaitBeforeStoppingConnectionWhenInConnectingState=15e3,e}();(0,i.l)(Be,"e9014771$RealtimeChannel",null,[o,a.j])},525:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(423),o=(0,i.y)("412785cd$IWetChangeLockHistogramTelemetry"),a=n(1443),s=n(363),l=n(8192),u=n(6382),c=n(8865),d=n(1822),p=n(7597),g=n(2575),h=n(3795),_=function(){function e(e,t){var n=this;this._lockManager=null,this._wetChangeLockHistogramTelemetryIsEnabled=!1,this._bucketStartInMs=0,this._bucketSizeInMs=0,this._buckets=null,this._totalBuckets=0,this._settings=null,this._isHistogramLogged=!1,this._histogramContainsData=!1,this.MaxBuckets=50,this._lockIdToLockStartTimeDictionary=new h.e(Number,Number),this._lockManager=e,this._settings=t,this._wetChangeLockHistogramTelemetryIsEnabled=t.getBooleanAppSetting("WetChangeLockHistogramTelemetryIsEnabled"),this._wetChangeLockHistogramTelemetryIsEnabled&&(this._bucketStartInMs=t.getIntAppSetting("WetChangeLockHistogramTelemetryBucketStart",100),this._bucketSizeInMs=t.getIntAppSetting("WetChangeLockHistogramTelemetryBucketSize",1e3),this._totalBuckets=t.getIntAppSetting("WetChangeLockHistogramTelemetryTotalBuckets",10),this.ValidateBucketSettings()&&(this.InitBuckets(),this._lockManager.add_onWetLockAcquired(i.i(this,this.OnWetLockAcquired,"OnWetLockAcquired")),this._lockManager.add_onWetLockReleased(i.i(this,this.OnWetLockReleased,"OnWetLockReleased")),g.AFrameworkApplication.subscribeToBeforeAppShutDown((function(e,t){n.LogWetLockDurationHistogram()}))))}return e.prototype.ValidateBucketSettings=function(){return this._totalBuckets>this.MaxBuckets||this._totalBuckets<=0?(p.ULS.sendTraceTag(41444960,304,15,"WetChangeLockTelemetry: Unsupported number of buckets of "+this._totalBuckets),!1):this._bucketStartInMs<=0?(p.ULS.sendTraceTag(41444961,304,15,"WetChangeLockTelemetry: Unsupported start of bucketing interval "+this._bucketStartInMs),!1):!(this._bucketSizeInMs<=0)||(p.ULS.sendTraceTag(41444962,304,15,"WetChangeLockTelemetry: Unsupported size of bucket "+this._bucketSizeInMs),!1)},e.prototype.InitBuckets=function(){this._buckets=new Array(this._totalBuckets);for(var e=0;e<this._totalBuckets;e++)this._buckets[e]=0},e.prototype.OnWetLockAcquired=function(e,t){var n=t.get_lockId();this.recordBeginAcquireLock(n,new Date)},e.prototype.OnWetLockReleased=function(e,t){var n=t.get_lockId();this.recordEndReleaseLock(n,new Date)},e.prototype.recordBeginAcquireLock=function(e,t){this._wetChangeLockHistogramTelemetryIsEnabled?(this._lockIdToLockStartTimeDictionary.containsKey(e)&&(p.ULS.sendTraceTag(41444992,304,15,"WetChangeLockHistogramTelemetry: "+e+" BeginAcquire seen again before Release"),this._lockIdToLockStartTimeDictionary.remove(e)),this._lockIdToLockStartTimeDictionary.add(e,t.getTime())):p.ULS.sendTraceTag(41444963,304,15,"WetChangeLockHistogramTelemetry: Not enabled")},e.prototype.recordEndReleaseLock=function(e,t){if(this._wetChangeLockHistogramTelemetryIsEnabled){var n=0;if(this._lockIdToLockStartTimeDictionary.tryGetValue(e,(0,d.m)((function(){return n}),(function(e){return n=e})))){var r=t.getTime()-n;this._lockIdToLockStartTimeDictionary.remove(e),r>0?this.AddToBucket(r):p.ULS.sendTraceTag(41444994,304,10,"WetChangeLockHistogramTelemetry: Error producing wet lock time of "+r)}}else p.ULS.sendTraceTag(41444993,304,15,"WetChangeLockHistogramTelemetry: Not enabled")},e.prototype.AddToBucket=function(e){if(this._buckets&&this._wetChangeLockHistogramTelemetryIsEnabled){var t=e-this._bucketStartInMs,n=Math.floor(t/this._bucketSizeInMs);n<=0?n=0:n>=this._totalBuckets&&(n=this._totalBuckets-1),this._buckets[n]++,this._histogramContainsData||(this._histogramContainsData=!0)}else p.ULS.sendTraceTag(41444995,304,15,"WetChangeLockHistogramTelemetry: Not enabled")},e.prototype.getWetLockDurationHistogramLog=function(){if(!this._buckets||!this._wetChangeLockHistogramTelemetryIsEnabled)return p.ULS.sendTraceTag(41444996,304,15,"WetChangeLockHistogramTelemetry: Not enabled"),"";for(var e="",t=this._bucketStartInMs,n=0;n<this._totalBuckets;n++){var r=t+this._bucketSizeInMs-1,i=t.toString(),o=r.toString();n?n===this._totalBuckets-1&&(o="Max"):i="Min",e=e+(" Bucket: ["+i+" - "+o+"] : ")+this._buckets[n],t=r+1}return e},e.prototype.LogWetLockDurationHistogram=function(){this._histogramContainsData&&this._wetChangeLockHistogramTelemetryIsEnabled&&!this._isHistogramLogged&&(p.ULS.sendTraceTag(41444997,304,50,"WetChangeLockHistogramTelemetry:"+this.getWetLockDurationHistogramLog()),this._isHistogramLogged=!0)},e}();(0,i.l)(_,"a63a1f84$WetChangeLockHistogramTelemetry",null,[o]);var f=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"WordEditor.WetChangeLockHistogramTelemetry"},e.prototype.init=function(){u.w.get_instance().resolve(_)},e.prototype.dispose=function(){},e.prototype.configure=function(e){this._container=e,e.register(_).as(o).singleInstance().usingFactory((function(){return new _(c.p.getInstance(),e.resolve(a.x))}))},e}();(0,i.l)(f,"7a83cefe$WetChangeLockHistogramTelemetryPackage",null,[s.u,l.s]),n.d(t,{Program:function(){return m}});var m=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new f,0,!1)},e}();(0,i.l)(m,"b88206e4$Program",null,[])},559:function(e,t,n){"use strict";n.r(t),t.default=window.AssistanceTaskPaneData={name:"CommandUI",attrs:{xmlns:"http://schemas.microsoft.com/sharepoint/"},children:[{name:"TaskPane",attrs:{Id:"AssistanceTaskPane",Title:"Office Assistance",Width:"330"},children:[{name:"Groups",attrs:{},children:[{name:"Group",attrs:{Id:"AssistanceIFrameContainer",IsStretched:"true"}}]}]}]}},628:function(e,t,n){"use strict";var r=n(1482),i=n(9402),o=n(1308),a=n(8129),s=n(9562),l=n(423),u=function(){return function(e,t){this.ip=e,this.user=t}}();(0,l.l)(u,"88046d8e$SerializablePresenceData",null,[]),n.d(t,{l:function(){return c}});var c=function(){function e(e,t){this._presenceUser=null,this._ip=null,this.$$pf_MatchedForRendering=!1,this.$$pf_IsRendered=!1,this.$$pf_ShowFullTooltip=!1,this._ip=t,this._presenceUser=e}return e.prototype.get_ip=function(){return this._ip},e.prototype.get_matchedForRendering=function(){return this.$$pf_MatchedForRendering},e.prototype.set_matchedForRendering=function(e){return this.$$pf_MatchedForRendering=e,e},e.prototype.get_isRendered=function(){return this.$$pf_IsRendered},e.prototype.set_isRendered=function(e){return this.$$pf_IsRendered=e,e},e.prototype.get_showFullTooltip=function(){return this.$$pf_ShowFullTooltip},e.prototype.set_showFullTooltip=function(e){return this.$$pf_ShowFullTooltip=e,e},e.prototype.get_user=function(){return this._presenceUser},e.prototype.set_user=function(e){return this._presenceUser=e,e},e.prototype.getSerializedData=function(){return new u(this.get_ip()?this.get_ip().getData():null,this.get_user().getData())},e.prototype.isEmptyPresence=function(){return!this.get_ip()},e.prototype.getHashKey=function(){return this._presenceUser.get_clientId()+(this._ip?this._ip.get_paragraphId().toString():o.h.get_nil().toString())},e.prototype.isValid=function(){var e=!!this._presenceUser&&this._presenceUser.isValid(),t=!this.get_ip()||this.get_ip().isValid();return e&&t},e.prototype.clone=function(){var t=new e;return t._presenceUser=this._presenceUser?this._presenceUser.clone():null,t._ip=this._ip?this._ip.clone():null,t.set_isRendered(this.get_isRendered()),t.set_matchedForRendering(this.get_matchedForRendering()),t.set_showFullTooltip(this.get_showFullTooltip()),t},e.createFromPlainData=function(t){var n=t;return n?new e(s.PresenceUser.createFromPlainData(n.user),n.ip?a.b.CreateFromPlainData(n.ip):null):null},e}();(0,l.l)(c,"a7480369$PresenceInfo",null,[r.b,i.v.$$(r.b)])},687:function(e,t,n){"use strict";n.d(t,{x:function(){return s}});var r=n(1822),i=n(7518),o=n(6902),a=n(423),s=function(){function e(e,t,n){this.BaseObject=null,this.UnfavoredObject=null,this.FavoredObject=null,this.BaseObject=e,this.UnfavoredObject=n,this.FavoredObject=t}return e.prototype.propertyIsDifferent=function(e){var t,n;return this.TryGetPropertyDiff(this.UnfavoredObject,e,(0,r.m)((function(){return t}),(function(e){return t=e})))&&t.get_isDifferent()||this.TryGetPropertyDiff(this.FavoredObject,e,(0,r.m)((function(){return n}),(function(e){return n=e})))&&n.get_isDifferent()},e.prototype.TryGetPropertyDiff=function(e,t,n){return new o.p(this.BaseObject,e).get_propertyDiffs().tryGetValue(i.d.toPropertyId(t),n)},e}();(0,a.l)(s,"1fbb2606$NodeTriplet",null,[])},757:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("28621af0$IStringDifference"),o=(0,r.y)("a460bdd7$IUnicodeBlocks"),a=n(363),s=n(8192),l=function(){function e(){}return e.prototype.getFirstDifferenceAsLoggingText=function(e,t){var n=this.getFirstDifference(e,t);return-1===n?String.format("length1={0}, length2={1}, no diff",e?e.length:0,t?t.length:0):String.format("length1={0}, length2={1}, diff='{2}'->'{3}' @{4}",e?e.length:0,t?t.length:0,!e||n>=e.length?null:e.charAt(n),!t||n>=t.length?null:t.charAt(n),n)},e.prototype.getFirstDifference=function(e,t){if(e===t)return-1;e=e||"",t=t||"";for(var n=0;;++n)if(n===e.length||n===t.length||e.charAt(n)!==t.charAt(n))return n},e}();(0,r.l)(l,"76430dd4$StringDifference",null,[i]);var u=function(){return function(e,t){this.charCode=0,this.description=null,this.charCode=e,this.description=t}}();(0,r.l)(u,"bddc8e8e$UBTableEntry",null,[]);var c=function(){function e(){}return e.prototype.getCharacterDistributionAsLoggingText=function(e){var t="",n=this.getUnicodeBlockCounts(e);for(var r in n){var i={key:r,value:n[r]};t+=String.format("{0}: {1}, ",i.key,i.value)}return t.length>0?t.substr(0,t.length-2):"<empty>"},e.prototype.getUnicodeBlockCounts=function(e){var t={};e=e||"";for(var n=0;n<e.length;n++){var r=this.getUnicodeBlockDescription(e.charCodeAt(n));t[r]=r in t?t[r]+1:1}return t},e.prototype.getUnicodeBlockEnd=function(t){for(var n=0,r=e._unicodeBlocks;n<r.length;n++){var i=r[n];if(t<=i.charCode)return i.charCode}return Number.MAX_VALUE},e.prototype.getUnicodeBlockDescription=function(t){for(var n=0,r=e._unicodeBlocks;n<r.length;n++){var i=r[n];if(t<=i.charCode)return i.description}return"Invalid"},e._unicodeBlocks=[new u(8,"C0 Controls 1"),new u(9,"Horizontal tab (HT)"),new u(10,"Line feed (LF)"),new u(12,"C0 Controls 2"),new u(13,"Carriage return (CR)"),new u(31,"C0 Controls 3"),new u(32,"Space"),new u(47,"ASCII Punctuation and Symbols 1"),new u(57,"ASCII Digits"),new u(64,"ASCII Punctuation and Symbols 2"),new u(90,"Uppercase Latin Alphabet"),new u(96,"ASCII Punctuation and Symbols 3"),new u(122,"Lowercase Latin Alphabet"),new u(127,"U+0000..U+007F Basic Latin"),new u(159,"C1 Controls"),new u(160,"NB Space"),new u(191,"Latin-1 Punctuation and Symbols"),new u(255,"U+0080..U+00FF Latin-1 Supplement"),new u(383,"U+0100..U+017F Latin Extended-A"),new u(591,"U+0180..U+024F Latin Extended-B"),new u(687,"U+0250..U+02AF IPA Extensions"),new u(767,"U+02B0..U+02FF Spacing Modifier Letters"),new u(879,"U+0300..U+036F Combining Diacritical Marks"),new u(1023,"U+0370..U+03FF Greek and Coptic"),new u(1279,"U+0400..U+04FF Cyrillic"),new u(1327,"U+0500..U+052F Cyrillic Supplement"),new u(1423,"U+0530..U+058F Armenian"),new u(1535,"U+0590..U+05FF Hebrew"),new u(1791,"U+0600..U+06FF Arabic"),new u(1871,"U+0700..U+074F Syriac"),new u(1919,"U+0750..U+077F Arabic Supplement"),new u(1983,"U+0780..U+07BF Thaana"),new u(2047,"U+07C0..U+07FF NKo"),new u(2111,"U+0800..U+083F Samaritan"),new u(2143,"U+0840..U+085F Mandaic"),new u(2303,"U+08A0..U+08FF Arabic Extended-A"),new u(2431,"U+0900..U+097F Devanagari"),new u(2559,"U+0980..U+09FF Bengali"),new u(2687,"U+0A00..U+0A7F Gurmukhi"),new u(2815,"U+0A80..U+0AFF Gujarati"),new u(2943,"U+0B00..U+0B7F Oriya"),new u(3071,"U+0B80..U+0BFF Tamil"),new u(3199,"U+0C00..U+0C7F Telugu"),new u(3327,"U+0C80..U+0CFF Kannada"),new u(3455,"U+0D00..U+0D7F Malayalam"),new u(3583,"U+0D80..U+0DFF Sinhala"),new u(3711,"U+0E00..U+0E7F Thai"),new u(3839,"U+0E80..U+0EFF Lao"),new u(4095,"U+0F00..U+0FFF Tibetan"),new u(4255,"U+1000..U+109F Myanmar"),new u(4351,"U+10A0..U+10FF Georgian"),new u(4607,"U+1100..U+11FF Hangul Jamo"),new u(4991,"U+1200..U+137F Ethiopic"),new u(5023,"U+1380..U+139F Ethiopic Supplement"),new u(5119,"U+13A0..U+13FF Cherokee"),new u(5759,"U+1400..U+167F Unified Canadian Aboriginal Syllabics"),new u(5791,"U+1680..U+169F Ogham"),new u(5887,"U+16A0..U+16FF Runic"),new u(5919,"U+1700..U+171F Tagalog"),new u(5951,"U+1720..U+173F Hanunoo"),new u(5983,"U+1740..U+175F Buhid"),new u(6015,"U+1760..U+177F Tagbanwa"),new u(6143,"U+1780..U+17FF Khmer"),new u(6319,"U+1800..U+18AF Mongolian"),new u(6399,"U+18B0..U+18FF Unified Canadian Aboriginal Syllabics Extended"),new u(6479,"U+1900..U+194F Limbu"),new u(6527,"U+1950..U+197F Tai Le"),new u(6623,"U+1980..U+19DF New Tai Lue"),new u(6655,"U+19E0..U+19FF Khmer Symbols"),new u(6687,"U+1A00..U+1A1F Buginese"),new u(6831,"U+1A20..U+1AAF Tai Tham"),new u(7039,"U+1B00..U+1B7F Balinese"),new u(7103,"U+1B80..U+1BBF Sundanese"),new u(7167,"U+1BC0..U+1BFF Batak"),new u(7247,"U+1C00..U+1C4F Lepcha"),new u(7295,"U+1C50..U+1C7F Ol Chiki"),new u(7375,"U+1CC0..U+1CCF Sundanese Supplement"),new u(7423,"U+1CD0..U+1CFF Vedic Extensions"),new u(7551,"U+1D00..U+1D7F Phonetic Extensions"),new u(7615,"U+1D80..U+1DBF Phonetic Extensions Supplement"),new u(7679,"U+1DC0..U+1DFF Combining Diacritical Marks Supplement"),new u(7935,"U+1E00..U+1EFF Latin Extended Additional"),new u(8191,"U+1F00..U+1FFF Greek Extended"),new u(8303,"U+2000..U+206F General Punctuation"),new u(8351,"U+2070..U+209F Superscripts and Subscripts"),new u(8399,"U+20A0..U+20CF Currency Symbols"),new u(8447,"U+20D0..U+20FF Combining Diacritical Marks for Symbols"),new u(8527,"U+2100..U+214F Letterlike Symbols"),new u(8591,"U+2150..U+218F Number Forms"),new u(8703,"U+2190..U+21FF Arrows"),new u(8959,"U+2200..U+22FF Mathematical Operators"),new u(9215,"U+2300..U+23FF Miscellaneous Technical"),new u(9279,"U+2400..U+243F Control Pictures"),new u(9311,"U+2440..U+245F Optical Character Recognition"),new u(9471,"U+2460..U+24FF Enclosed Alphanumerics"),new u(9599,"U+2500..U+257F Box Drawing"),new u(9631,"U+2580..U+259F Block Elements"),new u(9727,"U+25A0..U+25FF Geometric Shapes"),new u(9983,"U+2600..U+26FF Miscellaneous Symbols"),new u(10175,"U+2700..U+27BF Dingbats"),new u(10223,"U+27C0..U+27EF Miscellaneous Mathematical Symbols-A"),new u(10239,"U+27F0..U+27FF Supplemental Arrows-A"),new u(10495,"U+2800..U+28FF Braille Patterns"),new u(10623,"U+2900..U+297F Supplemental Arrows-B"),new u(10751,"U+2980..U+29FF Miscellaneous Mathematical Symbols-B"),new u(11007,"U+2A00..U+2AFF Supplemental Mathematical Operators"),new u(11263,"U+2B00..U+2BFF Miscellaneous Symbols and Arrows"),new u(11359,"U+2C00..U+2C5F Glagolitic"),new u(11391,"U+2C60..U+2C7F Latin Extended-C"),new u(11519,"U+2C80..U+2CFF Coptic"),new u(11567,"U+2D00..U+2D2F Georgian Supplement"),new u(11647,"U+2D30..U+2D7F Tifinagh"),new u(11743,"U+2D80..U+2DDF Ethiopic Extended"),new u(11775,"U+2DE0..U+2DFF Cyrillic Extended-A"),new u(11903,"U+2E00..U+2E7F Supplemental Punctuation"),new u(12031,"U+2E80..U+2EFF CJK Radicals Supplement"),new u(12255,"U+2F00..U+2FDF Kangxi Radicals"),new u(12287,"U+2FF0..U+2FFF Ideographic Description Characters"),new u(12351,"U+3000..U+303F CJK Symbols and Punctuation"),new u(12447,"U+3040..U+309F Hiragana"),new u(12543,"U+30A0..U+30FF Katakana"),new u(12591,"U+3100..U+312F Bopomofo"),new u(12687,"U+3130..U+318F Hangul Compatibility Jamo"),new u(12703,"U+3190..U+319F Kanbun"),new u(12735,"U+31A0..U+31BF Bopomofo Extended"),new u(12783,"U+31C0..U+31EF CJK Strokes"),new u(12799,"U+31F0..U+31FF Katakana Phonetic Extensions"),new u(13055,"U+3200..U+32FF Enclosed CJK Letters and Months"),new u(13311,"U+3300..U+33FF CJK Compatibility"),new u(19903,"U+3400..U+4DBF CJK Unified Ideographs Extension A"),new u(19967,"U+4DC0..U+4DFF Yijing Hexagram Symbols"),new u(40959,"U+4E00..U+9FFF CJK Unified Ideographs"),new u(42127,"U+A000..U+A48F Yi Syllables"),new u(42191,"U+A490..U+A4CF Yi Radicals"),new u(42239,"U+A4D0..U+A4FF Lisu"),new u(42559,"U+A500..U+A63F Vai"),new u(42655,"U+A640..U+A69F Cyrillic Extended-B"),new u(42751,"U+A6A0..U+A6FF Bamum"),new u(42783,"U+A700..U+A71F Modifier Tone Letters"),new u(43007,"U+A720..U+A7FF Latin Extended-D"),new u(43055,"U+A800..U+A82F Syloti Nagri"),new u(43071,"U+A830..U+A83F Common Indic Number Forms"),new u(43135,"U+A840..U+A87F Phags-pa"),new u(43231,"U+A880..U+A8DF Saurashtra"),new u(43263,"U+A8E0..U+A8FF Devanagari Extended"),new u(43311,"U+A900..U+A92F Kayah Li"),new u(43359,"U+A930..U+A95F Rejang"),new u(43391,"U+A960..U+A97F Hangul Jamo Extended-A"),new u(43487,"U+A980..U+A9DF Javanese"),new u(43615,"U+AA00..U+AA5F Cham"),new u(43647,"U+AA60..U+AA7F Myanmar Extended-A"),new u(43743,"U+AA80..U+AADF Tai Viet"),new u(43775,"U+AAE0..U+AAFF Meetei Mayek Extensions"),new u(43823,"U+AB00..U+AB2F Ethiopic Extended-A"),new u(44031,"U+ABC0..U+ABFF Meetei Mayek"),new u(55215,"U+AC00..U+D7AF Hangul Syllables"),new u(55295,"U+D7B0..U+D7FF Hangul Jamo Extended-B"),new u(56191,"U+D800..U+DB7F High Surrogates"),new u(56319,"U+DB80..U+DBFF High Private Use Surrogates"),new u(57343,"U+DC00..U+DFFF Low Surrogates"),new u(63743,"U+E000..U+F8FF Private Use Area"),new u(64255,"U+F900..U+FAFF CJK Compatibility Ideographs"),new u(64335,"U+FB00..U+FB4F Alphabetic Presentation Forms"),new u(65023,"U+FB50..U+FDFF Arabic Presentation Forms-A"),new u(65039,"U+FE00..U+FE0F Variation Selectors"),new u(65055,"U+FE10..U+FE1F Vertical Forms"),new u(65071,"U+FE20..U+FE2F Combining Half Marks"),new u(65103,"U+FE30..U+FE4F CJK Compatibility Forms"),new u(65135,"U+FE50..U+FE6F Small Form Variants"),new u(65279,"U+FE70..U+FEFF Arabic Presentation Forms-B"),new u(65519,"U+FF00..U+FFEF Halfwidth and fullwidth forms"),new u(65535,"U+FFF0..U+FFFF Specials"),new u(65663,"U+10000..U+1007F Linear B Syllabary"),new u(65791,"U+10080..U+100FF Linear B Ideograms"),new u(65855,"U+10100..U+1013F Aegean Numbers"),new u(65935,"U+10140..U+1018F Ancient Greek Numbers"),new u(65999,"U+10190..U+101CF Ancient Symbols"),new u(66047,"U+101D0..U+101FF Phaistos Disc"),new u(66207,"U+10280..U+1029F Lycian"),new u(66271,"U+102A0..U+102DF Carian"),new u(66351,"U+10300..U+1032F Old Italic"),new u(66383,"U+10330..U+1034F Gothic"),new u(66463,"U+10380..U+1039F Ugaritic"),new u(66527,"U+103A0..U+103DF Old Persian"),new u(66639,"U+10400..U+1044F Deseret"),new u(66687,"U+10450..U+1047F Shavian"),new u(66735,"U+10480..U+104AF Osmanya"),new u(67647,"U+10800..U+1083F Cypriot Syllabary"),new u(67679,"U+10840..U+1085F Imperial Aramaic"),new u(67871,"U+10900..U+1091F Phoenician"),new u(67903,"U+10920..U+1093F Lydian"),new u(67999,"U+10980..U+1099F Meroitic Hieroglyphs"),new u(68095,"U+109A0..U+109FF Meoritic Cursive"),new u(68191,"U+10A00..U+10A5F Kharoshthi"),new u(68223,"U+10A60..U+10A7F Old South Arabian"),new u(68415,"U+10B00..U+10B3F Avestan"),new u(68447,"U+10B40..U+10B5F Inscriptional Parthian"),new u(68479,"U+10B60..U+10B7F Inscriptional Pahlavi"),new u(68687,"U+10C00..U+10C4F Old Turkic"),new u(69247,"U+10E60..U+10E7F Rumi Numeral Symbols"),new u(69759,"U+11000..U+1107F Brahmi"),new u(69839,"U+11080..U+110CF Kaithi"),new u(69887,"U+110D0..U+110FF Sora Sompeng"),new u(69967,"U+11100..U+1114F Chakma"),new u(70111,"U+11180..U+111DF Sharada"),new u(71375,"U+11680..U+116CF Takri"),new u(74751,"U+12000..U+123FF Cuneiform"),new u(74879,"U+12400..U+1247F Cuneiform Numbers and Punctuation"),new u(78895,"U+13000..U+1342F Egyptian Hieroglyphs"),new u(92735,"U+16800..U+16A3F Bamum Supplement"),new u(94111,"U+16F00..U+16F9F Miao"),new u(110847,"U+1B000..U+1B0FF Kana Supplement"),new u(119039,"U+1D000..U+1D0FF Byzantine Musical Symbols"),new u(119295,"U+1D100..U+1D1FF Musical Symbols"),new u(119375,"U+1D200..U+1D24F Ancient Greek Musical Notation"),new u(119647,"U+1D300..U+1D35F Tai Xuan Jing Symbols"),new u(119679,"U+1D360..U+1D37F Counting Rod Numerals"),new u(120831,"U+1D400..U+1D7FF Mathematical Alphanumeric Symbols"),new u(126719,"U+1EE00..U+1EEFF Arabic Mathematical Alphabetic Symbols"),new u(127023,"U+1F000..U+1F02F Mahjong Tiles"),new u(127135,"U+1F030..U+1F09F Domino Tiles"),new u(127231,"U+1F0A0..U+1F0FF Playing Cards"),new u(127487,"U+1F100..U+1F1FF Enclosed Alphanumeric Supplement"),new u(127743,"U+1F200..U+1F2FF Enclosed Ideographic Supplement"),new u(128511,"U+1F300..U+1F5FF Miscellaneous Symbols and Pictographs"),new u(128591,"U+1F600..U+1F64F Emoticons"),new u(128767,"U+1F680..U+1F6FF Transport and Map Symbols"),new u(128895,"U+1F700..U+1F77F Alchemical Symbols"),new u(173791,"U+20000..U+2A6DF CJK Unified Ideographs Extension B"),new u(177983,"U+2A700..U+2B73F CJK Unified Ideographs Extension C"),new u(178207,"U+2B740..U+2B81F CJK Unified Ideographs Extension D"),new u(195103,"U+2F800..U+2FA1F CJK Compatibility Ideographs Supplement"),new u(917631,"U+E0000..U+E007F Tags"),new u(917999,"U+E0100..U+E01EF Variation Selectors Supplement"),new u(1048575,"U+F0000..U+FFFFF Supplementary Private Use Area-A"),new u(1114111,"U+100000..U+10FFFF Supplementary Private Use Area-B")],e}();(0,r.l)(c,"439ddd33$UnicodeBlocks",null,[o]);var d=n(1526);n.d(t,{SensitiveLoggingPackage:function(){return p}});var p=function(){function e(){this._container=null}return e.prototype.configure=function(e){this._container=e,this._container.register(l).as(i).singleInstance(),this._container.register(c).as(o).singleInstance()},e.prototype.get_name=function(){return"Common.App.SensitiveLogging"},e.prototype.init=function(){this._container.resolve(i),this._container.resolve(o)},e.prototype.dispose=function(){},e.main=function(){d.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(p,"a59047e3$SensitiveLoggingPackage",null,[a.u,s.s])},833:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var r=n(3748),i=n(7518),o=n(6902),a=n(423),s=function(){function e(e,t){this.mergeableObject=null,this._touchedProperties=null,this.mergeableObject=t&&e?e.cloneForMerge():e,this._touchedProperties=new r.f(Number)}return e.prototype.addTouchedProperty=function(e){this._touchedProperties.add(i.d.toPropertyId(e))},e.prototype.touchesProperty=function(e){return this._touchedProperties.contains(i.d.toPropertyId(e))},e.prototype.getTouchedProperties=function(){return this._touchedProperties},e.prototype.setTouchedProperties=function(e){this._touchedProperties=e},e.prototype.mergeWith=function(e){var t=this;this.mergeableObject&&new o.p(this.mergeableObject,e).get_propertyDiffs().forEach((function(e,n){if(n.get_isDifferent()&&!t._touchedProperties.contains(e))if(t._touchedProperties.add(e),n.get_isDeleted()){var r=t.mergeableObject;r.hasProperty(i.d.fromPropertyId(e))&&r.removeProperty(i.d.fromPropertyId(e))}else t.mergeableObject.setMergeableProperty(i.d.fromPropertyId(e),n.get_newValue());return!0}))},e}();(0,a.l)(s,"baec84a6$PartialMergeResult",null,[])},865:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(3545),o=n(7562),a=n(423),s=(0,a.y)("a12493da$IAccessibilityCheckService"),l=n(1796),u=n(5268),c=n(7862),d=(0,a.y)("a4dcddb4$IAccessibilityCheckManager"),p=n(1775),g=n(363),h=n(8192),_=function(){function e(){this._accessibilityCheckManager=null,this.container=null}return e.prototype.configure=function(e){this.container=e},e.prototype.init=function(){this._accessibilityCheckManager=this.container.resolve(d)},e.prototype.dispose=function(){this._accessibilityCheckManager&&this._accessibilityCheckManager.dispose()},e}();(0,a.l)(_,"eff08ab4$ALiveBooksAccessibilityCheckPackageManager",null,[g.u,h.s]);var f=n(2575),m=n(3772),y=n(1090),v=n(4764),S=n(5362),I=n(9423),C=n(8515),T=n(4302),b=n(9009),A=n(7589),M=n(7597),P=n(6935),F=n(3068),w=function(e){function t(t,n,r,i,o,a,s,l,u){var c=this;return c._taskPaneUtils=null,c._appFrame=null,c._externalHelpLinkUrl=null,c._rootPane=null,c.taskPane=null,(c=e.call(this,t,n,r,i,o,null,null,null,null,null,u)||this)._externalHelpLinkUrl=l,c._taskPaneUtils=a,c._appFrame=s,c}return(0,i.t)(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this.taskPane&&(this._taskPaneUtils.disposeTaskPane(t.taskPaneId,this.taskPane),this.taskPane=null)},t.prototype.get_rootPane=function(){var e=this;if(!this._rootPane){M.ULS.shipAssertTag(20730845,334,!!this._taskPaneUtils,null);var n=new P.CuiHelper(F.f.box4ImageBase,CommonUIStrings,null,null,null);this.taskPane=this._taskPaneUtils.createTaskPaneFromResource(t.taskPaneId,1,300,t.taskPaneDataName,n),this.taskPane.get_element().removeChild(this.taskPane.get_element().firstChild),f.AFrameworkApplication.get_activeFrame()&&f.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactTaskPaneInfrastructureEnabled()&&this.taskPane.registerOnTaskPaneShown((function(t){t===e.taskPane&&e.resizeCheckResultSurface()})),this._rootPane=this.taskPane.getStretchedGroupBodyElement()}return this._rootPane},t.prototype.set_rootPane=function(e){return this._rootPane=e,e},t.prototype.show=function(){M.ULS.shipAssertTag(20730846,334,!!this._taskPaneUtils,null),M.ULS.shipAssertTag(20730847,334,!!this._appFrame,null),M.ULS.shipAssertTag(20730848,334,!!this.taskPane,null),this._taskPaneUtils.showTaskPane(this.taskPane),this._appFrame.updateCommandUI(!0)},t.prototype.hide=function(){M.ULS.shipAssertTag(20730849,334,!!this._taskPaneUtils,null),M.ULS.shipAssertTag(20730850,334,!!this.taskPane,null),this._taskPaneUtils.hideTaskPane(this.taskPane)},t.prototype.get_isVisible=function(){return!!this.taskPane&&this.taskPane.get_isTaskPaneVisible()},t.prototype.set_isVisible=function(e){return e},t.prototype.get_externalHelpLinkUrl=function(){return this._externalHelpLinkUrl},t.taskPaneId="AccCheckerTaskPane",t.taskPaneDataName="AccCheckerPaneData",t}(A.AAccessibilityCheckPane);(0,a.l)(w,"e88031a6$LiveBooksAccessibilityCheckPane",A.AAccessibilityCheckPane,[]);var R=n(7314),E=n(5214),k=n(870),D=function(){return function(){this.type="AccCheckerTaskPaneProps",this.onRecheckExecute=null,this.accessibilityCheckResultCollection=null,this.resultsReady=!1,this.onInvokeNavigateExecute=null,this.helpLink=null,this.outOfSync=!1,this.partialResult=!1,this.updateLastScanTime=null}}();(0,a.l)(D,"d469073c$AccCheckerTaskPaneProps",null,[]);var O=n(4551),U=n(8246),x=n(406),L=n(287),N=n(6382),B=function(e){function t(t,n,r,i,o,a,s){var l=this;return l._reactTaskPaneManager=null,l._accessibilityCheckResultCollection=null,l._resultsReady=!1,l._scanning=!1,l._outOfSync=!1,l._partialResult=!1,l._reactPaneIsVisible=!1,l._updateLastScanTime=null,(l=e.call(this,n,r,i,o,null,null,s)||this)._reactTaskPaneManager=new U.j(D),N.w.get_instance().resolve(R.d).getScriptLoader().loadScript("accessibility-checker-pane-strings").catch((function(e){return M.ULS.sendTraceTag(41302158,334,10,"Failed to load the resources for the accessibilityChecker feature: {0}",e)})),l}return(0,i.t)(t,e),t.prototype.get_isVisible=function(){return this._reactPaneIsVisible},t.prototype.set_isVisible=function(e){return this._reactPaneIsVisible=e,e},t.prototype.displayResults=function(e){e&&(this._accessibilityCheckResultCollection=e,e.IsSuccess&&(this._resultDictionary=this.buildResultDictionary(e),e.IsPartialResult&&this.showHidePartialResultNotification(!0)),this._resultsReady=!0,this._scanning=!1,this.UpdateReactPane())},t.prototype.showHideOutOfSyncNotification=function(e){this.get_isVisible()&&e!==this._outOfSync&&(this._outOfSync=e,this.UpdateReactPane())},t.prototype.showHidePartialResultNotification=function(e){this._partialResult=e,this.UpdateReactPane()},t.prototype.showHideNotification=function(e,t){},t.prototype.showPane=function(){var e=this;this._scanning||L.UISurfaces.getTaskPaneAPIAsync().then((function(n){return n.showTaskPane(t._accCheckerTaskPaneName,e.CreateTaskPaneData()),e.invokeRecheckButton(),null}))},t.prototype.UpdateReactPane=function(){var e=this;L.UISurfaces.getTaskPaneAPIAsync().then((function(n){return n.updateTaskPane(t._accCheckerTaskPaneName,e.CreateTaskPaneData()),null}))},t.prototype.CreateTaskPaneData=function(){var e=this,t=new D;return this._reactTaskPaneManager.setProps(t),(0,E.m)(new x.q,{title:this._stringsProvider.get_paneTitle(),hideHeader:!1,width:320,location:2,contentProps:t,onOpen:function(t){e.SetFocusScopeForShow(),e.set_isVisible(!0),f.AFrameworkApplication.get_activeFrame().updateCommandUI(!1)},onClose:function(t){e.SetFocusScopeForHide(),e.set_isVisible(!1),e._resultsReady=!1,e._scanning=!1,e.UpdateReactPane(),f.AFrameworkApplication.get_activeFrame().updateCommandUI(!1)}})},t.prototype.initialize=function(e){var n=this._focusManager.getScope(t._accCheckerTaskPaneName);n.parent=O.AFrame.mainAppFocusId,n.set_keyDownHandledExternally(!0),this._accessibilityCheckManager=e,this.AddAccessibilityCheckerTaskPaneProps()},t.prototype.dispose=function(){this.unregisterActions(),this._outOfSyncNotification&&(this._outOfSyncNotification.dispose(),this._outOfSyncNotification=null),this._partialResultNotification&&(this._partialResultNotification.dispose(),this._partialResultNotification=null),e.prototype.dispose.call(this)},t.prototype.AddAccessibilityCheckerTaskPaneProps=function(){this._reactTaskPaneManager.registerDataCallback(this.OnRecheckExecute()),this._reactTaskPaneManager.registerDataCallback(this.GetAccessibilityCheckResultCollection()),this._reactTaskPaneManager.registerDataCallback(this.GetResultsReady()),this._reactTaskPaneManager.registerDataCallback(this.OnInvokeNavigateExecute()),this._reactTaskPaneManager.registerDataCallback(this.GetHelpLink()),this._reactTaskPaneManager.registerDataCallback(this.GetOutOfSync()),this._reactTaskPaneManager.registerDataCallback(this.GetPartialResult()),this._reactTaskPaneManager.registerDataCallback(this.UpdateLastScanTime())},t.prototype.OnRecheckExecute=function(){var e=this;return function(t){t.onRecheckExecute=function(){e.invokeRecheckButton()}}},t.prototype.GetAccessibilityCheckResultCollection=function(){var e=this;return function(t){t.accessibilityCheckResultCollection=e._accessibilityCheckResultCollection}},t.prototype.GetResultsReady=function(){var e=this;return function(t){t.resultsReady=e._resultsReady}},t.prototype.OnInvokeNavigateExecute=function(){var e=this;return function(t){t.onInvokeNavigateExecute=function(t){e.invokeNavigate(t)}}},t.prototype.GetHelpLink=function(){var e=this;return function(t){t.helpLink=e.get_externalHelpLinkUrl()}},t.prototype.GetOutOfSync=function(){var e=this;return function(t){t.outOfSync=e._outOfSync}},t.prototype.GetPartialResult=function(){var e=this;return function(t){t.partialResult=e._partialResult}},t.prototype.UpdateLastScanTime=function(){var e=this;return function(t){t.updateLastScanTime=function(t){e._updateLastScanTime=t}}},t.prototype.invokeRecheckButton=function(){this._resultsReady=!1,this._outOfSync=!1,this._partialResult=!1,this._updateLastScanTime&&this._updateLastScanTime(),this.UpdateReactPane(),this._scanning=!0,this._accessibilityCheckManager.onCheckButtonClick()},t.prototype.SetFocusScopeForShow=function(){this._focusManager.setScope(t._accCheckerTaskPaneName)},t.prototype.SetFocusScopeForHide=function(){if(this.IsTaskPaneInFocus()){var e;e=this._focusManager.get_defaultScopeName(),this._focusManager.setScope(e)}},t.prototype.IsTaskPaneInFocus=function(){return!!this._focusManager.get_currentScope()&&this._focusManager.get_currentScope().name===t._accCheckerTaskPaneName},t._accCheckerTaskPaneName="AccessibilityCheckerPane",t}(k.m);(0,a.l)(B,"e158be35$ReactAccessibilityCheckPane",k.m,[]);var H=function(e){function t(t,n,r,i,o,a,s,l){var u=this;return u._taskPaneUtils=null,u._externalHelpLinkUrl=null,(u=e.call(this,t,n,r,i,o,null,l)||this)._externalHelpLinkUrl=s,u._taskPaneUtils=a,u}return(0,i.t)(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.prototype.get_externalHelpLinkUrl=function(){return this._externalHelpLinkUrl},t.prototype.showPane=function(){this._taskPaneUtils.createReactTaskPaneContainer(),e.prototype.showPane.call(this)},t}(B);(0,a.l)(H,"1d56f767$ReactLiveBooksAccessibilityCheckPane",B,[]);var $=n(618),G=n(8047),W=n(163),V=n(9910),j=n(8114),q=n(2192),z=function(){function e(e,t,n){this.accessibilityCheckPane=null,this._accessibilityCheckService=null,this._isComponentsInitialized=!1,this._accessibilityRuleCache=null,this._actionManager=null,this._accessibilityRuleCache=null,this._isComponentsInitialized=!1,this.accessibilityCheckPane=e,this._accessibilityCheckService=t,this._actionManager=n,this.get_actionManager().addAction(V.b.closeAccessibilityCheckerPane,q.m.frame,a.i(this,this.closePane,"closePane"))}return e.prototype.get_actionManager=function(){return this._actionManager||(this._actionManager=f.AFrameworkApplication.get_theActionManager())},e.prototype.set_actionManager=function(e){return this._actionManager=e,e},e.prototype.EnsureComponentsInitialized=function(){this._isComponentsInitialized||(this.accessibilityCheckPane.initialize(this),this._accessibilityCheckService.initialize(this),this._isComponentsInitialized=!0)},e.prototype.onCheckButtonClick=function(){W.r.traceTag(19969184,200,50,"{0}",{AccCheckInvoked:1}),this._accessibilityCheckService.runAccessibilityCheck()},e.prototype.showPane=function(e,t,n,r,i){return 1===n?32:(this.accessibilityCheckPane.get_isVisible()||this.EnsureComponentsInitialized(),this.accessibilityCheckPane.showPane(),32)},e.prototype.closePane=function(e,t,n,r,i){return 1!==n&&this.accessibilityCheckPane.hidePane(),32},e.prototype.onResultOutOfSync=function(){this.accessibilityCheckPane.showHideOutOfSyncNotification(!0)},e.prototype.displayResults=function(e){if(e){if(e.AccessibilityRules&&Object.keys(e.AccessibilityRules).length){var t=e.AccessibilityRules;for(var n in t){var r={key:n,value:t[n]},i=r.value.RuleId+"";r.key!==i&&W.r.traceTag(36214998,200,15,"AccessibilityRules is malformed: rule ID {0} maps to rule with ID {1}",r.key,i)}this._accessibilityRuleCache=t}else!this._accessibilityRuleCache&&e.Results&&e.Results.length>0?(W.r.traceTag(18993251,200,15,"No accessibility rule definitions available"),e.IsSuccess=!1):e.AccessibilityRules=this._accessibilityRuleCache;e.IsSuccess||W.r.traceTag(19969185,200,50,"{0}",{accCheckFailed:1}),this.RemoveInvalidResults(e),this.logRuleAndCategoryTelemetry(e),this.accessibilityCheckPane.displayResults(e)}},e.prototype.RemoveInvalidResults=function(e){var t=e.AccessibilityRules,n=e.Results;if(n)for(var r=n.length-1;r>=0;r--){var i=n[r],o="",a=i.RuleId;i.ContentName||(o+="Result does not have content name. "),a in t||(o+=String.format("No accessibility check rule exists for ID {0}.",a)),o.length>0&&(W.r.traceTag(36214999,200,15,"Omitting invalid accessibility check result: "+o),Array.removeAt(n,r))}},e.prototype.logRuleAndCategoryTelemetry=function(e){var t={},n={},r=e.Results,i='{{"EventType":"AccCheckerViolationInformation","Violation":"{0}"';if(r){for(var o=0,a=r;o<a.length;o++){var s=a[o];if(e.AccessibilityRules){var l=e.AccessibilityRules[s.RuleId];if(l){if(t[j.v[l.Category]]){var u=t[j.v[l.Category]];t[j.v[l.Category]]=++u}else t[j.v[l.Category]]=1;if(n[s.RuleId]){u=n[s.RuleId];n[s.RuleId]=++u}else n[s.RuleId]=1}}}for(var c in i=String.format(i,r.length),t){var d={key:c,value:t[c]};i+=',"'+d.key+'":"'+d.value.toString()+'"'}}else i=String.format(i,0);for(var p in i+="}",M.ULS.sendTraceTag(39188058,334,50,i),n){var g={key:p,value:n[p]};M.ULS.sendTraceTag(39188059,334,50,'{"EventType":"AccCheckerViolationCountPerRule","RuleId":"'+g.key+'","Count":"'+g.value.toString()+'"}')}},e.prototype.dispose=function(){this.accessibilityCheckPane&&this.accessibilityCheckPane.dispose(),this._accessibilityCheckService&&this._accessibilityCheckService.dispose()},e}();(0,a.l)(z,"3bbb90bc$AAccessibilityCheckManager",null,[d,Sys.IDisposable]);var K=n(6363),Q=function(e){function t(t,n,r){var i=this;return i.graph=null,(i=e.call(this,n,r,t)||this).registerActions(),i}return(0,i.t)(t,e),t.prototype.queryToggleAccCheckerPane=function(e,t,n,r,i){return 1===n?32:(i[K.e.On]=this.accessibilityCheckPane.get_isVisible(),32)},t.prototype.registerOutOfSyncHandlers=function(){for(var e=0,t=this.get_nodeTypes();e<t.length;e++){var n=t[e],r=this.graph.getSpecificEventHandlers(n);r.add_onPropertyChanged(a.i(this,this.onPropertyChanged,"onPropertyChanged")),r.add_onConnected(a.i(this,this.onConnected,"onConnected")),r.add_onDisconnected(a.i(this,this.onDisconnected,"onDisconnected"))}},t.prototype.unregisterOutOfSyncHandlers=function(){for(var e=0,t=this.get_nodeTypes();e<t.length;e++){var n=t[e],r=this.graph.getSpecificEventHandlers(n);r.remove_onPropertyChanged(a.i(this,this.onPropertyChanged,"onPropertyChanged")),r.remove_onConnected(a.i(this,this.onConnected,"onConnected")),r.remove_onDisconnected(a.i(this,this.onDisconnected,"onDisconnected"))}},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.unregisterOutOfSyncHandlers()},t.prototype.onPropertyChanged=function(e,t){this.onResultOutOfSync()},t.prototype.onConnected=function(e,t){this.onResultOutOfSync()},t.prototype.onDisconnected=function(e,t){this.onResultOutOfSync()},t}(z);(0,a.l)(Q,"40c80c2e$ALiveBooksAccessibilityCheckManager",z,[]);var Z=function(e){function t(t,n,r,i,o,a){var s=this;return s._navigateManager=null,s._isOdt=!1,(s=e.call(this,t,n,r)||this).graph=o,s._navigateManager=i,s._isOdt=a,s.registerOutOfSyncHandlers(),s}return(0,i.t)(t,e),t.prototype.get_nodeTypes=function(){return[12,14,22,19,30,43,44]},t.prototype.registerActions=function(){this.get_actionManager().addAction(V.b.showAccessibilityCheckerPane,q.m.frame,a.i(this,this.showPane,"showPane")),this.get_actionManager().addActionWithFlags(V.b.queryToggleAccCheckerButton,q.m.frame,a.i(this,this.queryToggleAccCheckerPane,"queryToggleAccCheckerPane"),96)},t.prototype.setFocusOnContent=function(e){return this._isOdt?(M.ULS.sendTraceTag(20713608,334,15,"ODT file. Disable content navigation."),!0):(M.ULS.shipAssertTag(20272215,334,!!e,null),this._navigateManager.navigateTo(e))},t}(Q);(0,a.l)(Z,"7f531eee$WordAccessibilityCheckManager",Q,[]);var J=(0,a.y)("916aa480$IWordAccessibilityCheckNavigateManager"),X=n(2506),Y=n(7106),ee=n(5516),te=n(9658),ne=n(6057),re=n(1302),ie=n(1783),oe=n(3137),ae=n(4206),se=function(){function e(e,t,n,r,i,o,a){this._graphIteratorFactory=null,this._pageNavigator=null,this._selectionManager=null,this._actionManager=null,this._interactiveViewManager=null,this._translator=null,this._workspace=null,this._traverser=null,this.CurrentSearchScope=0,this._graphIteratorFactory=t,this._pageNavigator=n,this._selectionManager=r,this._actionManager=i,this._interactiveViewManager=o,this._workspace=e,this._translator=a}return e.prototype.get_Traverser=function(){if(!this._traverser){var e=this._graphIteratorFactory.getGraphIteratorFromNode(this._workspace.get_activePage());this._pageNavigator.tryMoveToPageLeadingContent(e),(e.tryToRootAtAncestorOfType(7)||e.returnToAncestorOfType(7))&&(this._traverser=oe.z.createPartialTraverser(e,e.get_origin()))}return this._traverser},e.prototype.navigateTo=function(e){if(!e||!e.paraId||e.paraId.length<=0)return M.ULS.shipAssertTag(20272217,334,!1,"ContentId is null or invalid."),!1;for(var t=new Array(e.paraId.length),n=7,r=null,i=0;i<e.paraId.length;i++){if(!(r=this.FindMatchParagraph(e.paraId[i])))return!1;if(7===n)n=this.CurrentSearchScope;else if(n!==this.CurrentSearchScope)return M.ULS.shipAssertTag(20272218,334,!1,"Two paragraphs in a range selections don't belong to the same view."),!1;var o=this._translator.paragraphNodePropsOnGraphNode(r.get_characterData(),r.get_characterProperties()),a=e.cpBegin?this._translator.cpFromWordTextOffset(o,e.cpBegin):-1,s=e.cpEnd?this._translator.cpFromWordTextOffset(o,e.cpEnd):-1;if(a<-1||s<-1)return M.ULS.shipAssertTag(20272219,334,!1,"Fail to convert WordTextOffset to WAC cp. Reset Cps to -1."),!1;switch(t[i]=ie.y.createContextFromCpResult(a,s,!1,r),e.contentType){case 5:if(!ne.HyperlinkReader.hasHyperlinksInRange(t[i],!1))return!1;break;case 6:if(!re.ImageReader.isInlineImageContext(t[i]))return!1;break;case 7:t[i]=ie.y.createContextFromCpResult(-1,-1,!1,r)}}var l=new te.Selection(t,!1,null);return this.SetSelectionOnContent(r,l,e.contentType)},e.prototype.FindMatchParagraph=function(e){if(this.get_Traverser())for(this.get_Traverser().reset(),this.CurrentSearchScope=7;this.get_Traverser().moveNext();){var t=this.get_Traverser().get_currentNode().get_type();if(38===t||36===t||23===t)this.CurrentSearchScope=t;else if(12===t){var n=this.get_Traverser().get_currentNode();if(e===n.getValueWithDefault(Number,X.j.wordId,0))return n}}return null},e.prototype.SwitchToTargetView=function(e){this._actionManager.processAction(ee.u.dismissHeaderFooter,2,null),this._actionManager.processAction(ee.u.dismissFootnoteEndnoteControl,2,null);var t=2;switch(this.CurrentSearchScope){case 23:t=32;break;case 38:t=this._actionManager.processActionWithData(ee.u.openFootnoteEndnoteControl,2,new ae.v(e,!0),null);break;case 36:t=this._actionManager.processActionWithData(ee.u.launchHeaderFooterForNode,2,new ae.v(e,!0),null);break;default:M.ULS.shipAssertTag(20272220,334,!1,"Unexpected search scope encountered: {0}",this.CurrentSearchScope)}return 32===t||(M.ULS.shipAssertTag(20272221,334,!1,"Fail to switch to target view: {0}",this.CurrentSearchScope),!1)},e.prototype.SetSelectionOnContent=function(e,t,n){if(this.SwitchToTargetView(e)){var r=this._workspace.get_activeView(),i=this._selectionManager.get_selectionCollection().get_currentSelection();switch(i&&i.equals(t)&&this._interactiveViewManager.setViewAndSelection(r,null,null,!1),this._interactiveViewManager.setViewAndSelection(r,t,null,!1),n){case 0:case 1:this._actionManager.processAction(Y.u.selectRow,2,null);break;case 2:this._actionManager.processAction(Y.u.selectColumn,2,null);break;case 3:this._actionManager.processAction(Y.u.selectTable,2,null)}return!0}return!1},e}();(0,a.l)(se,"6a557f09$WordAccessibilityCheckNavigateManager",null,[J]);var le=function(){function e(e){this._accessibilityCheckManager=null,this._getFileId=null,this._getFileId=e}return e.prototype.get_fileId=function(){return this._getFileId?this._getFileId():null},e.prototype.initialize=function(e){this._accessibilityCheckManager=e},e.prototype.onCheckResultsReady=function(e){this._accessibilityCheckManager.displayResults(e)},e}();(0,a.l)(le,"a45e0d2$AAccessibilityCheckService",null,[s,Sys.IDisposable]);var ue=function(){function e(){this.AccessibilityRules=null,this.IsPartialResult=!1,this.IsSuccess=!1,this.Results=null}return e.deserialize=function(e){var t=Sys.Serialization.JavaScriptSerializer.deserialize(e),n=t.AccessibilityRules,r={};if(n)for(var i=0;i<n.length;++i){var o=n[i];r[o.Key]=o.Value}return t.AccessibilityRules=r,t},e}();(0,a.l)(ue,"88cd015e$AccessibilityCheckResultCollection",null,[]);var ce=function(e){function t(t){return e.call(this,t)||this}return(0,i.t)(t,e),t.prototype.onFailure=function(e,t){M.ULS.shipAssertTag(20730842,334,!1,"Acc Checker force save failed! StatusCode:{0}",t);var n=(0,E.m)(new ue,{IsSuccess:!1});this.onCheckResultsReady(n)},t.prototype.onSuccess=function(e){var n=t.GetResponseBody(e),r=null;if(n)try{r=this.deserializeBodyToAccessibilityCheckResultCollection(n)}catch(e){M.ULS.shipAssertTag(20730843,334,!1,"AccChecker response data is invalid. [{0}]",e.message),r=(0,E.m)(new ue,{IsSuccess:!1})}else M.ULS.shipAssertTag(20730844,334,!1,"AccChecker response is NULL."),r=(0,E.m)(new ue,{IsSuccess:!1});this.onCheckResultsReady(r)},t.prototype.dispose=function(){},t.GetResponseBody=function(e){var t=null;return e&&e.get_responseObjects()&&(t=e.get_responseObjects()[0]),t?t.Body:null},t}(le);(0,a.l)(ce,"b5c7b780$ALiveBooksAccessibilityCheckService",le,[]);var de=n(8996),pe=n(3190),ge=function(e){function t(){var t=e.call(this)||this;return t.FileId=null,t.IsCoauthorable=!1,t}return(0,i.t)(t,e),t.prototype.getClassId=function(){return 56},t.construct=function(e,n){var r=new t;return r.FileId=e,r.IsCoauthorable=n,r},t}(pe.b);(0,a.l)(ge,"57da70ec$WordAccessibilityCheckRequest",pe.b,[]);var he=function(){return function(){}}();(0,a.l)(he,"58e9c32f$AccessibilityCheckRule",null,[]);var _e=n(9725),fe=n(6378),me=function(){function e(){}return e.parse=function(e){switch(fe.l.toLower(e)){case"warnings":return 1;case"tips":return 2;case"errors":return 0;case"intelligentservices":return 3;default:var t=String.format("Invalid Accessibility result category: {0}",e);throw _e.t.argument(t,null)}},e}();(0,a.l)(me,"bb628bde$AccessibilityRuleCategoryParser",null,[]);var ye=function(){function e(){this.Id=null,this.Text=null,this.Category=null}return e.toAccessibilityCheckRule=function(e){var t=new he;return t.RuleId=e.Id,t.RuleName=e.Text,t.Category=me.parse(e.Category),t},e}();(0,a.l)(ye,"17bce133$WordAccessibilityCheckRule",null,[]);var ve=function(){return function(){}}();(0,a.l)(ve,"17274288$AccessibilityCheckResult",null,[]);var Se=function(){return function(){this.paraId=null,this.cpBegin=null,this.cpEnd=null,this.contentType=0}}();(0,a.l)(Se,"3434aab9$WordAccessibilityCheckContentId",null,[]);var Ie=function(){function e(){}return e.parse=function(e){switch(fe.l.toLower(e)){case"tableheading":return 0;case"tablerow":return 1;case"tablecolumn":return 2;case"table":return 3;case"textcontrast":return 4;case"hyperlink":return 5;case"inlinepicture":return 6;case"anchoredepicture":return 7;default:return 8}},e}();(0,a.l)(Ie,"5b264c8b$WordAccessibilityCheckContentTypeParser",null,[]);var Ce=n(4439),Te=function(){function e(){this.ParaId=null,this.RuleId=null,this.Label=null,this.ContentType=null,this.OS=null,this.OE=null}return e.toAccessibilityCheckResult=function(e){var t=new ve;t.RuleId=e.RuleId,t.ContentName=e.Label;var n=new Se;return n.paraId=e.ParaId,n.cpBegin=Ce.x.deserializeCpData(e.OS),n.cpEnd=Ce.x.deserializeCpData(e.OE),n.contentType=Ie.parse(e.ContentType),t.ContentId=n,t},e}();(0,a.l)(Te,"925a2b9a$WordAccessibilityViolation",null,[]);var be=function(){function e(){this.Rules=null,this.Violations=null}return e.toAccessibilityCheckResultCollection=function(e){var t=new ue;try{var n={};if(e.Rules){for(var r=0;r<e.Rules.length;++r){var i=ye.toAccessibilityCheckRule(e.Rules[r]);n[i.RuleId]=i}t.AccessibilityRules=n}if(e.Violations){var o=new Array(e.Violations.length);for(r=0;r<e.Violations.length;++r)o[r]=Te.toAccessibilityCheckResult(e.Violations[r]);t.Results=o}t.IsPartialResult=!1,t.IsSuccess=!0}catch(e){M.ULS.shipAssertTag(20272214,334,!1,"Failed to convert WordAccessibilityCheckResult to AccessibilityCheckResultCollection. [{0}]",e.message),t.IsSuccess=!1}return t},e}();(0,a.l)(be,"798603f4$WordAccessibilityCheckResult",null,[]);var Ae=n(5358),Me=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i._forceSave=null,i._isCoauthorable=!1,i._forceSave=n,i._isCoauthorable=r,i}return(0,i.t)(t,e),t.prototype.runAccessibilityCheck=function(){var e=new Ae.g;e.set_requestObject(ge.construct(this.get_fileId(),this._isCoauthorable)),e.status=1,this._forceSave(12,!1,a.i(this,this.onSuccess,"onSuccess"),a.i(this,this.onFailure,"onFailure"),e,null,e)},t.prototype.deserializeBodyToAccessibilityCheckResultCollection=function(e){var t=de.x.secureDeserialize(e);return be.toAccessibilityCheckResultCollection(t)},t}(ce);(0,a.l)(Me,"b0188040$WordAccessibilityCheckService",ce,[]);var Pe=n(2098),Fe=function(e){function t(){return e.call(this)||this}return(0,i.t)(t,e),t.prototype.get_name=function(){return"WordEditor.AccessibilityChecker"},t.prototype.configure=function(t){e.prototype.configure.call(this,t),f.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactAccCheckerPaneEnabled()?t.register(o.j).singleInstance().usingFactory((function(){return new H(f.AFrameworkApplication.get_theActionManager(),m.s.get_instance(),v.FocusManager.instance(),y.F6Manager.get_instance(),S.KeyInputManager.get_instance(),$.a.get_instance(),f.AFrameworkApplication.appSettingsManager.getStringAppSetting("AccessibilityCheckerHelpUrl"),null)})):t.register(o.j).singleInstance().usingFactory((function(){return new w(f.AFrameworkApplication.get_theActionManager(),m.s.get_instance(),v.FocusManager.instance(),y.F6Manager.get_instance(),S.KeyInputManager.get_instance(),$.a.get_instance(),I.App.get_activeAppFrame(),f.AFrameworkApplication.appSettingsManager.getStringAppSetting("AccessibilityCheckerHelpUrl"),null)})),t.register(s).singleInstance().usingFactory((function(){return new Me((function(){return f.AFrameworkApplication.get_rootQuerySignature()}),Pe.q.forceSaveSync,b.PageReader.get_instance().getIsCoauthorable(I.App.get_activeAppFrame().workspace.get_activePage()))})),t.register(se).singleInstance().usingFactory((function(){return new se(I.App.get_activeAppFrame().workspace,t.resolve(l.v),T.PageNavigator.get_instance(),t.resolve(u.l),f.AFrameworkApplication.get_theActionManager(),C.InteractiveViewManager.get_instance(),t.resolve(c.l))})),t.register(d).singleInstance().usingFactory((function(){return new Z(f.AFrameworkApplication.get_theActionManager(),t.resolve(o.j),t.resolve(s),t.resolve(se),I.App.theNotebookManager.get_theGraph(),G.App.get_isOdt())}))},t.prototype.init=function(){var e=this;G.App.get_wordAccessibilityCheckerIsEnabled()&&this.container.resolve(p.d).get_graphFeaturesNodeTask().CW((function(t){_.prototype.init.call(e)}))},t}(_);(0,a.l)(Fe,"1ed992ec$WordAccCheckerPackageManager",_,[]),n.d(t,{Program:function(){return we}});var we=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new Fe,0,!1)},e}();(0,a.l)(we,"fbeb750f$Program",null,[])},870:function(e,t,n){"use strict";var r=n(423),i=n(7562),o=n(7597),a=(0,r.y)("26439a40$IAccessibilityCheckStringsProvider"),s=function(){function e(){}return e.prototype.get_additionalInfoContent=function(){return CommonUIStrings.l_AccCheckerAdditionalInfoContent},e.prototype.get_additionalInfoTitle=function(){return CommonUIStrings.l_accCheckerAdditionalInfoTitle},e.prototype.get_categoryError=function(){return CommonUIStrings.l_AccCheckerCategoryError},e.prototype.get_categoryIntelligentService=function(){return CommonUIStrings.l_AccCheckerCategoryIntelligentService},e.prototype.get_categoryTip=function(){return CommonUIStrings.l_AccCheckerCategoryTip},e.prototype.get_categoryWarning=function(){return CommonUIStrings.l_AccCheckerCategoryWarning},e.prototype.get_checkCompleteNotification=function(){return CommonUIStrings.l_AccCheckerCheckCompleteNotification},e.prototype.get_checkingNow=function(){return CommonUIStrings.l_AccCheckerCheckingNow},e.prototype.get_contentNotFoundDialogActionButton=function(){return CommonUIStrings.l_AccCheckerContentNotFoundDialogActionButton},e.prototype.get_contentNotFoundDialogBody=function(){return CommonUIStrings.l_AccCheckerContentNotFoundDialogBody},e.prototype.get_contentNotFoundDialogTitle=function(){return CommonUIStrings.l_AccCheckerContentNotFoundDialogTitle},e.prototype.get_externalHelpLinkText=function(){return CommonUIStrings.l_AccCheckerExternalHelpLinkText},e.prototype.get_lastTimeChecked=function(){return CommonUIStrings.l_AccCheckerLastTimeChecked},e.prototype.get_outOfSyncNotificationMessageBody=function(){return CommonUIStrings.l_AccCheckerOutOfSyncNotificationMessageBody},e.prototype.get_paneTitle=function(){return CommonUIStrings.l_AccCheckerPaneTitle},e.prototype.get_partialResultNotification=function(){return CommonUIStrings.l_AccCheckerPartialResultNotification},e.prototype.get_reCheckButton=function(){return CommonUIStrings.l_AccCheckerReCheckButton},e.prototype.get_resultInstruction=function(){return CommonUIStrings.l_accCheckerResultInstruction},e.prototype.get_serviceUnavailable=function(){return CommonUIStrings.l_AccCheckerServiceUnavailable},e}();(0,r.l)(s,"8e08e049$AccessibilityCheckStringsProvider",null,[a]);var l=function(){return function(){this.contentId=null,this.ruleId=null}}();(0,r.l)(l,"47fd3556$ResultIds",null,[]);var u=n(3545),c=(0,r.y)("f0d71468$IPopupNotification"),d=n(8576),p=n(6311),g=n(2664),h=n(9354),_=n(6410),f=n(6020),m=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i._onDismiss=null,i._onDismiss=r,i}return(0,u.t)(t,e),t.prototype.hide=function(){this.get_element().removeAttribute(f.t.ariaRoleAttribute),f.t.setAriaAttribute(this.get_element(),f.t.ariaHiddenAttribute,f.t.ariaTrueValue),this.get_element().style.display="none"},t.prototype.show=function(){f.t.setAriaAttribute(this.get_element(),f.t.ariaHiddenAttribute,f.t.ariaFalseValue),f.t.setAriaAttribute(this.get_element(),f.t.ariaRoleAttribute,f.t.ariaAlertRole),this.get_element().style.display="block"},t.prototype.createDomElement=function(){var e=g.j.createUnselectableDomElement("div",this.get_notificationId(),t.NotificationStyle);f.t.setAriaAttribute(e,f.t.ariaAtomicAttribute,f.t.ariaTrueValue),f.t.setAriaAttribute(e,f.t.ariaLabelledByAttribute,this.get_notificationTextId()),e.tabIndex=0;var n=g.j.createUnselectableDomElement("span",this.get_notificationIconId(),t.NotificationIconClass),r=h.ImageClusteringHelper.createClusteredImage(16,16,"Info_16x16x32","",!0,"");n.appendChild(r);var i=g.j.createUnselectableDomElement("span",this.get_notificationTextId(),t.NotificationTextClass);return _.s.setElementText(i,this.get_notificationText()),e.appendChild(n),e.appendChild(i),e},t.prototype.onInvoke=function(){this._onDismiss()},t.NotificationStyle="AccCheckerNotification",t.NotificationIconClass="AccCheckerNotificationIcon",t.NotificationTextClass="AccCheckerNotificationText",t}(p.u);(0,r.l)(m,"59f86160$APopupNotification",p.u,[c,d.c,Sys.IDisposable]);var y=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r)||this;return o._stringsProvider=null,o._stringsProvider=i,o}return(0,u.t)(t,e),t.prototype.get_notificationId=function(){return t.OutOfSyncNotificationId},t.prototype.get_notificationIconId=function(){return t.OutOfSyncNotificationIconId},t.prototype.get_notificationTextId=function(){return t.OutOfSyncNotificationTextId},t.prototype.get_notificationText=function(){return this._stringsProvider.get_outOfSyncNotificationMessageBody()},t.OutOfSyncNotificationId="AccCheckerOutOfSyncNotificationId",t.OutOfSyncNotificationIconId="AccCheckerOutOfSyncNotificationIconId",t.OutOfSyncNotificationTextId="AccCheckerOutOfSyncNotificationTextId",t}(m);(0,r.l)(y,"b383360b$OutOfSyncNotification",m,[]);var v=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r)||this;return o._stringsProvider=null,o._stringsProvider=i,o}return(0,u.t)(t,e),t.prototype.get_notificationId=function(){return t.PartialResultNotificationId},t.prototype.get_notificationIconId=function(){return t.PartialResultNotificationIconId},t.prototype.get_notificationTextId=function(){return t.PartialResultNotificationTextId},t.prototype.get_notificationText=function(){return this._stringsProvider.get_partialResultNotification()},t.PartialResultNotificationId="AccCheckerPartialResultNotificationId",t.PartialResultNotificationIconId="AccCheckerPartialResultNotificationIconId",t.PartialResultNotificationTextId="AccCheckerPartialResultNotificationTextId",t}(m);(0,r.l)(v,"d409d5b1$PartialResultNotification",m,[]);var S=n(4551),I=n(2575),C=n(8530);n.d(t,{m:function(){return T}});var T=function(){function e(e,t,n,i,o,a,l){this._accessibilityCheckManager=null,this._clickInputManager=null,this._f6Manager=null,this._focusManager=null,this._keyInputManager=null,this._stringsProvider=null,this._outOfSyncNotification=null,this._partialResultNotification=null,this._rootElement=null,this._resultDictionary=null,this.$$pf_RootPane=null,this.set_keyInputManager(i),this._clickInputManager=e,this._focusManager=t,this._f6Manager=n,this._stringsProvider=l||new s,this._outOfSyncNotification=o||new y(this.get_keyInputManager(),this._clickInputManager,r.i(this,this.dimissOutOfSyncNotification,"dimissOutOfSyncNotification"),this._stringsProvider),this._partialResultNotification=a||new v(this.get_keyInputManager(),this._clickInputManager,r.i(this,this.dimissPartialResultNotification,"dimissPartialResultNotification"),this._stringsProvider)}return e.prototype.get_rootPane=function(){return this.$$pf_RootPane},e.prototype.set_rootPane=function(e){return this.$$pf_RootPane=e,e},e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype.get_keyInputManager=function(){return this._keyInputManager||(this._keyInputManager=I.AFrameworkApplication.get_activeFrame().get_theKeyInputManager())},e.prototype.set_keyInputManager=function(e){return this._keyInputManager=e,e},e.prototype.createControls=function(){return null},e.prototype.hidePane=function(){},e.prototype.dispose=function(){},e.prototype.unregisterActions=function(){},e.prototype.setDefaultFocus=function(){},e.prototype.resizeCheckResultSurface=function(){},e.prototype.invokeNavigate=function(e){var t=this._resultDictionary[e],n=t.contentId,r=t.ruleId;r&&o.ULS.sendTraceTag(41302156,334,50,'{"EventType":"AccCheckerViolationSelected","RuleId":"'+r.toString()+'"}'),this.navigateToObject(n)},e.prototype.navigateToObject=function(e){e&&this._accessibilityCheckManager.setFocusOnContent(e)||(this._focusManager.pushScope(S.AFrame.accCheckerPaneFocusId,!1),this.showContentNotFoundErrorDialog())},e.prototype.invokeCloseButton=function(){this.hidePane(),this._focusManager.setScope(this._focusManager.get_defaultScopeName())},e.prototype.dimissOutOfSyncNotification=function(){this.showHideOutOfSyncNotification(!1),this.setDefaultFocus()},e.prototype.dimissPartialResultNotification=function(){this.showHidePartialResultNotification(!1),this.setDefaultFocus()},e.prototype.showContentNotFoundErrorDialog=function(){var e=this,t=new C.StandardDialog(!0);t.set_hasCloseGlyph(I.AFrameworkApplication.isCloseable),t.set_buttonsOption(1),t.showSessionId=!1,t.setDefaultButton(1),t.setButtonText(1,this._stringsProvider.get_contentNotFoundDialogActionButton()),t.setButtonText(0,CommonUIStrings.l_DialogCancel),t.showWarning(this._stringsProvider.get_contentNotFoundDialogTitle(),this._stringsProvider.get_contentNotFoundDialogBody(),(function(t,n){1===t&&e.invokeRecheckButton()}))},e.prototype.buildResultDictionary=function(t){var n=null;if(t.Results&&t.Results.length>0){n={};for(var r=0,i=0,o=t.Results;i<o.length;i++){var a=o[i];a.ResultId=e.AccCheckResultIdPrefix+ ++r;var s=new l;s.contentId=a.ContentId,s.ruleId=a.RuleId,n[a.ResultId]=s}}return n},e.validTags=[2,1],e.AccCheckResultIdPrefix="AccCheckResult",e}();(0,r.l)(T,"73dba0c1$BaseAccessibilityCheckPane",null,[i.j,Sys.IDisposable])},877:function(e,t,n){"use strict";n.d(t,{w:function(){return i}});var r=n(423),i=function(){function e(e){this.capabilities=0,this.capabilities=e}return e.prototype.hasFlag=function(e){return!!(this.capabilities&e)},e.prototype.setFlag=function(e){this.capabilities=this.capabilities|e},e.prototype.unsetFlag=function(e){this.capabilities=this.capabilities&~e},e.prototype.equals=function(e){return!(this.capabilities-e.capabilities)},e.prototype.clone=function(){return new e(this.capabilities)},e.prototype.toString=function(){return Object.prototype.toString.call(this)},e}();(0,r.l)(i,"916e61c$UserCapabilities",null,[])},904:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});var r=n(423),i=function(){return function(e,t,n,r){this.value=null,this.type=0,this.parameterValue=null,this.groupType=0,this.description=null,this.value=e,this.type=t,this.parameterValue=n,this.groupType=11,this.description=r}}();(0,r.l)(i,"7791a135$ResultBinding",null,[])},934:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var r=n(4105),i=n(423),o=function(){function e(e){this._docChatClientLazy=null,this._docChatClientLazy=e}return e.prototype.create=function(){return this._docChatClientLazy.get_value()},e}();(0,i.l)(o,"60068b68$DocChatClientFactory",null,[r.x])},953:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});var r=(0,n(423).y)("493e33cf$IResultsProvider")},984:function(e,t,n){"use strict";n.d(t,{t:function(){return r}});var r=(0,n(423).y)("2be54da8$IPeoplesWell")},1044:function(e,t,n){"use strict";n.r(t),t.default=window.FormatPictureTaskPaneData={name:"CommandUI",attrs:{xmlns:"http://schemas.microsoft.com/sharepoint/"},children:[{name:"TaskPane",attrs:{Id:"FormatPictureTaskPane",Title:"STR@L_FormatPicture",Width:"300",ImageCollapsedArrow:"IMGMAP@we@ArrowCollapsedRest_16x16x32",ImageExpandedArrow:"IMGMAP@we@ArrowExpandedRest_16x16x32",ImageDownArrow:"IMGMAP@we@SplitButtonArrow_5x3x32",ImageDownArrow8by8:"IMGMAP@we@SplitButtonArrow_8x8x32",ImageUpArrow:"IMGMAP@we@RibbonUpArrow_5x3x32",ImageUpArrow8by8:"IMGMAP@we@RibbonUpArrow_8x8x32",ImageCheckMark:"IMGMAP@we@CheckboxChecked_16x16x32",ImageUncheckMark:"IMGMAP@we@CheckboxUnchecked_16x16x32"},children:[{name:"Groups",attrs:{},children:[{name:"Group",attrs:{Id:"GroupFormatPictureControls",IsStretched:"false"},children:[{name:"Section",attrs:{Id:"GroupFormatPictureControlsSection"},children:[{name:"Row",attrs:{Id:"NavControls",DisplayMode:"Large30",TextAlign:"Left"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"btnProperties",Command:"0x62A2D4C0",Image30by30:"IMGMAP@we@FormatObjectProperties_30x30x32",LabelText:"STR@L_Properties"}},{name:"Button",attrs:{Id:"btnPicture",Command:"0x7136810D",Image30by30:"IMGMAP@we@FormatObjectPictureOptions_30x30x32",LabelText:"STR@L_Picture"}}]}]}]}]},{name:"Group",attrs:{Id:"GroupAllInOne",IsStretched:"true",TextAlign:"Right"},children:[{name:"CollapsibleSection",attrs:{Id:"AltTextCollapsibleSection",Title:"STR@l_AlternativeTextDialogTitle"},children:[{name:"Section",attrs:{Id:"altTextSection"},children:[{name:"Row",attrs:{DisplayMode:"Medium"},children:[{name:"Controls",attrs:{},children:[{name:"TextBox",attrs:{Id:"txtBoxAltTextTitle",Alt:"STR@l_AlternativeTextTitleCaption",LabelText:"STR@l_AlternativeTextTitleCaption",Command:"0x3507A2B1",QueryCommand:"0x36DB7495",DisplayMode:"Medium",MaxLength:"65536",AdditionalLabelBy:"AltTextCollapsibleSection-Title",Height:"30px",IsStretchedHorizontally:"true"}}]}]},{name:"Row",attrs:{DisplayMode:"Medium"},children:[{name:"Controls",attrs:{},children:[{name:"TextBox",attrs:{Id:"txtBoxAltTextDescription",Alt:"STR@l_AlternativeTextDescriptionCaption",LabelText:"STR@l_AlternativeTextDescriptionCaption",Command:"0x61FE1E53",QueryCommand:"0x416A13E3",DisplayMode:"Medium",MaxLength:"65536",AdditionalLabelBy:"AltTextCollapsibleSection-Title",Height:"180px",IsStretchedHorizontally:"true",IsMultiline:"true"}}]}]}]}]},{name:"CollapsibleSection",attrs:{Id:"CropCollapsibleSection",Title:"STR@L_Crop"},children:[{name:"Section",attrs:{Id:"leftCropSection"},children:[{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Label",attrs:{Id:"lblCropTop",LabelText:"STR@L_Top",For:"spnCropTop"}}]}]},{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Label",attrs:{Id:"lblCropBottom",LabelText:"STR@L_Bottom",For:"spnCropBottom"}}]}]},{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Label",attrs:{Id:"lblCropLeft",LabelText:"STR@L_Left",For:"spnCropLeft"}}]}]},{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Label",attrs:{Id:"lblCropRight",LabelText:"STR@L_Right",For:"spnCropRight"}}]}]}]},{name:"Section",attrs:{Id:"rightCropSection",HorizontalAlignment:"Right"},children:[{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Spinner",attrs:{Id:"spnCropTop",Alt:"STR@L_CropTopTooltip",Command:"0xDF8DEBBA",QueryCommand:"0xB9089B94",LabelledBy:"CropCollapsibleSection-Title lblCropTop-Medium"},children:[{name:"Unit",attrs:{UnitType:"pixels",MinimumValue:"0",MaximumValue:"1920",Step:"1"}}]}]}]},{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Spinner",attrs:{Id:"spnCropBottom",Alt:"STR@L_CropBottomTooltip",Command:"0x091D0734",QueryCommand:"0xA3D9079E",LabelledBy:"CropCollapsibleSection-Title lblCropBottom-Medium"},children:[{name:"Unit",attrs:{UnitType:"pixels",MinimumValue:"0",MaximumValue:"1920",Step:"1"}}]}]}]},{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Spinner",attrs:{Id:"spnCropLeft",Alt:"STR@L_CropLeftTooltip",Command:"0x2F92B28A",QueryCommand:"0x037C5130",LabelledBy:"CropCollapsibleSection-Title lblCropLeft-Medium"},children:[{name:"Unit",attrs:{UnitType:"pixels",MinimumValue:"0",MaximumValue:"1920",Step:"1"}}]}]}]},{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Spinner",attrs:{Id:"spnCropRight",Alt:"STR@L_CropRightTooltip",Command:"0x52A3310D",QueryCommand:"0x2AA307AB",LabelledBy:"CropCollapsibleSection-Title lblCropRight-Medium"},children:[{name:"Unit",attrs:{UnitType:"pixels",MinimumValue:"0",MaximumValue:"1920",Step:"1"}}]}]}]}]}]},{name:"CollapsibleSection",attrs:{Id:"RotateCollapsibleSection",Title:"STR@L_Rotation"},children:[{name:"Section",attrs:{Id:"leftRotateSection"},children:[{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Label",attrs:{Id:"lblRotationAngle",LabelText:"STR@L_RotationAngle",For:"spnRotateAngle"}}]}]}]},{name:"Section",attrs:{Id:"rightRotateSection",HorizontalAlignment:"Right"},children:[{name:"Row",attrs:{DisplayMode:"Medium",Height:"29px"},children:[{name:"Controls",attrs:{},children:[{name:"Spinner",attrs:{Id:"spnRotateAngle",Alt:"STR@L_RotationSpinnerTooltip",Command:"0x97B9E874",QueryCommand:"0xD63D3722",LabelledBy:"RotateCollapsibleSection-Title lblRotationAngle-Medium"},children:[{name:"Unit",attrs:{UnitType:"degree",MinimumValue:"0",MaximumValue:"360",Step:"1"}}]}]}]}]}]}]}]}]}]}},1071:function(e,t,n){"use strict";n.d(t,{f:function(){return i}});var r=n(423),i=function(){function e(){}return e.ToCharCode=function(e){return e.toString().charCodeAt(0)},e.IsSurrogateChar=function(e){return e>=55296&&e<=57343},e.CharAt=function(e,t){return e.charAt(t)},e.AreEquivalent_IgnoreNbsp=function(t,n){return t===n||(t===e.Nbsp&&(t=" "),n===e.Nbsp&&(n=" "),t===n)},e.AreEquivalentStrings_IgnoreNbsp=function(t,n){return t===n||!(!t||!n)&&(t.length===n.length&&(t=e.ReplaceNbspsWithSpaces(t))===(n=e.ReplaceNbspsWithSpaces(n)))},e.ReplaceNbspsWithSpaces=function(t){return t.replace(e.MatchAllNbsps," ")},e.SubString=function(e,t,n){return e.substring(t,t+n)},e.Nbsp="\xa0",e.MatchAllNbsps=new RegExp("\xa0","g"),e}();(0,r.l)(i,"11a2afcb$CharUtils",null,[])},1098:function(e,t,n){"use strict";var r=n(3545),i=n(7500),o=n(5479),a=n(1388),s=n(9725),l=n(1071),u=n(423),c=function(e){function t(t,n,r,i,o,a,s,l,u,c,d,p,g,h){var _=this;return _.character=null,(_=e.call(this,t,3,n,r,i,o,a,l,u,c,d,p,g,h)||this).character=s,_}return(0,r.t)(t,e),t.prototype.get_character=function(){return this.character},t.prototype.get_text=function(){return this.get_character().toString()},t.prototype.set_text=function(e){throw s.t.notImplemented()},t.prototype.toString=function(){var t=e.prototype.toString.call(this);return String.format("{0}",t)},t.prototype.getBlockTypeString=function(){return"CharRun"},t.prototype.clone=function(){return new t(this.get_allObjects(),this.source,this.graphNodeId,this.paraId,this.runId,this.get_formatId(),this.get_character(),this.newlyTypedRun,this.isPendingProofing,this.hasSpellingError,this.hasGrammarError,this.proofingErrorHint,this.runMergeBlockTrackedChangeInfo,this.changeId)},t.prototype.isEquivalentTo=function(t,n,r,i){return!!e.prototype.isEquivalentTo.call(this,t,n,r,i)&&(t.get_character()===this.get_character()||l.f.AreEquivalent_IgnoreNbsp(t.get_character(),this.get_character()))},t}(i.j);(0,u.l)(c,"b5d526e4$CharRunMergeBlock",i.j,[]),n.d(t,{q:function(){return d}});var d=function(e){function t(t,n,r,i,o,a,s,l,u,c,d,p,g,h,_){var f=this;return f._text=null,f._supportsSplitIntoMoreGranularBlocks=!1,(f=e.call(this,t,1,n,r,i,o,a,l,c,d,p,g,h,_)||this)._text=s,f._supportsSplitIntoMoreGranularBlocks=u,f}return(0,r.t)(t,e),t.prototype.get_text=function(){return this._text},t.prototype.set_text=function(e){return this._text=e,e},t.prototype.get_supportsSplitIntoMoreGranularBlocks=function(){return!!this._supportsSplitIntoMoreGranularBlocks&&!(!this._text||!this._text.length)},t.prototype.toString=function(){var t=e.prototype.toString.call(this);return String.format("{0} [SupportsSplit: {1}]",t,this._supportsSplitIntoMoreGranularBlocks)},t.prototype.getBlockTypeString=function(){return"TextRun"},t.prototype.clone=function(){return new t(this.get_allObjects(),this.source,this.graphNodeId,this.paraId,this.runId,this.get_formatId(),this._text,this.newlyTypedRun,this._supportsSplitIntoMoreGranularBlocks,this.isPendingProofing,this.hasSpellingError,this.hasGrammarError,this.proofingErrorHint,this.runMergeBlockTrackedChangeInfo,this.changeId)},t.prototype.isEquivalentTo=function(t,n,r,i){return!!e.prototype.isEquivalentTo.call(this,t,n,r,i)&&l.f.AreEquivalentStrings_IgnoreNbsp(this._text,t._text)},t.prototype.splitIntoMoreGranularBlocks=function(){for(var e=new o.o(a.AMergeBlock,null),n=0;n<this.get_text().length;n++){var r=l.f.CharAt(this._text,n);if(l.f.IsSurrogateChar(l.f.ToCharCode(r))){var i="";i+=r,i+=r=l.f.CharAt(this._text,++n);var s=new t(this.get_allObjects(),this.source,this.graphNodeId,this.paraId,this.runId,this.get_formatId(),i,this.newlyTypedRun,!1,this.isPendingProofing,this.hasSpellingError,this.hasGrammarError,this.proofingErrorHint,this.runMergeBlockTrackedChangeInfo,this.changeId);e.add(s)}else{var u=new c(this.get_allObjects(),this.source,this.graphNodeId,this.paraId,this.runId,this.get_formatId(),r,this.newlyTypedRun,this.isPendingProofing,this.hasSpellingError,this.hasGrammarError,this.proofingErrorHint,this.runMergeBlockTrackedChangeInfo,this.changeId);e.add(u)}}return e},t}(i.j);(0,u.l)(d,"61c06521$TextRunMergeBlock",i.j,[])},1128:function(e,t,n){"use strict";n.d(t,{i:function(){return r}});var r=(0,n(423).y)("e43cb8bd$ITokenStringGenerator")},1228:function(e,t,n){"use strict";n.d(t,{i:function(){return o}});var r=n(423),i=n(8934),o=function(){function e(t){this.m_referenceList=null,this.m_startIndex=0,this.m_length=0,r.m(this,e.$$(t))}return e.prototype.fromArray=function(e,t,n){if(!e)throw Error.argumentNull("referenceList");if(t<0||t>e.length)throw Error.argumentOutOfRange("startIndex");if(n<0||n>e.length)throw Error.argumentOutOfRange("length");if(t+n>e.length)throw Error.argument("Invalid start-length range");this.m_referenceList=e,this.m_startIndex=t,this.m_length=n},e.prototype.fromReadOnlyList=function(e,t,n){this.fromArray(e.m_referenceList,e.m_startIndex+t,n)},e.prototype.get_item=function(e){if(e<0||e>=this.m_length)throw Error.argumentOutOfRange("index");return this.m_referenceList[this.m_startIndex+e]},e.prototype.get_count=function(){return this.m_length},e.createReadOnlyList=function(t){var n=new e(r.f(this,"NLRT.ReadOnlyList$1").T);return n.fromArray(t,0,t.length),n},e.$$=function(t){return r.o("NLRT.ReadOnlyList$1",e,[{T:t}],null,[i.y.$$(t)],{})},e}()},1244:function(e,t,n){"use strict";n.d(t,{h:function(){return a}});var r=n(3545),i=n(6812),o=n(423),a=function(e){function t(){return e.call(this)||this}return(0,r.t)(t,e),t.prototype.get_failureType=function(){return"ParagraphMerge"},t}(i.d);(0,o.l)(a,"a1b296c3$ParagraphMergeFailureDetail",i.d,[])},1282:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("87d5f77d$IRandomSampler");n.d(t,{z:function(){return o}});var o=function(){function e(e){this._probabilityToIncludeInSample=0,this._probabilityToIncludeInSample=e}return e.prototype.shouldBeInSample=function(){return Math.random()<this._probabilityToIncludeInSample},e}();(0,r.l)(o,"9a83d214$RandomSampler",null,[i])},1326:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});var r=(0,n(423).y)("b1f9fc8f$IFeatureBundle")},1330:function(e,t,n){"use strict";n.d(t,{o:function(){return r}});var r=(0,n(423).y)("dc50d7d4$IErrorRetryDialogFactory")},1331:function(e,t,n){"use strict";n.d(t,{q:function(){return o}});var r=n(3545),i=n(423),o=function(e){function t(t,n){var r=e.call(this)||this;return r.type=0,r.eventArgs=null,r.type=t,r.eventArgs=n,r}return(0,r.t)(t,e),t.InteractivityChangedEventKey="InteractivityChanged",t}(Sys.EventArgs);(0,i.l)(o,"f31f7902$InteractivityChangedEventArgs",Sys.EventArgs,[])},1357:function(e,t,n){"use strict";n.r(t);var r=n(6699),i=n(423),o=(0,i.y)("8b335828$ISharePointUploadCallerFactory"),a=(0,i.y)("45391a61$IUploadToSharePointManager"),s=(0,i.y)("60090ac3$ISaveToSharePointManager"),l=(0,i.y)("f600dd25$IOneDriveFilePickerHelper"),u=n(1330),c=n(8761),d=n(363),p=n(8192),g=n(3362),h=n(3517),_=n(8963),f=n(3545),m=(0,i.y)("454acbb$IErrorDialog"),y=n(8530),v=n(7597),S=n(9474),I=function(e){function t(){var t=e.call(this)||this;return t.set_buttonsOption(0),t.setButtonText(1,CommonUIStrings.l_DialogClose),t}return(0,f.t)(t,e),t.prototype.displayError=function(e,t){this.displayErrorWithErrorCode(e,t,S.p.saveAsToSharePointFailed_Error)},t.prototype.displayErrorWithErrorCode=function(e,t,n){v.ULS.sendTraceTag(25180161,216,10,"Show upload error dialog with error code {0}.",n),this.showError(n,e,t,null)},t.prototype.displayWarning=function(e,t){v.ULS.sendTraceTag(25235986,216,15,"Show warning dialog of Picker related issue."),this.showError(S.p.saveAsToSharePointFailed_Warning,e,t,null,!0)},t}(y.StandardDialog);(0,i.l)(I,"ca269112$ErrorDialog",y.StandardDialog,[m]);var C=(0,i.y)("48aca536$IFileNameDialogFactory"),T=(0,i.y)("bba59fc2$IFileNameDialog"),b=n(1822),A=n(7794),M=n(8027),P=function(){function e(){}return e.get_dialogHtml=function(){return M.o.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_FileNameLabel,CommonUIStrings.l_NewFileLocationLabel,CommonUIStrings.l_CurrentOnlineFolder,"")},e.dialogHtmlFormat="<div class='WACDialogRow' id='DocumentNameBlock'> <label id='lblFileName' class='WACDialogLabel' for='txtFileName' >{0}</label> <input type='text' id='txtFileName' class='WACDialogInput' autocomplete=\"off\"/> </div> <div class='WACDialogRow' id='DocumentLocationBlock'> <label id='locationName' class='WACDialogLabel' for='locationName' >{1}</label> <div class='FolderLocationDiv' id='folderLocation'> <label id='currentLocation' class='WACDialogLabel' for='currentLocation' >{2}</label> <span id='anotherFolder' class='WACDialogSpan'>{3}</span> </div> </div>",e}();(0,i.l)(P,"551ffad2$FileNameDialogHtml",null,[]);var F=n(2575),w=n(1135),R=n(2612),E=n(6301),k=n(6020),D=n(6378),O=function(e){function t(n,r,i,o,a,s,l,u){var c=this;return c._saveToSharePointManager=null,c._options$5=null,c._saveToAnotherFolderButton=null,c._iconSVG=null,c.ButtonTextString=CommonUIStrings.l_SaveToAnotherFolder,(c=e.call(this,n,r,i,o,a,s,u)||this).set_dialogHtml(P.get_dialogHtml()),c.set_dialogId(t.Id),c._saveToSharePointManager=l,c._options$5=u,c}return(0,f.t)(t,e),t.prototype.displayDialog=function(e){var n=D.l.getFileNameWithoutExtension(F.AFrameworkApplication.docPropertiesProvider.get_breadcrumbDocName()),r=F.AFrameworkApplication.breadcrumbFolderName,o=F.AFrameworkApplication.breadcrumbBrandName,a={txtFileName:e||n},s=CommonUIStrings.L_SaveAs;2===F.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_officeAppType()&&(s=CommonUIStrings.L_SaveACopy),this.initializeAndShow(s,i.i(this,this.fileNameDialogHandler,"fileNameDialogHandler"),a),this.disableSaveButton(e,n),this.get_dialogElement().style.width=t.DialogWidth,this._saveToAnotherFolderButton=document.getElementById(t.SaveToAnotherFolderButtonId),this._saveToAnotherFolderButton.className=t.ButtonClass,Sys.UI.DomElement.addCssClass(document.getElementById(t.DocumentLocationBlockId),t.DocumentLocationBlockClass);var l=!1;r&&r.length?(this.AddButtonAccessibility(this._saveToAnotherFolderButton,String.format(CommonUIStrings.l_ScreenReader_CurrentFileLocation,o,r)),this.AddBreadcrumbToCurrentFolder(o,r,(0,b.m)((function(){return l}),(function(e){return l=e})))):this.AddButtonAccessibility(this._saveToAnotherFolderButton,CommonUIStrings.l_CurrentOnlineFolder),this.AddIconDOMElement(this._saveToAnotherFolderButton),this.AddButtonTextDOMElement(this._saveToAnotherFolderButton),l?(document.getElementById(t.CurrentFolderId).style.width="100%",Sys.UI.DomElement.addCssClass(this._saveToAnotherFolderButton,t.TwoLineButtonClass),v.ULS.sendTraceTag(24459297,216,50,"Move save to another folder button to second line.")):Sys.UI.DomElement.addCssClass(this._saveToAnotherFolderButton,t.OneLineButtonClass),R.n.addHandler(this._saveToAnotherFolderButton,w.d.click,i.i(this,this.OnSaveToAnotherLocationClick,"OnSaveToAnotherLocationClick")),R.n.addHandler(this._saveToAnotherFolderButton,w.d.keyDown,i.i(this,this.OnSaveToAnotherLocationKeyDown,"OnSaveToAnotherLocationKeyDown"))},t.prototype.AddBreadcrumbToCurrentFolder=function(e,n,r){r.val=!1;var i=document.getElementById(t.CurrentFolderId);i.innerText="";var o=this.GetNameWidthInBrowser(i,e),a=this.GetNameWidthInBrowser(i,n),s=t.MaxLengthOneLine,l=t.MaxLengthOneLine;o+a>t.MaxLengthOneLine&&(s=Math.max(t.MaxFolderNameDisplayLength,t.MaxLengthTwoLine-o),l=Math.max(t.MaxSiteNameDisplayLength,t.MaxLengthTwoLine-a),r.val=!0),this.AddSiteNameAndFolderName(i,e,l,n,s)},t.prototype.GetNameWidthInBrowser=function(e,t){var n=document.createElement("div");n.innerText=t,n.style.visibility="hidden",e.appendChild(n);var r=n.clientWidth;return e.removeChild(n),r},t.prototype.AddSiteNameAndFolderName=function(e,t,n,r,i){t&&(this.AddBreadElement(e,t,n),this.AddSeparatorElement(e)),r&&this.AddBreadElement(e,r,i)},t.prototype.AddBreadElement=function(e,n,r){var i=document.createElement("div");i.innerText=n,i.title=n,i.className=t.BreadcrumClass,i.style.maxWidth=r.toString()+"px",e.appendChild(i)},t.prototype.AddSeparatorElement=function(e){var n=document.createElement("span");n.id=t.FolderSeparatorId;var r=document.createElementNS(t.SvgNs,"svg");r.setAttribute("class",t.CaretClass);var i=document.createElementNS(t.SvgNs,"polygon");i.setAttribute("points",t.CaretSVGPath),r.appendChild(i),n.appendChild(r),e.appendChild(n)},t.prototype.AddButtonAccessibility=function(e,t){var n=String.format(CommonUIStrings.l_ScreenReader_SaveToAnotherFolderButton,t);e.tabIndex=0,e.setAttribute(k.t.ariaLabelAttribute,n),e.setAttribute(k.t.ariaRoleAttribute,k.t.ariaButtonRole)},t.prototype.AddButtonTextDOMElement=function(e){var n=document.createElement("span");n.id=t.ButtonTextId,n.innerText=this.ButtonTextString,n.className=t.ButtonTextClass,e.appendChild(n)},t.prototype.AddIconDOMElement=function(e){var n=document.createElement("span");n.className=t.ButtonIconSpanClass,this._iconSVG=document.createElementNS(t.SvgNs,"svg"),this._iconSVG.setAttribute("class",t.ButtonIconSVGClass);var r=document.createElementNS(t.SvgNs,"path");r.setAttribute("d",t.ButtonIconSVGPath),this._iconSVG.appendChild(r),n.appendChild(this._iconSVG),e.appendChild(n)},t.prototype.OnSaveToAnotherLocationKeyDown=function(e){!e||e.keyCode!==E.v.vK_Enter&&e.keyCode!==E.v.vK_Spacebar||this.OnSaveToAnotherLocationClick(e)},t.prototype.OnSaveToAnotherLocationClick=function(e){if(this._fileNameTextbox){var t=D.l.getFileExtension(F.AFrameworkApplication.fileName),n=this._fileNameTextbox.value;if(this.hide(),(!n||""===n||""===t)&&1!==this.get_activeFrame().get_state())return void this._errorDialogFactory.create().displayError(2,n,!1);if(""!==t&&(n+=t),this.fileNameHasInvalidChars(n))return void this._errorDialogFactory.create().displayError(1,n,!1);this._saveToSharePointManager.start(n,this._options$5)}},t.prototype.ChangeSaveToAnotherFolderButtonState=function(e){this._saveToAnotherFolderButton&&this._iconSVG&&(e?(this._saveToAnotherFolderButton.tabIndex=0,Sys.UI.DomElement.removeCssClass(this._saveToAnotherFolderButton,t.SaveToAnotherFolderButtonDisableClass),Sys.UI.DomElement.removeCssClass(this._iconSVG,t.DisableIconInHighContrastModeClass)):(this._saveToAnotherFolderButton.tabIndex=-1,Sys.UI.DomElement.containsCssClass(this._saveToAnotherFolderButton,t.SaveToAnotherFolderButtonDisableClass)||Sys.UI.DomElement.containsCssClass(this._iconSVG,t.DisableIconInHighContrastModeClass)||(Sys.UI.DomElement.addCssClass(this._saveToAnotherFolderButton,t.SaveToAnotherFolderButtonDisableClass),Sys.UI.DomElement.addCssClass(this._iconSVG,t.DisableIconInHighContrastModeClass))))},t.prototype.handleFileNameChanged=function(){e.prototype.handleFileNameChanged.call(this),this.ChangeSaveToAnotherFolderButtonState(!!this._fileNameTextbox&&""!==this._fileNameTextbox.value)},t.prototype.dispose=function(){this._saveToAnotherFolderButton&&(R.n.removeHandler(this._saveToAnotherFolderButton,w.d.click,i.i(this,this.OnSaveToAnotherLocationClick,"OnSaveToAnotherLocationClick")),R.n.removeHandler(this._saveToAnotherFolderButton,w.d.keyDown,i.i(this,this.OnSaveToAnotherLocationKeyDown,"OnSaveToAnotherLocationKeyDown")),this._saveToAnotherFolderButton=null),e.prototype.dispose.call(this)},t.Id="FileNameDialog-SaveToSharePoint",t.DialogWidth="450px",t.DocumentLocationBlockId="DocumentLocationBlock",t.DocumentLocationBlockClass="SaveAsDialogRow",t.ButtonClass="WACButton WACDialogButtonNormal",t.OneLineButtonClass="SaveToAnotherLocationOne",t.TwoLineButtonClass="SaveToAnotherLocationTwo",t.SaveToAnotherFolderButtonId="anotherFolder",t.SaveToAnotherFolderButtonDisableClass="DisabledSaveAsButton",t.DisableIconInHighContrastModeClass="DisabledFolderIconSVG",t.ButtonIconSpanClass="cui-img-cont-float cui-img-16by16 ",t.ButtonIconSVGClass="FolderIconSVG",t.SvgNs="http://www.w3.org/2000/svg",t.ButtonIconSVGPath="M0,14V4L1.25,3h6.5L9.606,1H13.25L14,2V6h1.5L16,7.25,14.25,14H0ZM13,6V2H10L8.25,4,1.957,3.914,1,4.75V12L3.25,6.75l1-.75H13Z",t.ButtonTextId="anotherFolderText",t.ButtonTextClass="AnotherFolderTextSpan",t.CurrentFolderId="currentLocation",t.BreadcrumbSeparatorImageName="BreadcrumbCaret_6x16x32",t.FolderSeparatorId="FolderSeparator",t.CaretSVGPath="1 4 1 11 5 7.5",t.CaretClass="SeparatorCaret",t.MaxLengthOneLine=255,t.MaxLengthTwoLine=408,t.MaxSiteNameDisplayLength=170,t.MaxFolderNameDisplayLength=238,t.BreadcrumClass="SaveToAnotherFolderBreadcrumb",t}(A.p);(0,i.l)(O,"19fa990b$FileNameDialog",A.p,[T]);var U=function(){function e(e,t,n,r,i,o,a){this._actionManager=null,this._aframeApplication=null,this._uploadToHostManager=null,this._errorDialogFactory=null,this._appSettingsManager=null,this._activeFrame=null,this._saveToColudManager=null,this._actionManager=t,this._appSettingsManager=e,this._aframeApplication=r,this._uploadToHostManager=o,this._errorDialogFactory=i,this._activeFrame=n,this._saveToColudManager=a}return e.prototype.create=function(e){return new O(this._appSettingsManager,this._actionManager,this._activeFrame,this._aframeApplication,this._errorDialogFactory,this._uploadToHostManager,this._saveToColudManager,e)},e}();(0,i.l)(U,"e1ba57f$FileNameDialogFactory",null,[C]);var x=n(7889),L=n(8896),N=function(){function e(e,t,n,o){var a=this;this._filePickerApiManager=null,this._activeFrame=null,this._pickerDialogFactory=null,this._oneDriveForBusinessUrl=null,this._cachedGetMoreInfoResult=null,this._getMoreInfoEventReceiver=null,this._filePickerApiManager=e,this._activeFrame=n,this._pickerDialogFactory=o,this._getMoreInfoEventReceiver=new g.q(L.k.$$(r.c),(function(){return new x.u(r.c,t.get_value(),i.i(a,a.GetMoreInfoEventReceived,"GetMoreInfoEventReceived"))}))}return e.prototype.get_oneDriveForBusinessUrl=function(){return this._oneDriveForBusinessUrl||(this._getMoreInfoEventReceiver.get_value().getResult(e.GetMoreInfoTriggerName,!0),this._cachedGetMoreInfoResult&&this._cachedGetMoreInfoResult.get_personalFileStorageUrl()&&this._cachedGetMoreInfoResult.get_personalFileStorageUrl().length&&(this._oneDriveForBusinessUrl=this.GetOneDriveForBussinessPageUrl(this._cachedGetMoreInfoResult.get_personalFileStorageUrl()))),this._oneDriveForBusinessUrl},e.prototype.start=function(e){var t=this;if(!this.get_oneDriveForBusinessUrl()){if(!F.AFrameworkApplication.breadcrumbFolderUrl||!F.AFrameworkApplication.breadcrumbFolderUrl.length)return v.ULS.sendTraceTag(23881884,216,10,"CachedGetMoreInfoResult is null, can't get OneDrive for Bussiness page url. BreadcrumbFolderUrl is null. Get more info result is null: ",!this._cachedGetMoreInfoResult),!1;this._oneDriveForBusinessUrl=F.AFrameworkApplication.breadcrumbFolderUrl}var n=this._pickerDialogFactory();n.showPickerDialg();var r=n.getPickerContainer();return r?(this._filePickerApiManager.start((function(t,r){n.hide(),e(t,r)}),(function(){t.OnCancel(n)}),r,this._oneDriveForBusinessUrl),!0):(v.ULS.sendTraceTag(24664067,216,10,"Picker container is null, will not show picker."),!1)},e.prototype.OnCancel=function(e){e.hide(),v.ULS.sendTraceTag(24664068,216,50,"User cancelled save to another folder.")},e.prototype.GetOneDriveForBussinessPageUrl=function(t){(t=t.toLowerCase()).endsWith("/")||(t+="/");var n=t.indexOf(e.DocumentsString);return-1!==n?t.substring(0,n+1)+"_layouts/15/onedrive.aspx":""},e.prototype.GetMoreInfoEventReceived=function(e,t){this._cachedGetMoreInfoResult||3!==e.get_state()||(this._cachedGetMoreInfoResult=e)},e.DocumentsString="/documents/",e.GetMoreInfoTriggerName="Save As",e}();(0,i.l)(N,"5538a1cc$OneDriveFilePickerHelper",null,[l]);var B=(0,i.y)("32f4a165$IPickerDialog"),H=function(e){function t(){return e.call(this)||this}return(0,f.t)(t,e),t.prototype.showPickerDialg=function(){this._customCssClass=t.FilePickerDialogClass,this.set_dialogHtml(t.PickerContainerHtml),this.set_dialogId(t.Id),this.showDialog("",null)},t.prototype.getPickerContainer=function(){return document.getElementById(t.IframeDivId)},t.prototype.sizeAndPositionDialog=function(){},t.prototype.reSizeDialog=function(){},t.Id="PickerDialog-MsoSp",t.IframeDivId="FilePickerDiv",t.FilePickerDialogClass="FilePickerDialog",t.PickerContainerHtml="<div class='FilePickerDiv' id='FilePickerDiv'></div>",t}(M.o);(0,i.l)(H,"e746e48c$PickerDialog",M.o,[B]);var $=n(9910),G=n(1991),W=n(3608),V=n(2192),j=n(3667),q=function(){function e(e,t,n,r,i,o,a){this._fileNameDialogFactory=null,this._appSettingsManager=null,this._actionManager=null,this._saveToSharePointManager=null,this._filePickerApiManager=null,this._oneDriveFilePickerHelper=null,this._canSaveACopy=null,this._appSettingsManager=e,this._fileNameDialogFactory=n,this._actionManager=t,this._saveToSharePointManager=r,this._filePickerApiManager=i,this._oneDriveFilePickerHelper=o,this._canSaveACopy=a}return e.prototype.registerActions=function(){var e=this,t=this._filePickerApiManager.getOneDriveApi();t?j.y.get_isInternetExplorer()||this._appSettingsManager.getBooleanAppSetting("SaveToSharePointOnDemandDownloadJsIsEnabled")?this._actionManager.addActionWithFlags($.b.saveToSharePoint,V.m.frame,i.i(this,this.saveToSharePointActionDispatcher,"saveToSharePointActionDispatcher"),64):(t.get_loadFinishedTask().CW((function(t){t.get_isFaulted()&&e._filePickerApiManager.onJsDownloadFail(t)})),this.CallDownloadQueueActionsForOneDriveApi()):v.ULS.sendTraceTag(25180162,216,15,"Failure with OneDrive API download as the js url is empty.")},e.prototype.CallDownloadQueueActionsForOneDriveApi=function(){W.z.registerDispatchHandler(i.i(this,this.saveToSharePointActionDispatcher,"saveToSharePointActionDispatcher")),W.z.enqueueActions([new G.f($.b.saveToSharePoint,V.m.frame,0)],this._filePickerApiManager.getOneDriveApi())},e.prototype.get_isUIEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("SaveToAnotherFolderBrsIsEnabled")},e.prototype.get_canWriteRelativeFile=function(){return this._appSettingsManager.getBooleanAppSetting("UserCanWriteRelative")},e.prototype.saveToSharePointActionDispatcher=function(e,t,n,r,i){if(t.get_contextId()!==V.m.frame||e!==$.b.saveToSharePoint)return 2;if(!this.get_isUIEnabled()||!this._oneDriveFilePickerHelper.get_oneDriveForBusinessUrl()&&!this.get_canWriteRelativeFile())return 8;if(1===n)return this._canSaveACopy()?32:8;if(2===n){v.ULS.sendTraceTag(23881885,216,50,"User clicked on SaveToSharePoint button from the backstage.");var o=i;if(o&&o.FileDownloadUrl&&v.ULS.sendTraceTag(40379589,216,50,"SaveToSharePoint FileDownloadUrl - "+o.FileDownloadUrl),this.get_canWriteRelativeFile())v.ULS.sendTraceTag(24524226,216,50,"Show save a copy dialog."),this._fileNameDialogFactory.create(o).displayDialog(null);else v.ULS.sendTraceTag(24524225,216,50,"No permission save to current folder, show Picker to save to another folder."),this._saveToSharePointManager.start(null,o);return 32}return 8},e}();(0,i.l)(q,"b1db5952$SaveToSharePointActor",null,[]);var z=function(){function e(e,t,n,r){this._activeFrame=null,this._errorDialogFactory=null,this._uploadToSharePointManager=null,this._oneDriveFilePickerHelper=null,this._newFileName=null,this._options=null,this._uploadToSharePointManager=e,this._errorDialogFactory=t,this._oneDriveFilePickerHelper=n,this._activeFrame=r}return e.prototype.start=function(e,t){var n=this;v.ULS.sendTraceTag(25180163,216,50,"Try launch Picker."),this._newFileName=e,this._options=t,this._oneDriveFilePickerHelper.start((function(e,t){n.ProcessResponse(e,t)}))||this.ShowPickerWarningDialog()},e.prototype.ProcessResponse=function(e,t){var n=t;e?this.OnSuccess(n):this.OnFailure(n)},e.prototype.ShowPickerWarningDialog=function(){1!==this._activeFrame.get_state()&&this._errorDialogFactory().displayWarning(CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_OneDriveContactError)},e.prototype.OnSuccess=function(e){if(v.ULS.sendTraceTag(23881886,216,50,"Success Callback called. Calling UploadToSharePointManager to start upload."),e&&e.data&&e.data.value&&e.data.value.length&&e.data.value[0].sharePoint){var t=e.data.value[0].sharePoint.url,n=e.data.value[0].sharePoint.listUrl,r=null;if(t&&(r=n?this.GetSiteUrlFromListUrl(n):this.GetSiteUrlFromFolderUrl(t)))return void this._uploadToSharePointManager.startUpload(t,this._newFileName,r,this._options);v.ULS.sendTraceTag(25180164,216,10,"Picker return invalid data, folder url is null: {0}, siteUrl url is null: {1}.",!t,!r)}v.ULS.sendTraceTag(23881887,216,10,"Picker return invalid data or empty SharePoint url."),this.ShowPickerWarningDialog()},e.prototype.GetSiteUrlFromFolderUrl=function(e){e.endsWith("/")||(e+="/");for(var t=0,n=0;n<e.length;n++)if("/"===e.charAt(n)&&5==++t)return e.substr(0,n);return null},e.prototype.GetSiteUrlFromListUrl=function(e){e.endsWith("/")&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return-1!==t?e.substring(0,t):null},e.prototype.OnFailure=function(e){v.ULS.sendTraceTag(23881888,216,10,"Picker failure Callback called."),e&&e.error?v.ULS.sendTraceTag(23881889,216,10,"File Dialog returned with error code:{0}, and error message: {1}.",e.error.errorCode,e.error.message):v.ULS.sendTraceTag(23881890,216,10,"File Dialog returned empty error."),this.ShowPickerWarningDialog()},e}();(0,i.l)(z,"840bf72a$SaveToSharePointManager",null,[s]);var K=(0,i.y)("d005f42c$ISharePointSaveAsCaller"),Q=n(3096),Z=function(){function e(e,t,n,r,i,o,a,s){this._webServiceBase=null,this._fileName=null,this._fileNewName=null,this._querySig=null,this._folderUrl=null,this._siteUrl=null,this._handlerName=null,this._options=null,this._webServiceBase=e,this._fileName=t,this._fileNewName=r,this._querySig=o,this._folderUrl=n,this._siteUrl=i,this._handlerName=a,this._options=s}return e.prototype.execute=function(t,n){if(!F.AFrameworkApplication.isShuttingDown&&F.AFrameworkApplication.theClientRequestManager){var r={};r[e.contentHeader]=e.contentHeaderValue;var i=this._webServiceBase+this._handlerName;i=Q.n.addOrReplaceParameterValue(i,e.handlerFolderUrlParam,D.l.urlKeyValueEncode(this._folderUrl),!1),i=Q.n.addOrReplaceParameterValue(i,e.handlerSiteUrl,D.l.urlKeyValueEncode(this._siteUrl),!1),i=Q.n.addOrReplaceParameterValue(i,e.handlerFilenameParam,D.l.urlKeyValueEncode(this._fileName),!1),i=Q.n.addOrReplaceParameterValue(i,e.handlerTimeParam,D.l.urlKeyValueEncode((new Date).getTime().toString()),!1),this._options&&this._options.FileDownloadUrl&&(i=Q.n.addOrReplaceParameterValue(i,e.handlerFileDownloadUrlParam,D.l.urlKeyValueEncode(this._options.FileDownloadUrl),!1)),i=i+"&"+this._querySig,this._fileNewName&&this._fileNewName.length?i=Q.n.addOrReplaceParameterValue(i,e.handlerFileNewNameParam,D.l.urlKeyValueEncode(this._fileNewName),!1):v.ULS.sendTraceTag(23881891,216,15,"No new file name in request."),v.ULS.sendTraceTag(23881920,216,50,"Trying send SharePointSaveAsHandler.ashx request."),F.AFrameworkApplication.theClientRequestManager.addRequest(i,1,"",r,!1,2,t,n,null,null,!1,null,null,"9",null,!1,null,!1)}},e.contentHeader="Content-Type",e.contentHeaderValue="application/json; charset=utf-8",e.handlerFolderUrlParam="fu",e.handlerFilenameParam="fn",e.handlerFileNewNameParam="fnn",e.handlerSiteUrl="su",e.handlerTimeParam="n",e.handlerFileDownloadUrlParam="furl",e}();(0,i.l)(Z,"dd0be725$SharePointSaveAsCaller",null,[K]);var J=function(){function e(e){this._webServiceUrl=null,this._fileName=null,this._handlerName=null,this._webServiceUrl=e.get_appSettings().SaveAsToHostWebServiceBase,this._fileName=e.get_appSettings().FileName,this._handlerName=e.getStringAppSetting("SharePointSaveAsHandler")||"sharepointsaveashandler.ashx"}return e.prototype.create=function(e,t,n,r){return new Z(this._webServiceUrl,this._fileName,e,t,n,F.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,this._handlerName,r)},e}();(0,i.l)(J,"53273aa1$SharePointUploadCallerFactory",null,[o]);var X=n(8996),Y=n(5989),ee=n(5227),te=n(1638),ne=n(275),re=n(5634),ie=function(){function e(e,t,n,r,i){this._uploadCallerFactory=null,this._caller=null,this._progressDialog=null,this._activeFrame=null,this._progressDialogFactory=null,this._errorDialogFactory=null,this._actionManager=null,this._alreadyRetry=!1,this._folderUrl=null,this._uploadCallerFactory=t,this._progressDialogFactory=n,this._errorDialogFactory=r,this._activeFrame=i,this._actionManager=e}return e.prototype.startUpload=function(e,t,n,r){this._alreadyRetry=!1,v.ULS.sendTraceTag(23881921,216,50,"UploadToSharePointManager.StartUpload : Starting to upload file"),this.ShowWaitUI(),this._folderUrl=e,this._caller=this._uploadCallerFactory.create(e,t,n,r),r&&"true"===r.SkipSaveToHost?this.ExecuteUpload():this.ForceSaveAndUpload()},e.prototype.ForceSaveAndUpload=function(){var e=this,t=function(){v.ULS.sendTraceTag(23881923,216,15,"The file change is not saved successfully, this operation may lead to data loss."),e.ExecuteUpload()};32!==this._actionManager.processActionWithData($.b.saveFileChange,2,[function(){v.ULS.sendTraceTag(23881922,216,50,"Call the force save file change successfully."),e.ExecuteUpload()},t],null)&&t()},e.prototype.ExecuteUpload=function(){v.ULS.sendTraceTag(23881924,216,50,"Send SharePointSaveAsHandler.ashx request."),this._caller.execute(i.i(this,this.OnSaveToSharePointUploadFinished,"OnSaveToSharePointUploadFinished"),i.i(this,this.OnSaveToSharePointUploadFailed,"OnSaveToSharePointUploadFailed"))},e.prototype.OnSaveToSharePointUploadFinished=function(e){if(!e||!e.get_data()||!e.get_data().responseData)return v.ULS.sendTraceTag(23881925,216,10,"Upload failure. Response data is null"),void(this.DoRetry()||this.ShowUploadFailedDialog());var t;if(!X.x.tryDeserialize(Object,e.get_data().responseData,(0,b.m)((function(){return t}),(function(e){return t=e}))))return v.ULS.sendTraceTag(23881926,216,10,"Failed to deserialize : {0}",{ResponseData:re.l.truncateIfNecessary(e.get_data().responseData)}),void(this.DoRetry()||this.ShowUploadFailedDialog());var n=t;if(n.StatusCode!==ee.k.oK_200&&n.StatusCode!==ee.k.created_201)return v.ULS.sendTraceTag(25235987,216,15,"UploadToSharePointManager upload failed with status: {0}, status code: {1}.",e.get_data().status,n.StatusCode),void(n.StatusCode!==ee.k.requestEntityTooLarge_413&&this.DoRetryWithStatusCode(e.get_data().status)||this.ShowErrorUIWithErrorCode(n.StatusCode));v.ULS.sendTraceTag(23881927,216,50,"UploadToSharePointManager upload success.");try{n.NewDocumentUrl?this.RedirectToEditUrl(n.NewDocumentUrl):this.RedirectToFolder()}catch(e){v.ULS.sendTraceTag(37025729,216,15,"Redirect failed with exception: {0}",e.toString())}},e.prototype.OnSaveToSharePointUploadFailed=function(e){if(!e||!e.get_data())return v.ULS.sendTraceTag(23881928,216,10,"Upload failure. Response data is null"),void(this.DoRetry()||this.ShowUploadFailedDialog());this.DoRetryWithStatusCode(e.get_data().status)||(v.ULS.sendTraceTag(23881929,216,10,"Upload failed."),this.ShowUploadFailedDialog())},e.prototype.DoRetry=function(){return this._alreadyRetry?(v.ULS.sendTraceTag(23881931,216,10,"Upload fail. Already retry once but still fail."),!1):(v.ULS.sendTraceTag(23881930,216,10,"Upload fail. Retrying."),this._alreadyRetry=!0,this.ExecuteUpload(),!0)},e.prototype.DoRetryWithStatusCode=function(e){return v.ULS.sendTraceTag(23881932,216,10,"HTTP failure with code: {0}",e),this.DoRetry()},e.prototype.RedirectToFolder=function(){v.ULS.sendTraceTag(23881933,216,50,"Redirecting to Folder."),window.open(this._folderUrl,Y.g.windowTargetToString(3))},e.prototype.RedirectToEditUrl=function(e){var t=!1,n=!1;if(F.AFrameworkApplication.appSettingsManager&&(t=F.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveACopyIsEnabledForUiHost"),n=F.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures")),v.ULS.sendTraceTag(23881934,216,50,"Redirecting to edit url {0}. IsEnabledForUiHost {1}",e,t),t&&n){v.ULS.sendTraceTag(51245198,216,50,"UploadToSharePointManager.RedirectToEditUrl: Sending DocumentRefresh post message.");var r={};r[te.t.rebootMode]="1",r[te.t.documentUrl]=e,F.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessageWithRetry(ne.a.documentRefresh,r,"",0)}))}else window.open(e,Y.g.windowTargetToString(3))},e.prototype.ShowWaitUI=function(){this._activeFrame&&1===this._activeFrame.get_state()||(this._progressDialog=this._progressDialogFactory(),this._progressDialog.set_message(CommonUIStrings.l_CommentProgressTooltip),this._progressDialog.set_buttonsOption(5),this._progressDialog.set_hasCloseGlyph(!1),this._progressDialog.showProgressDialog(CommonUIStrings.l_DefaultDialogTitle,null,null))},e.prototype.DismissWaitUI=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},e.prototype.ShowUploadFailedDialog=function(){this.ShowErrorDialog(CommonUIStrings.l_SaveFailedDialogTitle,CommonUIStrings.l_FailToSaveFile,S.p.saveAsToSharePointFailed_Unspecified)},e.prototype.ShowNoPermissionErrorDialog=function(){this.ShowErrorDialog(CommonUIStrings.l_NoSavePermissionDialogTitle,CommonUIStrings.l_NoSavePermissionDialogMessage,S.p.saveAsToSharePointFailed_Unspecified)},e.prototype.ShowFileSizeTooLargeDialog=function(){var t=String.format(CommonUIStrings.l_SaveAsFileTooLargeMessage,e.MaxSupportedFileSizeInMB);this.ShowErrorDialog(CommonUIStrings.l_SaveAsFileTooLargeTitle,t,S.p.saveAsFileSizeTooLarge)},e.prototype.ShowErrorDialog=function(e,t,n){v.ULS.sendTraceTag(25180165,216,10,"Upload failure with title: {0}, message: {1}",e,t),this.DismissWaitUI(),1!==this._activeFrame.get_state()&&this._errorDialogFactory().displayErrorWithErrorCode(e,t,n)},e.prototype.ShowErrorUIWithErrorCode=function(e){switch(v.ULS.sendTraceTag(25180166,216,50,"Upload fail with status code: {0}.",e),e){case ee.k.unauthorized_401:this.ShowNoPermissionErrorDialog();break;case ee.k.requestEntityTooLarge_413:this.ShowFileSizeTooLargeDialog();break;default:this.ShowUploadFailedDialog()}},e.MaxSupportedFileSizeInMB=250,e}();(0,i.l)(ie,"f36aad08$UploadToSharePointManager",null,[a]);var oe=n(7689),ae=n(1526),se=n(4311),le=n(2449);n.d(t,{PackageManager:function(){return ue}});var ue=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"Common.App.SaveToSharePoint"},e.prototype.init=function(){},e.prototype.dispose=function(){},e.prototype.configure=function(e){var t=this;this._container=e;var n=le.q.taskFromFuture(oe.o.$$(r.c),e.resolveFuture(oe.o.$$(r.c)));h.Task.WAA.call(null,n).CW((function(i){t._container.register(J).as(o).usingFactory((function(){return new J(F.AFrameworkApplication.appSettingsManager)})).singleInstance(),t._container.register(ie).as(a).usingFactory((function(){return new ie(F.AFrameworkApplication.get_theActionManager(),e.resolve(J),(function(){return new se.c(!1)}),(function(){return new I}),F.AFrameworkApplication.get_activeFrame())})).singleInstance(),t._container.register(z).as(s).usingFactory((function(){return new z(e.resolve(ie),(function(){return new I}),e.resolve(l),F.AFrameworkApplication.get_activeFrame())})).singleInstance(),t._container.register(N).as(l).usingFactory((function(){return new N(e.resolve(_.f),new g.q(oe.o.$$(r.c),(function(){return n.get_result()})),F.AFrameworkApplication.get_activeFrame(),(function(){return new H}))})).singleInstance(),t._container.register(U).usingFactory((function(){return new U(F.AFrameworkApplication.appSettingsManager,F.AFrameworkApplication.get_theActionManager(),F.AFrameworkApplication.get_activeFrame(),F.AFrameworkApplication.get_activeFrame().get_applicationInstance(),e.resolve(u.o),e.resolve(c.h),e.resolve(s))})).singleInstance(),t._container.register(q).usingFactory((function(){return new q(F.AFrameworkApplication.appSettingsManager,F.AFrameworkApplication.get_theActionManager(),e.resolve(U),e.resolve(s),e.resolve(_.f),e.resolve(l),(function(){return F.AFrameworkApplication.get_activeFrame().get_canSaveACopy()}))})).singleInstance(),F.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveToAnotherFolderBrsIsEnabled")&&t._container.resolve(q).registerActions()}))},e.main=function(){ae.o.get_instance().registerPackage(new e,0,!1)},e}();(0,i.l)(ue,"b94e724b$PackageManager",null,[d.u,p.s])},1381:function(e,t,n){"use strict";n.r(t);var r=n(1252),i=n(363),o=n(8192),a=n(1526),s=n(1323),l=n(9210),u=n(5989),c=n(6382),d=n(423),p=(0,d.y)("9e012f2f$IParagraphRenderMetricsAggregator"),g=function(){return function(){}}();(0,d.l)(g,"994961fa$RenderMetric",null,[]);var h=function(){function e(e,t){this._renderStartTime=null,this._paragraphMetricAggregator=null,this._currentTimeGetter=null,this._paragraphMetricAggregator=e,this._currentTimeGetter=t}return e.prototype.renderStarted=function(){this._renderStartTime=this._currentTimeGetter()},e.prototype.renderCompleted=function(e){if(null!=this._renderStartTime){var t=new g;t.RT=Math.round(this._currentTimeGetter()-this._renderStartTime),t.PS=e,this._paragraphMetricAggregator.track(t,null)}this._renderStartTime=null},e}();(0,d.l)(h,"e0e2995e$ParagraphRenderMetricsAggregator",null,[p]);var _=function(){function e(e){this._paragraphRenderMetricsAggregator=null,this._currentTimeGetter=null,this._currentTimeGetter=e}return e.prototype.Initialize=function(e){this._paragraphRenderMetricsAggregator=new h(e,this._currentTimeGetter)},e.prototype.tryGetParagraphRenderMetricsAggregator=function(){return this._paragraphRenderMetricsAggregator},e}();(0,d.l)(_,"3fdbaebf$ParagraphRenderMetricsAggregatorProvider",null,[r.e]),n.d(t,{ParagraphRenderMetricsPackage:function(){return f}});var f=function(){function e(){}return e.prototype.get_name=function(){return"Common.App.ParagraphRenderMetrics"},e.prototype.init=function(){var e=new l.y(g),t=s.n.$$(g).getAnInstance(13,1,e,!0,null);c.w.get_instance().resolve(_).Initialize(t)},e.prototype.dispose=function(){},e.prototype.configure=function(e){e.register(_).as(r.e).singleInstance().usingFactory((function(){return new _(u.g.getTickCount)}))},e.main=function(){a.o.get_instance().registerPackage(new e,0,!1)},e}();(0,d.l)(f,"5dfcef5d$ParagraphRenderMetricsPackage",null,[i.u,o.s])},1388:function(e,t,n){"use strict";n.r(t),n.d(t,{AMergeBlock:function(){return s}});var r=n(207),i=n(9402),o=n(5479),a=n(423),s=function(){function e(e,t,n){this.type=0,this.source=0,this.graphNodeId=null,this.twin=null,this.set_type(e),this.source=t,this.graphNodeId=n}return e.prototype.get_type=function(){return this.type},e.prototype.set_type=function(e){return this.type=e,e},e.prototype.get_supportsSplitIntoMoreGranularBlocks=function(){return!1},e.prototype.get_isFromBase=function(){return 1==(1&this.source)},e.prototype.get_isFromFavoredUpdate=function(){return 2==(2&this.source)},e.prototype.get_isFromUnfavoredUpdate=function(){return 4==(4&this.source)},e.prototype.isTextOrCharacterRun=function(){return!1},e.prototype.toString=function(){return String.format("[Source: {0}] [Type: {1}]",this.GetBlockSourceString(),this.getBlockTypeString())},e.prototype.GetBlockSourceString=function(){var e="";return this.get_isFromBase()&&(e+="Base"),this.get_isFromFavoredUpdate()&&(e+="FavoredUpdate"),this.get_isFromUnfavoredUpdate()&&(e+="UnfavoredUpdate"),e},e.prototype.getBlockTypeString=function(){return""},e.prototype.isEquivalentTo=function(e,t,n,r){return this.get_type()===e.get_type()},e.prototype.splitIntoMoreGranularBlocks=function(){var t=new o.o(e,null);return t.add(this),t},e.prototype.get_length=function(){return 0},e}();(0,a.l)(s,"26571734$AMergeBlock",null,[r.d,i.v.$$(Object)])},1480:function(e,t,n){"use strict";var r,i=n(423);!function(e){e[e.none=0]="none",e[e.realtimeChannel=1]="realtimeChannel",e[e.rename=2]="rename",e[e.supportsChat=4]="supportsChat",e[e.all=7]="all"}(r||(r={})),(0,i.h)("b478d2cd$Capabilities",r)},1482:function(e,t,n){"use strict";n.d(t,{b:function(){return r}});var r=(0,n(423).y)("44c87980$IPresenceInfo")},1502:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("234f3633$IRenameDialogActor"),o=(0,r.y)("291c258c$IRenameDialogFactory"),a=(0,r.y)("179e5123$IRenamedFileChecker"),s=n(363),l=n(8192),u=n(3518),c=n(2899),d=n(3362),p=n(7597),g=n(9910),h=n(3545),_=n(8027),f=function(){function e(){}return e.get_dialogHtml=function(){return _.o.formatHtml(e.DialogHtmlFormat,CommonUIStrings.l_RenameFileRenameDisabled,CommonUIStrings.l_RenameFileRenameDisabledSignIn,CommonUIStrings.l_RenameFileRenameDisabledPermission,CommonUIStrings.l_RenameFileRenameDisabledCoauth)},e.DialogHtmlFormat="<div class='WACDialogRow' id='RenameRow'> <label id='labelDisabledMessage' class='WACDialogLabel' >{0}</label> <div class='WACDialogRow' id='MultipleSuggestionsRow'> <ul id='ulRenameFileDisabled' class='WACDialogUList'> <li id='liRenameFileRenameDisabledSignIn'>{1}</li> <li id='liRenameFileRenameDisabledPermission'>{2}</li> <li id='liRenameFileRenameDisabledCoauth'>{3}</li> </ul> </div> </div>",e}();(0,r.l)(f,"c9e75dd8$RenameDisabledDialogHtml",null,[]);var m=function(){return function(e,t,n){this.showSingleSuggestionCoauth=!1,this.showSingleSuggestionPermission=!1,this.showMultipleSuggestionsHideSignInText=!1,this.showMultipleSuggestionsHidePermissionText=!1,this.showMultipleSuggestionsHideCoauthText=!1,this.showSingleSuggestionCoauth=!e&&!t,this.showSingleSuggestionPermission=!e&&!n,this.showSingleSuggestionCoauth||this.showSingleSuggestionPermission||(this.showMultipleSuggestionsHideSignInText=!e,this.showMultipleSuggestionsHidePermissionText=!t,this.showMultipleSuggestionsHideCoauthText=!n)}}();(0,r.l)(m,"e8263baf$RenameDisabledDialogInfo",null,[]);var y=function(e){function t(n,r,i,o,a){var s=this;return s._info=null,s._userCanRenameInCoauthSessionsWithRenameCapableUsers=!1,s._isReadOnlyRecommended=!1,(s=e.call(this)||this)._info=new m(n,r,i),s._userCanRenameInCoauthSessionsWithRenameCapableUsers=o,s._isReadOnlyRecommended=a,s.set_dialogId(t.Id),s.set_buttonsOption(0),s.setButtonText(1,CommonUIStrings.l_DialogClose),s.set_dialogHtml(f.get_dialogHtml()),s.showDialog(CommonUIStrings.l_RenameFileRenameDisabledTitle,null),s.setDescribedByForDialog(t.RenameRowId),s}return(0,h.t)(t,e),t.prototype.onInnerHtmlSet=function(){if(this._info.showSingleSuggestionCoauth){var e="";e=this._userCanRenameInCoauthSessionsWithRenameCapableUsers?this._isReadOnlyRecommended?CommonUIStrings.l_RenameFileRenameReadOnlyRecommended:CommonUIStrings.l_RenameFileRenameNotEveryoneSupportsRename:CommonUIStrings.l_RenameFileRenameDisabledCoauthFull,t.ShowSingleSuggestion(document.getElementById("ulRenameFileDisabled"),document.getElementById("labelDisabledMessage"),e)}else this._info.showSingleSuggestionPermission?t.ShowSingleSuggestion(document.getElementById("ulRenameFileDisabled"),document.getElementById("labelDisabledMessage"),CommonUIStrings.l_RenameFileRenameDisabledPermissionFull):this.HideUnusedListElements()},t.prototype.HideUnusedListElements=function(){this._info.showMultipleSuggestionsHideSignInText&&(document.getElementById("liRenameFileRenameDisabledSignIn").style.display="none"),this._info.showMultipleSuggestionsHidePermissionText&&(document.getElementById("liRenameFileRenameDisabledPermission").style.display="none"),this._info.showMultipleSuggestionsHideCoauthText&&(document.getElementById("liRenameFileRenameDisabledCoauth").style.display="none")},t.ShowSingleSuggestion=function(e,t,n){e.style.display="none",t.innerText=n},t.Id="RenameDisabledDialog",t.RenameRowId="RenameRow",t}(_.o);(0,r.l)(y,"e2b21221$RenameDisabledDialog",_.o,[]);var v=(0,r.y)("9de72ab4$IRenameUIHandler"),S=n(2575),I=n(2192),C=n(6378),T=function(){function e(e,t){this._actionManager=null,this._docProperties=null,this._maxTitleChars=0,this._actionManager=e,this._docProperties=t}return e.prototype.initialize=function(e,t,n){return!(!this._actionManager||!this._docProperties)&&(this._maxTitleChars=e,this.registerActions(),!0)},e.prototype.registerActions=function(){this._actionManager.addAction(g.b.commitNewDocumentTitle,I.m.frame,r.i(this,this.CommitNewDocumentTitle,"CommitNewDocumentTitle"))},e.prototype.CommitNewDocumentTitle=function(e,t,n,r,i){if(1===n)return this._actionManager.processAction(g.b.renameFile,1,null);var o=C.l.getFileNameWithoutExtension(this._docProperties.get_breadcrumbDocName()),a=i.newDocumentTitle;return a.length>this._maxTitleChars&&(a=a.substr(0,this._maxTitleChars)),32!==this._actionManager.processActionWithData(g.b.renameFile,2,a,null)?(this.updateTitle(o),8):(this.updateTitle(a),32)},e.prototype.updateTitle=function(e){appChrome.api.dispatch(appChrome.actions.updateDocumentTitle(e))},e.getInstanceWithResolvedDependencies=function(){return new e(S.AFrameworkApplication.get_theActionManager(),S.AFrameworkApplication.docPropertiesProvider)},e}();(0,r.l)(T,"27f59bc$ReactRenameUIHandler",null,[v]);var b=n(6935),A=n(7920),M=n(3710),P=n(8468),F=n(1135),w=n(5362),R=n(5379),E=n(5989),k=n(6382),D=n(6020),O=n(3667),U=function(){function e(e,t,n,r,i,o,a,s,l,u,c,d){this._initialized=!1,this._actionManager=null,this._basicInputManager=null,this._keyInputManager=null,this._pointerInputManager=null,this._headerEventSource=null,this._docProperties=null,this._scaleAppHeader=null,this._selectTitleElementText=null,this._clearTitleElementText=null,this._element=null,this._maxTitleChars=0,this._isNonStandardsCompliantIE=!1,this._isIPad=!1,this._isFirefox=!1,this._ignoreNextBlurEvent=!1,this._selectionPending=!1,this._actionManager=e,this._basicInputManager=t,this._keyInputManager=n,this._pointerInputManager=r,this._docProperties=i,this._scaleAppHeader=o,this._selectTitleElementText=a,this._clearTitleElementText=s,this._headerEventSource=l,this._isNonStandardsCompliantIE=u,this._isIPad=c,this._isFirefox=d}return e.prototype.get_IsActive=function(){return"true"===this._element.getAttribute("contentEditable")},e.prototype.initialize=function(e,t,n){return!(!(this._actionManager&&this._docProperties&&this._scaleAppHeader&&this._selectTitleElementText&&this._clearTitleElementText&&t)||e<=0)&&(this._element=t,this._element.title=n,this._element.setAttribute(D.t.ariaRoleAttribute,D.t.ariaButtonRole),this._element.setAttribute("Unselectable","on"),this._maxTitleChars=e,this.RegisterHandlers(),this._initialized=!0,!0)},e.prototype.RegisterHandlers=function(){this._basicInputManager&&(this._basicInputManager.registerHandler(F.d.blur,this._element,r.i(this,this.OnBlur,"OnBlur")),this._basicInputManager.registerHandler(F.d.paste,this._element,r.i(this,this.OnPaste,"OnPaste"))),this._keyInputManager.registerHandler(F.d.keyDown,this._element,r.i(this,this.OnKeyDown,"OnKeyDown")),this._pointerInputManager.registerHandler(F.d.pointerDown,this._element,r.i(this,this.OnPointerDown,"OnPointerDown")),this._pointerInputManager.registerHandler(F.d.pointerUp,this._element,r.i(this,this.OnPointerUp,"OnPointerUp"))},e.prototype.OnBlur=function(e){return this.get_IsActive()&&!this._ignoreNextBlurEvent&&(this._isNonStandardsCompliantIE||this._clearTitleElementText(this._element),this.CommitNewTitle(),this.DeactivateTextbox(!1)),this._ignoreNextBlurEvent=!1,!1},e.prototype.OnPaste=function(e){return p.ULS.sendTraceTag(4281482,203,15,"Attempting to paste into the document title"),!0},e.prototype.OnKeyDown=function(e){return this.get_IsActive()?this.OnKeyDownWhenActive(e):this.OnKeyDownWhenInactive(e)},e.prototype.OnKeyDownWhenActive=function(e){var t=!1;switch(e.innerEvent.keyCode){case Sys.UI.Key.enter:this.CommitNewTitle(),this.DeactivateTextbox(this._isIPad||this._isFirefox),t=!0;break;case Sys.UI.Key.tab:this._isNonStandardsCompliantIE&&this._clearTitleElementText(this._element);break;case Sys.UI.Key.esc:this.RestoreKnownTitle(),this.DeactivateTextbox(this._isIPad||this._isFirefox),t=!0}return t},e.prototype.OnKeyDownWhenInactive=function(e){var t=!1;switch(e.innerEvent.keyCode){case Sys.UI.Key.enter:case Sys.UI.Key.space:this.TryActivateTextbox(this._isFirefox),this.get_IsActive()&&this._selectTitleElementText(this._element),t=!0}return t},e.prototype.OnPointerDown=function(e){return this.get_IsActive()||(this.TryActivateTextbox(!1),this.get_IsActive()&&(this._element.focus(),this._selectTitleElementText(this._element),this._selectionPending=!0)),!1},e.prototype.OnPointerUp=function(e){return!!this._selectionPending&&(this._selectTitleElementText(this._element),this._selectionPending=!1,!0)},e.prototype.IsRenameEnabled=function(){return 32===this._actionManager.processAction(g.b.renameFile,1,null)},e.prototype.CommitNewTitle=function(){var e=C.l.getFileNameWithoutExtension(this._docProperties.get_breadcrumbDocName()),t=this._element.innerText.trim();(t.length>this._maxTitleChars&&(t=t.substr(0,this._maxTitleChars)),t!==e&&""!==t)?32!==this._actionManager.processActionWithData(g.b.renameFile,2,t,null)?this.RestoreKnownTitle():this.updateTitle(t):this.RestoreKnownTitle()},e.prototype.RestoreKnownTitle=function(){this.updateTitle(C.l.getFileNameWithoutExtension(this._docProperties.get_breadcrumbDocName()))},e.prototype.updateTitle=function(e){this._initialized&&(this._element.innerText=e,this._scaleAppHeader())},e.prototype.TryActivateTextbox=function(e){this.IsRenameEnabled()?this.get_IsActive()||(e&&(this._ignoreNextBlurEvent=!0,this._element.blur()),this._element.setAttribute("contentEditable","true"),this._element.removeAttribute("Unselectable"),this._element.setAttribute(D.t.ariaRoleAttribute,D.t.ariaTextboxAttribute),this._element.style.width="auto",Sys.UI.DomElement.addCssClass(this._element,b.CuiHelper.editableBreadcrumbItemClass),this._headerEventSource&&this._headerEventSource.execute((function(e){e.raiseRenameTextboxStatusChangedEvent(!0)})),e&&this._element.focus(),p.ULS.sendTraceTag(9234188,203,50,"Rename document from header.")):this._actionManager.processAction(g.b.showRenameDisabledDialog,2,null)},e.prototype.DeactivateTextbox=function(e){this._element.removeAttribute("contentEditable"),this._element.setAttribute("Unselectable","on"),this._element.setAttribute(D.t.ariaRoleAttribute,D.t.ariaButtonRole),Sys.UI.DomElement.removeCssClass(this._element,b.CuiHelper.editableBreadcrumbItemClass),this._headerEventSource&&this._headerEventSource.execute((function(e){e.raiseRenameTextboxStatusChangedEvent(!1)})),e&&(this._element.blur(),this._element.focus())},e.ScaleHeader=function(){M.k.scaleHeader(S.AFrameworkApplication.get_isRtl())},e.getInstanceWithResolvedDependencies=function(){return new e(S.AFrameworkApplication.get_theActionManager(),P.z.get_instance(),w.KeyInputManager.get_instance(),R.z.get_instance(),S.AFrameworkApplication.docPropertiesProvider,e.ScaleHeader,E.g.selectAllTextInElement,E.g.clearSelectionInElement,k.w.get_instance().resolveFuture(A.p),O.y.get_isNonStandardsCompliantIE(),O.y.get_isIPad(),O.y.get_isFirefox())},e}();(0,r.l)(U,"dcceb1dd$RenameUIHandler",null,[v]);var x=function(){function e(){}return e.get_instance=function(){return S.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactSharedHeaderUxEnabled()?e._instance||(e._instance=T.getInstanceWithResolvedDependencies()):e._instance||(e._instance=U.getInstanceWithResolvedDependencies())},e._instance=null,e}();(0,r.l)(x,"6d143569$RenameUIHandlerFactory",null,[]);var L=function(){return function(){this.currentDocumentDAVUrl=null,this.newDocumentDAVUrl=null,this.newFileName=null}}();(0,r.l)(L,"368dedcc$RenameMruEntryProperties",null,[]);var N,B=n(8530),H=n(1638),$=n(275);!function(e){e[e.unknown=-1]="unknown",e[e.success=0]="success",e[e.renameInvalidFileName=1]="renameInvalidFileName",e[e.renameInCoauthNotSupported=2]="renameInCoauthNotSupported",e[e.renameNotSupportedInViewMode=3]="renameNotSupportedInViewMode",e[e.permissionDenied=4]="permissionDenied",e[e.serverCommunicationFailure=5]="serverCommunicationFailure",e[e.fileNameTooLong=6]="fileNameTooLong"}(N||(N={})),(0,r.h)("79720171$CommonOperationResult",N);var G=function(){function e(e,t,n,r,i,o,a,s,l,u){this._actionManager=null,this._coauthManager=null,this._docPropertiesProvider=null,this._limitedEdit=!1,this._userCanRename=null,this._userCanRenameInCoauthSessionsWithRenameCapableUsers=!1,this._isRenameSupported=null,this._updateTitle=null,this._renamedFileChecker=null,this._isReadOnlyRecommended=null,this._isRenameSupported=e,this._actionManager=t,this._coauthManager=n,this._docPropertiesProvider=r,this._limitedEdit=i,this._userCanRename=o,this._userCanRenameInCoauthSessionsWithRenameCapableUsers=a,this._updateTitle=s,this._renamedFileChecker=l,this._isReadOnlyRecommended=u}return e.prototype.registerActions=function(){S.AFrameworkApplication.get_activeFrame()&&S.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactSharedHeaderUxEnabled()||this.get_ActionManager().addAction(g.b.initializeRenameUIHandler,I.m.frame,r.i(this,this.InitializeRenameUIHandler,"InitializeRenameUIHandler")),this.get_ActionManager().addAction(g.b.showRenameDisabledDialog,I.m.frame,r.i(this,this.ShowRenameDisabledDialog,"ShowRenameDisabledDialog")),this.get_ActionManager().addAction(g.b.renameFile,I.m.frame,r.i(this,this.RenameFile,"RenameFile")),this.get_ActionManager().addAction(g.b.fileNameUpdate,I.m.frame,r.i(this,this.RefreshFilename,"RefreshFilename"))},e.prototype.isRenameEnabled=function(){return this._isRenameSupported()&&this._userCanRename()?this.get_CoauthManager()?this.UserCanRenameInCurrentSession()?this._isReadOnlyRecommended()?8:32:8:32:8},e.prototype.UserCanRenameInCurrentSession=function(){return!this.get_CoauthManager()||(this._userCanRenameInCoauthSessionsWithRenameCapableUsers?this.get_CoauthManager().get_doesEveryCoauthorInSessionSupportFileRename():this.get_CoauthManager().get_getAmIAlone())},e.prototype.InitializeRenameUIHandler=function(e,t,n,r,i){return x.get_instance().initialize(S.AFrameworkApplication.fileNameMaxLength,S.AFrameworkApplication.documentTitleInputElement,S.AFrameworkApplication.renameFileTooltip||CommonUIStrings.l_RenameFileTooltip)?32:8},e.prototype.ShowRenameDisabledDialog=function(e,t,n,r,i){var o=this.UserCanRenameInCurrentSession(),a=this._userCanRename();return p.ULS.sendTraceTag(4059649,203,50,"ShowRenameDisabledDialog: userIsAnonymous = {0}, userCanRename = {1}, userCanRenameInCurrentSession = {2}, userCanRenameInCoauthSessionsWithRenameCapableUsers = {3}",this._limitedEdit,a,o,this._userCanRenameInCoauthSessionsWithRenameCapableUsers),new y(this._limitedEdit,!a,!o,this._userCanRenameInCoauthSessionsWithRenameCapableUsers,this._isReadOnlyRecommended()),32},e.prototype.RenameFile=function(e,t,n,i,o){return 1===n?this.isRenameEnabled():S.AFrameworkApplication.executeRenameFile?8===this.isRenameEnabled()?(this.get_ActionManager().processAction(g.b.showRenameDisabledDialog,2,null),8):(p.ULS.sendTraceTag(38114562,203,50,"RenameFileAttempt"),S.AFrameworkApplication.executeRenameFile(o,r.i(this,this.OnRenameFileSuccess,"OnRenameFileSuccess"),r.i(this,this.OnRenameFileFailure,"OnRenameFileFailure")),32):8},e.prototype.OnRenameFileSuccess=function(e,t){e?e.OperationResult?this.HandleFailedOperationResult(e.OperationResult):(this.SendMessageToHostAfterRename(t,e.NewName),this.UpdateAppAfterRename(e,r.i(S.AFrameworkApplication.get_activeFrame().get_applicationInstance(),S.AFrameworkApplication.get_activeFrame().get_applicationInstance().updateOpenInClientDocumentUrl,"updateOpenInClientDocumentUrl")),S.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocumentNameInJewelInfoMenuIsEnabled")&&S.AFrameworkApplication.get_activeFrame().updateCommandUI(!1),this._renamedFileChecker.updateAfterRename()):this.HandleFailedOperationResult(5)},e.prototype.SendMessageToHostAfterRename=function(e,t){var n={};n[H.t.fileRename_NewName]=t,e.sendMessage($.a.fileRename,n,"")},e.prototype.UpdateAppAfterRename=function(e,t){this.UpdateBreadcrumbDocName(e.NewName),S.AFrameworkApplication.directInvokeDAVUrl=e.DirectInvokeDavUrl;var n=t(e.EditDocInClientUrl),r=new L;r.newFileName=this._docPropertiesProvider.get_breadcrumbDocName(),r.currentDocumentDAVUrl=n,r.newDocumentDAVUrl=e.EditDocInClientUrl,this.get_ActionManager().processActionWithData(g.b.renameMostRecentlyUsedFileEntry,2,r,null)},e.prototype.HandleFailedOperationResult=function(e){switch(e){case 1:var t=new B.StandardDialog;t.set_buttonsOption(0),t.showWarning(CommonUIStrings.l_RenameFileInvalidNameTitle,CommonUIStrings.l_RenameFileInvalidName,null),this.RestoreCurrentTitle()}},e.prototype.UpdateBreadcrumbDocName=function(t){this._docPropertiesProvider.set_breadcrumbDocName(e.AppendCurrentExtensionToNewFileName(this._docPropertiesProvider.get_breadcrumbDocName(),t)),this._updateTitle(t)},e.prototype.OnRenameFileFailure=function(e){var t=new B.StandardDialog;switch(t.set_buttonsOption(0),e){case 1:p.ULS.sendTraceTag(38114563,203,50,"OnRenameFileFailure: InvalidFileName"),t.showInformation(CommonUIStrings.l_RenameFileInvalidNameTitle,CommonUIStrings.l_RenameFileInvalidName,null);break;case 6:p.ULS.sendTraceTag(38114564,203,50,"OnRenameFileFailure: FileNameTooLong"),t.showInformation(CommonUIStrings.l_RenameFileInvalidNameTitle,CommonUIStrings.l_RenameFileNameTooLong,null);break;default:p.ULS.sendTraceTag(38114565,203,15,"OnRenameFileFailure: {0}",{Result:e}),t.showInformation(CommonUIStrings.l_RenameFileGenericErrorTitle,CommonUIStrings.l_RenameFileGenericError,null)}S.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(t){t.sendMessage($.a.fileRenameFailed,{FailureMessage:N[e]},"")})),this.RestoreCurrentTitle()},e.prototype.RefreshFilename=function(e,t,n,i,o){return 1===n?this.isRenameEnabled():S.AFrameworkApplication.executeRefreshFilename?(S.AFrameworkApplication.executeRefreshFilename(r.i(this,this.OnRefreshFilenameSuccess,"OnRefreshFilenameSuccess"),r.i(this,this.OnRefreshFilenameFailure,"OnRefreshFilenameFailure"),!1),32):8},e.prototype.OnRefreshFilenameSuccess=function(e,t){e?e.NewName!==C.l.getFileNameWithoutExtension(this._docPropertiesProvider.get_breadcrumbDocName())&&this.OnRenameFileSuccess(e,t):this.OnRefreshFilenameFailure(5)},e.prototype.OnRefreshFilenameFailure=function(e){},e.prototype.RestoreCurrentTitle=function(){this._updateTitle(C.l.getFileNameWithoutExtension(this._docPropertiesProvider.get_breadcrumbDocName()))},e.prototype.get_ActionManager=function(){return this._actionManager.get_value()},e.prototype.get_CoauthManager=function(){return this._coauthManager.get_value()},e.get_instance=function(){return e._instance||(e._instance=e.GetAnInstanceWithResolvedDependecies())},e.GetAnInstanceWithResolvedDependecies=function(){return new e(S.AFrameworkApplication.isRenameSupported,new d.q(u.v,(function(){return S.AFrameworkApplication.get_theActionManager()})),new d.q(c.w,(function(){return S.AFrameworkApplication.coauthManager})),S.AFrameworkApplication.docPropertiesProvider,S.AFrameworkApplication.limitedEdit,(function(){return S.AFrameworkApplication.userCanRename}),S.AFrameworkApplication.renameInCoauthSessionWithRenameCapableClientsIsEnabled,r.i(x.get_instance(),x.get_instance().updateTitle,"updateTitle"),k.w.get_instance().resolve(a),(function(){return S.AFrameworkApplication.isReadOnlyRecommended}))},e.AppendCurrentExtensionToNewFileName=function(e,t){return t+C.l.getFileExtension(e)},e._instance=null,e}();(0,r.l)(G,"fbbfdf12$RenameActor",null,[]);var W=n(2462),V=n(3468),j=n(605),q=function(){function e(e,t){this._actionManager=null,this._dialogFactory=null,this._actionManager=e,this._dialogFactory=t}return e.prototype.registerActions=function(){this._actionManager.addAction(g.b.showRenameDialog,I.m.frame,r.i(this,this.ShowRenameDialogAction,"ShowRenameDialogAction"))},e.prototype.ShowRenameDialogAction=function(e,t,n,r,i){var o=32;2===n&&(32!==this._actionManager.processAction(g.b.renameFile,1,null)?(this._actionManager.processAction(g.b.showRenameDisabledDialog,2,null),W.y.get_instance().recordEvent(V.f.failedProcessingStep,{Reason:j.i.renameDisabled}),o=8):this._dialogFactory.get_value().create().showAndFocus());return o},e}();(0,r.l)(q,"8249e3ba$RenameDialogActor",null,[i]);var z=(0,r.y)("bd1d31b8$IRenameDialog"),K=function(){function e(){}return e.get_dialogHtml=function(){return _.o.formatHtml(e.DialogHtmlFormat,CommonUIStrings.l_RenameDialogLabel)},e.DialogHtmlFormat="<div class='WACDialogRow' id='DocumentNameBlock'> <label id='lblDocumentName' class='WACDialogLabel' for='txtDocumentName' >{0}</label> <input type='text' id='txtDocumentName' class='WACDialogInput' autocomplete=\"off\"/> </div>",e}();(0,r.l)(K,"74db1ce8$RenameDialogHtml",null,[]);var Q=function(e){function t(n,r,i){var o=this;return o._actionManager=null,o._docPropertiesProvider=null,o._fileNameMaxLength=0,(o=e.call(this)||this)._actionManager=n,o._docPropertiesProvider=r,o._fileNameMaxLength=i,o.set_dialogId(t._dialogId),o.set_dialogHtml(K.get_dialogHtml()),o}return(0,h.t)(t,e),t.prototype.showAndFocus=function(){var e={txtDocumentName:C.l.getFileNameWithoutExtension(this._docPropertiesProvider.get_breadcrumbDocName())};this.initializeAndShow(CommonUIStrings.l_RenameDialogTitle,r.i(this,this.RenameDialogHandler,"RenameDialogHandler"),e);var n=document.getElementById(t.DocumentNameControlId);this._fileNameMaxLength>0&&(n.maxLength=this._fileNameMaxLength),n.focus()},t.prototype.RenameDialogHandler=function(e,n){if(1===e){var r=C.l.getFileNameWithoutExtension(this._docPropertiesProvider.get_breadcrumbDocName()),i=(n[t.DocumentNameControlId]||"").trim();if(i!==r&&""!==i)return void this._actionManager.processActionWithData(g.b.renameFile,2,i,null)}W.y.get_instance().recordEvent(V.f.doNothingResult,{Reason:j.i.fileNameUnchanged})},t.DocumentNameControlId="txtDocumentName",t._dialogId="RenameDialog",t}(_.o);(0,r.l)(Q,"147b5751$RenameDialog",_.o,[z]);var Z=function(){function e(e){this._actionManager=null,this._docProperties=null,this._fileNameMaxLength=0,this._initialized=!1,this._actionManager=e,this._initialized=!1}return e.prototype.Initialize=function(e,t){this._docProperties=e,this._fileNameMaxLength=t,this._initialized=!0},e.prototype.create=function(){return this._initialized?new Q(this._actionManager,this._docProperties,this._fileNameMaxLength):null},e}();(0,r.l)(Z,"4e9103a5$RenameDialogFactory",null,[o]);var J=n(1822),X=n(6720),Y=n(7847),ee=n(2879),te=function(){function e(e,t,n,r,i,o,a){this._lastSeenTimeForFileNames=null,this._maxCachedAgeInMs=null,this._pingIntervalInMsGetter=null,this._currentFileNameInBrowserGetter=null,this._currentTimeGetter=null,this._coauthManagerGetter=null,this._actionManager=null,this._taskManager=null,this._isEnabled=!1,this._lastSeenTimeForFileNames=new Y.w(Date),this._currentFileNameInBrowserGetter=n,this._maxCachedAgeInMs=e,this._pingIntervalInMsGetter=t,this._currentTimeGetter=r,this._actionManager=o,this._coauthManagerGetter=i,this._taskManager=a}return e.prototype.enable=function(){if(!this._isEnabled){this.updateAfterRename();var e=new ee.c(3,2,this._pingIntervalInMsGetter(),r.i(this,this.getCurrentFileNameNoCheckFile,"getCurrentFileNameNoCheckFile"),89,null,!1);this._taskManager.addTask(e),this._isEnabled=!0}},e.prototype.getCurrentFileNameNoCheckFile=function(e){var t=this._coauthManagerGetter();if(t){if(t.get_isKickedOut()||!t.get_isFileCoauthorable()||!S.AFrameworkApplication.executeRefreshFilename)return this._taskManager.deleteTask(e),void(this._isEnabled=!1);this.cleanOldFilenames(),S.AFrameworkApplication.executeRefreshFilename(r.i(this,this.onRefreshFilenameSuccess,"onRefreshFilenameSuccess"),r.i(this,this.OnRefreshFilenameFailure,"OnRefreshFilenameFailure"),!0)}},e.prototype.cleanOldFilenames=function(){for(var e=this._currentTimeGetter(),t=this._maxCachedAgeInMs(),n=new X.c(String),r=this._lastSeenTimeForFileNames.getEnumerator();r.$$mn();){var i=r.$$cu();+e-+i.get_value()>t&&n.add(i.get_key())}for(var o=n.$$lge();o.$$mn();){var a=o.$$cu();this._lastSeenTimeForFileNames.remove(a)}},e.prototype.onRefreshFilenameSuccess=function(e,t){if(e){var n,r=e.NewName!==this._currentFileNameInBrowserGetter(),i=this._lastSeenTimeForFileNames.tryGetValue(e.NewName,(0,J.m)((function(){return n}),(function(e){return n=e})));r&&!i&&(this._actionManager.processAction(g.b.fileNameUpdate,2,null),p.ULS.sendTraceTag(37860891,203,50,"RenamedFileChecker forced FileNameUpdate")),r||this._lastSeenTimeForFileNames.set_item(e.NewName,this._currentTimeGetter())}else this.OnRefreshFilenameFailure(5)},e.prototype.updateAfterRename=function(){var e=this._currentFileNameInBrowserGetter();this._lastSeenTimeForFileNames.set_item(e,new Date)},e.prototype.OnRefreshFilenameFailure=function(e){},e}();(0,r.l)(te,"e3b7e0aa$RenamedFileChecker",null,[a]);var ne=function(){function e(){this._container=null,this._appSettingsManager=null}return e.prototype.get_name=function(){return"Common.App.RenameFile"},e.prototype.configure=function(e){var t=this;this._container=e,this._appSettingsManager=S.AFrameworkApplication.appSettingsManager,this._container.register(q).as(i).usingFactory((function(){return new q(S.AFrameworkApplication.get_theActionManager(),t._container.resolveLazy(o))})).singleInstance(),this._container.register(Z).as(o).usingFactory((function(){return new Z(S.AFrameworkApplication.get_theActionManager())})).singleInstance(),this._container.register(te).as(a).usingFactory((function(){return new te((function(){return t._appSettingsManager.getIntAppSetting("RenamedFileCheckerMaxCachedAgeInMs",36e4)}),(function(){return t._appSettingsManager.getIntAppSetting("RenamedFileCheckerPingIntervalInMs",12e4)}),(function(){return C.l.getFileNameWithoutExtension(S.AFrameworkApplication.docPropertiesProvider.get_breadcrumbDocName())}),(function(){return new Date}),(function(){return S.AFrameworkApplication.coauthManager}),S.AFrameworkApplication.get_theActionManager(),S.AFrameworkApplication.get_theTaskManager())})).singleInstance()},e.prototype.init=function(){this._appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(r.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){var e=S.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactSharedHeaderUxEnabled();S.AFrameworkApplication.isRenameSupported()&&x.get_instance().initialize(S.AFrameworkApplication.fileNameMaxLength,e?null:S.AFrameworkApplication.documentTitleInputElement,e?null:S.AFrameworkApplication.renameFileTooltip||CommonUIStrings.l_RenameFileTooltip)&&(G.get_instance().registerActions(),this._appSettingsManager.getBooleanAppSetting("RenameDialogIsEnabled")&&(this._container.resolve(Z).Initialize(S.AFrameworkApplication.docPropertiesProvider,S.AFrameworkApplication.fileNameMaxLength),this._container.resolve(i).registerActions()),S.AFrameworkApplication.renameInCoauthSessionWithRenameCapableClientsIsEnabled&&this._container.resolve(a).enable())},e.prototype.dispose=function(){},e}();(0,r.l)(ne,"4bbb1e60$PackageManager",null,[s.u,l.s]);var re=n(1526);n.d(t,{Program:function(){return ie}});var ie=function(){function e(){}return e.main=function(){re.o.get_instance().registerPackage(new ne,7,!1)},e}();(0,r.l)(ie,"b32e20bd$Program",null,[])},1546:function(e,t,n){"use strict";n.d(t,{i:function(){return r}});var r=(0,n(423).y)("4106105d$IPresenceCp")},1737:function(e,t,n){"use strict";n.r(t),n.d(t,{FuzzyMatchTokenStringGenerator:function(){return s}});var r=n(3545),i=n(1822),o=n(2039),a=n(423),s=function(e){function t(t){var n=e.call(this,t)||this;return n.m_init=null,n.m_init=t,n}return(0,r.t)(t,e),t.prototype.apply=function(e,t,n,r,o,a,s){null==a.val&&(a.val=e.getTokenSurfaceString(o,t));var l=this.m_init.errorTolerantTrie.lookUp(a.val);if(this.m_init.onlyIfUnrecognized)for(var u=0,c=l;u<c.length;u++){if(!(f=c[u]).get_editDistance()&&f.get_firstStringMatchedExactly())return}for(var d=0,p=0,g=l;p<g.length;p++){if((f=g[p]).get_editDistance()&&!this.Apply_ProcessErrorTolerantTrieMatch(f,!0,n,r,(0,i.m)((function(){return d}),(function(e){return d=e}))))return}if(this.m_init.includeAllCompletions)for(var h=0,_=l;h<_.length;h++){var f=_[h];if(!this.Apply_ProcessErrorTolerantTrieMatch(f,!1,n,r,(0,i.m)((function(){return d}),(function(e){return d=e}))))return}},t.prototype.Apply_ProcessErrorTolerantTrieMatch=function(e,t,n,r,i){var a,s;t?(a=0,s=e.get_firstStringMatchedExactly()?1:0):(a=e.get_firstStringMatchedExactly()?1:0,s=e.count-a);for(var l=0;l<s;++l)if(o.z.AddTokenPropertyStringByID(e.get_firstTrieId()+a+l,this.m_init.score,n,r),++i.val,this.m_init.maxStringsToGenerate>0&&i.val>=this.m_init.maxStringsToGenerate)return!1;return!0},t.c_CompiledTypeId=2,t}(o.z);(0,a.l)(s,"c9dc100d$FuzzyMatchTokenStringGenerator",o.z,[])},1759:function(e,t,n){"use strict";n.r(t);var r=n(3323),i=n(1443),o=n(363),a=n(8192),s=n(9795),l=n(773),u=n(6720),c=n(423),d=(0,c.y)("b56ae237$IGestureAdapter"),p=n(5214),g=n(7597),h=function(){return function(){this.x=0,this.y=0}}();(0,c.l)(h,"973d6dc$HammerPoint",null,[]);var _=function(){function e(e,t,n){this._initialPinchScale=1,this._initialDocumentScale=1,this._lastRelativeScale=1,this._unscaledAbsolutePinchStartX=0,this._unscaledAbsolutePinchStartY=0,this._containerBounds=null,this._nextUiUpdateTime=null,this._futureZoomManager=null,this._scrollContainer=null,this._scrollable=null,this._futureZoomManager=e,this._scrollContainer=t,this._scrollable=n}return e.prototype.get_scrollContainer=function(){return this._scrollContainer},e.prototype.get_scrollable=function(){return this._scrollable},e.prototype.isGesturePossible=function(e){return!!this._futureZoomManager.get_instance()},e.prototype.onGestureStart=function(e){if(this._initialDocumentScale=this.getZoomManager().get_currentZoom(),this._initialPinchScale=e.get_gestureData().scale,this._lastRelativeScale=1,this._nextUiUpdateTime=this.CalculateNextUiControlUpdateTime(),this._containerBounds=this._scrollContainer.getBounds(),!this._containerBounds)return g.ULS.sendTraceTag(42821145,353,15,"Unexpected null bounds"),!1;var t=this.GetPinchCenterRelativeToContainer(e);return this._unscaledAbsolutePinchStartX=this._scrollContainer.get_scrollWidth()>this._containerBounds.width?this.CalculateAbsolutePinchStartPos(this._scrollable.get_scrollLeft(),t.x,this._initialDocumentScale):null,this._unscaledAbsolutePinchStartY=this._scrollContainer.get_scrollHeight()>this._containerBounds.height?this.CalculateAbsolutePinchStartPos(this._scrollable.get_scrollTop(),t.y,this._initialDocumentScale):null,!0},e.prototype.onGestureEvent=function(e){var t=this.GetPinchCenterRelativeToContainer(e);if(!t)return g.ULS.sendTraceTag(42821147,353,15,"Unexpected null pinch center"),!1;var n=this.SetFilteredRelativeScale(e.get_gestureData().scale/this._initialPinchScale)*this._initialDocumentScale;return this.UpdateScrollLeft(t,n),this.UpdateScrollTop(t,n),!0},e.prototype.UpdateScrollLeft=function(e,t){var n=this._scrollContainer.get_scrollWidth(),r=this._containerBounds.width;!this._unscaledAbsolutePinchStartX&&n>r&&(this._unscaledAbsolutePinchStartX=this.CalculateAbsolutePinchStartPos(this._scrollable.get_scrollLeft(),e.x,t));var i=this.CalculateScrollPosition(e.x,this._unscaledAbsolutePinchStartX,n,r,t);i&&this._scrollable.set_scrollLeft(i)},e.prototype.UpdateScrollTop=function(e,t){var n=this._scrollContainer.get_scrollHeight(),r=this._containerBounds.height;!this._unscaledAbsolutePinchStartY&&n>r&&(this._unscaledAbsolutePinchStartY=this.CalculateAbsolutePinchStartPos(this._scrollable.get_scrollTop(),e.y,t));var i=this.CalculateScrollPosition(e.y,this._unscaledAbsolutePinchStartY,n,r,t);i&&this._scrollable.set_scrollTop(i)},e.prototype.CalculateScrollPosition=function(e,t,n,r,i){if(n<=r||!t||!r)return null;var o=t*i-r*(e/r),a=n-r;return Math.max(0,Math.min(o,a))},e.prototype.CalculateAbsolutePinchStartPos=function(e,t,n){return(e+t)/n},e.prototype.onGestureEnd=function(e){this.FinalizeRelativeScale(e.get_gestureData().scale,!1)},e.prototype.onGestureCancel=function(e){this.FinalizeRelativeScale(e.get_gestureData().scale,!0)},e.prototype.getZoomManager=function(){return this._futureZoomManager.get_instance()},e.prototype.SetFilteredRelativeScale=function(t){var n=this.getZoomManager(),r=new Date>=this._nextUiUpdateTime;return r&&(this._nextUiUpdateTime=this.CalculateNextUiControlUpdateTime()),Math.abs(t-this._lastRelativeScale)>=t*e._minUpdateRatio&&n.setZoomDuringResize(t*this._initialDocumentScale,r),n.get_currentZoom()/this._initialDocumentScale},e.prototype.FinalizeRelativeScale=function(e,t){var n=e*this._initialDocumentScale;this.getZoomManager().setZoom(n);var r={};r.initialScale=this._initialDocumentScale,r.finalScale=n,r.cancelled=t,g.ULS.sendTraceTag(42821150,353,50,"Pinch zoom ended: {0}",r)},e.prototype.GetPinchCenterRelativeToContainer=function(e){var t=e.get_gestureData().center;return t?(0,p.m)(new h,{x:t.x-this._containerBounds.x,y:t.y-this._containerBounds.y}):null},e.prototype.CalculateNextUiControlUpdateTime=function(){var t=(new Date).getTime();return new Date(t+e._timeBetweenUiControlUpdatesMs)},e._minUpdateRatio=.01,e._timeBetweenUiControlUpdatesMs=1e3,e}();(0,c.l)(_,"141c2a94$PinchZoomAdapter",null,[d]);var f=(0,c.y)("4b8ac92b$IScrollContainer"),m=function(){function e(e){this._element=null,this._element=e}return e.prototype.get_scrollWidth=function(){return this._element.scrollWidth},e.prototype.get_scrollHeight=function(){return this._element.scrollHeight},e.prototype.getBounds=function(){return Sys.UI.DomElement.getBounds(this._element)},e}();(0,c.l)(m,"237946bc$ScrollContainerElement",null,[f]);var y=function(){function e(e,t,n){this._container=null,this._isMultiTouchGestureEnabled=!1,this._isPinchZoomEnabled=!1,this._gestureInputManager=null,this._containerElements=null,this._container=e,this._isMultiTouchGestureEnabled=t,this._isPinchZoomEnabled=n,this._containerElements=new u.c(Object)}return e.prototype.register=function(e,t){var n=this;this._isMultiTouchGestureEnabled&&this._container.resolveFuture(s.k).execute((function(r){if(n._gestureInputManager=r,n._containerElements.add(e),n._isPinchZoomEnabled){var i=n._container.resolveFuture(l.w),o=new m(e),a=new _(i,o,t);r.registerGestureAdapter(0,e,a,null,null)}}))},e.prototype.unregister=function(){if(this._gestureInputManager&&this._containerElements){if(this._isPinchZoomEnabled){for(var e=this._containerElements.$$lge();e.$$mn();){var t=e.$$cu();this._gestureInputManager.unregisterGestureAdapter(0,t)}this._containerElements.clear()}this._gestureInputManager=null}},e}();(0,c.l)(y,"c62654e6$GestureInputRegistrar",null,[r.e]);var v=n(1526);n.d(t,{GestureInputPackage:function(){return S}});var S=function(){function e(){this._container=null,this._isInitialized=!1}return e.prototype.get_name=function(){return"Common.App.GestureInput"},e.prototype.init=function(){this._isInitialized||(this._container.resolve(r.e),this._isInitialized=!0)},e.prototype.dispose=function(){},e.prototype.configure=function(e){this._container=e,e.register(r.e).singleInstance().usingFactory((function(){var t=e.resolve(i.x);return new y(e,t.getBooleanAppSetting("MultiTouchGestureIsEnabled"),t.getBooleanAppSetting("PinchZoomIsEnabled"))}))},e.main=function(){v.o.get_instance().registerPackage(new e,0,!1)},e}();(0,c.l)(S,"804acb43$GestureInputPackage",null,[o.u,a.s])},1782:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});var r=(0,n(423).y)("5181072c$ICurrentPageCalculator")},1860:function(e,t,n){"use strict";n.d(t,{m:function(){return i}});var r=n(423),i=function(){return function(e,t,n,r){this.paraIdAboveSplit=null,this.textIdAboveSplit=null,this.paraIdBelowSplit=null,this.textIdBelowSplit=null,null!=e&&(this.paraIdAboveSplit=e),null!=t&&(this.textIdAboveSplit=t),null!=n&&(this.paraIdBelowSplit=n),null!=r&&(this.textIdBelowSplit=r)}}();(0,r.l)(i,"6e2f29f9$SplitParaData",null,[])},1874:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var r=n(423),i=n(6414),o=function(){function e(t,n){this._shouldSample=null,this._frames=null,r.m(this,e.$$(t)),this._shouldSample=n}return e.prototype.aggregate=function(t,n){(n===e.$$(r.f(this,"Common.Utils.Aggregators.SampleDataAggregator$1").T).shouldForceSample||this._shouldSample())&&(this._frames||(this._frames=[]),Array.add(this._frames,t))},e.prototype.getData=function(){return this._frames},e.prototype.reset=function(){this._frames=null},e.$$=function(t){return r.o("Common.Utils.Aggregators.SampleDataAggregator$1",e,[{T:t}],null,[i.k.$$(t)],{shouldForceSample:function(){return"ForceSample"}})},e}()},2039:function(e,t,n){"use strict";var r=n(1128),i=n(3545),o=n(1822),a=n(423),s=function(){function e(){this.inputFilter=null,this.tokenFilter=null,this.maxExistingStrings=0,this.score=0,this.maxStringsToGenerate=0}return e.prototype.parseCommonFields=function(e,t,n){this.score=e.get_item(t.val),++t.val,this.inputFilter=e.get_item(t.val)?n.getFilter(e.get_item(t.val)):null,++t.val,this.tokenFilter=e.get_item(t.val)?n.getFilter(e.get_item(t.val)):null,++t.val,this.maxExistingStrings=e.get_item(t.val),++t.val,this.maxStringsToGenerate=e.get_item(t.val),++t.val},e}();(0,a.l)(s,"4b1602ae$TokenStringGeneratorInit",null,[]);var l=(0,a.y)("9ec64cca$IErrorTolerantTrieLookupEngine"),u=function(){function e(e,t,n,r,i){this.firstTrieId=0,this.count=0,this.firstStringMatchedExactly=!1,this.editDistance=0,this.depth=0,this.firstTrieId=e,this.count=t,this.firstStringMatchedExactly=n,this.editDistance=r,this.depth=i}return e.prototype.get_firstTrieId=function(){return this.firstTrieId},e.prototype.get_firstStringMatchedExactly=function(){return this.firstStringMatchedExactly},e.prototype.get_editDistance=function(){return this.editDistance},e.prototype.get_depth=function(){return this.depth},e}();(0,a.l)(u,"72b3b9c$ErrorTolerantTrieMatch",null,[]);var c=n(6039),d=n(6329),p=function(){function e(e,t,n,r){this.triescan=null,this.firstTrieID=0,this.editDistance=0,this.depth=0,this.triescan=e||new d.n,this.firstTrieID=t,this.editDistance=n,this.depth=r}return e.prototype.get_triescan=function(){return this.triescan},e.prototype.getKey=function(){return this.get_triescan().iNode.toString()+":"+this.firstTrieID.toString()},e}();(0,a.l)(p,"70202dd0$TrieBookmark",null,[]);var g=function(){function e(e,t){this.m_trie=null,this.m_maxEditDistance=0,this.m_trie=e,this.m_maxEditDistance=t}return e.prototype.lookUp=function(e){if(null==e)throw Error.argumentNull("prefix");var t={},n=t[""]=new p(null,0,0,0);this.HypothesizeDrop(n,t);for(var r=0;r<e.length;++r){var i=e.charCodeAt(r),o={};for(var a in t){var s={key:a,value:t[a]};this.AdvanceFromBookmark(i,s.value,o)}t=o}return this.TranslateFinalBookmarksToMatches(t)},e.prototype.HypothesizeDrop=function(t,n){if(!(t.editDistance>=this.m_maxEditDistance)){var r=new p(c.h.CloneTrieScan(t.get_triescan()),t.firstTrieID,t.editDistance+1,t.depth);if(r.get_triescan().wFlags&c.h.TRIE_NODE_VALID&&(r.firstTrieID=r.firstTrieID+1),this.m_trie.TrieGetNextState(r.get_triescan())){r.depth=r.depth+1;for(var i=!0;i;)e.UpdateOrAdd(r,n),this.HypothesizeDrop(r,n),r.firstTrieID=r.firstTrieID+(this.m_trie.GetCountOfStringsBelow(r.get_triescan(),!0)+(r.get_triescan().wFlags&c.h.TRIE_NODE_VALID?1:0)),i=this.m_trie.TrieGetNextNode(r.get_triescan())}}},e.prototype.AdvanceFromBookmark=function(t,n,r){if(n.editDistance+1<=this.m_maxEditDistance&&(n.editDistance=n.editDistance+1,e.UpdateOrAdd(n,r),n.editDistance=n.editDistance-1),n.get_triescan().wFlags&c.h.TRIE_NODE_VALID&&(n.firstTrieID=n.firstTrieID+1),this.m_trie.TrieGetNextState(n.get_triescan())){n.depth=n.depth+1;for(var i=!0;i;)n.get_triescan().wch===t?(e.UpdateOrAdd(n,r),this.HypothesizeDrop(n,r)):n.editDistance+1<=this.m_maxEditDistance&&(n.editDistance=n.editDistance+1,e.UpdateOrAdd(n,r),this.HypothesizeDrop(n,r),n.editDistance=n.editDistance-1),n.firstTrieID=n.firstTrieID+(this.m_trie.GetCountOfStringsBelow(n.get_triescan(),!0)+(n.get_triescan().wFlags&c.h.TRIE_NODE_VALID?1:0)),i=this.m_trie.TrieGetNextNode(n.get_triescan())}},e.prototype.TranslateFinalBookmarksToMatches=function(t){var n=[];for(var r in t){var i={key:r,value:t[r]}.value;if(i.get_triescan().iNode){var o=!!(i.get_triescan().wFlags&c.h.TRIE_NODE_VALID),a=this.m_trie.GetCountOfStringsBelow(i.get_triescan(),!1)+(o?1:0);Array.add(n,new u(i.firstTrieID,a,o,i.editDistance,i.depth))}}if(n.sort((function(e,t){var n=e.get_firstTrieId()-t.get_firstTrieId();return n||((n=-(e.count-t.count))?n:n=e.get_depth()-t.get_depth())})),n.length<2)return n;for(var s=[],l=0;l<n.length;)l+=e.TraverseMatchTree(l,n,s);return s},e.UpdateOrAdd=function(e,t){var n=e.getKey();if(n in t){var r=t[n];r.editDistance=Math.min(r.editDistance,e.editDistance)}else t[n]=new p(c.h.CloneTrieScan(e.get_triescan()),e.firstTrieID,e.editDistance,e.depth)},e.TraverseMatchTree=function(t,n,r){for(var i=n[t],o=i.get_firstTrieId(),a=o+i.count,s=1,l=i.get_firstStringMatchedExactly();t+s<n.length&&n[t+s].get_firstTrieId()<a;){var c=n[t+s];c.get_firstTrieId()>o&&(Array.add(r,new u(o,c.get_firstTrieId()-o,l,i.get_editDistance(),i.get_depth())),l=!1),s+=e.TraverseMatchTree(t+s,n,r),o=c.get_firstTrieId()+c.count}return o<a&&Array.add(r,new u(o,a-o,l,i.get_editDistance(),i.get_depth())),s},e}();(0,a.l)(g,"9a517c83$ErrorTolerantTrieLookupEngine",null,[l]);var h=function(e){function t(t,n,r){var i=e.call(this)||this;if(i.onlyIfUnrecognized=!1,i.includeAllCompletions=!1,i.errorTolerantTrie=null,!t)return i;var a=0;try{i.parseCommonFields(t,(0,o.m)((function(){return a}),(function(e){return a=e})),n),i.onlyIfUnrecognized=1===t.get_item(a),++a,i.includeAllCompletions=1===t.get_item(a),++a;var s=t.get_item(a);++a,i.errorTolerantTrie=i.ParseErrorTolerantTrie(r,s)}catch(e){throw Error.argument("initData")}return i}return(0,i.t)(t,e),t.prototype.ParseErrorTolerantTrie=function(e,t){return new g(e,t)},t}(s);(0,a.l)(h,"266f337$FuzzyMatchTokenStringGeneratorInit",s,[]);var _=function(e){function t(t,n){var r=e.call(this)||this;if(r.annotations=null,r.name=null,r.query=null,!t)return r;r.annotations=n.get_annotations();var i=0;try{r.parseCommonFields(t,(0,o.m)((function(){return i}),(function(e){return i=e})),n),r.name=n.getString(t.get_item(i)),++i,r.query=n.getAnnotationQuery(t.get_item(i)),++i}catch(e){throw Error.argument("initData")}return r}return(0,i.t)(t,e),t}(s);(0,a.l)(_,"3430b264$QueryTokenStringGeneratorInit",s,[]);var f=function(e){function t(t,n){var r=e.call(this)||this;if(!t)return r;var i=0;try{r.parseCommonFields(t,(0,o.m)((function(){return i}),(function(e){return i=e})),n)}catch(e){throw Error.argument("initData")}return r}return(0,i.t)(t,e),t}(s);(0,a.l)(f,"2c0a39ce$SurfaceStringTokenStringGeneratorInit",s,[]);var m=n(1228);n.d(t,{z:function(){return y}});var y=function(){function e(e){this.m_baseInit=null,this.m_baseInit=e}return e.prototype.get_inputFilter=function(){return this.m_baseInit.inputFilter},e.prototype.get_tokenFilter=function(){return this.m_baseInit.tokenFilter},e.prototype.get_maxExistingStrings=function(){return this.m_baseInit.maxExistingStrings},e.create=function(t,r,i){var o=0;try{if(t.get_item(o)!==e.c_MAGIC_NUMBER)throw Error.argument("initData","Input does not represent a token string generator");++o;var a=t.get_item(o);++o;var s=new m.i(Number);switch(s.fromReadOnlyList(t,o,t.get_count()-o),a){case n(2203).SurfaceStringTokenStringGenerator.c_CompiledTypeId:return new(n(2203).SurfaceStringTokenStringGenerator)(new f(s,r));case n(4614).QueryTokenStringGenerator.c_CompiledTypeId:return new(n(4614).QueryTokenStringGenerator)(new _(s,r));case n(1737).FuzzyMatchTokenStringGenerator.c_CompiledTypeId:return new(n(1737).FuzzyMatchTokenStringGenerator)(new h(s,r,i));default:throw Error.argument("initData")}}catch(e){throw Error.argument("initData")}},e.AddTokenPropertyString=function(t,n,r,i,o,a){var s=t.get_tokenStringTable().getId(n,null);s<0?++a.val:e.AddTokenPropertyStringByID(s,r,i,o)},e.AddTokenPropertyStringByID=function(e,t,n,r){Array.add(r.get_stringIDs(),e),Array.add(r.get_stringScores(),t),++r.get_tokenIndex2StringCount()[n]},e.c_MAGIC_NUMBER=1099767983,e}();(0,a.l)(y,"2b808794$TokenStringGenerator",null,[r.i])},2052:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(3698),o=n(5377),a=n(363),s=n(8192),l=n(3362),u=n(5214),c=n(1822),d=n(127),p=n(7597),g=n(9910),h=function(){return function(){}}();(0,r.l)(h,"3a469eb6$ShellRenderData",null,[]);var _=n(2575),f=n(4714),m=n(3608),y=n(8996),v=n(7167),S=n(3096),I=n(5634),C=n(6378),T=function(){function e(t,n,r){this._o365ShellJsLoaded=!1,this._o365ShellCssLoaded=!1,this._shellDataJsonStr=null,this._shellDataObject=null,this._clientRequestManager=null,this._officeAppType=0,this._webServiceBase=null,this._switcherDomElement=null,this._shellServiceInfoStringAsyncTcs=new d.z(Object),this._clientRequestManager=t,this._officeAppType=r,this._webServiceBase=n.get_appSettings()[e.WebServiceBaseSettingName]||""}return e.prototype.get_shellServiceDataAsync=function(){return this._shellServiceInfoStringAsyncTcs.get_task()},e.prototype.get_ClientRequestManager=function(){return this._clientRequestManager.get_value()},e.prototype.RequestShellServiceInfo=function(){this._switcherDomElement=document.getElementById(e.SwitcherContainerId);var t={"Content-Type":"application/json; charset=utf-8"};p.ULS.sendTraceTag(6612806,215,50,"Client is sending a request to get the code for the O365 switcher");var n=this._webServiceBase+S.n.addOrReplaceParameterValue(e.ShellServiceProxyName,e.HandlerQuerySigatureParameterName,C.l.urlKeyValueEncode(_.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),!1);n=S.n.addOrReplaceParameterValue(n,e.OfficeAppTypeParameterName,_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_officeAppType().toString(),!1),this.get_ClientRequestManager().addRequest(n,1,"",t,!0,2,r.i(this,this.OnSuccessCallback,"OnSuccessCallback"),r.i(this,this.OnFailureCallback,"OnFailureCallback"),null,null,!1,null,null,"20",null,!1,null,!1)},e.prototype.OnSuccessCallback=function(e){var t=this,n=e.get_data().responseData;if(!n||!n.length)return this.ShowFailureMessage(),void p.ULS.sendTraceTag(6362369,215,10,"Response from O365ShellServiceProxy is null.");try{var r=y.x.deserialize(n);if(_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactSharedHeaderUxEnabled()?(this._shellDataJsonStr=r.NavBarDataJson,p.ULS.sendTraceTag(41551899,215,50,"Skipping call to TryLoadResources for React Shared Header.")):this.TryLoadResources(r)&&(this._shellDataJsonStr=r.NavBarDataJson),!this._shellDataJsonStr)return p.ULS.sendTraceTag(9000737,215,15,"ShellData is null"),void this._shellServiceInfoStringAsyncTcs.setCanceled();if(!y.x.tryDeserialize(Object,r.NavBarDataJson,(0,c.m)((function(){return t._shellDataObject}),(function(e){return t._shellDataObject=e}))))return p.ULS.sendTraceTag(7660113,215,10,"Failed to deserialize : {0}",{ShellData:I.l.truncateIfNecessary(this._shellDataJsonStr)}),void this._shellServiceInfoStringAsyncTcs.setCanceled();this._shellServiceInfoStringAsyncTcs.setResult(this._shellDataObject)}catch(e){this.ShowFailureMessage(),p.ULS.sendTraceTag(6362370,215,10,"Unable to parse the response from O365ShellServiceProxy."),this._shellServiceInfoStringAsyncTcs.setCanceled()}},e.prototype.OnFailureCallback=function(e){this._switcherDomElement&&this.ShowFailureMessage(),this._shellServiceInfoStringAsyncTcs.setCanceled(),p.ULS.sendTraceTag(7608091,215,10,"Call to O365ShellServiceProxy failed.")},e.prototype.TryLoadResources=function(e){if(!e.JsUrl||!e.JsUrl.length)return this.ShowFailureMessage(),p.ULS.sendTraceTag(6387854,215,10,"Empty or null JS URL."),!1;var t=v.v.create(e.JsUrl);if(t.add_loadFinished(r.i(this,this.O365ShellJs_LoadFinished,"O365ShellJs_LoadFinished")),m.z.enqueueResourceWithoutEnabling(t),!e.CssUrl||!e.CssUrl.length)return this.ShowFailureMessage(),p.ULS.sendTraceTag(6387855,215,10,"Empty or null CSS URL."),!1;var n=new f.q(e.CssUrl);return n.add_loadFinished(r.i(this,this.O365ShellCss_LoadFinished,"O365ShellCss_LoadFinished")),m.z.enqueueResourceWithoutEnabling(n),!0},e.prototype.O365ShellCss_LoadFinished=function(e,t){t.get_succeeded()?(this._o365ShellCssLoaded=!0,this.RenderO365ShellIfReady()):(p.ULS.sendTraceTag(7608092,215,10,"CSS failed to load"),this.ShowFailureMessage())},e.prototype.O365ShellJs_LoadFinished=function(e,t){t.get_succeeded()?(this._o365ShellJsLoaded=!0,this.RenderO365ShellIfReady()):(p.ULS.sendTraceTag(7608093,215,10,"JS failed to load"),this.ShowFailureMessage())},e.prototype.RenderO365ShellIfReady=function(){if(this._o365ShellCssLoaded&&this._o365ShellJsLoaded){if(!this._switcherDomElement)return void p.ULS.shipAssertTag(7608280,215,!1,null);Sys.UI.DomElement.removeCssClass(this._switcherDomElement,e.LoadingCssClass);var t=document.createElement("div");t.id=e.ShellContainerId,this._switcherDomElement.appendChild(t),this.RenderO365ShellInternal()}},e.prototype.RenderO365ShellInternal=function(){var t=window.self.O365Shell;if(!t)return this.ShowFailureMessage(),void p.ULS.shipAssertTag(6613128,215,!1,null);if(!t.SetData)return this.ShowFailureMessage(),void p.ULS.shipAssertTag(6613129,215,!1,null);if(!this._shellDataJsonStr)return this.ShowFailureMessage(),void p.ULS.shipAssertTag(6613130,215,!1,null);if(this._shellDataObject){t.SetData(this._shellDataObject);var n=(0,u.m)(new h,{launcher:e.ShellContainerId,switcher:e.SwitcherContainerId});if(!t.RenderAsync)return this.ShowFailureMessage(),void p.ULS.shipAssertTag(6613131,215,!1,null);t.RenderAsync(n,r.i(this,this.OnSwitcherRendered,"OnSwitcherRendered"))}else this.ShowFailureMessage()},e.prototype.OnSwitcherRendered=function(){if(this._switcherDomElement){var e=this._switcherDomElement.getElementsByTagName("a");e&&e.length>0&&e[0]&&"none"!==this._switcherDomElement.style.display&&e[0].focus(),_.AFrameworkApplication.get_theActionManager().processAction(g.b.o365SwitcherReady,2,null),p.ULS.sendTraceTag(6612807,215,50,"O365 switcher tiles added to the DOM.")}else p.ULS.sendTraceTag(41551900,215,15,"Switcher DOM element is null. Cannot append shell container.")},e.prototype.ShowFailureMessage=function(){Sys.UI.DomElement.containsCssClass(this._switcherDomElement,e.ErrorCssClass)||(Sys.UI.DomElement.removeCssClass(this._switcherDomElement,e.LoadingCssClass),Sys.UI.DomElement.addCssClass(this._switcherDomElement,e.ErrorCssClass),p.ULS.sendTraceTag(7129104,215,10,"Failed to display O365 Shell Switcher."))},e.get_instance=function(){return e._instance||(e._instance=e.GetAnInstanceWithResolvedDependecies())},e.GetAnInstanceWithResolvedDependecies=function(){return new e(new l.q(o.u,(function(){return _.AFrameworkApplication.theClientRequestManager})),_.AFrameworkApplication.appSettingsManager,_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_officeAppType())},e.HandlerQuerySigatureParameterName="qs",e.OfficeAppTypeParameterName="at",e.ShellServiceProxyName="O365ShellServiceProxy.ashx",e._instance=null,e.SwitcherContainerId="sw_bar",e.LoadingCssClass="SwitcherLoading",e.ErrorCssClass="SwitcherError",e.ShellContainerId="ShellContainer",e.WebServiceBaseSettingName="ShellWebServiceBase",e}();(0,r.l)(T,"c6ea6cd2$O365ShellActor",null,[i.u]);var b=n(1526);n.d(t,{PackageManager:function(){return A}});var A=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"Common.App.O365Shell"},e.prototype.configure=function(e){this._container=e,this._container.register(T).as(i.u).singleInstance().usingFactory((function(){return new T(new l.q(o.u,(function(){return _.AFrameworkApplication.theClientRequestManager})),_.AFrameworkApplication.appSettingsManager,_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_officeAppType())}))},e.prototype.init=function(){_.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(r.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){_.AFrameworkApplication.useO365ShellService&&this._container.resolve(T).RequestShellServiceInfo()},e.prototype.dispose=function(){},e.main=function(){b.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(A,"77fafb31$PackageManager",null,[a.u,s.s])},2093:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(1326),o=n(9921),a=n(3692),s=n(4211),l=(0,r.y)("e966d9fb$IAnnotations"),u=n(1822),c=n(4427),d=n(3538),p=n(5031),g=n(2977),h=function(){function e(e,t){if(this.$$pf_IsReadOnly=!1,this.$$pf_StructTypeID=0,this.m_annotations=null,this.m_cFields=0,this.m_fieldValues=null,!e)throw Error.argumentNull("annotations");if(!e.isValidStructTypeID(t))throw Error.argument("structTypeID","Invalid struct type ID");this.m_annotations=e,this.m_cFields=this.m_annotations.getNumOfStructFields(t),this.set_structTypeID(t)}return e.prototype.get_annotationsContext=function(){return this.m_annotations},e.prototype.get_isReadOnly=function(){return this.$$pf_IsReadOnly},e.prototype.set_isReadOnly=function(e){return this.$$pf_IsReadOnly=e,e},e.prototype.get_structTypeID=function(){return this.$$pf_StructTypeID},e.prototype.set_structTypeID=function(e){return this.$$pf_StructTypeID=e,e},e.prototype.getFieldValue=function(e){if(e<0||e>=this.m_cFields)throw Error.argument("iField","Invalid field index");return this.m_fieldValues&&null!=this.m_fieldValues[e]?this.m_fieldValues[e]:this.m_annotations.getStructFieldDefaultValue(this.get_structTypeID(),e)},e.prototype.setFieldValue=function(e,t){if(this.get_isReadOnly())throw Error.invalidOperation("Attempt to set annotation on read-only StructValue");if(e<0||e>=this.m_cFields)throw Error.argument("iField","Invalid field index");if(!this.m_annotations.isLegalValue(this.m_annotations.getStructFieldType(this.get_structTypeID(),e),t))throw Error.argument("value","Value is not of the correct type for the specified field");(this.m_fieldValues||(this.m_fieldValues=new Array(this.m_cFields)))[e]=t},e.prototype.valueToString=function(){var e="[";if(this.m_fieldValues)for(var t=!0,r=0;r<this.m_cFields;++r)if(null!=this.m_fieldValues[r]){var i=this.m_annotations.getStructFieldType(this.get_structTypeID(),r);if(!n(2093).Annotations.ValuesAreEqual(i,this.m_fieldValues[r],this.m_annotations.getStructFieldDefaultValue(this.get_structTypeID(),r))){t?t=!1:e+=", ",e+=this.m_annotations.getStructFieldName(this.get_structTypeID(),r),e+="=";var o=this.m_annotations.valueToString(i,this.m_fieldValues[r]);i===n(2093).Annotations.typeiD_String?(e+='"',e+=c.d.EscapeStringForValueToString(o),e+='"'):e+=o}}return e+="]"},e.prototype.hasNonDefaultValueFor=function(e){if(e<0||e>=this.m_cFields)throw Error.argument("iField","Invalid field index");return!(!this.m_fieldValues||null==this.m_fieldValues[e])&&!n(2093).Annotations.ValuesAreEqual(this.m_annotations.getStructFieldType(this.get_structTypeID(),e),this.m_fieldValues[e],this.m_annotations.getStructFieldDefaultValue(this.get_structTypeID(),e))},e.prototype.isEqual=function(e){if(this===e)return!0;if(!e||this.m_annotations!==e.get_annotationsContext()||this.get_structTypeID()!==e.get_structTypeID())return!1;for(var t=0;t<this.m_cFields;++t)if(!n(2093).Annotations.ValuesAreEqual(this.m_annotations.getStructFieldType(this.get_structTypeID(),t),this.getFieldValue(t),e.getFieldValue(t)))return!1;return!0},e.prototype.clone=function(){var t=new e(this.m_annotations,this.get_structTypeID());return this.m_fieldValues&&(t.m_fieldValues=Array.clone(this.m_fieldValues)),t},e.prototype.cloneIfReadOnly=function(){return this.get_isReadOnly()?this.clone():this},e.prototype.lockDown=function(){if(!this.get_isReadOnly()&&(this.set_isReadOnly(!0),this.m_fieldValues))for(var e=0;e<this.m_cFields;++e){var t=this.m_fieldValues[e];null!=t&&n(2093).Annotations.LockDownIfNecessary(t)}},e.prototype.toString=function(){return this.valueToString()},e}();(0,r.l)(h,"c98f437a$StructValue",null,[a.w,s.r]),n.d(t,{Annotations:function(){return _}});var _=function(){function e(t,n){if(this.$$pf_AttributeCount=0,this.$$pf_EnumTypeCount=0,this.$$pf_StructTypeCount=0,this.m_stringTable=null,this.m_doublesArray=null,this.m_attrNames=null,this.m_attrTypes=null,this.m_attrDefaultValues=null,this.m_enumTypeNames=null,this.m_enumTypeFlavor=null,this.m_enumTypeMemberNames=null,this.m_structTypeNames=null,this.m_structTypeFieldTypes=null,this.m_structTypeFieldNames=null,this.m_structTypeFieldDefaultValues=null,!t)throw Error.argumentNull("initData");if(!n)throw Error.argumentNull("objectFetcher");this.m_doublesArray=n.get_doubleID2DoubleValue();var r=0,i=n.getByteArray(t.get_item(r));++r,this.m_stringTable=new p.c(new g.k(i)),this.set_enumTypeCount(t.get_item(r)),++r,this.m_enumTypeNames=new Array(this.get_enumTypeCount()),this.m_enumTypeFlavor=new Array(this.get_enumTypeCount()),this.m_enumTypeMemberNames=new Array(this.get_enumTypeCount());for(var o=0;o<this.get_enumTypeCount();++o){this.m_enumTypeNames[o]=n.getString(t.get_item(r)),++r,this.m_enumTypeFlavor[o]=t.get_item(r),++r;var a=t.get_item(r);++r,this.m_enumTypeMemberNames[o]=new Array(a);for(var s=0;s<a;++s)this.m_enumTypeMemberNames[o][s]=n.getString(t.get_item(r)),++r}this.set_structTypeCount(t.get_item(r)),++r,this.m_structTypeNames=new Array(this.get_structTypeCount()),this.m_structTypeFieldNames=new Array(this.get_structTypeCount()),this.m_structTypeFieldTypes=new Array(this.get_structTypeCount()),this.m_structTypeFieldDefaultValues=new Array(this.get_structTypeCount());for(var l=0;l<this.get_structTypeCount();++l){this.m_structTypeNames[l]=n.getString(t.get_item(r)),++r;var c=t.get_item(r);++r,this.m_structTypeFieldNames[l]=new Array(c),this.m_structTypeFieldTypes[l]=new Array(c),this.m_structTypeFieldDefaultValues[l]=new Array(c);for(var d=0;d<c;++d)this.m_structTypeFieldNames[l][d]=n.getString(t.get_item(r)),++r,this.m_structTypeFieldTypes[l][d]=t.get_item(r),++r,this.m_structTypeFieldDefaultValues[l][d]=this.deserializeValue(this.m_structTypeFieldTypes[l][d],t,(0,u.m)((function(){return r}),(function(e){return r=e})),null,null,null),e.LockDownIfNecessary(this.m_structTypeFieldDefaultValues[l][d])}this.set_attributeCount(t.get_item(r)),++r,this.m_attrNames=new Array(this.get_attributeCount()),this.m_attrTypes=new Array(this.get_attributeCount()),this.m_attrDefaultValues=new Array(this.get_attributeCount());for(var h=0;h<this.get_attributeCount();++h)this.m_attrNames[h]=n.getString(t.get_item(r)),++r,this.m_attrTypes[h]=t.get_item(r),++r,this.m_attrDefaultValues[h]=this.deserializeValue(this.m_attrTypes[h],t,(0,u.m)((function(){return r}),(function(e){return r=e})),null,null,null),e.LockDownIfNecessary(this.m_attrDefaultValues[h])}return e.prototype.getAttributeByName=function(e){for(var t=0;t<this.get_attributeCount();++t)if(this.m_attrNames[t]===e)return t;return-1},e.prototype.getAttributeName=function(e){if(!this.isValidAttributeID(e))throw Error.argument("attrID","Invalid attribute ID");return this.m_attrNames[e]},e.prototype.getAttributeType=function(e){if(!this.isValidAttributeID(e))throw Error.argument("attrID","Invalid attribute ID");return this.m_attrTypes[e]},e.prototype.getEnumTypeByName=function(t){for(var n=0,r=this.m_enumTypeNames.length;n<r;++n)if(this.m_enumTypeNames[n]===t)return e.get_firstEnumID()+n;return e.typeiD_None},e.prototype.getStructTypeByName=function(t){for(var n=0,r=this.m_structTypeNames.length;n<r;++n)if(this.m_structTypeNames[n]===t)return e.get_firstStructID()+n;return e.typeiD_None},e.prototype.getStructFieldIndexByName=function(t,n){if(!this.isValidStructTypeID(t))throw Error.argument("structTypeID","Invalid struct type ID");for(var r=this.m_structTypeFieldNames[e.StructTypeID2StructIndex(t)],i=0,o=r.length;i<o;++i)if(r[i]===n)return i;return-1},e.prototype.getStructFieldType=function(t,n){if(!this.isValidStructTypeID(t))throw Error.argument("structTypeID","Invalid struct type ID");var r=this.m_structTypeFieldTypes[e.StructTypeID2StructIndex(t)];if(n<0||n>=r.length)throw Error.argument("iField","Invalid field index");return r[n]},e.prototype.valueToString=function(t,n){if(!this.isValidTypeID(t))throw Error.argument("typeID","Invalid type ID");if(!this.isLegalValue(t,n))throw Error.argument("value","Value is not of the correct type");switch(t){case e.typeiD_String:return n;case e.typeiD_Boolean:return n?"True":"False";case e.typeiD_Integer:case e.typeiD_FloatingPoint:return n.toString();case e.typeiD_FeatureBundle:return n.valueToString();default:if(e.typeIDIsListType(t))return n.valueToString();if(!e.typeIDIsEnumType(t))return n.valueToString();var r=n,i=e.EnumTypeID2EnumIndex(t),o=this.m_enumTypeMemberNames[i].length;switch(this.m_enumTypeFlavor[i]){case e.ENUMTYPEFLAVOR_SingleSelect:return this.m_enumTypeMemberNames[i][r];case e.ENUMTYPEFLAVOR_MultiSelect_FirstMemberNone:if(r){for(var a="",s=1;s<o;++s)r&1<<s-1&&(a.length>0&&(a+=" & "),a+=this.m_enumTypeMemberNames[i][s]);return a}return this.m_enumTypeMemberNames[i][0];case e.ENUMTYPEFLAVOR_MultiSelect_FirstMemberIndependentlySelectable:for(a="",s=0;s<o;++s)r&1<<s&&(a.length>0&&(a+=" & "),a+=this.m_enumTypeMemberNames[i][s]);return a;default:throw Error.invalidOperation("Unrecognized enum type flavor "+this.m_enumTypeFlavor[i])}}},e.prototype.isValidTypeID=function(t){switch(t){case e.typeiD_String:case e.typeiD_Boolean:case e.typeiD_Integer:case e.typeiD_FloatingPoint:case e.typeiD_FeatureBundle:return!0;default:return e.typeIDIsListType(t)?this.isValidTypeID(e.getMemberTypeID(t)):e.typeIDIsEnumType(t)?this.isValidEnumTypeID(t):this.isValidStructTypeID(t)}},e.prototype.isValidEnumTypeID=function(t){var n=e.EnumTypeID2EnumIndex(t);return n>=0&&n<this.m_enumTypeNames.length},e.prototype.isValidStructTypeID=function(t){var n=e.StructTypeID2StructIndex(t);return n>=0&&n<this.m_structTypeNames.length},e.prototype.isValidAttributeID=function(e){return e>=0&&e<this.get_attributeCount()},e.prototype.isLegalValue=function(t,n){if(null==n)return!1;switch(t){case e.typeiD_String:return"string"==typeof n;case e.typeiD_Boolean:return"boolean"==typeof n;case e.typeiD_Integer:case e.typeiD_FloatingPoint:return"number"==typeof n;case e.typeiD_FeatureBundle:return r.r(i.m,n);default:if(e.typeIDIsListType(t))return r.r(o.z,n)&&n.get_memberTypeID()===e.getMemberTypeID(t);if(!e.typeIDIsEnumType(t))return r.r(a.w,n)&&n.get_structTypeID()===t;if("number"!=typeof n)return!1;var s=n,l=e.EnumTypeID2EnumIndex(t),u=this.m_enumTypeMemberNames[l].length;switch(this.m_enumTypeFlavor[l]){case e.ENUMTYPEFLAVOR_SingleSelect:return s>=0&&s<u;case e.ENUMTYPEFLAVOR_MultiSelect_FirstMemberNone:return!(s&-1<<u-1);case e.ENUMTYPEFLAVOR_MultiSelect_FirstMemberIndependentlySelectable:return!(!s||s&-1<<u);default:throw Error.invalidOperation("Unrecognized enum type flavor "+this.m_enumTypeFlavor[l])}}},e.prototype.get_attributeCount=function(){return this.$$pf_AttributeCount},e.prototype.set_attributeCount=function(e){return this.$$pf_AttributeCount=e,e},e.prototype.get_enumTypeCount=function(){return this.$$pf_EnumTypeCount},e.prototype.set_enumTypeCount=function(e){return this.$$pf_EnumTypeCount=e,e},e.prototype.get_structTypeCount=function(){return this.$$pf_StructTypeCount},e.prototype.set_structTypeCount=function(e){return this.$$pf_StructTypeCount=e,e},e.prototype.getAttributeDefaultValue=function(e){if(!this.isValidAttributeID(e))throw Error.argument("attrID","Invalid attribute ID");return this.m_attrDefaultValues[e]},e.prototype.getNumOfStructFields=function(t){if(!this.isValidStructTypeID(t))throw Error.argument("structTypeID","Invalid struct type ID");return this.m_structTypeFieldNames[e.StructTypeID2StructIndex(t)].length},e.prototype.getStructFieldName=function(t,n){if(!this.isValidStructTypeID(t))throw Error.argument("structTypeID","Invalid struct type ID");return this.m_structTypeFieldNames[e.StructTypeID2StructIndex(t)][n]},e.prototype.getStructFieldDefaultValue=function(t,n){if(!this.isValidStructTypeID(t))throw Error.argument("structTypeID","Invalid struct type ID");var r=this.m_structTypeFieldDefaultValues[e.StructTypeID2StructIndex(t)];if(n<0||n>=r.length)throw Error.argument("iField","Invalid field index");return r[n]},e.prototype.deserializeValue=function(t,n,r,i,o,a){if(!n)throw Error.argumentNull("initData");if(e.typeIDIsListType(t)){var s=n.get_item(r.val);++r.val;for(var l=e.getMemberTypeID(t),u=new d.e(this,l),p=0;p<s;++p)Array.add(u.get_items(),this.deserializeValue(l,n,r,i,o,a));return u}switch(t){case e.typeiD_String:return(i||this.m_stringTable).getString(n.get_item(r.val++));case e.typeiD_Boolean:return 1===n.get_item(r.val++);case e.typeiD_Integer:return n.get_item(r.val++);case e.typeiD_FloatingPoint:return(o||this.m_doublesArray)[n.get_item(r.val++)];case e.typeiD_FeatureBundle:for(var g=n.get_item(r.val++),_=new c.d(this),f=0;f<g;++f){var m=n.get_item(r.val);++r.val,a&&(m=a[m]),_.setAnnotation(m,this.deserializeValue(this.getAttributeType(m),n,r,i,o,a))}return _;default:if(e.typeIDIsEnumType(t))return n.get_item(r.val++);if(e.typeIDIsStructType(t)){for(var y=n.get_item(r.val++),v=new h(this,t),S=0;S<y;++S){var I=n.get_item(r.val);++r.val,v.setFieldValue(I,this.deserializeValue(this.getStructFieldType(t,I),n,r,i,o,a))}return v}throw Error.argument("typeID","Invalid type ID")}},e.typeIDIsEnumType=function(t){return(16383&t)>=e.TYPEID_FIRSTCUSTOMTYPE&&(t&e.TYPEID_STRUCT)!==e.TYPEID_STRUCT&&(t&e.TYPEID_LIST)!==e.TYPEID_LIST},e.typeIDIsStructType=function(t){return(16383&t)>=e.TYPEID_FIRSTCUSTOMTYPE&&(t&e.TYPEID_STRUCT)===e.TYPEID_STRUCT&&(t&e.TYPEID_LIST)!==e.TYPEID_LIST},e.typeIDIsListType=function(t){return(t&e.TYPEID_LIST)===e.TYPEID_LIST},e.getListTypeID=function(t){if(e.typeIDIsListType(t))throw Error.argument("nonListTypeID","Non-list type ID required");return t|e.TYPEID_LIST},e.getMemberTypeID=function(t){if(!e.typeIDIsListType(t))throw Error.argument("listTypeID","List type ID required");return t&~e.TYPEID_LIST},e.ValuesAreEqual=function(t,n,r){switch(t){case e.typeiD_String:case e.typeiD_Boolean:case e.typeiD_Integer:case e.typeiD_FloatingPoint:return n===r;case e.typeiD_FeatureBundle:return n.isEqual(r);default:return e.typeIDIsListType(t)?n.isEqual(r):e.typeIDIsEnumType(t)?n===r:n.isEqual(r)}},e.LockDownIfNecessary=function(e){r.r(s.r,e)&&e.lockDown()},e.CloneIfReadOnly=function(e){return r.r(s.r,e)?e.cloneIfReadOnly():e},e.EnumTypeID2EnumIndex=function(t){return t-e.TYPEID_FIRSTCUSTOMTYPE},e.StructTypeID2StructIndex=function(t){return(t&~e.TYPEID_STRUCT)-e.TYPEID_FIRSTCUSTOMTYPE},e.get_firstStructID=function(){return e.TYPEID_STRUCT|e.TYPEID_FIRSTCUSTOMTYPE},e.get_firstEnumID=function(){return e.TYPEID_FIRSTCUSTOMTYPE},e.typeiD_None=0,e.typeiD_String=1,e.typeiD_Boolean=2,e.typeiD_Integer=3,e.typeiD_FloatingPoint=5,e.typeiD_FeatureBundle=9,e.TYPEID_FIRSTCUSTOMTYPE=16,e.TYPEID_STRUCT=16384,e.TYPEID_LIST=32768,e.ENUMTYPEFLAVOR_SingleSelect=0,e.ENUMTYPEFLAVOR_MultiSelect_FirstMemberNone=1,e.ENUMTYPEFLAVOR_MultiSelect_FirstMemberIndependentlySelectable=2,e}();(0,r.l)(_,"ebddc652$Annotations",null,[l])},2096:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(423),o=n(1775),a=n(363),s=n(8192),l=n(2575),u=n(9423),c=n(5516),d=n(2192),p=function(){function e(e,t){this._rtcProxy=null,this._actionManager=null,this._rtcProxy=e,this._actionManager=t,this.RegisterActionsAndEvents()}return e.prototype.RegisterActionsAndEvents=function(){this._actionManager.addAction(c.u.sendTrackChangeSettingUpdateNotification,d.m.frame,i.i(this,this.sendTrackChangeSettingUpdateNotification,"sendTrackChangeSettingUpdateNotification")),this._rtcProxy.add_updateNotificationReceived(i.i(this,this.OnUpdateNotificationReceived,"OnUpdateNotificationReceived"))},e.prototype.sendTrackChangeSettingUpdateNotification=function(e,t,n,r,i){return 1===n?32:(this._rtcProxy.sendUpdateNotification(9,i,!1),32)},e.prototype.OnUpdateNotificationReceived=function(t,n){9===n.get_type()&&(l.AFrameworkApplication.logUniqueFlightedSettingUsage("Microsoft.Office.Web.SessionSettings.IWacFullTrackChangesSettings"),e.addNotificationBarEntry(n.get_updateHint()))},e.prototype.dispose=function(){},e.addNotificationBarEntry=function(e){var t=u.App.get_activeAppFrame().get_notificationBar().createEntry(e,!1);t.set_image(5),t.set_imagePath("CoAuth_AuthorStatus_16x16x32"),u.App.get_activeAppFrame().get_notificationBar().addEntry(t)},e}();(0,i.l)(p,"bb2e3584$TrackChangeNotificationActor",null,[]);var g=function(){function e(){this._container=null,this._trackChangeNotificationActor=null,this._rtcProxy=null}return e.prototype.get_name=function(){return"WordEditor.TrackChangeNotificationActor"},e.prototype.configure=function(e){this._container=e},e.prototype.init=function(){var e=this;this._container.resolve(o.d).get_graphFeaturesNodeTask().CW((function(t){e.OnAfterGraphFeaturesNodeLoaded()}))},e.prototype.OnAfterGraphFeaturesNodeLoaded=function(){this._container.resolve(o.d).isFeatureEnabled(56)&&u.App.get_theRealtimeChannelBasicAsync().CW(i.i(this,this.OnRtcProxyReady,"OnRtcProxyReady"))},e.prototype.OnRtcProxyReady=function(e){var t=this;this._rtcProxy=u.App.get_theRealtimeChannelBasicAsync().get_result(),this._rtcProxy&&(this._container.register(p).singleInstance().usingFactory((function(){return new p(t._rtcProxy,l.AFrameworkApplication.get_theActionManager())})),this._trackChangeNotificationActor=this._container.resolve(p))},e.prototype.dispose=function(){this._trackChangeNotificationActor&&this._trackChangeNotificationActor.dispose()},e}();(0,i.l)(g,"f4e9f842$WordEditorTrackChangeNotificationActorPackageManager",null,[a.u,s.s]),n.d(t,{ActorProgram:function(){return h}});var h=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new g,0,!1)},e}();(0,i.l)(h,"a205deb4$ActorProgram",null,[])},2132:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("2b93af38$IUploadToCloudManager"),o=n(1822),a=n(7597),s=n(2575),l=n(8996),u=n(5989),c=n(5227),d=n(5634);n.d(t,{t:function(){return p}});var p=function(){function e(e,t,n,r,i){this._uploadCallerFactory=null,this._caller=null,this._progressDialog=null,this._activeFrame=null,this._folderUrl=null,this._progressDialogFactory=null,this._errorDialogFactory=null,this._failedCanary=!1,this._stopwatchBuilder=null,this._uploadTimeStopwatch=null,this._options=null,this._uploadCallerFactory=e,this._progressDialogFactory=t,this._errorDialogFactory=n,this._activeFrame=r,this._stopwatchBuilder=i}return e.prototype.showWaitUI=function(){this._activeFrame&&1===this._activeFrame.get_state()||(this._progressDialog=this._progressDialogFactory(),this._progressDialog.set_message(CommonUIStrings.l_CommentProgressTooltip),this._progressDialog.set_buttonsOption(5),this._progressDialog.set_hasCloseGlyph(!1),this._progressDialog.showProgressDialog(CommonUIStrings.l_DefaultDialogTitle,null,null))},e.prototype.dismissWaitUI=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},e.prototype.showErrorUI=function(){1!==s.AFrameworkApplication.get_activeFrame().get_state()&&this._errorDialogFactory().displayError(0)},e.prototype.redirectToFolder=function(){a.ULS.sendTraceTag(6590599,216,50,"Redirecting to OneDrive Folder."),window.open(this._folderUrl,u.g.windowTargetToString(3))},e.prototype.redirectToEditUrl=function(e){a.ULS.sendTraceTag(6654163,216,50,"Redirecting to edit url {0}.",e),window.open(e,u.g.windowTargetToString(3))},e.prototype.startUpload=function(t,n,r,i){a.ULS.sendTraceTag(7143886,216,50,"Starting to upload file"),this._stopwatchBuilder&&(this._uploadTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown",e.SaveToOneDriveUploadPerf)),this.showWaitUI(),this._folderUrl=n,this._caller=this._uploadCallerFactory.create(t,r,i),this._options=i,this.executeUpload()},e.prototype.executeUpload=function(){a.ULS.sendTraceTag(6590600,216,50,"Calling SkydriveUploadHandler."),this._caller.execute(r.i(this,this.OnSaveToCloudUploadFinished,"OnSaveToCloudUploadFinished"),r.i(this,this.OnSaveToCloudUploadFailed,"OnSaveToCloudUploadFailed"))},e.prototype.OnSaveToCloudUploadFinished=function(e){if(this.dismissWaitUI(),this._failedCanary=!1,!e||!e.get_data()||!e.get_data().responseData)return a.ULS.sendTraceTag(6590601,216,10,"UploadToCloudManager upload failure. Response data is null"),void this.showErrorUI();var t;if(!l.x.tryDeserialize(Object,e.get_data().responseData,(0,o.m)((function(){return t}),(function(e){return t=e}))))return a.ULS.sendTraceTag(7660114,216,10,"Failed to deserialize : {0}",{ResponseData:d.l.truncateIfNecessary(e.get_data().responseData)}),void this.showErrorUI();var n=t;if(n.StatusCode!==c.k.oK_200&&n.StatusCode!==c.k.created_201)return a.ULS.sendTraceTag(6590602,216,10,"UploadToCloudManager upload failure. Response data is not JSON."),void this.showErrorUI();a.ULS.sendTraceTag(6590603,216,50,"UploadToCloudManager upload success.");try{n.NewDocumentUrl&&""!==n.NewDocumentUrl?this.redirectToEditUrl(n.NewDocumentUrl):this.redirectToFolder()}catch(e){a.ULS.sendTraceTag(37025728,216,15,"Redirect failed with exception: {0}",e.toString())}this.PerfWatchStop()},e.prototype.OnSaveToCloudUploadFailed=function(e){5!==e.get_data().status&&12!==e.get_data().status||this._failedCanary?(a.ULS.sendTraceTag(6590605,216,10,"UploadToCloudManager HTTP failure with code: {0}",e.get_data().status),this.dismissWaitUI(),this.showErrorUI(),this.PerfWatchStop()):(a.ULS.sendTraceTag(6590604,216,10,"UploadToCloudManager failure. Retrying."),this._failedCanary=!0,this.executeUpload())},e.prototype.PerfWatchStop=function(){this._uploadTimeStopwatch&&(this._uploadTimeStopwatch.stop(),this._uploadTimeStopwatch=null)},e.SaveToOneDriveUploadPerf="SaveToOneDriveUploadTime",e}();(0,r.l)(p,"27e00411$UploadToCloudManager",null,[i])},2186:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("901e755d$IGraphNodeComplexMergeFactory"),o=n(2506),a=n(3545),s=n(3290),l=n(3362),u=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 2},t.prototype.get_defaultPropertyMergeStrategy=function(){return 7},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(u,"85e9702c$AppBindingNodeComplexMerge",s.s,[]);var c=n(4455),d=n(8540),p=n(7518),g=n(833),h=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 3},t.prototype.get_defaultPropertyMergeStrategy=function(){return 7},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(c.b.lastModifiedTimeStamp),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(c.b.lastModifiedTimeStamp)){var n=e.mergedObject,r=e.mergeableObjectUtilities;return d.p.get_instance().traceTag(6633221,1,3,"AppNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t),r.getPropertyMilliseconds(e.baseFavoredDiffLazy.get_value().get_newObject(),c.b.lastModifiedTimeStamp)<r.getPropertyMilliseconds(e.baseConflictDiffLazy.get_value().get_newObject(),c.b.lastModifiedTimeStamp)&&this.GetConflictPropertiesAndChildren(e),e.mergedProperties.add(p.d.toPropertyId(c.b.lastModifiedTimeStamp)),!0}return d.p.get_instance().traceTag(6633222,1,1,"AppNodeComplexMerge: Failed to merge AppNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.prototype.GetConflictPropertiesAndChildren=function(e){var t=e.baseConflictDiffLazy.get_value().get_newObject(),n=e.mergedObject;this.ReplaceAllProperties(t,n),this.GetConflictChildrenAndProperties(e,o.j.appRefNodes),this.GetConflictChildrenAndProperties(e,o.j.appPropNodes),this.GetConflictChildrenAndProperties(e,o.j.appBindingNodes)},t.prototype.GetConflictChildrenAndProperties=function(e,t){var n=e.mergeableObjectUtilities,r=e.mergedObject;if(n.hasProperty(r,t)){var i=n.getPropertyObjectIds(r,t);if(i&&i.get_length())for(var o=e.mergeState.runtime.UnfavoredObjects,a=(e.mergeState.runtime.FavoredObjects,e.mergeState.runtime.MergedObjects),s=0;s<i.get_length();s++){var l=i.get_item(s);if(o.containsKey(l)){var u=o.get_item(l).cloneForMerge();a.add(l,new g.o(u,!1))}}}},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(h,"e845cb2d$AppNodeComplexMerge",s.s,[]);var _=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 4},t.prototype.get_defaultPropertyMergeStrategy=function(){return 7},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(_,"59c15430$AppPropNodeComplexMerge",s.s,[]);var f=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 5},t.prototype.get_defaultPropertyMergeStrategy=function(){return 7},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(f,"7474a7c$AppRefNodeComplexMerge",s.s,[]);var m=n(1308),y=n(3795),v=n(3748),S=n(5479),I=n(6378),C=function(){function e(e,t){this.id=null,this.stamp=0,this.id=e,this.stamp=t}return e.prototype.get_id=function(){return this.id},e.prototype.get_stamp=function(){return this.stamp},e}();(0,r.l)(C,"4290724d$IdAndTime",null,[]);var T=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 6},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.appNodes),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(o.j.appNodes)){var n=e.mergedObject,r=e.mergeableObjectUtilities;d.p.get_instance().traceTag(6633224,1,3,"AppsNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t);var i=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),o.j.appNodes),a=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.appNodes),s=r.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.appNodes),l=this.MergeAppObjectIds(e,i,a,s),u=n;return l.get_length()>0?r.setPropertyObjectIds(u,o.j.appNodes,l):u.removeProperty(o.j.appNodes),e.mergedProperties.add(p.d.toPropertyId(o.j.appNodes)),!0}return d.p.get_instance().traceTag(6633225,1,1,"AppsNodeComplexMerge: Failed to merge AppsNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.prototype.MergeAppObjectIds=function(e,t,n,r){var i=this,o=this.MergeUnorderedListOfChildNodes(m.h,t,n,r),a=t.toHashSet(),l=n.toHashSet(),u=r.toHashSet(),c=s.s.Filter(m.h,o,(function(e){return!a.contains(e)&&l.contains(e)})),d=s.s.Filter(m.h,o,(function(e){return!a.contains(e)&&u.contains(e)}));if(!c.get_length()||!d.get_length())return o;var p=new y.e(String,C);c.forEach((function(t){var n=new C(t,i.GetAppTimeStamp(e,t,!1));return i.GetAppRefStrings(e,t,!1).forEach((function(e){return p.add(e,n),!0})),!0}));var g=new v.f(m.h);return d.forEach((function(t){var n=i.GetAppTimeStamp(e,t,!0);return i.GetAppRefStrings(e,t,!0).forEach((function(e){return!p.containsKey(e)||(g.add(p.get_item(e).get_stamp()>=n?t:p.get_item(e).get_id()),!1)})),!0})),s.s.Filter(m.h,o,(function(e){return!g.contains(e)}))},t.prototype.GetAppTimeStamp=function(e,t,n){var r=this.GetProps(e,t,n);return r?e.mergeableObjectUtilities.getPropertyMilliseconds(r,c.b.lastModifiedTimeStamp):0},t.prototype.GetProps=function(e,t,n){var r=n?e.mergeState.runtime.UnfavoredObjects:e.mergeState.runtime.FavoredObjects;return r.containsKey(t)?r.get_item(t):null},t.prototype.GetAppRefStrings=function(e,t,n){var r=new S.o(String,null),i=new v.f(String),a=e.mergeableObjectUtilities,s=this.GetProps(e,t,n),l=this.GetRefString(a,s);if(l){r.add(l),i.add(l);for(var u=a.getPropertyObjectIds(s,o.j.appRefNodes),c=0;u&&c<u.get_length();c++){var d=this.GetRefString(a,this.GetProps(e,u.get_item(c),n));if(!d)break;i.contains(d)||(r.add(d),i.add(d))}}return r},t.prototype.GetRefString=function(e,t){if(!e.hasProperty(t,o.j.appRefId)||!e.hasProperty(t,o.j.appRefStore)||!e.hasProperty(t,o.j.appRefStoreType))return null;var n=e.getPropertyString(t,o.j.appRefId),r=e.getPropertyString(t,o.j.appRefStore),i=e.getPropertyString(t,o.j.appRefStoreType);return I.l.toUpper(n+";"+r+";"+i)},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(T,"de99e67e$AppsNodeComplexMerge",s.s,[]);var b,A=n(1822);!function(e){e[e.added=0]="added",e[e.deleted=1]="deleted",e[e.matched=2]="matched"}(b||(b={})),(0,r.h)("3b6ce2b3$CommentNodeStatus",b);var M=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 7},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(c.b.elementNodes),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(c.b.elementNodes)){var n=e.mergedObject,r=e.mergeableObjectUtilities;d.p.get_instance().traceTag(4511579,1,3,"CommentContentNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t);var i=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),c.b.elementNodes),o=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),c.b.elementNodes),a=r.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),c.b.elementNodes),s=this.MergeCommentObjectIds(i,o,a),l=n;return s.get_length()>0?r.setPropertyObjectIds(l,c.b.elementNodes,s):l.removeProperty(c.b.elementNodes),e.mergedProperties.add(p.d.toPropertyId(c.b.elementNodes)),!0}return d.p.get_instance().traceTag(4511580,1,1,"CommentContentNodeComplexMerge: Failed to merge CommentContainer [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.prototype.MergeCommentObjectIds=function(e,t,n){var r=new S.o(m.h,null),i=new y.e(m.h,b);return this.FillMapWithCommentNodeChangesInConflictRevision(e,n,r,i),this.DetermineMergedListOfCommentNodes(t,i,r)},t.prototype.FillMapWithCommentNodeChangesInConflictRevision=function(e,t,n,r){e=e||new S.o(m.h,null),t=t||new S.o(m.h,null),e.forEach((function(e){return r.set_item(e,1),!0})),t.forEach((function(e){var t;return r.tryGetValue(e,(0,A.m)((function(){return t}),(function(e){return t=e})))?r.set_item(e,2):(r.set_item(e,0),n.add(e)),!0}))},t.prototype.DetermineMergedListOfCommentNodes=function(e,t,n){e=e||new S.o(m.h,null);var r=new S.o(m.h,null);return e.forEach((function(e){var n,i=!0;return t.tryGetValue(e,(0,A.m)((function(){return n}),(function(e){return n=e})))&&(n?1===n&&(i=!1):t.set_item(e,2)),i&&r.add(e),!0})),n.forEach((function(e){var n,i=!1;return t.tryGetValue(e,(0,A.m)((function(){return n}),(function(e){return n=e})))&&(n||(i=!0,t.set_item(e,2))),i&&r.add(e),!0})),r},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(M,"8e71b2f6$CommentContentNodeComplexMerge",s.s,[]);var P=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 8},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.commentDoneStatus),3),t.set_item(p.d.toPropertyId(o.j.durableCommentId),3),t.set_item(p.d.toPropertyId(o.j.commentId),1),t.set_item(p.d.toPropertyId(o.j.commentInitials),1),t.set_item(p.d.toPropertyId(o.j.hasLossyContentInComment),1),t.set_item(p.d.toPropertyId(c.b.elementNodes),0),t.set_item(p.d.toPropertyId(o.j.commentGuardParaId),0),t},t.prototype.tryMergeCustomProperty=function(e,t){return(t===p.d.toPropertyId(o.j.commentId)||t===p.d.toPropertyId(o.j.commentInitials)||t===p.d.toPropertyId(o.j.hasLossyContentInComment))&&(this.LogAndCheckIfCustomMergeStrategyShouldBeUsed(e,t)?(d.p.get_instance().traceTag(50704902,1,3,"Comment PropertyId {0}: Using FavoredAlwaysWins Strategy",t),e.mergedProperties.add(t),!0):(d.p.get_instance().traceTag(50704901,1,3,"Comment PropertyId {0}: Reject Change",t),!1))},t.prototype.LogAndCheckIfCustomMergeStrategyShouldBeUsed=function(e,t){var n=e.mergeState.runtime.FeatureHelper;return n?t===p.d.toPropertyId(o.j.commentId)?(n.logUniqueFeatureUsage(86),n.isFeatureEnabled(86)):t===p.d.toPropertyId(o.j.commentInitials)?(n.logUniqueFeatureUsage(87),n.isFeatureEnabled(87)):t===p.d.toPropertyId(o.j.hasLossyContentInComment)&&(n.logUniqueFeatureUsage(88),n.isFeatureEnabled(88)):(d.p.get_instance().traceTag(50704903,1,2,"Comment PropertyId {0}: Feature Helper is null"),!1)},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(P,"d9cdfe7f$CommentNodeComplexMerge",s.s,[]);var F=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 10},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.customXmlPartNode),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(o.j.customXmlPartNode)){var n=e.mergedObject,r=e.mergeableObjectUtilities,i=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),o.j.customXmlPartNode),a=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.customXmlPartNode),s=r.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.customXmlPartNode),l=this.MergeCustomXmlObjectIds(e,i,a,s),u=n;return l.get_length()>0?r.setPropertyObjectIds(u,o.j.customXmlPartNode,l):u.removeProperty(o.j.customXmlPartNode),e.mergedProperties.add(p.d.toPropertyId(o.j.customXmlPartNode)),!0}return!1},t.prototype.MergeCustomXmlObjectIds=function(e,t,n,r){return this.MergeUnorderedListOfChildNodes(m.h,t,n,r)},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(F,"97f83856$CustomXmlPartContainerNodeComplexMerge",s.s,[]);var w=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 9},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(w,"c36f8dd1$CustomXmlPartNodeComplexMerge",s.s,[]);var R=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 29},t.prototype.get_defaultPropertyMergeStrategy=function(){return 3},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.embeddedFontNode),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(o.j.embeddedFontNode)){var n=e.mergeableObjectUtilities,r=n.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),o.j.embeddedFontNode),i=n.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.embeddedFontNode),a=n.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.embeddedFontNode),s=this.MergeUnorderedListOfChildNodes(m.h,r,i,a),l=e.mergedObject;return s.get_length()>0?n.setPropertyObjectIds(l,o.j.embeddedFontNode,s):l.removeProperty(o.j.embeddedFontNode),e.mergedProperties.add(p.d.toPropertyId(o.j.embeddedFontNode)),!0}return!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(R,"3e9751f6$EmbeddedFontContainerNodeComplexMerge",s.s,[]);var E=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 30},t.prototype.get_defaultPropertyMergeStrategy=function(){return 3},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(E,"1a605811$EmbeddedFontNodeComplexMerge",s.s,[]);var k=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 11},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.footnoteEndnoteKind),4),t.set_item(p.d.toPropertyId(o.j.footnoteEndnoteNodes),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(o.j.footnoteEndnoteNodes)){var n=e.mergedObject,r=e.mergeableObjectUtilities;d.p.get_instance().traceTag(4063307,1,3,"FootnoteEndnoteContainerNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t);var i=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),o.j.footnoteEndnoteNodes),a=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.footnoteEndnoteNodes),s=r.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.footnoteEndnoteNodes),l=this.MergeListOfChildNodes(m.h,i,a,s,(function(e,t){return e.equals(t)})),u=n;return l.get_length()>0?r.setPropertyObjectIds(u,o.j.footnoteEndnoteNodes,l):u.removeProperty(o.j.footnoteEndnoteNodes),e.mergedProperties.add(p.d.toPropertyId(o.j.footnoteEndnoteNodes)),!0}return d.p.get_instance().traceTag(4063308,1,1,"FootnoteEndnoteContainerNodeComplexMerge: Failed to merge FootnoteEndnoteContainer [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(k,"de9fc4f6$FootnoteEndnoteContainerNodeComplexMerge",s.s,[]);var D=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 12},t.prototype.get_defaultPropertyMergeStrategy=function(){return 3},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.footnoteEndnoteNumber),1),t},t.prototype.tryMergeCustomProperty=function(e,t){var n=e.mergedObject,r=n,i=e.mergeableObjectUtilities;if(t===p.d.toPropertyId(o.j.footnoteEndnoteNumber)){var a=-1;d.p.get_instance().traceTag(5002527,1,3,"FootnoteEndnoteNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t);var s=i.getPropertyInt32(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.footnoteEndnoteNumber),l=i.getPropertyInt32(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.footnoteEndnoteNumber);return null!=s&&-1!==s?a=s:null!=l&&(a=l),i.setPropertyInt32(r,o.j.footnoteEndnoteNumber,a),e.mergedProperties.add(t),!0}return d.p.get_instance().traceTag(5002528,1,3,"FootnoteEndnoteNodeComplexMerge: Failed to merge FootnoteEndnoteNodeComplexMerge [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_oldObject().get_id(),t),!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return d.p.get_instance().traceTag(5002526,1,3,"FootnoteEndnoteNodeComplexMerge: Got Instance"),t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(D,"cfac2b1$FootnoteEndnoteNodeComplexMerge",s.s,[]);var O=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 13},t.prototype.get_defaultPropertyMergeStrategy=function(){return 3},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.sectionNumber),4),t},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(O,"73716b51$HeaderFooterContainerNodeComplexMerge",s.s,[]);var U=n(1094),x=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 14},t.prototype.get_defaultPropertyMergeStrategy=function(){return 3},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.runId),3),t.set_item(p.d.toPropertyId(o.j.wordId),3),t.set_item(p.d.toPropertyId(o.j.imageAnchorId),5),t.set_item(p.d.toPropertyId(U.o.imageUploadState),1),t.set_item(p.d.toPropertyId(c.b.imageAltText),1),t.set_item(p.d.toPropertyId(o.j.imageAltTextDescription),1),t.set_item(p.d.toPropertyId(c.b.pictureContainer),1),t.set_item(p.d.toPropertyId(U.o.webPictureContainer14),1),t.set_item(p.d.toPropertyId(o.j.anchorImageChangeId),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(c.b.imageAltText)||t===p.d.toPropertyId(o.j.imageAltTextDescription)||t===p.d.toPropertyId(o.j.imageLockAspectRatio)||t===p.d.toPropertyId(c.b.hyperlinkUrl)||t===p.d.toPropertyId(c.b.pictureContainer)||t===p.d.toPropertyId(U.o.imageUploadState)||t===p.d.toPropertyId(U.o.webPictureContainer14)||t===p.d.toPropertyId(o.j.anchorImageChangeId)){var n=e.mergedObject,r=e.mergeableObjectUtilities;d.p.get_instance().traceTag(4018185,1,3,"ImageNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t);var i=r.getPropertyInt32(e.baseFavoredDiffLazy.get_value().get_newObject(),U.o.imageUploadState),a=r.getPropertyInt32(e.baseConflictDiffLazy.get_value().get_newObject(),U.o.imageUploadState);if(null!=i&&(!i||2===i))return!0;if(null!=a&&(!a||2===a)){var s=e.baseConflictDiffLazy.get_value().get_newObject(),l=n;return this.CopyPropertyToDestination(s,l,c.b.imageAltText),this.CopyPropertyToDestination(s,l,o.j.imageAltTextDescription),this.CopyPropertyToDestination(s,l,o.j.imageLockAspectRatio),this.CopyPropertyToDestination(s,l,c.b.hyperlinkUrl),this.CopyPropertyToDestination(s,l,c.b.pictureContainer),this.CopyPropertyToDestination(s,l,U.o.imageUploadState),this.CopyPropertyToDestination(s,l,U.o.webPictureContainer14),e.mergedProperties.add(p.d.toPropertyId(c.b.imageAltText)),e.mergedProperties.add(p.d.toPropertyId(o.j.imageAltTextDescription)),e.mergedProperties.add(p.d.toPropertyId(o.j.imageLockAspectRatio)),e.mergedProperties.add(p.d.toPropertyId(c.b.hyperlinkUrl)),e.mergedProperties.add(p.d.toPropertyId(c.b.pictureContainer)),e.mergedProperties.add(p.d.toPropertyId(U.o.imageUploadState)),e.mergedProperties.add(p.d.toPropertyId(U.o.webPictureContainer14)),e.mergedProperties.add(p.d.toPropertyId(o.j.anchorImageChangeId)),!0}}return d.p.get_instance().traceTag(4018186,1,3,"ImageNodeComplexMerge: Failed to merge ImageNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_oldObject().get_id(),t),!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(x,"79e6052b$ImageNodeComplexMerge",s.s,[]);var L=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 15},t.prototype.get_defaultPropertyMergeStrategy=function(){return 3},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(L,"babb33ad$NumberListNodeComplexMerge",s.s,[]);var N=n(9154),B=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 16},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.approximateHeight),1),t.set_item(p.d.toPropertyId(N.p.commentsWithStartParaOnLoad),7),t.set_item(p.d.toPropertyId(N.p.commentsWithEndParaOnLoad),7),t},t.prototype.tryMergeCustomProperty=function(e,t){var n=e.mergedObject,r=e.mergeableObjectUtilities;return t===p.d.toPropertyId(o.j.approximateHeight)?(this.KeepMaxInt32Value(r,e.baseFavoredDiffLazy.get_value().get_newObject(),e.baseConflictDiffLazy.get_value().get_newObject(),n,o.j.approximateHeight),e.mergedProperties.add(t),!0):(d.p.get_instance().traceTag(4207940,1,3,"OutlineElementNodeComplexMerge: Failed to merge OutlineElementNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_oldObject().get_id(),t),!1)},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(B,"65f9ca72$OutlineElementNodeComplexMerge",s.s,[]);var H=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 17},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.approximateHeight),1),t.set_item(p.d.toPropertyId(o.j.doNotRenderChildren),1),t.set_item(p.d.toPropertyId(N.p.forceRenderChildren),1),t.set_item(p.d.toPropertyId(N.p.lastKnownHeight),1),t.set_item(p.d.toPropertyId(N.p.outlineGroupChildrenMayBeRendered),8),t},t.prototype.tryMergeCustomProperty=function(e,t){var n=e.mergedObject,r=e.mergeableObjectUtilities;if(t===p.d.toPropertyId(o.j.approximateHeight))return this.KeepMaxInt32Value(r,e.baseFavoredDiffLazy.get_value().get_newObject(),e.baseConflictDiffLazy.get_value().get_newObject(),n,o.j.approximateHeight),e.mergedProperties.add(t),!0;if(t===p.d.toPropertyId(o.j.doNotRenderChildren)){var i=r.getPropertyBool(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.doNotRenderChildren),a=r.getPropertyBool(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.doNotRenderChildren),s=null!=i&&((!i||null!=a)&&a);return r.setPropertyBool(n,o.j.doNotRenderChildren,s),e.mergedProperties.add(t),!0}if(t===p.d.toPropertyId(N.p.lastKnownHeight)&&this.LogAndCheckShouldKeepMaxLastKnownHeight(e))return this.KeepMaxInt32Value(r,e.baseFavoredDiffLazy.get_value().get_newObject(),e.baseConflictDiffLazy.get_value().get_newObject(),n,N.p.lastKnownHeight),e.mergedProperties.add(t),!0;if(t===p.d.toPropertyId(N.p.forceRenderChildren)){var l=r.getPropertyBool(e.baseFavoredDiffLazy.get_value().get_newObject(),N.p.forceRenderChildren),u=r.getPropertyBool(e.baseConflictDiffLazy.get_value().get_newObject(),N.p.forceRenderChildren),c=null==l||(!(!l&&null!=u)||u);return r.setPropertyBool(n,N.p.forceRenderChildren,c),e.mergedProperties.add(t),!0}return d.p.get_instance().traceTag(4057305,1,3,"OutlineGroupNodeComplexMerge: Failed to merge OutlineGroupNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_oldObject().get_id(),t),!1},t.prototype.LogAndCheckShouldKeepMaxLastKnownHeight=function(e){var t=e.mergeState.runtime.FeatureHelper;return t?(t.logUniqueFeatureUsage(76),t.isFeatureEnabled(76)):(d.p.get_instance().traceTag(50938890,1,2,"OutlineGroupNodeComplexMerge: FeatureHelper null"),!1)},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(H,"97bb26d3$OutlineGroupNodeComplexMerge",s.s,[]);var $=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 18},t.prototype.get_defaultPropertyMergeStrategy=function(){return 2},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.hasEvenOddPages),3),t.set_item(p.d.toPropertyId(o.j.listIds),1),t.set_item(p.d.toPropertyId(o.j.listDefinitions),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(o.j.listIds)||t===p.d.toPropertyId(o.j.listDefinitions)){var n,i,a,s,l,u,c=e.mergeableObjectUtilities;if(this.CheckForMaterialDifferences(Number,r.i(c,c.getPropertyUint32s,"getPropertyUint32s"),e.baseFavoredDiffLazy.get_value().get_oldObject(),e.baseFavoredDiffLazy.get_value().get_newObject(),e.baseConflictDiffLazy.get_value().get_newObject(),o.j.listIds,(0,A.m)((function(){return n}),(function(e){return n=e})),(0,A.m)((function(){return i}),(function(e){return i=e})),(0,A.m)((function(){return a}),(function(e){return a=e}))),!a&&!i)return d.p.get_instance().traceTag(4318873,1,3,"PageContentNodeComplexMerge: Failed to merge PageContentNode [Id: {0}] due to  material difference in [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),p.d.toPropertyId(o.j.listIds)),!0;if(this.CheckForMaterialDifferences(m.h,r.i(c,c.getPropertyObjectIds,"getPropertyObjectIds"),e.baseFavoredDiffLazy.get_value().get_oldObject(),e.baseFavoredDiffLazy.get_value().get_newObject(),e.baseConflictDiffLazy.get_value().get_newObject(),o.j.listDefinitions,(0,A.m)((function(){return s}),(function(e){return s=e})),(0,A.m)((function(){return l}),(function(e){return l=e})),(0,A.m)((function(){return u}),(function(e){return u=e}))),!l&&!u)return d.p.get_instance().traceTag(4318874,1,3,"PageContentNodeComplexMerge: Failed to merge PageContentNode [Id: {0}] due to  material difference in [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),p.d.toPropertyId(o.j.listDefinitions)),!0;var g=l&&!u;return(i&&!a)!==g?(d.p.get_instance().traceTag(4318875,1,3,"PageContentNodeComplexMerge: Failed to merge PageContentNode [Id: {0}] due to wanting to merge [PropertyId: {1}] and [PropertyId: {2}] differently.",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),p.d.toPropertyId(o.j.listIds),p.d.toPropertyId(o.j.listDefinitions)),!1):(g&&(c.setPropertyObjectIds(e.mergedObject,o.j.listDefinitions,s),c.setPropertyUint32s(e.mergedObject,o.j.listIds,n)),d.p.get_instance().traceTag(4318877,1,3,"PageContentNodeComplexMerge: Merging PageContentNode [Id: {0}]. [PropertyId: {1}] [favoredEquivalentToBase: {1}] [conflictEquivalentToBase: {2}]. [PropertyId: {3}] [favoredEquivalentToBase: {4}] [conflictEquivalentToBase: {5}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),p.d.toPropertyId(o.j.listIds),i,a,p.d.toPropertyId(o.j.listDefinitions),l,u),e.mergedProperties.add(p.d.toPropertyId(o.j.listDefinitions)),e.mergedProperties.add(p.d.toPropertyId(o.j.listIds)),!0)}return d.p.get_instance().traceTag(4318878,1,3,"PageContentNodeComplexMerge: Failed to merge PageContentNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)($,"eacaa3b6$PageContentNodeComplexMerge",s.s,[]);var G=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 19},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.sharedFormattingObjectIds),1),t.set_item(p.d.toPropertyId(o.j.appsNode),2),t.set_item(p.d.toPropertyId(o.j.customXmlPartContainerNode),2),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(o.j.sharedFormattingObjectIds)){var n=e.mergeableObjectUtilities,r=n.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),o.j.sharedFormattingObjectIds),i=n.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.sharedFormattingObjectIds),a=n.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.sharedFormattingObjectIds),s=this.MergePurelyAdditiveLists(m.h,r,i,a,(function(e,t){return e.equals(t)}),(function(t){var n;e.mergeState.runtime.UnfavoredObjects.tryGetValue(t,(0,A.m)((function(){return n}),(function(e){return n=e})))?e.mergeState.runtime.MergedObjects.set_item(t,new g.o(n,!1)):d.p.get_instance().shipAssertTag(4034653,1,!1,"PageManifestNodeComplexMerge failed to shared formatting object with [id: {0}] in conflicting revision.")}));if(s.get_length()>0)return n.setPropertyObjectIds(e.mergedObject,o.j.sharedFormattingObjectIds,s),e.mergedProperties.add(p.d.toPropertyId(o.j.sharedFormattingObjectIds)),!0}return d.p.get_instance().traceTag(4018187,1,3,"PageManifestNodeComplexMerge: Failed to merge PageManifestNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(G,"b25a2f10$PageManifestNodeComplexMerge",s.s,[]);var W=n(342),V=n(8400),j=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 31},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(V.Properties.listSoftType),1),t},t.prototype.tryMergeCustomProperty=function(e,t){var n=e.mergeableObjectUtilities,r=e.mergedObject;if(t===p.d.toPropertyId(V.Properties.listSoftType)){e.mergeState.runtime.FeatureHelper.logUniqueFeatureUsage(80);var i=n.getPropertyUint32(e.baseFavoredDiffLazy.get_value().get_newObject(),V.Properties.listSoftType),o=n.getPropertyUint32(e.baseConflictDiffLazy.get_value().get_newObject(),V.Properties.listSoftType);return null==i&&null==o||null!=i&&null!=o&&i===o?(n.setPropertyUint32(r,V.Properties.listSoftType,i),e.mergedProperties.add(t),!0):null!=i&&null==o?(n.setPropertyUint32(r,V.Properties.listSoftType,i),e.mergedProperties.add(t),!0):null==i&&null!=o&&(n.setPropertyUint32(r,V.Properties.listSoftType,o),e.mergedProperties.add(t),!0)}return!1},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(j,"2c005d9$PersistablePropertySetComplexMerge",s.s,[]);var q=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 21},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(q,"e9817712$RevisionMetadataNodeComplexMerge",s.s,[]);var z=n(2575),K=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 22},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.languageHint),7),this.IsWordEditorPictureBulletNotSupported()&&t.set_item(p.d.toPropertyId(o.j.isPictureBullet),2),t},t.prototype.IsWordEditorPictureBulletNotSupported=function(){return z.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorPictureBulletIsNotSupported")},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(K,"e0e91770$SharedPersistablePropertySetComplexMerge",s.s,[]);var Q=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 23},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(c.b.elementNodes),4),t.set_item(p.d.toPropertyId(o.j.rowSpan),1),t.set_item(p.d.toPropertyId(o.j.colSpan),1),t.set_item(p.d.toPropertyId(o.j.ghostCell),1),t},t.prototype.tryMergeCustomProperty=function(e,t){return!(t===p.d.toPropertyId(o.j.rowSpan)||t===p.d.toPropertyId(o.j.colSpan)||t===p.d.toPropertyId(o.j.ghostCell))},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(Q,"20d9c294$TableCellNodeComplexMerge",s.s,[]);var Z=n(5214),J=n(3217),X=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 24},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(c.b.elementNodes),1),t.set_item(p.d.toPropertyId(c.b.tableColumnCount),1),t.set_item(p.d.toPropertyId(c.b.tableRowCount),1),t.set_item(p.d.toPropertyId(o.j.tableCaption),1),t.set_item(p.d.toPropertyId(o.j.tableDescription),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(c.b.elementNodes)||t===p.d.toPropertyId(c.b.tableColumnCount)||t===p.d.toPropertyId(o.j.tableCaption)||t===p.d.toPropertyId(o.j.tableDescription)||t===p.d.toPropertyId(c.b.tableRowCount)){var n=e.mergedObject,r=e.mergeableObjectUtilities;if(d.p.get_instance().traceTag(4273303,1,3,"TableNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t),this.DoColumnsConflict(e))return!1;var i=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),c.b.elementNodes),a=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),c.b.elementNodes),s=r.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),c.b.elementNodes),l=this.MergeListOfChildNodes(m.h,i,a,s,(function(e,t){return e.equals(t)}));if(l.get_length()>0){var u=n;return r.setPropertyObjectIds(u,c.b.elementNodes,l),r.setPropertyInt32(u,c.b.tableRowCount,l.get_length()),e.mergedProperties.add(p.d.toPropertyId(c.b.elementNodes)),e.mergedProperties.add(p.d.toPropertyId(c.b.tableColumnCount)),e.mergedProperties.add(p.d.toPropertyId(c.b.tableRowCount)),e.mergedProperties.add(p.d.toPropertyId(o.j.tableCaption)),e.mergedProperties.add(p.d.toPropertyId(o.j.tableDescription)),!0}}return d.p.get_instance().traceTag(4018189,1,3,"TableNodeComplexMerge: Failed to merge TableNode [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.prototype.DoColumnsConflict=function(e){var n,r,i=e.baseConflictDiffLazy.get_value(),o=e.baseFavoredDiffLazy.get_value();return i.get_propertyDiffs().tryGetValue(p.d.toPropertyId(c.b.tableColumnCount),(0,A.m)((function(){return n}),(function(e){return n=e}))),o.get_propertyDiffs().tryGetValue(p.d.toPropertyId(c.b.tableColumnCount),(0,A.m)((function(){return r}),(function(e){return r=e}))),!(!n.get_isDifferent()&&!r.get_isDifferent())&&(n.get_isDifferent()&&r.get_isDifferent()?(d.p.get_instance().traceTag(4273304,1,3,"TableNodeComplexMerge: Failed to merge TableNode due to columns being changed in both. [Base: {0}] [Favored: {1}] [Conflicting: {2}]",n.get_oldValue(),r.get_newValue(),n.get_newValue()),e.mergeState.logger.logMergeFailureDetail((0,Z.m)(new J.g,{funcSource:"DoColumnsConflict",eventId:"aqtsy",info:"Columns changed"})),!0):!!t.DoColumnsConflictWithRows(e.mergeState,n,o,"BaseConflict")||!!t.DoColumnsConflictWithRows(e.mergeState,r,i,"BaseFavored"))},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t.DoColumnsConflictWithRows=function(e,t,n,r){var i;if(t.get_isDifferent()&&(n.get_propertyDiffs().tryGetValue(p.d.toPropertyId(c.b.elementNodes),(0,A.m)((function(){return i}),(function(e){return i=e}))),i.get_isDifferent()))return d.p.get_instance().traceTag(4273305,1,3,"TableNodeComplexMerge {0}: Failed to merge TableNode due to columns and rows being changed on different sides of the conflict.",r),e.logger.logMergeFailureDetail((0,Z.m)(new J.g,{funcSource:"DoColumnsConflictWithRows",eventId:"aqtsz"})),!0;return!1},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(X,"8a044d2$TableNodeComplexMerge",s.s,[]);var Y,ee=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 25},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.wordId),3),t.set_item(p.d.toPropertyId(c.b.elementNodes),4),t},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(ee,"324a678$TableRowNodeComplexMerge",s.s,[]),function(e){e[e.base=0]="base",e[e.baseAndFavored=1]="baseAndFavored",e[e.baseAndConflict=2]="baseAndConflict",e[e.favored=3]="favored",e[e.conflict=4]="conflict",e[e.all=5]="all"}(Y||(Y={})),(0,r.h)("21328ad8$TaskNodeMergePresence",Y);var te=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(c.b.elementNodes),1),t},t.prototype.tryMergeCustomProperty=function(e,t){if(t===p.d.toPropertyId(c.b.elementNodes)){var n=e.mergedObject,r=e.mergeableObjectUtilities;d.p.get_instance().traceTag(42754251,1,3,"TaskContentNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t);var i=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),c.b.elementNodes),o=r.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),c.b.elementNodes),a=r.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),c.b.elementNodes),s=this.MergeTaskSingleObjectIds(i,o,a);if(s){var l=n;return s.get_length()>0?r.setPropertyObjectIds(l,c.b.elementNodes,s):l.removeProperty(c.b.elementNodes),e.mergedProperties.add(p.d.toPropertyId(c.b.elementNodes)),!0}}return d.p.get_instance().traceTag(42754252,1,1,"TaskContentNodeComplexMerge: Failed to merge TaskContent [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1},t.prototype.MergeTaskSingleObjectIds=function(e,t,n){var r=new y.e(m.h,Y);e.forEach((function(e){return r.set_item(e,0),!0})),t.forEach((function(e){return r.containsKey(e)?r.set_item(e,1):r.set_item(e,3),!0})),n.forEach((function(e){var t;return r.tryGetValue(e,(0,A.m)((function(){return t}),(function(e){return t=e})))?1===t?r.set_item(e,5):3===t?(d.p.get_instance().traceTag(42754253,1,2,"TaskNode was found added by both sides of merge"),r.set_item(e,3)):r.set_item(e,2):r.set_item(e,4),!0}));var i=new S.o(m.h,null);return r.forEach((function(e,t){return t&&2!==t&&1!==t&&i.add(e),!0})),i},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(te,"e6142c68$TaskContentNodeComplexMerge",s.s,[]);var ne=n(3476),re=n(6902),ie=n(9253),oe=n(5465),ae=n(4648),se=function(){function e(){}return e.prototype.equals=function(e,t){return!e&&!t||!(!e||!t)&&(e.UserId===t.UserId&&e.Provider===t.Provider&&e.DisplayName===t.DisplayName&&e.Email===t.Email)},e.prototype.getHashCode=function(e){return 0},e}();(0,r.l)(se,"e37cfb96$CommentTaskPersonComparer",null,[oe.v.$$(ae.m)]);var le=function(){function e(){}return e.prototype.equals=function(t,n){return!t&&!n||!(!t||!n)&&(t.recordId===n.recordId&&e._commentTaskPersonComparer.equals(t.user,n.user)&&e._commentTaskPersonComparer.equals(t.assignee,n.assignee)&&t.type===n.type&&t.title===n.title&&t.priority===n.priority&&t.isLossy===n.isLossy&&t.completion===n.completion&&t.commentId===n.commentId&&t.time===n.time&&t.schedule===n.schedule)},e.prototype.getHashCode=function(e){return 0},e._commentTaskPersonComparer=new se,e}();(0,r.l)(le,"33737f1a$HistoryRecordEqualityComparer",null,[oe.v.$$(ne.m)]);var ue=function(e){function t(t){var n=this;return n._taskHistorySerialization=null,(n=e.call(this,null)||this)._taskHistorySerialization=t,n}return(0,a.t)(t,e),t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.taskId),2),t.set_item(p.d.toPropertyId(o.j.taskHistory),1),t},t.prototype.tryMergeNode=function(t){if(!t.baseConflictDiffLazy.get_value().get_oldObject()&&!t.baseFavoredDiffLazy.get_value().get_oldObject()){var n=t.baseFavoredDiffLazy.get_value().get_newObject().cloneForMerge();n.removeProperty(o.j.taskHistory);var r=t.baseFavoredDiffLazy.get_value().get_newObject(),i=t.baseConflictDiffLazy.get_value().get_newObject();t.baseFavoredDiffLazy=new l.q(re.p,(function(){return new re.p(n,r)})),t.baseConflictDiffLazy=new l.q(re.p,(function(){return new re.p(n,i)}))}return e.prototype.tryMergeNode.call(this,t)},t.prototype.tryMergeCustomProperty=function(e,t){if(t!==p.d.toPropertyId(o.j.taskHistory))return d.p.get_instance().traceTag(42754254,1,1,"TaskSingleNodeComplexMerge: Failed to merge TaskSingle [Id: {0}] due to a conflicting change on [PropertyId: {1}]",e.baseFavoredDiffLazy.get_value().get_newObject().get_id(),t),!1;var n=e.mergedObject,r=e.mergeableObjectUtilities;d.p.get_instance().traceTag(42754255,1,3,"TaskSingleNodeComplexMerge: Running custom merge for [ObjectId: {0}] [ClassId: {1}] [PropertyId: {2}]",n.get_id(),n.get_runtimeClassId(),t);var i=r.getPropertyString(e.baseFavoredDiffLazy.get_value().get_oldObject(),o.j.taskHistory),a=r.getPropertyString(e.baseFavoredDiffLazy.get_value().get_newObject(),o.j.taskHistory),s=r.getPropertyString(e.baseConflictDiffLazy.get_value().get_newObject(),o.j.taskHistory),l=this.MergeTaskHistory(i,a,s);if(!l)return!1;var u=n;return l.length>0?r.setPropertyString(u,o.j.taskHistory,l):u.removeProperty(o.j.taskHistory),e.mergedProperties.add(p.d.toPropertyId(o.j.taskHistory)),!0},t.prototype.MergeTaskHistory=function(e,n,r){var i=this._taskHistorySerialization.deserializeHistoryFromString(e),o=this._taskHistorySerialization.deserializeHistoryFromString(n),a=this._taskHistorySerialization.deserializeHistoryFromString(r);if(!t.IsPrefixOf(i,o))return d.p.get_instance().traceTag(42754256,1,1,"MergeTaskHistory: base must be a prefix of the favored entries"),null;if(!t.IsPrefixOf(i,a))return d.p.get_instance().traceTag(42754257,1,1,"MergeTaskHistory: base must be a prefix of the conflict entries"),null;var s=t.CombineTaskHistories(i,o,a);return this._taskHistorySerialization.serializeHistoryToString(s)},t.CreateAnInstanceWithResolvedDependencies=function(){return new t(new ie.l)},t.get_instance=function(){return t._instance.get_value()},t.CombineTaskHistories=function(e,t,n){for(var r=new S.o(ne.m,null),i=0;i<e.get_length();i++)r.add(e.get_item(i));for(i=e.get_length();i<n.get_length();i++)r.add(n.get_item(i));for(i=e.get_length();i<t.get_length();i++)r.add(t.get_item(i));return r},t.IsPrefixOf=function(e,n){var r=e.get_length();if(r>n.get_length())return!1;for(var i=0;i<r;i++)if(!t._historyRecordComparer.equals(n.get_item(i),e.get_item(i)))return n.get_item(i).recordId===e.get_item(i).recordId&&d.p.get_instance().traceTag(50357519,1,1,"MergeTaskHistory: History records with same RecordId must have all other fields equal"),!1;return!0},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t._historyRecordComparer=new le,t}(s.s);(0,r.l)(ue,"920b1c9b$TaskSingleNodeComplexMerge",s.s,[]);var ce=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 26},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(c.b.elementNodes),1),t},t.prototype.tryMergeCustomProperty=function(e,t){var n=c.b.elementNodes;if(t===p.d.toPropertyId(n)){var r=e.mergedObject,i=e.mergeableObjectUtilities,o=i.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_oldObject(),n),a=i.getPropertyObjectIds(e.baseFavoredDiffLazy.get_value().get_newObject(),n),s=i.getPropertyObjectIds(e.baseConflictDiffLazy.get_value().get_newObject(),n),l=this.MergeVectorClockObjectIds(e,o,a,s),u=r;return i.setPropertyObjectIds(u,n,l),e.mergedProperties.add(p.d.toPropertyId(n)),!0}return!1},t.prototype.MergeVectorClockObjectIds=function(e,t,n,r){return this.MergeUnorderedListOfChildNodes(m.h,t,n,r)},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(ce,"5ae3f55a$VectorClockContainerNodeComplexMerge",s.s,[]);var de=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 27},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.vectorClockValue),1),t},t.prototype.tryMergeCustomProperty=function(e,t){var n=o.j.vectorClockValue;if(t===p.d.toPropertyId(n)){var r=e.mergedObject,i=e.mergeableObjectUtilities,a=i.getPropertyUint32(e.baseFavoredDiffLazy.get_value().get_newObject(),n)||0,s=i.getPropertyUint32(e.baseConflictDiffLazy.get_value().get_newObject(),n)||0,l=this.GetMaximum(a,s),u=r;return i.setPropertyUint32(u,n,l),e.mergedProperties.add(p.d.toPropertyId(n)),!0}return!1},t.prototype.GetMaximum=function(e,t){return e>t?e:t},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(de,"e0118c5d$VectorClockNodeComplexMerge",s.s,[]);var pe=function(e){function t(){return e.call(this,null)||this}return(0,a.t)(t,e),t.prototype.get_complexMergerType=function(){return 28},t.prototype.get_defaultPropertyMergeStrategy=function(){return 0},t.prototype.evalPropertyMergeStrategies=function(){var t=e.prototype.evalPropertyMergeStrategies.call(this);return t.set_item(p.d.toPropertyId(o.j.docDefaultsId),3),t.set_item(p.d.toPropertyId(o.j.wordId),3),t.set_item(p.d.toPropertyId(o.j.metaContentNodes),5),t.set_item(p.d.toPropertyId(o.j.sectionNumber),5),t},t.CreateAnInstanceWithResolvedDependencies=function(){return new t},t.get_instance=function(){return t._instance.get_value()},t._instance=new l.q(t,t.CreateAnInstanceWithResolvedDependencies),t}(s.s);(0,r.l)(pe,"7890bbeb$WordSectionNodeComplexMerge",s.s,[]),n.d(t,{GraphNodeComplexMergeFactory:function(){return ge}});var ge=function(){function e(){}return e.prototype.createGraphNodeComplexMerge=function(e,t){switch(e.get_runtimeClassId()){case 131073:if(e.hasProperty(o.j.imageType))return x.get_instance();if(t&&t(80))return j.get_instance();break;case 1074135140:return u.get_instance();case 1074135137:return h.get_instance();case 1074135139:return _.get_instance();case 1074135138:return f.get_instance();case 1074135136:return T.get_instance();case 1074135126:return M.get_instance();case 1074135127:return P.get_instance();case 1074135142:return F.get_instance();case 1074135143:return w.get_instance();case 1074135163:return R.get_instance();case 1074135164:return E.get_instance();case 1074135124:return k.get_instance();case 1074135125:return D.get_instance();case 1074135122:return O.get_instance();case 393233:return x.get_instance();case 393234:return L.get_instance();case 393229:return B.get_instance();case 393241:return H.get_instance();case 393227:return $.get_instance();case 393271:return G.get_instance();case 393230:return W.q.get_instance();case 131140:return q.get_instance();case 1179649:return K.get_instance();case 393252:return Q.get_instance();case 393250:return X.get_instance();case 393251:return ee.get_instance();case 1074135154:return ce.get_instance();case 1074135161:return te.get_instance();case 1074135162:return ue.get_instance();case 1074135155:return de.get_instance();case 1073872968:return pe.get_instance()}return s.s.get_instance()},e}();(0,r.l)(ge,"f450554$GraphNodeComplexMergeFactory",null,[i])},2203:function(e,t,n){"use strict";n.r(t),n.d(t,{SurfaceStringTokenStringGenerator:function(){return a}});var r=n(3545),i=n(2039),o=n(423),a=function(e){function t(t){var n=e.call(this,t)||this;return n.m_init=null,n.m_init=t,n}return(0,r.t)(t,e),t.prototype.apply=function(e,t,n,r,o,a,s){null==a.val&&(a.val=e.getTokenSurfaceString(o,t)),i.z.AddTokenPropertyString(e,a.val,this.m_init.score,n,r,s)},t.c_CompiledTypeId=0,t}(i.z);(0,o.l)(a,"20e744b4$SurfaceStringTokenStringGenerator",i.z,[])},2206:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("4357ca9b$ITypingSpeedMeter"),o=n(1542),a=n(4509),s=n(363),l=n(8192),u=n(127),c=n(3545),d=function(e){function t(t){var n=e.call(this)||this;return n.newTypingSpeedValue=0,n.newTypingSpeedValue=t,n}return(0,c.t)(t,e),t.prototype.get_newTypingSpeedValue=function(){return this.newTypingSpeedValue},t}(Sys.EventArgs);(0,r.l)(d,"e4b70c9b$TypingSpeedMeterChangedEventArgs",Sys.EventArgs,[]);var p=function(){return function(){}}();(0,r.l)(p,"aff0961e$TypingSpeedMeterWindow",null,[]);var g=n(4072),h=function(){function e(e,t,n,i,o){this.MostRecentCpuMeterFrame=null,this.NumberOfKeyStrokesInFrame=0,this._timeoutForNewWindowMs=0,this._maximumNumberOfKeysInWindow=0,this._timeStampFirstKeyStrokeInWindowMs=0,this._timeStampLastKeyStrokeInWindowMs=0,this._currentParagraphElementCount=0,this._currentTimeGetter=null,this._cpuMeter=null,this._typingSpeedMeterWindowAggregator=null,this._typingSpeeedMeterValueChangedEventSource=new g.f,this._currentTimeGetter=e,this._cpuMeter=t,this._cpuMeter.add_onCpuMeterFrameAvailable(r.i(this,this.OnCpuMeterFrameAvailable,"OnCpuMeterFrameAvailable")),this._typingSpeedMeterWindowAggregator=n,this._maximumNumberOfKeysInWindow=o,this._timeoutForNewWindowMs=i}return e.prototype.add_onTypingSpeedMeterWindowAvailable=function(t){this._typingSpeeedMeterValueChangedEventSource.addHandler(e.TypingSpeedMeterWindowAvailableKey,t)},e.prototype.remove_onTypingSpeedMeterWindowAvailable=function(t){this._typingSpeeedMeterValueChangedEventSource.removeHandler(e.TypingSpeedMeterWindowAvailableKey,t)},e.prototype.OnCpuMeterFrameAvailable=function(e,t){this.MostRecentCpuMeterFrame=t.get_newCpuMeterFrame()},e.prototype.keyPressed=function(){var t=this._currentTimeGetter();if(t-this._timeStampLastKeyStrokeInWindowMs>this._timeoutForNewWindowMs&&this.ResetTypingMetrics(),this.NumberOfKeyStrokesInFrame||(this._timeStampFirstKeyStrokeInWindowMs=t),this._timeStampLastKeyStrokeInWindowMs=t,this.NumberOfKeyStrokesInFrame++,this.NumberOfKeyStrokesInFrame>=this._maximumNumberOfKeysInWindow){this._typingSpeeedMeterValueChangedEventSource.raiseEvent(e.TypingSpeedMeterWindowAvailableKey,new d(this.CalculateTypedCharactersPerMinute()),null);var n=new p;n.TS=this.CalculateTypedCharactersPerMinute(),this.MostRecentCpuMeterFrame&&(n.CP=this.MostRecentCpuMeterFrame.CP),n.EC=this._currentParagraphElementCount,this._typingSpeedMeterWindowAggregator.track(n,null),this.ResetTypingMetrics()}},e.prototype.ResetTypingMetrics=function(){this.NumberOfKeyStrokesInFrame=0,this._timeStampFirstKeyStrokeInWindowMs=0,this._timeStampLastKeyStrokeInWindowMs=0},e.prototype.CalculateTypedCharactersPerMinute=function(){return this.NumberOfKeyStrokesInFrame<2?0:Math.round(1e3*(this.NumberOfKeyStrokesInFrame-1)*60/(this._timeStampLastKeyStrokeInWindowMs-this._timeStampFirstKeyStrokeInWindowMs))},e.prototype.updateParagraphElementCount=function(e){this._currentParagraphElementCount=e},e.prototype.dispose=function(){this._cpuMeter.remove_onCpuMeterFrameAvailable(r.i(this,this.OnCpuMeterFrameAvailable,"OnCpuMeterFrameAvailable"))},e.TypingSpeedMeterWindowAvailableKey="TypingSpeedWindowAvailable",e}();(0,r.l)(h,"7ca8d559$TypingSpeedMeter",null,[i]);var _=function(){function e(e){this._currentTimeGetter=null,this._typingSpeedMeterInstance=null,this._tcs=null,this._tcs=new u.z(i),this._currentTimeGetter=e}return e.prototype.tryGetTypingSpeedMeter=function(){return this._typingSpeedMeterInstance},e.prototype.getTypingSpeedMeterAsync=function(){return this._tcs.get_task()},e.prototype.Initialize=function(e,t,n,r){return this._typingSpeedMeterInstance||(this._typingSpeedMeterInstance=new h(this._currentTimeGetter,e,t,n,r),this._tcs.setResult(this._typingSpeedMeterInstance)),this._typingSpeedMeterInstance},e}();(0,r.l)(_,"1e7aa9f8$TypingSpeedMeterProvider",null,[a.o]);var f=n(2575),m=n(1526),y=n(1323),v=n(1874),S=n(1282),I=n(5989),C=n(6382),T=n(2449);n.d(t,{TypingSpeedMeterPackage:function(){return b}});var b=function(){function e(){this._typingSpeedMeter=null}return e.prototype.get_name=function(){return"Common.App.TypingSpeedMeter"},e.prototype.init=function(){var e=this;if(f.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TypingSpeedMeterIsEnabled")){var t=C.w.get_instance().resolve(_),n=T.q.taskFromFuture(o.o,C.w.get_instance().resolveFuture(o.o));n.CW((function(o){var a=n.get_result().getCpuMeterAsync(),s=new S.z(f.AFrameworkApplication.appSettingsManager.getIntAppSetting("TypingSpeedMeterWindowSamplingPercent",0)/100),l=new v.m(p,r.i(s,s.shouldBeInSample,"shouldBeInSample")),u=y.n.$$(p).getAnInstance(12,1,l,!0,null),c=f.AFrameworkApplication.appSettingsManager.getIntAppSetting("TypingSpeedMeterWindowTimeoutMs",5e3),d=f.AFrameworkApplication.appSettingsManager.getIntAppSetting("TypingSpeedMeterMaxKeystrokesPerWindow",5);a.CWR(i,(function(n){return e._typingSpeedMeter=t.Initialize(a.get_result(),u,c,d)}))}))}},e.prototype.dispose=function(){this._typingSpeedMeter&&this._typingSpeedMeter.dispose()},e.prototype.configure=function(e){e.register(_).as(a.o).singleInstance().usingFactory((function(){return new _(I.g.getTickCount)}))},e.main=function(){m.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(b,"3e5f7463$TypingSpeedMeterPackage",null,[s.u,l.s])},2259:function(e,t,n){"use strict";n.d(t,{a:function(){return i}});var r=n(423),i=function(){return function(e,t){this.paraIdMerged=null,this.textIdMerged=null,null!=e&&(this.paraIdMerged=e),null!=t&&(this.textIdMerged=t)}}();(0,r.l)(i,"535dd915$MergeRemoveParaData",null,[])},2298:function(e,t,n){"use strict";n.d(t,{d:function(){return r}});var r=(0,n(423).y)("7ae431a6$IPeopleInfoProvider")},2347:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(363),o=n(8192),a=function(){return function(){this.onSuccess=null,this.onFailure=null,this.skipCheckFile=!1}}();(0,r.l)(a,"537c655$ExecuteRefreshFilenameData",null,[]);var s=function(){return function(){this.requestedName=null,this.onSuccess=null,this.onFailure=null}}();(0,r.l)(s,"f8b6417f$ExecuteRenameFileData",null,[]);var l=n(3518),u=n(5377),c=n(2899),d=n(1443),p=n(8352),g=n(6716),h=n(3362),_=n(9910),f=n(8996),m=function(){function e(){}return e.deserializeResponse=function(e){try{return f.x.deserialize(e)}catch(e){}return null},e}();(0,r.l)(m,"e5c8ea22$ARenameFileResponseSerializeHelper",null,[]);var y=n(2575),v=n(3096),S=n(6382),I=n(6378),C=function(){function e(e,t,n,r,i){this._actionManager=null,this._clientRequestManager=null,this._coauthManager=null,this._appSettingsManager=null,this._failedCanary=!1,this._lazyHostPostmessenger=null,this._rtc=null,this._pendingRenameNotification=!1,this._actionManager=e,this._clientRequestManager=t,this._coauthManager=n,this._lazyHostPostmessenger=r,this._appSettingsManager=i}return e.prototype.init=function(e,t){t&&e.resolveFuture(g.w).execute(r.i(this,this.AwaitRtc,"AwaitRtc"))},e.prototype.AwaitRtc=function(e){var t=this,n=e.getInstanceAsRealtimeChannelBasicAsync();n.CW((function(e){t._rtc=n.get_result(),t._pendingRenameNotification&&(t._rtc.sendUpdateNotification(2,null,!0),t._pendingRenameNotification=!1),t._rtc.add_updateNotificationReceived((function(e,n){2===n.get_type()&&t.get_ActionManager().processAction(_.b.fileNameUpdate,2,null)})),t._rtc.add_connectionStateChanged((function(e,n){2===n.get_newState()&&t.get_ActionManager().processAction(_.b.fileNameUpdate,2,null)})),2===t._rtc.get_connectionState()&&t.get_ActionManager().processAction(_.b.fileNameUpdate,2,null)}))},e.prototype.executeRefreshFilename=function(e){this.ExecuteRefreshFilenameInternal(e,!0)},e.prototype.ExecuteRefreshFilenameInternal=function(t,n){var i=this.BuildRefreshFilenameRequestUri(t.skipCheckFile),o={};o[e.ContentHeader]=e.ContentHeaderValue,this.get_RequestManager().addRequest(i,2,"",o,!1,2,r.i(this,this.OnRefreshFilenameSuccess,"OnRefreshFilenameSuccess"),n?r.i(this,this.OnRefreshFilenameFailureRetry,"OnRefreshFilenameFailureRetry"):r.i(this,this.OnRefreshFilenameFailureNoRetry,"OnRefreshFilenameFailureNoRetry"),t,null,!1,null,null,null,null,!1,null,!1)},e.prototype.OnRefreshFilenameSuccess=function(e){this._failedCanary=!1;var t=e.get_data().responseData,n=m.deserializeResponse(t);e.get_data().state.onSuccess(n,this._lazyHostPostmessenger.get_value())},e.prototype.OnRefreshFilenameFailureRetry=function(e){5!==e.get_data().status||this._failedCanary?this.OnRefreshFilenameFailureNoRetry(e):(this._failedCanary=!0,this.ExecuteRefreshFilenameInternal(e.get_data().state,!1))},e.prototype.OnRefreshFilenameFailureNoRetry=function(e){e.get_data().state.onFailure(-1)},e.prototype.executeRenameFile=function(e){this.ExecuteRenameFileInternal(e,!0)},e.prototype.ExecuteRenameFileInternal=function(t,n){var i=this.BuildRenameFileRequestUri(),o={};o[e.ContentHeader]=e.ContentHeaderValue,o[e.HandlerNameParam]=I.l.urlKeyValueEncode(t.requestedName),this.get_RequestManager().addRequest(i,2,"",o,!1,2,r.i(this,this.OnRenameFileSuccess,"OnRenameFileSuccess"),n?r.i(this,this.OnRenameFileFailureRetry,"OnRenameFileFailureRetry"):r.i(this,this.OnRenameFileFailureNoRetry,"OnRenameFileFailureNoRetry"),t,null,!1,null,null,null,null,!1,null,!1)},e.prototype.BuildRenameFileRequestUri=function(){return this.BuildServiceUri()},e.prototype.BuildRefreshFilenameRequestUri=function(t){var n=this.BuildServiceUri();return n=v.n.addOrReplaceParameterValue(n,e.HandlerUpdateParam,t?"2":"1",!1)},e.prototype.BuildServiceUri=function(){var t=(this._appSettingsManager.get_value().get_appSettings().RenameWebServiceBase||"")+e.HandlerName;return t=v.n.addOrReplaceParameterValue(t,e.HandlerQuerySigParam,I.l.urlKeyValueEncode(y.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),!1),this.get_CoauthManager()&&this.get_CoauthManager().get_isFileCoauthorable()&&(t=v.n.addOrReplaceParameterValue(t,e.HandlerSharedLockParam,"1",!1)),t},e.prototype.OnRenameFileSuccess=function(e){this._failedCanary=!1;var t=e.get_data().responseData,n=m.deserializeResponse(t);e.get_data().state.onSuccess(n,this._lazyHostPostmessenger.get_value()),this.NotifyOtherUsersAboutFilenameChange()},e.prototype.NotifyOtherUsersAboutFilenameChange=function(){this._rtc?this._rtc.sendUpdateNotification(2,null,!0):this._pendingRenameNotification=!0},e.prototype.OnRenameFileFailureRetry=function(e){5!==e.get_data().status||this._failedCanary?this.OnRenameFileFailureNoRetry(e):(this._failedCanary=!0,this.ExecuteRenameFileInternal(e.get_data().state,!1))},e.prototype.OnRenameFileFailureNoRetry=function(e){e.get_data().state.onFailure(-1)},e.prototype.get_ActionManager=function(){return this._actionManager.get_value()},e.prototype.get_RequestManager=function(){return this._clientRequestManager.get_value()},e.prototype.get_CoauthManager=function(){return this._coauthManager.get_value()},e.get_instance=function(){return e._instance||(e._instance=e.GetAnInstanceWithResolvedDependecies())},e.GetAnInstanceWithResolvedDependecies=function(){return new e(new h.q(l.v,(function(){return y.AFrameworkApplication.get_theActionManager()})),new h.q(u.u,(function(){return y.AFrameworkApplication.theClientRequestManager})),new h.q(c.w,(function(){return y.AFrameworkApplication.coauthManager})),new h.q(p.i,(function(){return S.w.get_instance().resolve(p.i)})),new h.q(d.x,(function(){return y.AFrameworkApplication.appSettingsManager})))},e.ContentHeader="Content-Type",e.ContentHeaderValue="application/json; charset=utf-8",e.HandlerName="renamehandler.ashx",e.HandlerQuerySigParam="qs",e.HandlerNameParam="n",e.HandlerSharedLockParam="sl",e.HandlerUpdateParam="u",e._instance=null,e}();(0,r.l)(C,"3afd9697$ExecuteRenameFileHandler",null,[]);var T=function(){function e(){this._container=null,this._executeRenameFileHandler=C.get_instance()}return e.prototype.get_name=function(){return"Common.App.RenameFile.RenameExecutor"},e.prototype.configure=function(e){this._container=e},e.prototype.init=function(){y.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(r.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){if(y.AFrameworkApplication.isRenameSupported()){var e=y.AFrameworkApplication.renameInCoauthSessionWithRenameCapableClientsIsEnabled;C.get_instance().init(this._container,e),y.AFrameworkApplication.executeRenameFile=r.i(this,this.executeRenameFile,"executeRenameFile"),y.AFrameworkApplication.executeRefreshFilename=r.i(this,this.executeRefreshFilename,"executeRefreshFilename")}},e.prototype.executeRenameFile=function(e,t,n){var r=new s;r.requestedName=e,r.onSuccess=t,r.onFailure=n,this._executeRenameFileHandler.executeRenameFile(r)},e.prototype.executeRefreshFilename=function(e,t,n){var r=new a;r.onSuccess=e,r.onFailure=t,r.skipCheckFile=n,this._executeRenameFileHandler.executeRefreshFilename(r)},e.prototype.dispose=function(){},e}();(0,r.l)(T,"763b2a2f$PackageManager",null,[i.u,o.s]);var b=n(1526);n.d(t,{Program:function(){return A}});var A=function(){function e(){}return e.main=function(){b.o.get_instance().registerPackage(new T,0,!1)},e}();(0,r.l)(A,"79c84692$Program",null,[])},2407:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});var r=(0,n(423).y)("8cd86e33$IPresenceConverter")},2433:function(e,t,n){"use strict";n.d(t,{p:function(){return r}});var r=(0,n(423).y)("9cc0f5a0$IMenuItemFactory")},2494:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var r=(0,n(423).y)("39e85152$IErrorDialog")},2536:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(1542),o=(0,r.y)("63bc31dc$ICpuMeterMonitor"),a=n(363),s=n(8192),l=n(163),u=n(3545),c=function(e){function t(t,n){var r=e.call(this)||this;return r.thresholdValue=0,r.actualValue=0,r.thresholdValue=t,r.actualValue=n,r}return(0,u.t)(t,e),t.prototype.get_thresholdValue=function(){return this.thresholdValue},t.prototype.get_actualValue=function(){return this.actualValue},t}(Sys.EventArgs);(0,r.l)(c,"5fa22b12$CpuMeterMonitorThresholdExceededEventArgs",Sys.EventArgs,[]);var d=n(4072),p=function(){function e(){this._cpumeterAverageThreshold=0,this._cpuMeterRollingAverageFramesCount=0,this._cpuMeter=null,this._cpuMeterQueue=[],this._eventSource=new d.f}return e.prototype.get_CpuMeterQueue=function(){return this._cpuMeterQueue},e.prototype.init=function(e,t,n){this._cpuMeter=e,this._cpumeterAverageThreshold=t,this._cpuMeterRollingAverageFramesCount=n,this._cpuMeter.add_onCpuMeterFrameAvailable(r.i(this,this.OnCpuMeterFrameAvailable,"OnCpuMeterFrameAvailable")),this.add_onCpuPercentThresholdExceeded(r.i(this,this.CpuPercentThresholdExceeded,"CpuPercentThresholdExceeded"))},e.prototype.OnCpuMeterFrameAvailable=function(e,t){t.get_newCpuMeterFrame()&&(Array.enqueue(this._cpuMeterQueue,t.get_newCpuMeterFrame().CP),this._cpuMeterQueue.length>this._cpuMeterRollingAverageFramesCount&&(Array.dequeue(this._cpuMeterQueue),this.CheckCpuMeterPercentThreshold()))},e.prototype.CheckCpuMeterPercentThreshold=function(){for(var t=this._cpuMeterQueue.length,n=0,r=0;r<t;r++){var i=Array.dequeue(this._cpuMeterQueue);n+=i,Array.enqueue(this._cpuMeterQueue,i)}var o=n/t;o>this._cpumeterAverageThreshold&&this._eventSource.raiseEvent(e.CpuPercentThresholdExceededEventId,new c(this._cpumeterAverageThreshold,o),null)},e.prototype.CpuPercentThresholdExceeded=function(e,t){l.r.traceTag(16782158,306,50,"CpuMeter KPI Average Threshold Exceeded: [{0}]",this.CreateDictionaryForLogging(t.get_thresholdValue(),t.get_actualValue()))},e.prototype.add_onCpuPercentThresholdExceeded=function(t){this._eventSource.addHandler(e.CpuPercentThresholdExceededEventId,t)},e.prototype.remove_onCpuPercentThresholdExceeded=function(t){this._eventSource.removeHandler(e.CpuPercentThresholdExceededEventId,t)},e.prototype.CreateDictionaryForLogging=function(e,t){var n={};return n.ThresholdValue=e,n.ActualValue=t,n},e.CpuPercentThresholdExceededEventId="CPTTE",e}();(0,r.l)(p,"4857ac75$CpuMeterMonitor",null,[o]);var g=n(8862),h=n(127),_=n(2575),f=n(9462),m=function(){return function(){}}();(0,r.l)(m,"aa670cf3$CpuMeterFrame",null,[]);var y=function(e){function t(t){var n=e.call(this)||this;return n.newCpuMeterFrame=null,n.newCpuMeterFrame=t,n}return(0,u.t)(t,e),t.prototype.get_newCpuMeterFrame=function(){return this.newCpuMeterFrame},t}(Sys.EventArgs);(0,r.l)(y,"e8fdc5e1$CpuMeterFrameAvailableEventArgs",Sys.EventArgs,[]);var v=function(){return function(){}}();(0,r.l)(v,"cd8a9d15$TaskItemInfo",null,[]);var S=n(5656),I=n(2953),C=n(1158),T=function(){function e(e,t,n,r,i,o){this._currentTimeGetter=null,this._exposeTaskDetailsIsEnabled=!1,this._counter=0,this._pendingTaskItem=null,this._startTimeThisFrame=0,this._runWithinFrameMs=0,this._running=!1,this.longestTopLevelTasks=null,this.cpuMeterFrameAggregator=null,this.functionCallAggregator=null,this.functionMaxAggregator=null,this._isOriginalWindowFuncSet=!1,this._originalSetTimeout=null,this._eventTraceFlag=0,this._interestingEvents=0,this._onCpuMeterEventSource=new d.f,this._taskEventHandlers=[],this._currentTimeGetter=e,this.longestTopLevelTasks=t,this.functionCallAggregator=n,this.cpuMeterFrameAggregator=r,this.functionMaxAggregator=i,_.AFrameworkApplication.appSettingsManager&&_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WrapSetTimeoutForTelemetryIsEnabled")&&this.KeepOriginalWindowFunc(),this._exposeTaskDetailsIsEnabled=o}return e.prototype.add_onCpuMeterFrameAvailable=function(t){this._onCpuMeterEventSource.addHandler(e.CpuMeterValueChangedEventKey,t)},e.prototype.remove_onCpuMeterFrameAvailable=function(t){this._onCpuMeterEventSource.removeHandler(e.CpuMeterValueChangedEventKey,t)},e.prototype.profileTopLevelTask=function(e,t,n,r){var i=r?r.get_priority():6;this.Start(t,i),e(),this.Stop(t,r)},e.prototype.profileFunction=function(e,t){var n=this._currentTimeGetter();e();var r=this._currentTimeGetter()-n;this.functionCallAggregator.aggregate(r,t),this.functionMaxAggregator.track(r,t)},e.prototype.onTaskAdded=function(e){var t=new v;t.TN=e.get_loggingName(),t.TP=e.get_priority(),this.RaiseTaskEventWithFilter(1,t)},e.prototype.onBeforeProcess=function(){},e.prototype.onAfterProcess=function(){},e.prototype.markInterestingEvent=function(e){this._interestingEvents=this._interestingEvents|e},e.prototype.Start=function(e,t){if(!this._counter){var n=this.IsUserTyping(e);n&&this.markEventTraceFlag(1),this._pendingTaskItem=new v,this._pendingTaskItem.TN=e,this._pendingTaskItem.TP=t,this._pendingTaskItem.ST=(new Date).toISOString(),this._pendingTaskItem.STS=S.s.roundNumber(this._currentTimeGetter(),2),n?this._pendingTaskItem.UI=1:this.IsMouseEvent(e)?this._pendingTaskItem.UI=2:this._pendingTaskItem.UI=0}this._counter++},e.prototype.markEventTraceFlag=function(e){this._eventTraceFlag=this._eventTraceFlag|e},e.prototype.clearEventTraceFlag=function(e,t){this._eventTraceFlag=e?0:this._eventTraceFlag&~t},e.prototype.Stop=function(e,t){var n=0;(this._counter--,this._counter<=0&&this._pendingTaskItem)&&(n=this._currentTimeGetter()-this._pendingTaskItem.STS,this._runWithinFrameMs+=n,this.longestTopLevelTasks.aggregate(n,e),this.IsUserTyping(e)&&this.clearEventTraceFlag(!1,1),this._pendingTaskItem.TRT=S.s.roundNumber(n,2),t&&(this._pendingTaskItem.TQT=t.get_queueTick(),this._pendingTaskItem.TDT=t.get_lastDelayTick()),this._exposeTaskDetailsIsEnabled&&this.RaiseTaskEventWithFilter(0,this._pendingTaskItem),this._counter=0);e.indexOf(f.p.typingProcessEvent)>=0&&this.markInterestingEvent(2),e.indexOf(f.p.replicationEvent)>=0&&this.markInterestingEvent(4),1==(1&this._eventTraceFlag)&&this.markInterestingEvent(1),2==(2&this._eventTraceFlag)&&this.markInterestingEvent(8)},e.prototype.SnapFrame=function(){var t=this._currentTimeGetter()-this._startTimeThisFrame,n=this._runWithinFrameMs/t,r=S.s.roundNumber(100*n,2),i=new m;i.CP=r,i.II=this._interestingEvents;var o=this.longestTopLevelTasks.getData();C.j.count(o)&&(i.LRT=o);var a=this.functionCallAggregator.getData();return C.j.count(a)&&(i.FP=a),this.cpuMeterFrameAggregator.track(i,null),this._onCpuMeterEventSource.raiseEvent(e.CpuMeterValueChangedEventKey,new y(i),null),this.StartFrame(),i},e.prototype.StartFrame=function(){this.longestTopLevelTasks.reset(),this.functionCallAggregator.reset(),this._counter=0,this._runWithinFrameMs=0,this._startTimeThisFrame=this._currentTimeGetter(),this._interestingEvents=0,this._pendingTaskItem=null},e.prototype.run=function(){this._running?this.SnapFrame():(this.StartFrame(),this._running=!0),this._originalSetTimeout?this._originalSetTimeout(r.i(this,this.run,"run"),e.MsPerFrame):window.setTimeout(r.i(this,this.run,"run"),e.MsPerFrame)},e.prototype.addCpuMeterTaskEventWithFilter=function(e,t,n){var r=new Array(2);r[0]=t,r[1]=n,this._taskEventHandlers[e]||(this._taskEventHandlers[e]=[]),this._taskEventHandlers[e].push(r)},e.prototype.RaiseTaskEventWithFilter=function(e,t){var n=this._taskEventHandlers[e];if(!I.p.isNullOrEmpty(n))for(var r=0;r<n.length;r++){var i=n[r],o=i[0],a=i[1];o&&!o(t)||a(t)}},e.prototype.KeepOriginalWindowFunc=function(){if(!this._isOriginalWindowFuncSet){var e=window.setTimeout;this._originalSetTimeout=function(t,n){return e(t,n)},this._isOriginalWindowFuncSet=!0}},e.prototype.IsUserTyping=function(e){return e.startsWith("key")||e.startsWith("input")},e.prototype.IsMouseEvent=function(e){return e.startsWith("click")||e.startsWith("mouse")||e.startsWith("pointer")},e.MsPerFrame=1e3,e.CpuMeterValueChangedEventKey="OnCpuMeterFrameAvailable",e}();(0,r.l)(T,"79536459$CpuMeter",null,[g.v]);var b=function(){function e(e){this._currentTimeGetter=null,this._cpuMeterInstance=null,this._tcs=null,this._tcs=new h.z(g.v),this._currentTimeGetter=e}return e.prototype.tryGetCpuMeter=function(){return this._cpuMeterInstance},e.prototype.getCpuMeterAsync=function(){return this._tcs.get_task()},e.prototype.Initialize=function(e,t,n,r,i){return this._cpuMeterInstance||(this._cpuMeterInstance=new T(this._currentTimeGetter,e,t,n,r,i),this._tcs.setResult(this._cpuMeterInstance)),this._cpuMeterInstance},e}();(0,r.l)(b,"73766338$CpuMeterProvider",null,[i.o]);var A=n(6414),M=function(){return function(){this.CT=0,this.MT=0,this.TT=0,this.AT=0}}();(0,r.l)(M,"5e7e6753$ProfileInformation",null,[]);var P=function(){function e(){this._functionProfiles={}}return e.prototype.aggregate=function(e,t){var n;t in this._functionProfiles?n=this._functionProfiles[t]:(n=new M,this._functionProfiles[t]=n),n.CT++,n.MT=e>n.MT?e:n.MT,n.TT+=e},e.prototype.getData=function(){var e=this._functionProfiles;for(var t in e){var n={key:t,value:e[t]}.value;n.AT=S.s.roundNumber(n.TT/n.CT,2),n.MT=S.s.roundNumber(n.MT,2),n.TT=S.s.roundNumber(n.TT,2)}return this._functionProfiles},e.prototype.reset=function(){this._functionProfiles={}},e}();(0,r.l)(P,"e72af24d$FunctionCallAggregator",null,[A.k.$$(Number)]);var F=n(1526),w=n(1323),R=function(){function e(e){this._count=0,this._values=new Array(0),this._descriptions=new Array(0),this._count=e}return e.prototype.FindIndexOfMin=function(){for(var e=0,t=0;t<this._values.length;t++)this._values[t]<this._values[e]&&(e=t);return e},e.prototype.aggregate=function(e,t){if(e=S.s.roundNumber(e,2),this._values.length<this._count)return Array.add(this._values,e),void Array.add(this._descriptions,t);var n=this.FindIndexOfMin();e>this._values[n]&&(this._values[n]=e,this._descriptions[n]=t)},e.prototype.getData=function(){return this._values.length?{Vals:this._values,Desc:this._descriptions}:null},e.prototype.reset=function(){this._values=new Array(0),this._descriptions=new Array(0)},e}();(0,r.l)(R,"fab030c7$MaxDataAggregator",null,[A.k.$$(Number)]);var E=n(1874),k=n(1282),D=n(5989),O=n(6382),U=n(4097);n.d(t,{CpuMeterPackage:function(){return x}});var x=function(){function e(){}return e.prototype.get_name=function(){return"Common.App.CpuMeter"},e.prototype.configure=function(e){e.register(b).as(i.o).singleInstance().usingFactory((function(){return new b(D.g.getTickCount)})),e.register(p).as(o).singleInstance().usingFactory((function(){return new p}))},e.prototype.init=function(){var t=_.AFrameworkApplication.appSettingsManager;if(t.getBooleanAppSetting("CpuMeterIsEnabled")){var n=O.w.get_instance().resolve(b);U.m.get_instance().get_appIsInteractiveTask().CW((function(r){e.InitializeCpuMeter(t,n)}))}},e.prototype.dispose=function(){},e.InitializeCpuMeter=function(e,t){var n=new R(5),i=new k.z(e.getIntAppSetting("CpuMeterFrameSamplingPercent",0)/100),a=new E.m(m,r.i(i,i.shouldBeInSample,"shouldBeInSample")),s=w.n.$$(m).getAnInstance(9,1,a,!0,null),u=w.n.$$(Number).getAnInstance(10,5,new P,!0,null),c=t.Initialize(n,new P,s,u,e.getBooleanAppSetting("CPUMeterExposeTaskDetailsIsEnabled"));if(c.run(),e.getBooleanAppSetting("CpuMeterMonitorIsEnabled")){var d=O.w.get_instance().resolve(o),p=e.getDoubleAppSetting("CpuMeterAverageCpuPercentThreshold",80),g=e.getIntAppSetting("CpuMeterRollingAverageFramesCount",15);d.init(c,p,g)}l.r.traceTag(16827671,306,50,"Initializing CpuMeter")},e.main=function(){F.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(x,"2d1c7763$CpuMeterPackage",null,[a.u,s.s])},2954:function(e,t,n){"use strict";n.d(t,{b:function(){return c}});var r=n(3545),i=n(8027),o=n(4551),a=n(2575),s=n(4764),l=n(7921),u=n(423),c=function(e){function t(t,n){return e.call(this,t,!1,n)||this}return(0,r.t)(t,e),t.prototype.get_isModalDialog=function(){return!1},t.prototype.get_fullDialogFocusId=function(){return l.h.dialogFocusId+"/modeless"},t.prototype.get_lastTop=function(){return null},t.prototype.set_lastTop=function(e){return e},t.prototype.get_lastLeft=function(){return null},t.prototype.set_lastLeft=function(e){return e},t.prototype.initializeAndShow=function(t,n,r){this._useReactDialog&&(r.isModal=!1),e.prototype.initializeAndShow.call(this,t,n,r)},t.prototype.hide=function(){this._divMessageBox&&(this.set_lastTop(this.GetNumber(this._divMessageBox.style.top)),this.get_lastTop()&&this.set_lastTop(this.get_lastTop()-l.h.get_posTop()),a.AFrameworkApplication.get_isRtl()?this.set_lastLeft(this.GetNumber(this._divMessageBox.style.right)):this.set_lastLeft(this.GetNumber(this._divMessageBox.style.left)),this.get_lastLeft()&&this.set_lastLeft(this.get_lastLeft()-l.h.get_posLeft()),a.AFrameworkApplication.get_activeFrame().get_theF6Manager().deactivateFocus(o.AFrame.modelessDialogFocusId),e.prototype.hide.call(this))},t.prototype.AddF6Binding=function(){var e=a.AFrameworkApplication.get_activeFrame().get_theF6Manager(),t=a.AFrameworkApplication.get_activeFrame().get_theFocusManager();e.addF6(this.get_fullDialogFocusId(),!0),e.addF6KeyBindings(this.get_fullDialogFocusId()),t.getScope(this.get_fullDialogFocusId()).parent=o.AFrame.mainAppFocusId},t.prototype.addFocusScope=function(){s.FocusManager.usable()&&(e.prototype.addFocusScope.call(this),this.AddF6Binding(),a.AFrameworkApplication.get_activeFrame().get_theF6Manager().activateFocus(o.AFrame.modelessDialogFocusId))},t.prototype.removeFocusScope=function(){if(s.FocusManager.usable()&&!a.AFrameworkApplication.isShuttingDown){var e=s.FocusManager.instance();e.popScope(this.get_fullDialogFocusId(),!0);var t=e.getRegion(this.get_fullDialogFocusId());t&&t.listing.trySetCurrentElement(null),e.removeScope(this.get_fullDialogFocusId())}},t.prototype.reSizeDialog=function(){this.sizeAndPositionDialog()},t.prototype.sizeAndPositionDialog=function(){if(this.get_lastLeft()&&this.get_lastTop()){var t=void 0,n=void 0;t=l.h.get_posTop()+this.get_lastTop(),n=l.h.get_posLeft()+this.get_lastLeft(),t+i.o._defaultHeight>l.h.get_pageHeight()&&(t=l.h.get_pageHeight()-i.o._defaultHeight),n+i.o._defaultWidth>l.h.get_pageWidth()&&(n=l.h.get_pageWidth()-i.o._defaultWidth),e.prototype.sizeAndPositionDialogWorker.call(this,t,n)}else e.prototype.sizeAndPositionDialog.call(this)},t.prototype.GetNumber=function(e){if(!e)return null;var t=e;if(t.endsWith("px")&&(t=t.substring(0,t.length-2)),l.h.isNumber(t)){var n=parseInt(t);return n||(n=1),n}return null},t}(i.o);(0,u.l)(c,"1e3d4721$ModelessCustomDialog",i.o,[])},2977:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var r=n(6039),i=n(423),o=function(){function e(t){if(this.numOfStrings=0,this.style=0,this.rawBytes=null,this.trie=null,this.trieId2StringTableId_StartIndex=0,this.stringId2StringStartIndex_StartIndex=0,this.stringId2StringLength_StartIndex=0,this.numOfBytesInCharByteData=0,this.charByteData_StartIndex=0,t){this.rawBytes=t;var n=0;if(t.readInt(n,4)!==e.c_MAGIC_NUMBER)throw Error.argument("bytes","Input does not represent a string table");switch(n+=4,this.numOfStrings=t.readInt(n,4),n+=4,this.style=t.readInt(n,4),n+=4,this.style){case 0:var r=1===t.readInt(n,4);n+=4,r||(this.trieId2StringTableId_StartIndex=n,n+=4*this.numOfStrings);var i=t.readInt(n,4);n+=4,this.trie=this.parseTrie(t,n),n+=i;break;case 4:this.stringId2StringStartIndex_StartIndex=n,n+=4*this.numOfStrings,this.stringId2StringLength_StartIndex=n,n+=4*this.numOfStrings,this.numOfBytesInCharByteData=t.readInt(n,4),n+=4,this.charByteData_StartIndex=n,n+=this.numOfBytesInCharByteData;break;default:throw Error.argument("bytes")}}}return e.prototype.parseTrie=function(e,t){return new r.h(e,t)},e.c_MAGIC_NUMBER=1025118440,e}();(0,i.l)(o,"2de3e4b7$StringTableInit",null,[])},3040:function(e,t,n){"use strict";var r=n(3234),i=n(423),o=(0,i.y)("49ddedfa$IWordPresenceIp"),a=n(9402),s=n(3996);n.d(t,{t:function(){return l}});var l=function(){function e(e,t,n,r,i,o,a,s){this._objectSpace=null,this._paragraphWordIdMapping=null,this._paragraphId=null,this._translator=null,this._wordPresenceCpFactory=null,this.$$pf_WordId=0,this.$$pf_ShapeId=0,this.$$pf_PresenceCp=null,this.$$pf_ParagraphVersionRep=0,this._paragraphWordIdMapping=e,this._objectSpace=o,this._translator=i,this._wordPresenceCpFactory=a,this.set_wordId(t),this.set_shapeId(s),this.set_paragraphVersionRep(n),this.set_presenceCp(a.create(this,r,i,o))}return e.prototype.clone=function(){return new e(this._paragraphWordIdMapping,this.get_wordId(),this.get_paragraphVersionRep(),this.get_presenceCp().get_wordTextOffset(),this._translator,this._objectSpace,this._wordPresenceCpFactory,this.get_shapeId())},e.prototype.get_wordId=function(){return this.$$pf_WordId},e.prototype.set_wordId=function(e){return this.$$pf_WordId=e,e},e.prototype.get_paragraphId=function(){return this._paragraphId?this._paragraphId:this._paragraphWordIdMapping.getParagraphNodeByWordId(this.get_wordId())},e.prototype.get_shapeId=function(){return this.$$pf_ShapeId},e.prototype.set_shapeId=function(e){return this.$$pf_ShapeId=e,e},e.prototype.onPresenceMatchedForRendering=function(){this._paragraphId||(this._paragraphId=this.get_paragraphId(),this.get_presenceCp().onPresenceMatchedForRendering())},e.prototype.get_presenceCp=function(){return this.$$pf_PresenceCp},e.prototype.set_presenceCp=function(e){return this.$$pf_PresenceCp=e,e},e.prototype.get_paragraphVersionRep=function(){return this.$$pf_ParagraphVersionRep},e.prototype.set_paragraphVersionRep=function(e){return this.$$pf_ParagraphVersionRep=e,e},e.prototype.isValid=function(){return this.get_presenceCp().get_cp()>=0},e.prototype.getData=function(){var e=this.get_presenceCp().get_wordTextOffset();return e?new s.e(0,this.get_wordId(),this.get_paragraphVersionRep(),e,null,null,null,0,this.get_shapeId()):null},e.CreateFromPlainData=function(t,n,r,i,o){return n?new e(n,parseInt(t.paraIdStart),t.textIdStart,t.offsetStart,r,i,o,t.shapeId):null},e}();(0,i.l)(l,"119a7393$WordPresenceIp",null,[r.n,a.v.$$(r.n),o])},3127:function(e,t,n){"use strict";var r=n(7597),i=n(423),o=function(){function e(){}return e.isSupported=function(t){for(var n=0;n<e.SupportedVersions.length;n++)if(t===e.SupportedVersions[n])return!0;return!1},e.SupportedVersions=[1],e}();(0,i.l)(o,"7f66e801$RTTDataVersion",null,[]);var a=n(8996),s=n(8816),l=function(){function e(){}return e.validateAnchorV1=function(e){if("number"!=typeof e.RK)return!1;if("number"!=typeof e.DK)return!1;var t=!1,n=!1,r=!1,i=!1;switch(e.RK){case 0:t=!0,r=!0;break;case 1:t=!0,r=!0,n=!0,i=!0;break;case 2:if(null!=e.PE&&"number"!=typeof e.PE)return!1;t=!0;break;case 4:t=!0;break;case 3:t=!0,r=!0;break;case 5:t=!0,n=!0;break;default:return!1}return(!t||"number"==typeof e.PS&&"number"==typeof e.TS)&&(!!(!r||"object"==typeof e.OS&&e.OS&&s.CpDataHelper.validateVersionedCpData(e.OS))&&((!n||"number"==typeof e.PE&&"number"==typeof e.TE)&&!!(!i||"object"==typeof e.OE&&e.OE&&s.CpDataHelper.validateVersionedCpData(e.OE))))},e}();(0,i.l)(l,"a2bb856b$AnchorDataHelper",null,[]);var u=function(){function e(){}return e.CheckAndSerialize=function(t){var n;try{n=a.x.serialize(t)}catch(e){n=String.format("Failed to JSON-serialize payload : {0}",e)}return n.length>e.MaxPayloadSizeInCharacters&&(n=String.format("Payload exceeds maximum length: {0} > {1}, not logging",n.length,e.MaxPayloadSizeInCharacters)),n},e.validateDataV1=function(t,n){return n.val="","number"!=typeof t.I?(n.val="Invalid PacketId Type",!1):"number"!=typeof t.O?(n.val="Invalid Operation Type",!1):"string"!=typeof t.A?(n.val="Invalid ClientId Type",!1):"object"!=typeof t.AN?(n.val="Invalid Anchor Object Type",!1):t.AN?l.validateAnchorV1(t.AN)?!t.O&&t.AN.RK?(n.val="Invalid RangeKind:"+t.AN.RK+" for Caret",!1):2!==t.O||e.ValidateTypingDataV1(t)?3!==t.O||e.ValidateAddParaDataV1(t)?6!==t.O||e.ValidateMergeRemoveParaDataV1(t)?4!==t.O||e.ValidateSplitParaDataV1(t)?7!==t.O||e.ValidateSymbolDataV1(t)?null==t.ISS||"number"==typeof t.ISS||(n.val="invalid StrictlySequentialId",!1):(n.val="Invalid SymbolData",!1):(n.val="Invalid SplitParaData",!1):(n.val="Invalid RemoveParaData",!1):(n.val="Invalid AddParaData",!1):(n.val="Invalid TypingData",!1):(n.val="Invalid AnchorObject: "+e.CheckAndSerialize(t.AN)+", Client: "+t.C,!1):(n.val="Null AnchorObject",!1)},e.ValidateTypingDataV1=function(e){return"number"==typeof e.TF&&(("undefined"==typeof e.TX||"string"==typeof e.TX)&&(1===e.AN.RK||!e.AN.RK))},e.ValidateAddParaDataV1=function(e){return!("object"!=typeof e.AP||!e.AP)&&("number"==typeof e.AP.TFA&&("number"==typeof e.AP.PN&&("number"==typeof e.AP.TN&&2===e.AN.RK)))},e.ValidateMergeRemoveParaDataV1=function(e){return!("object"!=typeof e.MP||!e.MP)&&("number"==typeof e.MP.PM&&("number"==typeof e.MP.TM&&5===e.AN.RK))},e.ValidateSplitParaDataV1=function(e){return!("object"!=typeof e.SP||!e.SP)&&("number"==typeof e.SP.PA&&("number"==typeof e.SP.TA&&("number"==typeof e.SP.PB&&("number"==typeof e.SP.TBS&&(3===e.AN.RK&&(e.AN.PS===e.SP.PA||e.AN.PS===e.SP.PB))))))},e.ValidateSymbolDataV1=function(e){return!("object"!=typeof e.SPS||!e.SPS)&&("string"==typeof e.SPS.SF&&"boolean"==typeof e.SPS.SL)},e.validateVersionData=function(e){return"number"==typeof e.V},e.MaxPayloadSizeInCharacters=8e3,e}();(0,i.l)(u,"adc4ea79$RTTDataHelper",null,[]);var c=n(1822),d=n(5669),p=n(2259),g=n(7154),h=n(1860),_=function(){return function(e,t){this.symbolFont=null,this.symbolLegacy=null,e&&(this.symbolFont=e),null!=t&&(this.symbolLegacy=t)}}();(0,i.l)(_,"b7d8ee6f$SymbolData",null,[]);var f=function(){return function(e,t,n){null!=e&&(this.TFA=e),null!=t&&(this.PN=t),null!=n&&(this.TN=n)}}();(0,i.l)(f,"3db2fb50$SerializableAddParaDataV1",null,[]);var m=function(){return function(e,t){null!=e&&(this.PM=e),null!=t&&(this.TM=t)}}();(0,i.l)(m,"7c7e6a6f$SerializableMergeRemoveParaDataV1",null,[]);var y=function(){return function(){}}();(0,i.l)(y,"60c8f101$SerializableRTTDataV1",null,[]);var v=function(){return function(e,t,n,r){null!=e&&(this.PA=e),null!=t&&(this.TA=t),null!=n&&(this.PB=n),null!=r&&(this.TBS=r)}}();(0,i.l)(v,"47acad03$SerializableSplitParaDataV1",null,[]);var S=function(){return function(e,t){e&&(this.SF=e),null!=t&&(this.SL=t)}}();(0,i.l)(S,"b662f2f5$SerializableSymbolDataV1",null,[]);var I=n(4439),C=function(){function e(){}return e.deserialize=function(e){var t;if(!u.validateDataV1(e,(0,c.m)((function(){return t}),(function(e){return t=e}))))return r.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",t),null;var n=null,i=null,o=null,a=null,s=null,l=null,f=null,m=null;return e.WD&&(n=e.WD),null!=e.TF&&(i=e.TF),isNullOrUndefined(e.TX)||(o=e.TX),e.AP&&(a=new d.c(e.AP.TFA,e.AP.PN,e.AP.TN)),e.MP&&(s=new p.a(e.MP.PM,e.MP.TM)),e.SP&&(l=new h.m(e.SP.PA,e.SP.TA,e.SP.PB,e.SP.TBS)),e.SPS&&(f=new _(e.SPS.SF,e.SPS.SL)),null!=e.ISS&&(m=e.ISS),new g.k(e.I,e.A,e.C,e.O,I.x.deserializeAnchorData(e.AN),n,i,o,a,s,l,f,1,m)},e.serialize=function(e){var t=new y;return t.I=e.packetId,t.V=1,t.A=e.clientId,t.C=e.client,t.O=e.operationType,t.AN=I.x.serializeAnchorData(e.anchorObject),e.wacData&&(t.WD=e.wacData),null!=e.textIdFinal&&(t.TF=e.textIdFinal),!isNullOrUndefined(e.text)&&e.text.length>0&&(t.TX=e.text),e.addParaData&&(t.AP=new f(e.addParaData.textIdFinalAbove,e.addParaData.paraIdNew,e.addParaData.textIdNew)),e.mergeRemoveParaData&&(t.MP=new m(e.mergeRemoveParaData.paraIdMerged,e.mergeRemoveParaData.textIdMerged)),e.splitParaData&&(t.SP=new v(e.splitParaData.paraIdAboveSplit,e.splitParaData.textIdAboveSplit,e.splitParaData.paraIdBelowSplit,e.splitParaData.textIdBelowSplit)),e.symbolData&&(t.SPS=new S(e.symbolData.symbolFont,e.symbolData.symbolLegacy)),t.ISS=e.strictlySequentialId,t},e}();(0,i.l)(C,"86d0e02d$SerializableRTTDataV1Methods",null,[]),n.d(t,{e:function(){return T}});var T=function(){function e(){}return e.versionedDeserialize=function(e){var t=e;if(u.validateVersionData(t))return 1===t.V?C.deserialize(e):(r.ULS.sendTraceTag(9188758,302,15,"Unsupported Version"),null);for(var n=e,i=0,a=null,s=0;s<n.length;s++)t=n[s],o.isSupported(t.V)&&t.V>i&&(i=t.V,a=n[s]);return 1===i?C.deserialize(a):null},e.versionedSerialize=function(e){if(!e)return null;return C.serialize(e)},e}();(0,i.l)(T,"d4781453$RTTDataMethods",null,[])},3217:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});var r=n(3545),i=n(6812),o=n(423),a=function(e){function t(){return e.call(this)||this}return(0,r.t)(t,e),t.prototype.get_failureType=function(){return"TableMerge"},t}(i.d);(0,o.l)(a,"accc81f3$TableMergeFailureDetail",i.d,[])},3234:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});var r=(0,n(423).y)("3ecc0e97$IPresenceIp")},3290:function(e,t,n){"use strict";var r,i=n(423),o=n(1775),a=(0,i.y)("871a7929$IGraphNodeComplexMerge"),s=n(5214),l=n(1822),u=n(4455),c=n(1094),d=n(2506),p=n(9154),g=n(3795),h=n(3748),_=n(5479),f=n(8540),m=n(6382),y=n(7518),v=n(4885),S=function(){function e(e,t){this._evalPropertyMergeStrategies=null,this.DefaultPropertyMergeStrategy=0,this._evalPropertyMergeStrategies=e,this.DefaultPropertyMergeStrategy=t}return e.prototype.get_item=function(e){return this._evalPropertyMergeStrategies.getOrElse(e,this.DefaultPropertyMergeStrategy)},e}();(0,i.l)(S,"2f709ed6$PropertyMergeStrategies",null,[]),function(e){e[e.conflictWinsIfDifferent=0]="conflictWinsIfDifferent",e[e.customMerge=1]="customMerge",e[e.favoredAlwaysWins=2]="favoredAlwaysWins",e[e.favoredWinsIfChanged=3]="favoredWinsIfChanged",e[e.nonMergeable=4]="nonMergeable",e[e.rejectChange=5]="rejectChange",e[e.remove=6]="remove",e[e.skippable=7]="skippable",e[e.conflictAlwaysWins=8]="conflictAlwaysWins"}(r||(r={})),(0,i.h)("3da310f0$PropertyMergeStrategy",r);var I=n(4680),C=n(3545),T=n(7114),b=function(e){function t(){var t=e.call(this)||this;return t.complexMergerType=null,t.mergeStrategy=null,t.nodeClassId=null,t.propertyId=0,t}return(0,C.t)(t,e),t.prototype.get_failureType=function(){return"Property"},t.prototype.getFailureDetail=function(){return this.detail.set_item("Type",this.get_failureType()),this.detail.set_item("ComplexMerger",null!=this.complexMergerType?this.complexMergerType:-1),this.detail.set_item("Strategy",null!=this.mergeStrategy?this.mergeStrategy:-1),this.detail.set_item("ClassId",null!=this.nodeClassId?this.nodeClassId:-1),this.detail.set_item("PropId",this.propertyId),this.detail},t}(T.w);(0,i.l)(b,"c430deca$PropertyMergeFailureDetail",T.w,[]);var A=n(3362);n.d(t,{s:function(){return M}});var M=function(){function e(e){this.mergeFunctions=null,this._propertyMergeStrategies=null,this.mergeFunctions=e||this.GetMergeFunctions()}return e.prototype.get_complexMergerType=function(){return 1},e.prototype.get_mergeFunctions=function(){return this.mergeFunctions},e.prototype.GetMergeFunctions=function(){return[i.i(this,this.TryPreProcessFavoredRevision,"TryPreProcessFavoredRevision"),i.i(this,this.CloneObjectAndRemoveNeededProperties,"CloneObjectAndRemoveNeededProperties"),i.i(this,this.TryMergeNodeInternal,"TryMergeNodeInternal")]},e.prototype.get_defaultPropertyMergeStrategy=function(){return 5},e.prototype.get_propertyMergeStrategies=function(){return this._propertyMergeStrategies||(this._propertyMergeStrategies=new S(this.evalPropertyMergeStrategies(),this.get_defaultPropertyMergeStrategy()))},e.prototype.tryMergeCustomProperty=function(e,t){var n=e.baseFavoredDiffLazy.get_value().get_newObject();return f.p.get_instance().traceTag(4016352,1,3,"GenericNodeComplexMerge: Failing to merge object with [Id: {0}] [ClassId: {1}] because not all of its properties changes were ignorable.",n.get_id(),n.get_runtimeClassId()),e.mergeState.logger.logMergeFailureDetail((0,s.m)(new b,{complexMergerType:this.get_complexMergerType(),nodeClassId:n.get_runtimeClassId(),propertyId:t})),!1},e.prototype.tryMergeNode=function(e){var t=e.baseFavoredDiffLazy.get_value();f.p.get_instance().traceTag(4016353,1,4,"TryMergeNode: Complex merge begin for object: [Id: {0}] [ClassId: {1}]",t.get_newObject().get_id(),t.get_newObject().get_runtimeClassId());for(var n=0;n<this.get_mergeFunctions().length;n++){if(!(0,this.get_mergeFunctions()[n])(e))return f.p.get_instance().traceTag(4016354,1,3,"TryMergeNode: Complex Merge failed for object: [Id: {0}] [ClassId: {1}] [Step: {2}]",t.get_newObject().get_id(),t.get_newObject().get_runtimeClassId(),n),e.mergeState.logger.logMergeFunctionChain("GraphNodeComplexMerge.GetMergeFunctions()",n),this.LogFailedMergeDetails(e),e.mergedObject=null,!1}return f.p.get_instance().traceTag(4016355,1,4,"TryMergeNode: Complex Merge succeeded for object: [Id: {0}] [ClassId: {1}]",t.get_newObject().get_id(),t.get_newObject().get_runtimeClassId()),!0},e.prototype.LogFailedMergeDetails=function(e){e.wasNodeLogged||(e.wasNodeLogged=!0,I.e.log(e.baseFavoredDiffLazy.get_value().get_oldObject(),"Base",1),I.e.log(e.baseFavoredDiffLazy.get_value().get_newObject(),"Favored",1),I.e.log(e.baseConflictDiffLazy.get_value().get_newObject(),"Conflict",1))},e.prototype.TryPreProcessFavoredRevision=function(e){var t=this,n=e.baseFavoredDiffLazy.get_value(),r=this.get_propertyMergeStrategies();if(!n.get_isDifferent())return!0;var i=!0;return n.get_propertyDiffs().forEach((function(o,a){if(!a.get_isDifferent()||e.mergedProperties.contains(o))return!0;var l=r.get_item(o);if(5===l){var u=n.get_oldObject().get_runtimeClassId();return f.p.get_instance().traceTag(4018176,1,2,"TryPreProcessFavoredRevision: Failed for [ClassId: {0}] [Property: {1}] was different from the base revision, but has a [MergeStrategy: {2}].",u,o,l),e.mergeState.logger.logMergeFailureDetail((0,s.m)(new b,{complexMergerType:t.get_complexMergerType(),nodeClassId:u,propertyId:o,mergeStrategy:l})),i=!1,!1}return 6===l&&e.propertiesToRemove.add(o),!0})),i},e.prototype.CloneObjectAndRemoveNeededProperties=function(e){var t=e.baseFavoredDiffLazy.get_value();e.mergedObject=t.get_newObject().cloneForMerge();var n=e.propertiesToRemove,r=e.mergedObject;return n&&n.forEach((function(e){return r.removeProperty(y.d.fromPropertyId(e)),!0})),!0},e.prototype.TryMergeNodeInternal=function(e){var t=this,n=e.baseConflictDiffLazy.get_value(),r=n.get_oldObject().get_runtimeClassId(),i=this.get_propertyMergeStrategies(),o=!0;return n.get_propertyDiffs().forEach((function(n,a){var l=i.get_item(n);return(o=t.TryMergeProperty(e,a,n,l))||(e.mergedObject=null,f.p.get_instance().traceTag(4018177,1,3,"TryMergeProperty: Failed for [ClassId: {0}] [Property: {1}] [MergeStrategy: {2}].",r,n,l),e.mergeState.logger.logMergeFailureDetail((0,s.m)(new b,{complexMergerType:t.get_complexMergerType(),nodeClassId:r,propertyId:n,mergeStrategy:l}))),o})),o},e.prototype.TryMergeProperty=function(t,n,r,i){var o=t.mergedObject;if(!n.get_isDifferent()&&8!==i)return!0;if(2===i||7===i||t.mergedProperties.contains(r))return!0;if(5===i)return!1;if(4===i||3===i){var a;if(t.baseFavoredDiffLazy.get_value().get_propertyDiffs().tryGetValue(r,(0,l.m)((function(){return a}),(function(e){return a=e})))&&a.get_isDifferent())return 4!==i;i=0}if(8===i&&(i=0),!i){if(!n.get_isDeleted()){var s=y.d.fromPropertyId(r);return(e.ValidateProperty(n,r,s)||e.ShouldSaveInvalidPropertiesToGraph())&&o.setMergeableProperty(s,n.get_newValue()),!0}i=6}return 6===i?(o.removeProperty(y.d.fromPropertyId(r)),!0):1===i&&this.tryMergeCustomProperty(t,r)},e.prototype.MergePurelyAdditiveLists=function(e,t,n,r,i,o){t=t||new _.o(e,null),n=n||new _.o(e,null),r=r||new _.o(e,null);for(var a=t.shallowClone(),s=new h.f(e),l=a.get_length(),u=l;u<n.get_length();u++){var c=n.getItemAt(u);a.add(c),s.add(c)}for(;l<r.get_length();l++){var d=r.getItemAt(l);s.contains(d)?f.p.get_instance().traceTag(4018180,1,4,"MergePurelyAdditiveLists: Both favored and conflict lists contained a reference to {0}. Only adding one copy of it.",d):(a.add(d),o(d))}return a},e.prototype.MergeListOfChildNodes=function(t,n,r,i,o){n=n||new _.o(t,null),r=r||new _.o(t,null),i=i||new _.o(t,null);for(var a=new _.o(t,null),s=new g.e(t,Number),l=new h.f(t),u=0;u<n.get_length();u++){var c=n.getItemAt(u);s.set_item(c,u)}for(var d=0,p=0;d<r.get_length()&&p<i.get_length();){var f=r.getItemAt(d),m=i.getItemAt(p),y=s.getOrElse(f,-1),v=s.getOrElse(m,-1);-1===y?(e.AddIfUnique(t,l,a,f),d++):-1===v?(e.AddIfUnique(t,l,a,m),p++):y===v?(e.AddIfUnique(t,l,a,f),d++,p++):y<v?d++:p++}for(;d<r.get_length();d++){f=r.getItemAt(d);-1===(y=s.getOrElse(f,-1))&&e.AddIfUnique(t,l,a,f)}for(;p<i.get_length();p++){m=i.getItemAt(p);-1===(v=s.getOrElse(m,-1))&&e.AddIfUnique(t,l,a,m)}return a},e.prototype.MergeUnorderedListOfChildNodes=function(t,n,r,i){n=n||new _.o(t,null),r=r||new _.o(t,null),i=i||new _.o(t,null);var o=n.toHashSet(),a=r.toHashSet(),s=i.toHashSet(),l=e.Filter(t,n,(function(e){return a.contains(e)&&s.contains(e)}));l.toHashSet();return l.insertRange(l.get_length(),e.Filter(t,r,(function(e){return!o.contains(e)}))),l.insertRange(l.get_length(),e.Filter(t,i,(function(e){return!o.contains(e)&&!a.contains(e)}))),l},e.prototype.CopyPropertyToDestination=function(e,t,n){e.hasProperty(n)?t.setMergeableProperty(n,e.getMergeableProperty(n)):t.removeProperty(n)},e.prototype.ReplaceAllProperties=function(e,t){for(var n=0,r=t.listProperties();n<r.length;n++){var i=r[n];t.removeProperty(i)}for(var o=0,a=e.listProperties();o<a.length;o++){i=a[o];t.setMergeableProperty(i,e.getMergeableProperty(i))}},e.prototype.KeepMaxInt32Value=function(e,t,n,r,i){var o,a=e.getPropertyInt32(t,i),s=e.getPropertyInt32(n,i);null!=(o=null!=a&&null!=s?Math.max(a,s):null!=s?s:null!=a?a:null)?e.setPropertyInt32(r,i,o):r.removeProperty(i)},e.prototype.CheckForMaterialDifferences=function(e,t,n,r,i,o,a,s,l){var u=t(n,o),c=t(r,o);a.val=t(i,o);var d=u.toHashSet();s.val=d.containsAll(c),l.val=d.containsAll(a.val)},e.prototype.evalPropertyMergeStrategies=function(){for(var t=e._lazyIgnorableProperties.get_value(),n=new g.e(Number,r),i=0;i<t.length;i++)n.set_item(t[i],7);return n},e.CreateAnInstanceWithResolvedDependencies=function(){return new e(null)},e.get_instance=function(){return e._instance.get_value()},e.ShouldSaveInvalidPropertiesToGraph=function(){return m.w.get_instance().tryResolve(o.d).isFeatureEnabled(85)},e.ValidateProperty=function(t,n,r){return!(isNullOrUndefined(t.get_newValue())&&!v.y.isNullAllowedForPropertyType(r.type))||(e.LogInvalidProperty(t,n,r),!1)},e.LogInvalidProperty=function(e,t,n){var r;r=n.type===v.y.string;var i=String.format("TryMergeProperty: Failed to Merge Property [ID: {0}]",t);r||(i+=String.format(" [NewValue: {0}] [OldValue: {1}]",e.get_newValue(),e.get_oldValue())),f.p.get_instance().traceTag(19145822,1,2,i)},e.AddIfUnique=function(e,t,n,r){t.contains(r)||(n.add(r),t.add(r))},e.Filter=function(e,t,n){var r=new _.o(e,null);return t.forEach((function(e){return n(e)&&r.add(e),!0})),r},e.getIgnorableProperties=function(){return[y.d.toPropertyId(u.b.enforceOutlineStructure),y.d.toPropertyId(u.b.lastModifiedTime),y.d.toPropertyId(u.b.outlineElementChildLevel),y.d.toPropertyId(u.b.richTextLanguageId),y.d.toPropertyId(u.b.rgOutlineIndentDistance),y.d.toPropertyId(c.o.noSpellingErrors),y.d.toPropertyId(d.j.conditionalFormattingResult),y.d.toPropertyId(d.j.editedImageUrl),y.d.toPropertyId(p.p.runsFromMerge)]},e._instance=new A.q(e,e.CreateAnInstanceWithResolvedDependencies),e._lazyIgnorableProperties=new A.q(Array,e.getIgnorableProperties),e}();(0,i.l)(M,"6ae9b7a0$GraphNodeComplexMerge",null,[a])},3320:function(e,t,n){"use strict";n.d(t,{u:function(){return a}});var r=n(3545),i=n(1388),o=n(423),a=function(e){function t(t,n,r){var i=this;return i.wordId=0,(i=e.call(this,2,t,n)||this).wordId=r,i}return(0,r.t)(t,e),t.prototype.toString=function(){var t=e.prototype.toString.call(this);return String.format("{0} [WordId: {1}] [GraphNodeId: {2}]",t,this.wordId,this.graphNodeId)},t.prototype.getBlockTypeString=function(){return"Eop"},t.prototype.clone=function(){return new t(this.source,this.graphNodeId,this.wordId)},t.prototype.isEquivalentTo=function(t,n,r,i){return!!e.prototype.isEquivalentTo.call(this,t,n,r,i)&&t.wordId===this.wordId},t.prototype.get_length=function(){return 1},t}(i.AMergeBlock);(0,o.l)(a,"5ae7556f$EopMergeBlock",i.AMergeBlock,[])},3386:function(e,t,n){"use strict";n.d(t,{s:function(){return i}});var r=n(423),i=function(){function e(){}return e.addAppPLTEventToLog=function(e){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(e)}catch(e){}},e.setIsPageLoadForFirstTime=function(e){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(e)}catch(e){}},e}();(0,r.l)(i,"334f59dc$VersionHistoryLogConnector",null,[])},3486:function(e,t,n){"use strict";n.r(t);var r=n(4509),i=n(1542),o=n(363),a=n(8192),s=n(5516),l=n(2575),u=n(1526),c=n(3096),d=n(6382),p=n(618),g=n(423),h=n(6089),_=n(6720),f=n(6935),m=n(1135),y=n(6410),v=n(9423),S=n(3068),I=n(1751),C=function(){function e(e){this._numberOfRendersInWindow=0,this._taskPane=null,this._taskPane=e}return e.prototype.DecrementRenderCount=function(t){var n=this;this._numberOfRendersInWindow=Math.max(0,--this._numberOfRendersInWindow),this.RenderHintBackground(t),this._numberOfRendersInWindow>0&&window.setTimeout((function(){n.DecrementRenderCount(t)}),e.DecrementRenderTimeoutMs)},e.prototype.RenderHintBackground=function(e){var t=Math.min(1,this._numberOfRendersInWindow/20);e.style.backgroundColor="rgba(255,0,0,"+t+")"},e.prototype.renderOccured=function(t){var n=this;this._taskPane&&this._taskPane.get_paragraphRenderVisualizationsAreEnabled()&&(this._numberOfRendersInWindow++,this.RenderHintBackground(t),this._taskPane.set_numberOfChildElementsInLastRenderedParagraph(y.s.getAllElementsCount(t,!1)),1===this._numberOfRendersInWindow&&window.setTimeout((function(){n.DecrementRenderCount(t)}),e.DecrementRenderTimeoutMs))},e.DecrementRenderTimeoutMs=1e3,e}();(0,g.l)(C,"e1632897$ParagraphRenderVisualizationManager",null,[h.s]);var T=function(){function e(e,t,n,r,i){this._actionManager=null,this._taskPane=null,this._taskPaneUtils=null,this._typingSpeedMeterValueElement=null,this._cpuMeterValueElement=null,this._typingSpeedMeterProviderFuture=null,this._cpuMeterProviderFuture=null,this._renderVisualizationsCheckbox=null,this._clickInputManager=null,this._renderedParagraphSpanCountElement=null,this._numberOfChildElementsInLastReneredParagraph=0,this._cpuPercentTillNow=new _.c(Number),this._actionManager=e,this._taskPaneUtils=t,this._clickInputManager=n,this._typingSpeedMeterProviderFuture=r,this._cpuMeterProviderFuture=i}return e.prototype.get_paragraphRenderVisualizationsAreEnabled=function(){return!!this._renderVisualizationsCheckbox&&this._renderVisualizationsCheckbox.checked},e.prototype.get_numberOfChildElementsInLastRenderedParagraph=function(){return this._numberOfChildElementsInLastReneredParagraph},e.prototype.set_numberOfChildElementsInLastRenderedParagraph=function(e){return this._renderedParagraphSpanCountElement&&(this._renderedParagraphSpanCountElement.innerText=String.format("Total number of child elements in last rendered paragraph: {0}",e)),this._numberOfChildElementsInLastReneredParagraph=e,e},e.prototype.registerActions=function(){this._actionManager.addAction(s.u.createAndShowInteractivePerfTaskPane,I.d.application,g.i(this,this.ShowTaskPane,"ShowTaskPane"))},e.prototype.dispose=function(){var t=this;null!==this._taskPane&&(this._taskPaneUtils.disposeTaskPane(e.TaskPaneID,this._taskPane),this._taskPane=null),this._typingSpeedMeterProviderFuture.execute((function(e){t.ExecuteActionOnTypingSpeedMeter(e,(function(e){e.remove_onTypingSpeedMeterWindowAvailable(g.i(t,t.OnTypingSpeedMeterWindowAvailable,"OnTypingSpeedMeterWindowAvailable"))}))})),this._cpuMeterProviderFuture.execute((function(e){t.ExecuteActionOnCpuMeter(e,(function(e){e.remove_onCpuMeterFrameAvailable(g.i(t,t.OnCpuMeterFrameAvailable,"OnCpuMeterFrameAvailable"))}))}))},e.prototype.OnTypingSpeedMeterWindowAvailable=function(e,t){this._typingSpeedMeterValueElement&&(this._typingSpeedMeterValueElement.innerText=t.get_newTypingSpeedValue()+" CPM")},e.prototype.OnCpuMeterFrameAvailable=function(e,t){this._cpuMeterValueElement&&(this._cpuMeterValueElement.innerText=t.get_newCpuMeterFrame().CP+"%",this._cpuPercentTillNow.add(t.get_newCpuMeterFrame().CP))},e.prototype.CreateTaskPane=function(){var t=new f.CuiHelper(S.f.box4ImageBase,Box4Intl.Box4Strings,null,null,null);this._taskPane=this._taskPaneUtils.createTaskPaneFromResource(e.TaskPaneID,0,e.Width,"InteractivePerfTaskPaneData",t),this.CreateAndInitializeTypingSpeedMeterGroup(),this.CreateAndInitializCpuMeterGroup(),this.CreateAndInitializeRenderGroup()},e.prototype.ShowTaskPane=function(e,t,n,r,i){return v.App.get_activeAppFrame().get_taskPaneManager()?(this._taskPane||this.CreateTaskPane(),this._taskPaneUtils.showTaskPane(this._taskPane),this._taskPane.get_element().style.overflow="scroll",32):16},e.prototype.GetGroupBodyElement=function(e){var t=document.getElementById(e),n=y.s.getChildByClassName(t,"cui-groupContainer");return y.s.getChildByClassName(n,"cui-groupBody")},e.prototype.ExecuteActionOnCpuMeter=function(e,t){var n=e.getCpuMeterAsync();n.CW((function(e){t(n.get_result())}))},e.prototype.ExecuteActionOnTypingSpeedMeter=function(e,t){var n=e.getTypingSpeedMeterAsync();n.CW((function(e){t(n.get_result())}))},e.prototype.CreateAndInitializeTypingSpeedMeterGroup=function(){var e=this,t=this.GetGroupBodyElement("TypingSpeedMeterGroup");t.style.margin="10px",t.style.fontSize="15px";var n=document.createElement("div");n.innerText="Typing Speed",this._typingSpeedMeterValueElement=document.createElement("div"),this._typingSpeedMeterValueElement.innerText="0 CPM",this._typingSpeedMeterProviderFuture.execute((function(t){e.ExecuteActionOnTypingSpeedMeter(t,(function(t){t.add_onTypingSpeedMeterWindowAvailable(g.i(e,e.OnTypingSpeedMeterWindowAvailable,"OnTypingSpeedMeterWindowAvailable"))}))})),t.appendChild(n),t.appendChild(this._typingSpeedMeterValueElement)},e.prototype.CreateAndInitializCpuMeterGroup=function(){var e=this,t=this.GetGroupBodyElement("CpuMeterGroup");t.style.margin="10px",t.style.fontSize="15px";var n=document.createElement("div");n.innerText="CPU Meter",this._cpuMeterValueElement=document.createElement("div"),this._cpuMeterProviderFuture.execute((function(t){e.ExecuteActionOnCpuMeter(t,(function(t){t.add_onCpuMeterFrameAvailable(g.i(e,e.OnCpuMeterFrameAvailable,"OnCpuMeterFrameAvailable"))}))}));var r=document.createElement("div"),i=document.createElement("button");i.innerText="View Cpu Percent",this._clickInputManager.registerHandler(m.d.click,i,g.i(this,this.DisplayCpuPercentLogs,"DisplayCpuPercentLogs")),r.appendChild(i),t.appendChild(n),t.appendChild(this._cpuMeterValueElement),t.appendChild(r)},e.prototype.CreateAndInitializeRenderGroup=function(){var e=this,t=this.GetGroupBodyElement("RenderGroup"),n=document.createElement("label");n.innerText="Enable render visualizations",this._renderVisualizationsCheckbox=document.createElement("input"),this._renderVisualizationsCheckbox.setAttribute("type","checkbox"),t.appendChild(this._renderVisualizationsCheckbox),t.appendChild(n),this._renderedParagraphSpanCountElement=document.createElement("div"),this._renderedParagraphSpanCountElement.style.margin="10px",t.appendChild(this._renderedParagraphSpanCountElement),d.w.get_instance().register(h.s).usingFactory((function(){return new C(e)}))},e.prototype.DisplayCpuPercentLogs=function(e){var t=window.open("","LogFile","",!1).document;t.writeln("<HEAD>"),t.writeln('<STYLE type="text/css">'),t.writeln("* { padding: 0px; margin: 0px; font-family: monospace; }"),t.writeln("</STYLE>"),t.writeln("</HEAD>"),t.writeln("<BODY style='BACKGROUND-COLOR: #f3f8fd;'>");var n=document.createElement("div"),r=document.createElement("div");r.innerText=String.format("{0}, {1}","Frame","CpuPercent"),n.appendChild(r);for(var i=0;i<this._cpuPercentTillNow.get_count();i++){var o=this.BuildCpuPercentLogEntry(i,this._cpuPercentTillNow.get_item(i));o&&n.appendChild(o)}return t.writeln(n.innerHTML),t.writeln("</BODY>"),t.close(),!0},e.prototype.BuildCpuPercentLogEntry=function(e,t){var n=e.toString(),r=t.toString(),i=document.createElement("div");return i.innerText=String.format("{0}, {1}",n,r),i},e.TaskPaneID="InteractivePerfTaskPane",e.Width=400,e}();(0,g.l)(T,"add97f04$InteractivePerfTaskPane",null,[]),n.d(t,{InteractivePerfTaskPanePackageManager:function(){return b}});var b=function(){function e(){this._taskPane=null}return e.prototype.get_name=function(){return"WordEditor.InteractivePerfTaskPane"},e.prototype.configure=function(e){e.register(T).singleInstance().usingFactory((function(){return new T(l.AFrameworkApplication.get_theActionManager(),p.a.get_instance(),l.AFrameworkApplication.get_activeFrame().get_theClickInputManager(),e.resolveFuture(r.o),e.resolveFuture(i.o))}))},e.prototype.init=function(){this._taskPane=d.w.get_instance().tryResolve(T),this._taskPane&&(this._taskPane.registerActions(),"1"===c.n.getParameterValue(document.URL,e.ShowInteractivePerfTaskPaneUrlParam,!1)&&l.AFrameworkApplication.get_theActionManager().processAction(s.u.createAndShowInteractivePerfTaskPane,2,null))},e.prototype.dispose=function(){this._taskPane&&(this._taskPane.dispose(),this._taskPane=null)},e.main=function(){u.o.get_instance().registerPackage(new e,0,!1)},e.ShowInteractivePerfTaskPaneUrlParam="wdShowIPerfTaskPane",e}();(0,g.l)(b,"fa2e638d$InteractivePerfTaskPanePackageManager",null,[o.u,a.s])},3538:function(e,t,n){"use strict";n.d(t,{e:function(){return s}});var r=n(9921),i=n(4211),o=n(4427),a=n(423),s=function(){function e(e,t){if(this.$$pf_IsReadOnly=!1,this.$$pf_MemberTypeID=0,this.$$pf_Items=null,this.m_annotations=null,!e)throw Error.argumentNull("annotations");if(!e.isValidTypeID(t))throw Error.argument("memberTypeID","Invalid type ID");if(n(2093).Annotations.typeIDIsListType(t))throw Error.argument("memberTypeID","Lists of lists are not permitted");this.m_annotations=e,this.set_memberTypeID(t),this.set_items([])}return e.prototype.get_annotationsContext=function(){return this.m_annotations},e.prototype.get_isReadOnly=function(){return this.$$pf_IsReadOnly},e.prototype.set_isReadOnly=function(e){return this.$$pf_IsReadOnly=e,e},e.prototype.get_memberTypeID=function(){return this.$$pf_MemberTypeID},e.prototype.set_memberTypeID=function(e){return this.$$pf_MemberTypeID=e,e},e.prototype.get_items=function(){return this.$$pf_Items},e.prototype.set_items=function(e){return this.$$pf_Items=e,e},e.prototype.valueToString=function(){for(var e="[",t=0,r=this.get_items().length;t<r;++t){t>0&&(e+=", ");var i=this.m_annotations.valueToString(this.get_memberTypeID(),this.get_items()[t]);this.get_memberTypeID()===n(2093).Annotations.typeiD_String?(e+='"',e+=o.d.EscapeStringForValueToString(i),e+='"'):e+=i}return e+="]"},e.prototype.isEqual=function(e){if(this===e)return!0;if(!e||e.get_annotationsContext()!==this.m_annotations||e.get_memberTypeID()!==this.get_memberTypeID()||e.get_items().length!==this.get_items().length)return!1;for(var t=0;t<this.get_items().length;++t)if(!n(2093).Annotations.ValuesAreEqual(this.get_memberTypeID(),this.get_items()[t],e.get_items()[t]))return!1;return!0},e.prototype.clone=function(){var t=new e(this.m_annotations,this.get_memberTypeID());return Array.addRange(t.get_items(),this.get_items()),t},e.prototype.cloneIfReadOnly=function(){return this.get_isReadOnly()?this.clone():this},e.prototype.lockDown=function(){if(!this.get_isReadOnly()){this.set_isReadOnly(!0);for(var e=0,t=this.get_items();e<t.length;e++){var r=t[e];n(2093).Annotations.LockDownIfNecessary(r)}}},e.prototype.toString=function(){return this.valueToString()},e}();(0,a.l)(s,"7162d24f$ListValue",null,[r.z,i.r])},3572:function(e,t,n){"use strict";n.d(t,{y:function(){return a}});var r=n(3545),i=n(904),o=n(423),a=function(e){function t(t,n,r,i){var o=e.call(this,t,n,i,null)||this;return o.id=null,o.id=r,o}return(0,r.t)(t,e),t}(i.b);(0,o.l)(a,"f440b620$TryQueryResultBinding",i.b,[])},3603:function(e,t,n){"use strict";var r=n(5526),i=n(3545),o=n(423),a=(0,o.y)("c9c2661e$ISignInDialog"),s=n(8530),l=n(7597),u=n(9910),c=n(2575),d=n(6531),p=function(e){function t(t,n,r){var i=this;return i._actionManager=null,i._signOutResponse=null,i._aframeApplication=null,(i=e.call(this)||this)._actionManager=t,i._signOutResponse=n,i._aframeApplication=r,i._hideOnButtonClick=!1,i.set_buttonsOption(1),i.setDefaultButton(1),i.setButtonText(1,CommonUIStrings.l_SignIn),i.setButtonText(0,CommonUIStrings.l_SignInToSaveDialogCancelButton),i}return(0,i.t)(t,e),t.prototype.displayDialog=function(){this._signOutResponse.add_authenticationRestored(o.i(this,this.OnSignIn,"OnSignIn")),this.messageBox(CommonUIStrings.l_SignInToSaveDialogTitle,CommonUIStrings.l_SaveToCloudSignInDialog,0,o.i(this,this.InputHandler,"InputHandler"))},t.prototype.InputHandler=function(e,t){if(!e)return l.ULS.sendTraceTag(6590598,216,50,"User dismissed SignIn Dialog."),void this.hide();this.PerformSignIn()},t.prototype.CheckApp=function(){var e="2";if(this._aframeApplication)switch(this._aframeApplication.get_officeAppType()){case 3:e="0";break;case 2:e="3";break;case 1:e="1"}return e},t.prototype.hide=function(){this._signOutResponse.remove_authenticationRestored(o.i(this,this.OnSignIn,"OnSignIn")),e.prototype.hide.call(this)},t.prototype.PerformSignIn=function(){var e=new d.QueryStringBuilder("Signin.aspx");e.addParam("prompt","1"),e.addParam("cbcxt",this.CheckApp()),c.AFrameworkApplication.addCommonUrlParameters(e),window.open(e.toString(),"LoginWindow")},t.prototype.OnSignIn=function(e,t){this.get_isShowing()&&this.hide(),l.ULS.sendTraceTag(7143885,216,50,"User signed in successfully. Calling Savetocloudstorage action handler"),this._actionManager.processAction(u.b.saveToCloudStorage,2,null)},t}(s.StandardDialog);(0,o.l)(p,"70819fb7$SignInDialog",s.StandardDialog,[a]),n.d(t,{m:function(){return g}});var g=function(){function e(e,t,n){this._actionManager=null,this._signOutResponse=null,this._aframeApplication=null,this._actionManager=e,this._signOutResponse=t,this._aframeApplication=n}return e.prototype.create=function(){return new p(this._actionManager,this._signOutResponse,this._aframeApplication)},e}();(0,o.l)(g,"35418603$SignInDialogFactory",null,[r.j])},3692:function(e,t,n){"use strict";n.d(t,{w:function(){return r}});var r=(0,n(423).y)("c3119f93$IStructValue")},3803:function(e,t,n){"use strict";var r=n(5214),i=n(8005),o=n(423),a=function(){return function(){this.neighborhood=null,this.mentionStart=0,this.mentionLength=0}}();(0,o.l)(a,"1e4c9e4f$InsightsParameters",null,[]);var s=function(){return function(){}}();(0,o.l)(s,"187e6c20$Selection",null,[]);var l=function(){return function(){}}();(0,o.l)(l,"a5dbc5c4$SmartLookupApplicationInterface",null,[]);var u=n(8996);n.d(t,{q:function(){return c}});var c=function(){function e(){}return e.get_insightsIcon=function(){return"Insights_16x16x32"},e.get_findInDocumentIcon=function(){return"Find_16x16x32"},e.get_parameterId=function(){return"-Parameterized"},e.get_simplifiedUxParameterizedSuffix=function(){return"Parameterized"},e.get_tryQueryId=function(){return"bTryQuery"},e.get_tryQueryIdSimplified=function(){return"TellMeSuggestion_"},e.get_tryQueryAlternateId=function(){return"bTryQueryAlternate"},e.get_tellMeDisplayMode=function(){return"MenuTellMe"},e.createdParameterizedId=function(t){return t+e.get_parameterId()},e.getParameter=function(e){var t="",n="";if(e)for(var r=0;r<e.get_fieldCount();++r)"Type"===e.getFieldName(r)?t=e.getValue(r):"Value"===e.getFieldName(r)&&(n=e.getValue(r));return new i.z(t,n)},e.createSerializedInsightsParameters=function(e){var t=(0,r.m)(new a,{neighborhood:e,mentionStart:0,mentionLength:e.length});return u.x.serialize(t)},e.createSerializedSmartLookupApplicationInterface=function(e,t,n){var i=(0,r.m)(new s,{neighborhood:e,mentionStart:0,mentionLength:e?e.length:0}),o=(0,r.m)(new l,{selection:i,userIntent:t,entryPoint:n});return u.x.serialize(o)},e}();(0,o.l)(c,"60f239ce$TellMeUtils",null,[])},3888:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("e7f93102$IResultGroup");n.d(t,{z:function(){return o}});var o=function(){function e(e){this.$$pf_DisplayName=null,this.$$pf_Results=null,this.groupType=0,this.set_results([]),this.groupType=e}return e.prototype.get_displayName=function(){return this.$$pf_DisplayName},e.prototype.set_displayName=function(e){return this.$$pf_DisplayName=e,e},e.prototype.get_results=function(){return this.$$pf_Results},e.prototype.set_results=function(e){return this.$$pf_Results=e,e},e.prototype.addResult=function(e){Array.add(this.get_results(),e)},e.prototype.getGroupType=function(){return this.groupType},e}();(0,r.l)(o,"7b583b05$SimpleResultGroup",null,[i])},3996:function(e,t,n){"use strict";n.d(t,{e:function(){return i}});var r=n(423),i=function(){return function(e,t,n,r,i,o,a,s,l){this.documentKind=0,this.rangeKind=0,this.paraIdStart=0,this.textIdStart=0,this.offsetStart=null,this.paraIdEnd=null,this.textIdEnd=null,this.offsetEnd=null,this.shapeId=0,this.documentKind=s,this.rangeKind=e,this.paraIdStart=t,this.textIdStart=n,r&&(this.offsetStart=r),null!=i&&(this.paraIdEnd=i),null!=o&&(this.textIdEnd=o),a&&(this.offsetEnd=a),this.shapeId=l}}();(0,r.l)(i,"daa22369$AnchorData",null,[])},4019:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(423),o=(0,i.y)("29804190$IPerfTrackerFactory"),a=(0,i.y)("4cbebeb0$ITimeSpanVerifierNotifier"),s=(0,i.y)("d3bae48a$IReplicationTelemetryMetricsManager"),l=(0,i.y)("7d254c0$ITimeSpanVerifierFactory"),u=(0,i.y)("996ca924$IInboundMonitor"),c=n(9452),d=n(5373),p=n(1542),g=n(363),h=n(8192),_=n(7597),f=n(2575),m=n(2879),y=n(1323),v=n(5104),S=n(1874),I=n(1282),C=function(){function e(){}return e.prototype.create=function(e){return new I.z(e)},e}();(0,i.l)(C,"ea6840a0$RandomSamplerFactory",null,[c.v]);var T=n(6382),b=n(2449),A=n(9423),M=n(6709),P=function(){return function(e,t,n,r,i){e.add_onOutboundReplicationStart((function(e,t){r.replicationStart()})),e.add_onSuccessfulOutboundEvent((function(e,t){r.replicationEnd(t.get_revisionId(),t.get_numSequentialFailures())})),e.add_onSuccessfulInboundEvent((function(e,t){r.inboundReplicationRecieved(t.get_revisionIds(),t.get_numSequentialFailures(),t.get_timelineTicks())})),e.add_onNoOutboundChangesToReplicate((function(){r.replicationCancelled()})),t.add_onThresholdExceeded((function(e,t){r.timeSpanVerifierThresholdExceeded(t.get_replicationTelemetryPhase(),t.get_thresholdValue(),t.get_actualValue())})),t.add_onAverageThresholdExceeded((function(e,t){r.timeSpanVerifierAverageThresholdExceeded(t.get_replicationTelemetryPhase(),t.get_thresholdValue(),t.get_actualValue())})),i.add_onContentDirtied((function(){r.typingStart()})),n.add_updateNotificationReceived((function(e,t){6===t.get_type()&&r.rtcNotificationReceived(t.get_updateHint())}))}}();(0,i.l)(P,"a86f5bf4$EventForwarder",null,[]);var F=function(){function e(e,t,n){this._notifier=null,this._contentEditableViewEventSource=null,this._timeSpanVerifierNotifier=null,this._notifier=e,this._contentEditableViewEventSource=n,this._timeSpanVerifierNotifier=t}return e.prototype.create=function(e,t){return new P(this._notifier,this._timeSpanVerifierNotifier,e,t,this._contentEditableViewEventSource)},e}();(0,i.l)(F,"1c3db0c0$EventForwarderFactory",null,[]);var w=(0,i.y)("831ccb10$IInboundMonitorFactory"),R=n(431),E=n(163),k=n(9462),D=function(){function e(){}return e.typingToOutboundReplicationStart="TypingToOutboundReplicationStart",e.outboundReplicationStartToOutboundReplicationEnd="OutboundReplicationStartToOutboundReplicationEnd",e.rtcNotificationToInboundReplicationEnd="RtcNotificationToInboundReplicationEnd",e.typingToInboundReplicationEnd="TypingToInboundReplicationEnd",e}();(0,i.l)(D,"f5e595b1$PerfTrackerPhases",null,[]);var O=function(){function e(t,n,r,i,o,a,s,l){this._inboundOperationFactory=null,this._currentTime=null,this._maxDictionaryLength=0,this._inboundTimespanVerifier=null,this._typingToInboundEndTimespanVerifier=null,this._logSteppedInboundFrameIsEnabled=!1,this._logTasksDetailsFromCpuMeterIsEnabled=!1,this._numberOfLastShortTasks=5,this._minLengthForLongRunningTasksInMs=50,this._maxNumberOfLongRunningTasks=20,this._aggregator=null,this._longRunningTasks=null,this._lastShortTasks=null,this._countOfLongRunningTasks=0,this._currentIndexInLastShortTasks=0,this._taskInfoListInitialized=!1,this._startToMeasureTasks=!1,this._UIData=null,this.pendingInbounds=null,this._taskData=new Array(7),this.pendingInbounds={},this._inboundOperationFactory=t,this._currentTime=n,this._maxDictionaryLength=r,this._inboundTimespanVerifier=i.create(D.rtcNotificationToInboundReplicationEnd,o,a,e.MinCountForAverageThreshold,!1),this._typingToInboundEndTimespanVerifier=i.create(D.typingToInboundReplicationEnd,s,l,e.MinCountForAverageThreshold,!0),f.AFrameworkApplication.appSettingsManager&&(this._logSteppedInboundFrameIsEnabled=f.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LogSteppedInboundFrameIsEnabled"),this._logTasksDetailsFromCpuMeterIsEnabled=f.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LogTasksDetailsFromCPUMeterIsEnabled"),this._maxNumberOfLongRunningTasks=f.AFrameworkApplication.appSettingsManager.getIntAppSetting("InboundFrameMaxNumberOfLongRunningTasks",20),this._minLengthForLongRunningTasksInMs=f.AFrameworkApplication.appSettingsManager.getIntAppSetting("InboundFrameMinLengthForLongRunningTasksInMs",50),this._numberOfLastShortTasks=f.AFrameworkApplication.appSettingsManager.getIntAppSetting("InboundFrameNumberOfLastShortTasks",5))}return e.prototype.get_pendingInbounds=function(){return this.pendingInbounds},e.prototype.initialize=function(e){this._aggregator=e},e.prototype.replicationReceived=function(e,t,n){this.CleanUpPendingRevisionQueue(),_.ULS.shipAssertTag(8229761,324,e.length>0,null);for(var r=!1,i=0,o=e;i<o.length;i++){var a=o[i],s=a.toString();if(s in this.get_pendingInbounds()){var l=this.get_pendingInbounds()[s];if(!l.get_serverRevisionAlreadyReceived()){if(l.serverRevisionReceived(e,t,n),this._logTasksDetailsFromCpuMeterIsEnabled&&!r){var u=this.ExtractTasksFromLongRunningTasks(),c=this.GenerateUIData(this._UIData);r=!0,this.LogSteppedInboundFrame(a.toString(),l,u,this._lastShortTasks,this._taskData,c)}else this.LogSteppedInboundFrame(a.toString(),l,null,null,this._taskData,null);delete this.get_pendingInbounds()[s]}}else{var d=this._inboundOperationFactory.create(this._inboundTimespanVerifier,this._typingToInboundEndTimespanVerifier);d.serverRevisionReceived(e,t,null),this.get_pendingInbounds()[s]=d}}this._startToMeasureTasks=!1},e.prototype.rtcNotificationReceived=function(e){if(_.ULS.shipAssertTag(8257930,304,e.get_isValidMessage(),"Expected data not sent on the wire"),e.get_isValidMessage()){if(e.get_revisionIdAsString()in this.get_pendingInbounds()){var t=this.get_pendingInbounds()[e.get_revisionIdAsString()];t.get_rtcNotificationAlreadyReceived()||(t.rtcNotificationReceived(e.get_revisionId(),e.get_outboundTime(),e.get_shouldSample(),e.get_numSequentialFailures()),delete this.get_pendingInbounds()[e.get_revisionIdAsString()])}else{var n=this._inboundOperationFactory.create(this._inboundTimespanVerifier,this._typingToInboundEndTimespanVerifier);n.rtcNotificationReceived(e.get_revisionId(),e.get_outboundTime(),e.get_shouldSample(),e.get_numSequentialFailures()),this.get_pendingInbounds()[e.get_revisionIdAsString()]=n}this.CleanUpPendingRevisionQueue()}},e.prototype.InitTaskInfoList=function(){this._taskInfoListInitialized||(this._longRunningTasks=new Array(this._maxNumberOfLongRunningTasks),this._lastShortTasks=new Array(this._numberOfLastShortTasks),this._countOfLongRunningTasks=0,this._currentIndexInLastShortTasks=0,this._taskData=[0,0,0,0,0,0,0,0],this._UIData=new Array(3),this._UIData[1]=[0,0],this._UIData[2]=[0,0],this._taskInfoListInitialized=!0)},e.prototype.shouldSendMeasuredTask=function(e){return this._startToMeasureTasks},e.prototype.shouldSendAddedTask=function(e){if(!e.TP&&e.TN===k.p.replicationEvent){var t=R.p.getKeys(this.get_pendingInbounds());if(t&&t[0])return!0}return!1},e.prototype.onCpuMeterTaskMeasured=function(e){this._taskInfoListInitialized=!1;var t=R.p.getKeys(this.get_pendingInbounds());t&&t[0]&&(e.TRT>=this._minLengthForLongRunningTasksInMs&&this._countOfLongRunningTasks<this._maxNumberOfLongRunningTasks-1?this._longRunningTasks[this._countOfLongRunningTasks++]=e:(this._lastShortTasks[this._currentIndexInLastShortTasks]=e,this._currentIndexInLastShortTasks=this._currentIndexInLastShortTasks<this._numberOfLastShortTasks-1?this._currentIndexInLastShortTasks+1:0),this.LogTaskDataBasedOnPriority(e),this.LogUIData(e))},e.prototype.onCpuMeterTaskAdded=function(e){this._logTasksDetailsFromCpuMeterIsEnabled&&(this.InitTaskInfoList(),this._startToMeasureTasks=!0)},e.prototype.LogTaskDataBasedOnPriority=function(e){this._taskData[e.TP]++},e.prototype.LogUIData=function(e){if(e&&e.UI){var t=this._UIData[e.UI];t[0]=t[0]+1,t[1]=t[1]+e.TRT}},e.prototype.GenerateUIData=function(e){var t={};return e&&(e[1]&&(t.Typing=e[1]),e[2]&&(t.Clicking=e[2])),t},e.prototype.ExtractTasksFromLongRunningTasks=function(){return this._countOfLongRunningTasks?this._longRunningTasks.slice(0,this._countOfLongRunningTasks-1):null},e.prototype.CleanUpPendingRevisionQueue=function(){var e=R.p.getKeys(this.get_pendingInbounds());if(e&&e.length>this._maxDictionaryLength)for(var t=0,n=e;t<n.length;t++){var r=n[t],i=this.get_pendingInbounds()[r],o=i.get_createdTime(),a=this._currentTime();if(a-o>6e4){var s=i.get_serverRevisionAlreadyReceived()?"RtcNotification":"ServerRevision";E.r.traceTag(8438528,304,50,"{0}",{"Not Received":s,Duration:a-o}),i.get_serverRevisionAlreadyReceived()||E.r.traceTag(42075798,304,15,"{0}",{RevisionId:r,Duration:a-o}),delete this.get_pendingInbounds()[r]}}},e.prototype.LogSteppedInboundFrame=function(e,t,n,r,i,o){if(this._logSteppedInboundFrameIsEnabled){var a=t.generateSteppedInboundFrame();a&&(a.RevisionId=e,a.LRTWR=n,a.LSTWR=r,a.TSD=i,a.UIWR=o,this._aggregator&&this._aggregator.track(a,null))}},e.MinCountForAverageThreshold=20,e}();(0,i.l)(O,"6ad85e4d$InboundMonitor",null,[u]);var U=function(){function e(e,t,n,r){this._perfTrackerFactory=null,this._getCurrentTime=null,this._inboundOperationFactory=null,this._timeSpanVerifierFactory=null,this._perfTrackerFactory=e,this._getCurrentTime=t,this._inboundOperationFactory=n,this._timeSpanVerifierFactory=r}return e.prototype.create=function(t,n,r,i){return new O(this._inboundOperationFactory,this._getCurrentTime,e.MaxOperationDictionaryLength,this._timeSpanVerifierFactory,t,n,r,i)},e.MaxOperationDictionaryLength=50,e}();(0,i.l)(U,"97f3e5b9$InboundMonitorFactory",null,[w]);var x=(0,i.y)("952f7249$IInboundOperationFactory"),L=(0,i.y)("91b17e7d$IInboundOperation"),N=n(5214),B=n(2464),H=n(5656),$=n(5989),G=n(4097),W=function(){function e(){}return e.userCount="UserCount",e.revisionChainLength="RevisionChainLength",e}();(0,i.l)(W,"8214e18d$PerfTrackerPivotNames",null,[]);var V=function(){return function(){}}();(0,i.l)(V,"4fac3865$PerfTrackingContext",null,[]);var j=function(){function e(){}return e.getUserPivotBucket=function(e){return e<=5?"5AndFewer":e<=10?"6To10":e<=15?"11To15":e<=20?"15To20":e<=25?"21To25":e<=30?"26To30":"31AndAbove"},e.getRevisionLengthPivotBucket=function(e){return e<=9?e.toString():"10AndAbove"},e}();(0,i.l)(j,"1bd666f0$ReplicationTelemetryUtils",null,[]);var q=function(){return function(){}}();(0,i.l)(q,"b165ee1f$SteppedInboundFrame",null,[]);var z=function(){function e(e,t,n,r,i){this._perfTrackerFactory=null,this._inboundReplicationTracker=null,this._outboundTime=0,this._shouldSample=!1,this._numberOfCoauthors=null,this._pendingRevisionId=null,this._inboundTimeSpanVerifier=null,this._typingToInboundEndTimespanVerifier=null,this._inboundFrameSamplingMinimalTotalTimeMs=500,this._RTCArrivedTimeStr=null,this.$$pf_RtcNotificationAlreadyReceived=!1,this.$$pf_ServerRevisionAlreadyReceived=!1,this.$$pf_RevisionList=null,this.$$pf_CreatedTime=0,this.numSequentialFailures=0,this.outboundNumSequentialFailures=0,this._coauthManager=A.App.get_theCoauthManager(),this._RTCArrivedTime=-1,this._inboundRequestSentTime=-1,this._inboundResponseReceivedTime=-1,this._inboundReplicationStartTime=-1,this._inboundReplicationEndTime=-1,this._perfTrackerFactory=e,this.set_createdTime(t()),this._shouldSample=!1,this._outboundTime=0,this._numberOfCoauthors=n,this._inboundTimeSpanVerifier=r,this._typingToInboundEndTimespanVerifier=i,f.AFrameworkApplication.appSettingsManager&&(this._inboundFrameSamplingMinimalTotalTimeMs=f.AFrameworkApplication.appSettingsManager.getIntAppSetting("InboundFrameSamplingMinimalTotalTimeMs",500))}return e.prototype.get_rtcNotificationAlreadyReceived=function(){return this.$$pf_RtcNotificationAlreadyReceived},e.prototype.set_rtcNotificationAlreadyReceived=function(e){return this.$$pf_RtcNotificationAlreadyReceived=e,e},e.prototype.get_serverRevisionAlreadyReceived=function(){return this.$$pf_ServerRevisionAlreadyReceived},e.prototype.set_serverRevisionAlreadyReceived=function(e){return this.$$pf_ServerRevisionAlreadyReceived=e,e},e.prototype.get_revisionList=function(){return this.$$pf_RevisionList},e.prototype.set_revisionList=function(e){return this.$$pf_RevisionList=e,e},e.prototype.get_createdTime=function(){return this.$$pf_CreatedTime},e.prototype.set_createdTime=function(e){return this.$$pf_CreatedTime=e,e},e.prototype.get_numSequentialFailures=function(){return this.numSequentialFailures},e.prototype.get_outboundNumSequentialFailures=function(){return this.outboundNumSequentialFailures},e.prototype.get_editorCount=function(){return this._numberOfCoauthors()},e.prototype.rtcNotificationReceived=function(e,t,n,r){this.get_rtcNotificationAlreadyReceived()||(this._shouldSample=n,this._outboundTime=t,this._RTCArrivedTime=H.s.roundNumber($.g.getTickCount(),2),this._RTCArrivedTimeStr=(new Date).toISOString(),this._pendingRevisionId=e,this.outboundNumSequentialFailures=r,this.set_rtcNotificationAlreadyReceived(!0),this.get_serverRevisionAlreadyReceived()?this.EndTracker():(this.StartTracker(),G.m.get_instance().addMark(e.toString()+"Start"),B.r.get_instance().markEventTraceFlag(2)))},e.prototype.serverRevisionReceived=function(e,t,n){this.get_serverRevisionAlreadyReceived()||(this.numSequentialFailures=t,this.set_serverRevisionAlreadyReceived(!0),this.set_revisionList(e),this._inboundReplicationEndTime=H.s.roundNumber($.g.getTickCount(),2),this.get_rtcNotificationAlreadyReceived()&&(G.m.get_instance().addMark(this._pendingRevisionId.toString()+"End"),n&&(this._inboundRequestSentTime=n.requstInvokedTimeTicks,this._inboundResponseReceivedTime=n.requestCompletedTimeTicks,this._inboundReplicationStartTime=n.replicationStartTimeTicks),B.r.get_instance().clearEventTraceFlag(!0,0),this.EndTracker()))},e.prototype.generateSteppedInboundFrame=function(){if(!(this._RTCArrivedTime>0&&this._inboundRequestSentTime>0&&this._inboundResponseReceivedTime>0&&this._inboundReplicationStartTime>0&&this._inboundReplicationEndTime>0))return null;var e=new q;return e.TT=H.s.roundNumber(this._inboundReplicationEndTime-this._RTCArrivedTime,2),e.TT<this._inboundFrameSamplingMinimalTotalTimeMs?null:(e.ST=this._RTCArrivedTimeStr,e.UC=this.get_editorCount(),e.RS=H.s.roundNumber(this._inboundRequestSentTime-this._RTCArrivedTime,2),e.SR=H.s.roundNumber(this._inboundResponseReceivedTime-this._inboundRequestSentTime,2),e.RRS=H.s.roundNumber(this._inboundReplicationStartTime-this._inboundResponseReceivedTime,2),e.RP=H.s.roundNumber(this._inboundReplicationEndTime-this._inboundReplicationStartTime,2),e.ResponseLanded=H.s.roundNumber(this._inboundResponseReceivedTime,2),e.RS>0?(G.m.get_instance().measureMarks("RTCToRequestSent",this._pendingRevisionId.toString()+"Start","RequestInvoked"+this._inboundRequestSentTime,!1),G.m.get_instance().measureMarks("RequestSentToResponseReceived","RequestInvoked"+this._inboundRequestSentTime,"RequestCompleted"+this._inboundResponseReceivedTime,!1),G.m.get_instance().measureMarks("ResponseReceivedToReplicationStart","RequestCompleted"+this._inboundResponseReceivedTime,"ReplicationStart"+this._inboundReplicationStartTime,!1)):G.m.get_instance().measureMarks("RTCToReplicationStart",this._pendingRevisionId.toString()+"Start","ReplicationStart"+this._inboundReplicationStartTime,!1),G.m.get_instance().measureMarks("Replication","ReplicationStart"+this._inboundReplicationStartTime,this._pendingRevisionId.toString()+"End",!1),e)},e.prototype.StartTracker=function(){this._inboundReplicationTracker=this._perfTrackerFactory.create(),this._inboundReplicationTracker.start(D.rtcNotificationToInboundReplicationEnd,D.typingToInboundReplicationEnd)},e.prototype.EndTracker=function(){this._inboundReplicationTracker||this.StartTracker();var e=this._inboundReplicationTracker.end(this._shouldSample,this.CreatePerfTrackingContext());this._inboundTimeSpanVerifier.reportTime(e),this._typingToInboundEndTimespanVerifier.reportTime(e+this._outboundTime)},e.prototype.CreatePerfTrackingContext=function(){var e={};return e[W.userCount]=j.getUserPivotBucket(this.get_editorCount()),e[W.revisionChainLength]=j.getRevisionLengthPivotBucket(this.get_revisionList().length),(0,N.m)(new V,{P:e,FC:this.get_numSequentialFailures(),CFC:this.get_outboundNumSequentialFailures()+this.get_numSequentialFailures(),ID:this._pendingRevisionId.toString(),CD:this._outboundTime,UC:this.get_editorCount(),RCL:this.get_revisionList().length})},e}();(0,i.l)(z,"aa9b6c34$InboundOperation",null,[L]);var K=function(){function e(e,t,n){this._factory=null,this._currentTime=null,this._numberOfCoauthors=null,this._factory=e,this._currentTime=t,this._numberOfCoauthors=n}return e.prototype.create=function(e,t){return new z(this._factory,this._currentTime,this._numberOfCoauthors,e,t)},e}();(0,i.l)(K,"a1ac8000$InboundOperationFactory",null,[x]);var Q=function(){function e(t,n,r,i,o,a,s,l,u){this._outboundOperationFactory=null,this._endToEndSampler=null,this._phaseSampler=null,this._rtcProxy=null,this._typingToReplicationStartVerifier=null,this._replicationStartToReplicationEndVerifier=null,this._shouldSampleEndToEnd=!0,this.pendingReplicationStart=null,this.pendingReplicationEnd=null,this._outboundOperationFactory=t,this._endToEndSampler=n,this._phaseSampler=r,this._rtcProxy=i,this._typingToReplicationStartVerifier=o.create(e.TypingToReplicationStartPhase,a,s,e.MinCountForAverageThreshold,!1),this._replicationStartToReplicationEndVerifier=o.create(e.ReplicationStartToReplicationEndPhase,l,u,e.MinCountForAverageThreshold,!1)}return e.prototype.get_pendingReplicationStart=function(){return this.pendingReplicationStart},e.prototype.get_pendingReplicationEnd=function(){return this.pendingReplicationEnd},e.prototype.typingStart=function(){!this.get_pendingReplicationStart()&&this._shouldSampleEndToEnd&&(this._shouldSampleEndToEnd=this._endToEndSampler(),this._shouldSampleEndToEnd&&(this.pendingReplicationStart=this._outboundOperationFactory.create(i.i(this,this.SendUpdateNotification,"SendUpdateNotification"),this._phaseSampler(),this._typingToReplicationStartVerifier,this._replicationStartToReplicationEndVerifier),this.get_pendingReplicationStart().typingStart()))},e.prototype.replicationStart=function(){this._shouldSampleEndToEnd=!0,this.pendingReplicationEnd=this.get_pendingReplicationStart(),this.get_pendingReplicationEnd()&&(this.pendingReplicationStart=null,this.get_pendingReplicationEnd().replicationStart())},e.prototype.replicationCancelled=function(){this.pendingReplicationStart=null},e.prototype.replicationEnd=function(e,t){this.get_pendingReplicationEnd()&&this.get_pendingReplicationEnd().replicationEnd(e,t)},e.prototype.SendUpdateNotification=function(e){this._rtcProxy.sendUpdateNotification(6,e,!1)},e.MinCountForAverageThreshold=20,e.TypingToReplicationStartPhase="TypingToOutboundReplicationStart",e.ReplicationStartToReplicationEndPhase="OutboundReplicationStartToOutboundReplicationEnd",e}();(0,i.l)(Q,"7ebd8244$OutboundMonitor",null,[]);var Z=function(){function e(e,t){this._outboundOperationFactory=null,this._outboundOperationVerifierFactory=null,this._outboundOperationFactory=e,this._outboundOperationVerifierFactory=t}return e.prototype.create=function(e,t,n,r,i,o,a){return new Q(this._outboundOperationFactory,e,t,n,this._outboundOperationVerifierFactory,r,i,o,a)},e}();(0,i.l)(Z,"21fde7f0$OutboundMonitorFactory",null,[]);var J=(0,i.y)("98470dc0$IOutboundOperationFactory"),X=(0,i.y)("591f91b4$IOutboundOperation"),Y=(0,i.y)("744f8d87$IReplicationNotificationMessage"),ee=n(1308),te=function(){function e(e){this._rawMessage=null,this._rawMessage=e}return e.prototype.get_rawMessage=function(){return this._rawMessage},e.prototype.ContainsKey=function(e){return!!this._rawMessage&&e in this._rawMessage},e.prototype.get_isValidMessage=function(){return this.ContainsKey(e.DurationKey)&&this.ContainsKey(e.RevisionIdKey)&&this.ContainsKey(e.ShouldSampleKey)},e.prototype.get_revisionId=function(){if(this.ContainsKey(e.RevisionIdKey))return ee.h.createFromString(this._rawMessage[e.RevisionIdKey]);throw Error.create("Unable to parse RevisionIdKey key from dictionary into string")},e.prototype.get_revisionIdAsString=function(){if(this.ContainsKey(e.RevisionIdKey))return this._rawMessage[e.RevisionIdKey];throw Error.create("Unable to cast RevisionIdKey key from dictionary into string")},e.prototype.get_outboundTime=function(){if(this.ContainsKey(e.DurationKey))return Number.parseInvariant(this._rawMessage[e.DurationKey]);throw Error.create("Unable to parse DurationKey key from dictionary into int")},e.prototype.get_shouldSample=function(){if(this.ContainsKey(e.RevisionIdKey))return Boolean.parse(this._rawMessage[e.ShouldSampleKey]);throw Error.create("Unable to parse ShouldSample key from dictionary into bool")},e.prototype.get_numSequentialFailures=function(){if(this.ContainsKey(e.NumSequentialFailuresKey))return Number.parseInvariant(this._rawMessage[e.NumSequentialFailuresKey]);throw Error.create("Unable to parse NumSequentailFailuresKey key from dictionary into int")},e.createFromDictionary=function(t){return new e(t)},e.createFromValues=function(t,n,r,i){var o={};return o[e.DurationKey]=t.toString(),o[e.RevisionIdKey]=n.toString(),o[e.ShouldSampleKey]=r.toString(),o[e.NumSequentialFailuresKey]=i.toString(),new e(o)},e.RevisionIdKey="RevisionID",e.DurationKey="Duration",e.ShouldSampleKey="ShouldSample",e.NumSequentialFailuresKey="NumSequentialFailures",e}();(0,i.l)(te,"a567558e$ReplicationNotificationMessage",null,[Y]);var ne=function(){function e(t,n,r,i,o,a,s){this._perfTrackerFactory=null,this._sendRtcNotification=null,this._currentTime=null,this._numberOfCoauthors=null,this._shouldSamplePhases=!1,this._startTime=0,this._endTime=0,this._typingTracker=null,this._outboundReplicationTracker=null,this._pendingRevisionId=null,this._previousStage=null,this._numSequentialFailures=0,this._usePerfTracker=!1,this._typingToReplicationStartVerifier=null,this._replicationStartToReplicationEndVerifier=null,this._coauthManager=A.App.get_theCoauthManager(),this._actualSequence=[],this._expectedPreviousStage={},this._perfTrackerFactory=t,this._sendRtcNotification=n,this._currentTime=r,this._numberOfCoauthors=i,this._shouldSamplePhases=o,this._pendingRevisionId=null,this._expectedPreviousStage[e.TypingStartStage]=null,this._expectedPreviousStage[e.ReplicationStartStage]=e.TypingStartStage,this._expectedPreviousStage[e.ReplicationEndStage]=e.ReplicationStartStage,this._usePerfTracker=this.get_editorCount()>1,this._typingToReplicationStartVerifier=a,this._replicationStartToReplicationEndVerifier=s}return e.prototype.get_editorCount=function(){return this._numberOfCoauthors()},e.prototype.typingStart=function(){this.CheckCorrectSequence(e.TypingStartStage)&&(this.RecordSequence(e.TypingStartStage),_.ULS.shipAssertTag(8257931,324,!this._outboundReplicationTracker&&!this._endTime,"ReplicationStart or ReplicationEnd were calledbefore TypingStart"),this._startTime=this._currentTime(),this._typingTracker=this._perfTrackerFactory.create(),this.StartPerfTracker(this._typingTracker,D.typingToOutboundReplicationStart))},e.prototype.replicationStart=function(){if(this.CheckCorrectSequence(e.ReplicationStartStage)){if(this.RecordSequence(e.ReplicationStartStage),_.ULS.shipAssertTag(8257932,324,!!this._typingTracker,"TypingStart not called"),this._typingTracker){var t=this.EndPerfTracker(this._typingTracker,this._pendingRevisionId);this._typingToReplicationStartVerifier.reportTime(t)}this._outboundReplicationTracker=this._perfTrackerFactory.create(),this.StartPerfTracker(this._outboundReplicationTracker,D.outboundReplicationStartToOutboundReplicationEnd)}},e.prototype.replicationEnd=function(t,n){if(this.CheckCorrectSequence(e.ReplicationEndStage)){if(this.RecordSequence(e.ReplicationEndStage),this._endTime=this._currentTime(),this._numSequentialFailures=n,_.ULS.shipAssertTag(8257933,324,!!this._outboundReplicationTracker,"ReplicationStart not called"),this._outboundReplicationTracker){_.ULS.shipAssertTag(8193425,324,!!this._outboundReplicationTracker,"ReplicationStart not called");var r=this.EndPerfTracker(this._outboundReplicationTracker,t);this._replicationStartToReplicationEndVerifier.reportTime(r)}if(_.ULS.shipAssertTag(8257934,324,!!this._startTime,"StartTime not set. No message sent to other editors."),this._startTime){var i=te.createFromValues(this._endTime-this._startTime,t,this._shouldSamplePhases,this._numSequentialFailures);this._sendRtcNotification(i.get_rawMessage())}}},e.prototype.CheckCorrectSequence=function(e){return this._expectedPreviousStage[e]===this._previousStage||(_.ULS.shipAssertTag(8422940,324,!1,"{0}",{"Previous stage mismatch":this.ActualSequenceString()}),!1)},e.prototype.ActualSequenceString=function(){var e=new Sys.StringBuilder;e.append("Actual Phase:");for(var t=0;t<this._actualSequence.length;t++)e.append(" "+this._actualSequence[t]);return e.toString()},e.prototype.RecordSequence=function(e){Array.add(this._actualSequence,e),this._previousStage=e},e.prototype.StartPerfTracker=function(e,t){this._usePerfTracker&&e.start(t,null)},e.prototype.EndPerfTracker=function(e,t){if(!this._usePerfTracker)return-1;var n={};n[W.userCount]=j.getUserPivotBucket(this.get_editorCount());var r=(0,N.m)(new V,{P:n,FC:this._numSequentialFailures,CFC:0,ID:t?t.toString():"",CD:0,UC:this.get_editorCount(),RCL:0});return e.end(this._shouldSamplePhases,r)},e.TypingStartStage="TypingStartStage",e.ReplicationStartStage="ReplicationStartStage",e.ReplicationEndStage="ReplicationEndStage",e}();(0,i.l)(ne,"ba9378dd$OutboundOperation",null,[X]);var re=function(){function e(e,t,n){this._perfTrackerFactory=null,this._currentTime=null,this._numberOfCoauthors=null,this._perfTrackerFactory=e,this._currentTime=t,this._numberOfCoauthors=n}return e.prototype.create=function(e,t,n,r){return new ne(this._perfTrackerFactory,e,this._currentTime,this._numberOfCoauthors,t,n,r)},e}();(0,i.l)(re,"a313ebe9$OutboundOperationFactory",null,[J]);var ie=(0,i.y)("d32254e4$IPerfTracker"),oe=function(){function e(e,t){this._aggregator=null,this._stopwatchBuilder=null,this._stopWatch=null,this._name=null,this._compositeName=null,this._stopwatchBuilder=e,this._aggregator=t}return e.prototype.start=function(e,t){this._stopWatch=this._stopwatchBuilder.makeAndStartStopwatch("UserAction",e),this._name=e,this._compositeName=t},e.prototype.end=function(e,t){var n=-1;return e&&(n=this._stopWatch.get_ageInMilliseconds(),t.D=n,t.CN=this._compositeName,t.CD+=n,this._aggregator.track(t,this._name)),n},e}();(0,i.l)(oe,"10fdc58d$PerfTracker",null,[ie]);var ae=function(){function e(e,t){this._stopwatchBuilder=null,this._aggregator=null,this._stopwatchBuilder=e,this._aggregator=t}return e.prototype.create=function(){return new oe(this._stopwatchBuilder,this._aggregator)},e}();(0,i.l)(ae,"ac828c39$PerfTrackerFactory",null,[o]);var se=function(){function e(e,t,n){this._outboundMonitorFactory=null,this._randomSamplerFactory=null,this._outboundMonitor=null,this._inboundMonitor=null,this._outboundMonitorFactory=e,this._inboundMonitor=t,this._randomSamplerFactory=n}return e.prototype.init=function(e,t,n,r,o,a,s){var l=this._randomSamplerFactory.create(t/100),u=this._randomSamplerFactory.create(n/100);this._outboundMonitor=this._outboundMonitorFactory.create(i.i(l,l.shouldBeInSample,"shouldBeInSample"),i.i(u,u.shouldBeInSample,"shouldBeInSample"),e,r,o,a,s)},e.prototype.typingStart=function(){this._outboundMonitor.typingStart()},e.prototype.replicationStart=function(){this._outboundMonitor.replicationStart()},e.prototype.replicationCancelled=function(){this._outboundMonitor.replicationCancelled()},e.prototype.replicationEnd=function(e,t){this._outboundMonitor.replicationEnd(e,t)},e.prototype.inboundReplicationRecieved=function(e,t,n){this._inboundMonitor.replicationReceived(e,t,n)},e.prototype.rtcNotificationReceived=function(e){var t=te.createFromDictionary(e);this._inboundMonitor.rtcNotificationReceived(t),G.m.get_instance().addMark(t.get_revisionId()+"Start")},e.prototype.timeSpanVerifierThresholdExceeded=function(e,t,n){E.r.traceTag(9041820,304,50,"ReplicationTelemetry KPI Threshold Exceeded: [{0}]",this.CreateDictionaryForLogging(e,t,n))},e.prototype.timeSpanVerifierAverageThresholdExceeded=function(e,t,n){E.r.traceTag(9041821,304,50,"ReplicationTelemetry KPI Average Threshold Exceeded: [{0}]",this.CreateDictionaryForLogging(e,t,n))},e.prototype.CreateDictionaryForLogging=function(e,t,n){var r={};return r.PhaseName=e,r.ThresholdValue=t,r.ActualValue=n,r},e}();(0,i.l)(se,"26ce8914$ReplicationTelemetryManager",null,[]);var le=n(1822),ue=n(7847),ce=n(3545),de=(0,i.e)("8c2b823d$IMetric$2"),pe=function(){function e(t,n,r,o){this.name=null,this.dataType=null,i.m(this,e.$$(t,n)),this.name=r,this.dataType=o}return e.prototype.recordMetric=function(){var e=this.getValue();_.ULS.sendTraceTag(40468817,306,50,"Metric recorded: [Name:{0}] [Datatype: {1}] [Value: {2}]",this.name,this.dataType,e)},e.$$=function(t,n){return i.o("Common.AMetric$2",e,[{T1:t},{T2:n}],null,[de.$$(t,n)],{})},e}(),ge=function(e){function t(t,n){var r=e.call(this,Number,Number,t,n)||this;return r._sum=0,r._count=0,r}return(0,ce.t)(t,e),t.prototype.recordDataPoint=function(e){this._sum+=e,this._count++},t.prototype.getValue=function(){return this._count?this._sum/this._count:0},t.prototype.resetMetric=function(){this._sum=0,this._count=0},t}(pe);(0,i.l)(ge,"e3e36757$AverageMetric",pe.$$(Number,Number),[]);var he=function(e){function t(t,n){var r=e.call(this,Object,Number,t,n)||this;return r._count=0,r}return(0,ce.t)(t,e),t.prototype.recordDataPoint=function(e){this._count++},t.prototype.getValue=function(){return this._count},t.prototype.resetMetric=function(){this._count=0},t}(pe);(0,i.l)(he,"81cc0120$CounterMetric",pe.$$(Object,Number),[]);var _e=function(e){function t(t,n){var r=e.call(this,Number,Number,t,n)||this;return r._max=0,r}return(0,ce.t)(t,e),t.prototype.recordDataPoint=function(e){e>this._max&&(this._max=e)},t.prototype.getValue=function(){return this._max},t.prototype.resetMetric=function(){this._max=0},t}(pe);(0,i.l)(_e,"54edf500$MaxMetric",pe.$$(Number,Number),[]);var fe=n(5967),me=function(e){function t(t,n,r){var i=e.call(this,Number,Number,t,n)||this;return i._rollingWindowSize=0,i._rollingWindowValues=null,i._sumOfRollingWindowValues=0,i._numOfValues=0,i._maxRollingAvg=0,i._rollingWindowSize=r,i._rollingWindowValues=new fe.z(Number,i._rollingWindowSize),i}return(0,ce.t)(t,e),t.prototype.recordDataPoint=function(e){if(this._numOfValues===this._rollingWindowSize){var t=this._rollingWindowValues.dequeue();this._sumOfRollingWindowValues-=t,this._numOfValues--}this._rollingWindowValues.enqueue(e),this._sumOfRollingWindowValues+=e,this._numOfValues++;var n=this._sumOfRollingWindowValues/this._numOfValues;n>this._maxRollingAvg&&this._numOfValues===this._rollingWindowSize&&(this._maxRollingAvg=n)},t.prototype.getValue=function(){return this._maxRollingAvg},t.prototype.resetMetric=function(){this._maxRollingAvg=0,this._rollingWindowValues=new fe.z(Number,this._rollingWindowSize),this._sumOfRollingWindowValues=0,this._numOfValues=0},t}(pe);(0,i.l)(me,"a972fe3e$MaxRollingAverageMetric",pe.$$(Number,Number),[]);var ye=function(e){function t(t,n,r,i,o){var a=e.call(this,Number,Number,t,n)||this;return a._countEqualOrSmaller=0,a._countLarger=0,a._value=0,a._warnOnThreshold=!1,a._thresholdPercentile=0,a._value=r,a._warnOnThreshold=o,a._thresholdPercentile=i,a}return(0,ce.t)(t,e),t.prototype.recordDataPoint=function(e){e<=this._value?this._countEqualOrSmaller++:this._countLarger++},t.prototype.getValue=function(){var e=100;return this._countEqualOrSmaller+this._countLarger>0&&(e=this._countEqualOrSmaller/(this._countEqualOrSmaller+this._countLarger)*100),e},t.prototype.resetMetric=function(){this._countEqualOrSmaller=0,this._countLarger=0},t.prototype.recordMetric=function(){pe.prototype.recordMetric.call(this);var e=this.getValue();if(this.getValue()<this._thresholdPercentile){var t=this._countEqualOrSmaller+this._countLarger;_.ULS.sendTraceTag(42050255,306,this._warnOnThreshold?15:50,"Metric recorded: [Name:{0}] [Datatype: {1}] [Value: {2}], [CountEqualOrSmaller: {3}]. [CountTotal: {4}]",this.name,this.dataType,e,this._countEqualOrSmaller,t)}},t}(pe);(0,i.l)(ye,"d8ecdab1$PercentileAtValueMetric",pe.$$(Number,Number),[]);var ve=function(){function e(e,t){this._avgMetric=null,this._maxMetric=null,this._maxRollingAvgMetric=null,this._counterMetric=null,this._percentileAtSlowValueMetric=null,this._percentileAtBrokenSlowValueMetric=null,this._warnOnMetricThreshold=!1,this._warnOnMetricThreshold=t,this._avgMetric=new ge(e+"-AverageValue","Milliseconds"),this._maxMetric=new _e(e+"-MaxValue","Milliseconds"),this._maxRollingAvgMetric=new me(e+"-MaxRollingAverageValue","Milliseconds",100),this._counterMetric=new he(e+"-NumberOfEvents","Count"),this._percentileAtSlowValueMetric=new ye(e+"-SlowPercentileAtValue","Percentile",f.AFrameworkApplication.appSettingsManager.getDoubleAppSetting("CoAuthLatencySlowTargetValue",3e3),f.AFrameworkApplication.appSettingsManager.getDoubleAppSetting("CoAuthLatencySlowThresholdPercentile",95),this._warnOnMetricThreshold),this._percentileAtBrokenSlowValueMetric=new ye(e+"-BrokenSlowPercentileAtValue","Percentile",f.AFrameworkApplication.appSettingsManager.getDoubleAppSetting("CoAuthLatencyBrokenSlowTargetValue",5e3),f.AFrameworkApplication.appSettingsManager.getDoubleAppSetting("CoAuthLatencyBrokenSlowThresholdPercentile",95),this._warnOnMetricThreshold)}return e.prototype.recordTimestamp=function(e){this._avgMetric.recordDataPoint(e),this._maxMetric.recordDataPoint(e),this._maxRollingAvgMetric.recordDataPoint(e),this._counterMetric.recordDataPoint(e),this._percentileAtSlowValueMetric.recordDataPoint(e),this._percentileAtBrokenSlowValueMetric.recordDataPoint(e)},e.prototype.recordAndResetMetrics=function(){this._avgMetric.recordMetric(),this._maxMetric.recordMetric(),this._maxRollingAvgMetric.recordMetric(),this._counterMetric.recordMetric(),this._percentileAtSlowValueMetric.recordMetric(),this._percentileAtBrokenSlowValueMetric.recordMetric(),this._avgMetric.resetMetric(),this._maxMetric.resetMetric(),this._maxRollingAvgMetric.resetMetric(),this._counterMetric.resetMetric(),this._percentileAtSlowValueMetric.resetMetric(),this._percentileAtBrokenSlowValueMetric.resetMetric()},e}();(0,i.l)(ve,"895b6157$ReplicationLatencyMetrics",null,[]);var Se=function(){function e(){this._latencyMetricsPerPhase=new ue.w(ve)}return e.prototype.recordTimespan=function(e,t,n){var r;t<0||(this._latencyMetricsPerPhase.tryGetValue(e,(0,le.m)((function(){return r}),(function(e){return r=e})))||(r=new ve(e,n),this._latencyMetricsPerPhase.set_item(e,r)),r.recordTimestamp(t))},e.prototype.recordAndResetMetrics=function(){for(var e=this._latencyMetricsPerPhase.get_values().$$ge();e.$$mn();){e.$$cu().recordAndResetMetrics()}},e}();(0,i.l)(Se,"7e679363$ReplicationTelemetryMetricsManager",null,[s]);var Ie=function(){function e(){}return e.prototype.recordTimespan=function(e,t,n){},e.prototype.recordAndResetMetrics=function(){},e}();(0,i.l)(Ie,"b1977f53$ReplicationTelemetryMetricsManagerStub",null,[s]);var Ce=(0,i.y)("43892463$ITaskAndRequestDataAggregator"),Te=n(6414),be=function(){return function(){}}();(0,i.l)(be,"56aaf5a1$TaskTelemetryMetrics",null,[]);var Ae=(0,i.y)("6a78cf25$IRequestStatusListener"),Me=n(8837),Pe=n(814),Fe=function(){return function(){this.requestCount=0,this.sentCount=0,this.succeededCount=0,this.timeoutCount=0,this.failedCount=0}}();(0,i.l)(Fe,"ffa01249$GetPutChangesRequestData",null,[]);var we=function(){function e(){this.getChangesRequestData=null,this.putChangesRequestData=null,this.lastRequestData=null,this.lastRequestData=new Me.g,this.TakeSnapShotOfCurrentClientRequestManagerTelemetryStorage(f.AFrameworkApplication.theClientRequestManager.get_telemetryStorage())}return e.prototype.reset=function(){this.getChangesRequestData=new Fe,this.putChangesRequestData=new Fe},e.prototype.pendingRequestsModified=function(e,t){if(t.extraInfo){var n=t.extraInfo[Pe.n.keyOfGetChanges]?t.extraInfo[Pe.n.keyOfGetChanges]:0,r=t.extraInfo[Pe.n.keyOfPutChanges]?t.extraInfo[Pe.n.keyOfPutChanges]:0;if(n||r)return t.status?1===t.status?(this.getChangesRequestData.sentCount+=n,void(this.putChangesRequestData.sentCount+=r)):2===t.status?(this.getChangesRequestData.succeededCount+=n,void(this.putChangesRequestData.succeededCount+=r)):7===t.status?(this.getChangesRequestData.timeoutCount+=n,void(this.putChangesRequestData.timeoutCount+=r)):3===t.status?(this.getChangesRequestData.failedCount+=n,void(this.putChangesRequestData.failedCount+=r)):void 0:(this.getChangesRequestData.requestCount+=n,void(this.putChangesRequestData.requestCount+=r))}},e.prototype.getClientRequestDataFromLastQuery=function(){var e=f.AFrameworkApplication.theClientRequestManager.get_telemetryStorage(),t=(0,N.m)(new Me.g,{noOpenConnectionCount:e.noOpenConnectionCount-this.lastRequestData.noOpenConnectionCount,invokeCount:e.invokeCount-this.lastRequestData.invokeCount,invokeSentCount:e.invokeSentCount-this.lastRequestData.invokeSentCount,invokeFailedCount:e.invokeFailedCount-this.lastRequestData.invokeFailedCount,invokeTimeoutCount:e.invokeTimeoutCount-this.lastRequestData.invokeTimeoutCount,succeededCount:e.succeededCount-this.lastRequestData.succeededCount,failedCount:e.failedCount-this.lastRequestData.failedCount,timeoutCount:e.timeoutCount-this.lastRequestData.timeoutCount,synchronousNotificationCount:e.synchronousNotificationCount-this.lastRequestData.synchronousNotificationCount});return this.TakeSnapShotOfCurrentClientRequestManagerTelemetryStorage(e),t},e.prototype.retrieveGetPutChangesRequestData=function(){var e={};return e.GetChanges=this.getChangesRequestData,e.PutChanges=this.putChangesRequestData,this.reset(),e},e.prototype.TakeSnapShotOfCurrentClientRequestManagerTelemetryStorage=function(e){this.lastRequestData.noOpenConnectionCount=e.noOpenConnectionCount,this.lastRequestData.invokeCount=e.invokeCount,this.lastRequestData.invokeSentCount=e.invokeSentCount,this.lastRequestData.invokeFailedCount=e.invokeFailedCount,this.lastRequestData.invokeTimeoutCount=e.invokeTimeoutCount,this.lastRequestData.succeededCount=e.succeededCount,this.lastRequestData.failedCount=e.failedCount,this.lastRequestData.timeoutCount=e.timeoutCount,this.lastRequestData.synchronousNotificationCount=e.synchronousNotificationCount},e.get_instance=function(){return e._instance||(e._instance=new e,f.AFrameworkApplication.theClientRequestManager.addRequestStatusListener(e.get_instance()),e._instance.reset()),e._instance},e._instance=null,e}();(0,i.l)(we,"4dd24618$BatchedServerOperationTelemetry",null,[Ae]);var Re=function(){function e(t){this._taskAggregator=null,this._numberOfCoauthors=null,this._frames=null,i.m(this,e.$$(t))}return e.prototype.onCpuMeterTaskMeasured=function(e){var t=(0,N.m)(new be,{TIP:e.TP,TQT:e.TQT,TDT:e.TDT,UC:this._numberOfCoauthors()});this._taskAggregator.aggregate(t,e.TN)},e.prototype.initialize=function(e,t){this._taskAggregator=e,this._numberOfCoauthors=t},e.prototype.aggregate=function(e,t){var n={};n.GetPutChangesData=we.get_instance().retrieveGetPutChangesRequestData(),n.RequestData=we.get_instance().getClientRequestDataFromLastQuery().generateLogDictionary(),n.TaskData=this._taskAggregator.getData(),this._frames||(this._frames=[]),Array.add(this._frames,n)},e.prototype.getData=function(){return this._frames},e.prototype.reset=function(){this._frames=null},e.$$=function(t){return i.o("B4RT.TaskAndRequestDataAggregator$1",e,[{T:t}],null,[Ce,Te.k.$$(t)],{})},e}(),Ee=(0,i.y)("d321e934$ITimeSpanVerifier"),ke=function(){function e(e,t,n,r,i,o,a){this._phaseName=null,this._thresholdInMs=0,this._averageThresholdInMs=0,this._totalTime=0,this._totalCount=0,this._minCountForAverageThreshold=0,this._metricsManager=null,this._timeSpanVerifierNotifier=null,this._warnOnMetricThreshold=!1,this._metricsManager=e,this._phaseName=n,this._thresholdInMs=r,this._averageThresholdInMs=i,this._timeSpanVerifierNotifier=t,this._minCountForAverageThreshold=o,this._warnOnMetricThreshold=a}return e.prototype.reportTime=function(e){this._metricsManager.recordTimespan(this._phaseName,e,this._warnOnMetricThreshold),e>this._thresholdInMs&&this._timeSpanVerifierNotifier.thresholdExceeded(this._phaseName,this._thresholdInMs,e),this._totalTime+=e,this._totalCount++,this._totalTime/this._totalCount>this._averageThresholdInMs&&this._totalCount>this._minCountForAverageThreshold&&this._timeSpanVerifierNotifier.averageThresholdExceeded(this._phaseName,this._averageThresholdInMs,this._totalTime/this._totalCount)},e}();(0,i.l)(ke,"49e8e05d$TimeSpanVerifier",null,[Ee]);var De=function(){function e(e,t){this._replicationTelemetryMetricsManager=null,this._timeSpanVerifierNotifier=null,this._replicationTelemetryMetricsManager=e,this._timeSpanVerifierNotifier=t}return e.prototype.create=function(e,t,n,r,i){return new ke(this._replicationTelemetryMetricsManager,this._timeSpanVerifierNotifier,e,t,n,r,i)},e}();(0,i.l)(De,"1ad252e9$TimeSpanVerifierFactory",null,[l]);var Oe=n(4072),Ue=function(e){function t(t,n,r){var i=e.call(this)||this;return i.replicationTelemetryPhase=null,i.thresholdValue=0,i.actualValue=0,i.replicationTelemetryPhase=t,i.thresholdValue=n,i.actualValue=r,i}return(0,ce.t)(t,e),t.prototype.get_replicationTelemetryPhase=function(){return this.replicationTelemetryPhase},t.prototype.get_thresholdValue=function(){return this.thresholdValue},t.prototype.get_actualValue=function(){return this.actualValue},t}(Sys.EventArgs);(0,i.l)(Ue,"52dbd36$TimeSpanVerifierEventArgs",Sys.EventArgs,[]);var xe=function(){function e(){this._eventSource=new Oe.f}return e.prototype.thresholdExceeded=function(t,n,r){this._eventSource.raiseEvent(e.TimeSpanVerifierThresholdExceededEventId,new Ue(t,n,r),null)},e.prototype.averageThresholdExceeded=function(t,n,r){this._eventSource.raiseEvent(e.TimeSpanVerifierAverageThresholdExceededEventId,new Ue(t,n,r),null)},e.prototype.add_onThresholdExceeded=function(t){this._eventSource.addHandler(e.TimeSpanVerifierThresholdExceededEventId,t)},e.prototype.remove_onThresholdExceeded=function(t){this._eventSource.removeHandler(e.TimeSpanVerifierThresholdExceededEventId,t)},e.prototype.add_onAverageThresholdExceeded=function(t){this._eventSource.addHandler(e.TimeSpanVerifierAverageThresholdExceededEventId,t)},e.prototype.remove_onAverageThresholdExceeded=function(t){this._eventSource.removeHandler(e.TimeSpanVerifierAverageThresholdExceededEventId,t)},e.TimeSpanVerifierThresholdExceededEventId="TSVTE",e.TimeSpanVerifierAverageThresholdExceededEventId="TSVATE",e}();(0,i.l)(xe,"a776f659$TimeSpanVerifierNotifier",null,[a]);var Le=n(8363),Ne=function(){function e(){}return e.prototype.get_name=function(){return"Box4.ReplicationTelemetry"},e.prototype.configure=function(t){t.register(o).singleInstance().usingFactory((function(){return new ae(A.App.get_activeAppFrame().get_theStopwatchBuilder(),y.n.$$(V).getAnInstance(20,1,new v.c(V,null),!0,null))})),t.register(a).singleInstance().usingFactory((function(){return new xe})),f.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("Box4ReplicationTelemetryMetricsIsEnabled")?t.register(s).singleInstance().usingFactory((function(){return new Se})):t.register(s).singleInstance().usingFactory((function(){return new Ie})),t.register(l).singleInstance().usingFactory((function(){return new De(t.resolve(s),t.resolve(a))})),t.register(re).singleInstance().usingFactory((function(){return new re(t.resolve(o),(function(){return(new Date).getTime()}),e.GetEditorsCount)})),t.register(Z).singleInstance().usingFactory((function(){return new Z(t.resolve(re),t.resolve(l))})),t.register(K).singleInstance().usingFactory((function(){return new K(t.resolve(o),(function(){return(new Date).getTime()}),e.GetEditorsCount)}));var n=new U(t.resolve(o),(function(){return(new Date).getTime()}),t.resolve(K),t.resolve(l));t.register(u).singleInstance().usingFactory((function(){return n.create(f.AFrameworkApplication.appSettingsManager.getIntAppSetting("Box4ReplicationTelemetryInboundOperationThreshold",0),f.AFrameworkApplication.appSettingsManager.getIntAppSetting("Box4ReplicationTelemetryInboundOperationAverageThreshold",0),f.AFrameworkApplication.appSettingsManager.getIntAppSetting("Box4ReplicationTelemetryTypingToInboundEndThreshold",0),f.AFrameworkApplication.appSettingsManager.getIntAppSetting("Box4ReplicationTelemetryTypingToInboundEndAverageThreshold",0))})),t.register(c.v).singleInstance().usingFactory((function(){return new C})),t.register(se).singleInstance().usingFactory((function(){return new se(t.resolve(Z),t.resolve(u),t.resolve(c.v))})),t.register(F).usingFactory((function(){return new F(Le.y.get_instance(),t.resolve(a),t.resolve(M.a))}))},e.prototype.init=function(){var t=f.AFrameworkApplication.appSettingsManager;if(t.getBooleanAppSetting("Box4ReplicationTelemetryIsEnabled")){var n=t.getIntAppSetting("Box4ReplicationTelemetrySamplePercent",0),r=t.getIntAppSetting("Box4ReplicationTelemetryPhaseSamplePercent",0),i=t.getIntAppSetting("Box4ReplicationTelemetryTypingToReplicationStartThreshold",0),o=t.getIntAppSetting("Box4ReplicationTelemetryTypingToReplicationStartAverageThreshold",0),a=t.getIntAppSetting("Box4ReplicationTelemetryReplicationStartToReplicationEndThreshold",0),l=t.getIntAppSetting("Box4ReplicationTelemetryReplicationStartToReplicationEndAverageThreshold",0);T.w.get_instance().resolveFuture(d.q).execute((function(s){s.getInstanceAsync().CW((function(d){var g=s.getInstanceAsync().get_result(),h=T.w.get_instance().resolve(se);h.init(g,n,r,i,o,a,l),T.w.get_instance().resolve(F).create(g,h);var I=T.w.get_instance().resolve(u),C=new Re(Object),A=b.q.taskFromFuture(p.o,T.w.get_instance().resolveFuture(p.o));A.CW((function(n){if(t.getBooleanAppSetting("LogSteppedInboundFrameIsEnabled")){var r=new S.m(q,(function(){return!0})),i=y.n.$$(q).getAnInstance(19,1,r,!0,null);I.initialize(i)}var o=t.getDoubleAppSetting("LogTaskManagerTelemetrySamplingPercentage",25),a=T.w.get_instance().resolve(c.v).create(o/100),s=new v.c(be,a);C.initialize(s,e.GetEditorsCount);var l=t.getIntAppSetting("LogTaskManagerTelemetryAggregationIntervalInMinutes",5),u=y.n.$$(Object).getAnInstance(21,l,C,!0,null),d=t.getIntAppSetting("TaskAndRequestTelemetryIntervalInMinutes",1),p=new m.c(2,2,60*d*1e3,(function(e){u.track("",null)}),0,null,!1);p.name="TaskAndRequestDataAggregator",f.AFrameworkApplication.get_theTaskManager().addTask(p);var g=A.get_result().getCpuMeterAsync();g.CW((function(e){t.getBooleanAppSetting("LogSteppedInboundFrameIsEnabled")&&(g.get_result().addCpuMeterTaskEventWithFilter(0,(function(e){return I.shouldSendMeasuredTask(e)}),(function(e){I.onCpuMeterTaskMeasured(e)})),g.get_result().addCpuMeterTaskEventWithFilter(1,(function(e){return I.shouldSendAddedTask(e)}),(function(e){I.onCpuMeterTaskAdded(e)}))),g.get_result().addCpuMeterTaskEventWithFilter(0,(function(e){return!0}),(function(e){C.onCpuMeterTaskMeasured(e)}))}))})),_.ULS.sendTraceTag(8257935,305,50,"ReplicationTelemetry init")}))})),f.AFrameworkApplication.subscribeToBeforeAppShutDown((function(e,t){T.w.get_instance().resolve(s).recordAndResetMetrics()}))}},e.prototype.dispose=function(){},e.GetEditorsCount=function(){var e=A.App.get_theCoauthManager();return e?e.get_editorsCount():0},e}();(0,i.l)(Ne,"3468609d$ReplicationTelemetryPackage",null,[g.u,h.s]),n.d(t,{Program:function(){return Be}});var Be=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new Ne,0,!1)},e}();(0,i.l)(Be,"d7f06c0$Program",null,[])},4084:function(e,t,n){"use strict";n.r(t);var r=n(953),i=n(4741),o=n(423),a=function(){function e(e,t){this._aggregator=null,this._index=0,this._aggregator=e,this._index=t}return e.prototype.resultsUpdated=function(e){this._aggregator.setResultUpdatedEventArgs(this._index,e)},e}();(0,o.l)(a,"50b96896$AggregatorResultsProviderCallback",null,[i.k]);var s=n(3888),l=n(6307),u=function(){function e(e){this._applicationData=null,this._addInCommandProvider=null,this._applicationData=e,this._applicationData.get_appsForOfficeEnabled()&&(this._addInCommandProvider=this._applicationData.getAppsForOfficeResultsProvider())}return e.prototype.issueQuery=function(e,t,n){var r=new s.z(1);this._addInCommandProvider.addTopOneRecommendationToResultGroup(r,e.queryText);var i=new l.v;i.addResultGroup(r),i.set_query(e),t.resultsUpdated(i)},e}();(0,o.l)(u,"67516d86$AppsForOfficeRecommendationResultsProvider",null,[r.m]);var c=n(904),d=n(6378),p=function(){function e(){}return e.prototype.issueQuery=function(t,n,r){if(e.IsValidQuery(t)){var i,o=new s.z(7);if(r){var a=d.l.toUpper(CommonUIStrings.l_HelpTooltip)===d.l.toUpper(t.queryText.trim())?CommonUIStrings.l_HelpButtonTextNoPlaceholder:String.format(CommonUIStrings.l_HelpButtonTextWithQuotation,t.queryText),u="||"+t.queryText,p=new Array(0);p.push(appChrome.actions.setControlLabel(e.AssistanceSimplifiedCommandId,a)),p.push(appChrome.actions.setButtonCommandValueId(e.AssistanceSimplifiedCommandId,u)),appChrome.api.dispatch(p),i=new c.b(e.AssistanceSimplifiedCommandId,0,null,null)}else i=new c.b(t.queryText,0,null,null);o.addResult(i),o.set_displayName(CommonUIStrings.l_HelpButtonTitle);var g=new l.v;g.addResultGroup(o),g.set_query(t),n.resultsUpdated(g)}},e.IsValidQuery=function(e){return!!e&&!!e.queryText&&""!==e.queryText.trim()},e.AssistanceSimplifiedCommandId="GetHelpFromTellMe",e}();(0,o.l)(p,"ee856e40$AssistanceResultsProvider",null,[r.m]);var g=n(7597),h=n(2575),_=function(){function e(e,t){if(this._predictions=null,this._attributes=null,!e)throw Error.argumentNull("predictions");if(!t)throw Error.argumentNull("attributes");this._predictions=e,this._attributes=t}return e.prototype.getPredictions=function(){return this._predictions},e.prototype.getAllTokenAttributes=function(){return this._attributes},e}();(0,o.l)(_,"92aa9e41$PredictionsWithTokenAttributes",null,[]);var f=n(9921),m=n(1822),y=n(2093),v=n(4427),S=(0,o.y)("f81464bb$IFilterFactory"),I=n(1326),C=(0,o.y)("4133654f$IFilter"),T=function(){function e(e,t){this.m_init=null,this.m_fAttrOptional=!1,this.m_init=e,this.m_fAttrOptional=t}return e.prototype.isMatch=function(e,t,n){if(!o.r(I.m,e))throw Error.argument("objToTest","Expected feature bundle");var r;return e.tryGetAnnotation_Cast(Object,this.m_init.attributeID,(0,m.m)((function(){return r}),(function(e){return r=e})))?this.m_init.valueFilter.isMatch(r,t,null):this.m_fAttrOptional},e}();(0,o.l)(T,"12ca2a28$AnnotatedWithAndValueMatchesAnnotationFilter",null,[C]);var b=function(){function e(e,t){this.m_init=null,this.m_fNegate=!1,this.m_init=e,this.m_fNegate=t}return e.prototype.isMatch=function(e,t,n){if(!o.r(I.m,e))throw Error.argument("objToTest","Expected feature bundle");var r,i=e;return!!(this.m_fNegate^i.tryGetAnnotation_Cast(Object,this.m_init.attributeID,(0,m.m)((function(){return r}),(function(e){return r=e}))))},e}();(0,o.l)(b,"29d0e84d$AnnotatedWithAnnotationFilter",null,[C]);var A=n(3692),M=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if(!o.r(A.w,e))throw Error.argument("objToTest","Expected struct value");var r=e;return this.m_init.valueFilter.isMatch(r.getFieldValue(this.m_init.fieldIndex),t,null)},e}();(0,o.l)(M,"f2872b5d$FieldValueMatchesStructFilter",null,[C]);var P=function(){return function(e,t){this.fieldIndex=0,this.valueFilter=null,e&&(this.fieldIndex=e.get_item(0),this.valueFilter=t.getFilter(e.get_item(1)))}}();(0,o.l)(P,"d6c300e7$FieldValueMatchesStructFilterInit",null,[]);var F=function(){function e(e){this.m_fNegate=!1,this.m_fNegate=e}return e.prototype.isMatch=function(e,t,n){if(!o.r(I.m,e))throw Error.argument("objToTest","Expected feature bundle");var r=e;return!!(this.m_fNegate^r.get_hasAnnotations())},e}();(0,o.l)(F,"f845724f$HasAnnotationsAnnotationFilter",null,[C]);var w=function(){function e(e,t){this.m_init=null,this.m_type=0,this.m_init=e,this.m_type=t}return e.prototype.isMatch=function(e,t,n){if(!o.r(f.z,e))throw Error.argument("objToTest","Expected list value");var r=e;switch(this.m_type){case 0:for(var i=0,a=r.get_items();i<a.length;i++){var s=a[i];if(this.m_init.filter.isMatch(s,t,null))return!0}return!1;case 1:for(var l=0,u=r.get_items();l<u.length;l++){s=u[l];if(!this.m_init.filter.isMatch(s,t,null))return!1}return!0;default:throw Error.notImplemented()}},e}();(0,o.l)(w,"a842747$ItemTestListFilter",null,[C]);var R=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if(!o.r(f.z,e))throw Error.argument("objToTest","Expected list value");var r=e;return this.m_init.filter.isMatch(r.get_items().length,t,null)},e}();(0,o.l)(R,"efcdd11d$LengthMatchesListFilter",null,[C]);var E=function(){function e(e,t){this.m_init=null,this.m_type=0,this.m_init=e,this.m_type=t}return e.prototype.isMatch=function(e,t,n){for(var r=!this.m_type,i=0,o=this.m_init.childFilters;i<o.length;i++){if((r=o[i].isMatch(e,t,n))?1===this.m_type:!this.m_type)return r}return 2===this.m_type&&(r=!r),r},e}();(0,o.l)(E,"3d98ea6d$NonterminalFilter",null,[C]);var k=function(){return function(e,t){if(this.childFilters=null,e){var n=e.get_item(0);this.childFilters=new Array(n);for(var r=0;r<n;++r)this.childFilters[r]=t.getFilter(e.get_item(1+r))}}}();(0,o.l)(k,"7fafdd7$NonterminalFilterInit",null,[]);var D=function(){function e(e,t){this.m_init=null,this.m_type=0,this.m_init=e,this.m_type=t}return e.prototype.isMatch=function(e,t,n){if("number"!=typeof e)throw Error.argument("objToTest","Expected number value");var r=e,i=this.m_init.number;if(this.m_init.query){var o=this.m_init.query.loadInternal(null,t);if("number"!=typeof o)throw Error.invalidOperation("Query did not return number");i+=o}switch(this.m_type){case 0:return r===i;case 1:return r<i;case 2:return r<=i;case 3:return r>i;case 4:return r>=i;default:throw Error.notImplemented()}},e}();(0,o.l)(D,"76735d05$NumberFilter",null,[C]);var O=function(){return function(e,t){this.number=0,this.query=null,e&&(this.number=e.get_item(0),this.query=e.get_item(1)?t.getAnnotationQuery(e.get_item(1)):null)}}();(0,o.l)(O,"fc0ac17f$NumberFilterInit",null,[]);var U=(0,o.y)("94104c2a$INamedFeatureBundleResolver"),x=function(){function e(e,t,n){this.m_name=null,this.m_featureBundle=null,this.m_fallbackResolver=null,this.getFeatureBundle=this.GetFeatureBundle,this.get_isReturningSingleMatchCapturesForSREs=this.get_IsReturningSingleMatchCapturesForSREs,this.get_attr_Capture_Matches=this.get_Attr_Capture_Matches,this.get_attr_Capture_FirstSpanIndex=this.get_Attr_Capture_FirstSpanIndex,this.get_attr_Capture_NumOfSpans=this.get_Attr_Capture_NumOfSpans,this.m_name=e,this.m_featureBundle=t,this.m_fallbackResolver=n}return e.prototype.changeFeatureBundle=function(e){this.m_featureBundle=e},e.prototype.GetFeatureBundle=function(e){if(!e)throw Error.argument("name","Invalid named feature bundle reference");var t=e.charCodeAt(0),n=e.substr(1);return 1===t&&n===this.m_name?this.m_featureBundle:this.m_fallbackResolver?this.m_fallbackResolver.getFeatureBundle(e):null},e.prototype.get_IsReturningSingleMatchCapturesForSREs=function(){return!!this.m_fallbackResolver&&this.m_fallbackResolver.get_isReturningSingleMatchCapturesForSREs()},e.prototype.get_Attr_Capture_Matches=function(){return this.m_fallbackResolver?this.m_fallbackResolver.get_attr_Capture_Matches():-1},e.prototype.get_Attr_Capture_FirstSpanIndex=function(){return this.m_fallbackResolver?this.m_fallbackResolver.get_attr_Capture_FirstSpanIndex():-1},e.prototype.get_Attr_Capture_NumOfSpans=function(){return this.m_fallbackResolver?this.m_fallbackResolver.get_attr_Capture_NumOfSpans():-1},e}();(0,o.l)(x,"b8c2398d$SimpleNamedFeatureBundleResolver",null,[U]);var L=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if(!o.r(I.m,e))throw Error.argument("objToTest","Expected feature bundle");var r=e,i=this.m_init.query.loadInternal(null,new x(this.m_init.varName,r,t));if("boolean"!=typeof i)throw Error.invalidOperation("Query did not return bool");return i},e}();(0,o.l)(L,"ae6df8b8$PredicateAnnotationFilter",null,[C]);var N=function(){return function(e,t){this.varName=null,this.query=null,e&&(this.varName=t.getString(e.get_item(0)),this.query=t.getAnnotationQuery(e.get_item(1)))}}();(0,o.l)(N,"c4cc7e42$PredicateAnnotationFilterInit",null,[]);var B=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if("boolean"!=typeof e)throw Error.argument("objToTest","Expected bool value");var r=this.m_init.query.loadInternal(null,t);if("boolean"!=typeof r)throw Error.invalidOperation("Query did not return bool");return e===r},e}();(0,o.l)(B,"1344d3c8$QueryBooleanFilter",null,[C]);var H=function(){function e(e,t){this.m_init=null,this.m_type=0,this.m_init=e,this.m_type=t}return e.prototype.isMatch=function(e,t,n){if("number"!=typeof e)throw Error.argument("objToTest","Expected integer");var r=e,i=this.m_init.query.loadInternal(null,t);if("number"!=typeof i)throw Error.invalidOperation("Query did not return an enum value");var o=i;switch(this.m_type){case 0:return r===o;case 1:return 0!=(r&o);case 2:return r===(r&o);case 3:return o===(r&o);default:throw Error.notImplemented()}},e}();(0,o.l)(H,"82ed675f$QueryEnumFilter",null,[C]);var $=function(){return function(e,t){this.isMultiSelectEnum=!1,this.query=null,e&&(this.isMultiSelectEnum=1===e.get_item(0),this.query=t.getAnnotationQuery(e.get_item(1)))}}();(0,o.l)($,"50199c65$QueryEnumFilterInit",null,[]);var G=function(){function e(e,t){this.m_init=null,this.m_type=0,this.m_init=e,this.m_type=t}return e.prototype.isMatch=function(e,t,n){if(!o.r(f.z,e))throw Error.argument("objToTest","Expected list value");var r=e,i=this.m_init.query.loadInternal(null,t);if(!o.r(f.z,i))throw Error.invalidOperation("Query did not return list value");var a=i;if(r.get_memberTypeID()!==a.get_memberTypeID())return!1;switch(this.m_type){case 0:return y.Annotations.ValuesAreEqual(y.Annotations.getListTypeID(r.get_memberTypeID()),r,a);case 1:for(var s=0,l=r.get_items();s<l.length;s++)for(var u=l[s],c=0,d=a.get_items();c<d.length;c++){var p=d[c];if(y.Annotations.ValuesAreEqual(r.get_memberTypeID(),u,p))return!0}return!1;case 2:for(var g=0,h=r.get_items();g<h.length;g++){u=h[g];for(var _=0,m=a.get_items();_<m.length;_++){p=m[_];if(!y.Annotations.ValuesAreEqual(r.get_memberTypeID(),u,p))return!1}}return!0;case 3:for(var v=0,S=a.get_items();v<S.length;v++){u=S[v];for(var I=0,C=r.get_items();I<C.length;I++){p=C[I];if(!y.Annotations.ValuesAreEqual(r.get_memberTypeID(),u,p))return!1}}return!0;default:throw Error.notImplemented()}},e}();(0,o.l)(G,"3097a24e$QueryListFilter",null,[C]);var W=function(){function e(e,t){this.m_init=null,this.m_type=0,this.m_init=e,this.m_type=t}return e.prototype.isMatch=function(e,t,n){if("string"!=typeof e)throw Error.argument("objToTest","Expected string");var r=e,i=this.m_init.query.loadInternal(null,t);if("string"!=typeof i)throw Error.invalidOperation("Query did not return string");var o=i;switch(this.m_init.isCaseInsensitive&&(r=r.toUpperCase(),o=o.toUpperCase()),this.m_type){case 0:return r===o;case 1:return r.indexOf(o)>=0;case 2:return r.startsWith(o);case 3:return r.endsWith(o);case 4:return o.indexOf(r)>=0;case 5:return o.startsWith(r);case 6:return o.endsWith(r);default:throw Error.notImplemented()}},e}();(0,o.l)(W,"c77ee779$QueryStringFilter",null,[C]);var V=function(){return function(e,t){this.query=null,this.isCaseInsensitive=!1,e&&(this.query=t.getAnnotationQuery(e.get_item(0)),this.isCaseInsensitive=1===e.get_item(1))}}();(0,o.l)(V,"46caba83$QueryStringFilterInit",null,[]);var j=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if(!o.r(A.w,e))throw Error.argument("objToTest","Expected struct value");var r=e,i=this.m_init.query.loadInternal(null,t);if(!o.r(A.w,i))throw Error.invalidOperation("Query did not return struct value");var a=e;return r.isEqual(a)},e}();(0,o.l)(j,"207f445b$QueryStructFilter",null,[C]);var q=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){var r=this.m_init.query.loadInternal(null,t);if("boolean"!=typeof r)throw Error.invalidOperation("Query did not return bool");return r},e}();(0,o.l)(q,"d17350a4$QueryWhereConstraintFilter",null,[C]);var z=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if("string"!=typeof e)throw Error.argument("objToTest","Expected string");return this.m_init.regex.test(e)},e}();(0,o.l)(z,"d85bf83e$RegexStringFilter",null,[C]);var K=function(){return function(e,t){this.regex=null,e&&(this.regex=t.getRegex(e.get_item(0)))}}();(0,o.l)(K,"acbc044$RegexStringFilterInit",null,[]);var Q=function(){return function(e,t){this.filter=null,e&&(this.filter=t.getFilter(e.get_item(0)))}}();(0,o.l)(Q,"19ad06c6$SingleFilterFilterInit",null,[]);var Z=function(){return function(e,t){this.query=null,e&&(this.query=t.getAnnotationQuery(e.get_item(0)))}}();(0,o.l)(Z,"bcb4976c$SingleQueryFilterInit",null,[]);var J=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if("boolean"!=typeof e)throw Error.argument("objToTest","Expected bool value");return e===this.m_init.value},e}();(0,o.l)(J,"655d0d92$StoredValueBooleanFilter",null,[C]);var X=function(){return function(e){this.value=!1,e&&(this.value=1===e.get_item(0))}}();(0,o.l)(X,"75f93a68$StoredValueBooleanFilterInit",null,[]);var Y=function(){function e(e,t){this.m_init=null,this.m_type=0,this.m_init=e,this.m_type=t}return e.prototype.isMatch=function(e,t,n){if("number"!=typeof e)throw Error.argument("objToTest","Expected integer");var r=e;switch(this.m_type){case 0:return this.m_init.isMultiSelectEnum?this.m_init.value?!!(r&this.m_init.value):!r:r===this.m_init.value;case 1:return this.m_init.isMultiSelectEnum?(r&this.m_init.value)===this.m_init.value:r<32&&(1<<r&this.m_init.value)===this.m_init.value;case 2:return this.m_init.isMultiSelectEnum?!!(r&this.m_init.value):r<32&&!!(1<<r&this.m_init.value);default:throw Error.notImplemented()}},e}();(0,o.l)(Y,"f2feda85$StoredValueEnumFilter",null,[C]);var ee=function(){return function(e){this.isMultiSelectEnum=!1,this.value=0,e&&(this.isMultiSelectEnum=1===e.get_item(0),this.value=e.get_item(1))}}();(0,o.l)(ee,"c2d84c7f$StoredValueEnumFilterInit",null,[]);var te=function(){return function(){this.parentMatch=null,this.iFirstSpanInWindow=0,this.cTotalSpansInWindow=0}}();(0,o.l)(te,"dddd05da$WHEREConstraintData",null,[]);var ne=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if(!o.r(te,e))throw Error.argument("objToTest","Expected WHERE constraint data");var r=e,i=-1,a=-1,s=r.parentMatch;switch(this.m_init.captureReferenceType){case 4:i=s.get_firstSpanIndex(),a=s.get_spanCount();break;case 5:i=r.iFirstSpanInWindow,a=s.get_firstSpanIndex()-r.iFirstSpanInWindow;break;case 6:i=s.get_firstSpanIndex()+s.get_spanCount(),a=r.iFirstSpanInWindow+r.cTotalSpansInWindow-i;break;case 1:case 2:case 3:for(var l=!1,u=s.captures;u;u=u.next)if(this.m_init.userDefinedCaptureName===u.name){l=!0,1===this.m_init.captureReferenceType?(i=u.firstSpanIndex,a=u.spanCount):2===this.m_init.captureReferenceType?(i=r.iFirstSpanInWindow,a=u.firstSpanIndex-r.iFirstSpanInWindow):(i=u.firstSpanIndex+u.spanCount,a=r.iFirstSpanInWindow+r.cTotalSpansInWindow-i);break}if(!l)return!1;break;case 7:i=r.iFirstSpanInWindow,a=r.cTotalSpansInWindow;break;default:throw Error.notImplemented()}return null!==this.m_init.sre.getNextMatch(s.get_sreInputManager(),i,a,i,!0,2,t)},e}();(0,o.l)(ne,"7820102e$SubSreWhereConstraintFilter",null,[C]);var re=function(){return function(e,t){if(this.captureReferenceType=0,this.userDefinedCaptureName=null,this.sre=null,e){var n=t.getString(e.get_item(0));this.captureReferenceType=n.charCodeAt(0),this.userDefinedCaptureName=n.substr(1),this.sre=t.getSRE(e.get_item(1))}}}();(0,o.l)(re,"77bb07d4$SubSreWhereConstraintFilterInit",null,[]);var ie=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.isMatch=function(e,t,n){if(!o.r(I.m,e))throw Error.argument("objToTest","Expected feature bundle");var r,i,a,s=e;if(null==n)throw Error.argumentNull("parentTextForSpan");if(this.m_init.annotationsFilter&&!this.m_init.annotationsFilter.isMatch(s,t,null))return!1;if(this.m_init.textFilter)if(s.tryGetAnnotation_Cast(String,this.m_init.span_TextAttrID,(0,m.m)((function(){return r}),(function(e){return r=e})))){if(!this.m_init.textFilter.isMatch(r,t,null))return!1}else{var l,u;if(!s.tryGetAnnotation_Cast(Number,this.m_init.span_StartIndexAttrID,(0,m.m)((function(){return l}),(function(e){return l=e})))||!s.tryGetAnnotation_Cast(Number,this.m_init.span_LengthAttrID,(0,m.m)((function(){return u}),(function(e){return u=e})))||l<0||u<0||l+u>n.length)return!1;if(!this.m_init.textFilter.isMatch(n.substr(l,u),t,null))return!1}if(this.m_init.startIndexFilter&&(!s.tryGetAnnotation_Cast(Number,this.m_init.span_StartIndexAttrID,(0,m.m)((function(){return i}),(function(e){return i=e})))||!this.m_init.startIndexFilter.isMatch(i,t,null)))return!1;if(this.m_init.lengthFilter&&(!s.tryGetAnnotation_Cast(Number,this.m_init.span_LengthAttrID,(0,m.m)((function(){return a}),(function(e){return a=e})))||!this.m_init.lengthFilter.isMatch(a,t,null)))return!1;return!0},e}();(0,o.l)(ie,"987a9637$TextSpanFilter",null,[C]);var oe=function(){return function(e,t){this.annotations=null,this.span_StartIndexAttrID=0,this.span_LengthAttrID=0,this.span_TextAttrID=0,this.textFilter=null,this.annotationsFilter=null,this.startIndexFilter=null,this.lengthFilter=null,e&&(this.annotations=t.get_annotations(),this.span_StartIndexAttrID=e.get_item(0),this.span_LengthAttrID=e.get_item(1),this.span_TextAttrID=e.get_item(2),this.textFilter=e.get_item(3)?t.getFilter(e.get_item(3)):null,this.annotationsFilter=e.get_item(4)?t.getFilter(e.get_item(4)):null,this.startIndexFilter=e.get_item(5)?t.getFilter(e.get_item(5)):null,this.lengthFilter=e.get_item(6)?t.getFilter(e.get_item(6)):null)}}();(0,o.l)(oe,"d1b3f84d$TextSpanFilterInit",null,[]);var ae=function(){return function(e,t){this.annotations=null,this.attributeID=0,this.valueFilter=null,e&&(this.annotations=t.get_annotations(),this.attributeID=e.get_item(0),this.valueFilter=e.get_item(1)?t.getFilter(e.get_item(1)):null)}}();(0,o.l)(ae,"1a556ab0$ValueFilterAnnotationFilterInit",null,[]);var se=n(1228),le=function(){function e(){}return e.prototype.getFilter=function(t,n){var r=t.get_item(0),i=new se.i(Number);switch(i.fromReadOnlyList(t,1,t.get_count()-1),r){case e.c_Nonterminal_AND:return new E(new k(i,n),0);case e.c_Nonterminal_OR:return new E(new k(i,n),1);case e.c_Nonterminal_NOT:return new E(new k(i,n),2);case e.c_String_Regex:return new z(new K(i,n));case e.c_String_Query_Equals:return new W(new V(i,n),0);case e.c_String_Query_Contains:return new W(new V(i,n),1);case e.c_String_Query_StartsWith:return new W(new V(i,n),2);case e.c_String_Query_EndsWith:return new W(new V(i,n),3);case e.c_String_Query_IsContainedIn:return new W(new V(i,n),4);case e.c_String_Query_IsStartOf:return new W(new V(i,n),5);case e.c_String_Query_IsEndOf:return new W(new V(i,n),6);case e.c_Boolean_Equals:return new J(new X(i));case e.c_Boolean_Query:return new B(new Z(i,n));case e.c_Number_Equals:return new D(new O(i,n),0);case e.c_Number_LessThan:return new D(new O(i,n),1);case e.c_Number_LessThanOrEqual:return new D(new O(i,n),2);case e.c_Number_GreaterThan:return new D(new O(i,n),3);case e.c_Number_GreaterThanOrEqual:return new D(new O(i,n),4);case e.c_Enum_SingleMember:return new Y(new ee(i),0);case e.c_Enum_ConsolidatedAND:return new Y(new ee(i),1);case e.c_Enum_ConsolidatedOR:return new Y(new ee(i),2);case e.c_Enum_Query_Equals:return new H(new $(i,n),0);case e.c_Enum_Query_Overlaps:return new H(new $(i,n),1);case e.c_Enum_Query_IsSubsetOf:return new H(new $(i,n),2);case e.c_Enum_Query_IsSupersetOf:return new H(new $(i,n),3);case e.c_Struct_FieldValueMatches:return new M(new P(i,n));case e.c_Struct_Query_Equals:return new j(new Z(i,n));case e.c_List_Contains:return new w(new Q(i,n),0);case e.c_List_ForAll:return new w(new Q(i,n),1);case e.c_List_LengthMatches:return new R(new Q(i,n));case e.c_List_Query_Equals:return new G(new Z(i,n),0);case e.c_List_Query_Overlaps:return new G(new Z(i,n),1);case e.c_List_Query_IsSubsetOf:return new G(new Z(i,n),2);case e.c_List_Query_IsSupersetOf:return new G(new Z(i,n),3);case e.c_Annotation_HasAnnotations:return new F(!1);case e.c_Annotation_NoAnnotations:return new F(!0);case e.c_Annotation_AnnotatedWith:return new b(new ae(i,n),!1);case e.c_Annotation_NotAnnotatedWith:return new b(new ae(i,n),!0);case e.c_Annotation_AnnotatedWithAndValueMatches:return new T(new ae(i,n),!1);case e.c_Annotation_IfAnnotatedWithValueMatches:return new T(new ae(i,n),!0);case e.c_Annotation_Predicate:return new L(new N(i,n));case e.c_TextSpan:return new ie(new oe(i,n));case e.c_WHEREConstraint_Query:return new q(new Z(i,n));case e.c_WHEREConstraint_SubSRE:return new ne(new re(i,n));default:throw Error.argument("initData")}},e.c_Nonterminal_AND=1,e.c_Nonterminal_OR=2,e.c_Nonterminal_NOT=3,e.c_String_Regex=101,e.c_String_Query_Equals=103,e.c_String_Query_Contains=104,e.c_String_Query_StartsWith=105,e.c_String_Query_EndsWith=106,e.c_String_Query_IsContainedIn=107,e.c_String_Query_IsStartOf=108,e.c_String_Query_IsEndOf=109,e.c_Boolean_Equals=201,e.c_Boolean_Query=202,e.c_Number_Equals=301,e.c_Number_LessThan=302,e.c_Number_LessThanOrEqual=303,e.c_Number_GreaterThan=304,e.c_Number_GreaterThanOrEqual=305,e.c_Enum_SingleMember=401,e.c_Enum_ConsolidatedAND=402,e.c_Enum_ConsolidatedOR=403,e.c_Enum_Query_Equals=404,e.c_Enum_Query_Overlaps=405,e.c_Enum_Query_IsSubsetOf=406,e.c_Enum_Query_IsSupersetOf=407,e.c_Struct_FieldValueMatches=501,e.c_Struct_Query_Equals=502,e.c_List_Contains=601,e.c_List_ForAll=602,e.c_List_LengthMatches=603,e.c_List_Query_Equals=604,e.c_List_Query_Overlaps=605,e.c_List_Query_IsSubsetOf=606,e.c_List_Query_IsSupersetOf=607,e.c_Annotation_HasAnnotations=701,e.c_Annotation_NoAnnotations=702,e.c_Annotation_AnnotatedWith=703,e.c_Annotation_NotAnnotatedWith=704,e.c_Annotation_AnnotatedWithAndValueMatches=705,e.c_Annotation_IfAnnotatedWithValueMatches=706,e.c_Annotation_Predicate=707,e.c_TextSpan=901,e.c_WHEREConstraint_SubSRE=1001,e.c_WHEREConstraint_Query=1002,e}();(0,o.l)(le,"56bca792$FilterFactory",null,[S]);var ue=(0,o.y)("19992931$IObjectFetcher"),ce=(0,o.y)("81565862$IAnnotationQuery"),de=n(3538),pe=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.get_incomingType=function(){return this.m_init.incomingType},e.prototype.get_returnType=function(){return this.m_init.returnType},e.prototype.get_supportsStore=function(){return this.m_init.supportsStore},e.prototype.get_isContextFree=function(){return this.m_init.isContextFree},e.prototype.load=function(e,t){return this.loadInternal(e,e?new x("root",e,t):t)},e.prototype.store=function(e,t,n){this.storeInternal(e,t,e?new x("root",e,n):n,null)},e.prototype.loadInternal=function(e,t){if(!this.get_isContextFree()&&!this.m_init.annotations.isLegalValue(this.get_incomingType(),e))throw Error.argument("input","Input value not of expected type");for(var n=e,r=this.m_init.get_firstStep();r;)n=r.load(n,t),r=r.get_next();return n},e.prototype.storeInternal=function(e,t,n,r){if(!this.get_supportsStore())throw Error.invalidOperation("Attempt to store into query that supports only loading");if(!this.get_isContextFree()&&!this.m_init.annotations.isLegalValue(this.get_incomingType(),e))throw Error.argument("lvalue","Lvalue not of expected type");if(!this.m_init.annotations.isLegalValue(this.get_returnType(),t))throw Error.argument("rvalue","Rvalue not of expected type");return this.m_init.get_firstStep().store(e,t,n,r)},e.coerceItem=function(t,n,r,i){if(r===i)return n;if(y.Annotations.typeIDIsListType(r)&&y.Annotations.typeIDIsListType(i)){for(var o=y.Annotations.getMemberTypeID(r),a=y.Annotations.getMemberTypeID(i),s=n,l=new de.e(t,a),u=0,c=s.get_items();u<c.length;u++){var d=c[u];Array.add(l.get_items(),e.coerceItem(t,d,o,a))}return l}if(r===y.Annotations.typeiD_Integer){if(i===y.Annotations.typeiD_FloatingPoint)return n;if(i===y.Annotations.typeiD_String)return n.toString()}else if(r===y.Annotations.typeiD_FloatingPoint){if(i===y.Annotations.typeiD_Integer)return Math.floor(n);if(i===y.Annotations.typeiD_String)return n.toString()}else if(r===y.Annotations.typeiD_String){if(i===y.Annotations.typeiD_Integer)return parseInt(n);if(i===y.Annotations.typeiD_FloatingPoint)return parseFloat(n)}throw Error.invalidOperation("Type conversion failure in query step")},e}();(0,o.l)(pe,"a67f3ab$AnnotationQuery",null,[ce]);var ge=n(3545),he=(0,o.y)("868e2450$IAnnotationQueryStep"),_e=function(){function e(){this.$$pf_IncomingType=0,this.$$pf_ReturnType=0,this.$$pf_Next=null}return e.prototype.get_incomingType=function(){return this.$$pf_IncomingType},e.prototype.set_incomingType=function(e){return this.$$pf_IncomingType=e,e},e.prototype.get_returnType=function(){return this.$$pf_ReturnType},e.prototype.set_returnType=function(e){return this.$$pf_ReturnType=e,e},e.prototype.get_next=function(){return this.$$pf_Next},e.prototype.set_next=function(e){return this.$$pf_Next=e,e},e.prototype.store=function(e,t,n,r){throw Error.invalidOperation("Store not supported")},e.prototype.getNextStepForStore=function(e){if(this.get_next())return this.get_next();if(e.val){var t=e.val.get_continuationStep();return e.val=e.val.get_previousContinuation(),t}return null},e}();(0,o.l)(_e,"a4255cd9$AnnotationQueryStep",null,[he]);var fe=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=this.m_init.query.loadInternal(e,t);if(y.Annotations.typeIDIsListType(this.get_incomingType())){var r=e,i=y.Annotations.getMemberTypeID(this.get_incomingType()),o=new de.e(this.m_init.annotations,i);if(y.Annotations.typeIDIsListType(this.m_init.query.get_returnType())){var a=n;if(r.get_items().length!==a.get_items().length)throw Error.invalidOperation("List length mismatch in itemwise numeric query step");for(var s=0,l=r.get_items().length;s<l;++s)Array.add(o.get_items(),this.calculateResult(r.get_items()[s],a.get_items()[s],i===y.Annotations.typeiD_FloatingPoint))}else for(var u=0,c=r.get_items();u<c.length;u++){var d=c[u];Array.add(o.get_items(),this.calculateResult(d,n,i===y.Annotations.typeiD_FloatingPoint))}return o}if(y.Annotations.typeIDIsListType(this.m_init.query.get_returnType())){a=n,o=new de.e(this.m_init.annotations,this.get_incomingType());for(var p=0,g=a.get_items();p<g.length;p++){d=g[p];Array.add(o.get_items(),this.calculateResult(e,d,this.get_incomingType()===y.Annotations.typeiD_FloatingPoint))}return o}return this.calculateResult(e,n,this.get_incomingType()===y.Annotations.typeiD_FloatingPoint)},t.prototype.calculateResult=function(e,t,n){var r=this.calculateResultAux(e,t);return n?r:Math.floor(r)},t}(_e);(0,o.l)(fe,"598bbf32$NumericAnnotationQueryStep",_e,[]);var me=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.calculateResultAux=function(e,t){return e+t},t}(fe);(0,o.l)(me,"d42e4d8$AddAnnotationQueryStep",fe,[]);var ye=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n;if(this.get_incomingType()===y.Annotations.typeiD_Boolean&&this.m_init.query.get_returnType()===y.Annotations.typeiD_Boolean&&this.canShortCircuit(e,(0,m.m)((function(){return n}),(function(e){return n=e}))))return n;if(y.Annotations.typeIDIsListType(this.get_incomingType())){var r=e,i=new de.e(this.m_init.annotations,y.Annotations.typeiD_Boolean),o=this.m_init.query.loadInternal(e,t);if(y.Annotations.typeIDIsListType(this.m_init.query.get_returnType())){var a=o;if(r.get_items().length!==a.get_items().length)throw Error.invalidOperation("List length mismatch in itemwise boolean query step");for(var s=0,l=r.get_items().length;s<l;++s)Array.add(i.get_items(),this.computeResult(a.get_items()[s],r.get_items()[s]))}else for(var u=0,c=r.get_items();u<c.length;u++){var d=c[u];Array.add(i.get_items(),this.computeResult(o,d))}return i}o=this.m_init.query.loadInternal(e,t);if(y.Annotations.typeIDIsListType(this.m_init.query.get_returnType())){a=o,i=new de.e(this.m_init.annotations,y.Annotations.typeiD_Boolean);for(var p=0,g=a.get_items();p<g.length;p++){d=g[p];Array.add(i.get_items(),this.computeResult(d,e))}return i}return this.computeResult(o,e)},t}(_e);(0,o.l)(ye,"57268912$BinaryBooleanAnnotationQueryStep",_e,[]);var ve=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.canShortCircuit=function(e,t){return t.val=!1,!e},t.prototype.computeResult=function(e,t){return e&&t},t}(ye);(0,o.l)(ve,"debac9d2$AndAnnotationQueryStep",ye,[]);var Se=function(){return function(e){this.annotations=null,e&&(this.annotations=e)}}();(0,o.l)(Se,"ab0b4124$AnnotationsOnlyQueryStepInit",null,[]);var Ie=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=this.m_init.query.loadInternal(e,t),r=e.clone();return y.Annotations.typeIDIsListType(this.m_init.query.get_returnType())?Array.addRange(r.get_items(),n.get_items()):Array.add(r.get_items(),n),r},t}(_e);(0,o.l)(Ie,"949d8a97$AppendAnnotationQueryStep",_e,[]);var Ce=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(this.get_incomingType()===y.Annotations.typeiD_FeatureBundle)return this.ExecuteScript(e,t);for(var n=new de.e(this.m_init.annotations,y.Annotations.typeiD_FeatureBundle),r=0,i=e.get_items();r<i.length;r++){var o=i[r];Array.add(n.get_items(),this.ExecuteScript(o,t))}return n},t.prototype.ExecuteScript=function(e,t){var n=new v.d(this.m_init.annotations);n.copyAnnotationsFrom(e);var r=new v.d(this.m_init.annotations);return this.m_init.script.executeInternal(null,new x("Input",n,new x("Output",r,t))),r},t}(_e);(0,o.l)(Ce,"132cb42d$ApplyAnnotationQueryStep",_e,[]);var Te=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(this.get_incomingType()===y.Annotations.typeiD_FeatureBundle){var n,r=this.ExecuteScript(e,t);return r.tryGetAnnotation_Cast(f.z,this.m_init.annotationScript_ListOfFeatureBundleAttrID,(0,m.m)((function(){return n}),(function(e){return n=e})))||(n=new de.e(this.m_init.annotations,y.Annotations.typeiD_FeatureBundle)),r}for(var i=new de.e(this.m_init.annotations,y.Annotations.typeiD_FeatureBundle),o=function(e){var n;if(a.ExecuteScript(e,t).tryGetAnnotation_Cast(f.z,a.m_init.annotationScript_ListOfFeatureBundleAttrID,(0,m.m)((function(){return n}),(function(e){return n=e}))))for(var r=0,o=n.get_items();r<o.length;r++){var s=o[r];Array.add(i.get_items(),s)}},a=this,s=0,l=e.get_items();s<l.length;s++){o(l[s])}return i},t.prototype.ExecuteScript=function(e,t){var n=new v.d(this.m_init.annotations);n.copyAnnotationsFrom(e);var r=new v.d(this.m_init.annotations);return this.m_init.script.executeInternal(null,new x("Input",n,new x("Output",r,t))),r},t}(_e);(0,o.l)(Te,"b3cb11ab$ApplyExpandAnnotationQueryStep",_e,[]);var be=function(){return function(e,t){this.annotations=null,this.script=null,this.annotationScript_ListOfFeatureBundleAttrID=0,e&&(this.annotations=t.get_annotations(),this.script=t.getAnnotationScript(e.get_item(0)),this.annotationScript_ListOfFeatureBundleAttrID=e.get_item(1))}}();(0,o.l)(be,"eaf6cf56$ApplyExpandQueryStepInit",null,[]);var Ae=function(){return function(e,t){this.annotations=null,this.script=null,e&&(this.annotations=t.get_annotations(),this.script=t.getAnnotationScript(e.get_item(0)))}}();(0,o.l)(Ae,"fba848d0$ApplyQueryStepInit",null,[]);var Me=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(this.get_incomingType()===y.Annotations.typeiD_FeatureBundle)return this.LoadSingleFeatureBundle(e);for(var n=new de.e(this.m_init.annotations,this.m_init.annotations.getAttributeType(this.m_init.attributeID)),r=0,i=e.get_items();r<i.length;r++){var o=i[r];Array.add(n.get_items(),this.LoadSingleFeatureBundle(o))}return n},t.prototype.store=function(e,t,n,r){if(this.get_incomingType()===y.Annotations.typeiD_FeatureBundle){var i=e,o=t;return(a=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e}))))&&(o=a.store(y.Annotations.CloneIfReadOnly(this.LoadSingleFeatureBundle(i)),t,n,r)),i.setAnnotation(this.m_init.attributeID,o),i}var a,s=e;o=t;if(a=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e})))){for(var l=new de.e(this.m_init.annotations,this.m_init.annotations.getAttributeType(this.m_init.attributeID)),u=0,c=s.get_items();u<c.length;u++){i=c[u];Array.add(l.get_items(),this.LoadSingleFeatureBundle(i))}o=a.store(l,t,n,r)}var d=o;if(d.get_items().length!==s.get_items().length)throw Error.invalidOperation("RValue list length mismatch in Attr query step store");for(var p=0,g=s.get_items().length;p<g;++p){(i=s.get_items()[p]).get_isReadOnly()&&(i=i.clone(),s.get_items()[p]=i),i.setAnnotation(this.m_init.attributeID,d.get_items()[p])}return s},t.prototype.LoadSingleFeatureBundle=function(e){var t;return e.tryGetAnnotation_Cast(Object,this.m_init.attributeID,(0,m.m)((function(){return t}),(function(e){return t=e})))||(t=this.m_init.annotations.getAttributeDefaultValue(this.m_init.attributeID)),t},t}(_e);(0,o.l)(Me,"76c5834a$AttrAnnotationQueryStep",_e,[]);var Pe=function(){return function(e,t){this.annotations=null,this.attributeID=0,e&&(this.annotations=t,this.attributeID=e.get_item(0))}}();(0,o.l)(Pe,"ff38a957$AttrQueryStepInit",null,[]);var Fe=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=new v.d(this.m_init.annotations);return n.copyAnnotationsFrom(e),this.m_init.module.execute(n)},t}(_e);(0,o.l)(Fe,"49848e81$CallModuleAnnotationQueryStep",_e,[]);var we=function(){return function(e,t){this.annotations=null,this.module=null,e&&(this.annotations=t.get_annotations(),this.module=t.getModule(e.get_item(0)))}}();(0,o.l)(we,"917d49c$CallModuleQueryStepInit",null,[]);var Re=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(y.Annotations.typeIDIsListType(this.get_incomingType())){for(var n=e,r=this.m_init.query.loadInternal(e,t),i=new de.e(this.m_init.annotations,y.Annotations.typeiD_String),o="string"==typeof r,a=r,s=0,l=n.get_items();s<l.length;s++){var u=l[s];if(o)Array.add(i.get_items(),u+r);else for(var c=0,d=a.get_items();c<d.length;c++){var p=d[c];Array.add(i.get_items(),u+p)}}return i}u=e;if(o="string"==typeof(r=this.m_init.query.loadInternal(e,t)))return u+r;i=new de.e(this.m_init.annotations,y.Annotations.typeiD_String);for(var g=0,h=r.get_items();g<h.length;g++){p=h[g];Array.add(i.get_items(),u+p)}return i},t}(_e);(0,o.l)(Re,"c4e916ad$ConcatAnnotationQueryStep",_e,[]);var Ee=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){return pe.coerceItem(this.m_init.annotations,e,this.get_incomingType(),this.get_returnType())},t}(_e);(0,o.l)(Ee,"13ac4d2e$ConvertAnnotationQueryStep",_e,[]);var ke=function(e){function t(){return e.call(this)||this}return(0,ge.t)(t,e),t.prototype.load=function(e,t){return e.get_items().length},t}(_e);(0,o.l)(ke,"c230217a$CountAnnotationQueryStep",_e,[]);var De=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.calculateResultAux=function(e,t){return e/t},t}(fe);(0,o.l)(De,"413c932a$DivideAnnotationQueryStep",fe,[]);var Oe=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){for(var n=new x(this.m_init.varName,null,t),r=0,i=e.get_items();r<i.length;r++){var o=i[r];if(n.changeFeatureBundle(o),this.m_init.query.loadInternal(o,n))return!0}return!1},t}(_e);(0,o.l)(Oe,"136dfbb9$ExistsAnnotationQueryStep",_e,[]);var Ue=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.calculateResultAux=function(e,t){return Math.pow(e,t)},t}(fe);(0,o.l)(Ue,"4fd7c0d4$ExpAnnotationQueryStep",fe,[]);var xe=function(){return function(e,t){this.featureBundleName=null,e&&(this.featureBundleName=t.getString(e.get_item(0)))}}();(0,o.l)(xe,"42d4463$FeatureBundleNameQueryStepInit",null,[]);var Le=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(y.Annotations.typeIDIsListType(this.get_incomingType())){for(var n=new de.e(this.m_init.annotations,this.m_init.annotations.getStructFieldType(y.Annotations.getMemberTypeID(this.get_incomingType()),this.m_init.fieldIndex)),r=0,i=e.get_items();r<i.length;r++){var o=i[r];Array.add(n.get_items(),o.getFieldValue(this.m_init.fieldIndex))}return n}return e.getFieldValue(this.m_init.fieldIndex)},t.prototype.store=function(e,t,n,r){if(y.Annotations.typeIDIsListType(this.get_incomingType())){var i=e;g=t;if(d=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e})))){for(var o=new de.e(this.m_init.annotations,this.m_init.annotations.getStructFieldType(y.Annotations.getMemberTypeID(this.get_incomingType()),this.m_init.fieldIndex)),a=0,s=i.get_items();a<s.length;a++){p=s[a];Array.add(o.get_items(),p.getFieldValue(this.m_init.fieldIndex))}g=d.store(o,t,n,r)}var l=g;if(l.get_items().length!==i.get_items().length)throw Error.invalidOperation("RValue list length mismatch in Field query step store");for(var u=0,c=i.get_items().length;u<c;++u){(p=i.get_items()[u]).get_isReadOnly()&&(p=p.clone(),i.get_items()[u]=p),p.setFieldValue(this.m_init.fieldIndex,l.get_items()[u])}return i}var d,p=e,g=t;return(d=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e}))))&&(g=d.store(y.Annotations.CloneIfReadOnly(p.getFieldValue(this.m_init.fieldIndex)),t,n,r)),p.setFieldValue(this.m_init.fieldIndex,g),p},t}(_e);(0,o.l)(Le,"27b9085b$FieldAnnotationQueryStep",_e,[]);var Ne=function(){return function(e,t){this.annotations=null,this.fieldIndex=0,e&&(this.annotations=t,this.fieldIndex=e.get_item(0))}}();(0,o.l)(Ne,"926b2326$FieldQueryStepInit",null,[]);var Be=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){for(var n=0,r=e.get_items();n<r.length;n++){var i=r[n];if(this.m_init.filter.isMatch(i,t,null))return i}throw Error.invalidOperation("No matching item found in FirstItemMatching load step")},t.prototype.store=function(e,t,n,r){for(var i=e,o=t,a=-1,s=0,l=i.get_items().length;s<l;s++){var u=i.get_items()[s];if(this.m_init.filter.isMatch(u,n,null)){a=s;break}}if(a<0)throw Error.invalidOperation("No matching item found in FirstItemMatching store step");var c=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e})));return c&&(o=c.store(y.Annotations.CloneIfReadOnly(i.get_items()[a]),t,n,r)),i.get_items()[a]=o,i},t}(_e);(0,o.l)(Be,"461b6a85$FirstItemMatchingAnnotationQueryStep",_e,[]);var He=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){for(var n=new x(this.m_init.varName,null,t),r=0,i=e.get_items();r<i.length;r++){var o=i[r];if(n.changeFeatureBundle(o),!this.m_init.query.loadInternal(o,n))return!1}return!0},t}(_e);(0,o.l)(He,"1472fc83$ForAllAnnotationQueryStep",_e,[]);var $e=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=t?t.getFeatureBundle(this.m_init.featureBundleName):null;if(!n)throw Error.invalidOperation('Feature bundle resolution failure: "'+this.m_init.featureBundleName+'"');return n},t.prototype.store=function(e,t,n,r){var i=n?n.getFeatureBundle(this.m_init.featureBundleName):null;if(!i)throw Error.invalidOperation('Feature bundle resolution failure: "'+this.m_init.featureBundleName+'"');var o=t,a=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e})));return a&&(o=a.store(i,t,n,r)),i!==o&&i.copyAnnotationsFrom(o),i},t}(_e);(0,o.l)($e,"4f79be8f$GetAnnotationQueryStep",_e,[]);var Ge=(0,o.y)("25ab3684$IAnnotationQueryStoreContinuation"),We=function(){function e(e,t){this.$$pf_ContinuationStep=null,this.$$pf_PreviousContinuation=null,this.set_continuationStep(e),this.set_previousContinuation(t)}return e.prototype.get_continuationStep=function(){return this.$$pf_ContinuationStep},e.prototype.set_continuationStep=function(e){return this.$$pf_ContinuationStep=e,e},e.prototype.get_previousContinuation=function(){return this.$$pf_PreviousContinuation},e.prototype.set_previousContinuation=function(e){return this.$$pf_PreviousContinuation=e,e},e}();(0,o.l)(We,"c681c50d$AnnotationQueryStoreContinuation",null,[Ge]);var Ve=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){return this.m_init.testQuery.loadInternal(e,t)?this.m_init.trueQuery.loadInternal(e,t):this.m_init.falseQuery?this.m_init.falseQuery.loadInternal(e,t):e},t.prototype.store=function(e,t,n,r){var i=this.m_init.testQuery.loadInternal(e,n);if(this.get_next()&&(r=new We(this.get_next(),r)),i)return this.m_init.trueQuery.storeInternal(e,t,n,r);if(this.m_init.falseQuery)return this.m_init.falseQuery.storeInternal(e,t,n,r);var o=t,a=null;return r&&(a=r.get_continuationStep(),r=r.get_previousContinuation()),a&&(o=a.store(y.Annotations.CloneIfReadOnly(e),t,n,r)),o},t}(_e);(0,o.l)(Ve,"4c6796d6$IfAnnotationQueryStep",_e,[]);var je=function(){return function(e,t){this.testQuery=null,this.trueQuery=null,this.falseQuery=null,e&&(this.testQuery=t.getAnnotationQuery(e.get_item(0)),this.trueQuery=t.getAnnotationQuery(e.get_item(1)),this.falseQuery=e.get_item(2)?t.getAnnotationQuery(e.get_item(2)):null)}}();(0,o.l)(je,"a4c54acb$IfQueryStepInit",null,[]);var qe=function(){return function(e,t){this.indexQuery=null,this.itemQuery=null,e&&(this.indexQuery=t.getAnnotationQuery(e.get_item(0)),this.itemQuery=t.getAnnotationQuery(e.get_item(1)))}}();(0,o.l)(qe,"ca7b5044$IndexAndItemQueryStepInit",null,[]);var ze=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=this.m_init.indexQuery.loadInternal(e,t),r=this.m_init.itemQuery.loadInternal(e,t),i=e.clone();if(n<0||n>i.get_items().length)throw Error.invalidOperation("Index out of range in InsertAt() query step");if(y.Annotations.typeIDIsListType(this.m_init.itemQuery.get_returnType()))for(var o=r,a=0;a<o.get_items().length;++a)Array.insert(i.get_items(),n+a,o.get_items()[a]);else Array.insert(i.get_items(),n,r);return i},t}(_e);(0,o.l)(ze,"d6ccd8bb$InsertAtAnnotationQueryStep",_e,[]);var Ke=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){return!!(t?t.getFeatureBundle(this.m_init.featureBundleName):null)},t}(_e);(0,o.l)(Ke,"14815d22$IsDefinedAnnotationQueryStep",_e,[]);var Qe=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=e,r=this.GetIndex(n,t);return n.get_items()[r]},t.prototype.store=function(e,t,n,r){var i=e,o=this.GetIndex(i,n),a=t,s=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e})));return s&&(a=s.store(y.Annotations.CloneIfReadOnly(i.get_items()[o]),t,n,r)),i.get_items()[o]=a,i},t.prototype.GetIndex=function(e,t){var n=this.m_init.query.loadInternal(e,t);if(n<0||n>=e.get_items().length)throw Error.invalidOperation("Index out of range in Item store step");return n},t}(_e);(0,o.l)(Qe,"c9d882ec$ItemAnnotationQueryStep",_e,[]);var Ze=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){for(var n=new de.e(this.m_init.annotations,y.Annotations.getMemberTypeID(this.get_incomingType())),r=0,i=e.get_items();r<i.length;r++){var o=i[r];this.m_init.filter.isMatch(o,t,null)&&Array.add(n.get_items(),o)}return n},t}(_e);(0,o.l)(Ze,"ca4d7e2c$ItemsMatchingAnnotationQueryStep",_e,[]);var Je=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=e,r=this.GetIndex(n,t);return n.get_items()[n.get_items().length-r-1]},t.prototype.store=function(e,t,n,r){var i=e,o=this.GetIndex(i,n),a=t,s=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e})));return s&&(a=s.store(y.Annotations.CloneIfReadOnly(i.get_items()[i.get_items().length-o-1]),t,n,r)),i.get_items()[i.get_items().length-o-1]=a,i},t.prototype.GetIndex=function(e,t){var n=this.m_init.query?this.m_init.query.loadInternal(e,t):0;if(n<0||n>=e.get_items().length)throw Error.invalidOperation("Index out of range in LastItem load step");return n},t}(_e);(0,o.l)(Je,"13fd2a6$LastItemAnnotationQueryStep",_e,[]);var Xe=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(y.Annotations.typeIDIsListType(this.get_incomingType())){for(var n=e,r=new de.e(this.m_init.annotations,y.Annotations.typeiD_Integer),i=0,o=n.get_items();i<o.length;i++){var a=o[i];Array.add(r.get_items(),a.length)}return r}return e.length},t}(_e);(0,o.l)(Xe,"57a74e5$LengthAnnotationQueryStep",_e,[]);var Ye=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(y.Annotations.typeIDIsListType(this.get_incomingType())){for(var n=new de.e(this.m_init.annotations,y.Annotations.typeiD_Boolean),r=0,i=e.get_items();r<i.length;r++){var o=i[r];Array.add(n.get_items(),this.m_init.filter.isMatch(o,t,null))}return n}return this.m_init.filter.isMatch(e,t,null)},t}(_e);(0,o.l)(Ye,"e49f17c$MatchesAnnotationQueryStep",_e,[]);var et=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){return this.m_init.filter.isMatch(e,t,null)},t}(_e);(0,o.l)(et,"7717156c$MatchesAsListAnnotationQueryStep",_e,[]);var tt=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.calculateResultAux=function(e,t){return e%t},t}(fe);(0,o.l)(tt,"aad7dd49$ModuloAnnotationQueryStep",fe,[]);var nt=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.calculateResultAux=function(e,t){return e*t},t}(fe);(0,o.l)(nt,"346eb9f5$MultiplyAnnotationQueryStep",fe,[]);var rt=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(y.Annotations.typeIDIsListType(this.get_incomingType())){for(var n=new de.e(this.m_init.annotations,y.Annotations.typeiD_Boolean),r=0,i=e.get_items();r<i.length;r++){var o=i[r];Array.add(n.get_items(),!o)}return n}return!e},t}(_e);(0,o.l)(rt,"e931a0ac$NotAnnotationQueryStep",_e,[]);var it=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.canShortCircuit=function(e,t){return t.val=!0,e},t.prototype.computeResult=function(e,t){return e||t},t}(ye);(0,o.l)(it,"18b4d104$OrAnnotationQueryStep",ye,[]);var ot=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){for(var n=this.m_init.startQuery.loadInternal(e,t),r=this.m_init.countOrLengthQuery.loadInternal(e,t),i=new de.e(this.m_init.annotations,y.Annotations.typeiD_Integer),o=0;o<r;++o)Array.add(i.get_items(),n+o);return i},t}(_e);(0,o.l)(ot,"4c0daf46$RangeAnnotationQueryStep",_e,[]);var at=function(){return function(e,t){this.annotations=null,this.filter=null,e&&(this.annotations=t.get_annotations(),this.filter=t.getFilter(e.get_item(0)))}}();(0,o.l)(at,"bc639fde$SingleFilterQueryStepInit",null,[]);var st=function(){return function(e,t){this.annotations=null,this.query=null,e&&(this.annotations=t.get_annotations(),this.query=e.get_item(0)?t.getAnnotationQuery(e.get_item(0)):null)}}();(0,o.l)(st,"3a477c3a$SingleOptionalQueryQueryStepInit",null,[]);var lt=function(){return function(e,t){this.annotations=null,this.query=null,e&&(this.annotations=t.get_annotations(),this.query=t.getAnnotationQuery(e.get_item(0)))}}();(0,o.l)(lt,"9dc3f574$SingleQueryQueryStepInit",null,[]);var ut=function(){return function(e,t){this.annotations=null,this.startQuery=null,this.countOrLengthQuery=null,e&&(this.annotations=t.get_annotations(),this.startQuery=t.getAnnotationQuery(e.get_item(0)),this.countOrLengthQuery=e.get_item(1)?t.getAnnotationQuery(e.get_item(1)):null)}}();(0,o.l)(ut,"7a1eea8d$StartAndCountOrLengthQueryStepInit",null,[]);var ct=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n,r,i=e;this.GetStartIndexAndLength(i,t,(0,m.m)((function(){return n}),(function(e){return n=e})),(0,m.m)((function(){return r}),(function(e){return r=e})));for(var o=new de.e(this.m_init.annotations,i.get_memberTypeID()),a=0;a<r;++a)Array.add(o.get_items(),i.get_items()[n+a]);return o},t.prototype.store=function(e,t,n,r){var i,o,a=e;this.GetStartIndexAndLength(a,n,(0,m.m)((function(){return i}),(function(e){return i=e})),(0,m.m)((function(){return o}),(function(e){return o=e})));var s=t,l=this.getNextStepForStore((0,m.m)((function(){return r}),(function(e){return r=e})));if(l){for(var u=new de.e(this.m_init.annotations,a.get_memberTypeID()),c=0;c<o;++c)Array.add(u.get_items(),a.get_items()[i+c]);s=l.store(u,t,n,r)}var d=s;for(c=0;c<o;++c)Array.removeAt(a.get_items(),i);c=0;for(var p=d.get_items().length;c<p;++c)Array.insert(a.get_items(),i+c,d.get_items()[c]);return a},t.prototype.GetStartIndexAndLength=function(e,t,n,r){if(n.val=this.m_init.startQuery.loadInternal(e,t),n.val<0)throw Error.invalidOperation("Invalid start index in Sublist() query step");if(r.val=this.m_init.countOrLengthQuery?this.m_init.countOrLengthQuery.loadInternal(e,t):e.get_items().length-n.val,r.val<0||n.val+r.val>e.get_items().length)throw Error.invalidOperation("Start index or length out of range in Sublist() query step")},t}(_e);(0,o.l)(ct,"1ee49d7f$SublistAnnotationQueryStep",_e,[]);var dt=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){if(y.Annotations.typeIDIsListType(this.get_incomingType())){for(var n=e,r=new de.e(this.m_init.annotations,y.Annotations.typeiD_String),i=0,o=n.get_items().length;i<o;++i)Array.add(r.get_items(),this.GetSubstring(n.get_items()[i],t));return r}return this.GetSubstring(e,t)},t.prototype.store=function(e,t,n,r){throw Error.invalidOperation("Substring() store not yet supported by the runtime")},t.prototype.GetSubstring=function(e,t){var n,r;return this.GetStartIndexAndLength(e,t,(0,m.m)((function(){return n}),(function(e){return n=e})),(0,m.m)((function(){return r}),(function(e){return r=e}))),e.substr(n,r)},t.prototype.GetStartIndexAndLength=function(e,t,n,r){if(n.val=this.m_init.startQuery.loadInternal(e,t),n.val<0)throw Error.invalidOperation("Invalid start index in Substring() query step");if(r.val=this.m_init.countOrLengthQuery?this.m_init.countOrLengthQuery.loadInternal(e,t):e.length-n.val,r.val<0||n.val+r.val>e.length)throw Error.invalidOperation("Start index or length out of range in Substring() query step")},t}(_e);(0,o.l)(dt,"4f809888$SubstringAnnotationQueryStep",_e,[]);var pt=function(e){function t(t){return e.call(this,t)||this}return(0,ge.t)(t,e),t.prototype.calculateResultAux=function(e,t){return e-t},t}(fe);(0,o.l)(pt,"be1819ad$SubtractAnnotationQueryStep",fe,[]);var gt=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){for(var n=new de.e(this.m_init.annotations,y.Annotations.typeiD_String),r=e,i=0;i<r.length;++i)Array.add(n.get_items(),r.charAt(i).toString());return n},t}(_e);(0,o.l)(gt,"6b397558$ToCharListAnnotationQueryStep",_e,[]);var ht=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){var n=new de.e(this.m_init.annotations,this.get_incomingType());return Array.add(n.get_items(),e),n},t}(_e);(0,o.l)(ht,"140d26e0$ToListAnnotationQueryStep",_e,[]);var _t=function(e){function t(t){var n=e.call(this)||this;return n.m_init=null,n.m_init=t,n}return(0,ge.t)(t,e),t.prototype.load=function(e,t){return this.m_init.value},t}(_e);(0,o.l)(_t,"d866ff12$ValueAnnotationQueryStep",_e,[]);var ft=function(){return function(e,t){if(this.value=null,e){var n=e.get_item(0),r=1;this.value=t.deserializeValue(n,e,(0,m.m)((function(){return r}),(function(e){return r=e})),null,null,null),y.Annotations.LockDownIfNecessary(this.value)}}}();(0,o.l)(ft,"d601026f$ValueQueryStepInit",null,[]);var mt=function(){return function(e,t){this.varName=null,this.query=null,e&&(this.varName=t.getString(e.get_item(0)),this.query=t.getAnnotationQuery(e.get_item(1)))}}();(0,o.l)(mt,"fac30d47$VarNameAndQueryQueryStepInit",null,[]);var yt=function(){function e(t,n){if(this.annotations=null,this.incomingType=0,this.returnType=0,this.supportsStore=!1,this.isContextFree=!1,this.firstStep=null,t){this.annotations=n.get_annotations();var r=0;this.incomingType=t.get_item(r),++r,this.returnType=t.get_item(r),++r,this.supportsStore=1===t.get_item(r),++r,this.isContextFree=1===t.get_item(r),++r;var i=t.get_item(r);if(++r,i)for(var o=r,a=r+i,s=r+2*i,l=r+3*i,u=t.get_count()-l,c=null,d=0;d<i;++d){var p=l+t.get_item(s+d),g=(d===i-1?u:t.get_item(s+d+1))-t.get_item(s+d),h=new se.i(Number);h.fromReadOnlyList(t,p,g);var _=e.GetNewStep(t.get_item(a+d),h,n);_.set_incomingType(t.get_item(o+d)),_.set_returnType(d===i-1?this.returnType:t.get_item(o+d+1)),c?(c.set_next(_),c=_):(this.set_firstStep(_),c=_)}}}return e.prototype.get_firstStep=function(){return this.firstStep},e.prototype.set_firstStep=function(e){return this.firstStep=e,e},e.GetNewStep=function(t,n,r){switch(t){case e.c_Get:return new $e(new xe(n,r));case e.c_IsDefined:return new Ke(new xe(n,r));case e.c_Attr:return new Me(new Pe(n,r.get_annotations()));case e.c_Field:return new Le(new Ne(n,r.get_annotations()));case e.c_If:return new Ve(new je(n,r));case e.c_Matches:return new Ye(new at(n,r));case e.c_MatchesAsList:return new et(new at(n,r));case e.c_Apply:return new Ce(new Ae(n,r));case e.c_ApplyExpand:return new Te(new be(n,r));case e.c_Value:return new _t(new ft(n,r.get_annotations()));case e.c_CallModule:return new Fe(new we(n,r));case e.c_Range:return new ot(new ut(n,r));case e.c_Convert:return new Ee(new Se(r.get_annotations()));case e.c_Item:return new Qe(new lt(n,r));case e.c_LastItem:return new Je(new st(n,r));case e.c_Count:return new ke;case e.c_FirstItemMatching:return new Be(new at(n,r));case e.c_ForAll:return new He(new mt(n,r));case e.c_Exists:return new Oe(new mt(n,r));case e.c_InsertAt:return new ze(new qe(n,r));case e.c_Append:return new Ie(new lt(n,r));case e.c_Sublist:return new ct(new ut(n,r));case e.c_ItemsMatching:return new Ze(new at(n,r));case e.c_ToList:return new ht(new Se(r.get_annotations()));case e.c_Substring:return new dt(new ut(n,r));case e.c_Concat:return new Re(new lt(n,r));case e.c_Length:return new Xe(new Se(r.get_annotations()));case e.c_ToCharList:return new gt(new Se(r.get_annotations()));case e.c_Add:return new me(new lt(n,r));case e.c_Subtract:return new pt(new lt(n,r));case e.c_Multiply:return new nt(new lt(n,r));case e.c_Divide:return new De(new lt(n,r));case e.c_Modulo:return new tt(new lt(n,r));case e.c_Exp:return new Ue(new lt(n,r));case e.c_And:return new ve(new lt(n,r));case e.c_Or:return new it(new lt(n,r));case e.c_Not:return new rt(new Se(r.get_annotations()));default:throw Error.argument("currStepInitData")}},e.c_Get=1,e.c_IsDefined=2,e.c_Attr=3,e.c_Field=4,e.c_If=5,e.c_Matches=6,e.c_Analyze=7,e.c_Generate=8,e.c_IntLiteral=9,e.c_StringLiteral=10,e.c_FloatLiteral=11,e.c_BooleanLiteral=12,e.c_Item=13,e.c_LastItem=14,e.c_Count=15,e.c_ForAll=16,e.c_Exists=17,e.c_FirstItemMatching=18,e.c_LastItemMatching=19,e.c_FirstIndexOf=20,e.c_LastIndexOf=21,e.c_InsertAt=22,e.c_RemoveAt=23,e.c_Append=24,e.c_Extend=25,e.c_Sublist=26,e.c_ItemsMatching=27,e.c_RemoveDefaultOnlyItems=28,e.c_RemoveDuplicates=29,e.c_ToList=30,e.c_Substring=31,e.c_Concat=32,e.c_ToString=33,e.c_Add=34,e.c_Subtract=35,e.c_Multiply=36,e.c_Divide=37,e.c_Modulo=38,e.c_Exp=39,e.c_And=40,e.c_Or=41,e.c_Not=42,e.c_MatchesAsList=43,e.c_Join=44,e.c_Apply=45,e.c_Value=46,e.c_Length=47,e.c_ToCharList=48,e.c_ApplyExpand=49,e.c_ApplyReduce=50,e.c_CallModule=51,e.c_Range=52,e.c_Convert=53,e}();(0,o.l)(yt,"e5e79311$AnnotationQueryInit",null,[]);var vt=(0,o.y)("7247ede7$IAnnotationScript"),St=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){this.executeInternal(e,e?new x("root",e,t):t)},e.prototype.executeInternal=function(e,t){for(var n=0,r=this.m_init.commands;n<r.length;n++){r[n].execute(e,(0,m.m)((function(){return t}),(function(e){return t=e})))}},e}();(0,o.l)(St,"3a41c2ce$AnnotationScript",null,[vt]);var It=(0,o.y)("a64535a0$IAnnotationScriptCommand"),Ct=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){var n=this.m_init.inputQuery.loadInternal(e,t.val),r=this.m_init.outputQuery.loadInternal(e,t.val);this.m_init.script.executeInternal(e,new x("Input",n,new x("Output",r,t.val)))},e}();(0,o.l)(Ct,"203aa11d$ApplyAnnotationScriptCommand",null,[It]);var Tt=function(){return function(e,t){this.inputQuery=null,this.outputQuery=null,this.script=null,e&&(this.inputQuery=t.getAnnotationQuery(e.get_item(0)),this.outputQuery=t.getAnnotationQuery(e.get_item(1)),this.script=t.getAnnotationScript(e.get_item(2)))}}();(0,o.l)(Tt,"648f75e0$ApplyScriptCommandInit",null,[]);var bt=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){var n=this.m_init.rvalueQuery.loadInternal(e,t.val);this.m_init.lvalueQuery.storeInternal(e,n,t.val,null)},e}();(0,o.l)(bt,"3b20c9a8$AssignAnnotationScriptCommand",null,[It]);var At=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){var n=this.m_init.lvalueQuery.loadInternal(e,t.val),r=this.m_init.rvalueQuery.loadInternal(e,t.val);n!==r&&n.copyAnnotationsFrom(r)},e}();(0,o.l)(At,"2cafc5ac$CopyAnnotationScriptCommand",null,[It]);var Mt=function(){function e(e){this.m_init=null,e.resultAttributeID,this.m_init=e}return e.prototype.execute=function(e,t){var n=this.m_init.listQuery.loadInternal(e,t.val);if(this.m_init.listQuery.get_supportsStore()){n=y.Annotations.CloneIfReadOnly(n);for(var r=new x(this.m_init.featureBundleName,null,t.val),i=function(t,i){var a=o.executeCore(e,n.get_items()[t],r);if(o.m_init.resultAttributeID<0)n.get_items()[t]=a;else{var s;if(!a.tryGetAnnotation_Cast(Object,o.m_init.resultAttributeID,(0,m.m)((function(){return s}),(function(e){return s=e}))))throw Error.invalidOperation("Expected result attribute missing in Enumerate() script command");n.get_items()[t]=s}},o=this,a=0,s=n.get_items().length;a<s;++a)i(a);this.m_init.listQuery.storeInternal(e,n,t.val,null)}else for(r=new x(this.m_init.featureBundleName,null,t.val),a=0,s=n.get_items().length;a<s;++a)this.executeCore(e,n.get_items()[a],r)},e.prototype.executeCore=function(e,t,n){var r;return this.m_init.resultAttributeID<0?r=y.Annotations.CloneIfReadOnly(t):(r=new v.d(this.m_init.annotations)).setAnnotation(this.m_init.resultAttributeID,t),n.changeFeatureBundle(r),this.m_init.bodyScript.executeInternal(e,n),r},e}();(0,o.l)(Mt,"63153dfd$EnumerateAnnotationScriptCommand",null,[It]);var Pt=function(){return function(e,t){this.annotations=null,this.featureBundleName=null,this.listQuery=null,this.bodyScript=null,this.resultAttributeID=0,e&&(this.annotations=t.get_annotations(),this.featureBundleName=t.getString(e.get_item(0)),this.listQuery=t.getAnnotationQuery(e.get_item(1)),this.bodyScript=t.getAnnotationScript(e.get_item(2)),this.resultAttributeID=e.get_item(3))}}();(0,o.l)(Pt,"f58e2700$EnumerateScriptCommandInit",null,[]);var Ft=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){this.m_init.testQuery.loadInternal(e,t.val)?this.m_init.trueScript.executeInternal(e,t.val):this.m_init.falseScript&&this.m_init.falseScript.executeInternal(e,t.val)},e}();(0,o.l)(Ft,"ad8e2be6$IfAnnotationScriptCommand",null,[It]);var wt=function(){return function(e,t){this.testQuery=null,this.trueScript=null,this.falseScript=null,e&&(this.testQuery=t.getAnnotationQuery(e.get_item(0)),this.trueScript=t.getAnnotationScript(e.get_item(1)),this.falseScript=e.get_item(2)?t.getAnnotationScript(e.get_item(2)):null)}}();(0,o.l)(wt,"d1a1013b$IfScriptCommandInit",null,[]);var Rt=function(){return function(e,t){this.annotations=null,this.lvalueQuery=null,this.rvalueQuery=null,e&&(this.annotations=t.get_annotations(),this.lvalueQuery=t.getAnnotationQuery(e.get_item(0)),this.rvalueQuery=t.getAnnotationQuery(e.get_item(1)))}}();(0,o.l)(Rt,"1e96834b$LvalueAndRvalueQueryScriptCommandInit",null,[]);var Et=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){var n=this.m_init.rvalueQuery.loadInternal(this.m_init.lvalueQuery.loadInternal(e,t.val),t.val);this.m_init.lvalueQuery.storeInternal(e,n,t.val,null)},e}();(0,o.l)(Et,"6418adb9$ModifyAnnotationScriptCommand",null,[It]);var kt=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){var n=new v.d(this.m_init.annotations);this.m_init.query&&n.copyAnnotationsFrom(this.m_init.query.loadInternal(e,t.val)),t.val=new x(this.m_init.featureBundleName,n,t.val)},e}();(0,o.l)(kt,"cb3a8af5$NewAnnotationScriptCommand",null,[It]);var Dt=function(){return function(e,t){this.annotations=null,this.featureBundleName=null,this.query=null,e&&(this.annotations=t.get_annotations(),this.featureBundleName=t.getString(e.get_item(0)),this.query=e.get_item(1)?t.getAnnotationQuery(e.get_item(1)):null)}}();(0,o.l)(Dt,"27853708$NewScriptCommandInit",null,[]);var Ot=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e,t){var n=this.m_init.query.loadInternal(e,t.val);if(this.m_init.query.get_returnType()===y.Annotations.typeiD_FeatureBundle)n.removeAnnotation(this.m_init.attributeID);else for(var r=0,i=n.get_items();r<i.length;r++){i[r].removeAnnotation(this.m_init.attributeID)}},e}();(0,o.l)(Ot,"a747e5af$RemoveAnnotationScriptCommand",null,[It]);var Ut=function(){return function(e,t){this.annotations=null,this.query=null,this.attributeID=0,e&&(this.annotations=t.get_annotations(),this.query=t.getAnnotationQuery(e.get_item(0)),this.attributeID=e.get_item(1))}}();(0,o.l)(Ut,"699e0e72$RemoveScriptCommandInit",null,[]);var xt=function(){function e(t,n){if(this.commands=null,t){var r=0,i=t.get_item(r);if(++r,i){var o=r,a=r+i,s=r+2*i,l=t.get_count()-s;this.commands=new Array(i);for(var u=0;u<i;++u){var c=s+t.get_item(a+u),d=(u===i-1?l:t.get_item(a+u+1))-t.get_item(a+u),p=new se.i(Number);p.fromReadOnlyList(t,c,d),this.commands[u]=e.GetNewCommand(t.get_item(o+u),p,n)}}}}return e.GetNewCommand=function(t,n,r){switch(t){case e.c_Assign:return new bt(new Rt(n,r));case e.c_Modify:return new Et(new Rt(n,r));case e.c_Remove:return new Ot(new Ut(n,r));case e.c_New:return new kt(new Dt(n,r));case e.c_Enumerate:return new Mt(new Pt(n,r));case e.c_If:return new Ft(new wt(n,r));case e.c_Copy:return new At(new Rt(n,r));case e.c_Apply:return new Ct(new Tt(n,r));default:throw Error.argument("initData")}},e.c_Assign=1,e.c_Modify=2,e.c_Remove=3,e.c_Set=4,e.c_Unset=5,e.c_New=6,e.c_Enumerate=7,e.c_If=8,e.c_Copy=9,e.c_Apply=10,e}();(0,o.l)(xt,"386715b4$AnnotationScriptInit",null,[]);var Lt=(0,o.y)("befe370e$IRawFlatLexicon"),Nt=n(6039),Bt=function(){function e(e){this._array=null,this._currentIndex=0,this._array=e,this._currentIndex=0}return e.prototype.readInt32=function(){var e=this._array.readInt(this._currentIndex,4);return this._currentIndex+=4,e},e.prototype.readByte=function(){var e=this._array.get_item(this._currentIndex);return this._currentIndex++,e},e.prototype.get_array=function(){return this._array},e.prototype.get_offset=function(){return this._currentIndex},e.prototype.set_offset=function(e){return this._currentIndex=e,e},e}();(0,o.l)(Bt,"20ea6a68$ByteArrayReader",null,[]);var Ht=n(8934),$t=function(){function e(){this.m_bytes=null,this.m_length=0,this.m_iFirstByte=0}return e.prototype.get_item=function(e){if(e<0||e>=this.m_length)throw Error.argumentOutOfRange("index");var t=4*e;return this.m_bytes.readInt(this.m_iFirstByte+t,4)},e.prototype.get_count=function(){return this.m_length},e.createFromByteArray=function(t,n,r){var i=new e;return i.m_bytes=t,i.m_iFirstByte=n,i.m_length=r,i},e}();(0,o.l)($t,"6d652847$ReadOnlyListOverByteArray",null,[Ht.y.$$(Number)]);var Gt=function(){function e(t,n){this.m_fIgnoreCase=!1,this.m_fTurkishAzeriCasing=!1,this.m_featureBundleLists=null,this.m_analysesBlob=null,this.m_trie=null,this.m_annotations=null;var r=0;try{this.m_annotations=n.get_annotations();var i=n.getByteArray(t.get_item(r));++r;var o=new Bt(i);if(o.readInt32()!==e.c_MAGIC_NUMBER)throw Error.argument("Input does not represent a flat lexicon");this.m_fIgnoreCase=1===o.readInt32(),this.m_fTurkishAzeriCasing=1===o.readInt32();var a=o.readInt32();o.set_offset(o.get_offset()+a);var s=o.readInt32();this.m_analysesBlob=e.ParseAnalysesBlob(o,s,this.m_annotations);var l=o.readInt32();this.m_featureBundleLists=e.ParseFeatureBundleListBlob(o,l);var u=o.readInt32();this.m_trie=new Nt.h(o.get_array(),o.get_offset()),o.set_offset(o.get_offset()+u)}catch(e){throw Error.argument("initData")}}return e.prototype.get_trie=function(){return this.m_trie},e.prototype.getCaseInsensitiveForm=function(e){return"i"===e&&this.m_fTurkishAzeriCasing?"\u0130":e.toUpperCase()},e.prototype.isCaseInsensitive=function(){return this.m_fIgnoreCase},e.prototype.getAnalysesForTrieTag=function(t,n){if(n.val=new de.e(this.m_annotations,y.Annotations.typeiD_FeatureBundle),t===e.c_compiledLex_EmptyFeatureBundleList);else if(t===e.c_compiledLex_UnannotatedFeatureBundle){var r=new v.d(this.m_annotations);Array.add(n.val.get_items(),r)}else if(t&e.c_compiledLex_FeatureBundleMultiFeatureBundleListFlag)for(var i=t&~e.c_compiledLex_FeatureBundleMultiFeatureBundleListFlag,o=this.m_featureBundleLists[i],a=0;a<o.length;++a){var s=o[a];l=void 0;l=s===e.c_compiledLex_UnannotatedFeatureBundle?new v.d(this.m_annotations):this.m_analysesBlob[s-e.c_compiledLex_FeatureBundleIDAdjustment],Array.add(n.val.get_items(),l)}else{var l=this.m_analysesBlob[t-e.c_compiledLex_FeatureBundleIDAdjustment];Array.add(n.val.get_items(),l)}return!0},e.ParseAnalysesBlob=function(e,t,n){if(t%4)throw Error.argument("reader");var r=t/4,i=$t.createFromByteArray(e.get_array(),e.get_offset(),r);e.set_offset(e.get_offset()+t);for(var o=[],a=0;a<i.get_count();){var s=n.deserializeValue(y.Annotations.typeiD_FeatureBundle,i,(0,m.m)((function(){return a}),(function(e){return a=e})),null,null,null);Array.add(o,s)}return o},e.ParseFeatureBundleListBlob=function(e,t){for(var n=e.get_offset()+t,r=[];e.get_offset()<n;){for(var i=e.readInt32(),o=new Array(i),a=0;a<i;++a){var s=e.readInt32();o[a]=s}Array.add(r,o)}return r},e.c_compiledLex_UnannotatedFeatureBundle=0,e.c_compiledLex_EmptyFeatureBundleList=1,e.c_compiledLex_FeatureBundleIDAdjustment=2,e.c_compiledLex_FeatureBundleMultiFeatureBundleListFlag=1073741824,e.c_MAGIC_NUMBER=-914743053,e}();(0,o.l)(Gt,"8ba252c7$RawFlatLexicon",null,[Lt]);var Wt=n(5031),Vt=n(2977),jt=function(){function e(t){if(this.m_data=null,this.m_length=0,null==t)throw Error.argumentNull("base64String");var n=t.length;if(n%4)throw Error.argument("base64String's length must be a multiple of 4");this.m_length=.75*n,this.m_data=new Array(Math.ceil(this.m_length/4)),t.endsWith("==")?this.m_length-=2:t.endsWith("=")&&(this.m_length-=1);for(var r=0,i=0;i<n;i+=4){var o=e.s_base64CharCode2Value[t.charCodeAt(i)-e.c_firstBase64CharCode]<<18|e.s_base64CharCode2Value[t.charCodeAt(i+1)-e.c_firstBase64CharCode]<<12|e.s_base64CharCode2Value[t.charCodeAt(i+2)-e.c_firstBase64CharCode]<<6|e.s_base64CharCode2Value[t.charCodeAt(i+3)-e.c_firstBase64CharCode],a=o>>16&255;this.m_data[Math.floor(r/4)]|=a<<r%4*8,++r,a=o>>8&255,this.m_data[Math.floor(r/4)]|=a<<r%4*8,++r,a=255&o,this.m_data[Math.floor(r/4)]|=a<<r%4*8,++r}}return e.prototype.get_length=function(){return this.m_length},e.prototype.get_item=function(e){if(e<0||e>=this.m_length)throw Error.argumentOutOfRange("i");return this.GetByteNoCheck(e)},e.prototype.readInt=function(e,t){if(e<0||t<0||e+t>this.m_length)throw Error.argument("Bad range");for(var n=0,r=0;r<t;++r)n|=this.GetByteNoCheck(e+r)<<8*r;return n},e.prototype.readVarWidthInt=function(e,t){for(var n=0,r=0,i=Math.floor(e/8),o=e%8;r<t;){var a=8-o>t-r?t-r:8-o;n|=(this.get_item(i)>>o&~(255<<a))<<r,r+=a,++i,o=0}return n},e.prototype.GetByteNoCheck=function(e){return this.m_data[Math.floor(e/4)]>>e%4*8&255},e.s_base64CharCode2Value=[62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],e.c_firstBase64CharCode=43,e}();(0,o.l)(jt,"c3db42ad$ByteArray",null,[]);var qt=function(){function e(t,n,r){this.$$pf_Annotations=null,this.m_resource=null,this.m_stringTable=null,this.m_filterFactory=null,this.m_moduleFactory=null,this.m_initializedObjects=null,this.m_initializedByteArrays=null,this.m_resource=t,this.m_filterFactory=n,this.m_moduleFactory=r,this.m_initializedByteArrays=new Array(t.b?t.b.length:0),this.m_stringTable=new Wt.c(new Vt.k(this.getByteArray(this.m_resource.s))),this.m_initializedObjects=new Array(t.t.length),this.set_annotations(new y.Annotations(this.GetBlobData(e.c_annotationsBlobID),this))}return e.prototype.get_annotations=function(){return this.$$pf_Annotations},e.prototype.set_annotations=function(e){return this.$$pf_Annotations=e,e},e.prototype.get_doubleID2DoubleValue=function(){return this.m_resource.d},e.prototype.getModuleByName=function(e){if(!(e in this.m_resource.m))throw Error.argument("name","Unrecognized module");return this.getModule(this.m_resource.m[e])},e.prototype.getByteArray=function(e){if(e<0||!this.m_resource.b||e>=this.m_resource.b.length)throw Error.argumentOutOfRange("byteArrayID");return this.m_initializedByteArrays[e]||(this.m_initializedByteArrays[e]=new jt(this.m_resource.b[e]))},e.prototype.getString=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_STRING)throw Error.argument("blobID","Requested blob is not a string");if(null==this.m_initializedObjects[t]){var n=this.GetBlobData(t).get_item(0);this.m_initializedObjects[t]=this.m_stringTable.getString(n)}return this.m_initializedObjects[t]},e.prototype.getRegex=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_REGEX)throw Error.argument("blobID","Requested blob is not a Regex");if(!this.m_initializedObjects[t]){var n=this.GetBlobData(t),r=this.getString(n.get_item(0)),i=1===n.get_item(1);this.m_initializedObjects[t]=new RegExp(r,i?"i":"")}return this.m_initializedObjects[t]},e.prototype.getSRE=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_SRE)throw Error.argument("blobID","Requested blob is not an SRE");throw Error.notImplemented()},e.prototype.getModule=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_NLMODULE)throw Error.argument("blobID","Requested blob is not an NL module");return this.m_initializedObjects[t]||(this.m_initializedObjects[t]=this.m_moduleFactory.getNLModule(this.GetBlobData(t),this))},e.prototype.getAnnotationQuery=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_ANNOTATION_QUERY)throw Error.argument("blobID","Requested blob is not an annotation query");return this.m_initializedObjects[t]||(this.m_initializedObjects[t]=new pe(new yt(this.GetBlobData(t),this)))},e.prototype.getAnnotationScript=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_ANNOTATION_SCRIPT)throw Error.argument("blobID","Requested blob is not an annotation script");return this.m_initializedObjects[t]||(this.m_initializedObjects[t]=new St(new xt(this.GetBlobData(t),this)))},e.prototype.getFilter=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_FILTER)throw Error.argument("blobID","Requested blob is not a filter");return this.m_initializedObjects[t]||(this.m_initializedObjects[t]=this.m_filterFactory.getFilter(this.GetBlobData(t),this))},e.prototype.getRawFlatLexicon=function(t){if(t<e.c_firstLegalBlobID||t>=this.m_resource.t.length)throw Error.argumentOutOfRange("blobID");if(this.m_resource.t[t]!==e.c_blobType_FLAT_LEXICON)throw Error.argument("blobID","Requested blob is not a raw flat lexicon");return this.m_initializedObjects[t]||(this.m_initializedObjects[t]=new Gt(this.GetBlobData(t),this))},e.prototype.GetBlobData=function(e){var t=this.m_resource.n[e],n=(e<this.m_resource.t.length-1?this.m_resource.n[e+1]:this.m_resource.n.length)-t;if(t<0||n<0||t+n>this.m_resource.n.length)throw Error.invalidOperation("Resource contains illegal int array range ("+t+","+n+")");var r=new se.i(Number);return r.fromArray(this.m_resource.n,t,n),r},e.c_firstLegalBlobID=1,e.c_annotationsBlobID=0,e.c_blobType_NONE=0,e.c_blobType_STRING=1,e.c_blobType_REGEX=2,e.c_blobType_SRE=3,e.c_blobType_NLMODULE=4,e.c_blobType_ANNOTATION_QUERY=5,e.c_blobType_ANNOTATION_SCRIPT=6,e.c_blobType_FILTER=7,e.c_blobType_COMPILED_DATA_TABLE=8,e.c_blobType_FLAT_LEXICON=10,e}();(0,o.l)(qt,"be8789d8$ObjectFetcher",null,[ue]);var zt=function(){function e(e,t,n){if(this.m_fieldNames=null,this.m_values=null,this.prediction=null,!e)throw Error.argumentNull("prediction");if(!t)throw Error.argumentNull("fieldNames");if(!n)throw Error.argumentNull("values");if(t.length!==n.length)throw Error.argument("values","fieldNames and values do not have same length");this.prediction=e,this.m_fieldNames=t,this.m_values=n}return e.prototype.get_prediction=function(){return this.prediction},e.prototype.get_fieldCount=function(){return this.m_fieldNames.length},e.prototype.getFieldName=function(e){return e>=0&&e<this.m_fieldNames.length?this.m_fieldNames[e]:null},e.prototype.getValue=function(e){return e>=0&&e<this.m_values.length?this.m_values[e]:null},e}();(0,o.l)(zt,"f5d70cd4$PredictionData",null,[]);var Kt=function(){function e(e,t){if(this.m_predictions=null,this.m_tokenAttributes=null,!e)throw Error.argumentNull("predictions");if(!t)throw Error.argumentNull("tokenAttributes");this.m_predictions=e,this.m_tokenAttributes=t}return e.prototype.getPredictions=function(){return this.m_predictions},e.prototype.getAllTokenAttributes=function(){return this.m_tokenAttributes},e}();(0,o.l)(Kt,"27008ee2$PredictionDataWithTokenAttributes",null,[]);var Qt=function(){function e(e,t){this.prediction=null,this.score=0,this.prediction=e,this.score=t}return e.prototype.get_prediction=function(){return this.prediction},e.prototype.get_score=function(){return this.score},e}();(0,o.l)(Qt,"a0e0a1ce$PredictionWithScore",null,[]);var Zt=function(){function e(e,t,n){if(this.m_fieldNames=null,this.m_values=null,this.attributeName=null,!e)throw Error.argumentNull("attributeName");if(!t)throw Error.argumentNull("fieldNames");if(!n)throw Error.argumentNull("values");if(t.length!==n.length)throw Error.argument("values","fieldNames and values do not have same length");this.attributeName=e,this.m_fieldNames=t,this.m_values=n}return e.prototype.get_attributeName=function(){return this.attributeName},e.prototype.get_fieldCount=function(){return this.m_fieldNames.length},e.prototype.getFieldName=function(e){return e>=0&&e<this.m_fieldNames.length?this.m_fieldNames[e]:null},e.prototype.getValue=function(e){return e>=0&&e<this.m_values.length?this.m_values[e]:null},e}();(0,o.l)(Zt,"6ec61305$TokenAttributes",null,[]);var Jt=(0,o.y)("bc29dae7$INLModuleFactory"),Xt=(0,o.y)("7f038213$INLModule"),Yt=n(2332),en=n(5774),tn=function(){function e(e,t,n,r,i){this.$$p_cTokensCoveredByLongestPrefix=0,this.$$p_iFirstCoveredToken=0,this.$$p_lexicalAnalyses=null,this.$$p_tokens=null,this.$$pd_cTokensCoveredByLongestPrefix=0,this.$$pd_iFirstCoveredToken=0,this.$$pd_lexicalAnalyses=null,this.$$pd_tokens=null,this.$$this=null,this.$$v_10_$$idx_A=0,this.$$v_11_analysis=null,this.$$v_12_val=0,this.$$v_13_text=null,this.$$v_4_iCoveredToken=0,this.$$v_5_currToken=null,this.$$v_6_newToken=null,this.$$v_7_multipleAnalyses=null,this.$$v_8_$$arr_8=null,this.$$v_9_$$len_9=0,this._current=null,this._nextMethod=null,this._state=-1,this.$$ge=this.getEnumerator,this.$$cu=this.get_current,this.$$mn=this.moveNext,this.$$rst=this.reset,this.$$this=e,this.$$pd_tokens=t,this.$$p_tokens=t,this.$$pd_iFirstCoveredToken=n,this.$$p_iFirstCoveredToken=n,this.$$pd_cTokensCoveredByLongestPrefix=r,this.$$p_cTokensCoveredByLongestPrefix=r,this.$$pd_lexicalAnalyses=i,this.$$p_lexicalAnalyses=i}return e.prototype.$$sm_0_initial=function(){return this.$$v_4_iCoveredToken=0,this.$$sm_1_for_body},e.prototype.$$sm_1_for_body=function(){var e=this;if(!(this.$$v_4_iCoveredToken<this.$$p_cTokensCoveredByLongestPrefix))return this.$$sm_1_for_body_after;if(this.$$v_5_currToken=this.$$p_tokens.get_items()[this.$$v_4_iCoveredToken+this.$$p_iFirstCoveredToken],this.$$v_6_newToken=new v.d(this.$$this.m_init.annotations),1!==this.$$p_cTokensCoveredByLongestPrefix&&this.$$this.m_init.isChunkingPhrasalEntries||this.$$v_6_newToken.copyAnnotationsFrom(this.$$v_5_currToken),this.$$this.m_init.multipleAnalysesAttribute>=0){for(this.$$v_6_newToken.tryGetAnnotation_Cast(de.e,this.$$this.m_init.multipleAnalysesAttribute,(0,m.m)((function(){return e.$$v_7_multipleAnalyses}),(function(t){return e.$$v_7_multipleAnalyses=t})))?this.$$v_7_multipleAnalyses=this.$$v_7_multipleAnalyses.cloneIfReadOnly():this.$$v_7_multipleAnalyses=new de.e(this.$$this.m_init.annotations,y.Annotations.typeiD_FeatureBundle),this.$$v_8_$$arr_8=this.$$p_lexicalAnalyses.get_items(),this.$$v_9_$$len_9=this.$$v_8_$$arr_8.length,this.$$v_10_$$idx_A=0;this.$$v_10_$$idx_A<this.$$v_9_$$len_9;++this.$$v_10_$$idx_A)this.$$v_11_analysis=this.$$v_8_$$arr_8[this.$$v_10_$$idx_A],Array.add(this.$$v_7_multipleAnalyses.get_items(),this.$$v_11_analysis);this.$$v_6_newToken.setAnnotation(this.$$this.m_init.multipleAnalysesAttribute,this.$$v_7_multipleAnalyses)}else this.$$this.m_init.singleAnalysisAttribute>=0?this.$$v_6_newToken.setAnnotation(this.$$this.m_init.singleAnalysisAttribute,this.$$p_lexicalAnalyses.get_items()[0]):this.$$this.m_init.booleanAttribute>=0?this.$$v_6_newToken.setAnnotation(this.$$this.m_init.booleanAttribute,!0):this.$$this.m_init.isOverlayingSingleAnalysis?this.$$p_lexicalAnalyses.get_items()[0].forEachAnnotation((function(t,n){return e.$$v_6_newToken.setAnnotation(t,n)})):(this.$$v_6_newToken.copyAnnotationsFrom(this.$$p_lexicalAnalyses.get_items()[0]),1!==this.$$p_cTokensCoveredByLongestPrefix&&this.$$this.m_init.isChunkingPhrasalEntries||(this.$$v_5_currToken.tryGetAnnotation_Cast(Number,this.$$this.m_init.attr_Span_StartIndex,(0,m.m)((function(){return e.$$v_12_val}),(function(t){return e.$$v_12_val=t})))&&this.$$v_6_newToken.setAnnotation(this.$$this.m_init.attr_Span_StartIndex,this.$$v_12_val),this.$$v_5_currToken.tryGetAnnotation_Cast(Number,this.$$this.m_init.attr_Span_Length,(0,m.m)((function(){return e.$$v_12_val}),(function(t){return e.$$v_12_val=t})))&&this.$$v_6_newToken.setAnnotation(this.$$this.m_init.attr_Span_Length,this.$$v_12_val),this.$$v_5_currToken.tryGetAnnotation_Cast(String,this.$$this.m_init.attr_Span_Text,(0,m.m)((function(){return e.$$v_13_text}),(function(t){return e.$$v_13_text=t})))&&this.$$v_6_newToken.setAnnotation(this.$$this.m_init.attr_Span_Text,this.$$v_12_val)));return this._current=this.$$v_6_newToken,this._state=2,this.$$sm_2_after_yield_return},e.prototype.$$sm_1_for_body_after=function(){this._state=3},e.prototype.$$sm_1_for_increment=function(){return this.$$v_4_iCoveredToken++,this.$$sm_1_for_body},e.prototype.$$sm_2_after_yield_return=function(){return this.$$p_cTokensCoveredByLongestPrefix>1&&this.$$this.m_init.isChunkingPhrasalEntries?this.$$sm_1_for_body_after:this.$$sm_1_for_increment},e.prototype.dispose=function(){},e.prototype.getEnumerator=function(){return-1===this._state?(this._state=0,this):new e(this.$$this,this.$$pd_tokens,this.$$pd_iFirstCoveredToken,this.$$pd_cTokensCoveredByLongestPrefix,this.$$pd_lexicalAnalyses).getEnumerator()},e.prototype.moveNext=function(){if(3===this._state)return!1;for(this._state?this._state=1:(this._state=1,this._nextMethod=this.$$sm_0_initial());1===this._state;)this._nextMethod=this._nextMethod();return 3!==this._state},e.prototype.reset=function(){throw Error.invalidOperation("Reset() is not supported")},e.prototype.get_current=function(){return this._current},e}();(0,o.l)(tn,"e1021d2b$$$sm_Microsoft$NaturalLanguage$Runtime$ScriptSharp$NLModules$FlatLexiconNLModule$CreateNewTokenAndApplyLexicalAnalyses",null,[Sys.IDisposable,en.i.$$(I.m),Yt.m.$$(I.m)]);var nn=n(9580),rn=function(){function e(e,t,n){this.m_module=null,this.m_tokens=null,this.m_parentText=null,this.m_iFirstToken=0,this.m_iCurrToken=0,this.m_currTokenString=null,this.m_currTokenStartIndex=0,this.m_currTokenLength=0,this.m_cCharsOutputtedForCurrToken=0,this.m_cTokensCoveredByLongestPrefix=0,this.m_tagValueOfLongestPrefix=0,this.m_fAtLeastOneTokenHadSpan_Text=!1,this.m_module=e,this.m_tokens=t,this.m_parentText=n}return e.prototype.getNextChar=function(e){var t,n=this;null===this.m_currTokenString&&(this.m_module.GetTokenText(this.m_tokens.get_items()[this.m_iCurrToken],this.m_parentText,(0,m.m)((function(){return n.m_currTokenString}),(function(e){return n.m_currTokenString=e})),(0,m.m)((function(){return n.m_currTokenStartIndex}),(function(e){return n.m_currTokenStartIndex=e})),(0,m.m)((function(){return n.m_currTokenLength}),(function(e){return n.m_currTokenLength=e})),(0,m.m)((function(){return t}),(function(e){return t=e}))),this.m_fAtLeastOneTokenHadSpan_Text=t||this.m_fAtLeastOneTokenHadSpan_Text);return this.m_cCharsOutputtedForCurrToken<this.m_currTokenLength?(e.val=this.m_currTokenString.charAt(this.m_currTokenStartIndex+this.m_cCharsOutputtedForCurrToken),++this.m_cCharsOutputtedForCurrToken,!0):this.m_iCurrToken===this.m_tokens.get_items().length-1?(e.val="\0",!1):(++this.m_iCurrToken,this.m_cCharsOutputtedForCurrToken=0,this.m_currTokenString=null,e.val=" ",!0)},e.prototype.registerTrieEnding=function(e,t,n){this.m_cCharsOutputtedForCurrToken===this.m_currTokenLength&&this.m_currTokenString&&(this.m_tagValueOfLongestPrefix=t,this.m_cTokensCoveredByLongestPrefix=this.m_iCurrToken-this.m_iFirstToken+1)},e.prototype.resetStartingFrom=function(e){if(e<0||e>=this.m_tokens.get_items().length)throw Error.argumentOutOfRange("iToken");this.m_iFirstToken=e,this.m_iCurrToken=e,this.m_currTokenString=null,this.m_currTokenStartIndex=0,this.m_currTokenLength=0,this.m_cCharsOutputtedForCurrToken=0,this.m_cTokensCoveredByLongestPrefix=0,this.m_tagValueOfLongestPrefix=-1,this.m_fAtLeastOneTokenHadSpan_Text=!1},e.prototype.getLookupResults=function(e,t,n){e.val=this.m_cTokensCoveredByLongestPrefix,t.val=this.m_tagValueOfLongestPrefix,n.val=this.m_fAtLeastOneTokenHadSpan_Text},e}();(0,o.l)(rn,"e3946f89$TriePrefixVisitor",null,[nn.l]);var on=function(){function e(e){this.m_init=null,e.singleAnalysisAttribute,e.multipleAnalysesAttribute,e.booleanAttribute,this.m_init=e}return e.prototype.execute=function(e){var t,n;if(!e.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_Tokens,(0,m.m)((function(){return t}),(function(e){return t=e}))))throw Error.argument("Expected input parameter NLMod.Tokens not found");e.tryGetAnnotation_Cast(String,this.m_init.attr_NLMod_ParentText,(0,m.m)((function(){return n}),(function(e){return n=e})))||(n=null);var r=this.GetAdjustedTokens(t,n),i=y.Annotations.CloneIfReadOnly(e);return i.setAnnotation(this.m_init.attr_NLMod_Tokens,r),i},e.prototype.GetAdjustedTokens=function(e,t){var n=null,r=this.m_init.flatLexicon.get_trie(),i=new rn(this,e,t),a=null;this.m_init.flatLexicon.isCaseInsensitive()&&(a=o.i(this.m_init.flatLexicon,this.m_init.flatLexicon.getCaseInsensitiveForm,"getCaseInsensitiveForm"));for(var s,l,u,c=0,d=function(){var o=e.get_items()[c];if(i.resetStartingFrom(c),r.visitPrefixes(i,a),i.getLookupResults((0,m.m)((function(){return s}),(function(e){return s=e})),(0,m.m)((function(){return l}),(function(e){return l=e})),(0,m.m)((function(){return u}),(function(e){return u=e}))),s>0){var d;p.m_init.flatLexicon.getAnalysesForTrieTag(l,(0,m.m)((function(){return d}),(function(e){return d=e})));for(var g=p.CreateNewTokenAndApplyLexicalAnalyses(e,c,s,d).$$ge();g.$$mn();){var h=g.$$cu();if(s>1&&p.m_init.isChunkingPhrasalEntries&&p.CreatePhrasalToken(e,t,c,o,s,u,h),!n){n=new de.e(p.m_init.annotations,y.Annotations.typeiD_FeatureBundle);for(var _=0;_<c;++_)Array.add(n.get_items(),e.get_items()[_])}Array.add(n.get_items(),h)}c+=s}else n&&Array.add(n.get_items(),o),++c},p=this;c<e.get_items().length;)d();return n||e},e.prototype.CreatePhrasalToken=function(e,t,n,r,i,o,a){var s;if(o)s=!0;else if(this.m_init.isNormalizingPhrasalWhitespace){s=!1;for(var l=-1,u=function(r){var i,o,a=e.get_items()[n+r];if(!a.tryGetAnnotation_Cast(Number,c.m_init.attr_Span_StartIndex,(0,m.m)((function(){return i}),(function(e){return i=e})))||!a.tryGetAnnotation_Cast(Number,c.m_init.attr_Span_Length,(0,m.m)((function(){return o}),(function(e){return o=e}))))throw Error.invalidOperation("FlatLexiconNLModule: token unexpectedly missing one or more required Span.* annotations");if(r>0){if(i>l+1)return s=!0,"break";if(l<0||null===t||l>=t.length)throw Error.invalidOperation("FlatLexiconNLModule: token with unexpectedly out of range Span.StartIndex/Span.Length annotations");if(" "!==t.charAt(l))return s=!0,"break"}l=i+o},c=this,d=0;d<i;d++){if("break"===u(d))break}}else s=!1;if(s){for(var p=new Sys.StringBuilder,g=function(r){var i,o,a,s;h.GetTokenText(e.get_items()[n+r],t,(0,m.m)((function(){return i}),(function(e){return i=e})),(0,m.m)((function(){return o}),(function(e){return o=e})),(0,m.m)((function(){return a}),(function(e){return a=e})),(0,m.m)((function(){return s}),(function(e){return s=e}))),r>0&&p.append(" "),p.append(i.substr(o,a))},h=this,_=0;_<i;++_)g(_);a.setAnnotation(this.m_init.attr_Span_Text,p.toString())}var f,y,v,S=e.get_items()[n+i-1];r.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_StartIndex,(0,m.m)((function(){return f}),(function(e){return f=e})))&&S.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_StartIndex,(0,m.m)((function(){return y}),(function(e){return y=e})))&&S.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_Length,(0,m.m)((function(){return v}),(function(e){return v=e})))?(a.setAnnotation(this.m_init.attr_Span_StartIndex,f),a.setAnnotation(this.m_init.attr_Span_Length,y+v-f)):(a.removeAnnotation(this.m_init.attr_Span_StartIndex),a.removeAnnotation(this.m_init.attr_Span_Length))},e.prototype.CreateNewTokenAndApplyLexicalAnalyses=function(e,t,n,r){return new tn(this,e,t,n,r)},e.prototype.GetTokenText=function(e,t,n,r,i,o){if(e.tryGetAnnotation_Cast(String,this.m_init.attr_Span_Text,n))o.val=!0,r.val=0,i.val=n.val.length;else{if(o.val=!1,null===t)throw Error.argument("parentText","Expected parameter NLMod.ParentText not found");if(n.val=t,!e.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_StartIndex,r))throw Error.argument("Token missing required Span.StartIndex annotation","token");if(!e.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_Length,i))throw Error.argument("Token missing required Span.Length annotation","token");if(r.val<0||i.val<0||r.val+i.val>n.val.length)throw Error.argument("Token start/length values out of range","token")}},e}();(0,o.l)(on,"b5083adf$FlatLexiconNLModule",null,[Xt]);var an=function(){return function(e,t){this.annotations=null,this.attr_NLMod_Tokens=0,this.attr_NLMod_ParentText=0,this.attr_Span_StartIndex=0,this.attr_Span_Length=0,this.attr_Span_Text=0,this.singleAnalysisAttribute=0,this.multipleAnalysesAttribute=0,this.booleanAttribute=0,this.isChunkingPhrasalEntries=!1,this.isNormalizingPhrasalWhitespace=!1,this.isOverlayingSingleAnalysis=!1,this.flatLexicon=null,this.annotations=t.get_annotations();var n=0;try{this.attr_NLMod_Tokens=e.get_item(n),++n,this.attr_NLMod_ParentText=e.get_item(n),++n,this.attr_Span_StartIndex=e.get_item(n),++n,this.attr_Span_Length=e.get_item(n),++n,this.attr_Span_Text=e.get_item(n),++n,this.singleAnalysisAttribute=e.get_item(n),++n,this.multipleAnalysesAttribute=e.get_item(n),++n,this.booleanAttribute=e.get_item(n),++n,this.isChunkingPhrasalEntries=1===e.get_item(n),++n,this.isNormalizingPhrasalWhitespace=1===e.get_item(n),++n,this.isOverlayingSingleAnalysis=1===e.get_item(n),++n,this.flatLexicon=t.getRawFlatLexicon(e.get_item(n)),++n}catch(e){throw Error.argument("initData")}}}();(0,o.l)(an,"21c6b4e5$FlatLexiconNLModuleInit",null,[]);var sn=n(1128),ln=(0,o.y)("a061af21$ITokenStringGeneratorServiceProvider"),un=function(){return function(){this.iCurrAlternative=0,this.filterNode=null,this.scoreSoFar=0}}();(0,o.l)(un,"a9d79def$FeatureGenStackRec",null,[]);var cn=function(){function e(e){this.tokenIndex2FirstStringIndex=null,this.tokenIndex2StringCount=null,this.stringIDs=null,this.stringScores=null,this.tokenIndex2FirstStringIndex=new Array(e),this.tokenIndex2StringCount=new Array(e),this.stringIDs=new Array(0),this.stringScores=new Array(0)}return e.prototype.get_tokenIndex2FirstStringIndex=function(){return this.tokenIndex2FirstStringIndex},e.prototype.get_tokenIndex2StringCount=function(){return this.tokenIndex2StringCount},e.prototype.get_stringIDs=function(){return this.stringIDs},e.prototype.get_stringScores=function(){return this.stringScores},e}();(0,o.l)(cn,"f7a8a0a5$TokenStringLattice",null,[]);var dn=function(){function e(){}return e.reduce=function(e,t,n,r,i){for(var o=i,a=0;a<n.length;a++)o=r(o,n[a]);return o},e.map=function(e,t,n,r){for(var i=new Array(n.length),o=0;o<n.length;o++)i[o]=r(n[o]);return i},e.take=function(e,t,n){for(var r=new Array(Math.min(n,t.length)),i=0;i<r.length;i++)r[i]=t[i];return r},e.where=function(e,t,n){for(var r=[],i=0,o=t;i<o.length;i++){var a=o[i];n(a)&&Array.add(r,a)}return r},e}();(0,o.l)(dn,"ba209990$ArrayUtils",null,[]);var pn=function(){function e(t,n){o.m(this,e.$$(t,n)),this.key=o.c(o.f(this,"NLRT.KeyValuePair$2").TK),this.value=o.c(o.f(this,"NLRT.KeyValuePair$2").TV)}return e.$$=function(t,n){return o.o("NLRT.KeyValuePair$2",e,[{TK:t},{TV:n}],null,[],{})},e}(),gn=function(){function e(){}return e.tryGetValue=function(e,t,n,r){return r.val=t[n],n in t},e.getKeyValues=function(e){var t=[];for(var n in e){var r={key:n,value:e[n]},i=new pn(String,Number);i.key=r.key,i.value=r.value,Array.add(t,i)}return t},e}();(0,o.l)(gn,"f7d715d1$DictionaryUtils",null,[]);var hn=function(){function e(e){this.m_init=null,this.m_maxFeatureTemplatePreInitialTokenPositions=0,this.m_maxFeatureTemplatePostFinalTokenPositions=0,this.m_maxFeatureTemplateSlots=0,this.get_tokenStringTable=this.get_TokenStringTable,this.getTokenSurfaceString=this.GetTokenSurfaceString,this.m_init=e,this.m_maxFeatureTemplatePreInitialTokenPositions=0,this.m_maxFeatureTemplatePostFinalTokenPositions=0,this.m_maxFeatureTemplateSlots=0;for(var t=0,n=this.m_init.featureTemplates;t<n.length;t++){var r=n[t];this.m_maxFeatureTemplatePreInitialTokenPositions=Math.max(this.m_maxFeatureTemplatePreInitialTokenPositions,r.get_preInitialTokenPositions()),this.m_maxFeatureTemplatePostFinalTokenPositions=Math.max(this.m_maxFeatureTemplatePostFinalTokenPositions,r.get_postFinalTokenPositions()),this.m_maxFeatureTemplateSlots=Math.max(this.m_maxFeatureTemplateSlots,r.get_slots().length)}}return e.prototype.get_filterTrie=function(){return this.m_init.tokenString2TokenStringIdStringTable.get_trie()},e.prototype.execute=function(e){if(!e)throw Error.argumentNull("input");var t,n;this.GetTokensAndTokenStringAlternatives(e,(0,m.m)((function(){return t}),(function(e){return t=e})),(0,m.m)((function(){return n}),(function(e){return n=e})));var r=null,i=null,o={};if(this.m_init.isForSequenceLabeling){t=y.Annotations.CloneIfReadOnly(t);for(var a=0;a<t.get_items().length;++a)t.get_items()[a]=y.Annotations.CloneIfReadOnly(t.get_items()[a])}else r=this.GetOrCreateFeaturesListAndCollectFeatureNames(e,o,(0,m.m)((function(){return i}),(function(e){return i=e})));for(var s=new Array(this.m_maxFeatureTemplateSlots),l=new Array(this.m_maxFeatureTemplateSlots),u=0;u<l.length;++u)l[u]=new un;for(a=-this.m_maxFeatureTemplatePreInitialTokenPositions;a<t.get_items().length+this.m_maxFeatureTemplatePostFinalTokenPositions;++a){var c=null;this.m_init.isForSequenceLabeling&&(c=t.get_items()[a],o={},r=this.GetOrCreateFeaturesListAndCollectFeatureNames(c,o,(0,m.m)((function(){return i}),(function(e){return i=e}))));for(var d=0,p=this.m_init.featureTemplates;d<p.length;d++){var g=p[d];if(!(a<0&&-a>g.get_preInitialTokenPositions()||a>=t.get_items().length&&a-t.get_items().length+1>g.get_postFinalTokenPositions())){for(var h=!0,_=0;_<g.get_slots().length;++_){var f=a+g.get_slots()[_];if(s[_]=f,f<0?this.m_init.preInitialTokenStringId<0:f>=t.get_items().length?this.m_init.postFinalTokenStringId<0:!n.get_tokenIndex2StringCount()[f]){h=!1;break}}h&&this.InstantiateFeatureTemplateAt(g,n,(0,m.m)((function(){return r}),(function(e){return r=e})),(0,m.m)((function(){return i}),(function(e){return i=e})),o,l,s)}}this.m_init.isForSequenceLabeling&&(c.setAnnotation(this.m_init.isGeneratingFloatingPointFeatures?this.m_init.attr_NLMod_FloatingPointFeatureIDs:this.m_init.attr_NLMod_BooleanFeatureIDs,r),this.m_init.isGeneratingFloatingPointFeatures&&c.setAnnotation(this.m_init.attr_NLMod_FloatingPointFeatureIDValues,i))}var v=y.Annotations.CloneIfReadOnly(e);return this.m_init.isForSequenceLabeling?v.setAnnotation(this.m_init.attr_NLMod_Tokens,t):(v.setAnnotation(this.m_init.isGeneratingFloatingPointFeatures?this.m_init.attr_NLMod_FloatingPointFeatureIDs:this.m_init.attr_NLMod_BooleanFeatureIDs,r),this.m_init.isGeneratingFloatingPointFeatures&&v.setAnnotation(this.m_init.attr_NLMod_FloatingPointFeatureIDValues,i)),v},e.prototype.GetTokensAndTokenStringAlternatives=function(e,t,n){if(!e||!e.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_Tokens,t))throw Error.argument("Expected input parameter NLMod.Tokens not found");var r;e.tryGetAnnotation_Cast(String,this.m_init.attr_NLMod_ParentText,(0,m.m)((function(){return r}),(function(e){return r=e})))||(r=""),n.val=new cn(t.val.get_items().length);for(var i=dn.where(sn.i,this.m_init.tokenStringGenerators,(function(t){return!t.get_inputFilter()||t.get_inputFilter().isMatch(e,null,null)})),o=function(e){var o=t.val.get_items()[e],s=null;n.val.get_tokenIndex2FirstStringIndex()[e]=n.val.get_stringIDs().length,n.val.get_tokenIndex2StringCount()[e]=0;for(var l=0,u=0,c=i;u<c.length;u++){var d=c[u];d.get_maxExistingStrings()>0&&n.val.get_tokenIndex2StringCount()[e]+l>=d.get_maxExistingStrings()||(d.get_tokenFilter()&&!d.get_tokenFilter().isMatch(o,null,null)||d.apply(a,o,e,n.val,r,(0,m.m)((function(){return s}),(function(e){return s=e})),(0,m.m)((function(){return l}),(function(e){return l=e}))))}},a=this,s=0;s<t.val.get_items().length;++s)o(s)},e.prototype.InstantiateFeatureTemplateAt=function(e,t,n,r,i,o,a){var s=0;for(o[0].iCurrAlternative=-1,o[0].filterNode=e.get_rootFilterNode();;){for(var l=a[s],u=l<0||l>=t.get_tokenIndex2StringCount().length?1:t.get_tokenIndex2StringCount()[l],c=!1,d=function(){++o[s].iCurrAlternative;var a,u=void 0,d=void 0;if(l<0)u=p.m_init.preInitialTokenStringId,d=1;else if(l>=t.get_tokenIndex2FirstStringIndex().length)u=p.m_init.postFinalTokenStringId,d=1;else{var g=t.get_tokenIndex2FirstStringIndex()[l]+o[s].iCurrAlternative;u=t.get_stringIDs()[g],d=t.get_stringScores()[g]}if(o[s].scoreSoFar=d*(s?o[s-1].scoreSoFar:e.get_score()),gn.tryGetValue(Object,o[s].filterNode,u.toString(),(0,m.m)((function(){return a}),(function(e){return a=e})))){if(s===e.get_slots().length-1){var h,_=a;if(o[s].scoreSoFar)gn.tryGetValue(Number,i,_.toString(),(0,m.m)((function(){return h}),(function(e){return h=e})))||(h=-1),h<0&&(n.val=y.Annotations.CloneIfReadOnly(n.val),Array.add(n.val.get_items(),_)),p.m_init.isGeneratingFloatingPointFeatures&&(r.val=y.Annotations.CloneIfReadOnly(r.val),h<0?Array.add(r.val.get_items(),o[s].scoreSoFar):r.val.get_items()[h]=r.val.get_items()[h]+o[s].scoreSoFar),h<0&&(p.m_init.isUniqifyingFeatureLists||p.m_init.isGeneratingFloatingPointFeatures)&&(i[_.toString()]=n.val.get_items().length-1)}else o[++s].iCurrAlternative=-1,o[s].filterNode=a;return c=!0,"break"}},p=this;o[s].iCurrAlternative<u-1;){if("break"===d())break}if(!c&&--s<0)break}},e.prototype.GetOrCreateFeaturesListAndCollectFeatureNames=function(e,t,n){var r;if(e.tryGetAnnotation_Cast(f.z,this.m_init.isGeneratingFloatingPointFeatures?this.m_init.attr_NLMod_FloatingPointFeatureIDs:this.m_init.attr_NLMod_BooleanFeatureIDs,(0,m.m)((function(){return r}),(function(e){return r=e}))))for(var i=0;i<r.get_items().length;++i)t[r.get_items()[i].toString()]=i;else r=new de.e(this.m_init.annotations,y.Annotations.typeiD_Integer);if(this.m_init.isGeneratingFloatingPointFeatures){if(e.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_FloatingPointFeatureIDValues,n)||(n.val=new de.e(this.m_init.annotations,y.Annotations.typeiD_FloatingPoint)),n.val.get_items().length!==r.get_items().length)throw Error.argument("Length mismatch between NLMod.FloatingPointFeatureIDs and NLMod.FloatingPointFeatureValues on item "+this.m_init.annotations.valueToString(y.Annotations.typeiD_FeatureBundle,e))}else n.val=null;return r},e.prototype.get_TokenStringTable=function(){return this.m_init.tokenString2TokenStringIdStringTable},e.prototype.GetTokenSurfaceString=function(e,t){var n,r;if(t.tryGetAnnotation_Cast(String,this.m_init.attr_Span_Text,(0,m.m)((function(){return r}),(function(e){return r=e}))))n=r;else{var i,o;if(!t.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_StartIndex,(0,m.m)((function(){return i}),(function(e){return i=e}))))throw Error.argument("Token is missing Span.StartIndex");if(!t.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_Length,(0,m.m)((function(){return o}),(function(e){return o=e}))))throw Error.argument("Token is missing Span.Length");if(i<0||o<0||i+o>e.length)throw Error.argument("Token indices are out of range");n=e.substr(i,o)}return n},e}();(0,o.l)(hn,"e2bf8f2d$NGramNLModule",null,[Xt,ln]);var _n=(0,o.y)("eb6cf0c4$IFeatureTemplate"),fn=function(){function e(t){if(this.$$pf_Slots=null,this.$$pf_PreInitialTokenPositions=0,this.$$pf_PostFinalTokenPositions=0,this.$$pf_Score=0,this.$$pf_RootFilterNode=null,t){var n=0;try{if(t.get_item(n)!==e.c_MAGIC_NUMBER)throw Error.argument("initData","Input does not represent a feature template");++n;var r=t.get_item(n);++n,this.set_slots(new Array(r));for(var i=0;i<r;++i)this.get_slots()[i]=t.get_item(n),++n;this.set_preInitialTokenPositions(t.get_item(n)),++n,this.set_postFinalTokenPositions(t.get_item(n)),++n,this.set_score(t.get_item(n)),++n,this.set_rootFilterNode(e.ReadFeatureTemplateTrieNodeAux(t,(0,m.m)((function(){return n}),(function(e){return n=e}))))}catch(e){throw Error.argument("initData")}}}return e.prototype.get_slots=function(){return this.$$pf_Slots},e.prototype.set_slots=function(e){return this.$$pf_Slots=e,e},e.prototype.get_preInitialTokenPositions=function(){return this.$$pf_PreInitialTokenPositions},e.prototype.set_preInitialTokenPositions=function(e){return this.$$pf_PreInitialTokenPositions=e,e},e.prototype.get_postFinalTokenPositions=function(){return this.$$pf_PostFinalTokenPositions},e.prototype.set_postFinalTokenPositions=function(e){return this.$$pf_PostFinalTokenPositions=e,e},e.prototype.get_score=function(){return this.$$pf_Score},e.prototype.set_score=function(e){return this.$$pf_Score=e,e},e.prototype.get_rootFilterNode=function(){return this.$$pf_RootFilterNode},e.prototype.set_rootFilterNode=function(e){return this.$$pf_RootFilterNode=e,e},e.ReadFeatureTemplateTrieNodeAux=function(t,n){var r=t.get_item(n.val);++n.val;for(var i={},o=0;o<r;++o){var a=t.get_item(n.val);++n.val,t.get_item(n.val)?i[a.toString()]=e.ReadFeatureTemplateTrieNodeAux(t,n):(++n.val,i[a.toString()]=t.get_item(n.val),++n.val)}return i},e.c_MAGIC_NUMBER=240803228,e}();(0,o.l)(fn,"9840d94d$FeatureTemplate",null,[_n]);var mn=n(2039),yn=function(){function e(e,t){if(this.annotations=null,this.isForSequenceLabeling=!1,this.isUniqifyingFeatureLists=!1,this.isGeneratingFloatingPointFeatures=!1,this.attr_NLMod_BooleanFeatureIDs=0,this.attr_NLMod_FloatingPointFeatureIDs=0,this.attr_NLMod_FloatingPointFeatureIDValues=0,this.attr_NLMod_ParentText=0,this.attr_NLMod_Tokens=0,this.attr_Span_StartIndex=0,this.attr_Span_Length=0,this.attr_Span_Text=0,this.tokenString2TokenStringIdStringTable=null,this.preInitialTokenStringId=0,this.postFinalTokenStringId=0,this.tokenStringGenerators=null,this.featureTemplates=null,e){this.annotations=t.get_annotations();var n=0;try{this.isForSequenceLabeling=1===e.get_item(n),++n,this.isUniqifyingFeatureLists=1===e.get_item(n),++n,this.isGeneratingFloatingPointFeatures=1===e.get_item(n),++n,this.attr_NLMod_BooleanFeatureIDs=e.get_item(n),++n,this.attr_NLMod_FloatingPointFeatureIDs=e.get_item(n),++n,this.attr_NLMod_FloatingPointFeatureIDValues=e.get_item(n),++n,this.attr_NLMod_ParentText=e.get_item(n),++n,this.attr_NLMod_Tokens=e.get_item(n),++n,this.attr_Span_StartIndex=e.get_item(n),++n,this.attr_Span_Length=e.get_item(n),++n,this.attr_Span_Text=e.get_item(n),++n,this.tokenString2TokenStringIdStringTable=this.ParseStringTable(t.getByteArray(e.get_item(n))),++n,this.preInitialTokenStringId=e.get_item(n),++n,this.postFinalTokenStringId=e.get_item(n),++n;var r=e.get_item(n);++n,this.tokenStringGenerators=new Array(r);for(var i=0;i<r;++i){var o=e.get_item(n);++n;var a=this.tokenString2TokenStringIdStringTable.get_trie(),s=new se.i(Number);s.fromReadOnlyList(e,n,o),this.tokenStringGenerators[i]=this.ParseTokenStringGenerator(s,t,a),n+=o}var l=e.get_item(n);++n,this.featureTemplates=new Array(l);for(var u=0;u<l;++u){var c=e.get_item(n);++n;var d=new se.i(Number);d.fromReadOnlyList(e,n,c),this.featureTemplates[u]=this.ParseFeatureTemplate(d),n+=c}}catch(e){throw Error.argument("initData")}}}return e.prototype.ParseStringTable=function(e){return new Wt.c(new Vt.k(e))},e.prototype.ParseTokenStringGenerator=function(e,t,n){return mn.z.create(e,t,n)},e.prototype.ParseFeatureTemplate=function(e){return new fn(e)},e}();(0,o.l)(yn,"e6beb6d7$NGramNLModuleInit",null,[]);var vn=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e){if(!e)throw Error.argumentNull("input");var t=e.clone();return this.m_init.script.execute(t,null),t},e}();(0,o.l)(vn,"22d95935$ScriptNLModule",null,[Xt]);var Sn=function(){return function(e,t){this.script=null,e&&(this.script=t.getAnnotationScript(e.get_item(0)))}}();(0,o.l)(Sn,"72e1aa8f$ScriptNLModuleInit",null,[]);var In=function(){function e(){}return e.norm=function(e){var t=dn.map(Number,Number,e,(function(e){return e*e}));return Math.sqrt(dn.reduce(Number,Number,t,(function(e,t){return e+t}),0))},e.max=function(e){return dn.reduce(Number,Number,e,(function(e,t){return e>t?e:t}),e[0])},e.compareDouble=function(e,t){return e>t?1:e<t?-1:0},e}();(0,o.l)(In,"53966e39$MathUtils",null,[]);var Cn=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e){if(!e)throw Error.argumentNull("input");var t=[],n=[];this.CollectRecognizedFeatures(e,t,n),this.AdjustAndNormalizeVector(t,n);for(var r={},i=0;i<t.length;++i)for(var o=t[i],a=this.m_init.internalFeatureId2FirstClassScorePairIndex.get_item(o),s=this.m_init.internalFeatureId2NumOfClassScorePairs.get_item(o),l=function(e){var t,o=u.m_init.classNames.get_item(u.m_init.classScorePair2ClassId.get_item(a+e)),s=u.m_init.classScorePair2Score.get_item(a+e);gn.tryGetValue(Number,r,o,(0,m.m)((function(){return t}),(function(e){return t=e})))||(t=0),r[o]=t+n[i]*s},u=this,c=0;c<s;++c)l(c);var d=gn.getKeyValues(r);d.sort((function(e,t){var n=e,r=t,i=-In.compareDouble(n.value,r.value);return i||(i=n.key.localeCompare(r.key)),i}));for(var p=new de.e(this.m_init.annotations,y.Annotations.typeiD_FeatureBundle),g=0,h=dn.take(pn.$$(String,Number),d,this.m_init.maxClassesToReturn);g<h.length;g++){var _=h[g],f=new v.d(this.m_init.annotations);f.setAnnotation(this.m_init.attr_Classification_PredictionString,_.key),f.setAnnotation(this.m_init.attr_Classification_Probability,_.value),Array.add(p.get_items(),f)}var S=e;return S.setAnnotation(this.m_init.attr_Classification_Predictions,p),S},e.prototype.CollectRecognizedFeatures=function(e,t,n){var r;if(e.tryGetAnnotation_Cast(I.m,this.m_init.attr_Classification_Features,(0,m.m)((function(){return r}),(function(e){return r=e})))){var i;if(r.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_FloatingPointFeatureIDs,(0,m.m)((function(){return i}),(function(e){return i=e})))){var o;if(!r.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_FloatingPointFeatureIDValues,(0,m.m)((function(){return o}),(function(e){return o=e})))||i.get_items().length!==o.get_items().length)throw Error.argument("NLMod.FloatingPointFeatureIDs and NLMod.FloatingPointFeatureIDValues are mismatched");this.CollectRecognizedFeaturesAux(i,o,t,n)}if(r.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_FloatingPointFeatureNames,(0,m.m)((function(){return i}),(function(e){return i=e})))){var a;if(!r.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_FloatingPointFeatureValues,(0,m.m)((function(){return a}),(function(e){return a=e})))||i.get_items().length!==a.get_items().length)throw Error.argument("NLMod.FloatingPointFeatureNames and NLMod.FloatingPointFeatureValues are mismatched");this.CollectRecognizedFeaturesAux(i,a,t,n)}r.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_BooleanFeatureIDs,(0,m.m)((function(){return i}),(function(e){return i=e})))&&this.CollectRecognizedFeaturesAux(i,null,t,n),r.tryGetAnnotation_Cast(f.z,this.m_init.attr_NLMod_BooleanFeatures,(0,m.m)((function(){return i}),(function(e){return i=e})))&&this.CollectRecognizedFeaturesAux(i,null,t,n)}},e.prototype.CollectRecognizedFeaturesAux=function(e,t,n,r){for(var i=function(i){var a;if(e.get_memberTypeID()===y.Annotations.typeiD_String){var s=e.get_items()[i];gn.tryGetValue(Number,o.m_init.dynamicFeature2InternalFeatureId,s,(0,m.m)((function(){return a}),(function(e){return a=e})))||(a=-1)}else{var l=e.get_items()[i];a=l>=o.m_init.minRecognizedStaticFeatureId&&l<=o.m_init.maxRecognizedStaticFeatureId?o.m_init.nonDirectStaticFeatureId2InternalFeatureIdMapping?o.m_init.nonDirectStaticFeatureId2InternalFeatureIdMapping.get_item(l-o.m_init.minRecognizedStaticFeatureId)-1:l-o.m_init.minRecognizedStaticFeatureId:-1}if(a>=0){var u=void 0;(u=t?t.get_items()[i]:1)>0&&(Array.add(n,a),Array.add(r,u))}},o=this,a=0;a<e.get_items().length;++a)i(a)},e.prototype.AdjustAndNormalizeVector=function(e,t){if(e.length){switch(this.m_init.queryFeatureWeightingStyle){case 0:break;case 1:for(var n=0;n<t.length;++n)t[n]=1+Math.log(t[n]);break;case 2:var r=In.max(t);for(n=0;n<t.length;++n)t[n]=.5+t[n]/r*.5;break;case 3:for(n=0;n<t.length;++n)t[n]=1;break;default:throw Error.notImplemented()}if(this.m_init.internalFeatureId2InverseClassFrequency)for(n=0;n<t.length;++n)t[n]*=this.m_init.internalFeatureId2InverseClassFrequency.get_item(e[n]);var i=In.norm(t);for(n=0;n<t.length;++n)t[n]/=i}},e}();(0,o.l)(Cn,"d7d20c82$TfIdfRankerNLModule",null,[Xt]);var Tn=function(){function e(t,n){if(this.$$pf_Count=0,this.m_bitWidth=0,this.m_byteArray=null,this.m_offset=0,!t)throw Error.argumentNull("byteArray");if(this.m_offset=n,t.readInt(this.m_offset+0,4)!==e.c_MAGIC_NUMBER)throw Error.argument("byteArray","Input does not represent a compact int array");this.set_count(t.readInt(this.m_offset+4,4)),this.m_bitWidth=t.readInt(this.m_offset+8,4),this.m_byteArray=t}return e.prototype.get_item=function(t){if(t<0||t>=this.get_count())throw Error.argumentOutOfRange("index");return this.m_byteArray.readVarWidthInt(8*this.m_offset+e.c_iFirstItemBitOffset+t*this.m_bitWidth,this.m_bitWidth)},e.prototype.get_count=function(){return this.$$pf_Count},e.prototype.set_count=function(e){return this.$$pf_Count=e,e},e.prototype.get_occupiedBytes=function(){return Math.ceil((e.c_iFirstItemBitOffset+this.get_count()*this.m_bitWidth)/8)},e.c_MAGIC_NUMBER=604662927,e.c_iFirstItemBitOffset=96,e}();(0,o.l)(Tn,"2c091733$CompactIntArray",null,[Ht.y.$$(Number)]);var bn=function(){function e(){}return e.GetListOfFloats=function(t,n){for(var r=new Array(n),i=0;i<r.length;i++)r[i]=e.convertIntToFloat(t.readInt32());return r},e.convertIntToFloat=function(t){var n=1==(t>>e.K-1&1)?-1:1,r=t&(1<<e.T)-1,i=t>>23&(1<<e.W)-1;return i+1===1<<e.W?r?Number.NaN:1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:i?e.NormalFloat(n,r,i):e.SubnormalNumber(n,r)},e.SubnormalNumber=function(t,n){return t*e.ConvertToMantissa(n,0)*Math.pow(2,-(e.EMax-1))},e.NormalFloat=function(t,n,r){var i=r-e.EMax;return t*e.ConvertToMantissa(n,1)*Math.pow(2,i)},e.ConvertToMantissa=function(t,n){for(var r=0,i=0;i<e.T;i++)r+=(t>>e.T-1-i&1)/Math.pow(2,i+1);return n+r},e.EMax=127,e.W=8,e.T=23,e.K=32,e}();(0,o.l)(bn,"e74016e$FloatConverter",null,[]);var An=function(){function e(e,t){this.annotations=null,this.attr_NLMod_BooleanFeatures=0,this.attr_NLMod_BooleanFeatureIDs=0,this.attr_NLMod_FloatingPointFeatureNames=0,this.attr_NLMod_FloatingPointFeatureValues=0,this.attr_NLMod_FloatingPointFeatureIDs=0,this.attr_NLMod_FloatingPointFeatureIDValues=0,this.attr_Classification_Features=0,this.attr_Classification_Predictions=0,this.attr_Classification_PredictionString=0,this.attr_Classification_Probability=0,this.classNames=null,this.maxClassesToReturn=0,this.queryFeatureWeightingStyle=0,this.dynamicFeature2InternalFeatureId=null,this.minRecognizedStaticFeatureId=0,this.maxRecognizedStaticFeatureId=0,this.nonDirectStaticFeatureId2InternalFeatureIdMapping=null,this.numOfInternalFeatures=0,this.internalFeatureId2InverseClassFrequency=null,this.internalFeatureId2FirstClassScorePairIndex=null,this.internalFeatureId2NumOfClassScorePairs=null,this.numOfClassScorePairs=0,this.classScorePair2ClassId=null,this.classScorePair2Score=null,this.annotations=t.get_annotations();var n=0;this.attr_NLMod_BooleanFeatures=e.get_item(n),++n,this.attr_NLMod_BooleanFeatureIDs=e.get_item(n),++n,this.attr_NLMod_FloatingPointFeatureNames=e.get_item(n),++n,this.attr_NLMod_FloatingPointFeatureValues=e.get_item(n),++n,this.attr_NLMod_FloatingPointFeatureIDs=e.get_item(n),++n,this.attr_NLMod_FloatingPointFeatureIDValues=e.get_item(n),++n,this.attr_Classification_Features=e.get_item(n),++n,this.attr_Classification_Predictions=e.get_item(n),++n,this.attr_Classification_PredictionString=e.get_item(n),++n,this.attr_Classification_Probability=e.get_item(n),++n;var r=e.get_item(n);++n;for(var i=new Array(r),o=0;o<r;++o)i[o]=t.getString(e.get_item(n)),++n;this.classNames=se.i.$$(String).createReadOnlyList(i),this.maxClassesToReturn=e.get_item(n),++n,this.queryFeatureWeightingStyle=e.get_item(n),++n;var a=e.get_item(n);++n,this.dynamicFeature2InternalFeatureId={};for(o=0;o<a;++o){var s=t.getString(e.get_item(n));++n;var l=e.get_item(n);++n,this.dynamicFeature2InternalFeatureId[s]=l}this.minRecognizedStaticFeatureId=e.get_item(n),++n,this.maxRecognizedStaticFeatureId=e.get_item(n),++n;var u=e.get_item(n);if(++n,u>0){var c=t.getByteArray(e.get_item(n));++n,this.nonDirectStaticFeatureId2InternalFeatureIdMapping=this.ParseCompactIntArray(new Bt(c))}++n;var d=t.getByteArray(e.get_item(n));++n,this.ParseModel(d)}return e.prototype.ParseCompactIntArray=function(e){return new Tn(e.get_array(),e.get_offset())},e.prototype.ParseModel=function(e){try{var t=new Bt(e);this.numOfInternalFeatures=t.readInt32(),1===t.readInt32()?this.internalFeatureId2InverseClassFrequency=se.i.$$(Number).createReadOnlyList(bn.GetListOfFloats(t,this.numOfInternalFeatures)):this.internalFeatureId2InverseClassFrequency=null;var n=t.readInt32();this.internalFeatureId2FirstClassScorePairIndex=this.ParseCompactIntArray(t),t.set_offset(t.get_offset()+n);var r=t.readInt32();this.internalFeatureId2NumOfClassScorePairs=this.ParseCompactIntArray(t),t.set_offset(t.get_offset()+r),this.numOfClassScorePairs=t.readInt32();var i=t.readInt32();this.classScorePair2ClassId=this.ParseCompactIntArray(t),t.set_offset(t.get_offset()+i),this.classScorePair2Score=se.i.$$(Number).createReadOnlyList(bn.GetListOfFloats(t,this.numOfClassScorePairs))}catch(e){throw Error.argument("byteReader")}},e}();(0,o.l)(An,"a57e1678$TfIdfRankerNLModuleInit",null,[]);var Mn=function(){return function(e,t,n,r){this.parentText=null,this.firstCharAfterRangeToTokenize=0,this.tokens=null,this.currentTokenStartIndex=0,this.sentSepCurrentSentenceStart=0,this.sentSepCurrentSentenceLength=0,this.parentText=e,this.firstCharAfterRangeToTokenize=n,this.tokens=r,this.currentTokenStartIndex=t,this.sentSepCurrentSentenceStart=-1,this.sentSepCurrentSentenceLength=0}}();(0,o.l)(Mn,"6f556c2a$TokenizerData",null,[]);var Pn=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e){if(!e)throw Error.argumentNull("input");var t,n,r;if(!e.tryGetAnnotation_Cast(String,this.m_init.attr_NLMod_ParentText,(0,m.m)((function(){return t}),(function(e){return t=e}))))throw Error.argument("input","Expected to see annotation for attribute NLMod.ParentText");if(e.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_StartIndex,(0,m.m)((function(){return n}),(function(e){return n=e})))||(n=0),e.tryGetAnnotation_Cast(Number,this.m_init.attr_Span_Length,(0,m.m)((function(){return r}),(function(e){return r=e})))||(r=t.length-n),n<0||n>t.length)throw Error.argument("input","Start index out of range");if(r<0||r>t.length)throw Error.argument("input","Length out of range");if(n+r>t.length)throw Error.argument("input","Bad start-length range");var i=new Mn(t,n,n+r,new de.e(this.m_init.annotations,y.Annotations.typeiD_FeatureBundle));this.Tokenize(i);var o=e.get_isReadOnly()?e.clone():e;return o.setAnnotation(this.m_init.attr_NLMod_Tokens,i.tokens),o},e.prototype.Tokenize=function(e){for(;e.currentTokenStartIndex<e.firstCharAfterRangeToTokenize;){if(this.m_init.greedyMatchTokenTrie){var t=this.m_init.greedyMatchTokenTrie.lookUpString(e.parentText,e.currentTokenStartIndex,e.firstCharAfterRangeToTokenize-e.currentTokenStartIndex,null);if(!t.succeeded&&t.nextShorterResult&&(t=t.nextShorterResult),t.succeeded){this.OnNewToken(e,t.length,this.m_init.greedyMatchTokenTag),e.currentTokenStartIndex+=t.length;continue}}for(var n=e.parentText.substr(e.currentTokenStartIndex),r=-1,i=-1,o=-1,a=0;a<this.m_init.rulePatterns.length;++a){var s=this.m_init.rulePatterns[a].exec(n);s&&s[1].length>0&&(r<0||s[0].length>i)&&(r=a,i=s[0].length,o=s[1].length)}r>=0?(this.OnNewToken(e,o,this.m_init.ruleTags[r]),e.currentTokenStartIndex+=o):e.currentTokenStartIndex+=1}},e.prototype.OnNewToken=function(t,n,r){if(this.m_init.isSentenceSeparator){if(r===e.c_tokenName_GAP)return;if(t.sentSepCurrentSentenceStart<0&&(t.sentSepCurrentSentenceStart=t.currentTokenStartIndex),t.sentSepCurrentSentenceLength=t.currentTokenStartIndex+n-t.sentSepCurrentSentenceStart,r===e.c_tokenName_EOS_CHUNK){if(t.sentSepCurrentSentenceStart>=0&&t.sentSepCurrentSentenceLength>0)(i=new v.d(this.m_init.annotations)).setAnnotation(this.m_init.attr_Span_StartIndex,t.sentSepCurrentSentenceStart),i.setAnnotation(this.m_init.attr_Span_Length,t.sentSepCurrentSentenceLength),i.setAnnotation(this.m_init.attr_Tokenization_TokenName,e.c_tokenName_SENTENCE),i.setAnnotation(this.m_init.attr_NLMod_ParentText,t.parentText),Array.add(t.tokens.get_items(),i);t.sentSepCurrentSentenceStart=-1,t.sentSepCurrentSentenceLength=0}}else{var i;(i=new v.d(this.m_init.annotations)).setAnnotation(this.m_init.attr_Span_StartIndex,t.currentTokenStartIndex),i.setAnnotation(this.m_init.attr_Span_Length,n),i.setAnnotation(this.m_init.attr_Tokenization_TokenName,r),Array.add(t.tokens.get_items(),i)}},e.c_tokenName_GAP="GAP",e.c_tokenName_EOS_CHUNK="EOS_CHUNK",e.c_tokenName_SENTENCE="SENTENCE",e}();(0,o.l)(Pn,"8b7dafc5$TokenizerNLModule",null,[Xt]);var Fn=function(){return function(e,t){if(this.annotations=null,this.attr_NLMod_ParentText=0,this.attr_NLMod_Tokens=0,this.attr_Tokenization_TokenName=0,this.attr_Span_StartIndex=0,this.attr_Span_Length=0,this.isSentenceSeparator=!1,this.greedyMatchTokenTrie=null,this.greedyMatchTokenTag=null,this.rulePatterns=null,this.ruleTags=null,e){this.annotations=t.get_annotations();var n=0;try{this.attr_NLMod_ParentText=e.get_item(n),++n,this.attr_NLMod_Tokens=e.get_item(n),++n,this.attr_Tokenization_TokenName=e.get_item(n),++n,this.attr_Span_StartIndex=e.get_item(n),++n,this.attr_Span_Length=e.get_item(n),++n,this.isSentenceSeparator=1===e.get_item(n),++n;var r=e.get_item(n);++n,r>0&&(this.greedyMatchTokenTrie=t.getModule(r).get_filterTrie()),this.greedyMatchTokenTag=e.get_item(n)?t.getString(e.get_item(n)):"",++n;var i=e.get_item(n);++n,this.rulePatterns=new Array(i),this.ruleTags=new Array(i);for(var o=0;o<i;++o)this.rulePatterns[o]=new RegExp(t.getString(e.get_item(n))),++n,this.ruleTags[o]=t.getString(e.get_item(n)),++n}catch(e){throw Error.argument("initData")}}}}();(0,o.l)(Fn,"db47b0bf$TokenizerNLModuleInit",null,[]);var wn=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.execute=function(e){if(!e)throw Error.argumentNull("input");var t;if(!e.tryGetAnnotation_Cast(String,this.m_init.attr_NLMod_StringToTransliterate,(0,m.m)((function(){return t}),(function(e){return t=e}))))throw Error.argument("Expected input parameter NLMod.StringToTransliterate not found");for(var n=0,r=this.m_init.stages;n<r.length;n++){var i=r[n];t=i.apply(t)}var o=y.Annotations.CloneIfReadOnly(e);return o.setAnnotation(this.m_init.attr_NLMod_TransliteratedString,t),o},e.ApplyTransformation=function(e,t){for(var n=new Sys.StringBuilder,r=0;r<e.length;++r)n.append(t(e.substr(r,1)));return n.toString()},e}();(0,o.l)(wn,"8731fce$TransliteratorNLModule",null,[Xt]);var Rn=(0,o.y)("ae996b4e$ITransliterationStage"),En=function(){function e(e){this.style=0,e&&(this.style=e.get_item(0))}return e.prototype.apply=function(t){var n=this;return wn.ApplyTransformation(t,(function(t){return e.ChangeCharCase(t,n.style)}))},e.ChangeCharCase=function(e,t){switch(t){case 0:return e.toLowerCase();case 1:return"I"===e?"\u0131":e.toLowerCase();case 2:return e.toUpperCase();case 3:return"i"===e?"\u0130":e.toUpperCase();default:throw Error.invalidOperation()}},e.c_flavor=0,e}();(0,o.l)(En,"7d6985f5$ChangeCaseTransliterationStage",null,[Rn]);var kn=function(){function e(){}return e.prototype.apply=function(t){return wn.ApplyTransformation(t,e.TransformChar)},e.TransformChar=function(e){var t=e.charCodeAt(0);return t>=65281&&t<=65374?String.fromCharCode(t-65248):e},e.c_flavor=4,e}();(0,o.l)(kn,"de14e0b2$LatinFullWidthToHalfWidthTransliterationStage",null,[Rn]);var Dn=function(){function e(e,t){this.regex=null,this.replacement=null,e&&(this.regex=t.getRegex(e.get_item(0)),this.replacement=t.getString(e.get_item(1)))}return e.prototype.apply=function(e){return e.replace(this.regex,this.replacement)},e.c_flavor=1,e}();(0,o.l)(Dn,"45c99c26$RegexReplaceTransliterationStage",null,[Rn]);var On=function(){function e(e,t){if(this.substitutions=null,e){var n=e.get_item(0),r=t.getString(e.get_item(1)),i=new Tn(t.getByteArray(e.get_item(2)),0),o=e.get_item(3)<0?null:new Tn(t.getByteArray(e.get_item(3)),0);this.substitutions={};for(var a=0;a<n;++a)this.substitutions[r.charAt(a).toString()]=r.substr(i.get_item(a),o?o.get_item(a):1)}}return e.prototype.apply=function(e){var t=this;return wn.ApplyTransformation(e,(function(e){return e in t.substitutions?t.substitutions[e]:e}))},e.c_flavor=2,e}();(0,o.l)(On,"81ed4da1$SingleCharSubstitutionsTransliterationStage",null,[Rn]);var Un=function(){function e(e,t){if(this.annotations=null,this.attr_NLMod_StringToTransliterate=0,this.attr_NLMod_TransliteratedString=0,this.stages=null,e){this.annotations=t.get_annotations();var n=0;try{this.attr_NLMod_StringToTransliterate=e.get_item(n),++n,this.attr_NLMod_TransliteratedString=e.get_item(n),++n;var r=e.get_item(n);++n,this.stages=new Array(r);for(var i=0;i<r;++i){var o=e.get_item(n);++n;var a=e.get_item(n);++n;var s=new se.i(Number);s.fromReadOnlyList(e,n,a),n+=a,this.stages[i]=this.ParseStage(o,s,t)}}catch(e){throw Error.argument("initData")}}}return e.prototype.ParseStage=function(e,t,n){switch(e){case En.c_flavor:return new En(t);case Dn.c_flavor:return new Dn(t,n);case On.c_flavor:return new On(t,n);case kn.c_flavor:return new kn;default:throw Error.invalidOperation("Unrecognized or unsupported transliteration stage flavor")}},e}();(0,o.l)(Un,"a28c0434$TransliteratorNLModuleInit",null,[]);var xn=function(){function e(){}return e.prototype.getNLModule=function(e,t){var n=e.get_item(0),r=new se.i(Number);switch(r.fromReadOnlyList(e,1,e.get_count()-1),n){case 0:return new vn(new Sn(r,t));case 2:return new Pn(new Fn(r,t));case 3:return new hn(new yn(r,t));case 5:return new on(new an(r,t));case 9:return new wn(new Un(r,t));case 10:return new Cn(new An(r,t));default:throw Error.notImplemented()}},e}();(0,o.l)(xn,"5ab31bce$NLModuleFactory",null,[Jt]);var Ln=function(){function e(e){if(this.m_objectFetcher=null,this.m_module=null,this.m_attr_Text_Text=0,this.m_attr_Classification_Predictions=0,this.m_attr_Classification_PredictionString=0,this.m_attr_Classification_Probability=0,this.m_attr_NLMod_Tokens=0,this.c_stringDelimiter=";",this.c_fieldNameDelimiter=":",!e)throw Error.argumentNull("resource");if(this.m_objectFetcher=new qt(e,new le,new xn),this.m_module=this.m_objectFetcher.getModuleByName(""),this.m_attr_Text_Text=this.m_objectFetcher.get_annotations().getAttributeByName("Text.Text"),this.m_attr_Classification_Predictions=this.m_objectFetcher.get_annotations().getAttributeByName("Classification.Predictions"),this.m_attr_Classification_PredictionString=this.m_objectFetcher.get_annotations().getAttributeByName("Classification.PredictionString"),this.m_attr_Classification_Probability=this.m_objectFetcher.get_annotations().getAttributeByName("Classification.Probability"),this.m_attr_NLMod_Tokens=this.m_objectFetcher.get_annotations().getAttributeByName("NLMod.Tokens"),this.m_attr_Text_Text<0||this.m_attr_Classification_Predictions<0||this.m_attr_Classification_PredictionString<0||this.m_attr_Classification_Probability<0)throw Error.argument("resourceObj","Resource does not represent a ranker")}return e.prototype.getBestClasses=function(e){var t=[];return this.ExecuteAndProcessResults(e,this.GetBestClassesCallback(t),null),t},e.prototype.getBestClassesWithPredictionData=function(e){var t=[];return this.ExecuteAndProcessResults(e,this.GetBestClassesWithDataCallback(t),null),t},e.prototype.getBestClassesWithPredictionDataAndTokenAttributes=function(e,t){var n=this,r=[],i=[];return this.ExecuteAndProcessResults(e,this.GetBestClassesWithDataCallback(r),(function(e,r){var o=n.m_objectFetcher.get_annotations().getAttributeName(e),a=[],s=[];if(!t||!t.length||-1!==Array.indexOf(t,o)){var l=n.m_objectFetcher.get_annotations().getAttributeType(e);n.PopulateTokenAttributesArrays(l,r,a,s);var u=new Zt(o,a,s);Array.add(i,u)}})),new Kt(r,i)},e.prototype.getBestClassesWithTokenAttributes=function(e,t){var n=this,r=[],i=[];return this.ExecuteAndProcessResults(e,this.GetBestClassesCallback(r),(function(e,r){var o=n.m_objectFetcher.get_annotations().getAttributeName(e),a=[],s=[];if(!t||!t.length||-1!==Array.indexOf(t,o)){var l=n.m_objectFetcher.get_annotations().getAttributeType(e);n.PopulateTokenAttributesArrays(l,r,a,s);var u=new Zt(o,a,s);Array.add(i,u)}})),new _(r,i)},e.prototype.getBestClassesWithScores=function(e){var t=this,n=[];return this.ExecuteAndProcessResults(e,(function(e){var r,i;e.tryGetAnnotation_Cast(String,t.m_attr_Classification_PredictionString,(0,m.m)((function(){return r}),(function(e){return r=e})))&&(e.tryGetAnnotation_Cast(Number,t.m_attr_Classification_Probability,(0,m.m)((function(){return i}),(function(e){return i=e})))&&Array.add(n,new Qt(r,i)))}),null),n},e.prototype.ExecuteAndProcessResults=function(e,t,n){var r=new v.d(this.m_objectFetcher.get_annotations());r.setAnnotation(this.m_attr_Text_Text,e);var i,o,a=this.m_module.execute(r);if(a.tryGetAnnotation_Cast(f.z,this.m_attr_Classification_Predictions,(0,m.m)((function(){return i}),(function(e){return i=e}))))for(var s=0,l=i.get_items();s<l.length;s++){t(l[s])}if(n&&a.tryGetAnnotation_Cast(f.z,this.m_attr_NLMod_Tokens,(0,m.m)((function(){return o}),(function(e){return o=e}))))for(var u=0,c=o.get_items();u<c.length;u++){c[u].forEachAnnotation(n)}},e.prototype.PopulateTokenAttributesArrays=function(e,t,n,r){if(y.Annotations.typeIDIsListType(e))for(var i=t,o=0,a=i.get_items();o<a.length;o++){var s=a[o];this.PopulateTokenAttributesArrays(i.get_memberTypeID(),s,n,r)}else if(y.Annotations.typeIDIsStructType(e))for(var l=t,u=this.m_objectFetcher.get_annotations().getNumOfStructFields(e),c=0;c<u;c++)Array.add(n,this.m_objectFetcher.get_annotations().getStructFieldName(e,c)),Array.add(r,this.m_objectFetcher.get_annotations().valueToString(this.m_objectFetcher.get_annotations().getStructFieldType(e,c),l.getFieldValue(c)));else Array.add(n,"VALUE"),Array.add(r,this.m_objectFetcher.get_annotations().valueToString(e,t))},e.prototype.GetBestClassesCallback=function(e){var t=this;return function(n){var r;n.tryGetAnnotation_Cast(String,t.m_attr_Classification_PredictionString,(0,m.m)((function(){return r}),(function(e){return r=e})))&&Array.add(e,t.GetPredictionString(r))}},e.prototype.GetBestClassesWithDataCallback=function(e){var t=this;return function(n){var r;if(n.tryGetAnnotation_Cast(String,t.m_attr_Classification_PredictionString,(0,m.m)((function(){return r}),(function(e){return r=e})))){var i=[],o=[];t.GetAttributeDataFromPredictionString(r,i,o),Array.add(e,new zt(t.GetPredictionString(r),i,o))}}},e.prototype.GetPredictionString=function(e){var t=e.indexOf(this.c_stringDelimiter);return t<0?e:e.substring(0,t)},e.prototype.GetAttributeDataFromPredictionString=function(e,t,n){for(var r,i=e.split(this.c_stringDelimiter),o=1;o<i.length;o++)r=i[o].indexOf(this.c_fieldNameDelimiter),Array.add(t,r<0?"":i[o].substring(0,r)),Array.add(n,r<0?i[o]:i[o].substring(r+1,i[o].length))},e}();(0,o.l)(Ln,"7a7fc670$Ranker",null,[]);var Nn=function(){function e(e,t){this._lastQuery="",this._ranker=null,this._rankerLoadAttempted=!1,this._applicationData=null,this._addInCommandProvider=null,this._parameterizedCommandManager=null,this._attributesToInclude=["TellMe.TellMeParamCollection"],this._applicationData=e,this._parameterizedCommandManager=t,this._applicationData.get_appsForOfficeEnabled()&&(this._addInCommandProvider=this._applicationData.getAppsForOfficeResultsProvider())}return e.prototype.get_QueryRanker=function(){if(!this._ranker&&!this._rankerLoadAttempted){var e=null;try{e=window.TellMeModel}catch(e){g.ULS.sendTraceTag(9212881,1300,10,"Exception thrown when loading the model. Exception: {0}",e)}if(e){try{this._ranker=new Ln(e)}catch(e){g.ULS.sendTraceTag(6576133,1300,10,"Exception thrown when loading classifier. Exception: {0}",e)}this._rankerLoadAttempted=!0}else g.ULS.sendTraceTag(6576134,1300,15,"Classifier model not found")}return this._ranker},e.prototype.issueQuery=function(t,n,r){var i=new l.v;if(e.IsValidQuery(t)){this._applicationData.get_appsForOfficeEnabled()&&this._addInCommandProvider&&this._addInCommandProvider.initialize();var o,a,u,d=t?this._lastQuery=t.queryText:this._lastQuery;if(u=h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeHeroCommandsEnabled")?this.getPredictionsWithScore(d):[],h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeParameterizedQueriesEnabled")){var p=this.getPredictionsWithTokenAttributes(d);o=p.getPredictions(),a=p.getAllTokenAttributes()}else o=this.getPredictions(d),a=[];for(var g=new s.z(0),_=0,f=o;_<f.length;_++){var m=f[_],y=this.IsAppForOfficeCommand(m);if(this._applicationData.isValidControl(m)&&!y){for(var v=this._parameterizedCommandManager.getParameterValueForCommand(m,a),S=null,I=0,C=u;I<C.length;I++){var T=C[I];if(T.get_prediction()===m){S=T;break}}if(S&&1===S.get_score())if(this._applicationData.isControlEnabled(m)){var b=new c.b(m,2,v,null);g.addResult(b)}else{b=new c.b(m,1,v,null);g.addResult(b)}else{b=new c.b(m,1,v,null);g.addResult(b)}}else if(this._applicationData.get_appsForOfficeEnabled()&&y&&this._addInCommandProvider){var A=m.substr(21);this._addInCommandProvider.updateResultGroup(t,A,g)}if(g.get_results().length>=e.MaxResults)break}if(this._applicationData.get_appsForOfficeEnabled()&&this._addInCommandProvider&&this._addInCommandProvider.completeUpdate(g),h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeCommandHookIsEnabled")){var M=t.queryText;if(M.length>2&&";"===M.charAt(0)&&";"===M.charAt(M.length-1)){g=new s.z(11);for(var P=0,F=M.split(";");P<F.length;P++){var w=F[P];if(w.length>0){var R=w.split(":");if(1===R.length){b=new c.b(w,1,null,null);g.addResult(b)}else if(2===R.length){b=new c.b(R[0],1,R[1],null);g.addResult(b)}}}}}if(g.get_results().length>0&&g.set_displayName(CommonUIStrings.l_TellMeCommandProviderTitle),!g.get_results().length&&!this._applicationData.get_insightsIsEnabled()&&!this._applicationData.get_smartLookupIsEnabled()){var E=new c.b(t.queryText,5,null,null);g.addResult(E)}g.get_results().length>0&&i.addResultGroup(g),i.set_query(t),i.set_attributes(a),n.resultsUpdated(i)}},e.prototype.getPredictions=function(e){var t=[];if(this.get_QueryRanker())try{t=this.get_QueryRanker().getBestClasses(e)}catch(e){g.ULS.sendTraceTag(6635971,1300,10,"Exception thrown by classifier. Exception: {0}",e)}return t},e.prototype.getPredictionsWithScore=function(e){var t=[];if(this.get_QueryRanker())try{t=this.get_QueryRanker().getBestClassesWithScores(e)}catch(e){g.ULS.sendTraceTag(20021785,1300,10,"Exception thrown by classifier with score. Exception: {0}",e)}return t},e.prototype.getPredictionsWithTokenAttributes=function(e){if(this.get_QueryRanker())try{return this.get_QueryRanker().getBestClassesWithTokenAttributes(e,this._attributesToInclude)}catch(e){g.ULS.sendTraceTag(17162523,1300,10,"Exception thrown by classifier with token attributes. Exception: {0}",e)}return new _([],[])},e.prototype.IsAppForOfficeCommand=function(e){return e.startsWith("btnTellMeOfficeAddIn")},e.IsValidQuery=function(e){return!!e&&!!e.queryText&&""!==e.queryText.trim()},e.MaxResults=5,e}();(0,o.l)(Nn,"65dd7f41$CommandResultsProvider",null,[r.m]);var Bn=n(5083),Hn=function(){function e(e){this._findInDocumentCommandId=null,this._findInDocumentCommandId=e}return e.prototype.issueQuery=function(t,n,r){if(e.IsValidQuery(t)&&this._findInDocumentCommandId){if(r){var i=String.format(CommonUIStrings.l_FindInDocumentText,t.queryText),o=d.l.xmlEncode(t.queryText),a=new Array(0);a.push(appChrome.actions.setControlLabel(this._findInDocumentCommandId,i)),a.push(appChrome.actions.setButtonCommandValueId(this._findInDocumentCommandId,o)),appChrome.api.dispatch(a)}var u=new c.b(this._findInDocumentCommandId,7,t.queryText,null),p=new s.z(2);p.set_displayName(CommonUIStrings.l_TellMeFindInDocProviderTitle),p.addResult(u);var g=new l.v;g.addResultGroup(p),g.set_query(t),n.resultsUpdated(g)}},e.IsValidQuery=function(e){return!!e&&!!e.queryText&&""!==e.queryText.trim()},e}();(0,o.l)(Hn,"db40234b$FindInDocumentResultsProvider",null,[r.m]);var $n=n(3803),Gn=function(){function e(){}return e.prototype.issueQuery=function(t,n,r){if(e.IsValidQuery(t)){var i,o=new s.z(1);if(r){var a=String.format(CommonUIStrings.l_InsightsButtonText,t.queryText),u=void 0;u=h.AFrameworkApplication.smartLookupIsEnabled?$n.q.createSerializedSmartLookupApplicationInterface(t.queryText,null,1):$n.q.createSerializedInsightsParameters(t.queryText);var d=new Array(0);d.push(appChrome.actions.setControlLabel(e.InsightsSimplifiedCommandId,a)),d.push(appChrome.actions.setButtonCommandValueId(e.InsightsSimplifiedCommandId,u)),appChrome.api.dispatch(d),i=new c.b(e.InsightsSimplifiedCommandId,4,null,null)}else i=new c.b(t.queryText,4,null,null);o.addResult(i);var p=new l.v;p.addResultGroup(o),p.set_query(t),n.resultsUpdated(p)}},e.IsValidQuery=function(e){return!!e&&!!e.queryText&&""!==e.queryText.trim()},e.InsightsSimplifiedCommandId="SmartLookupFromTellMe",e}();(0,o.l)(Gn,"7252f493$InsightsResultsProvider",null,[r.m]);var Wn=n(4574),Vn=function(){function e(){this.$$pf_Query=null,this.$$pf_ResultGroups=null,this.$$pf_Attributes=null,this.set_resultGroups([])}return e.prototype.get_query=function(){return this.$$pf_Query},e.prototype.set_query=function(e){return this.$$pf_Query=e,e},e.prototype.get_resultGroups=function(){return this.$$pf_ResultGroups},e.prototype.set_resultGroups=function(e){return this.$$pf_ResultGroups=e,e},e.prototype.get_attributes=function(){return this.$$pf_Attributes},e.prototype.set_attributes=function(e){return this.$$pf_Attributes=e,e},e.prototype.addResultGroup=function(e){for(var t=!1,n=0;n<this.get_resultGroups().length;n++)if(11!==this.get_resultGroups()[n].getGroupType()&&this.get_resultGroups()[n].getGroupType()===e.getGroupType()){this.AddResultsToGroup(this.get_resultGroups()[n],e),t=!0;break}t||this.get_resultGroups().push(e)},e.prototype.AddResultsToGroup=function(e,t){for(var n=0;n<t.get_results().length;n++)e.addResult(t.get_results()[n])},e}();(0,o.l)(Vn,"124a4538$CombineResultsUpdatedEventArgs",null,[Wn.e]);var jn=function(){function e(e){this._resultsAreDirty=!1,this._pauseCallbacks=!1,this._callback=null,this._resultsPerProvider=null,this._callback=e,this._resultsPerProvider=[]}return e.prototype.setResultUpdatedEventArgs=function(e,t){this._resultsPerProvider[e]=t,this._pauseCallbacks?this._resultsAreDirty=!0:this.InvokeCallback()},e.prototype.PauseCallbacks=function(){this._pauseCallbacks=!0},e.prototype.UnpauseCallbacks=function(){this._pauseCallbacks=!1,this._resultsAreDirty&&this.InvokeCallback()},e.prototype.InvokeCallback=function(){for(var e=new Vn,t=0,n=this._resultsPerProvider;t<n.length;t++){var r=n[t];if(r&&(e.set_query(r.get_query()),r.get_attributes()&&r.get_attributes().length>0&&e.set_attributes(r.get_attributes()),r&&r.get_resultGroups()))for(var i=0,o=r.get_resultGroups();i<o.length;i++){var a=o[i];e.addResultGroup(a)}}this._callback.resultsUpdated(e)},e}();(0,o.l)(jn,"936ddf1e$ResultsAggregator",null,[]);var qn=n(8005),zn=n(6720),Kn=function(){function e(){this.invertedRank=0,this.logRank=0,this.logCount=0,this.timeExponentialDecay10Min=0,this.timeExponentialDecay2Min=0,this.timeExponentialDecay1Min=0}return e.prototype.addFeature=function(e,t){switch(e){case 1:this.invertedRank=t;break;case 3:this.logRank=t;break;case 2:this.logCount=t;break;case 5:this.timeExponentialDecay10Min=t;break;case 4:this.timeExponentialDecay2Min=t;break;case 6:this.timeExponentialDecay1Min=t}},e}();(0,o.l)(Kn,"2d7f4823$CommandFeatures",null,[]);var Qn=function(){function e(e){this.modelId=null,this.featureIntercept=0,this.coefficientFeaturesMap=null,this.modelId=e,this.coefficientFeaturesMap={}}return e.prototype.get_modelId=function(){return this.modelId},e.prototype.get_featureIntercept=function(){return this.featureIntercept},e.prototype.get_coefficientFeaturesMap=function(){return this.coefficientFeaturesMap},e.prototype.addCoefficient=function(e,t,n){t?(this.get_coefficientFeaturesMap()[e]||(this.get_coefficientFeaturesMap()[e]=new Kn),this.get_coefficientFeaturesMap()[e].addFeature(t,n)):this.featureIntercept=n},e}();(0,o.l)(Qn,"dd5bfcea$CoefficientsModel",null,[]);var Zn=function(){function e(){}return e.GetOneMinuteHalfLife=function(){return 60*Math.LN10/Math.LN2},e.getInvertedRank=function(e){return e?1/e:0},e.getLogRank=function(e){return 2/Math.pow(2,e)},e.getLogCount=function(e){return 1+Math.log(e)/Math.LN2},e.getTimeExponentialDecay10Min=function(t){return e.getTimeExponentialDecay(10,t)},e.getTimeExponentialDecay2Min=function(t){return e.getTimeExponentialDecay(2,t)},e.getTimeExponentialDecay1Min=function(t){return e.getTimeExponentialDecay(1,t)},e.getTimeExponentialDecay=function(t,n){var r=t*e.GetOneMinuteHalfLife();return Math.pow(10,-n/r)},e.getProbability=function(e){return 1/(1+Math.exp(-e))},e}();(0,o.l)(Zn,"e9bdb763$CommandFeaturesUtility",null,[]);var Jn=function(){function e(e,t){this.rank=0,this.timeDiffInSeconds=0,this.count=0,this.features=null,this.rank=e,this.timeDiffInSeconds=t,this.count=1,this.features=new Kn,this.get_features().logCount=Zn.getLogCount(this.get_count()),this.get_features().invertedRank=Zn.getInvertedRank(e),this.get_features().logRank=Zn.getLogRank(e),this.get_features().timeExponentialDecay10Min=Zn.getTimeExponentialDecay10Min(t),this.get_features().timeExponentialDecay2Min=Zn.getTimeExponentialDecay2Min(t),this.get_features().timeExponentialDecay1Min=Zn.getTimeExponentialDecay1Min(t)}return e.prototype.get_rank=function(){return this.rank},e.prototype.get_timeDiffInSeconds=function(){return this.timeDiffInSeconds},e.prototype.get_count=function(){return this.count},e.prototype.get_features=function(){return this.features},e.prototype.incrementCount=function(){this.count=this.get_count()+1,this.get_features().logCount=Zn.getLogCount(this.get_count())},e.prototype.updateRank=function(e){var t=Zn.getInvertedRank(e),n=Zn.getLogRank(e);this.get_features().invertedRank=Math.max(this.get_features().invertedRank,t),this.get_features().logRank=Math.max(this.get_features().logRank,n)},e.prototype.updateTimeDiff=function(e){var t=Zn.getTimeExponentialDecay10Min(e),n=Zn.getTimeExponentialDecay2Min(e),r=Zn.getTimeExponentialDecay1Min(e);this.get_features().timeExponentialDecay10Min=Math.max(this.get_features().timeExponentialDecay10Min,t),this.get_features().timeExponentialDecay2Min=Math.max(this.get_features().timeExponentialDecay2Min,n),this.get_features().timeExponentialDecay1Min=Math.max(this.get_features().timeExponentialDecay1Min,r)},e}();(0,o.l)(Jn,"2159660b$CommandModel",null,[]);var Xn=function(){function e(e){this._coefficientsModelList=null,this._modelAdapter=null,this._modelDataLoaded=!1,e||g.ULS.sendTraceTag(36962767,1300,10,"PredictionEngine: IModelAdapter can't be null"),this._modelAdapter=e,this._modelDataLoaded=this.LoadModelData()}return e.prototype.LoadModelData=function(){var e=this._modelAdapter.getModelData(),t=this._modelAdapter.getModelIdMapping();if(isNullOrUndefined(e)||isNullOrUndefined(t))return!1;var n=Date.now();this._coefficientsModelList={};for(var r=0;r<e.length;r++){var i=e[r],o=t[i[0].toString()].trim(),a=i[1],s=a?t[i[2].toString()].trim():"",l=i[3];o in this._coefficientsModelList||(this._coefficientsModelList[o]=new Qn(o)),this._coefficientsModelList[o].addCoefficient(s,a,l)}return g.ULS.sendTraceTag(36962768,1300,50,"LoadModelData time taken: {0}(ms)",Date.now()-n),!0},e.prototype.GenerateInputFeatures=function(){var e=this._modelAdapter.getInputEvents(),t={};if(!e)return t;for(var n=1,r=0;r<e.length;r++){var i=e[r];i.id in t?(t[i.id].incrementCount(),t[i.id].updateRank(n),t[i.id].updateTimeDiff(i.timeElapsedSinceClick)):t[i.id]=new Jn(n,i.timeElapsedSinceClick),n++}return t},e.prototype.getPredictedCommands=function(){var e=new zn.c(qn.z);if(!this._modelDataLoaded&&(this._modelDataLoaded=this.LoadModelData(),!this._modelDataLoaded))return g.ULS.sendTraceTag(36962770,1300,10,"GetPredictedCommands: IModelAdapter returned no data"),e;var t=this.GenerateInputFeatures(),n=this._coefficientsModelList;for(var r in n){var i={key:r,value:n[r]}.value,o=i.get_modelId(),a=0;for(var s in t){var l={key:s,value:t[s]},u=l.value.get_features(),c=l.key in i.get_coefficientFeaturesMap()?i.get_coefficientFeaturesMap()[l.key]:null;if(c)a+=u.invertedRank*c.invertedRank+u.logRank*c.logRank+u.logCount*c.logCount+u.timeExponentialDecay10Min*c.timeExponentialDecay10Min+u.timeExponentialDecay2Min*c.timeExponentialDecay2Min+u.timeExponentialDecay1Min*c.timeExponentialDecay1Min}a+=i.get_featureIntercept(),e.add(new qn.z(o,a))}return e.Sc((function(e,t){return e.get_value()===t.get_value()?0:e.get_value()>t.get_value()?-1:1})),e},e}();(0,o.l)(Xn,"7785a758$PredictionEngine",null,[]);var Yn=function(){function e(e,t,n,r){this._applicationData=null,this._modelPredictor=null,this._maxResultsToShow=0,this._mruManager=null,this._applicationData=t,this._modelPredictor=new Xn(e),this._maxResultsToShow=n,this._mruManager=r}return e.prototype.issueQuery=function(t,n,r){if(!e.IsNonEmptyQuery(t)){var i=Date.now(),o=this._modelPredictor.getPredictedCommands(),a=new l.v,u=new s.z(6);u.set_displayName(CommonUIStrings.l_TellMeTryQueryTitle);for(var d=[],p=this._mruManager?this._mruManager.getControlIds():null,h=0,_=0;h<o.get_count()&&_<this._maxResultsToShow;h++){var f=o.get_item(h).get_key();if(!this._applicationData||this._applicationData.isValidControl(f)){if(p&&p.length>0&&Array.contains(p,f))continue;u.addResult(new c.b(f,1,null,null)),d.push(String.format('{{"Id":"{0}","Score":{1}}}',f,o.get_item(h).get_value())),_++}}g.ULS.sendTraceTag(36962759,1300,50,"[SuggestionResultsProvider] Predictions=[{0}] TimeSpent={1}",d.join(","),Date.now()-i),a.addResultGroup(u),a.set_query(t),n.resultsUpdated(a)}},e.IsNonEmptyQuery=function(e){return!!e&&!!e.queryText&&""!==e.queryText.trim()},e}();(0,o.l)(Yn,"309b096a$SuggestionResultsProvider",null,[r.m]);var er=(0,o.y)("4caeda12$IModelAdapter"),tr=function(){function e(e){this._commandEventsCache=null,this._commandEventsCache=e}return e.prototype.getInputEvents=function(){return this._commandEventsCache.getCommandClickedEvents()},e.prototype.getModelData=function(){return window.TellMeSuggestionModel},e.prototype.getModelIdMapping=function(){return window.CoefficientModelIdMap},e}();(0,o.l)(tr,"ea42dda$SuggestionsModelAdapter",null,[er]);var nr=function(){function e(){}return e.fetchToken="FetchToken",e.httpRequest="HttpRequest",e.apiCall="ApiCall",e.provider="Provider",e}();(0,o.l)(nr,"b2e5b363$LatencyTypes",null,[]);var rr=function(){function e(){}return e.tellMe="TellMe",e.loki="Loki",e.substrate="Substrate",e.findApi="FindApi",e}();(0,o.l)(rr,"8c09dfce$Services",null,[]);var ir=n(7499),or=n(8996),ar=n(9641),sr=function(){function e(){this._shouldShowAnswerAndDefinitionResults=!1,this._shouldShowEntityResults=!1,this._mostRecentQueryId=null,this._clientRequestManager=null,this.baseUrl=h.AFrameworkApplication.tellMeServiceEndpointForSearch,this._clientRequestManager=h.AFrameworkApplication.theClientRequestManager,this._shouldShowAnswerAndDefinitionResults=this.ShouldShowAnswerAndDefinitionSearchResults(),this._shouldShowEntityResults=this.ShouldShowEntitySearchResults()}return e.prototype.issueQuery=function(t,n,r){var i=this;if(e.IsValidQuery(t)&&(this._shouldShowAnswerAndDefinitionResults||this._shouldShowEntityResults)){var o={"Content-Type":"application/json",Accept:"application/json"};if(o["X-Office-Version"]=h.AFrameworkApplication.buildVersion,o["X-Office-Application"]=h.AFrameworkApplication.appSettingsManager.getStringAppSetting("Application"),o["X-Office-Platform"]="WAC",o["X-TellMe-SqmUserId"]=h.AFrameworkApplication.appSettingsManager.getStringAppSetting("ModernTranslatorLoggableUserId"),o["X-TellMe-SessionId"]=ir.p.get_instance().getTellMeSessionId(),o["X-TellMe-SuggestionTypes"]="Answer,Definition",o["X-TellMe-Culture"]=h.AFrameworkApplication.uiCulture,o["X-TellMe-ProcessSessionId"]=h.AFrameworkApplication.userSessionId,r){this._mostRecentQueryId=ar.l.create().toString();var a=this._mostRecentQueryId,s=window.performance.now();this._clientRequestManager.addRequest(this.baseUrl+t.queryText,2,null,o,!1,0,(function(e){i.OnSuccessCallBack(e,t,n,a,s)}),(function(e){i.OnFailureCallBack(e,t,a,s)}),null,null,!1,null,null,null,null,!1,null,!1)}}},e.prototype.OnSuccessCallBack=function(t,n,r,i,o){if(i===this._mostRecentQueryId){ir.p.get_instance().getInteractionLogger().onRequestComplete(n.queryText.length,e.AnswerSimplifiedCommandId,t.get_data().httpStatus.toString(),Math.round(window.performance.now()-o),rr.tellMe,!0,nr.httpRequest,null);var a=t.get_data().responseData,s=or.x.secureDeserialize(a);if(s.Groups){for(var u=s.Groups,c=new l.v,d=0,p=u;d<p.length;d++){var g=p[d];if("Answer"===g.GroupType){var _=void 0;_=h.AFrameworkApplication.smartLookupIsEnabled?$n.q.createSerializedSmartLookupApplicationInterface(n.queryText,null,1):$n.q.createSerializedInsightsParameters(n.queryText);for(var f=g.Suggestions,m=null,y=e.InitialPriority,v=0,S=f;v<S.length;v++){var I=S[v];if(this.IsValidAnswerResult(I)){var C=I.Type,T=this.GetPriority(C);if("Answer"===C&&this._shouldShowAnswerAndDefinitionResults){m=this.CreateResultBinding(C,I);break}T&&T<y&&(y=T,m=this.CreateResultBinding(C,I))}}if(m){var b=new Array(0);b.push(appChrome.actions.setControlLabel(m.value,m.parameterValue)),b.push(appChrome.actions.setCompoundButtonCommandValueId(m.value,_)),b.push(appChrome.actions.updateCompoundButtonDescription(m.value,m.description)),appChrome.api.dispatch(b);var A=this.CreateSimpleResultGroup(m.type);A.addResult(m),c.addResultGroup(A)}}}c.get_resultGroups().length>=1&&(c.set_query(n),r.resultsUpdated(c))}ir.p.get_instance().getInteractionLogger().onRequestComplete(n.queryText.length,e.AnswerSimplifiedCommandId,"",Math.round(window.performance.now()-o),"",!0,nr.provider,null)}},e.prototype.OnFailureCallBack=function(t,n,r,i){r===this._mostRecentQueryId&&ir.p.get_instance().getInteractionLogger().onRequestComplete(n.queryText.length,e.AnswerSimplifiedCommandId,t.get_data().httpStatus.toString(),Math.round(window.performance.now()-i),rr.tellMe,!1,nr.httpRequest,null)},e.prototype.GetPriority=function(t){switch(t){case"Entity":return this._shouldShowEntityResults?e.EntityPriority:0;case"Definition":return this._shouldShowAnswerAndDefinitionResults?e.DefinitionPriority:0;default:return 0}},e.prototype.CreateResultBinding=function(t,n){switch(t){case"Answer":return new c.b(e.AnswerSimplifiedCommandId,12,n.Title,n.Description);case"Entity":return new c.b(e.AnswerSimplifiedCommandId,14,n.Title,n.Description);case"Definition":return new c.b(e.AnswerSimplifiedCommandId,13,n.Title,n.Description);default:return null}},e.prototype.CreateSimpleResultGroup=function(e){switch(e){case 12:return new s.z(8);case 14:return new s.z(10);case 13:return new s.z(9);default:return null}},e.prototype.IsValidAnswerResult=function(e){return!!("Type"in e&&e.Type&&""!==e.Type&&"Description"in e&&e.Description&&""!==e.Description&&"Title"in e&&e.Title&&""!==e.Title)},e.prototype.ShouldShowAnswerAndDefinitionSearchResults=function(){return!!h.AFrameworkApplication.get_activeFrame()&&h.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_shouldShowAnswerAndDefinitionSearchResults()},e.prototype.ShouldShowEntitySearchResults=function(){return!!h.AFrameworkApplication.get_activeFrame()&&h.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_shouldShowEntitySearchResults()},e.IsValidQuery=function(e){return!!e&&!!e.queryText},e.AnswerSimplifiedCommandId="AnswerForSearch",e.AnswerPriority=1,e.EntityPriority=3,e.DefinitionPriority=5,e.InitialPriority=2147483647,e}();(0,o.l)(sr,"ac2d0a18$TellMeServiceProvider",null,[r.m]),n.d(t,{AggregatorResultsProvider:function(){return lr}});var lr=function(){function e(){this._providers=null,this._providers=[]}return e.prototype.issueQuery=function(e,t,n){var r=new jn(t);r.PauseCallbacks();for(var i=0;i<this._providers.length;++i){var o=new a(r,i);this._providers[i].issueQuery(e,o,n)}r.UnpauseCallbacks()},e.prototype.addProvider=function(e){this._providers.push(e)},e.CreateInstance=function(t,n,r){var i=!1,o=!(i=n.get_isSimplifiedReactRibbonUxEnabled()?h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeIsSuggestionsForSimplifiedUxEnabled"):h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeSuggestionsIsEnabled"))&&h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeFirstRunExperienceIsEnabled"),a=!i&&h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeTryQueriesIsEnabled"),s=new e;if(s.addProvider(new Bn.s(t,n.get_tryQueries(),o,a)),i){var l=h.AFrameworkApplication.appSettingsManager.getIntAppSetting("TellMeMaxRecommendedResultsToReturn",3);t.resetMaxSize(l),s.addProvider(new Yn(new tr(ir.p.get_instance()),n,l,t))}return s.addProvider(new Nn(n,r)),!n.get_findInDocumentIsEnabled()||"Word"===n.get_application()&&n.get_findInDocumentWithMatchesIsEnabled()||s.addProvider(new Hn(n.get_findInDocumentCommandString())),n.get_appsForOfficeEnabled()&&s.addProvider(new u(n)),n.get_assistanceIsEnabled()&&s.addProvider(new p),(n.get_insightsIsEnabled()||n.get_smartLookupIsEnabled())&&s.addProvider(new Gn),n.get_tellMeServiceResultsForSearchEnabled()&&h.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactSharedHeaderUxEnabled()&&s.addProvider(new sr),s},e}();(0,o.l)(lr,"786e62df$AggregatorResultsProvider",null,[r.m])},4105:function(e,t,n){"use strict";n.d(t,{x:function(){return r}});var r=(0,n(423).y)("b88bb981$IDocChatClientFactory")},4130:function(e,t,n){"use strict";n.r(t),n.d(t,{ATextMergeBlock:function(){return l}});var r=n(3545),i=n(1388),o=n(5479),a=n(1071),s=n(423),l=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return(0,r.t)(t,e),t.prototype.splitAtIndex=function(e,t){if(t.val=null,!this.get_text())return!1;if(!this.get_supportsSplitIntoMoreGranularBlocks())return!1;if(e<=0||e>=this.get_length())return!1;t.val=new o.o(i.AMergeBlock,null);var n=this.clone();n.set_text(a.f.SubString(this.get_text(),0,e));var r=this.clone();return r.set_text(a.f.SubString(this.get_text(),e,this.get_length()-e)),t.val.add(n),t.val.add(r),!0},t.prototype.isTextOrCharacterRun=function(){return!0},t.prototype.get_length=function(){return this.get_text().length},t}(i.AMergeBlock);(0,s.l)(l,"fd5167e9$ATextMergeBlock",i.AMergeBlock,[])},4211:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});var r=(0,n(423).y)("dec3705d$IComplexAnnotationObject")},4236:function(e,t,n){"use strict";n.r(t);var r=n(3545),i=n(5902),o=n(5479),a=n(1388),s=n(423),l=function(e){function t(t,n){return e.call(this,4,t,n)||this}return(0,r.t)(t,e),t.prototype.toString=function(){var t=e.prototype.toString.call(this);return String.format("{0} [GraphNodeId: {1}]",t,this.graphNodeId)},t.prototype.getBlockTypeString=function(){return"Table"},t.prototype.clone=function(){return new t(this.source,this.graphNodeId)},t.prototype.isEquivalentTo=function(t,n,r,i){return!!e.prototype.isEquivalentTo.call(this,t,n,r,i)&&this.graphNodeId.equals(t.graphNodeId)},t.prototype.get_length=function(){return 1},t}(a.AMergeBlock);(0,s.l)(l,"975d0ceb$TableMergeBlock",a.AMergeBlock,[]),n.d(t,{TableMergeBlockCreator:function(){return u}});var u=function(e){function t(t,n){var r=e.call(this)||this;return r._block=null,r._block=new l(n,t.get_id()),r}return(0,r.t)(t,e),t.prototype.GetMergeBlockList=function(e,t){e.val=new o.o(a.AMergeBlock,null),e.val.add(this._block),t.val=this.appendMergeBlock("",this._block.toString())},t}(i.b);(0,s.l)(u,"b4f6da37$TableMergeBlockCreator",i.b,[])},4304:function(e,t,n){"use strict";var r=n(3545),i=n(423),o=(0,i.y)("4cfc412c$IChatAvailabilityChangedEventArgs");n.d(t,{e:function(){return a}});var a=function(e){function t(t,n){var r=e.call(this)||this;return r.$$pf_IsAvailable=!1,r.$$pf_ChatThreadDisconnected=!1,r.set_isAvailable(t),r.set_chatThreadDisconnected(n),r}return(0,r.t)(t,e),t.prototype.get_isAvailable=function(){return this.$$pf_IsAvailable},t.prototype.set_isAvailable=function(e){return this.$$pf_IsAvailable=e,e},t.prototype.get_chatThreadDisconnected=function(){return this.$$pf_ChatThreadDisconnected},t.prototype.set_chatThreadDisconnected=function(e){return this.$$pf_ChatThreadDisconnected=e,e},t}(Sys.EventArgs);(0,i.l)(a,"40060a75$ChatAvailabilityChangedEventArgs",Sys.EventArgs,[o])},4424:function(e,t,n){"use strict";n.d(t,{p:function(){return r}});var r=(0,n(423).y)("39e5be2d$ISkydriveUploadCallerFactory")},4427:function(e,t,n){"use strict";var r=n(423),i=n(1326),o=n(4211),a=function(){return function(e,t){this.attrId=0,this.value=null,this.attrId=e,this.value=t}}();(0,r.l)(a,"4ca5a14$AttrValuePair",null,[]),n.d(t,{d:function(){return s}});var s=function(){function e(e){if(this.$$pf_IsReadOnly=!1,this.m_annotations=null,this.m_attrValuePairs=null,!e)throw Error.argumentNull("annotations");this.m_annotations=e,this.m_attrValuePairs=new Array(0)}return e.prototype.get_annotationsContext=function(){return this.m_annotations},e.prototype.get_isReadOnly=function(){return this.$$pf_IsReadOnly},e.prototype.set_isReadOnly=function(e){return this.$$pf_IsReadOnly=e,e},e.prototype.get_hasAnnotations=function(){return this.m_attrValuePairs.length>0},e.prototype.tryGetAnnotation_Cast=function(e,t,n){if(!this.m_annotations.isValidAttributeID(t))throw Error.argument("attributeID","Invalid attribute ID");for(var i=0,o=this.m_attrValuePairs;i<o.length;i++){var a=o[i];if(t===a.attrId)return n.val=a.value,!0}return n.val=r.c(e),!1},e.prototype.setAnnotation=function(e,t){if(this.get_isReadOnly())throw Error.invalidOperation("Attempt to set annotation on read-only FeatureBundle");if(!this.m_annotations.isValidAttributeID(e))throw Error.argument("attributeID","Invalid attribute ID");if(!this.m_annotations.isLegalValue(this.m_annotations.getAttributeType(e),t))throw Error.argument("value","Value is not of the correct type for the specified attribute");n(2093).Annotations.LockDownIfNecessary(t);for(var r=0;r<this.m_attrValuePairs.length;++r){var i=this.m_attrValuePairs[r];if(e===i.attrId)return void(i.value=t)}Array.add(this.m_attrValuePairs,new a(e,t))},e.prototype.removeAnnotation=function(e){if(this.get_isReadOnly())throw Error.invalidOperation("Attempt to remove annotation from read-only FeatureBundle");if(!this.m_annotations.isValidAttributeID(e))throw Error.argument("attributeID","Invalid attribute ID");for(var t=0;t<this.m_attrValuePairs.length;++t)if(e===this.m_attrValuePairs[t].attrId){Array.removeAt(this.m_attrValuePairs,t);break}},e.prototype.forEachAnnotation=function(e){if(!e)throw Error.argumentNull("action");for(var t=0,n=this.m_attrValuePairs;t<n.length;t++){var r=n[t];e(r.attrId,r.value)}},e.prototype.clone=function(){var t=new e(this.m_annotations);return t.copyAnnotationsFrom(this),t},e.prototype.copyAnnotationsFrom=function(e){var t=this;if(this.get_isReadOnly())throw Error.invalidOperation("Attempt to copy annotations onto read-only FeatureBundle");if(!e)throw Error.argumentNull("other");if(e.get_annotationsContext()!==this.m_annotations)throw Error.argument("other","Incompatible feature bundle");Array.clear(this.m_attrValuePairs),e.forEachAnnotation((function(e,n){t.setAnnotation(e,n)}))},e.prototype.valueToString=function(){for(var t="[",r=!0,i=0,o=this.m_attrValuePairs;i<o.length;i++){var a=o[i];r?r=!1:t+=", ",t+=this.m_annotations.getAttributeName(a.attrId),t+="=";var s=this.m_annotations.getAttributeType(a.attrId),l=this.m_annotations.valueToString(s,a.value);s===n(2093).Annotations.typeiD_String?(t+='"',t+=e.EscapeStringForValueToString(l),t+='"'):t+=l}return t+="]"},e.prototype.isEqual=function(e){var t=this;if(!e)throw Error.argumentNull("other");if(this===e)return!0;if(!e||this.m_annotations!==e.get_annotationsContext())return!1;if(this.get_hasAnnotations()!==e.get_hasAnnotations())return!1;var r=0,i=null,o=!1;if(e.forEachAnnotation((function(e,n){if(++r,!o){for(var a=-1,s=0,l=t.m_attrValuePairs.length;s<l;++s)if(t.m_attrValuePairs[s].attrId===e){a=s;break}a<0?o=!0:(i||(i=new Array(t.m_attrValuePairs.length)),i[a]=n)}})),this.m_attrValuePairs.length!==r||o)return!1;for(var a=0,s=this.m_attrValuePairs.length;a<s;++a)if(!n(2093).Annotations.ValuesAreEqual(this.m_annotations.getAttributeType(this.m_attrValuePairs[a].attrId),this.m_attrValuePairs[a].value,i[a]))return!1;return!0},e.prototype.cloneIfReadOnly=function(){return this.get_isReadOnly()?this.clone():this},e.prototype.lockDown=function(){if(!this.get_isReadOnly()){this.set_isReadOnly(!0);for(var e=0,t=this.m_attrValuePairs;e<t.length;e++){var r=t[e];n(2093).Annotations.LockDownIfNecessary(r.value)}}},e.prototype.toString=function(){return this.valueToString()},e.EscapeStringForValueToString=function(e){return e.replace("\\","\\\\").replace("[","\\[").replace("]","\\]").replace(",","\\,")},e}();(0,r.l)(s,"bfbd3ae6$FeatureBundle",null,[i.m,o.r])},4439:function(e,t,n){"use strict";var r=n(3996),i=n(423),o=function(){return function(){}}();(0,i.l)(o,"93e43773$SerializableAnchorDataV1",null,[]);var a=function(){return function(){}}();(0,i.l)(a,"f194a2b9$SerializableCpDataV1",null,[]);var s=n(8164);n.d(t,{x:function(){return l}});var l=function(){function e(){}return e.deserializeAnchorData=function(e){return new r.e(e.RK,e.PS,e.TS,n(8816).CpDataHelper.versionedDeserialize(e.OS),e.PE,e.TE,n(8816).CpDataHelper.versionedDeserialize(e.OE),e.DK,e.SI)},e.serializeAnchorData=function(t){var n=new o;return n.RK=t.rangeKind,n.PS=t.paraIdStart,n.TS=t.textIdStart,n.DK=t.documentKind,n.SI=t.shapeId,t.offsetStart&&(n.OS=e.serializeCpData(t.offsetStart)),t.paraIdEnd&&(n.PE=t.paraIdEnd),t.textIdEnd&&(n.TE=t.textIdEnd),t.offsetEnd&&(n.OE=e.serializeCpData(t.offsetEnd)),n},e.deserializeCpData=function(e){if(!e)return null;var t=new s.w(e.CP);return t.fieldBegins=null!=e.FB?e.FB:0,t.fieldEnds=null!=e.FE?e.FE:0,t.commentBegins=null!=e.CB?e.CB:0,t.commentEnds=null!=e.CE?e.CE:0,t.hyperlinkBegins=null!=e.HB?e.HB:0,t.hyperlinkEnds=null!=e.HE?e.HE:0,t.rubies=null!=e.R?e.R:0,t.equations=null!=e.E?e.E:0,t.textWrappingBreaks=null!=e.TW?e.TW:0,t.pageBreaks=null!=e.PB?e.PB:0,t.symbols=null!=e.SYM?e.SYM:0,t.inlineE2os=null!=e.IE?e.IE:0,t.oleObjects=null!=e.OO?e.OO:0,t.activeXs=null!=e.AX?e.AX:0,t.contentControlIndicator=null!=e.CCI?e.CCI:0,t},e.serializeCpData=function(e){if(!e)return null;var t=new a;return t.CP=e.cp,t.VS=1,e.fieldBegins>0&&(t.FB=e.fieldBegins),e.fieldEnds>0&&(t.FE=e.fieldEnds),e.commentBegins>0&&(t.CB=e.commentBegins),e.commentEnds>0&&(t.CE=e.commentEnds),e.hyperlinkBegins>0&&(t.HB=e.hyperlinkBegins),e.hyperlinkEnds>0&&(t.HE=e.hyperlinkEnds),e.rubies>0&&(t.R=e.rubies),e.equations>0&&(t.E=e.equations),e.textWrappingBreaks>0&&(t.TW=e.textWrappingBreaks),e.pageBreaks>0&&(t.PB=e.pageBreaks),e.symbols>0&&(t.SYM=e.symbols),e.inlineE2os>0&&(t.IE=e.inlineE2os),e.oleObjects>0&&(t.OO=e.oleObjects),e.activeXs>0&&(t.AX=e.activeXs),e.contentControlIndicator>0&&(t.CCI=e.contentControlIndicator),t},e}();(0,i.l)(l,"2c5f19d0$SerializableProtocolDataV1Methods",null,[])},4541:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var r=n(3545),i=n(423),o=function(e){function t(t,n,r){var i=e.call(this)||this;return i.updatedClients=null,i.disconnectedClients=null,i._aggregator=null,i.updatedClients=t,i.disconnectedClients=n,i._aggregator=r,i}return(0,r.t)(t,e),t.prototype.get_updatedClients=function(){return this.updatedClients},t.prototype.get_disconnectedClients=function(){return this.disconnectedClients},t.prototype.trackDurationInMilliseconds=function(e,t){this._aggregator&&this._aggregator.track(t,e)},t}(Sys.EventArgs);(0,i.l)(o,"6f4a8d44$PresenceUpdatedEventArgs",Sys.EventArgs,[])},4574:function(e,t,n){"use strict";n.d(t,{e:function(){return r}});var r=(0,n(423).y)("f5455a90$IResultsUpdatedEventArgs")},4614:function(e,t,n){"use strict";n.r(t),n.d(t,{QueryTokenStringGenerator:function(){return l}});var r=n(3545),i=n(1822),o=n(2039),a=n(2093),s=n(423),l=function(e){function t(t){var n=e.call(this,t)||this;return n.m_init=null,n.m_init=t,n}return(0,r.t)(t,e),t.prototype.apply=function(e,t,n,r,s,l,u){var c=this.m_init.query.load(t,null),d=0,p=null;this.m_init.query.get_returnType()===a.Annotations.typeiD_Boolean?c&&(p=this.m_init.name):((p=this.m_init.name)&&(p+="_"),p+=this.m_init.annotations.valueToString(this.m_init.query.get_returnType(),c)),null!=p&&o.z.AddTokenPropertyString(e,p,this.m_init.score,n,r,(0,i.m)((function(){return d}),(function(e){return d=e}))),u.val+=d},t.c_CompiledTypeId=1,t}(o.z);(0,s.l)(l,"409aea9e$QueryTokenStringGenerator",o.z,[])},4621:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(3545),o=n(423),a=n(7734),s=n(5998),l=n(3093),u=n(363),c=n(8192),d=n(6382),p=function(){function e(){this._container=null}return e.prototype.configure=function(e){this._container=e||d.w.get_instance()},e.prototype.dispose=function(){},e}();(0,o.l)(p,"1fa8c643$TellMePackage",null,[u.u,c.s]);var g=n(9910),h=n(7499),_=n(2575),f=n(9423),m=n(3054),y=(0,o.y)("1390491a$ITellMeApplicationData"),v=n(8005),S=n(3803),I=n(9354),C=n(8277),T=n(9432),b=function(){function e(t,n,r,i,o){this._additionalControlsRoot=null,this._additionalControlsRootHasTrimmedIds=!1,this.$$pf_Application=null,this.$$pf_AssistanceIsEnabled=!1,this.$$pf_SearchHelpCommandString=null,this.$$pf_SearchHelpAltCommandString=null,this.findControlIdString=null,this.$$pf_InDocFindButtonTitle=null,this.$$pf_FindInDocumentCommandString=null,this.$$pf_FindInDocumentIsEnabled=!1,this.$$pf_FindInDocumentWithMatchesIsEnabled=!1,this.$$pf_InsightsIsEnabled=!1,this.$$pf_SmartLookupIsEnabled=!1,this.$$pf_AppsForOfficeEnabled=!1,this.$$pf_HelpOnHelpIsEnabled=!1,this.$$pf_TestHookIsEnabled=!1,this.$$pf_TellMeServiceResultsForSearchEnabled=!1,this.$$pf_ShouldIgnoreQueryForHelp=!1,this.shouldLogQuery=!1,this.$$pf_ResultsLimit=0,this.$$pf_ControlMetadata=null,this.$$pf_ParameterData=null,this.$$pf_TryQueries=null,this.$$pf_ControlsToSkipEndLogging=null,this.set_assistanceIsEnabled(null==n?_.AFrameworkApplication.assistanceIsEnabled:n),this.set_resultsLimit(null==i?e.DefaultResultsLimit:i),this.set_insightsIsEnabled(null==r?_.AFrameworkApplication.insightsIsEnabled:r),this.set_smartLookupIsEnabled(null==o?_.AFrameworkApplication.smartLookupIsEnabled:o),this.set_helpOnHelpIsEnabled(!!_.AFrameworkApplication.appSettingsManager&&_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeHelpOnHelpIsEnabled")),this.set_testHookIsEnabled(!!_.AFrameworkApplication.appSettingsManager&&_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeCommandHookIsEnabled")),this.set_tellMeServiceResultsForSearchEnabled(!!_.AFrameworkApplication.get_activeFrame()&&_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isTellMeServiceResultsForSearchEnabled()),this.set_findInDocumentWithMatchesIsEnabled(!!_.AFrameworkApplication.get_activeFrame()&&_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isFindInDocumentWithMatchesEnabled()),this.set_shouldIgnoreQueryForHelp(!!_.AFrameworkApplication.appSettingsManager&&_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeIgnoreQueryForHelp")),this.set_shouldLogQuery(!!_.AFrameworkApplication.appSettingsManager&&_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeQueryLoggingEnabled")),this.InitializeControlMetadata(t||{}),this.set_searchHelpCommandString("2918242107"),this.set_searchHelpAltCommandString("1454393937"),this.set_parameterData({}),this.set_tryQueries([]),this.set_controlsToSkipEndLogging([S.q.get_tryQueryId()])}return e.prototype.get_application=function(){return this.$$pf_Application},e.prototype.set_application=function(e){return this.$$pf_Application=e,e},e.prototype.get_assistanceIsEnabled=function(){return this.$$pf_AssistanceIsEnabled},e.prototype.set_assistanceIsEnabled=function(e){return this.$$pf_AssistanceIsEnabled=e,e},e.prototype.get_searchHelpCommandString=function(){return this.$$pf_SearchHelpCommandString},e.prototype.set_searchHelpCommandString=function(e){return this.$$pf_SearchHelpCommandString=e,e},e.prototype.get_searchHelpAltCommandString=function(){return this.$$pf_SearchHelpAltCommandString},e.prototype.set_searchHelpAltCommandString=function(e){return this.$$pf_SearchHelpAltCommandString=e,e},e.prototype.get_findControlIdString=function(){return this.findControlIdString},e.prototype.set_findControlIdString=function(e){return this.findControlIdString=e,e},e.prototype.get_inDocFindButtonTitle=function(){return this.$$pf_InDocFindButtonTitle},e.prototype.set_inDocFindButtonTitle=function(e){return this.$$pf_InDocFindButtonTitle=e,e},e.prototype.get_findInDocumentCommandString=function(){return this.$$pf_FindInDocumentCommandString},e.prototype.set_findInDocumentCommandString=function(e){return this.$$pf_FindInDocumentCommandString=e,e},e.prototype.get_findInDocumentIsEnabled=function(){return this.$$pf_FindInDocumentIsEnabled},e.prototype.set_findInDocumentIsEnabled=function(e){return this.$$pf_FindInDocumentIsEnabled=e,e},e.prototype.get_findInDocumentWithMatchesIsEnabled=function(){return this.$$pf_FindInDocumentWithMatchesIsEnabled},e.prototype.set_findInDocumentWithMatchesIsEnabled=function(e){return this.$$pf_FindInDocumentWithMatchesIsEnabled=e,e},e.prototype.get_insightsIsEnabled=function(){return this.$$pf_InsightsIsEnabled},e.prototype.set_insightsIsEnabled=function(e){return this.$$pf_InsightsIsEnabled=e,e},e.prototype.get_smartLookupIsEnabled=function(){return this.$$pf_SmartLookupIsEnabled},e.prototype.set_smartLookupIsEnabled=function(e){return this.$$pf_SmartLookupIsEnabled=e,e},e.prototype.get_appsForOfficeEnabled=function(){return this.$$pf_AppsForOfficeEnabled},e.prototype.set_appsForOfficeEnabled=function(e){return this.$$pf_AppsForOfficeEnabled=e,e},e.prototype.get_helpOnHelpIsEnabled=function(){return this.$$pf_HelpOnHelpIsEnabled},e.prototype.set_helpOnHelpIsEnabled=function(e){return this.$$pf_HelpOnHelpIsEnabled=e,e},e.prototype.get_testHookIsEnabled=function(){return this.$$pf_TestHookIsEnabled},e.prototype.set_testHookIsEnabled=function(e){return this.$$pf_TestHookIsEnabled=e,e},e.prototype.get_tellMeServiceResultsForSearchEnabled=function(){return this.$$pf_TellMeServiceResultsForSearchEnabled},e.prototype.set_tellMeServiceResultsForSearchEnabled=function(e){return this.$$pf_TellMeServiceResultsForSearchEnabled=e,e},e.prototype.get_shouldIgnoreQueryForHelp=function(){return this.$$pf_ShouldIgnoreQueryForHelp},e.prototype.set_shouldIgnoreQueryForHelp=function(e){return this.$$pf_ShouldIgnoreQueryForHelp=e,e},e.prototype.get_shouldLogQuery=function(){return this.shouldLogQuery},e.prototype.set_shouldLogQuery=function(e){return this.shouldLogQuery=e,e},e.prototype.get_isSimplifiedReactRibbonUxEnabled=function(){return!!_.AFrameworkApplication.get_activeFrame()&&_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled()},e.prototype.get_moveFocusAfterCommandIsEnabled=function(){return!!_.AFrameworkApplication.appSettingsManager&&_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MoveFocusAfterCommandIsEnabled")},e.prototype.get_noResultsImage=function(){return I.ImageClusteringHelper.getImageClass("OfficeAssistant_32x32x32")},e.prototype.get_customCommandResultsProvider=function(){return null},e.prototype.isValidControl=function(e){return this.get_isSimplifiedReactRibbonUxEnabled()?Array.contains(appChrome.selectors.getVisibleControlIds(),e):!!T.f.get_instance().getFirstValidControl(e)},e.prototype.isControlEnabled=function(e){var t=T.f.get_instance().getFirstValidControl(e);return!!t&&t.get_enabled()},e.prototype.registerAppSpecificMenuItemFactories=function(e){},e.prototype.getAppsForOfficeResultsProvider=function(){return null},e.prototype.get_resultsLimit=function(){return this.$$pf_ResultsLimit},e.prototype.set_resultsLimit=function(e){return this.$$pf_ResultsLimit=e,e},e.prototype.get_controlMetadata=function(){return this.$$pf_ControlMetadata},e.prototype.set_controlMetadata=function(e){return this.$$pf_ControlMetadata=e,e},e.prototype.get_parameterData=function(){return this.$$pf_ParameterData},e.prototype.set_parameterData=function(e){return this.$$pf_ParameterData=e,e},e.prototype.get_tryQueries=function(){return this.$$pf_TryQueries},e.prototype.set_tryQueries=function(e){return this.$$pf_TryQueries=e,e},e.prototype.ensureTrimmedIdsAreSet=function(){if(this._additionalControlsRoot&&!this._additionalControlsRootHasTrimmedIds&&(this._additionalControlsRootHasTrimmedIds=!0,this.setTrimmedIds(this._additionalControlsRoot),this.get_isSimplifiedReactRibbonUxEnabled())){var e=d.w.get_instance().resolve(m.u),t=new C.v(e).getActionsForTrimmedIds(this._additionalControlsRoot.get_trimmedIds());appChrome.api.dispatch(t)}},e.prototype.getAdditionalControlsRoot=function(){throw Error.notImplemented()},e.prototype.get_controlsToSkipEndLogging=function(){return this.$$pf_ControlsToSkipEndLogging},e.prototype.set_controlsToSkipEndLogging=function(e){return this.$$pf_ControlsToSkipEndLogging=e,e},e.prototype.setTrimmedIds=function(e){},e.prototype.determineTryQueries=function(e){for(var t=[],n=0;n<e.length;++n)e[n].shouldUseAlternate?t.push(new v.z(e[n].alternate,S.q.get_tryQueryAlternateId()+n.toString())):t.push(new v.z(e[n].standard,S.q.get_tryQueryId()+n.toString()));return t},e.prototype.resolveAndRegisterAdditionalControls=function(e,t){if(e&&t){t.resolveAdditionalControlReferences(e),this._additionalControlsRoot=this.getAdditionalControlsRoot();for(var n=0,r=e.children;n<r.length;n++){var i=r[n],o=i.attrs.Id;this._additionalControlsRoot.addControlFromDeserializedData(o,i)}}},e.prototype.resolveControlMetadataReferences=function(e){var t=this.get_controlMetadata();for(var n in t){var r={key:n,value:t[n]};e.resolveOverriddenProperties(r.value)}},e.prototype.InitializeControlMetadata=function(e){var t={};for(var n in e){var r={key:n,value:e[n]},i=r.key,o=r.value;for(var a in o){var s={key:a,value:o[a]},l=s.key,u=s.value;(t[l]||(t[l]={}))[i]=u}}this.set_controlMetadata(t)},e.DefaultResultsLimit=5,e}();(0,o.l)(b,"d87fc0d3$TellMeApplicationData",null,[y]);var A=function(){return function(e,t,n){this.standard=null,this.alternate=null,this.shouldUseAlternate=!1,this.standard=e,this.alternate=t,this.shouldUseAlternate=n}}();(0,o.l)(A,"ac1e760a$TryQuerySet",null,[]);var M=(0,o.y)("116dfff1$IAdditionalControlResolver"),P=(0,o.y)("d8412af0$IOverriddenPropertiesResolver"),F=n(6935),w=function(e){function t(t,n,r){return e.call(this,t,n,null,null,r)||this}return(0,i.t)(t,e),t.prototype.resolveOverriddenProperties=function(e){var t={};for(var n in e){var r={key:n,value:e[n]};if(r.value){var i=r.value.toString();this.replaceIntlString(e,r.key,i),this.replaceImagePath(e,r.key,i),this.replaceImageMap(e,r.key,i,t)}}for(var o in t){var a={key:o,value:t[o]};e[a.key+"Class"]=a.value}},t.prototype.resolveAdditionalControlReferences=function(e){this.updateData(e)},t}(F.CuiHelper);(0,o.l)(w,"ba77c4c$CuiHelperResolver",F.CuiHelper,[M,P]);var R=n(3069),E=n(5575),k=n(3068),D=n(2433),O=n(4381),U=n(6378),x=function(){function e(){}return e.prototype.get_resultBindingType=function(){return 10},e.prototype.createMenuItem=function(t,n){return O.s.buildButtonXml(String.format("{0}|{1}|",3,U.l.xmlEncode(t.value)),"1945259303",e.OfficeStoreLabelText)},e.OfficeStoreLabelText="Explore Office Store",e}();(0,o.l)(x,"f51ee36c$AppsForOfficeQueryMenuItemFactory",null,[D.p]);var L=n(87),N=function(){return function(){this.name=null,this.assetId=null,this.description=null,this.icon=null,this.installed=!1,this.appVersion=null,this.assetStoreId=null,this.currentStoreType=null,this.storeId=null,this.targetType=0}}();(0,o.l)(N,"3ca34469$OfficeAppItem",null,[]);var B=function(){function e(){this._appList=null}return e.prototype.get_AppList=function(){return this._appList||(this._appList={},this.ProvisionAppList()),this._appList},e.prototype.BuildTellMeData=function(e){if(e)for(var t=0,n=e;t<n.length;t++){var r=n[t],i=r[1];if(i in this.get_AppList()){var o=this.get_AppList()[i];o.installed=!0,o.name=r[0],o.description=r[2],o.targetType=r[3],o.appVersion=r[4],o.currentStoreType=r[6],o.icon=r[9],o.storeId=r[11],o.assetStoreId=r[12]}}},e.prototype.EntitleApp=function(e,t,n,r,i){if(!L.n.isNullOrEmptyString(e)&&e in this.get_AppList()){var o=this.get_AppList()[e];o.installed=!0,o.appVersion=t,o.storeId=n,o.assetStoreId=r,o.targetType=i}},e.prototype.AddToAppList=function(e,t,n,r){var i=new N;i.assetId=t,i.name=e,i.icon=n,i.description=r,i.installed=!1,this._appList[t]=i},e.prototype.ProvisionAppList=function(){this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_Translator,"WA104124372",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_Translator,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_Translator),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_TextMaster,"WA104079622",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_TextMaster,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_TextMaster),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_ConsistencyChecker,"WA104041485",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_ConsistencyChecker,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_ConsistencyChecker),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_EFax,"WA102919521",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_EFax,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_EFax),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_ProWordCloud,"WA104038830",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_ProWordCloud,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_ProWordCloud),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_FontFinder,"WA104211266",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_FontFinder,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_FontFinder),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_PicHit,"WA104178141",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_PicHit,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_PicHit),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_IMGEffector,"WA104070070",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_IMGEffector,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_IMGEffector),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_LucidChart,"WA103633427",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_LucidChart,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_LucidChart),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_DocuSign,"WA104218065",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_DocuSign,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_DocuSign),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_GeoGebraTube,"WA104199813",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_GeoGebraTube,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_GeoGebraTube),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_WordCalc,"WA103699714",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_WordCalc,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_WordCalc),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_QR4Office,"WA104051163",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_QR4Office,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_QR4Office),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_SymbolsCharacters,"WA104379279",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_SymbolsCharacters,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_SymbolsCharacters),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_WordToHTML,"WA104320163",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_WordToHTML,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_WordToHTML),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_MapIt,"WA104374368",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_MapIt,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_MapIt),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_AbbreviationList,"WA104043061",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_AbbreviationList,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_AbbreviationList),this.AddToAppList(WordEditorIntl.WordEditorStrings.L_TellMeAppTitle_HandyCalculator,"WA104379673",WordEditorIntl.WordEditorStrings.L_TellMeAppIconUrl_HandyCalculator,WordEditorIntl.WordEditorStrings.L_TellMeAppDescription_HandyCalculator)},e.get_Instance=function(){return e._instance},e._instance=new e,e}();(0,o.l)(B,"80ff37ac$AppData",null,[]);var H=function(){function e(){}return e.GenerateButtonXml=function(t,n,r,i){var o=U.l.xmlEncode(t.name),a=e.GenerateButtonId(t,r),s=U.l.xmlEncode(t.description),l=e.GenerateCommand(t.installed),u=n?"Menu16":"Menu32",c=n?e.ImageSmallCSS:e.ImageLargeCSS,d=i?i.get_sessionId()+"|"+i.get_interactionId()+"|"+t.name:"";return O.s.buildButtonXmlEx(a,l,o,t.icon,c,null,d,o,u,null,"1708531416",s,null,null,!0,null,null,null,null,null,null,null)},e.GenerateFlyoutAnchor=function(e,t,n,r,i){return O.s.buildFlyoutXml(e,null,null,null,!1,!0,null,null,"Image16by16",t,n,r,null,r,null,!1,!1,!0,i)},e.GenerateMenuSectionXml=function(e,t,n,r,i){var o=O.s.buildControlsGroupXml(e,t),a=r?"Menu16":"Menu32";return O.s.buildMenuSectionXml(n,o,a,i,null,null,null)},e.GenerateButtonId=function(e,t){var n="TellMe_OfficeAddin_Control";return t.IsOfficeAddInSingleFlyoutLayout()?n="TellMe_OfficeAddin_SingleFlyoutLayout":t.IsOfficeAddInStandaloneFlyoutLayout()&&(n="TellMe_OfficeAddin_StandaloneFlyoutLayout"),e.installed?String.format("{0}|{1}|{2}|{3}|{4}|{5}|{6}",e.assetId,e.appVersion,e.storeId,e.assetStoreId,e.targetType,U.l.xmlEncode(e.name),n):String.format("{0}|{1}||{2}",2,e.assetId,n)},e.GenerateCommand=function(e){return e?"3553159035":"1945259303"},e.ImageSmallCSS="cui-img-16by16",e.ImageLargeCSS="cui-img-32by32",e}();(0,o.l)(H,"e9792202$XmlGenerationUtility",null,[]);var $=function(){function e(e){this._applicationData=null,this._applicationData=e}return e.prototype.get_resultBindingType=function(){return 9},e.prototype.createMenuItem=function(e,t){if(this._applicationData.IsOfficeAddInSingleFlyoutLayout()){for(var n=[],r=e.value.split("|"),i=0,o=r;i<o.length;i++){var a=o[i];if(!L.n.isNullOrEmptyString(a)){var s=B.get_Instance().get_AppList()[a],l=H.GenerateButtonXml(s,!1,this._applicationData,t);n.push(l)}}var u=H.GenerateMenuSectionXml("TellMeDropdownControlsForApps_SingleFlyoutLayout",n,"TellMeDropdownMenuSectionForApps_SingleFlyoutLayout",!1,CommonUIStrings.l_TellMeAppsForOfficeMenuSectionTitle),c=String.format(CommonUIStrings.l_TellMeAppsForOfficeFlyoutAnchorTitle,r.length-1);return H.GenerateFlyoutAnchor("TellMeFlyoutAnchorForApps_SingleFlyoutLayout",_.AFrameworkApplication.get_imageClusterPath(),I.ImageClusteringHelper.getImageClass("AppForOfficeLogo_16x16x32"),c,[u])}s=B.get_Instance().get_AppList()[e.value];if(this._applicationData.IsOfficeAddInStandaloneFlyoutLayout()){var d=[l=H.GenerateButtonXml(s,!1,this._applicationData,t)],p=O.s.buildControlsGroupXml("TellMeControlsForApps_StandardFlyoutLayout",d),g=O.s.buildMenuSectionXml("TellMeMenuSectionForApps_StandardFlyoutLayout",p,"Menu32",null,null,null,null);c=String.format(CommonUIStrings.l_TellMeAppsForOfficeInsertAppHint,U.l.xmlEncode(s.name));return H.GenerateFlyoutAnchor("TellMeFlyoutAnchorForApps_StandardFlyoutLayout"+s.assetId,s.icon,H.ImageSmallCSS,c,[g])}return H.GenerateButtonXml(s,!0,this._applicationData,t)},e}();(0,o.l)($,"b2ee308f$AppsForOfficeRecommendationMenuItemFactory",null,[D.p]);var G=(0,o.y)("936e7f5$IAppForOfficeResultsProvider"),W=n(904),V=n(2879),j=function(){function e(){this._appActivatedEventRegistered=!1,this._connectionStatus=0}return e.prototype.QueryEntitlementAsync=function(){if(this._appActivatedEventRegistered||(this.RegisterAppActivatedEvent(),this._appActivatedEventRegistered=!0),!this._connectionStatus||4===this._connectionStatus){var e=new V.c(2,1,0,o.i(this,this.RetrieveData,"RetrieveData"),0,null,!1);_.AFrameworkApplication.get_theTaskManager().addTask(e),this._connectionStatus=1}},e.prototype.RegisterAppActivatedEvent=function(){var e={};e.callback=o.i(this,this.OnAppForOfficeActivated,"OnAppForOfficeActivated");_.AFrameworkApplication.get_theActionManager().processActionWithData(g.b.registerAppActivatedEvent,2,e,null)},e.prototype.RetrieveData=function(e){var t={};t.callback=o.i(this,this.OnDataReady,"OnDataReady");_.AFrameworkApplication.get_theActionManager().processActionWithData(g.b.queryEntitledAppsForOffice,2,t,null)},e.prototype.OnAppForOfficeActivated=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4];B.get_Instance().EntitleApp(n,r,i,o,a)},e.prototype.OnDataReady=function(e){if(e){var t=e;return t.errorCode||B.get_Instance().BuildTellMeData(t.value),t.errorCode&&-1!==t.errorCode?-2147208619===t.errorCode?void(this._connectionStatus=4):void(this._connectionStatus=3):void(this._connectionStatus=2)}this._connectionStatus=3},e.get_Instance=function(){return e._instance},e._instance=new e,e}();(0,o.l)(j,"6df138af$AppEntitlementQuery",null,[]);var q=function(){function e(e){this._applicationData=null,this._recommendationList=null,this._topOneRecommendation=null,this._sortFunction=null,this._applicationData=e,this._sortFunction=function(e,t){var n=e,r=t;return n.type===r.type?0:9===n.type?1:9===r.type?-1:0}}return e.prototype.initialize=function(){j.get_Instance().QueryEntitlementAsync(),this._applicationData.IsOfficeAddInSingleFlyoutLayout()&&(this._recommendationList=[]),this._topOneRecommendation=null},e.prototype.updateResultGroup=function(e,t,n){t in B.get_Instance().get_AppList()&&(B.get_Instance().get_AppList()[t].installed?n.addResult(new W.b(t,8,null,null)):(this._topOneRecommendation||(this._topOneRecommendation=t),this._applicationData.IsOfficeAddInSingleFlyoutLayout()&&this._recommendationList.push(t)))},e.prototype.completeUpdate=function(t){if(this._applicationData.IsOfficeAddInSingleFlyoutLayout()&&this._recommendationList.length){for(var n="",r=0,i=this._recommendationList;r<i.length;r++){n+="|"+i[r]}var o=new W.b(n,9,null,null);t.addResult(o)}t.get_results().sort(this._sortFunction),this._applicationData.IsOfficeAddInSingleFlyoutLayout()&&t.get_results().length===e.MaxResults+1&&Array.removeAt(t.get_results(),e.MaxResults-1)},e.prototype.addTopOneRecommendationToResultGroup=function(e,t){this._topOneRecommendation&&!L.n.isNullOrEmptyString(t)&&(e.addResult(new W.b(this._topOneRecommendation,9,null,null)),e.addResult(new W.b(t,10,null,null)))},e.MaxResults=5,e}();(0,o.l)(q,"503fc78f$AppsForOfficeResultsProvider",null,[G]);var z=function(){function e(){this._mostRecentResult=null,this.mostRecentClickedResult=null}return e.prototype.get_mostRecentClickedResult=function(){return this.mostRecentClickedResult},e.prototype.set_mostRecentClickedResult=function(e){return this.mostRecentClickedResult=e,e},e.prototype.createMenuItem=function(e,t){return this._mostRecentResult=e,this.createMenuItemImpl(e,t)},e.prototype.notifyClicked=function(){this.set_mostRecentClickedResult(this._mostRecentResult)},e.prototype.getLabelFromResult=function(e){return 7===e.type?String.format(CommonUIStrings.l_FindInDocumentText,e.parameterValue):e.parameterValue},e.prototype.getCommandValueIdFromResult=function(e){return e.parameterValue},e}();(0,o.l)(z,"95b623bc$ParameterizedCommand",null,[]);var K=function(e){function t(t){var n=e.call(this)||this;return n.isSimplifiedUxEnabled=!1,n.isSimplifiedUxEnabled=t,n}return(0,i.t)(t,e),t.prototype.get_commandId=function(){return this.isSimplifiedUxEnabled?"DefinitionsParameterized":"DefinitionButton"},t.prototype.get_parameterType=function(){return"Definition"},t.prototype.createMenuItemImpl=function(e,t){var n=U.l.xmlEncode(String.format(WordEditorIntl.WordEditorStrings.L_TellMeButtonLabel_DefinitionsParam,e.parameterValue));return O.s.buildButtonXml(S.q.createdParameterizedId(e.value),"2114287254",n,S.q.get_insightsIcon(),null,U.l.xmlEncode(S.q.createSerializedInsightsParameters(e.parameterValue)),n,null,null)},t.prototype.getLabelFromResult=function(e){return String.format(WordEditorIntl.WordEditorStrings.L_TellMeButtonLabel_DefinitionsParam,e.parameterValue)},t.prototype.getCommandValueIdFromResult=function(e){return S.q.createSerializedInsightsParameters(e.parameterValue)},t}(z);(0,o.l)(K,"67782c87$DefinitionsParameterizedCommand",z,[]);var Q=function(e){function t(t){var n=e.call(this)||this;return n.isSimplifiedUxEnabled=!1,n.isSimplifiedUxEnabled=t,n}return(0,i.t)(t,e),t.prototype.get_commandId=function(){return this.isSimplifiedUxEnabled?_.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isFindInDocumentWithMatchesEnabled()?"FindWithMatchesParameterized":"FindParameterized":"EditingFind"},t.prototype.get_parameterType=function(){return"Find"},t.prototype.createMenuItemImpl=function(e,n){var r=U.l.xmlEncode(String.format(WordEditorIntl.WordEditorStrings.L_ParamFindInDocTitle,e.parameterValue));return O.s.buildButtonXml(S.q.createdParameterizedId(e.value),"1540292897",r,t.FindIcon,null,U.l.xmlEncode(e.parameterValue),r,null,null)},t.prototype.getLabelFromResult=function(e){return String.format(WordEditorIntl.WordEditorStrings.L_ParamFindInDocTitle,e.parameterValue)},t.FindIcon="Find_16x16x32",t}(z);(0,o.l)(Q,"91c3b964$FindParameterizedCommand",z,[]);var Z=function(){function e(e){this._applicationData=null,this._applicationData=e}return e.prototype.get_resultBindingType=function(){return 8},e.prototype.createMenuItem=function(e,t){var n=B.get_Instance().get_AppList()[e.value];return H.GenerateButtonXml(n,!0,this._applicationData,t)},e}();(0,o.l)(Z,"d6f7ea06$InstalledAppsForOfficeMenuItemFactory",null,[D.p]);var J=function(e){function t(t){var n=e.call(this)||this;return n.isSimplifiedUxEnabled=!1,n.isSimplifiedUxEnabled=t,n}return(0,i.t)(t,e),t.prototype.get_commandId=function(){return this.isSimplifiedUxEnabled?"SynonymsParameterized":"SynonymButton"},t.prototype.get_parameterType=function(){return"Synonym"},t.prototype.createMenuItemImpl=function(e,t){var n=U.l.xmlEncode(String.format(WordEditorIntl.WordEditorStrings.L_TellMeButtonLabel_SynonymsParam,e.parameterValue));return O.s.buildButtonXml(S.q.createdParameterizedId(e.value),"2114287254",n,S.q.get_insightsIcon(),null,U.l.xmlEncode(S.q.createSerializedInsightsParameters(e.parameterValue)),n,null,null)},t.prototype.getLabelFromResult=function(e){return String.format(WordEditorIntl.WordEditorStrings.L_TellMeButtonLabel_DefinitionsParam,e.parameterValue)},t.prototype.getCommandValueIdFromResult=function(e){return S.q.createSerializedInsightsParameters(e.parameterValue)},t}(z);(0,o.l)(J,"602e3163$SynonymsParameterizedCommand",z,[]);var X=function(e){function t(t,n,r){var i=this;i._appForOfficeResultsProvider=null,i._standaloneRoot=null,i._getIsWordCountEnabled=null,i._trackChangeManager=null,(i=e.call(this,window.TellMeControlMetadataOverrides,null,null,null,null)||this).set_application("Word"),i._standaloneRoot=t,i._getIsWordCountEnabled=n,i._trackChangeManager=r;var o=[WoncaIntl.WoncaStrings,Box4Intl.Box4Strings],a=new w(k.f.box4ImageBase,WordEditorIntl.WordEditorStrings,o);i.resolveControlMetadataReferences(a),i.resolveAndRegisterAdditionalControls(window.TellMeAdditionalControls,a),_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeFindInDocumentIsEnabled")&&(i.set_findInDocumentIsEnabled(!0),i.set_findInDocumentCommandString(i.get_isSimplifiedReactRibbonUxEnabled()?i.get_findInDocumentWithMatchesIsEnabled()?"FindWithMatchesParameterized":"FindParameterized":"EditingFind")),i.set_inDocFindButtonTitle(WordEditorIntl.WordEditorStrings.L_ParamFindInDocTitle),i.set_appsForOfficeEnabled(_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SearchOfficeAddinIsEnabled")&&!_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AppsForOfficeThirdPartyIsDisabled"));var s=new K(i.get_isSimplifiedReactRibbonUxEnabled()),l=new J(i.get_isSimplifiedReactRibbonUxEnabled());if(i.get_parameterData()[s.get_commandId()]=s,i.get_parameterData()[l.get_commandId()]=l,_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorTellMeParameterizedFindIsEnabled")){var u=new Q(i.get_isSimplifiedReactRibbonUxEnabled());i.get_parameterData()[u.get_commandId()]=u}if(_.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("TellMeTryQueriesIsEnabled")){var c=[new A(WordEditorIntl.WordEditorStrings.L_TellMeTryQuery01,"",!1),new A(WordEditorIntl.WordEditorStrings.L_TellMeTryQuery02,"",!1),new A(WordEditorIntl.WordEditorStrings.L_TellMeTryQuery03,"",!1),new A(WordEditorIntl.WordEditorStrings.L_TellMeTryQuery04,"",!1),new A(WordEditorIntl.WordEditorStrings.L_TellMeTryQuery05,"",!1)];i.set_tryQueries(i.determineTryQueries(c))}return i}return(0,i.t)(t,e),t.prototype.get_ribbonFocusScopeName=function(){return E.u.ribbonFocusId},t.prototype.getAppsForOfficeResultsProvider=function(){return this.get_appsForOfficeEnabled()&&!this._appForOfficeResultsProvider&&(this._appForOfficeResultsProvider=new q(this)),this._appForOfficeResultsProvider},t.prototype.registerAppSpecificMenuItemFactories=function(e){this.get_appsForOfficeEnabled()&&(e.registerFactory(new Z(this)),e.registerFactory(new $(this)),e.registerFactory(new x))},t.prototype.getAdditionalControlsRoot=function(){return new R.w("TellMeRoot",this._standaloneRoot.get_standaloneRootProperties())},t.prototype.setTrimmedIds=function(e){var t=_.AFrameworkApplication.appSettingsManager,n=e.get_trimmedIds();n.WordCountFlyout=!this._getIsWordCountEnabled(),n.SelectAllButton=!t.getBooleanAppSetting("TellMeSelectAllResultIsEnabled");var r=t.getBooleanAppSetting("TellMeDesktopUpSellIsEnabled"),i=_.AFrameworkApplication.get_isTellMeUpSellEnterpriseEnabled();this.get_isSimplifiedReactRibbonUxEnabled()&&(appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("TryOfficeUpsell",!i)),i=!1),n.TextBoxUpSellButton=!r||i,n.TableOfContentsUpSellButton=!r||i,n.SmartArtUpSellButton=!r||i,n.WordArtUpSellButton=!r||i,n.MultiColumnLayoutUpSellButton=!r||i,n.InsertEquationUpSellButton=!r||i,n.TrackChangesUpSellButton=!r||i||this._trackChangeManager.get_trackChangeFeatureIsEnabled(),n.ShapesUpSellButton=!r||i,n.LabelsUpSellButton=!r||i,n.InsertCitationUpSellButton=!r||i,n.TextBoxUpSellButtonEnterprise=!r||!i,n.TableOfContentsUpSellButtonEnterprise=!r||!i,n.SmartArtUpSellButtonEnterprise=!r||!i,n.WordArtUpSellButtonEnterprise=!r||!i,n.MultiColumnLayoutUpSellButtonEnterprise=!r||!i,n.InsertEquationUpSellButtonEnterprise=!r||!i,n.TrackChangesUpSellButtonEnterprise=!r||!i||this._trackChangeManager.get_trackChangeFeatureIsEnabled(),n.ShapesUpSellButtonEnterprise=!r||!i,n.LabelsUpSellButtonEnterprise=!r||!i,n.InsertCitationUpSellButtonEnterprise=!r||!i;var o=!t.getBooleanAppSetting("WordEditorTellMeDefinitionsAndSynonymsIsEnabled")||!_.AFrameworkApplication.insightsIsEnabled;n.SynonymButton=o,n.DefinitionButton=o},t.prototype.IsOfficeAddInSingleFlyoutLayout=function(){return _.AFrameworkApplication.appSettingsManager.getIntAppSetting("OfficeAddInSearchResultLayoutVariant",t.OfficeAddInDialogBasedLayout)===t.OfficeAddInSingleFlyoutLayout},t.prototype.IsOfficeAddInStandaloneFlyoutLayout=function(){return _.AFrameworkApplication.appSettingsManager.getIntAppSetting("OfficeAddInSearchResultLayoutVariant",t.OfficeAddInDialogBasedLayout)===t.OfficeAddInStandaloneFlyoutLayout},t.prototype.IsOfficeAddInDialogBasedLayout=function(){return _.AFrameworkApplication.appSettingsManager.getIntAppSetting("OfficeAddInSearchResultLayoutVariant",t.OfficeAddInDialogBasedLayout)===t.OfficeAddInDialogBasedLayout},t.OfficeAddInDialogBasedLayout=1,t.OfficeAddInStandaloneFlyoutLayout=2,t.OfficeAddInSingleFlyoutLayout=3,t}(b);(0,o.l)(X,"904d1ce1$WordEditorTellMeApplicationData",b,[]);var Y=n(953),ee=n(5214),te=n(8768),ne=n(3888),re=n(6307),ie=n(337),oe=n(636),ae=n(8977),se=n(1120),le=n(4633),ue=n(6654),ce=n(2996),de=n(8692),pe=function(e){function t(t){var n=e.call(this)||this;return n._wordFindInDocumentWithMatchesProvider=null,n._wordFindInDocumentWithMatchesProvider=t,n}return(0,i.t)(t,e),t.prototype.findComplete=function(){this._wordFindInDocumentWithMatchesProvider.Update()},t}(de.d);(0,o.l)(pe,"2727e426$TellMeFindStatusManager",de.d,[]);var ge=function(){function e(e){this._findInDocumentCommandId=null,this._callBack=null,this._tellMeQuery=null,this._tellMeFindManager=null,this._startTime=0,this._internalScope="TellMeWAC.",this._selectionManager=null,this._currentSelection=null,this._findInDocumentCommandId=e,this._selectionManager=ue.SelectionManager.get_instance();var t=new pe(this);this._tellMeFindManager=le.FindManager.createInstance(t,oe.s.get_instance(),ce.u.get_instance(),!0,!0)}return e.prototype.issueQuery=function(e,t,n){if(this.IsValidQuery(e)){this._tellMeQuery=e,this._callBack=t;var r=ie.w.createQuery(e.queryText,0);this._startTime=window.performance.now(),this._currentSelection=this._selectionManager.get_selectionCollection().get_currentSelection(),this._tellMeFindManager.find(r)}},e.prototype.Update=function(){this.SendTellMeActivityLatencyOnSuccess(Math.round(window.performance.now()-this._startTime));var e=String.format(CommonUIStrings.l_FindInDocumentText,this._tellMeQuery.queryText),t=U.l.xmlEncode(this._tellMeQuery.queryText),n=new Array(0);n.push(appChrome.actions.setControlLabel(this._findInDocumentCommandId,e)),n.push(appChrome.actions.setCompoundButtonCommandValueId(this._findInDocumentCommandId,t)),n.push(appChrome.actions.updateCompoundButtonDescription(this._findInDocumentCommandId,this.GetTotalCount())),appChrome.api.dispatch(n);var r=new W.b(this._findInDocumentCommandId,7,this._tellMeQuery.queryText,null),i=new ne.z(2);i.addResult(r);var o=new re.v;o.addResultGroup(i),o.set_query(this._tellMeQuery),this._callBack.resultsUpdated(o),this._currentSelection&&this._selectionManager.setSelection(this._currentSelection,null,!1,!1),this._tellMeFindManager.cancelAndClearFind(!0),this.SendTellMeProviderLatencyOnSuccess(Math.round(window.performance.now()-this._startTime))},e.prototype.GetTotalCount=function(){var e=this._tellMeFindManager.get_resultManager().get_totalResults().toString();return"1"===e?String.format(CommonUIStrings.l_FindInDocumentResultText,e):String.format(CommonUIStrings.l_FindInDocumentResultsText,e)},e.prototype.IsValidQuery=function(e){return!!e&&!!e.queryText&&""!==e.queryText.trim()},e.prototype.SendTellMeActivityLatencyOnSuccess=function(e){var t={Time:(new Date).getTime(),Event:"Latency",LatencyType:"ApiCall",Service:"FindApi",UiElement:"FindWithMatchesParameterized",QueryLength:this._tellMeQuery.queryText.length};this.SendActivityEvent(t,e)},e.prototype.SendTellMeProviderLatencyOnSuccess=function(e){var t={Time:(new Date).getTime(),Event:"Latency",LatencyType:"Provider",UiElement:"FindWithMatchesParameterized",QueryLength:this._tellMeQuery.queryText.length};this.SendActivityEvent(t,e)},e.prototype.SendActivityEvent=function(e,t){var n=ae.j.dictionaryToDataFields(e,null,null);se.k.sendTellMeActivityEvent((0,ee.m)(new te.z,{name:"Latency",dataFields:n,durationMs:t}),this._internalScope)},e}();(0,o.l)(ge,"bf0f1858$WordFindInDocumentWithMatchesProvider",null,[Y.m]);var he=function(e){function t(){return e.call(this)||this}return(0,i.t)(t,e),t.prototype.get_name=function(){return"WordEditor.TellMe"},t.prototype.init=function(){_.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(o.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},t.prototype.OnFullAppSettingsReady=function(){if(_.AFrameworkApplication.tellMeIsEnabled){var e=f.App.get_activeAppFrame().get_applicationInstance().getSliceForCommand(g.b.tellMe);e.get_isDownloaded()?this.PollForStateChange():e.add_loadFinished(o.i(this,this.ScriptResource_LoadFinished,"ScriptResource_LoadFinished"));var t=new X(this.get_TheStandaloneRootController().get_sharedStandaloneRoot(),(function(){return!1}),d.w.get_instance().resolve(a.b).get_instance());h.p.get_instance().initialize(t,null,null,null,null,null,o.i(f.App.get_activeAppFrame(),f.App.get_activeAppFrame().updateRibbonControls,"updateRibbonControls"),_.AFrameworkApplication.appSettingsManager,this._container.resolveFuture(s.a)),h.p.get_instance().registerActionsDeferred(e),t.get_findInDocumentIsEnabled()&&t.get_findInDocumentWithMatchesIsEnabled()&&h.p.get_instance().addProvider(new ge(t.get_findInDocumentCommandString()))}},t.prototype.PollForStateChange=function(){f.App.get_activeAppFrame().updateCommandUI(!1),this.get_TheStandaloneRootController().get_sharedStandaloneRoot().pollForControlState("sbTellMe")},t.prototype.ScriptResource_LoadFinished=function(e,t){this.PollForStateChange()},t.prototype.get_TheStandaloneRootController=function(){return d.w.get_instance().resolve(l.r)},t}(p);(0,o.l)(he,"3d260e71$WordEditorTellMePackage",p,[]),n.d(t,{Program:function(){return _e}});var _e=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new he,0,!1)},e}();(0,o.l)(_e,"5fab4829$Program",null,[])},4680:function(e,t,n){"use strict";n.d(t,{e:function(){return o}});var r=n(8540),i=n(423),o=function(){function e(){}return e.log=function(e,t,n){e?r.p.get_instance().traceMultiPartMessageTag(4273285,n,3,t,e.toLoggableString()):r.p.get_instance().traceTag(4293845,n,1,t,"{0}: Node was null.",t)},e}();(0,i.l)(o,"11155948$MergeNodeLogger",null,[])},4741:function(e,t,n){"use strict";n.d(t,{k:function(){return r}});var r=(0,n(423).y)("6f5e3f32$IResultsUpdatedCallback")},4925:function(e,t,n){"use strict";n.d(t,{x:function(){return r}});var r=(0,n(423).y)("9b7d5fa0$IPresenceTooltipControl")},5003:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("b8ed2b2c$IRttEditor"),o=n(6910),a=n(1442),s=n(7862),l=n(4628),u=n(4989),c=n(1775),d=n(5373),p=n(1227),g=n(7906),h=n(9137),_=n(3757),f=n(363),m=n(8192),y=n(3362),v=n(7597),S=n(2575),I=n(2462),C=n(1526),T=n(213),b=n(9423),A=n(4836),M=n(842),P=n(5118),F=(0,r.y)("9c521ed7$IRttAppliedOp"),w=(0,r.y)("65ab3ccf$IRttAppliedOpTracker"),R=n(5541),E=n(1822),k=n(6720),D=n(7847),O=function(){function e(e,t){this.addParaOperation=null,this.paragraphId=null,this.addParaOperation=e,this.paragraphId=t}return e.prototype.get_opType=function(){return 2},e.prototype.get_operation=function(){return this.addParaOperation},e}();(0,r.l)(O,"39b62cd1$RttAppliedAddParagraphOp",null,[F]);var U=function(){function e(e,t){this.replaceSymbolRangeOperation=null,this.paragraphId=null,this.replaceSymbolRangeOperation=e,this.paragraphId=t}return e.prototype.get_opType=function(){return 6},e.prototype.get_operation=function(){return this.replaceSymbolRangeOperation},e}();(0,r.l)(U,"1ba2a12b$RttAppliedReplaceSymbolRangeOp",null,[F]);var x=function(){function e(e,t){this.replaceTextRangeOperation=null,this.paragraphId=null,this.replaceTextRangeOperation=e,this.paragraphId=t}return e.prototype.get_opType=function(){return 1},e.prototype.get_operation=function(){return this.replaceTextRangeOperation},e}();(0,r.l)(x,"18a1bbf0$RttAppliedReplaceTextRangeOp",null,[F]);var L=function(){function e(e,t,n){this.splitParaOperation=null,this.sourceParagraphId=null,this.createdParagraphId=null,this.splitParaOperation=e,this.sourceParagraphId=t,this.createdParagraphId=n}return e.prototype.get_opType=function(){return 4},e.prototype.get_operation=function(){return this.splitParaOperation},e.prototype.get_aboveParagraphId=function(){return this.splitParaOperation.createNewParagraphAbove()?this.createdParagraphId:this.sourceParagraphId},e.prototype.get_belowParagraphId=function(){return this.splitParaOperation.createNewParagraphAbove()?this.sourceParagraphId:this.createdParagraphId},e}();(0,r.l)(L,"8bc0b9c2$RttAppliedSplitParagraphOp",null,[F]);var N=function(){function e(){this._appliedOps=null,this._appliedOps=new D.w(k.c.$$(F))}return e.prototype.KeyFromId=function(e){return e.toString()},e.prototype.AddAppliedOpForPara=function(e,t){var n=this.KeyFromId(e);this._appliedOps.containsKey(n)||this._appliedOps.set_item(n,new k.c(F)),this._appliedOps.get_item(n).add(t)},e.prototype.onOperationApplied=function(e){switch(e.get_opType()){case 1:var t=(0,R.e)(x,e);this.AddAppliedOpForPara(t.paragraphId,e);break;case 6:var n=(0,R.e)(U,e);this.AddAppliedOpForPara(n.paragraphId,e);break;case 4:var r=(0,R.e)(L,e);this.AddAppliedOpForPara(r.sourceParagraphId,e),this.AddAppliedOpForPara(r.createdParagraphId,e);break;case 2:var i=(0,R.e)(O,e);this.AddAppliedOpForPara(i.paragraphId,e)}},e.prototype.onGraphNodeReloaded=function(e){return this.onGraphNodeDisconnected(e)},e.prototype.onGraphNodeDisconnected=function(e){var t=this.KeyFromId(e);if(!this._appliedOps.containsKey(t))return new k.c(F);var n=this._appliedOps.get_item(t);this._appliedOps.remove(t);for(var r=n.$$lge();r.$$mn();){var i=r.$$cu();i.get_operation()&&i.get_operation().set_appliedOp(null)}return n},e.prototype.getOperationsForPara=function(e){var t;return this._appliedOps.tryGetValue(this.KeyFromId(e),(0,E.m)((function(){return t}),(function(e){return t=e})))?t:new k.c(F)},e.prototype.getAddParagraphOpByWordId=function(e){for(var t=this._appliedOps.get_values().$$ge();t.$$mn();){var n=t.$$cu();if(n.get_count()&&2===n.get_item(0).get_opType()){var r=n.get_item(0);if(r.addParaOperation.newParaWordId===e)return r}}return null},e}();(0,r.l)(N,"281d2a26$RttAppliedOpTracker",null,[w]);var B,H=(0,r.y)("1ee265d6$IParagraphAnchoredOp"),$=(0,r.y)("eb0b4a2$IRttDataStore"),G=(0,r.y)("3a96dfbe$IRttDataStoreDebugView"),W=n(1614);!function(e){e[e.expired=0]="expired",e[e.dried=1]="dried"}(B||(B={})),(0,r.h)("b736f332$RemoveChangeReason",B);var V=function(){function e(e){this._changes=null,this._activityManager=null,this._changes=new W.u(W.u.$$(H)),this._activityManager=e}return e.prototype.get_WetChanges=function(){return this._changes},e.prototype.KeyFromNode=function(e){return e.get_id().toString()},e.prototype.addChange=function(e){if(!e)return v.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;var t=e.get_wordId(),n=e.get_textId();return this._changes.containsKey(t)||this._changes.add(t,new W.u(H)),this._changes.get_item(t).set_item(n,e),!this.CycleExistsStartingAt(t,n)||(v.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",t),this._changes.get_item(t).remove(n),!1)},e.prototype.getNextChangeForPara=function(e,t){if(!this._changes.containsKey(e))return null;var n=this._changes.get_item(e);return n.containsKey(t)?n.get_item(t):null},e.prototype.getOperationsWhere=function(e){for(var t=new k.c(H),n=this._changes.get_keys().$$ge();n.$$mn();)for(var r=n.$$cu(),i=this._changes.get_item(r),o=i.get_keys().$$ge();o.$$mn();){var a=o.$$cu(),s=i.get_item(a);e(s)&&t.add(s)}return t},e.prototype.getOperationsBeforeTextID=function(e,t){var n=new k.c(H);if(!this._changes.containsKey(e))return n;for(var r=this._changes.get_item(e),i=new W.u(Number),o=r.get_values().$$ge();o.$$mn();){var a=o.$$cu(),s=a.get_textId(),l=a.get_textIdNew();i.set_item(l,s)}new k.c(Number);for(var u=t;i.containsKey(u);)u=i.get_item(u),n.add(r.get_item(u));return n},e.prototype.RemoveOp=function(e,t){var n=null;this._changes.tryGetValue(e.get_wordId(),(0,E.m)((function(){return n}),(function(e){return n=e})))?(e.get_activity().onChangeRemoved(B[t]),n.remove(e.get_textId()),n.get_count()||this._changes.remove(e.get_wordId())):v.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",e.get_wordId(),t)},e.prototype.removeDriedOp=function(e){this.RemoveOp(e,1)},e.prototype.removeExpiredOp=function(e){this.RemoveOp(e,0)},e.prototype.CycleExistsStartingAt=function(e,t){if(!this._changes.containsKey(e))return!1;var n=this._changes.get_item(e);if(!n.containsKey(t))return!1;for(var r=n.get_item(t);r;){var i=r.get_textIdNew();if(i===t)return!0;if(!n.containsKey(i))return!1;r=n.get_item(i)}return!1},e}();(0,r.l)(V,"625d452b$RttDataStore",null,[$,G]);var j=n(4455),q=n(2506),z=n(1308),K=n(5934),Q=n(8049),Z=n(3932),J=n(1783),X=n(9802),Y=function(){function e(e,t){if(this._operation=null,this._graph=null,this._operation=e,this._graph=t,t){var n=this._graph.getSpecificEventHandlers(12);n.add_onConnected(r.i(this,this.OnGraphNodeConnected,"OnGraphNodeConnected")),n.add_onDisconnected(r.i(this,this.OnGraphNodeDisconnected,"OnGraphNodeDisconnected")),n.add_onPropertyChanged(r.i(this,this.OnGraphPropertyChanged,"OnGraphPropertyChanged"))}}return e.prototype.dispose=function(){if(this._graph){var e=this._graph.getSpecificEventHandlers(12);e.remove_onConnected(r.i(this,this.OnGraphNodeConnected,"OnGraphNodeConnected")),e.remove_onDisconnected(r.i(this,this.OnGraphNodeDisconnected,"OnGraphNodeDisconnected")),e.remove_onPropertyChanged(r.i(this,this.OnGraphPropertyChanged,"OnGraphPropertyChanged"))}},e.prototype.OnGraphNodeConnected=function(t,n){4!==this._operation.get_opType()?v.ULS.shipAssertTag(9204867,355,!1,e._error):v.ULS.shipAssertTag(9204866,355,12===n.get_node().get_type()||11===n.get_node().get_type(),e._error)},e.prototype.OnGraphNodeDisconnected=function(t,n){v.ULS.shipAssertTag(9204868,355,!1,e._error)},e.prototype.OnGraphPropertyChanged=function(t,n){v.ULS.shipAssertTag(9204869,355,!1,e._error)},e._error="Unexpected graph modification detected during RTT edit",e}();(0,r.l)(Y,"2105c982$GraphChangeValidator",null,[Sys.IDisposable]);var ee=(0,r.y)("6cfaecec$IRttOpValidator"),te=function(){function e(e,t,n,r){this.$$pf_Id=null,this.$$pf_CpBegin=0,this.$$pf_CpEnd=0,this.$$pf_CharacterDataToValidate=null,this.set_id(e),this.set_cpBegin(t),this.set_cpEnd(n),this.set_characterDataToValidate(r)}return e.prototype.get_id=function(){return this.$$pf_Id},e.prototype.set_id=function(e){return this.$$pf_Id=e,e},e.prototype.get_cpBegin=function(){return this.$$pf_CpBegin},e.prototype.set_cpBegin=function(e){return this.$$pf_CpBegin=e,e},e.prototype.get_cpEnd=function(){return this.$$pf_CpEnd},e.prototype.set_cpEnd=function(e){return this.$$pf_CpEnd=e,e},e.prototype.get_characterDataToValidate=function(){return this.$$pf_CharacterDataToValidate},e.prototype.set_characterDataToValidate=function(e){return this.$$pf_CharacterDataToValidate=e,e},e.prototype.validateCurrentState=function(e){var t=this.get_id()===e.get_id();t&&(t=this.get_characterDataToValidate().replace("\xa0"," ")===e.get_characterData().substr(this.get_cpBegin(),this.get_cpEnd()-this.get_cpBegin()).replace("\xa0"," "));return t},e}();(0,r.l)(te,"2b029ea5$RttOpValidator",null,[ee]);var ne=function(){function e(){}return e.getRttOpValidatorForReplaceRangeOp=function(e,t){var n=e.get_node().get_characterData(),r=e.get_cpBegin()>=10?e.get_cpBegin()-10:0,i=e.get_cpEnd()+10<=n.length?e.get_cpEnd()+10:n.length,o=n.substr(r,e.get_cpBegin()-r),a=n.substr(e.get_cpEnd(),i-e.get_cpEnd());i=i+t.get_textAdded().length-(e.get_cpEnd()-e.get_cpBegin());var s=o+t.get_textAdded()+a;return new te(e.get_node().get_id(),r,i,s)},e}();(0,r.l)(ne,"d2bc2751$RttOpValidatorFactory",null,[]);var re=n(3545),ie=(0,r.y)("87ea39b2$IRttOp"),oe=function(){function e(e,t){this.$$pf_OpType=0,this.$$pf_Metadata=null,this.$$pf_Activity=null,this.$$pf_Validator=null,this.$$pf_AppliedOp=null,this.set_opType(e),this.set_metadata(t)}return e.prototype.get_opType=function(){return this.$$pf_OpType},e.prototype.set_opType=function(e){return this.$$pf_OpType=e,e},e.prototype.get_metadata=function(){return this.$$pf_Metadata},e.prototype.set_metadata=function(e){return this.$$pf_Metadata=e,e},e.prototype.get_activity=function(){return this.$$pf_Activity},e.prototype.set_activity=function(e){return this.$$pf_Activity=e,e},e.prototype.get_validator=function(){return this.$$pf_Validator},e.prototype.set_validator=function(e){return this.$$pf_Validator=e,e},e.prototype.get_appliedOp=function(){return this.$$pf_AppliedOp},e.prototype.set_appliedOp=function(e){return this.$$pf_AppliedOp=e,e},e.prototype.getTextOffsetStringToPrintOnValidationFailure=function(){return""},e.prototype.serialize=function(){return null},e}();(0,r.l)(oe,"eb38ec3b$RttOp",null,[ie]);var ae=n(3996),se=function(e){function t(t,n,r,i,o,a,s,l,u){var c=this;return c.wordId=0,c.textId=0,c.offsetStart=null,c.offsetEnd=null,c.textIdNew=0,c.textAdded=null,c.documentKind=0,(c=e.call(this,u,l)||this).wordId=t,c.textId=n,c.offsetStart=r,c.offsetEnd=i,c.textIdNew=o,c.textAdded=a,c.documentKind=s,c}return(0,re.t)(t,e),t.prototype.get_wordId=function(){return this.wordId},t.prototype.get_textId=function(){return this.textId},t.prototype.get_offsetStart=function(){return this.offsetStart},t.prototype.get_offsetEnd=function(){return this.offsetEnd},t.prototype.get_textIdNew=function(){return this.textIdNew},t.prototype.get_textAdded=function(){return this.textAdded},t.prototype.get_documentKind=function(){return this.documentKind},t.prototype.createSerializableAnchor=function(){return this.get_offsetStart().isEqual(this.get_offsetEnd(),!0)?new ae.e(0,this.get_wordId(),this.get_textId(),this.get_offsetStart(),null,null,null,this.get_documentKind(),0):new ae.e(1,this.get_wordId(),this.get_textId(),this.get_offsetStart(),this.get_wordId(),this.get_textId(),this.get_offsetEnd(),this.get_documentKind(),0)},t.tryCreate=function(e,t,n,r,i){var o=e.anchorObject;return 1!==o.rangeKind||o.paraIdStart===o.paraIdEnd&&o.textIdStart===o.textIdEnd?o.documentKind?(t.val=n.val=null,r.val=i.val=-1,!1):(t.val=o.offsetStart,n.val=t.val,1===o.rangeKind&&(n.val=o.offsetEnd),r.val=o.paraIdStart,i.val=o.textIdStart,!0):(v.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),t.val=n.val=null,r.val=i.val=-1,!1)},t}(oe);(0,r.l)(se,"2b26cb48$RttReplaceRangeOp",oe,[]);var le=n(7154),ue=n(1860),ce=function(){function e(e,t,n,r,i,o){this.packetId=0,this.clientId=null,this.clientType=0,this.timeReceived=0,this.packetVersion=0,this.strictlySequentialId=null,this.packetId=e,this.clientId=t,this.clientType=n,this.timeReceived=r,this.packetVersion=i,this.strictlySequentialId=o}return e.create=function(t){var n=null;return null!=t.strictlySequentialId&&(n=t.strictlySequentialId),new e(t.packetId,t.clientId,t.client,Date.now(),t.version,n)},e}();(0,r.l)(ce,"90a31616$RttOpMetadata",null,[]);var de=function(e){function t(t,n,r,i,o,a,s,l,u){var c=this;return c.$$pf_WordId=0,c.$$pf_TextId=0,c.$$pf_TextIdNew=0,c.offset=null,c.documentKind=0,c.wordIdAfterAbove=0,c.textIdAfterAbove=0,c.wordIdAfterBelow=0,c.textIdAfterBelow=0,(c=e.call(this,4,u)||this).set_wordId(t),c.set_textId(n),c.offset=r,c.documentKind=i,c.wordIdAfterAbove=o,c.textIdAfterAbove=a,c.wordIdAfterBelow=s,c.textIdAfterBelow=l,c.wordIdAfterAbove===c.get_wordId()?c.set_textIdNew(c.textIdAfterAbove):c.wordIdAfterBelow===c.get_wordId()?c.set_textIdNew(c.textIdAfterBelow):(v.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),c.set_textIdNew(0)),c}return(0,re.t)(t,e),t.prototype.get_wordId=function(){return this.$$pf_WordId},t.prototype.set_wordId=function(e){return this.$$pf_WordId=e,e},t.prototype.get_textId=function(){return this.$$pf_TextId},t.prototype.set_textId=function(e){return this.$$pf_TextId=e,e},t.prototype.get_textIdNew=function(){return this.$$pf_TextIdNew},t.prototype.set_textIdNew=function(e){return this.$$pf_TextIdNew=e,e},t.prototype.createNewParagraphAbove=function(){return this.get_wordId()===this.wordIdAfterBelow},t.prototype.get_textIdAfterSource=function(){return this.get_textIdNew()},t.prototype.get_wordIdCreated=function(){return this.createNewParagraphAbove()?this.wordIdAfterAbove:this.wordIdAfterBelow},t.prototype.get_textIdCreated=function(){return this.createNewParagraphAbove()?this.textIdAfterAbove:this.textIdAfterBelow},t.prototype.serialize=function(){var e=new ae.e(3,this.get_wordId(),this.get_textId(),this.offset,null,null,null,this.documentKind,0),t=new ue.m(this.wordIdAfterAbove,this.textIdAfterAbove,this.wordIdAfterBelow,this.textIdAfterBelow);return new le.k(this.get_metadata().packetId,this.get_metadata().clientId,1,4,e,null,null,null,null,null,t,null,0,this.get_metadata().strictlySequentialId)},t.ValidateAndCreate=function(e){return e?4!==e.operationType?(v.ULS.sendTraceTag(8397768,355,15,"RTT packet is of unexpected operationType {0}",e.operationType),null):t.Create(e):null},t.Create=function(e){var n=e.anchorObject,r=e.splitParaData;return new t(n.paraIdStart,n.textIdStart,n.offsetStart,n.documentKind,r.paraIdAboveSplit,r.textIdAboveSplit,r.paraIdBelowSplit,r.textIdBelowSplit,ce.create(e))},t.getRttSplitParagraphOpToSend=function(e,n,r){if(1!==e.get_type())return null;var i=e,o=r.paragraphNodePropsOnGraphNode(i.get_oldParaState().get_characterData(),i.get_oldParaState().get_characterProperties());return new t(i.get_oldParaState().get_wordId(),i.get_oldParaState().get_textId(),r.wordTextOffsetFromCp(o,i.get_splitAtCp()),i.get_documentKind(),i.get_aboveParaState().get_wordId(),i.get_aboveParaState().get_textId(),i.get_belowParaState().get_wordId(),i.get_belowParaState().get_textId(),n)},t}(oe);(0,r.l)(de,"12c6f747$RttSplitParagraphOp",oe,[H,ie]);var pe=function(){function e(e,t,n,r){this._chpEditor=null,this._oeEditor=null,this._graphTxnFactory=null,this._textOffsetTranslator=null,this._chpEditor=e,this._oeEditor=t,this._graphTxnFactory=n,this._textOffsetTranslator=r}return e.prototype.applyOneWetChange=function(t,n,r,i){if(n.get_isDirty())return i&&i.get_properties().set_item(e.ParagraphAlreadyDirtyProperty,"1"),!1;var o=new Y(t,n.get_containingGraph());try{if(1!==t.get_opType()&&6!==t.get_opType())return 4===t.get_opType()&&this.ApplyOneSplitParagraphChange(t,n,r);var a=(0,R.e)(se,t),s=this.ContextFromReplaceRangeOp(a,n),l=ne.getRttOpValidatorForReplaceRangeOp(s,a),u=6===a.get_opType(),c="";if(u&&(c=a.get_font()),!this.ReplaceContextWithWetChange(s,a.get_textAdded(),u,c,i))return!1;var d=void 0;d=1===t.get_opType()?new x(a,n.get_id()):new U(a,n.get_id()),n.set_effectiveTextId(t.get_textIdNew()),a.set_validator(l),t.set_appliedOp(d),r.onOperationApplied(d)}finally{o&&o.dispose()}return!0},e.prototype.ApplyOneSplitParagraphChange=function(e,t,n){var r=(0,R.e)(de,e),i=this._textOffsetTranslator.paragraphNodePropsOnGraphNode(t.get_characterData(),t.get_characterProperties()),o=this._textOffsetTranslator.cpFromWordTextOffset(i,r.offset);if(!this.IsSafeToDeleteContext(J.y.createTextRange(t,0,K.ParagraphReader.textLength(t))))return!1;var a,s=X.g.createFromNode(t);if(s.tryToRootAtAncestorOfType(10),this.isParagraphInList(s))return!1;var l=this._graphTxnFactory.getTransaction(3,0);try{l.setFromNode(t);var u=t.suspendAutoCoreInvalidations();try{var c=X.g.createFromNode(t);c.tryToRootAtAncestorOfType(10),c.returnToAncestorOfType(11);var d=c.get_currentNode();r.createNewParagraphAbove()&&(c.get_isFirstSibling()?d=null:(c.goToPreviousSibling(),d=c.get_currentNode())),c.returnToParent();var p=this._oeEditor.createOutlineElementNode();c.insertChild(p,d,59),c.goToChild(p);var g=(a=t.clone()).suspendAutoCoreInvalidations();try{a.setValue(q.j.wordId,r.get_wordIdCreated()),a.setValue(q.j.textId,r.get_textIdCreated()),a.set_isDirty(!1),c.addChild(a,2),c.goToChild(a),this.CopyParagraphNodeChps(t,a);var h=r.createNewParagraphAbove()?a:t,_=r.createNewParagraphAbove()?t:a;h.set_containsWetChanges(!0),_.set_containsWetChanges(!0),this._chpEditor.replaceRangeWithWetChange(this.CreateContext(h,o,K.ParagraphReader.textLength(h)),"",!1,""),this._chpEditor.replaceRangeWithWetChange(this.CreateContext(_,0,o),"",!1,""),t.set_effectiveTextId(r.get_textIdAfterSource()),a.set_effectiveTextId(r.get_textIdCreated())}finally{g&&g.dispose()}}finally{u&&u.dispose()}l.setAllViewsToUpdate()}finally{l&&l.dispose()}var f=new L(r,t.get_id(),a.get_id());return e.set_appliedOp(f),n.onOperationApplied(f),!0},e.prototype.isParagraphInList=function(e){var t=new X.g;return t.setFrom(e),t.returnToAncestorOfType(11),!!Z.ListReader.isListOutlineElement(t)&&(v.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0)},e.prototype.findLocationForAddParagraphOp=function(e,t,n){var r=t.getParagraphNodeByWordId(e.wordId);if(r.equals(z.h.get_nil()))return null;var i=n.getObject(r);if(!i||!K.ParagraphReader.isParagraphNode(i))return null;var o=i;if(!o.get_isConnected())return null;var a=X.g.createFromNode(o);if(!a.tryToRootAtAncestorOfType(23))return null;if(e.wordIdAfter){var s=t.getParagraphNodeByWordId(e.wordIdAfter);if(s.equals(z.h.get_nil()))return null;var l=n.getObject(s);if(!l||!K.ParagraphReader.isParagraphNode(l))return null;var u=l;if(!u.get_isConnected())return null;var c=X.g.createFromNode(u);if(!c.tryToRootAtAncestorOfType(23))return null;if(c.returnToAncestorOfType(11),c.goToPreviousSibling(),c.goToFirstChild(),c.get_currentNode()!==o)return null}return this.isParagraphInList(a)?null:a},e.prototype.tryApplyAddParagraphOp=function(e,t,n,r){var i=t.get_currentNode(),o=this._graphTxnFactory.getTransaction(3,0);try{o.setFromNode(i),t.returnToAncestorOfType(11);var a=t.get_currentNode();t.returnToParent();var s=this._oeEditor.createOutlineElementNode();t.insertChild(s,a,59),t.goToChild(s);var l=Q.c.get_instance().createInstance(393230),u=l.suspendAutoCoreInvalidations();try{l.setValue(j.b.richEditTextUnicode,""),l.isDeserializing=!0,r.removeContent(l);var c=[0];l.setValue(q.j.runIds,c),l.setValue(q.j.paraIds,c),l.isDeserializing=!1,l.setValue(q.j.wordId,e.newParaWordId),l.setValue(q.j.textId,e.newParaTextId),l.set_isDirty(!1),t.addChild(l,2),l.set_containsWetChanges(!0),l.set_effectiveTextId(e.newParaTextId)}finally{u&&u.dispose()}o.setAllViewsToUpdate(),e.set_appliedOp(new O(e,l.get_id())),n.onOperationApplied(e.get_appliedOp())}finally{o&&o.dispose()}return!0},e.prototype.CreateContext=function(e,t,n){return t===n?J.y.createIpContext(e,t):J.y.createTextRange(e,t,n)},e.prototype.ReplaceContextWithWetChange=function(t,n,r,i,o){var a=t.get_node();if(t.get_cpBegin()!==t.get_cpEnd()&&!this.IsSafeToDeleteContext(t))return o&&o.get_properties().set_item(e.UnsafeWetChangeProperty,"1"),!1;var s=this._graphTxnFactory.getTransaction(3,0);try{s.setFromNode(a);var l=a.suspendAutoCoreInvalidations();try{a.set_containsWetChanges(!0),this._chpEditor.replaceRangeWithWetChange(t,n,r,i)}finally{l&&l.dispose()}s.setAllViewsToUpdate()}finally{s&&s.dispose()}return!0},e.prototype.CopyParagraphNodeChps=function(e,t){t.isDeserializing=!0,t.set_characterData(e.get_characterData()),t.set_effectiveTextId(e.get_effectiveTextId()),t.get_characterProperties().clear();for(var n=0;n<e.get_characterProperties().get_length();n++){var r=e.get_characterProperties().get_item(n).cloneUnderDifferentParagraph(t,null);t.get_characterProperties().add(r)}if(t.updateRunIndices(),t.get_wordRunProperties().get_length())for(n=0;n<t.get_characterProperties().get_length();n++){var i=t.get_characterProperties().get_item(n).get_formatting();if(i&&-1!==i.runIndex)for(;t.get_wordRunProperties().get_length()<=i.runIndex;)t.get_wordRunProperties().insertDuplicateAfter(t.get_wordRunProperties().get_length()-1,256,1)}else v.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");t.isDeserializing=!1},e.prototype.IsWetCreatedParagraphNode=function(e,t){return t.val=X.g.createFromNode(e),t.val.tryToRootAtAncestorOfType(23),t.val.returnToParent(),59===t.val.get_role()},e.prototype.RemoveWetOutlineElement=function(e){var t=new X.g;t.setFrom(e),t.returnToParent();var n=this._graphTxnFactory.getTransaction(3,0);try{n.setFromNode(t.get_currentNode()),e.disconnectNodeAndReturnToParent()}finally{n&&n.dispose()}},e.prototype.removeAndReloadWetChangesInParagraph=function(e){var t;if(e.get_anchor())if(this.IsWetCreatedParagraphNode(e,(0,E.m)((function(){return t}),(function(e){return t=e}))))this.RemoveWetOutlineElement(t);else{var n=e.get_containingObjectSpace().get_currentRevision(),r=this._graphTxnFactory.getTransaction(3,0);try{r.setFromNode(e),e.load(n.getObject(e.get_id())),e.get_anchor().invalidateViewChannelForAllViews(4)}finally{r&&r.dispose()}}},e.prototype.revertOperationSideEffects=function(e,t,n){for(var r=function(r){var o=t.get_item(r);switch(o.get_opType()){case 1:case 6:break;case 4:var a=(0,R.e)(L,o);if(!e.get_id().equals(a.sourceParagraphId))return v.ULS.shipAssertTag(9204885,355,e.get_id().equals(a.createdParagraphId),null),"continue";var s=n.getObject(a.createdParagraphId);if(!s)break;var l,u=s;if(!u||!K.ParagraphReader.isParagraphNode(u)){v.ULS.shipAssertTag(9204886,355,!1,null);break}if(!u.get_isConnected())return"continue";var c=i.IsWetCreatedParagraphNode(u,(0,E.m)((function(){return l}),(function(e){return l=e})));v.ULS.shipAssertTag(9204887,355,c,null),c&&i.RemoveWetOutlineElement(l);break;case 2:var d,p=(0,R.e)(O,o);if(!e.get_id().equals(p.paragraphId))return v.ULS.shipAssertTag(16820001,355,!1,null),"continue";if(!e.get_isConnected())return"continue";c=i.IsWetCreatedParagraphNode(e,(0,E.m)((function(){return d}),(function(e){return d=e})));v.ULS.shipAssertTag(16820002,355,c,null),c&&i.RemoveWetOutlineElement(d)}},i=this,o=t.get_count()-1;o>=0;o--)r(o)},e.prototype.ContextFromReplaceRangeOp=function(e,t){var n=this._textOffsetTranslator.paragraphNodePropsOnGraphNode(t.get_characterData(),t.get_characterProperties()),r=this._textOffsetTranslator.cpFromWordTextOffset(n,e.get_offsetStart()),i=this._textOffsetTranslator.cpFromWordTextOffset(n,e.get_offsetEnd());return r===i?J.y.createIpContext(t,r):J.y.createTextRange(t,r,i)},e.prototype.IsSafeToDeleteContext=function(e){for(var t="Rejected unsafe wet change: range contains ",n=e.get_node().get_characterProperties(),r=e.get_cpBegin(),i=e.get_cpEnd(),o=0;o<n.get_length();o++){var a=n.get_item(o);if(a.get_cp()>=i)break;if(a.get_cp()>=r){if(a.get_commentRangeObjects())return v.ULS.sendTraceTag(8242647,355,15,t+"comment"),!1;if(a.get_blob())return v.ULS.sendTraceTag(8242648,355,15,t+"blob"),!1;if(a.get_fieldMarkerObjects()||a.get_isStartOfField()||a.get_isEndOfField())return v.ULS.sendTraceTag(8242649,355,15,t+"field"),!1}}return!0},e.ParagraphAlreadyDirtyProperty="ParagraphAlreadyDirty",e.UnsafeWetChangeProperty="UnsafeWetChange",e}();(0,r.l)(pe,"37351a65$RttEditor",null,[i]);var ge=n(5500),he=n(1664),_e=n(9320),fe=n(1658),me=n(3517),ye=n(9154),ve=n(5516),Se=n(7711),Ie=n(2879),Ce=n(6382),Te=n(3127),be=n(7664),Ae=n(5669),Me=function(e){function t(t,n,r,i,o,a,s,l){var u=this;return u.wordId=0,u.textId=0,u.textIdNew=0,u.wordIdAfter=null,u.newParaWordId=0,u.newParaTextId=0,u.documentKind=0,(u=e.call(this,2,l)||this).wordId=t,u.textId=n,u.textIdNew=r,u.wordIdAfter=i,u.newParaWordId=o,u.newParaTextId=a,u.documentKind=s,u}return(0,re.t)(t,e),t.prototype.serialize=function(){var e=new ae.e(2,this.wordId,this.textId,null,this.wordIdAfter,null,null,this.documentKind,0),t=new Ae.c(this.textIdNew,this.newParaWordId,this.newParaTextId);return new le.k(this.get_metadata().packetId,this.get_metadata().clientId,1,3,e,null,null,null,t,null,null,null,0,this.get_metadata().strictlySequentialId)},t.ValidateAndCreate=function(e){return e?3!==e.operationType?(v.ULS.sendTraceTag(8258715,355,15,"RTT packet is of unexpected operationType {0}",e.operationType),null):t.Create(e):null},t.Create=function(e){var n=e.anchorObject,r=e.addParaData,i=null;return null!=e.anchorObject.paraIdEnd&&(i=e.anchorObject.paraIdEnd),new t(n.paraIdStart,n.textIdStart,r.textIdFinalAbove,i,r.paraIdNew,r.textIdNew,n.documentKind,ce.create(e))},t.getRttAddParagraphOpToSend=function(e,n){if(3!==e.get_type())return null;var r=e;return new t(r.get_oldAboveParaState().get_wordId(),r.get_oldAboveParaState().get_textId(),r.get_newAboveParaState().get_textId(),r.get_oldBelowParaState()?r.get_oldBelowParaState().get_wordId():null,r.get_newParaState().get_wordId(),r.get_newParaState().get_textId(),r.get_documentKind(),n)},t}(oe);(0,r.l)(Me,"812047f4$RttAddParagraphOp",oe,[]);var Pe=function(){function e(){this._addParaOps=null,this._addParaOps=new k.c(Me)}return e.prototype.add=function(e){return this._addParaOps.add(e),!0},e.prototype.getOperationsWhere=function(e){for(var t=new k.c(Me),n=this._addParaOps.$$lge();n.$$mn();){var r=n.$$cu();e(r)&&t.add(r)}return t},e.prototype.removeDriedOp=function(e){e.get_activity().onChangeRemoved("dried"),this._addParaOps.remove(e)},e.prototype.removeExpiredOp=function(e){e.get_activity().onChangeRemoved("expired"),this._addParaOps.remove(e)},e}();(0,r.l)(Pe,"bab598e4$RttAddParagraphDataStore",null,[]);var Fe,we=function(){function e(e){this._activity=null,this._activity=e}return e.prototype.recordInitialParaIDNotFound=function(){this._activity&&this._activity.get_properties().set_item(e.FailedToFindInitialParaIDProperty,"1")},e.prototype.recordInitialTextIDNotFound=function(){this._activity&&this._activity.get_properties().set_item(e.FailedToFindInitialTextIDProperty,"1")},e.prototype.recordChangeApplied=function(t){if(this._activity&&!this._activity.get_properties().containsKey(e.MsecUntilAppliedProperty)){var n=t-this._activity.get_startTime();this._activity.get_properties().set_item(e.MsecUntilAppliedProperty,n.toString())}},e.prototype.onChangeRemoved=function(t){this._activity&&(this._activity.get_properties().set_item(e.RemovedBecauseProperty,t),this._activity.end())},e.prototype.recordPacketVersion=function(t){this._activity&&this._activity.get_properties().set_item(e.PacketVersionsProperty,t.toString())},e.prototype.recordOpType=function(t){this._activity&&this._activity.get_properties().set_item(e.OperationTypeProperty,t)},e.initActivityAggregation=function(t){t.setAggregationMethod(ve.u.rttChangeLifetime,e.FailedToFindInitialParaIDProperty,Se.j.sumEntries),t.setAggregationMethod(ve.u.rttChangeLifetime,e.FailedToFindInitialTextIDProperty,Se.j.sumEntries),t.setAggregationMethod(ve.u.rttChangeLifetime,e.MsecUntilAppliedProperty,Se.j.averageEntries),t.setAggregationMethod(ve.u.rttChangeLifetime,e.RemovedBecauseProperty,Se.j.countEntryTypes),t.setAggregationMethod(ve.u.rttChangeLifetime,e.PacketVersionsProperty,Se.j.countEntryTypes),t.setAggregationMethod(ve.u.rttChangeLifetime,e.OperationTypeProperty,Se.j.countEntryTypes)},e.create=function(t){return t?new e(t.startActivity(ve.u.rttChangeLifetime,e.WetChangeActivityTimeout)):null},e.FailedToFindInitialParaIDProperty="FailedToFindInitialParaID",e.FailedToFindInitialTextIDProperty="FailedToFindInitialTextID",e.MsecUntilAppliedProperty="MsecUntilApplied",e.RemovedBecauseProperty="RemovedBecause",e.PacketVersionsProperty="PacketVersions",e.OperationTypeProperty="OperationType",e.WetChangeActivityTimeout=48e4,e}();(0,r.l)(we,"ba69b556$RttOpActivity",null,[]),function(e){e[e.unknown=0]="unknown",e[e.replaceTextRangeOp=1]="replaceTextRangeOp",e[e.addParagraphOp=2]="addParagraphOp",e[e.deleteParagraphOp=3]="deleteParagraphOp",e[e.splitParagraphOp=4]="splitParagraphOp",e[e.mergeParagraphOp=5]="mergeParagraphOp",e[e.replaceSymbolRangeOp=6]="replaceSymbolRangeOp"}(Fe||(Fe={})),(0,r.h)("b565e183$RttOpType",Fe);var Re=n(6378),Ee=n(2949),ke=function(e){function t(t,n,r,i,o,a,s,l,u,c,d){var p=this;return p.font=null,p.legacy=!1,p.surrogatePair=!1,(p=e.call(this,i,o,a,s,l,u,c,d,6)||this).font=t,p.legacy=n,p.surrogatePair=r,p}return(0,re.t)(t,e),t.prototype.get_font=function(){return this.font},t.prototype.get_legacy=function(){return this.legacy},t.prototype.get_surrogatePair=function(){return this.surrogatePair},t.prototype.getTextOffsetStringToPrintOnValidationFailure=function(){return"OffsetStart: "+this.get_offsetStart()+"OffsetEnd: "+this.get_offsetEnd()},t.prototype.serialize=function(){var e=this.createSerializableAnchor();return new le.k(this.get_metadata().packetId,this.get_metadata().clientId,1,7,e,null,this.get_textIdNew(),this.get_textAdded(),null,null,null,null,0,this.get_metadata().strictlySequentialId)},t.validateAndCreate=function(e){return e?7!==e.operationType?(v.ULS.sendTraceTag(8914771,355,50,"RTT packet was expected to be a symbol packet but was not {0}",e.operationType),null):t.create(e):null},t.create=function(e){var n,r,i,o,a,s;if(!se.tryCreate(e,(0,E.m)((function(){return n}),(function(e){return n=e})),(0,E.m)((function(){return r}),(function(e){return r=e})),(0,E.m)((function(){return i}),(function(e){return i=e})),(0,E.m)((function(){return o}),(function(e){return o=e}))))return null;if(1===e.text.length)a=!1,s=Ee.AParagraphNode.embeddedObjectText;else{if(2!==e.text.length)return v.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",e.operationType),null;if(!Re.l.isHighSurrogateCharAt(e.text,0)||!Re.l.isLowSurrogateCharAt(e.text,1))return v.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",e.operationType),null;a=!0,s=e.text}var l=e.symbolData,u=ce.create(e);return new t(l.symbolFont,l.symbolLegacy,a,i,o,n,r,e.textIdFinal,s,e.anchorObject.documentKind,u)},t}(se);(0,r.l)(ke,"182ba90e$RttReplaceSymbolRangeOp",se,[H,ie]);var De=function(e){function t(t,n,r,i,o,a,s,l){return e.call(this,t,n,r,i,o,a,s,l,1)||this}return(0,re.t)(t,e),t.prototype.getTextOffsetStringToPrintOnValidationFailure=function(){return"OffsetStart: "+this.get_offsetStart()+"OffsetEnd: "+this.get_offsetEnd()+"TextAddedLength: "+this.get_textAdded().length},t.prototype.serialize=function(){var e=this.createSerializableAnchor();return new le.k(this.get_metadata().packetId,this.get_metadata().clientId,1,2,e,null,this.get_textIdNew(),this.get_textAdded(),null,null,null,null,0,this.get_metadata().strictlySequentialId)},t.validateAndCreate=function(e){return e?2!==e.operationType?(v.ULS.sendTraceTag(8224768,355,50,"RTT packet is of unexpected operationType {0}",e.operationType),null):t.create(e):null},t.create=function(e){var n,r,i,o;if(!se.tryCreate(e,(0,E.m)((function(){return n}),(function(e){return n=e})),(0,E.m)((function(){return r}),(function(e){return r=e})),(0,E.m)((function(){return i}),(function(e){return i=e})),(0,E.m)((function(){return o}),(function(e){return o=e}))))return null;var a="";e.text&&(a=e.text);var s=ce.create(e);return new t(i,o,n,r,e.textIdFinal,a,e.anchorObject.documentKind,s)},t.getReplaceTextRangeChangeToSend=function(e,n,r){if(e.get_type())return null;var i=e,o=r.paragraphNodePropsOnGraphNode(i.get_oldParaState().get_characterData(),i.get_oldParaState().get_characterProperties());return new t(i.get_oldParaState().get_wordId(),i.get_oldParaState().get_textId(),r.wordTextOffsetFromCp(o,i.get_cpBegin()),r.wordTextOffsetFromCp(o,i.get_cpEnd()),i.get_newParaState().get_textId(),i.get_newText(),i.get_documentKind(),n)},t}(se);(0,r.l)(De,"c6f97ab5$RttReplaceTextRangeOp",se,[H,ie]);var Oe=function(){function e(t,n,r,i,o,a,s,l,u,c,d,p,g,h,_,f,m,y){this._rttEditor=null,this._dataStore=null,this._addParaDataStore=null,this._lockManagerLazy=null,this._lockReplicatorLazy=null,this._featureHelper=null,this._paragraphWordIdMapping=null,this._rtcTask=null,this._rtc=null,this._lazyObjectSpace=null,this._getCurrentTime=null,this._taskManager=null,this._wetChangeExpirationTaskInitialized=!1,this._textOffsetTranslator=null,this._activityManager=null,this._presenceManagerTask=null,this._graphTransactionFactory=null,this._appliedOpTracker=null,this._wordPresenceCpFactoryFuture=null,this._paraIdsWithUnAppliedWetChanges=null,this._isRenderRttTaskScheduled=!1,this._throttleAndBatchRttRendering=!1,this._sentMessageReceivedTag=!1,this._sentDeserializableMessageReceivedTag=!1,this._sentUsableMessagereceivedTag=!1,this._sentSuccessTag=!1,this._sentFailureTag=!1,this._rttEditor=t,this._dataStore=n,this._lockManagerLazy=r,this._lockReplicatorLazy=i,this._featureHelper=o,this._paragraphWordIdMapping=a,this._rtcTask=s,this._lazyObjectSpace=l,this._taskManager=u,this._getCurrentTime=c,this._textOffsetTranslator=d,this._activityManager=p,this._presenceManagerTask=h,this._graphTransactionFactory=_,this._throttleAndBatchRttRendering=f,this._appliedOpTracker=m,this._wordPresenceCpFactoryFuture=y,this._paraIdsWithUnAppliedWetChanges=new he.e(String,fe.b.get_ordinalIgnoreCase()),this._addParaDataStore=new Pe,g.execute(e.InitActivityAggregation)}return e.prototype.InitWetChangeExpirationTask=function(){var t=new Ie.c(3,2,e.RemoveStaleChangesTaskIntervalMs,r.i(this,this.ExpireWetChangesAndRender,"ExpireWetChangesAndRender"),0,null,!1);this._taskManager.addTask(t),this._wetChangeExpirationTaskInitialized=!0},e.prototype.Init=function(){return this._rtcTask?this._rtcTask.CW(r.i(this,this.OnRtcConnected,"OnRtcConnected")):me.Task.fromResult(Boolean,!1)},e.prototype.IsReceiveRealTimeTypingEnabled=function(){return this._featureHelper.isFeatureEnabled(128)&&this._featureHelper.isFeatureEnabled(102)},e.prototype.IsReceiveRealTimeParagraphsEnabled=function(){return this.IsReceiveRealTimeTypingEnabled()&&this._featureHelper.isFeatureEnabled(98)},e.prototype.OnRtcConnected=function(e){v.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager"),this._rtc=this._rtcTask.get_result(),v.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates"),this._rtc.add_updateNotificationReceived(r.i(this,this.OnUpdateNotificationReceived,"OnUpdateNotificationReceived"))},e.prototype.DeserializeRTTData=function(e){var t=Te.e.versionedDeserialize(e);if(!t)return null;switch(t.operationType){case 2:return De.create(t);case 7:return ke.create(t);case 4:return this.IsReceiveRealTimeParagraphsEnabled()?de.Create(t):null;case 3:return this.IsReceiveRealTimeParagraphsEnabled()?Me.Create(t):null;default:return v.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",t.operationType),null}},e.prototype.OnUpdateNotificationReceived=function(e,t){if(3===t.get_type()&&this.IsReceiveRealTimeTypingEnabled())if(!this._lockReplicatorLazy.get_value()||this._lockReplicatorLazy.get_value().get_hasLock())if(t.get_updateHint()){this.RecordRttMessageReceived();var n=this.DeserializeRTTData(t.get_updateHint());if(n&&1!==n.get_metadata().clientType)switch(this.RecordRttDeserializableMessageReceived(),this._wetChangeExpirationTaskInitialized||this.InitWetChangeExpirationTask(),n.get_opType()){case 1:case 6:case 4:var r;if(!this.AddChangeToStoreAndFindParaToApply(n,(0,E.m)((function(){return r}),(function(e){return r=e}))))return;this._throttleAndBatchRttRendering?this.ScheduleRttChangeForRendering(r):this.TryToApplyNewWetChange(r);break;case 2:this._addParaDataStore.add(n),this.InitOpActivity(n),this._throttleAndBatchRttRendering?this.ScheduleRttChangeForRendering(z.h.get_nil()):this.TryToApplyNewWetAddParagraphChange(n)}}else v.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty");else v.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release")},e.prototype.AddChangeToStoreAndFindParaToApply=function(e,t){if(t.val=z.h.get_nil(),!this._dataStore.addChange(e))return!1;if(this.InitOpActivity(e),!this._paragraphWordIdMapping)return!1;var n=this._paragraphWordIdMapping.getParagraphNodeByWordId(e.get_wordId());return n.equals(z.h.get_nil())?(e.get_activity().recordInitialParaIDNotFound(),!1):this._lazyObjectSpace.get_value().getObject(n)?(this.RecordUsableMessageReceived(),t.val=n,!0):(e.get_activity().recordInitialParaIDNotFound(),!1)},e.prototype.ScheduleRttChangeForRendering=function(t){var n=this;if(t.equals(z.h.get_nil())||this._paraIdsWithUnAppliedWetChanges.add(t.toString()),!this._isRenderRttTaskScheduled){var r=new Ie.c(0,1,e.RttUpdateIntervalMs,(function(){n.TryToApplyNewWetChangeForAllAffectedParagraphs(),n._isRenderRttTaskScheduled=!1}),71,null,!1);this._taskManager.addTask(r),this._isRenderRttTaskScheduled=!0}},e.prototype.ScheduleAddParaWetChangeCleanup=function(e){var t=new Ie.c(0,1,0,e,71,null,!1);this._taskManager.addTask(t)},e.prototype.InitOpActivity=function(e){e.set_activity(we.create(this._activityManager)),e.get_activity().recordPacketVersion(e.get_metadata().packetVersion),e.get_activity().recordOpType(Fe[e.get_opType()])},e.prototype.TryToApplyNewWetChangeForAllAffectedParagraphs=function(){for(var e=this._addParaDataStore.getOperationsWhere((function(e){return!e.get_appliedOp()})).$$lge();e.$$mn();){var t=e.$$cu();this.TryToApplyNewWetAddParagraphChange(t)}if(this._paraIdsWithUnAppliedWetChanges.get_count()){for(var n=null,r=this._paraIdsWithUnAppliedWetChanges.getEnumerator();r.$$mn();){var i=r.$$cu(),o=z.h.createFromString(i);n=this._lazyObjectSpace.get_value().getObject(o);break}var a=this._graphTransactionFactory.getTransaction(3,0);try{a.setFromNode(n);for(var s=this._paraIdsWithUnAppliedWetChanges.getEnumerator();s.$$mn();){i=s.$$cu();this.TryToApplyNewWetChange(z.h.createFromString(i))}}finally{a&&a.dispose()}this._paraIdsWithUnAppliedWetChanges.clear()}},e.prototype.TryToApplyNewWetChange=function(e){var t,n=this._lazyObjectSpace.get_value().getObject(e),r=this._graphTransactionFactory.getTransaction(3,0);try{r.setFromNode(n),t=this._activityManager.startActivity(ve.u.applyNewWetChanges,-1);var i=this.ApplyPendingWetChangesInternal(n,t);t.end(),i&&this.AddPresenceFromRttData(n,i)}finally{r&&r.dispose()}},e.prototype.TryToApplyNewWetAddParagraphChange=function(e){var t=this._rttEditor.findLocationForAddParagraphOp(e,this._paragraphWordIdMapping,this._lazyObjectSpace.get_value());if(t&&(this.RecordUsableMessageReceived(),this._rttEditor.tryApplyAddParagraphOp(e,t,this._appliedOpTracker,Ce.w.get_instance().resolve(ge.g)))){var n=e.get_appliedOp().paragraphId,r=this._lazyObjectSpace.get_value().getObject(n);this.ApplyWetChangeLock(r,e)}},e.prototype.AddPresenceFromRttData=function(e,t){var n=this;this._presenceManagerTask.CW((function(r){if(1===t.get_opType()){var i=t,o=n.GetPresenceDataToRenderFromRttData(e,i);o&&(n._presenceManagerTask.get_result().addOrUpdateUserPresence(o,!1),n._presenceManagerTask.get_result().renderAllAffectedParagraphs(!0))}}))},e.prototype.GetPresenceDataToRenderFromRttData=function(e,t){var n=t.serialize();if(2!==n.operationType)return null;if(n.anchorObject.paraIdEnd&&n.anchorObject.paraIdStart!==n.anchorObject.paraIdEnd)return null;var r=t.get_offsetStart().clone();return t.get_textAdded().length>0&&(r.clearSpecialChars(),r.cp=r.cp+t.get_textAdded().length),n.operationType=0,n.text=null,n.anchorObject.rangeKind=0,n.anchorObject.offsetStart=r,n.anchorObject.textIdStart=n.textIdFinal,n.anchorObject.paraIdEnd=null,n.anchorObject.textIdEnd=null,n.anchorObject.offsetEnd=null,n.textIdFinal=null,be.m.createFromRTTData(n,this._paragraphWordIdMapping,this._textOffsetTranslator,this._lazyObjectSpace.get_value(),this._wordPresenceCpFactoryFuture.get_instance())},e.prototype.ExpireWetChangesAndRender=function(t){var n=this._lazyObjectSpace.get_value();if(n){var r=this._getCurrentTime()-e.RemoveChangesOlderThanMs,i=this._dataStore.getOperationsWhere((function(e){return e.get_metadata().timeReceived<r}));i.get_count()>0&&this.RecordChangeExpired();for(var o=new _e.j,a=i.$$lge();a.$$mn();){var s=a.$$cu();if(this._dataStore.removeExpiredOp(s),s.get_appliedOp())switch(s.get_appliedOp().get_opType()){case 1:case 6:o.add(s.get_appliedOp().paragraphId.toString());break;case 4:o.add(s.get_appliedOp().sourceParagraphId.toString()),o.add(s.get_appliedOp().createdParagraphId.toString())}}for(var l=this._addParaDataStore.getOperationsWhere((function(e){return e.get_metadata().timeReceived<r})).$$lge();l.$$mn();){s=l.$$cu();this._addParaDataStore.removeExpiredOp(s),s.get_appliedOp()&&o.add(s.get_appliedOp().paragraphId.toString())}for(var u=o.getEnumerator();u.$$mn();){var c=u.$$cu(),d=n.getObject(z.h.createFromString(c));if(d)if(d.get_containsWetChanges()){if(this._rttEditor.removeAndReloadWetChangesInParagraph(d),!d.get_containsWetChanges()){this._lockManagerLazy.get_value().removeWetChangeLockForPara(d);d.getValueWithDefault(Number,ye.p.wetChangeLockId,0)}}else v.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes");else v.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}}else this._lazyObjectSpace.get_hasValue()&&v.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")},e.prototype.ApplyWetChangeLock=function(e,t){if(!this._lockManagerLazy.get_value())return v.ULS.shipAssertTag(7866378,355,!!this._lockManagerLazy.get_value(),"Unable to apply wet changes as LockManager unavailable"),!1;var n;return!!this._lockManagerLazy.get_value().acquireAndApplyWetChangeLock(e,t.get_metadata().clientId,(0,E.m)((function(){return n}),(function(e){return n=e})),!0)||(v.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1)},e.prototype.applyPendingWetChanges=function(e,t){this.ApplyPendingWetChangesInternal(e,t)},e.prototype.ApplyPendingWetChangesInternal=function(t,n){if(!t)return null;if(!t.get_anchor())return n&&n.get_properties().set_item(e.NodeNotConnectedProperty,"1"),null;if(!t.hasProperty(q.j.wordId))return v.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!t.hasProperty(q.j.textId))return v.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(t.hasProperty(q.j.disableRTTInParagraph)&&t.getValue(Boolean,q.j.disableRTTInParagraph))return v.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;var r=t.getValue(Number,q.j.wordId),i=t.get_effectiveTextId();n&&(n.get_properties().set_item(e.NodeTextIdProperty,i.toString()),n.get_properties().set_item(e.NodeWordIdProperty,r.toString()));var o=this._dataStore.getNextChangeForPara(r,i);if(!o)return n&&n.get_properties().set_item(e.NoChangesToApplyProperty,"1"),null;if(!this.ApplyWetChangeLock(t,o))return n&&n.get_properties().set_item(e.CouldNotGetLockProperty,"1"),null;for(var a=0,s=null;o;){if(!this._rttEditor.applyOneWetChange(o,t,this._appliedOpTracker,n)){n&&n.get_properties().set_item(e.WetChangeBlockedProperty,"1");break}a++,o.get_activity().recordChangeApplied(this._getCurrentTime()),s=o,i=t.get_effectiveTextId(),o=this._dataStore.getNextChangeForPara(r,i)}return a>0&&this.RecordChangeSuccessfullyApplied(),n&&n.get_properties().add(e.WetChangeCountProperty,a.toString()),s},e.prototype.removeDriedWetChangesAndReapplyPending=function(e){var t=this;if(this.IsReceiveRealTimeTypingEnabled()&&e.hasProperty(q.j.wordId)&&e.hasProperty(q.j.textId)){var n=e.getValue(Number,q.j.wordId),r=e.getValueWithDefault(Number,q.j.textId,0),i=this._activityManager.startActivity(ve.u.reloadExistingWetChanges,-1),o=this._appliedOpTracker.onGraphNodeReloaded(e.get_id());o.get_count()>0&&(this._rttEditor.revertOperationSideEffects(e,o,this._lazyObjectSpace.get_value()),this.RemoveDriedChanges(e,o,r));var a=this._appliedOpTracker.getAddParagraphOpByWordId(n);if(a&&!e.get_id().equals(a.paragraphId)){var s=this._lazyObjectSpace.get_value();this.ScheduleAddParaWetChangeCleanup((function(e){var n=t._appliedOpTracker.onGraphNodeDisconnected(a.paragraphId),r=s.getObject(a.paragraphId);v.ULS.shipAssertTag(16820032,355,!!r,"Could not find added graph node"),r&&(t._rttEditor.revertOperationSideEffects(r,n,s),t._addParaDataStore.removeDriedOp(a.addParaOperation))}))}this._dataStore.getNextChangeForPara(n,r)||this._lockManagerLazy.get_value().removeWetChangeLockForPara(e),this.applyPendingWetChanges(e,i),i.end()}},e.prototype.RemoveDriedChanges=function(e,t,n){for(var r=!1,i=t.get_count()-1;i>=0;i--){var o=t.get_item(i),a=null;switch(o.get_opType()){case 1:case 6:case 4:a=(0,R.e)(H,o.get_operation());break;default:continue}a.get_textIdNew()===n&&(r=!0,a.get_validator()&&!a.get_validator().validateCurrentState(e)&&v.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",a.get_opType(),a.getTextOffsetStringToPrintOnValidationFailure(),e.get_id(),a.get_validator().get_id(),a.get_validator().get_cpBegin(),a.get_validator().get_cpEnd())),r&&this._dataStore.removeDriedOp(a)}r&&this.RecordChangeSuccessfullyApplied()},e.prototype.onParagraphNodeDisconnected=function(e){var t=this._appliedOpTracker.onGraphNodeDisconnected(e.get_id());t.get_count()>0&&(2===t.get_item(0).get_opType()&&t.removeAt(0),this._rttEditor.revertOperationSideEffects(e,t,this._lazyObjectSpace.get_value()))},e.prototype.shouldBlockEnterInParagraph=function(e){for(var t=this._appliedOpTracker.getOperationsForPara(e.get_id()).$$lge();t.$$mn();){var n=t.$$cu();if(4===n.get_opType()){var r=(0,R.e)(L,n);if(e.get_id().equals(r.get_aboveParagraphId()))return!0}}return!1},e.prototype.RecordRttMessageReceived=function(){this._sentMessageReceivedTag||(v.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this._sentMessageReceivedTag=!0)},e.prototype.RecordRttDeserializableMessageReceived=function(){this._sentDeserializableMessageReceivedTag||(v.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this._sentDeserializableMessageReceivedTag=!0)},e.prototype.RecordUsableMessageReceived=function(){this._sentUsableMessagereceivedTag||(v.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this._sentUsableMessagereceivedTag=!0)},e.prototype.RecordChangeSuccessfullyApplied=function(){this._sentSuccessTag||(v.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this._sentSuccessTag=!0)},e.prototype.RecordChangeExpired=function(){this._sentSuccessTag||this._sentFailureTag||(v.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this._sentFailureTag=!0)},e.InitActivityAggregation=function(t){for(var n=0,r=[ve.u.applyNewWetChanges,ve.u.reloadExistingWetChanges];n<r.length;n++){var i=r[n];t.setAggregationMethod(i,e.WetChangeCountProperty,Se.j.countEntryTypes),t.setAggregationMethod(i,e.NoChangesToApplyProperty,Se.j.countEntryTypes),t.setAggregationMethod(i,e.NodeNotConnectedProperty,Se.j.countEntryTypes),t.setAggregationMethod(i,e.CouldNotGetLockProperty,Se.j.countEntryTypes),t.setAggregationMethod(i,e.WetChangeBlockedProperty,Se.j.countEntryTypes),t.setAggregationMethod(i,pe.ParagraphAlreadyDirtyProperty,Se.j.countEntryTypes),t.setAggregationMethod(i,pe.UnsafeWetChangeProperty,Se.j.countEntryTypes)}we.initActivityAggregation(t)},e.RemoveStaleChangesTaskIntervalMs=6e4,e.RemoveChangesOlderThanMs=18e4,e.WetChangeCountProperty="WetChangeCount",e.NoChangesToApplyProperty="NoChangesToApply",e.NodeNotConnectedProperty="NodeNotConnected",e.CouldNotGetLockProperty="CouldNotGetLock",e.WetChangeBlockedProperty="WetChangeBlocked",e.NodeWordIdProperty="NodeWordId",e.NodeTextIdProperty="NodeTextId",e.RttUpdateIntervalMs=200,e}();(0,r.l)(Oe,"cf8103f7$RttManager",null,[l.e]);var Ue=n(7437),xe=(0,r.y)("bf7bee7e$IRttSendDataStore"),Le=n(6878),Ne=function(){function e(){this._rttChangesToSend=null,this._rttChangesToSend=new Le.z(Ue.w)}return e.prototype.addRttChangeToSend=function(e,t){this._rttChangesToSend.back()&&t&&this._rttChangesToSend.back().coalesce(e)||this._rttChangesToSend.enqueue(e)},e.prototype.getNextChangeToSend=function(){return this._rttChangesToSend.get_isEmpty()?null:this._rttChangesToSend.dequeue()},e}();(0,r.l)(Ne,"101490f7$RttSendDataStore",null,[xe]);var Be=n(8361),He=n(8546),$e=n(9974),Ge=function(e){function t(t,n,r,i){var o=this;return o.$$pf_WordId=0,o.$$pf_TextId=0,o.documentKind=0,(o=e.call(this,3,i)||this).set_wordId(t),o.set_textId(n),o.documentKind=r,o}return(0,re.t)(t,e),t.prototype.get_wordId=function(){return this.$$pf_WordId},t.prototype.set_wordId=function(e){return this.$$pf_WordId=e,e},t.prototype.get_textId=function(){return this.$$pf_TextId},t.prototype.set_textId=function(e){return this.$$pf_TextId=e,e},t.prototype.get_textIdNew=function(){return 0},t.prototype.serialize=function(){var e=new ae.e(4,this.get_wordId(),this.get_textId(),null,null,null,null,this.documentKind,0);return new le.k(this.get_metadata().packetId,this.get_metadata().clientId,1,5,e,null,null,null,null,null,null,null,0,this.get_metadata().strictlySequentialId)},t.ValidateAndCreate=function(e){return e?5!==e.operationType?(v.ULS.sendTraceTag(8397763,355,15,"RTT packet is of unexpected operationType {0}",e.operationType),null):t.Create(e):null},t.Create=function(e){var n=e.anchorObject;return new t(n.paraIdStart,n.textIdStart,n.documentKind,ce.create(e))},t.getRttDeleteParagraphOpToSend=function(e,n){if(4!==e.get_type())return null;var r=e;return new t(r.get_deletedParaState().get_wordId(),r.get_deletedParaState().get_textId(),r.get_documentKind(),n)},t}(oe);(0,r.l)(Ge,"ec02bb0c$RttDeleteParagraphOp",oe,[H,ie]);var We=n(2259),Ve=function(e){function t(t,n,r,i,o,a,s,l){var u=this;return u.wordIdAbove=0,u.textIdAbove=0,u.wordIdBelow=0,u.textIdBelow=0,u.documentKind=0,u.wordIdMerged=0,u.textIdMerged=0,(u=e.call(this,5,l)||this).wordIdAbove=t,u.textIdAbove=n,u.wordIdBelow=r,u.textIdBelow=i,u.documentKind=o,u.wordIdMerged=a,u.textIdMerged=s,u}return(0,re.t)(t,e),t.prototype.get_wordId=function(){return this.wordIdAbove},t.prototype.get_textId=function(){return this.textIdAbove},t.prototype.get_textIdNew=function(){return this.wordIdAbove===this.wordIdMerged?this.textIdMerged:0},t.prototype.serialize=function(){var e=new ae.e(5,this.wordIdAbove,this.textIdAbove,null,this.wordIdBelow,this.textIdBelow,null,this.documentKind,0),t=new We.a(this.wordIdMerged,this.textIdMerged);return new le.k(this.get_metadata().packetId,this.get_metadata().clientId,1,6,e,null,null,null,null,t,null,null,0,this.get_metadata().strictlySequentialId)},t.ValidateAndCreate=function(e){return e?6!==e.operationType?(v.ULS.sendTraceTag(8397765,355,15,"RTT packet is of unexpected operationType {0}",e.operationType),null):t.Create(e):null},t.Create=function(e){var n=e.anchorObject,r=e.mergeRemoveParaData;return new t(n.paraIdStart,n.textIdStart,n.paraIdEnd,n.textIdEnd,n.documentKind,r.paraIdMerged,r.textIdMerged,ce.create(e))},t.getRttMergeParagraphOpToSend=function(e,n){if(2!==e.get_type())return null;var r=e;return new t(r.get_oldAboveParaState().get_wordId(),r.get_oldAboveParaState().get_textId(),r.get_oldBelowParaState().get_wordId(),r.get_oldBelowParaState().get_textId(),r.get_documentKind(),r.get_mergedParaState().get_wordId(),r.get_mergedParaState().get_textId(),n)},t}(oe);(0,r.l)(Ve,"b488afad$RttMergeParagraphOp",oe,[H,ie]);var je=function(){function e(e,t,n,r,i,o){this._rtcTask=null,this._rtcProxy=null,this._rttSendDataStore=null,this._lazyCoauthManager=null,this._workspace=null,this._wordTextOffsetTranslator=null,this._featureHelper=null,this._sendRttTask=null,this._isStarted=!1,this._totalMessagesSent=0,this._totalMessagesBlocked=0,this._usageTagLogged=!1,this._successTagLogged=!1,this._rtcSendCallCountBeforeSuccess=0,this._rtcTask=e,this._rttSendDataStore=t,this._lazyCoauthManager=n,this._workspace=r,this._wordTextOffsetTranslator=i,this._featureHelper=o}return e.prototype.get_CoauthManager=function(){return this._lazyCoauthManager.get_value()},e.prototype.Init=function(){return this._rtcTask?this._rtcTask.CW(r.i(this,this.OnRtcConnected,"OnRtcConnected")):me.Task.fromResult(Boolean,!1)},e.prototype.OnRtcConnected=function(e){v.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager"),this._rtcProxy=this._rtcTask.get_result(),this._rtcProxy.registerService(this)},e.prototype.start=function(){this._isStarted||(this.IsSendRealTimeTypingEnabled()&&this._workspace.get_activePage().get_graphTransactionOperations().add_persistenceTransactionCompleted(r.i(this,this.OnPersistenceTransactionCompleted,"OnPersistenceTransactionCompleted")),this._isStarted=!0)},e.prototype.stop=function(){this._isStarted=!1,this.IsSendRealTimeTypingEnabled()&&this._workspace.get_activePage().get_graphTransactionOperations().remove_persistenceTransactionCompleted(r.i(this,this.OnPersistenceTransactionCompleted,"OnPersistenceTransactionCompleted"))},e.prototype.IsSendRealTimeTypingEnabled=function(){return this._featureHelper.isFeatureEnabled(128)&&this._featureHelper.isFeatureEnabled(108)},e.prototype.IsSendRealTimeTypingForParaOpsEnabled=function(){return!!this.IsSendRealTimeTypingEnabled()&&this._featureHelper.isFeatureEnabled(99)},e.prototype.OnPersistenceTransactionCompleted=function(t,n){if(this._rtcProxy&&2===this._rtcProxy.get_connectionState()){var r=n.get_graphTransactionOperations();if(r.length)if(n.get_blockRttSend())this._totalMessagesBlocked<e.MaxUlsToUploadForBlockedMessages&&(this._totalMessagesBlocked++,v.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",n.get_blockRttSendReason(),this._totalMessagesSent,this._totalMessagesBlocked));else{for(var i=0;i<r.length;i++){var o=r[i];if(!this.IsValidGraphTransactionOperation(o))return}for(i=0;i<r.length;i++){var a=!(o=r[i]).get_type()&&!i;this._rttSendDataStore.addRttChangeToSend(o,a)}this._sendRttTask||this.OnOkToSendNextRttChange(this._sendRttTask,this._rtcProxy)}}},e.prototype.IsValidGraphTransactionOperation=function(e){return!!e&&(-1!==e.get_documentKind()&&(!e.get_type()||!(!this.IsSendRealTimeTypingForParaOpsEnabled()||3!==e.get_type()&&1!==e.get_type())))},e.prototype.LogSendUsageTag=function(){this._successTagLogged||(this._usageTagLogged||(v.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this._usageTagLogged=!0),!this._successTagLogged&&this._rtcSendCallCountBeforeSuccess<=e.MaxRtcSendCallCountBeforeSuccess&&this._rtcSendCallCountBeforeSuccess++)},e.prototype.LogSuccessTag=function(){!this._successTagLogged&&this._rtcSendCallCountBeforeSuccess<=e.MaxRtcSendCallCountBeforeSuccess&&(v.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this._successTagLogged=!0)},e.prototype.OnOkToSendNextRttChange=function(e,t){var n=this;this.LogSendUsageTag(),e&&(e.get_isFaulted()||e.get_isCanceled())&&v.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",e.get_exception());var r=this.GetRttOpFromGraphTransactionOperation(this._rttSendDataStore.getNextChangeToSend());r?(this._totalMessagesSent++,this._sendRttTask=t.sendUpdateNotification(3,Te.e.versionedSerialize(r.serialize()),!1),this.LogSuccessTag(),this._sendRttTask.CW((function(e){n.OnOkToSendNextRttChange(e,t)}))):this._sendRttTask=null},e.prototype.GetRttOpFromGraphTransactionOperation=function(e){if(!e)return null;if(!this.get_CoauthManager())return v.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;var t=new ce(He.k.get_instance().getNextPacketId(),this.get_CoauthManager().get_myId(),1,0,0,$e.q.get_instance().getNextPacketIdForRttOp()),n=null;switch(e.get_type()){case 0:n=De.getReplaceTextRangeChangeToSend(e,t,this._wordTextOffsetTranslator);break;case 4:n=Ge.getRttDeleteParagraphOpToSend(e,t);break;case 3:n=Me.getRttAddParagraphOpToSend(e,t);break;case 2:n=Ve.getRttMergeParagraphOpToSend(e,t);break;case 1:n=de.getRttSplitParagraphOpToSend(e,t,this._wordTextOffsetTranslator)}return n},e.MaxUlsToUploadForBlockedMessages=100,e.MaxRtcSendCallCountBeforeSuccess=5,e}();(0,r.l)(je,"5b5978ab$RttSendManager",null,[Be.r]);var qe=n(523);n.d(t,{WordEditorRealTimeTypingPackage:function(){return ze}});var ze=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"WordEditor.RealTimeTyping"},e.prototype.GetLockManager=function(){return b.App.get_theCoauthManager()&&b.App.get_theCoauthManager().get_theLockManager()?b.App.get_theCoauthManager().get_theLockManager():(v.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)},e.prototype.configure=function(e){var t=this;this._container=e;var n=new M.b;e.register(i).singleInstance().usingFactory((function(){return new pe(e.resolve(o.x),e.resolve(a.p),n,e.resolve(s.l))})),e.register(Oe).as(l.e).singleInstance().usingFactory((function(){return new Oe(e.resolve(i),new V(I.y.get_instance()),new y.q(A.z,r.i(t,t.GetLockManager,"GetLockManager")),new y.q(u.k,(function(){return b.App.theLockReplicator})),e.resolve(c.d),e.resolve(qe.h),e.resolve(d.q).getInstanceAsync(),new y.q(p.f,(function(){return b.App.get_activeAppFrame().workspace.get_activePage().get_contentObjectSpace()})),T.y.get_instance(),(function(){return Date.now()}),e.resolve(s.l),I.y.get_instance(),e.resolveFuture(g.s),P.o.getInstanceAsync(),n,S.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorThrottleAndBatchRTTRendering"),new N,e.resolveFuture(h.u))})),e.register(je).singleInstance().usingFactory((function(){return new je(e.resolve(d.q).getInstanceAsync(),new Ne,new y.q(_.g,(function(){return b.App.get_theCoauthManager()})),b.App.get_activeAppFrame().workspace,e.resolve(s.l),e.resolve(c.d))}))},e.prototype.init=function(){this._container.resolve(Oe).Init(),this._container.resolve(je).Init()},e.prototype.dispose=function(){},e.main=function(){C.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(ze,"1d1b37d1$WordEditorRealTimeTypingPackage",null,[f.u,m.s])},5031:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("fb2b23c4$IStringTable"),o=n(1822);n.d(t,{c:function(){return a}});var a=function(){function e(e){this.m_init=null,this.m_init=e}return e.prototype.get_numOfStrings=function(){return this.m_init.numOfStrings},e.prototype.get_supportsIdLookupGivenString=function(){return 4!==this.m_init.style},e.prototype.get_supportsStringLookupGivenId=function(){return!0},e.prototype.get_trie=function(){return this.m_init.trie},e.prototype.getId=function(e,t){if(!this.get_supportsIdLookupGivenString())throw Error.invalidOperation("ID lookup not supported on this string table");switch(this.m_init.style){case 0:return this.GetIdFromTrie(e,t);default:throw Error.notImplemented()}},e.prototype.getString=function(e){if(!this.get_supportsStringLookupGivenId())throw Error.invalidOperation("String lookup not supported on this string table");if(e<0||e>=this.get_numOfStrings())throw Error.argumentOutOfRange("id","Invalid string ID");switch(this.m_init.style){case 0:return this.GetStringFromTrie(e);case 4:return this.GetStringFromCharData(e);default:throw Error.notImplemented()}},e.prototype.GetIdFromTrie=function(e,t){var n=this.m_init.trie.lookUpString(e,0,e.length,t);if(!n.succeeded)return-1;if(n.trieId<0||n.trieId>=this.m_init.numOfStrings)throw Error.invalidOperation("Trie with invalid trie ID in StringTable");return this.m_init.trieId2StringTableId_StartIndex?this.m_init.rawBytes.readInt(this.m_init.trieId2StringTableId_StartIndex+4*n.trieId,4):n.trieId},e.prototype.GetStringFromTrie=function(e){if(this.m_init.trieId2StringTableId_StartIndex){for(var t=0;t<this.m_init.numOfStrings&&this.m_init.rawBytes.readInt(this.m_init.trieId2StringTableId_StartIndex+4*t,4)!==e;++t);if(t>=this.m_init.numOfStrings)throw Error.invalidOperation("Malformed TrieId2StringTableId in StringTable");return this.m_init.trie.getStringForTrieId(t)}return this.m_init.trie.getStringForTrieId(e)},e.prototype.GetStringFromCharData=function(e){var t=this.m_init.rawBytes.readInt(this.m_init.stringId2StringLength_StartIndex+4*e,4),n=this.m_init.rawBytes.readInt(this.m_init.stringId2StringStartIndex_StartIndex+4*e,4);if(n<0||t<0)throw Error.invalidOperation("Hash table string invalid byte range in StringTable");for(var r=new Array(t),i=0;i<t;++i)r[i]=this.ReadObfuscated7BitEncodedChar((0,o.m)((function(){return n}),(function(e){return n=e})));return String.fromCharCode.apply(null,r)},e.prototype.ReadObfuscated7BitEncodedChar=function(t){for(var n=0,r=0;r<3;++r){var i=this.m_init.rawBytes.get_item(this.m_init.charByteData_StartIndex+t.val)^e.c_xorKey;if(++t.val,n|=(i&e.c_lowBitsMaskForByte)<<7*r,!(i&e.c_highBitForByte))break}return n},e.c_xorKey=182,e.c_highBitForByte=128,e.c_lowBitsMaskForByte=127,e}();(0,r.l)(a,"95b9bdcd$StringTable",null,[i])},5083:function(e,t,n){"use strict";n.d(t,{s:function(){return d}});var r=n(953),i=n(904),o=n(3888),a=n(6307),s=n(3572),l=n(3803),u=n(6378),c=n(423),d=function(){function e(e,t,n,r){this._mruManager=null,this._tryQueries=null,this._tryQueriesEnabled=!1,this._firstRunEnabled=!1,this._mruManager=e,this._tryQueries=t,this._tryQueriesEnabled=r,this._firstRunEnabled=n}return e.prototype.issueQuery=function(t,n,r){if(!e.IsValidQuery(t)){var c=new a.v;if(!this._mruManager.getControlIds().length&&this._firstRunEnabled&&!this._tryQueriesEnabled){var d=new o.z(5),p=new i.b(null,3,null,null);d.addResult(p),c.addResultGroup(d)}var g=new o.z(3);if(this._mruManager.getControlIds().length>0){g.set_displayName(CommonUIStrings.l_TellMeRecentlyUsedTitle);for(var h=0,_=this._mruManager.getControlIds();h<_.length;h++){var f=_[h];p=new i.b(f,1,null,null);g.addResult(p)}c.addResultGroup(g)}if(this._tryQueriesEnabled&&this._tryQueries.length>0&&this._mruManager.getControlIds().length<e.maxResults){var m=new o.z(4);m.set_displayName(CommonUIStrings.l_TellMeTryQueryTitle);for(var y=e.maxResults-g.get_results().length,v=new Array(0),S=0;S<this._tryQueries.length&&S<y;++S){p=void 0;if(r){var I=l.q.get_tryQueryIdSimplified()+(S+1),C=this._tryQueries[S].get_key(),T=u.l.replaceAll(C,'"',"");v.push(appChrome.actions.setControlLabel(I,C)),v.push(appChrome.actions.setButtonCommandValueId(I,T)),p=new s.y(C,11,T,I)}else p=new s.y(this._tryQueries[S].get_key(),11,this._tryQueries[S].get_value(),null);m.addResult(p)}v.length>0&&appChrome.api.dispatch(v),c.addResultGroup(m)}c.set_query(t),n.resultsUpdated(c)}},e.IsValidQuery=function(e){return!!e&&!!e.queryText&&""!==e.queryText.trim()},e.maxResults=5,e}();(0,c.l)(d,"672e0cb9$EmptyQueryResultsProvider",null,[r.m])},5093:function(e,t,n){"use strict";n.r(t);var r=n(2298),i=n(423),o=(0,i.y)("e9b16c74$ICoauthorGalleryTelemetry"),a=n(2966),s=n(984),l=n(6086),u=(0,i.y)("f31472d8$ICoauthorPositionFinder"),c=n(363),d=n(8192),p=function(){function e(e,t){this._provider=null,this._plumber=null,this._peopleInfoProviderTask=null,this._peopleInfoProviderTask=e,this._plumber=t}return e.prototype.init=function(){var e=this;this._peopleInfoProviderTask.CW((function(t){e._provider=e._peopleInfoProviderTask.get_result(),e._provider.add_usersUpdated(i.i(e,e.OnUsersUpdated,"OnUsersUpdated"))}))},e.prototype.OnUsersUpdated=function(t,n){e.areThereTwoDistinctUsers(this._provider.getAllUsers())&&(this._provider.remove_usersUpdated(i.i(this,this.OnUsersUpdated,"OnUsersUpdated")),this._plumber.IsRealCoauthSession=!0)},e.areThereTwoDistinctUsers=function(e){for(var t,n=null,r=0,i=e;r<i.length;r++){var o=i[r];if(o)if(t=o.get_isAnonymous()||!o.get_email()?o.get_clientId():o.get_email().toUpperCase(),n){if(n!==t)return!0}else n=t}return!1},e}();(0,i.l)(p,"3c0998b9$CoauthTelemetry",null,[]);var g,h=n(3517),_=n(127),f=n(6653),m=n(7597);!function(e){e[e.badStatePreventedTelemetry=0]="badStatePreventedTelemetry",e[e.notImplemented=1]="notImplemented",e[e.renderHandled=2]="renderHandled",e[e.renderHandledWithVeto=3]="renderHandledWithVeto"}(g||(g={})),(0,i.h)("911ac07b$CoauthorGalleryTelemetryEndResult",g);var y=function(){function e(e,t,n,r,i,o,a,s,l){this._actionManagerExtended=null,this._stateTaskTcs=null,this._coauthoringTelemeryInfoProviderAsync=null,this._appSettingsManager=null,this._appLifecycleManager=null,this._pageLoadPerfRecorder=null,this._peoplesWellAsync=null,this._peopleInfoProviderAsync=null,this._areThereTwoDistinctUsers=null,this._peopleInfoProvider=null,this._coauthoringTelemeryInfoProvider=null,this._peoplesWell=null,this._coauthStartPoint=0,this._haveSeenUniqueCoauthorsBefore=!1,this._haveHandledFirstUserUpdate=!1,this._timeOfRender=0,this._browservisibilityHasChanged=null,this._actionManagerExtended=e,this._stateTaskTcs=new _.z(g),this._appSettingsManager=n,this._coauthoringTelemeryInfoProviderAsync=t,this._appLifecycleManager=r,this._pageLoadPerfRecorder=i,this._peoplesWellAsync=o,this._peopleInfoProviderAsync=a,this._areThereTwoDistinctUsers=s,this._haveHandledFirstUserUpdate=!1,this._haveSeenUniqueCoauthorsBefore=!1,this._timeOfRender=0,this._coauthStartPoint=1,this._browservisibilityHasChanged=l}return e.prototype.get_stateTask=function(){return this._stateTaskTcs.get_task()},e.prototype.init=function(){var e=this;h.Task.WAA.call(null,this._peopleInfoProviderAsync,this._coauthoringTelemeryInfoProviderAsync,this._peoplesWellAsync).CW((function(t){e._peopleInfoProvider=e._peopleInfoProviderAsync.get_result(),e._coauthoringTelemeryInfoProvider=e._coauthoringTelemeryInfoProviderAsync.get_result(),e._peoplesWell=e._peoplesWellAsync.get_result(),h.Task.WAA.call(null,e._coauthoringTelemeryInfoProviderAsync.get_result().get_coauthoringStartPointAsync(),e._peoplesWellAsync.get_result().get_timeOfRenderAsync()).CW((function(t){e._coauthStartPoint=e._coauthoringTelemeryInfoProvider.get_coauthoringStartPointAsync().get_result(),e._timeOfRender=e._peoplesWell.get_timeOfRenderAsync().get_result(),e._peopleInfoProvider.add_usersUpdated(i.i(e,e.OnUsersUpdatedEventListener,"OnUsersUpdatedEventListener")),e._peopleInfoProvider.getAllUsers().length&&e.OnUsersUpdated()}))}))},e.prototype.OnUsersUpdatedEventListener=function(e,t){this.OnUsersUpdated()},e.prototype.OnUsersUpdated=function(){this._areThereTwoDistinctUsers(this._peopleInfoProvider.getAllUsers())?(this._peopleInfoProvider.remove_usersUpdated(i.i(this,this.OnUsersUpdatedEventListener,"OnUsersUpdatedEventListener")),this.OnFirstUniqueCoauthorUpdate(this._haveHandledFirstUserUpdate)):this._stateTaskTcs.trySetResult(1),this._haveHandledFirstUserUpdate=!0},e.prototype.OnFirstUniqueCoauthorUpdate=function(e){var t=this;if(this._haveSeenUniqueCoauthorsBefore)this.get_stateTask().CW((function(e){m.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",g[t.get_stateTask().get_result()])}));else{this._haveSeenUniqueCoauthorsBefore=!0;var n=!this._coauthStartPoint&&!e;this.ProcessTelemetry(n)}},e.prototype.ProcessTelemetry=function(e){e?this._appLifecycleManager.executeWhen(4,i.i(this,this.OnInteractiveReady,"OnInteractiveReady"),f.d.onlyOnRanToCompletion):this._stateTaskTcs.trySetResult(1)},e.prototype.OnInteractiveReady=function(){var e=this._pageLoadPerfRecorder.getMetric("AppInitStatus_interactivityReady");m.ULS.shipAssertTag(42259235,325,!!this._timeOfRender,null);var t=this._timeOfRender-e;m.ULS.sendTraceTag(42062997,325,15,t.toString()),this._stateTaskTcs.trySetResult(this.VetoSession(t)?3:2)},e.prototype.VetoSession=function(e){var t=e>this._appSettingsManager.getIntAppSetting("CoauthorGalleryTimeToRenderDurationMs",1e4);return this._browservisibilityHasChanged()?(m.ULS.sendTraceTag(50455714,325,50,t.toString()),!1):(t&&m.ULS.sendTraceTag(42062998,325,15,e.toString()),t)},e}();(0,i.l)(y,"8938fac$CoauthorGalleryTelemetry",null,[o]);var v=function(){function e(e){this._peopleInfoProvider=null,this._peopleInfoProviderAsync=null,this._initCallTcs=null,this._coauthJoinOrder={},this._pendingRequests={},this._peopleInfoProviderAsync=e}return e.prototype.getPositionAsync=function(e){var t=this,n=new _.z(Number);return this.Init().CW((function(r){e in t._coauthJoinOrder?n.trySetResult(t._coauthJoinOrder[e]):t._pendingRequests[e]=n})),n.get_task()},e.prototype.Init=function(){var e=this;return this._initCallTcs?this._initCallTcs.get_task():(this._initCallTcs=new _.z(Object),this._peopleInfoProviderAsync.CW((function(t){e._peopleInfoProvider=e._peopleInfoProviderAsync.get_result(),e._peopleInfoProvider.add_usersUpdated(i.i(e,e.OnUsersUpdated,"OnUsersUpdated")),e.UpdatePositionDictionary(),e._initCallTcs.setResult(null)})),this._initCallTcs.get_task())},e.prototype.UpdatePositionDictionary=function(){var e=this._peopleInfoProvider.getAllUsers();e.sort(i.i(this,this.ComparePresenceUsers,"ComparePresenceUsers")),this._coauthJoinOrder={};for(var t=0;t<e.length;t++){if(!e[t]||!e[t].get_joinTime())return;this.AddPositionsToDictionary(this._coauthJoinOrder,e[t].get_clientId(),t)}},e.prototype.AddPositionsToDictionary=function(e,t,n){e[t]=n,t in this._pendingRequests&&(this._pendingRequests[t].trySetResult(n),delete this._pendingRequests[t])},e.prototype.OnUsersUpdated=function(e,t){this.UpdatePositionDictionary()},e.prototype.ComparePresenceUsers=function(e,t){var n=e,r=t;return n.get_joinTime()>r.get_joinTime()?1:n.get_joinTime()<r.get_joinTime()?-1:0},e}();(0,i.l)(v,"a1f14340$CoauthorPositionFinder",null,[u]);var S=function(){return function(){this.id=null,this.et=0,this.st=0,this.mp=0,this.tp=0,this.d=0,this.ct=null,this.vc=!1}}();(0,i.l)(S,"3f6d77d3$PL",null,[]);var I=n(8996),C=function(){function e(e,t,n,r,i,o,a,s){this._startTime=0,this._startTimeAsync=null,this._vetoThreshold=0,this._sessionVetoed=!1,this._endTime=0,this._myPositionAsync=null,this._theirPositionAsync=null,this._clientType=0,this._id=null,this._browservisibilityHasChanged=null,this._id=e,this._startTimeAsync=t,this._endTime=n,this._myPositionAsync=r,this._theirPositionAsync=i,this._vetoThreshold=o,this._clientType=a,this._browservisibilityHasChanged=s}return e.prototype.veto=function(e){var t=this;h.Task.WAA(this._startTimeAsync,this._myPositionAsync,this._theirPositionAsync).CW((function(n){if(t._myPositionAsync.get_result()<=t._theirPositionAsync.get_result())e.trySetResult(!1);else{t._startTime=t._startTimeAsync.get_result();var r=t._endTime-t._startTime,i=new S;i.id=t._id,i.et=t._endTime,i.st=t._startTime,i.d=t._endTime-t._startTime,i.mp=t._myPositionAsync.get_result(),i.tp=t._theirPositionAsync.get_result(),i.ct=t.GetClientTypeString(t._clientType),i.vc=t._browservisibilityHasChanged();var o=I.x.serialize(i);m.ULS.sendTraceTag(42078597,302,15,o),r>t._vetoThreshold&&!t._sessionVetoed&&!i.vc&&(t._sessionVetoed=!0,e.trySetResult(!0),m.ULS.sendTraceTag(42078598,302,15,"d:{"+r+"},vt:{"+t._vetoThreshold+"}")),e.get_task().get_isCompleted()||e.trySetResult(!1)}}))},e.prototype.GetClientTypeString=function(e){switch(e){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}},e}();(0,i.l)(C,"cbc5d85a$PresenceLatencyActivityLogger",null,[]);var T=n(2575),b=function(){function e(e,t,n,r,i,o,a){this._coauthTelemetryInfoAsync=null,this._myClientId=null,this._initCalledTcs=null,this._appLifecycleManager=null,this._positionFinder=null,this._bootTimeTcs=null,this._pageLoadPerfRecorder=null,this._startReason=0,this._startTelemetryTime=0,this._vetoThreshold=0,this._browservisibilityHasChanged=null,this._processedClientIds={},this._vetoThreshold=o.getLongAppSetting("PresenceBootLatencyThreshold",1e4),this._appLifecycleManager=t,this._positionFinder=n,this._coauthTelemetryInfoAsync=e,this._pageLoadPerfRecorder=r,this._myClientId=a,this._browservisibilityHasChanged=i,this.Init()}return e.prototype.endTelemetry=function(e,t,n,r){var i=this;n&&(m.ULS.shipAssertTag(42274970,302,!this._myClientId||this._myClientId===n,"_myClientId is already set and you are trying to update it to something different"),this._myClientId=n);var o=new _.z(Boolean);return this.Init().CW((function(n){i.EndTelemetryInternal(o,e,t,r)})),o.get_task()},e.prototype.get_MyClientId=function(){return this._myClientId||"{"+T.AFrameworkApplication.userSessionId+"}"},e.prototype.Init=function(){var e=this;return this._initCalledTcs?this._initCalledTcs.get_task():(this._initCalledTcs=new _.z(Object),this._browservisibilityHasChanged()&&m.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session"),this._coauthTelemetryInfoAsync.CW((function(t){var n=e._coauthTelemetryInfoAsync.get_result(),r=n.get_coauthoringStartPointAsync(),i=n.get_mostRecentCoauthStartTimeAsync();i.CW((function(t){r.CW((function(t){e.StartTelemetry(r.get_result(),i.get_result()),e._initCalledTcs.setResult(null)}))}))})),this._initCalledTcs.get_task())},e.prototype.GetIntractiveBootTime=function(){var e=this;return this._bootTimeTcs?this._bootTimeTcs.get_task():(this._bootTimeTcs=new _.z(Number),this._appLifecycleManager.executeWhen(4,(function(){var t=e._pageLoadPerfRecorder.getMetric("AppInitStatus_interactivityReady");e._bootTimeTcs.trySetResult(t)}),f.d.onlyOnRanToCompletion),this._bootTimeTcs.get_task())},e.prototype.StartTelemetry=function(e,t){this._startReason=e,this._startTelemetryTime=t||(new Date).getTime()},e.prototype.EndTelemetryInternal=function(e,t,n,r){var i=n?n.getTime():(new Date).getTime();if(!(t in this._processedClientIds)){var o=new C(t,this.GetStartTimeAsync(),i,this.GetPositionAsync(this.get_MyClientId()),this.GetPositionAsync(t),this._vetoThreshold,r,this._browservisibilityHasChanged);return this._processedClientIds[t]=o,void o.veto(e)}e.trySetCanceled()},e.prototype.GetStartTimeAsync=function(){new _.z(Number);return 1===this._startReason?h.Task.fromResult(Number,this._startTelemetryTime):this.GetIntractiveBootTime()},e.prototype.GetPositionAsync=function(e){return this._positionFinder.getPositionAsync(e)},e}();(0,i.l)(b,"d3e71e32$PresenceBootTelemetry",null,[l.a]);var A=n(2130),M=n(1526),P=n(4554),F=n(4004),w=n(6382),R=n(2449),E=n(4097);n.d(t,{CoauthTelemetryPackage:function(){return k}});var k=function(){function e(){}return e.prototype.get_name=function(){return"Common.App.CoauthTelemetry"},e.prototype.configure=function(e){var t=this;e.register(p).singleInstance().usingFactory((function(){return new p(R.q.taskFromFuture(r.d,e.resolveFuture(r.d)),T.AFrameworkApplication.dataPlumber)})),e.register(y).as(o).singleInstance().usingFactory((function(){return new y(T.AFrameworkApplication.get_theActionManager(),R.q.taskFromFuture(a.s,e.resolveFuture(a.s)),T.AFrameworkApplication.appSettingsManager,A.AppLifecycleManager.get_instance(),F.e.get_instance(),R.q.taskFromFuture(s.t,e.resolveFuture(s.t)),R.q.taskFromFuture(r.d,e.resolveFuture(r.d)),p.areThereTwoDistinctUsers,(function(){return t.BrowservisibilityHasChanged()}))})),e.register(b).as(l.a).singleInstance().usingFactory((function(){return new b(R.q.taskFromFuture(a.s,e.resolveFuture(a.s)),A.AppLifecycleManager.get_instance(),e.resolve(u),F.e.get_instance(),(function(){return t.BrowservisibilityHasChanged()}),T.AFrameworkApplication.appSettingsManager,null)})),e.register(v).as(u).singleInstance().usingFactory((function(){return new v(R.q.taskFromFuture(r.d,e.resolveFuture(r.d)))}))},e.prototype.init=function(){T.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){w.w.get_instance().resolve(p).init(),T.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled")&&T.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CoauthorGalleryTelemetryIsEnabled")&&w.w.get_instance().resolve(o).init(),T.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CashTelemetryIsEnabled")&&(w.w.get_instance().resolve(l.a),w.w.get_instance().resolve(u))}))},e.prototype.dispose=function(){},e.prototype.BrowservisibilityHasChanged=function(){if(E.m.get_browserSupportsPerformanceTiming()&&F.e.get_instance().containsMetric(P.c.userActions))return F.e.get_instance().getMetric(P.c.userActions)[P.c.visiToggled]>0;return!1},e.main=function(){M.o.get_instance().registerPackage(new e,0,!1)},e}();(0,i.l)(k,"eb1fdf03$CoauthTelemetryPackage",null,[c.u,d.s])},5112:function(e,t,n){"use strict";n.d(t,{x:function(){return r}});var r=(0,n(423).y)("10a920ab$IFidelityMetricManager")},5118:function(e,t,n){"use strict";var r=n(3545),i=n(9137),o=n(1409),a=n(7862),s=n(5941),l=n(423),u=(0,l.y)("da0b83c7$IPresenceRemover"),c=n(2298),d=n(6086),p=n(7559),g=n(1775),h=n(9265),_=n(5373),f=n(532),m=n(5541),y=n(3623),v=n(4223),S=n(8361),I=(0,l.y)("e9fde89d$IPresenceManager"),C=n(1822),T=n(1664),b=n(6720),A=n(7847),M=n(1658),P=n(7597),F=n(4541),w=n(1308),R=n(2879),E=n(7413),k=n(628),D=n(8129),O=n(2007),U=n(2949),x=n(5934),L=function(){function e(t,n,r,i,o,a,s,u,c,d,p,g,h,_,f,m,y,v,S,I,C,b,P,F){this._proxy=null,this._userInfoResolver=null,this._peopleInfoProvider=null,this._selectionManager=null,this._presenceData=null,this._overlayControlProviderRegistries=null,this._contentObjectSpace=null,this._accessibilityManager=null,this._presenceIpControlProvider=null,this._editingViewId=0,this._sendPresenceOnSave=!1,this._getParagraphTextLength=null,this._getParagraphVersionRep=null,this._graphReplicator=null,this._started=!1,this._myPresenceUser=null,this._graphInstance=null,this._graphTransactionFactory=null,this._taskManager=null,this._throttleAndBatchRendering=!1,this._pageView=null,this._updateDirtyPresenceScheduled=!1,this._renderCounter=null,this._presenceBootTelemetryTask=null,this._presenceBootTelemetry=null,this._appSettingsManager=null,this._isRenderPresenceTaskScheduled=!1,this._renderDueToScroll=!1,this._loggedFirstInstanceOfUserInfoUpdated=!1,this._receiveOnly=!1,this._ulsLogFlags=new Array(5),this._processedEndTelemetry=new T.e(String,M.b.get_ordinalIgnoreCase()),this._paragraphsNeedRendering={},this._proxy=t,this._selectionManager=i,this._userInfoResolver=o,this._peopleInfoProvider=a,this._presenceData=s,this._pageView=c,this._editingViewId=d,this._presenceIpControlProvider=p,this._contentObjectSpace=r,this._graphReplicator=g,this._getParagraphTextLength=h,this._getParagraphVersionRep=_,this._accessibilityManager=u,this._myPresenceUser=f,this._graphInstance=m,this._graphTransactionFactory=y,this._taskManager=v,this._throttleAndBatchRendering=C,this._renderCounter=P,this._receiveOnly=F,this._presenceBootTelemetryTask=S,this._appSettingsManager=I,this._overlayControlProviderRegistries=n;for(var w=0;w<this._overlayControlProviderRegistries.length;w++)this._overlayControlProviderRegistries[w].registerOverlayControlProvider(this);this._presenceData.add_presenceOnParagraphChanged(l.i(this,this.PresenceOnParagraphChanged,"PresenceOnParagraphChanged")),this._proxy.add_presenceUpdated(l.i(this,this.onPresenceUpdated,"onPresenceUpdated")),this._userInfoResolver&&this._userInfoResolver.add_userInfoUpdated(l.i(this,this.OnUserInfoUpdated,"OnUserInfoUpdated")),b&&this._pageView.add_scrolled(l.i(this,this.PageViewScrolled,"PageViewScrolled")),this._proxy.registerService(this),e._presenceTelemetryDictionary=new A.w(Boolean)}return e.prototype.PageViewScrolled=function(t,n){var r=this;if(!this._updateDirtyPresenceScheduled){var i=new R.c(0,1,e.OnScrollPresenceUpdateIntervalMs,(function(){var e=new b.c(w.h),t=r._presenceIpControlProvider.get_CurrentControls();for(var n in t){var i={key:n,value:t[n]}.value;i.get_leftRenderDirty()&&e.add(i.presenceData.get_ip().get_paragraphId())}r.GetAndInvalidateParagraphsForRender(e,!0),r._updateDirtyPresenceScheduled=!1}),72,null,!1);this._taskManager.addTask(i),this._updateDirtyPresenceScheduled=!0}},e.prototype.OnGraphOutboundReplication=function(e,t){this._sendPresenceOnSave&&(this.sendCurrentSelection(),this._sendPresenceOnSave=!1)},e.prototype.renderAllAffectedParagraphs=function(e){this._throttleAndBatchRendering&&!e||this.RenderAllAffectedParagraphsInternal()},e.prototype.RenderAllAffectedParagraphsInternal=function(){var e=new b.c(w.h),t=this._paragraphsNeedRendering;for(var n in t){var r={key:n,value:t[n]};e.add(w.h.createFromString(r.key))}this.GetAndInvalidateParagraphsForRender(e,!1),this._paragraphsNeedRendering={}},e.prototype.OnUserInfoUpdated=function(e,t){this._loggedFirstInstanceOfUserInfoUpdated||(this._loggedFirstInstanceOfUserInfoUpdated=!0,P.ULS.sendTraceTag(42299724,302,15,"PresenceUserInfoResolver will be deprecated - UserInfoUpdated event should no longer occur. Completed={0}, NotInEditorsTable={1}",t.get_presenceInfoArray().length>0,t.get_clientIdsNotInEditorsTable().length>0));for(var n=t.get_presenceInfoArray(),r=0;r<n.length;r++)this.addOrUpdateUserPresence(n[r],!0);var i=t.get_clientIdsNotInEditorsTable();for(r=0;r<i.length;r++)this.removeUserPresence(i[r]);this.renderAllAffectedParagraphs(!1)},e.prototype.sendCurrentSelection=function(){if(this._selectionManager.get_selectionCollection()){var e=this._selectionManager.get_selectionCollection().get_currentSelection();this.SendSelectionPresence(e,!0)}},e.prototype.OnSetSelectionFinished=function(e,t){var n=t.newSelectionCollection.get_currentSelection();this.SendSelectionPresence(n,!1)},e.prototype.SendSelectionPresence=function(t,n){if(!this._receiveOnly)if(this._contentObjectSpace.get_currentRevision().get_isServerRevision()||n)if(t){var r=this.CreatePresenceInfoFromSelection(t);if(!r)return this._proxy.sendPresenceIp(e.EmptyPresenceIp),void P.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",t.get_firstContext().get_contextId());this._proxy.sendPresenceIp(r)}else this._proxy.sendPresenceIp(e.EmptyPresenceIp);else this._sendPresenceOnSave=!0},e.prototype.CreatePresenceInfoFromSelection=function(e){var t;if(this._appSettingsManager.getBooleanAppSetting("ObjectPresenceIsEnabled")&&e.get_isValidSelectableObject())t=e;else if(t=O.SelectionEditor.collapseToIp(e,!0,!1,!0,!1),!O.SelectionEditor.isInsertionPointSelection(t))return null;return this.buildPresenceIp(t)},e.prototype.buildPresenceIp=function(e){var t=e.get_firstContext().get_cpBegin(),n=e.get_firstContext().get_node().get_id(),r=this._getParagraphTextLength(e.get_firstContext().get_node());return new D.b(n.toString(),t,r,0)},e.prototype.onPresenceUpdated=function(e,t){var n=Date.now(),r=t.get_updatedClients();for(var i in r){var o={key:i,value:r[i]}.value;this._appSettingsManager.getBooleanAppSetting("CashTelemetryIsEnabled")&&this.EndTelemetry(o,new Date,null),o.get_ip()?this.addOrUpdateUserPresence(o,!1):this.removeUserPresence(o.get_user().get_clientId())}for(var a=t.get_disconnectedClients(),s=0;s<a.length;++s)this.DeleteUserPresence(a[s]);this.renderAllAffectedParagraphs(!1),t.trackDurationInMilliseconds("PresenceManager",Date.now()-n)},e.prototype.EndTelemetry=function(t,n,r){var i=this;if(this._presenceBootTelemetryTask)if(t&&t.get_user()&&t.get_user().get_clientId()){var o=t.get_user().get_clientId();if(!this._processedEndTelemetry.contains(o)){if(this._presenceBootTelemetry){var a=e.GetRtcClientTypeFromPresenceInfo(r||t.get_user().get_client());return this._presenceBootTelemetry.endTelemetry(o,n,null,a),void this._processedEndTelemetry.add(o)}this._presenceBootTelemetryTask.CW((function(e){i._presenceBootTelemetry=i._presenceBootTelemetryTask.get_result(),i.EndTelemetry(t,n,r)}))}}else P.ULS.sendTraceTag(42262876,302,15,"invalid presence")},e.prototype.GetPresenceControlsForParagraph=function(e){for(var t=new b.c(y.v),n=0;n<e.length;n++){var r=e[n];t.add(this.GetUserPresenceControlOnAParagraph(r))}return t},e.prototype.addOrUpdateUserPresence=function(e,t){var n=null;e&&e.get_user()&&(n=e.get_user().get_client());var r=e;(r=e.clone()).set_user(this._peopleInfoProvider.lookupUser(r.get_user().get_clientId())||r.get_user()),this._appSettingsManager.getBooleanAppSetting("CashTelemetryIsEnabled")&&this.EndTelemetry(r,new Date,n),r.isValid()&&!r.get_user().isComplete()&&(this.UpdatePresenceTelemetry(r.get_user().get_clientId()),r.get_user().set_userName(CommonUIStrings.l_AnonymousUserName)),this._presenceData.addPresence(r,t)},e.prototype.UpdatePresenceTelemetry=function(t){var n=!1;e._presenceTelemetryDictionary.tryGetValue(t,(0,C.m)((function(){return n}),(function(e){return n=e}))),n||(e._presenceTelemetryDictionary.set_item(t,!0),P.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+t+'" , "Event" : "CreateAnonymousGrayPawn"}'))},e.prototype.removeUserPresence=function(e){this._presenceData.removePresence(e)},e.prototype.DeleteUserPresence=function(e){this.removeUserPresence(e);var t=this._presenceIpControlProvider.GetControlIfCached(e);t&&(t.remove_controlRendered(l.i(this,this.OnPresenceRendered,"OnPresenceRendered")),t.dispose())},e.prototype.getOverlayControls=function(e){if(12!==e.get_type())return new b.c(y.v);var t=this._presenceData.getAllPresenceInfosForParagraph(e.get_id().toString(),this._getParagraphTextLength(e),this._getParagraphVersionRep(e),!1);return t.length<=0?new b.c(y.v):this.GetPresenceControlsForParagraph(t)},e.prototype.OnPresenceRendered=function(e,t){if(t.get_paragraphId()){var n=t.get_paragraphId().toString();this.UpdateRenderKnowledge(n,t.get_leftDirty(),this._paragraphsNeedRendering,this._isRenderPresenceTaskScheduled,this._renderDueToScroll)}else P.ULS.shipAssertTag(8758481,302,!1,"null paraid")},e.prototype.UpdateRenderKnowledge=function(t,n,r,i,o){if(!n||!o)if(n)this._renderCounter.increment(e.rendersSavedByOutOfView);else{this._renderCounter.increment(e.totalRendersCountBucket),o&&this._renderCounter.increment(e.rendersDueToScroll);var a=t in r;a&&delete r[t],i&&a&&this._renderCounter.increment(e.rendersSavedByContentCountBucket)}},e.prototype.dispose=function(){this.stop(),this._presenceData.remove_presenceOnParagraphChanged(l.i(this,this.PresenceOnParagraphChanged,"PresenceOnParagraphChanged")),this._proxy.remove_presenceUpdated(l.i(this,this.onPresenceUpdated,"onPresenceUpdated")),this._proxy.unregisterService(this),this._userInfoResolver&&this._userInfoResolver.remove_userInfoUpdated(l.i(this,this.OnUserInfoUpdated,"OnUserInfoUpdated"));for(var e=0;e<this._overlayControlProviderRegistries.length;e++)this._overlayControlProviderRegistries[e].unregisterOverlayControlProvider(this);E.d.safeDisposeArray([this._userInfoResolver,this._accessibilityManager,this._proxy]),this._presenceIpControlProvider.DisposeAllControls()},e.prototype.GetUserPresenceControlOnAParagraph=function(e){var t=!1,n=this._presenceIpControlProvider.getPresenceIpControl(e,(0,C.m)((function(){return t}),(function(e){return t=e})));return t||n.add_controlRendered(l.i(this,this.OnPresenceRendered,"OnPresenceRendered")),n},e.prototype.GetValidParagraphNode=function(e){var t=this._contentObjectSpace.getObject(e);return t?x.ParagraphReader.isParagraphNode(t)?t.getHtmlViewElement(this._pageView.get_viewId())?t.get_anchor()?(this._ulsLogFlags[4]||(P.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this._ulsLogFlags[4]=!0),t):(this._ulsLogFlags[3]||(P.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this._ulsLogFlags[3]=!0),null):(this._ulsLogFlags[2]||(P.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this._ulsLogFlags[2]=!0),null):(this._ulsLogFlags[1]||(P.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this._ulsLogFlags[1]=!0),null):(this._ulsLogFlags[0]||(P.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this._ulsLogFlags[0]=!0),null)},e.prototype.RemoveIpControlsOnParagraph=function(e){var t=this._presenceData.getAllPresenceInfosForParagraph(e.toString(),-1,-1,!0);if(t&&!(t.length<=0))for(var n=0;n<t.length;n++){var r=this._presenceIpControlProvider.GetControlIfCached(t[n].get_user().get_clientId());r&&r.element&&r.removeControl(r.element.parentNode)}},e.prototype.GetAndInvalidateParagraphsForRender=function(e,t){if(e.get_count()){for(var n=new b.c(U.AParagraphNode),r=e.$$lge();r.$$mn();){var i=r.$$cu();(s=this.GetValidParagraphNode(i))?n.add(s):this.RemoveIpControlsOnParagraph(i)}if(n.get_count()){var o=this._graphTransactionFactory.getTransaction(3,0);try{o.set(this._graphInstance);for(var a=n.$$lge();a.$$mn();){var s=a.$$cu();this.DoInvalidateFloatingObjectOverlaysPhase(s)}t&&(this._renderDueToScroll=!0)}finally{o&&o.dispose()}t&&(this._renderDueToScroll=!1)}}},e.prototype.DoInvalidateFloatingObjectOverlaysPhase=function(e){e.invalidateViewElement(this._pageView.get_viewId(),32,!0),e.invalidateViewElement(this._editingViewId,32,!0)},e.prototype.ScheduleRenderingOfParagraph=function(t){var n=this;if(t.toString()in this._paragraphsNeedRendering&&this._renderCounter.increment(e.rendersSavedByAlreadyPending),this._paragraphsNeedRendering[t.toString()]=null,this._throttleAndBatchRendering){if(this._isRenderPresenceTaskScheduled)return;var r=new R.c(0,1,e.PresenceUpdateIntervalMs,(function(){n._isRenderPresenceTaskScheduled=!1,n.RenderAllAffectedParagraphsInternal()}),70,null,!1);this._taskManager.addTask(r),this._isRenderPresenceTaskScheduled=!0}},e.prototype.PresenceOnParagraphChanged=function(t,n){if(n.get_paragraphId()){var r=this._contentObjectSpace.getObject(n.get_paragraphId());if(r)(l.r(k.l,n.get_presence())?this._getParagraphTextLength(r):this._getParagraphVersionRep(r))===n.get_presence().get_ip().get_paragraphVersionRep()?this.ScheduleRenderingOfParagraph(n.get_paragraphId()):this._renderCounter.increment(e.rendersSavedByVersionCheck)}},e.prototype.stop=function(){this._started&&(this._started=!1,this._selectionManager.remove_processSetSelectionFinished(l.i(this,this.OnSetSelectionFinished,"OnSetSelectionFinished")),this._graphReplicator.remove_onOutboundReplication(l.i(this,this.OnGraphOutboundReplication,"OnGraphOutboundReplication")))},e.prototype.start=function(){if(!this._started){this._started=!0,this._selectionManager.add_processSetSelectionFinished(l.i(this,this.OnSetSelectionFinished,"OnSetSelectionFinished")),this._graphReplicator.add_onOutboundReplication(l.i(this,this.OnGraphOutboundReplication,"OnGraphOutboundReplication"));var e=this._proxy.getAllPresence();delete e[this._myPresenceUser.get_clientId()],this.onPresenceUpdated(null,new F.m(e,new Array(0),null)),this.sendCurrentSelection()}},e.prototype.showPresenceFullTooltipForUser=function(e){if(e&&e.isValid()&&e.get_ip()){for(var t=this._presenceData.getAllPresenceInfosForParagraph(e.get_ip().get_paragraphId().toString(),-1,-1,!1),n=!1,r=null,i=0;i<t.length;i++)if((r=t[i]).get_user().get_clientId()===e.get_user().get_clientId()){r.set_showFullTooltip(!0),n=!0;break}if(n){var o=r.get_ip().get_paragraphId(),a=this.GetValidParagraphNode(o);if(a){var s=this._graphTransactionFactory.getTransaction(3,0);try{s.setFromNode(a),this.DoInvalidateFloatingObjectOverlaysPhase(a)}finally{s&&s.dispose()}}else this.RemoveIpControlsOnParagraph(o)}}},e.GetRtcClientTypeFromPresenceInfo=function(e){return e?e?1===e?1:2===e?2:0:2:0},e.PresenceUpdateIntervalMs=200,e.OnScrollPresenceUpdateIntervalMs=20,e.totalRendersCountBucket="Renders",e.rendersSavedByContentCountBucket="RendersSaved-ContentUpdate",e.rendersSavedByOutOfView="RendersSaved-OutOfView",e.rendersSavedByVersionCheck="RendersSaved-VersionCheck",e.rendersSavedByAlreadyPending="RendersSavedByAlreadyPending",e.rendersDueToScroll="RendersDueToScroll",e.EmptyPresenceIp=null,e._presenceTelemetryDictionary=null,e}();(0,l.l)(L,"56f76e54$PresenceManager",null,[v.e,Sys.IDisposable,S.r,s.r,I,u]);var N=n(127),B=n(2506),H=n(7106),$=n(5516),G=n(2575),W=n(213),V=n(4517),j=n(6382),q=n(2449),z=n(4178),K=n(9423),Q=n(7282),Z=function(){function e(e,t,n,r){this._selectionManager=null,this._dataManager=null,this._currentParagraphId=null,this._isCurrentSelectionIp=!1,this._ariaNotifier=null,this._rtcProxy=null,this._started=!1,this._usersInCurrentParagraph=null,this._rtcProxy=r,this._selectionManager=t,this._dataManager=e,this._ariaNotifier=n,this._rtcProxy.registerService(this)}return e.prototype.start=function(){this._started||(this._started=!0,this._usersInCurrentParagraph={},this._dataManager.add_presenceOnParagraphChanged(l.i(this,this.OnPresenceOnParagraphChanged,"OnPresenceOnParagraphChanged")),this._selectionManager.add_processSetSelectionFinished(l.i(this,this.OnProcessSetSelectionFinished,"OnProcessSetSelectionFinished")),this.UpdateInternalStateOfCurrentSelectionInfo(this._selectionManager.get_selectionCollection()))},e.prototype.stop=function(){this._started&&(this._started=!1,this._usersInCurrentParagraph=null,this._dataManager.remove_presenceOnParagraphChanged(l.i(this,this.OnPresenceOnParagraphChanged,"OnPresenceOnParagraphChanged")),this._selectionManager.remove_processSetSelectionFinished(l.i(this,this.OnProcessSetSelectionFinished,"OnProcessSetSelectionFinished")))},e.prototype.OnProcessSetSelectionFinished=function(e,t){if(!G.AFrameworkApplication.isShuttingDown){var n=this.UpdateInternalStateOfCurrentSelectionInfo(t.newSelectionCollection);if(this._currentParagraphId&&n){for(var r=this._dataManager.getAllPresenceInfosForParagraph(this._currentParagraphId.toString(),-1,-1,!0),i=0;i<r.length;i++)this._usersInCurrentParagraph[r[i].get_user().get_clientId()]=r[i];if(!(r.length<=0)){var o=this.CreateEnteringParagraphNotificationText(r);this._ariaNotifier.sendNotification(o,!0)}}}},e.prototype.CreateEnteringParagraphNotificationText=function(e){if(1===e.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,e[0].get_user().get_userName());for(var t=new Array(0),n=e.length,r=0;r<n;r++)Array.add(t,e[r].get_user().get_userName());return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,t.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))},e.prototype.OnPresenceOnParagraphChanged=function(e,t){if(this._selectionManager.get_selectionCollection()&&!G.AFrameworkApplication.isShuttingDown&&this._isCurrentSelectionIp&&this._currentParagraphId&&this._currentParagraphId.equals(t.get_paragraphId())){var n=null;!t.isAdd||t.get_presence().get_user().get_clientId()in this._usersInCurrentParagraph?t.isAdd||(n=this.CreateParagraphAuthorsChangedNotificationText(t.get_presence().get_user().get_userName(),!1),delete this._usersInCurrentParagraph[t.get_presence().get_user().get_clientId()]):(n=this.CreateParagraphAuthorsChangedNotificationText(t.get_presence().get_user().get_userName(),!0),this._usersInCurrentParagraph[t.get_presence().get_user().get_clientId()]=t.get_presence()),n&&this._ariaNotifier.sendNotification(n,!0)}},e.prototype.CreateParagraphAuthorsChangedNotificationText=function(e,t){return String.format(t?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,e)},e.prototype.dispose=function(){this._rtcProxy.unregisterService(this),this.stop()},e.prototype.UpdateInternalStateOfCurrentSelectionInfo=function(e){if(!e)return!1;var t=e.get_currentSelection();if(!t)return!1;var n=t.get_firstContext();if(!n)return!1;this._isCurrentSelectionIp=O.SelectionEditor.isInsertionPointContext(n);var r=n.get_node().get_id();return!(r.equals(this._currentParagraphId)||!this._isCurrentSelectionIp)&&(this._currentParagraphId=r,this._usersInCurrentParagraph={},!0)},e}();(0,l.l)(Z,"61be33da$PresenceAccessibilityManager",null,[Sys.IDisposable,S.r]);var J=n(6369),X=n(9562),Y=n(6654),ee=n(1302),te=n(1751),ne=n(842),re=n(4072),ie=function(e){function t(t,n,r){var i=e.call(this)||this;return i.paragraphId=null,i.presence=null,i.isAdd=!1,i.paragraphId=t,i.presence=n,i.isAdd=r,i}return(0,r.t)(t,e),t.prototype.get_paragraphId=function(){return this.paragraphId},t.prototype.get_presence=function(){return this.presence},t}(Sys.EventArgs);(0,l.l)(ie,"2943192a$ParagraphChangedEventArg",Sys.EventArgs,[]);var oe=function(e){function t(){var t=e.call(this)||this;return t._firstAddOperationLogged=!1,t._paraIdToClientIds={},t._clientIdToPresenceTable={},t}return(0,r.t)(t,e),t.prototype.get_paraIdToClientIds=function(){return this._paraIdToClientIds},t.prototype.add_presenceOnParagraphChanged=function(e){this.addHandler(t.PresenceOnParagraphChangedEventKey,e)},t.prototype.remove_presenceOnParagraphChanged=function(e){this.removeHandler(t.PresenceOnParagraphChangedEventKey,e)},t.prototype.getParaIdForStoringPresence=function(e){return e.get_ip().get_paragraphId().toString()},t.prototype.addPresence=function(e,n){this._firstAddOperationLogged||(this._firstAddOperationLogged=!0,P.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var r=!1,i=this.IsUserInParagraph(e,(0,C.m)((function(){return r}),(function(e){return r=e})));if(!r||n){i||this.removePresence(e.get_user().get_clientId());var o=this.getParaIdForStoringPresence(e),a=e.get_user().get_clientId(),s=this._paraIdToClientIds[o]||new Array(0),l=this._clientIdToPresenceTable[a]||[];l.length>=t.MaxNumberOfPendingPresence&&(l=l.splice(-t.NumberOfCarryOverAfterCleanup,t.MaxNumberOfPendingPresence)),i||Array.add(s,a),Array.add(l,e),this._paraIdToClientIds[o]=s,this._clientIdToPresenceTable[a]=l,e.get_ip().get_paragraphId().equals(w.h.get_nil())||this.RaiseParagraphChangeEvent(e.get_ip().get_paragraphId(),e,!0)}else{var u=this._clientIdToPresenceTable[e.get_user().get_clientId()];u&&u.length>=0&&u[u.length-1].get_ip().set_paragraphVersionRep(e.get_ip().get_paragraphVersionRep())}},t.prototype.IsUserInParagraph=function(e,t){var n=e.get_user().get_clientId(),r=this._clientIdToPresenceTable[n],i=!r||r.length<=0?null:r[r.length-1],o=!!i&&this.getParaIdForStoringPresence(i)===this.getParaIdForStoringPresence(e);return t.val=o&&i.get_ip().get_presenceCp().equals(e.get_ip().get_presenceCp())&&i.get_user().equals(e.get_user()),o},t.prototype.removePresence=function(e){var t=this._clientIdToPresenceTable[e];if(t&&t.length>0){var n=t[0].get_ip().get_paragraphId(),r=this.getParaIdForStoringPresence(t[0]);delete this._clientIdToPresenceTable[e],this.RemoveMappingFromParaIdToClientId(r,e),n.equals(w.h.get_nil())||this.RaiseParagraphChangeEvent(n,t[0],!1)}},t.prototype.getClientIdsByParaId=function(e){return this._paraIdToClientIds[e]},t.prototype.getAllPresenceInfosForParagraph=function(e,t,n,r){var i=[],o=this.getClientIdsByParaId(e);if(!o)return i;for(var a=0;a<o.length;a++){for(var s=o[a],u=this._clientIdToPresenceTable[s],c=!1,d=u.length-1;d>=0;d--){var p=u[d];if(r){if(p.get_isRendered()&&p.get_ip().get_paragraphId().equals(w.h.createFromString(e))){c=!0,Array.add(i,p);break}}else if(l.r(k.l,p)?p.get_ip().get_paragraphVersionRep()===t:p.get_ip().get_paragraphVersionRep()===n){c=!0,p.set_matchedForRendering(!0),Array.add(i,p),this._clientIdToPresenceTable[s]=u.splice(d,u.length);break}}!c&&u.length>0&&u[0].get_matchedForRendering()&&u[0].get_ip().get_paragraphId().equals(w.h.createFromString(e))&&Array.add(i,u[0])}return i},t.prototype.RaiseParagraphChangeEvent=function(e,n,r){this.raiseEvent(t.PresenceOnParagraphChangedEventKey,new ie(e,n,r),null)},t.prototype.RemoveMappingFromParaIdToClientId=function(e,t){var n=this._paraIdToClientIds[e];Array.remove(n,t)},t.PresenceOnParagraphChangedEventKey="PPC",t.MaxNumberOfPendingPresence=10,t.NumberOfCarryOverAfterCleanup=2,t}(re.f);(0,l.l)(oe,"6a08de24$PresenceDataManager",re.f,[]);var ae=function(e){function t(t,n){var r=e.call(this)||this;return r._oldPresenceReceivedAndLogged=!1,r._featureHelper=null,r._objectSpace=null,r._presenceDataInOldFormat=!1,r._objectSpace=t,r._featureHelper=n,r}return(0,r.t)(t,e),t.prototype.addPresence=function(t,n){this._featureHelper.isFeatureEnabled(128)&&this._featureHelper.isFeatureEnabled(109)&&l.r(k.l,t)?this._oldPresenceReceivedAndLogged||(this._oldPresenceReceivedAndLogged=!0,P.ULS.sendTraceTag(7866380,302,15,"Presence packet received in old format")):(l.r(k.l,t)&&(this._presenceDataInOldFormat=!0),e.prototype.addPresence.call(this,t,n))},t.prototype.getParaIdForStoringPresence=function(t){return this._presenceDataInOldFormat?e.prototype.getParaIdForStoringPresence.call(this,t):t.get_ip().get_wordId().toString()},t.prototype.getClientIdsByParaId=function(t){if(this._presenceDataInOldFormat)return e.prototype.getClientIdsByParaId.call(this,t);var n=this._objectSpace.getObject(w.h.createFromString(t));if(!n)return null;var r=n.getValueWithDefault(Number,B.j.wordId,0);return this.get_paraIdToClientIds()[r.toString()]},t}(oe);(0,l.l)(ae,"5b2718e9$WordPresenceDataManager",oe,[]);var se=n(3040),le=(0,l.y)("18318899$IPresenceUserResolver"),ue=n(7553),ce=n(6923),de=function(){function e(e){this.editorsReplicator=null,this.coauthManager=null,this._disposed=!1,this.coauthManager=e,this.editorsReplicator=e.get_editorsReplicator(),this.get_editorsReplicator()?this.get_editorsReplicator().add_onSuccessfulReplication(l.i(this,this.onAmIAloneChanged,"onAmIAloneChanged")):e.add_startedCoauthoring(l.i(this,this.onStartedCoauthoring,"onStartedCoauthoring"))}return e.prototype.get_editorsReplicator=function(){return this.editorsReplicator},e.prototype.get_coauthManager=function(){return this.coauthManager},e.prototype.onStartedCoauthoring=function(e,t){this.editorsReplicator=this.get_coauthManager().get_editorsReplicator(),this.get_editorsReplicator().add_onSuccessfulReplication(l.i(this,this.onAmIAloneChanged,"onAmIAloneChanged")),this.get_coauthManager().remove_startedCoauthoring(l.i(this,this.onStartedCoauthoring,"onStartedCoauthoring"))},e.prototype.dispose=function(){this._disposed||(this.get_editorsReplicator()?this.get_editorsReplicator().remove_onSuccessfulReplication(l.i(this,this.onAmIAloneChanged,"onAmIAloneChanged")):this.get_coauthManager().remove_startedCoauthoring(l.i(this,this.onStartedCoauthoring,"onStartedCoauthoring")),this._disposed=!0)},e}();(0,l.l)(de,"84631460$SuccessfulReplicationListener",null,[Sys.IDisposable]);var pe=n(2658),ge=n(877),he=(n(1480),function(e){function t(t,n){var r=e.call(this)||this;return r.presenceInfoArray=null,r.clientIdsNotInEditorsTable=null,r.presenceInfoArray=t,r.clientIdsNotInEditorsTable=n,r}return(0,r.t)(t,e),t.prototype.get_presenceInfoArray=function(){return this.presenceInfoArray},t.prototype.get_clientIdsNotInEditorsTable=function(){return this.clientIdsNotInEditorsTable},t}(Sys.EventArgs));(0,l.l)(he,"7a657d68$PresenceUserUpdatedEventArgs",Sys.EventArgs,[]);var _e=function(e){function t(t,n,r,i,o,a){var s=this;s._editorsTableManager=null,s._myPresenceUser=null,s._rtcProxy=null,s._pendingOutboundReplication=!1,s._pendingInboundReplication=!1,s._updateNotificationSent=!1,s._peopleColorUtils=null,s._disposed$1=!1,s._eventSource=new re.f,s._pendingPresence={},(s=e.call(this,t)||this)._editorsTableManager=n,s._rtcProxy=r,s._myPresenceUser=o,s._peopleColorUtils=a;var u=s.CreatePresenceUserFromClientId(s._myPresenceUser.get_clientId());return s.UpdateMyPresenceInfo(u),s._rtcProxy.add_updateNotificationReceived(l.i(s,s.OnUpdateNotificationReceived,"OnUpdateNotificationReceived")),s.ForceOutBoundReplicationOfEditorsTable(),s}return(0,r.t)(t,e),t.prototype.add_userInfoUpdated=function(e){this._eventSource.addHandler(t.UserInfoCompleteEventKey,e)},t.prototype.remove_userInfoUpdated=function(e){this._eventSource.removeHandler(t.UserInfoCompleteEventKey,e)},t.prototype.UpdateMyPresenceInfo=function(e){this._myPresenceUser.get_capabilities().setFlag(e.get_capabilities().capabilities),this._myPresenceUser.set_color(e.get_color()),this._myPresenceUser.set_userName(e.get_userName())},t.prototype.ForceOutBoundReplicationOfEditorsTable=function(){this.get_editorsReplicator()?(P.ULS.sendTraceTag(4289313,302,50,"Creating editors table AddMe request"),this.get_editorsReplicator().forceOutbound(null,null,null)):this._pendingOutboundReplication=!0},t.prototype.ForceInBoundReplicationOfEditorsTable=function(){this.get_editorsReplicator()?this.get_editorsReplicator().forceInbound(null,null,null):this._pendingInboundReplication=!0},t.prototype.onStartedCoauthoring=function(t,n){e.prototype.onStartedCoauthoring.call(this,t,n),this._pendingOutboundReplication&&this.ForceOutBoundReplicationOfEditorsTable(),this._pendingInboundReplication&&this.ForceInBoundReplicationOfEditorsTable()},t.prototype.OnUpdateNotificationReceived=function(e,t){1===t.get_type()&&(P.ULS.sendTraceTag(4289314,302,50,"EditorsTableUpdate notification received"),this.ForceInBoundReplicationOfEditorsTable())},t.prototype.CreatePresenceUserFromClientId=function(e){var t=new X.PresenceUser(e);return this.PopulatePresenceUserWithInfoFromEditorsTable(t),t},t.prototype.PopulatePresenceUserWithInfoFromEditorsTable=function(e){var n=this._editorsTableManager.getCoauthorInfo(e.get_clientId()),r=null;n&&(e.set_isAnonymous(n.IsAnonymous),e.set_isReadOnly(n.IsReadOnly),e.set_userName(e.get_userName()||n.Name),e.set_capabilities(t.CreateUserCapabilitiesFromAuthorCapabilities(n)),r=n.EmailAddress,n.JoinCoauthTime&&e.set_joinTime(n.JoinCoauthTime));var i=n&&n.SIPAddress?n.SIPAddress:e.get_email();e.set_color(this._peopleColorUtils.getUserColor(new pe.r(i,null,e.get_userName(),null,!1,null),3,!0)),e.set_email(r)},t.prototype.onAmIAloneChanged=function(e,n){var r=this.CreatePresenceUserFromClientId(this._myPresenceUser.get_clientId());this._myPresenceUser.getMyUser().equals(r)||!r.isComplete()||this._updateNotificationSent||(this._updateNotificationSent=!0,this.UpdateMyPresenceInfo(r),this._rtcProxy.sendLastUpdateNotificationWhenConnected(1,this._myPresenceUser.get_clientId()),P.ULS.sendTraceTag(4289315,302,50,"Metadata of current user is in Editors Table. Color:{0}",this._myPresenceUser.get_color()));var i=[],o=new Array(0),a=this._pendingPresence;for(var s in a){var l=(g={key:s,value:a[s]}).key;this.CreatePresenceUserFromClientId(l).isComplete()&&(Array.add(i,g.value),Array.add(o,g.key))}for(var u=0;u<o.length;u++)delete this._pendingPresence[o[u]];var c=new Array(0),d=this._rtcProxy.getAllPresence();for(var p in d){var g;l=(g={key:p,value:d[p]}).key;this._editorsTableManager.getCoauthorInfo(l)||Array.add(c,l)}(i.length>0||c.length>0)&&this._eventSource.raiseEvent(t.UserInfoCompleteEventKey,new he(i,c),null)},t.prototype.dispose=function(){this._disposed$1||(this._rtcProxy.remove_updateNotificationReceived(l.i(this,this.OnUpdateNotificationReceived,"OnUpdateNotificationReceived")),this._disposed$1=!0)},t.CreateUserCapabilitiesFromAuthorCapabilities=function(e){var t=new ge.w(0);return e.Capabilities&&(e.Capabilities.SupportsRealtimeChannel&&t.setFlag(1),e.Capabilities.SupportsRename&&t.setFlag(2),e.Capabilities.SupportsChat&&t.setFlag(4)),t},t.UserInfoCompleteEventKey="UserInfoCompEK",t}(de);(0,l.l)(_e,"f148e2de$PresenceUserInfoResolver",de,[le,Sys.IDisposable]);var fe=function(e){function t(t){var n=this;return n._eventSource=new re.f,n=e.call(this,t)||this}return(0,r.t)(t,e),t.prototype.add_userInfoUpdated=function(e){this._eventSource.addHandler(t.UserInfoCompleteEventKey,e)},t.prototype.remove_userInfoUpdated=function(e){this._eventSource.removeHandler(t.UserInfoCompleteEventKey,e)},t.prototype.onStartedCoauthoring=function(e,t){},t.prototype.onAmIAloneChanged=function(e,t){},t.prototype.dispose=function(){},t.UserInfoCompleteEventKey="UserInfoCompEK",t}(de);(0,l.l)(fe,"a9f0f4ee$PresenceUserInfoResolverStub",de,[le,Sys.IDisposable]);var me=function(){function e(){}return e.colorTable=[13421772,3350485,4686620,10181747,3834860,8922326,5335694,3845359,10665286,5228193,10377133,13747054,5617751,10516312,8222440],e}();(0,l.l)(me,"c59294d2$WordColorTable",null,[]);var ye=function(e){function t(t,n,r,i,o,a){return e.call(this,t,n,r,i,o,a)||this}return(0,r.t)(t,e),t.get_RtcProxyProvider=function(){return t._rtcProxyProvider||(t._rtcProxyProvider=j.w.get_instance().resolve(_.q))},t.tryGetInstanceAsync=function(){return t.CreateInstanceAsync(),t._tcs.get_task()},t.CreateInstanceAsync=function(){K.App.get_theCoauthManagerAsync().CW(t.OnCoauthManagerReady)},t.OnCoauthManagerReady=function(e){t._coauthManager=K.App.get_theCoauthManagerAsync().get_result(),t._coauthManager&&t._coauthManager.get_theEditorsTableManager()?t.get_RtcProxyProvider().getInstanceAsync().CW(t.OnRtcReady):P.ULS.sendTraceTag(4203470,302,15,"Can't initialize the WordPresenceUserInfoResolver because app does not allow coauthoring")},t.OnRtcReady=function(e){var n=t.get_RtcProxyProvider().getInstanceAsync().get_result();if(n){var r=t.GetInstance(n);t._tcs.setResult(r)}else P.ULS.sendTraceTag(4203471,302,15,"Can't initialize the WordPresenceUserInfoResolver because rtcProxy could not be instantiated")},t.GetInstance=function(e){return G.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DeprecateUserInfoResolverIsEnabled")?new fe(t._coauthManager):new t(t._coauthManager,t._coauthManager.get_theEditorsTableManager(),e,me.colorTable,j.w.get_instance().resolve(ue.y),j.w.get_instance().resolve(ce.r))},t._rtcProxyProvider=null,t._coauthManager=null,t._tcs=new N.z(le),t}(_e);(0,l.l)(ye,"66ea6ad3$WordPresenceUserInfoResolver",_e,[]),n.d(t,{o:function(){return ve}});var ve=function(e){function t(n,r,i,o,a,s,l,u,c,d,p,g,h,_,f,m,y,v,S,I,C,T,b,A,M,F,w,R,E){var k=this;return k._wordPresenceCpFactory=null,k._paragraphWordIdMapping=null,k._translator=null,k=e.call(this,n,r,i,o,a,s,l,u,c,d,p,h,_,f,m,S,I,C,T,b,A,M,F,E)||this,g.addActionWithFlags($.u.showPresenceIP_Automation,te.d.application,t.addPresence_Automation,64),g.addActionWithFlags($.u.removePresence_Automation,te.d.application,t.RemovePresence_Automation,64),g.addActionWithFlags($.u.queryRtcConnectionStatus,te.d.application,t.QueryRtcConnectionStatus,96),g.addActionWithFlags(H.u.showPresenceFullTooltipForUser,te.d.application,t.ShowPresenceFullTooltipForUser,64),k._paragraphWordIdMapping=y,k._translator=v,k._wordPresenceCpFactory=w,k._myPresenceUser.set_presenceStatusProvider(R),k._myPresenceUser.get_presenceStatusProvider().add_presenceStatusUpdated(t.OnPresenceStatusUpdated),P.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized"),k}return(0,r.t)(t,e),t.prototype.get_FeatureHelper=function(){return j.w.get_instance().resolve(g.d)},t.prototype.GetParentNode=function(e){if(!e||!e.get_anchor())return null;for(var t=e.get_anchor().get_firstParentLink();t;t=t.get_nextParentLink())if(t.get_isCoreDataModelLink())return t.get_parentAnchor().get_node();return null},t.prototype.buildPresenceIp=function(n){var r=null,i=G.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled")&&G.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ObjectPresenceIsEnabled");if(this.get_FeatureHelper().isFeatureEnabled(128)&&this.get_FeatureHelper().isFeatureEnabled(109)){var o=n.get_firstContext().get_cpBegin(),a=n.get_firstContext().get_node();if(i&&ee.ImageReader.isImageNode(a)&&(a=this.GetParentNode(a)),!a)return P.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;var s=this._getParagraphVersionRep(a),l=n.get_firstContext().get_node().getValueWithDefault(Number,B.j.wordId,0);if(!this._paragraphWordIdMapping)return P.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var u=this._paragraphWordIdMapping.get_value().getParagraphNodeByWordId(l),c=t._objectSpace.getObject(u);if(!c)return P.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+u),null;var d=this._translator.wordTextOffsetFromCp(this._translator.paragraphNodePropsOnGraphNode(c.get_characterData(),c.get_characterProperties()),o);d.contentControlIndicator=-1===n.get_firstContext().get_ccBoundaryIdxAtCpBegin()?0:n.get_firstContext().get_ccBoundaryIdxAtCpBegin();var p=0;i&&n.get_isValidSelectableObject()&&(p=this.GetShapeId(n)),r=new se.t(this._paragraphWordIdMapping.get_value(),l,s,d,this._translator,t._objectSpace,this._wordPresenceCpFactory,p)}else r=e.prototype.buildPresenceIp.call(this,n);return r},t.prototype.GetShapeId=function(e){var t=ee.ImageReader.getImageBlobObjectFromContext(e.get_firstContext());return t?t.properties.getValueWithDefault(Number,B.j.drawingShapeId,0):e.get_firstContext().get_node().get_properties().getValueWithDefault(Number,B.j.drawingShapeId,0)},t.get_AriaNotifier=function(){return j.w.get_instance().resolve(h.u)},t.getInstanceAsync=function(){return t._instanceTcs.get_task()},t.get_instance=function(){return t._presenceSenderInstanceTcs.get_task()},t.getPresenceRemoverAsync=function(){return t._presenceRemoverInstanceTcs.get_task()},t.get_RtcProxyProvider=function(){return t._rtcProxyProvider||(t._rtcProxyProvider=j.w.get_instance().resolve(_.q))},t.init=function(){if(t._presenceSenderInstanceTcs||(t._presenceSenderInstanceTcs=new N.z(s.r)),t._firstTimeInit&&(P.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),t._firstTimeInit=!1),K.App.get_activeAppFrame()){var e=K.App.get_activeAppFrame().workspace;e?(e.add_appIsInteractive(t.OnAppIsInteractive),t._pageView=e.get_contentView(),t._pageView&&t._pageView.get_isPageView()?(t._graphSpaceReplicator=e.get_activePage().get_contentReplicator(),t._graphSpaceReplicator?(t._objectSpace=e.get_activePage().get_contentObjectSpace(),t._objectSpace?t.get_RtcProxyProvider().getInstanceAsync().CW(t.OnRtcProxyReadyAsync):P.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):P.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):P.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):P.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else P.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")},t.OnRtcProxyReadyAsync=function(e){t._rtcProxy=t.get_RtcProxyProvider().getInstanceAsync().get_result(),t._rtcProxy?ye.tryGetInstanceAsync().CW(t.OnPresenceUserInfoResolverReady):P.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")},t.OnPresenceUserInfoResolverReady=function(e){var n=ye.tryGetInstanceAsync().get_result();if(n){var r=new Array(0);Array.add(r,t._pageView.get_overlayControlProviderRegistry()),Array.add(r,t._pageView.get_editingView().get_overlayControlProviderRegistry());var l=Y.SelectionManager.get_instance(),h=new ae(t._objectSpace,j.w.get_instance().resolve(g.d)),_=new Z(h,l,t.get_AriaNotifier(),t._rtcProxy),f=j.w.get_instance().resolveLazy(o.h),m=j.w.get_instance().resolve(a.l),y=new V.g(8,t.PresenceRenderMetricsUploadIntervalMin),v=j.w.get_instance().resolve(c.d);t._instance=new t(t._rtcProxy,r,t._objectSpace,l,n,v,h,_,t._pageView,t._pageView.get_editingView().get_viewId(),j.w.get_instance().resolve(J.m),G.AFrameworkApplication.get_theActionManager(),t._graphSpaceReplicator,x.ParagraphReader.textLength,x.ParagraphReader.effectiveTextId,j.w.get_instance().resolve(Q.MyPresenceUser),f,m,K.App.theNotebookManager.get_theGraph(),new ne.b,W.y.get_instance(),q.q.taskFromFuture(d.a,j.w.get_instance().resolveFuture(d.a)),G.AFrameworkApplication.appSettingsManager,G.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("Box4ThrottleAndBatchPresenceRendering"),G.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("Box4DoNotRenderPresenceOutOfView"),y,j.w.get_instance().resolve(i.u),j.w.get_instance().resolve(p.d),!K.App.get_canEdit()&&!K.App.get_isReviewer()),P.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created"),t._presenceSenderInstanceTcs.setResult(t._instance),t._instanceTcs.setResult(t._instance),t._presenceRemoverInstanceTcs.setResult(t._instance);var S=j.w.get_instance();S.register(t).as(u).as(s.r).singleInstance().usingFactory((function(){return t._instance})),S.resolve(t)}else P.ULS.sendTraceTag(4203469,302,15,"Can't initialize the WordPresenceManager because it can't get handle of the WordPresenceUserInfoResolver instance")},t.OnAppIsInteractive=function(e,n){if(!t._instance){P.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again");var r=(0,m.e)(f.l,e);r&&r.remove_appIsInteractive(t.OnAppIsInteractive),t.init()}},t.OnPresenceStatusUpdated=function(e,n){t._instance.sendCurrentSelection()},t.addPresence_Automation=function(e,n,r,i,o){var a=o.split(",");if(!a||3!==a.length)return 8;var s=a[0].trim(),l=a[1].trim(),u=Number.parseInvariant(a[2].trim()),c=new k.l(new X.PresenceUser(s),new D.b(l,u,-1,0));if(!t._instanceTcs.get_task().get_isCompleted())return 8;var d=t.getInstanceAsync().get_result();return d.addOrUpdateUserPresence(c,!1),d.renderAllAffectedParagraphs(!1),32},t.RemovePresence_Automation=function(e,n,r,i,o){if(!t._instanceTcs.get_task().get_isCompleted())return 8;var a=t.getInstanceAsync().get_result();return a.removeUserPresence(o),a.renderAllAffectedParagraphs(!1),32},t.ShowPresenceFullTooltipForUser=function(e,n,r,i,o){if(!t._instanceTcs.get_task().get_isCompleted())return 8;var a=t.getInstanceAsync().get_result();return a?(a.showPresenceFullTooltipForUser(o),32):8},t.QueryRtcConnectionStatus=function(e,n,r,i,o){if(1===r)return 32;if(!t.get_RtcProxyProvider().getInstanceAsync().get_isCompleted())return 8;var a=t.get_RtcProxyProvider().getInstanceAsync().get_result(),s=o;return a?(2===a.get_connectionState()?s[z.i.Value]=WordEditorIntl.WordEditorStrings.L_RtcConnected:1===a.get_connectionState()?s[z.i.Value]=WordEditorIntl.WordEditorStrings.L_RtcConnecting:s[z.i.Value]="",32):(P.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8)},t.PresenceRenderMetricsUploadIntervalMin=5,t._instance=null,t._firstTimeInit=!0,t._presenceSenderInstanceTcs=new N.z(s.r),t._instanceTcs=new N.z(t),t._presenceRemoverInstanceTcs=new N.z(u),t._objectSpace=null,t._pageView=null,t._graphSpaceReplicator=null,t._rtcProxy=null,t._rtcProxyProvider=null,t}(L);(0,l.l)(ve,"3778f419$WordPresenceManager",L,[])},5128:function(e,t,n){"use strict";n.r(t),n.d(t,{FrameTimingPackageManager:function(){return p}});var r=n(363),i=n(8192),o=n(7597),a=n(2575),s=n(1135),l=n(2612),u=n(1526),c=n(8996),d=n(423),p=function(){function e(){this._reportFrameTimingHandler=null,this._frameTimingMeter=null,this._reportingIntervalInSeconds=0}return e.prototype.get_name=function(){return"WordEditor.FrameTiming"},e.prototype.configure=function(e){this._frameTimingMeter=new EventTiming.FrameTimingMeter,this._reportingIntervalInSeconds=a.AFrameworkApplication.appSettingsManager.getIntAppSetting("FrameTimingMeterReportingIntervalInSeconds",60),this._reportingIntervalInSeconds<=0&&(this._reportingIntervalInSeconds=60),this._reportFrameTimingHandler=function(e){var t=e.rawEvent;if(t){var n=t.detail;o.ULS.sendTraceTag(24962208,306,50,c.x.serialize(n))}},l.n.addHandler(window.self,s.d.reportFrameTiming,this._reportFrameTimingHandler)},e.prototype.init=function(){this._frameTimingMeter&&this._frameTimingMeter.start(this._reportingIntervalInSeconds)},e.prototype.dispose=function(){this._frameTimingMeter&&(this._frameTimingMeter.stop(),this._frameTimingMeter=null),this._reportFrameTimingHandler&&(l.n.removeHandler(window.self,s.d.reportFrameTiming,this._reportFrameTimingHandler),this._reportFrameTimingHandler=null)},e.main=function(){u.o.get_instance().registerPackage(new e,0,!1)},e}();(0,d.l)(p,"de86fb0d$FrameTimingPackageManager",null,[r.u,i.s])},5373:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});var r=(0,n(423).y)("154508ff$IRtcProxyProvider")},5380:function(e,t,n){"use strict";n.r(t),t.default=window.TellMeAdditionalControls={name:"CommandUI",attrs:{},children:[{name:"FlyoutAnchor",attrs:{Id:"WordCountFlyout",Command:"0x2F9A3D80",CommandMenuOpen:"0x2F9A3D80",CommandMenuClose:"0x2F9A3D80",Image16by16:"IMGMAP@we@WordCountList_16x16x32",LabelText:"STR@L_SpbWordCountAlt",PopulateDynamically:"true",PopulateOnlyOnce:"true",PopulateQueryCommand:"0xE8A1E65C"}},{name:"Button",attrs:{Id:"SelectAllButton",Command:"0x148D0534",Image16by16:"IMGMAP@we@SelectAll_16x16x32",LabelText:"STR@L_SelectAllButton"}},{name:"Button",attrs:{Id:"SynonymButton",Command:"0x68B14EC4",Image16by16:"IMGMAP@we@Insights_16x16x32",LabelText:"STR@L_TellMeButtonLabel_Synonyms"}},{name:"Button",attrs:{Id:"DefinitionButton",Command:"0x68B14EC4",Image16by16:"IMGMAP@we@Insights_16x16x32",LabelText:"STR@L_TellMeButtonLabel_Definitions"}},{name:"FlyoutAnchor",attrs:{Id:"TrackChangesUpSellButton",LabelText:"STR@L_TrackChangesUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordTrackChanges",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"ShapesUpSellButton",LabelText:"STR@L_ShapesUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordShapes",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"LabelsUpSellButton",LabelText:"STR@L_LabelsUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordLabel",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"InsertCitationUpSellButton",LabelText:"STR@L_InsertCitationUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordCitations",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"TextBoxUpSellButton",LabelText:"STR@L_TextBoxUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordTextBox",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"TableOfContentsUpSellButton",LabelText:"STR@L_TableOfContentsUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordTableOfContent",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"SmartArtUpSellButton",LabelText:"STR@L_SmartArtUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordSmartArt",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"WordArtUpSellButton",LabelText:"STR@L_WordArtUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordWordArt",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"MultiColumnLayoutUpSellButton",LabelText:"STR@L_MultiColumnLayoutUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordMultiColumnLayout",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"InsertEquationUpSellButton",LabelText:"STR@L_InsertEquationUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]},{name:"MenuSection",attrs:{Id:"UpSellInformationMenuSection",ShowMenuSectionSeparator:"false",DisplayMode:"Menu48"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"jbtnTryOfficeThroughTellMeForWordEquation",LabelText:"STR@L_DesktopUpSellTitle",Description:"STR@L_DesktopUpSellDescription",Image48by48:"IMGMAP@we@TryOffice_48x48x32",Command:"0x0CDCFF89"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"TrackChangesUpSellButtonEnterprise",LabelText:"STR@L_TrackChangesUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"ShapesUpSellButtonEnterprise",LabelText:"STR@L_ShapesUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"LabelsUpSellButtonEnterprise",LabelText:"STR@L_LabelsUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"InsertCitationUpSellButtonEnterprise",LabelText:"STR@L_InsertCitationUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"TextBoxUpSellButtonEnterprise",LabelText:"STR@L_TextBoxUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"TableOfContentsUpSellButtonEnterprise",LabelText:"STR@L_TableOfContentsUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"SmartArtUpSellButtonEnterprise",LabelText:"STR@L_SmartArtUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"WordArtUpSellButtonEnterprise",LabelText:"STR@L_WordArtUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"MultiColumnLayoutUpSellButtonEnterprise",LabelText:"STR@L_MultiColumnLayoutUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"FlyoutAnchor",attrs:{Id:"InsertEquationUpSellButtonEnterprise",LabelText:"STR@L_InsertEquationUpSell",Command:"0x2F9A3D80"},children:[{name:"Menu",attrs:{Id:"menuUpSell"},children:[{name:"MenuSection",attrs:{DisplayMode:"Menu48",Title:"STR@L_DesktopFeature"},children:[{name:"Controls",attrs:{},children:[{name:"Button",attrs:{Id:"UpSellOpenInClient",LabelText:"STR@L_OpenInDesktopWord",Description:"STR@L_OpenInDesktopDescription",Image48by48:"IMGMAP@we@Word_48x48x32",Command:"0xD5DF198A"}}]}]}]}]},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104124372",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_Translator",Description:"STR@L_TellMeAppDescription_Translator",LabelText:"STR@L_TellMeAppTitle_Translator"}},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104178141",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_PicHit",Description:"STR@L_TellMeAppDescription_PicHit",LabelText:"STR@L_TellMeAppTitle_PicHit"}},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104051163",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_QR4Office",Description:"STR@L_TellMeAppDescription_QR4Office",LabelText:"STR@L_TellMeAppTitle_QR4Office"}},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104379279",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_SymbolsCharacters",Description:"STR@L_TellMeAppDescription_SymbolsCharacters",LabelText:"STR@L_TellMeAppTitle_SymbolsCharacters"}},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104320163",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_WordToHTML",Description:"STR@L_TellMeAppDescription_WordToHTML",LabelText:"STR@L_TellMeAppTitle_WordToHTML"}},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104374368",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_MapIt",Description:"STR@L_TellMeAppDescription_MapIt",LabelText:"STR@L_TellMeAppTitle_MapIt"}},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104043061",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_AbbreviationList",Description:"STR@L_TellMeAppDescription_AbbreviationList",LabelText:"STR@L_TellMeAppTitle_AbbreviationList"}},{name:"Button",attrs:{Id:"btnTellMeOfficeAddIn.WA104379673",Command:"0x67ED56AC",Image16by16:"STR@L_TellMeAppIconUrl_HandyCalculator",Description:"STR@L_TellMeAppDescription_HandyCalculator",LabelText:"STR@L_TellMeAppTitle_HandyCalculator"}}]}},5483:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(389),o=(0,r.y)("1cef969d$IChildNodeListMerge"),a=n(5214),s=n(1822),l=n(4455),u=n(1308),c=n(3795),d=n(3748),p=n(5479),g=n(8540),h=n(5999),_=n(9636),f=n(4192),m=n(3545),y=n(6812),v=function(e){function t(){return e.call(this)||this}return(0,m.t)(t,e),t.prototype.get_failureType=function(){return"ChildNodeListMerge"},t}(y.d);(0,r.l)(v,"5350b65$ChildNodeListMergeFailureDetail",y.d,[]);var S=(0,r.y)("b259960a$IChildNodeListMergeUtils"),I=function(){function e(){}return e.prototype.tryGetObjectFromRevision=function(e,t,n){return t.getOrElse(e,n.get_item(e))},e.prototype.tryGetLatestRelevantObject=function(e,t,n,r){var i;return t.tryGetValue(e,(0,s.m)((function(){return i}),(function(e){return i=e})))||n.tryGetValue(e,(0,s.m)((function(){return i}),(function(e){return i=e})))?i:r.get_item(e)},e}();(0,r.l)(I,"e96995c3$ChildNodeListMergeUtils",null,[S]);var C=n(342),T=n(4680),b=function(){return function(e,t){this.classId=0,this.tryTripletMerge=null,this.classId=e,this.tryTripletMerge=t}}();(0,r.l)(b,"50f9a026$NodeChildrenTransformation",null,[]);var A=n(687),M=function(){function e(){this._baseObjectList=new p.o(u.h,null),this._favoredObjectList=new p.o(u.h,null),this._unfavoredObjectList=new p.o(u.h,null)}return e.prototype.get_BaseObjectIds=function(){return this._baseObjectList},e.prototype.get_FavoredChildrenIds=function(){return this._favoredObjectList},e.prototype.get_UnfavoredChildrenIds=function(){return this._unfavoredObjectList},e.prototype.get_IsEmpty=function(){return!this._baseObjectList.get_length()&&!this._favoredObjectList.get_length()&&!this._unfavoredObjectList.get_length()},e.prototype.get_MaxSize=function(){return Math.max(Math.max(this._baseObjectList.get_length(),this._favoredObjectList.get_length()),this._unfavoredObjectList.get_length())},e.prototype.get_MinSize=function(){return Math.min(Math.min(this._baseObjectList.get_length(),this._favoredObjectList.get_length()),this._unfavoredObjectList.get_length())},e.prototype.appendBase=function(e){this._baseObjectList.add(e)},e.prototype.appendFavored=function(e){this._favoredObjectList.add(e)},e.prototype.appendUnfavored=function(e){this._unfavoredObjectList.add(e)},e}();(0,r.l)(M,"8cdd34a7$ObjectCollection",null,[]);var P=function(){function e(e,t,n){this.mergeState=null,this.mergeableObjectUtilities=null,this.utils=null,this.success=!1,this.mergeState=e,this.mergeableObjectUtilities=t,this.utils=n,this.success=!0}return e.prototype.get_mergeState=function(){return this.mergeState},e.prototype.get_mergeableObjectUtilities=function(){return this.mergeableObjectUtilities},e.prototype.get_utils=function(){return this.utils},e.prototype.get_success=function(){return this.success},e.prototype.GetParentWordSectionForOutlineGroupDict=function(){var e=this;g.p.get_instance().traceTag(4220310,1,4,"Evaluating ParentObjects");var t=new c.e(u.h,u.h);return this.BuildParentObjectsForRevision(t,(function(t){return e.get_mergeState().runtime.BaseObjects.get_item(t)})),this.BuildParentObjectsForRevision(t,(function(t){return e.get_utils().tryGetObjectFromRevision(t,e.get_mergeState().runtime.FavoredObjects,e.get_mergeState().runtime.BaseObjects)})),this.BuildParentObjectsForRevision(t,(function(t){return e.get_utils().tryGetObjectFromRevision(t,e.get_mergeState().runtime.UnfavoredObjects,e.get_mergeState().runtime.BaseObjects)})),t},e.prototype.BuildParentObjectsForRevision=function(e,t){var r=this,i=t(n(5483).ChildNodeListMerge.PageContentNodeObjectId);this.get_mergeableObjectUtilities().getPropertyObjectIds(i,l.b.elementNodes).forEach((function(n){return r.get_mergeableObjectUtilities().getPropertyObjectIds(t(n),l.b.elementNodes).forEach((function(t){return e.containsKey(t)&&!n.equals(e.get_item(t))&&(r.success=!1,g.p.get_instance().traceTag(4220311,1,1,"OutlineGroup {0} should have parent {1} but instead has a different parent {2}.",t,n,e.get_item(t))),e.set_item(t,n),!0})),!0}))},e}();(0,r.l)(P,"2b9533f5$OutlineGroupParentFinder",null,[]);var F=n(833),w=n(3217);n.d(t,{ChildNodeListMerge:function(){return R}});var R=function(){function e(e,t,n,r,i){this.mergeableObjectUtilities=null,this.paragraphMergeFunction=null,this.nodeChildrenTransformationFunctions=null,this.mergeChildNodeListsFunctions=null,this.utils=null,this.mergeableObjectUtilities=e||new f.s,this.paragraphMergeFunction=t||C.q.tryParagraphMerge,this.nodeChildrenTransformationFunctions=n||this.GetNodeChildrenTransformationFunctions(),this.utils=r||new I,this.mergeChildNodeListsFunctions=i||this.GetMergeChildNodeListsFunctions()}return e.prototype.get_mergeableObjectUtilities=function(){return this.mergeableObjectUtilities},e.prototype.GetNodeChildrenTransformationFunctions=function(){return[new b(393227,r.i(this,this.PageContentNodeThreewayChildMerge,"PageContentNodeThreewayChildMerge")),new b(1073872968,r.i(this,this.WordSectionNodeThreewayChildMerge,"WordSectionNodeThreewayChildMerge")),new b(393241,r.i(this,this.OutlineElementContainerThreewayChildMerge,"OutlineElementContainerThreewayChildMerge")),new b(393252,r.i(this,this.TableCellThreewayChildMerge,"TableCellThreewayChildMerge")),new b(1074135125,r.i(this,this.OutlineElementContainerThreewayChildMerge,"OutlineElementContainerThreewayChildMerge")),new b(1074135123,r.i(this,this.OutlineElementContainerThreewayChildMerge,"OutlineElementContainerThreewayChildMerge")),new b(1074135127,r.i(this,this.OutlineElementContainerThreewayChildMerge,"OutlineElementContainerThreewayChildMerge"))]},e.prototype.GetMergeChildNodeListsFunctions=function(){return[r.i(this,this.PrepareObjectGroupings,"PrepareObjectGroupings"),r.i(this,this.HandleInterOutlineGroupMerge,"HandleInterOutlineGroupMerge"),r.i(this,this.PerformThreewayChildMerge,"PerformThreewayChildMerge")]},e.prototype.mergeChildNodeLists=function(e){for(var t=0;t<this.mergeChildNodeListsFunctions.length;t++){if(!(0,this.mergeChildNodeListsFunctions[t])(e))return g.p.get_instance().traceTag(4273296,1,3,"MergeChildNodeLists: Merged failed. [Function: {0}]",t),e.logger.logMergeFunctionChain("ChildNodeListMerge.GetMergeChildNodeListsFunctions()",t),!1}return!0},e.prototype.PrepareObjectGroupings=function(t){var n=new c.e(_.g,h.u.$$(i.v)),r=new c.e(_.g,h.u.$$(i.v)),o=new d.f(u.h);t.runtime.FavoredObjects.forEach((function(t,r){return e.PartitionObjectByClassId(r,n)})),t.runtime.UnfavoredObjects.forEach((function(t,n){return e.PartitionObjectByClassId(n,r)}));for(var a=function(e){var i=s.nodeChildrenTransformationFunctions[e].classId;t.runtime.NodeTripletsByClassId.set_item(i,new c.e(u.h,A.x)),n.containsKey(i)&&n.get_item(i).forEach((function(e){var n=t.runtime.BaseObjects.get_item(e.get_id());if(n){var r=new A.x(n,e,t.runtime.UnfavoredObjects.getOrElse(e.get_id(),n));t.runtime.NodeTripletsByClassId.get_item(i).add(e.get_id(),r),o.add(e.get_id())}return!0})),r.containsKey(i)&&r.get_item(i).forEach((function(e){if(o.contains(e.get_id()))return!0;var n=t.runtime.BaseObjects.get_item(e.get_id());return n&&t.runtime.NodeTripletsByClassId.get_item(i).add(e.get_id(),new A.x(n,n,e)),!0}))},s=this,l=0;l<this.nodeChildrenTransformationFunctions.length;l++)a(l);return t.runtime.ThrowIfTimeElapsed("PrepareObjectGroupings"),t.logger.logMergeTimestep("PrepareObjectGroupings"),!0},e.prototype.PerformThreewayChildMerge=function(e){for(var t=!0,n=function(n){var i=r.nodeChildrenTransformationFunctions[n],o=i.classId;e.runtime.NodeTripletsByClassId.get_item(o).forEach((function(n,r){return e.runtime.ChildMergeSkippableIds.contains(r.BaseObject.get_id())||(t=i.tryTripletMerge(e,r)&&t),t||(g.p.get_instance().traceTag(4273297,1,3,"PerformThreewayChildMerge: Failed. [ClassId: {0}] [BaseObject.Id: {1}]",o,r.BaseObject.get_id()),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"PerformThreewayChildMerge",eventId:"aqtsr"}))),t})),e.runtime.ThrowIfTimeElapsed("PerformThreewayChildMerge"+n)},r=this,i=0;t&&i<this.nodeChildrenTransformationFunctions.length;i++)n(i);return e.logger.logMergeTimestep("PerformThreewayChildMerge"),t},e.prototype.PageContentNodeThreewayChildMerge=function(e,t){return!t.propertyIsDifferent(l.b.elementNodes)||(g.p.get_instance().traceTag(4030551,1,3,"Punting attempted merge as there appears to be an added or removed WordSection."),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"PageContentNodeThreewayChildMerge",eventId:"apybx"})),!1)},e.prototype.WordSectionNodeThreewayChildMerge=function(e,t){if(t.propertyIsDifferent(l.b.elementNodes)){var n=new d.f(u.h),r=new d.f(u.h),i=new d.f(u.h),o=new d.f(u.h),s=this.get_mergeableObjectUtilities().getPropertyObjectIds(t.BaseObject,l.b.elementNodes),c=s.toHashSet();if(!this.VerifyWordSectionChildren(t.FavoredObject,c,n,"Favored")||!this.VerifyWordSectionChildren(t.UnfavoredObject,c,r,"Unfavored"))return e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"WordSectionNodeThreewayChildMerge",info:"Unexpected OG node added"})),!1;s.forEach((function(e){return n.contains(e)||i.add(e),r.contains(e)||o.add(e),!0}));for(var g=t.BaseObject.cloneForMerge(),h=new p.o(u.h,null),_=0;_<s.get_length();_++){var f=s.getItemAt(_);if(i.contains(f)||o.contains(f)){if(e.runtime.ChildMergeSkippableIds.add(f),!h.get_length())continue;var m=h.getItemAt(h.get_length()-1),y=e.runtime.NodeTripletsByClassId.get_item(393241).get_item(m),S=e.runtime.NodeTripletsByClassId.get_item(393241).get_item(f);if(!y||!S)continue;i.contains(f)?o.contains(f)||(y.BaseObject=y.BaseObject.cloneForMerge(),y.UnfavoredObject=y.UnfavoredObject.cloneForMerge(),this.AppendElementNodes(y.BaseObject,S.BaseObject),this.AppendElementNodes(y.UnfavoredObject,S.UnfavoredObject)):(y.BaseObject=y.BaseObject.cloneForMerge(),y.FavoredObject=y.FavoredObject.cloneForMerge(),this.AppendElementNodes(y.BaseObject,S.BaseObject),this.AppendElementNodes(y.FavoredObject,S.FavoredObject))}else h.add(f)}this.get_mergeableObjectUtilities().setPropertyObjectIds(g,l.b.elementNodes,h);var I=new F.o(g,!0);I.addTouchedProperty(l.b.elementNodes),e.runtime.MergedObjects.set_item(g.get_id(),I)}return!0},e.prototype.AppendElementNodes=function(e,t){var n=e,r=this.get_mergeableObjectUtilities().getPropertyObjectIds(n,l.b.elementNodes),i=this.get_mergeableObjectUtilities().getPropertyObjectIds(t,l.b.elementNodes),o=r.shallowClone();i.forEach((function(e){return o.add(e),!0})),this.get_mergeableObjectUtilities().setPropertyObjectIds(n,l.b.elementNodes,o)},e.prototype.VerifyWordSectionChildren=function(e,t,n,r){var i=!0;return this.get_mergeableObjectUtilities().getPropertyObjectIds(e,l.b.elementNodes).forEach((function(e){return t.contains(e)?(n.add(e),!0):(i=!1,g.p.get_instance().traceTag(4273298,1,3,"VerifyWordSectionChildren {0}: Failed to find {1} in baseObjects.",r,e),!1)})),i},e.prototype.HandleInterOutlineGroupMerge=function(e){var t=this,n=!0;return e.runtime.NodeTripletsByClassId.get_item(393241).forEach((function(r,i){if(t.IsInterOutlineGroupMergeRequired(i)){var o,l;g.p.get_instance().traceTag(4220302,1,3,"OutlineGroup {0} requires inter-OG merge.",i.BaseObject.get_id());var u=new P(e,t.get_mergeableObjectUtilities(),t.utils);if(t.TryFindOutlineGroupCollectionForMerge(e,u.GetParentWordSectionForOutlineGroupDict(),i,(0,s.m)((function(){return o}),(function(e){return o=e})),(0,s.m)((function(){return l}),(function(e){return l=e}))))return g.p.get_instance().traceTag(4220303,1,3,"Merging WordSection {0} as a unit.",l),(n=u.get_success()&&t.MergeWordSectionContent(e,l,o)&&n)||(g.p.get_instance().traceTag(4273299,1,2,"Inter-OG merge failed. [ObjectId: {0}] [OutlineGroupParentFinder.Success: {1}].",i.BaseObject.get_id(),u.get_success()),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"HandleInterOutlineGroupMerge",eventId:"aqtst",info:String.format("Inter-OG Failure [OutlineGroupParentFinder.Success: {0}]",u.get_success())}))),n}return!0})),n},e.prototype.IsInterOutlineGroupMergeRequired=function(e){if(!e.propertyIsDifferent(l.b.elementNodes))return!1;var t=this.get_mergeableObjectUtilities().getPropertyObjectIds(e.BaseObject,l.b.elementNodes).get_item(0),n=this.get_mergeableObjectUtilities().getPropertyObjectIds(e.FavoredObject,l.b.elementNodes),r=this.get_mergeableObjectUtilities().getPropertyObjectIds(e.UnfavoredObject,l.b.elementNodes);return!n.contains(t,(function(e,t){return e.equals(t)}))||!r.contains(t,(function(e,t){return e.equals(t)}))},e.prototype.TryFindOutlineGroupCollectionForMerge=function(e,t,n,r,i){if(i.val=t.get_item(n.BaseObject.get_id()),g.p.get_instance().traceTag(4220304,1,3,"While inspecting OG {0}, it appears an inter-OG merge is taking place. All children of WordSection {1} will be merged as a unit.",n.BaseObject.get_id(),i.val),e.runtime.ChildMergeSkippableIds.contains(i.val))return g.p.get_instance().traceTag(4220305,1,4,"Trying to merge WordSection {0} for an inter-OG merge, but an another OG caused us to do that already. Skipping the attempt.",i.val),r.val=null,!1;var o=new M,a=e.runtime.BaseObjects.get_item(i.val);this.get_mergeableObjectUtilities().getPropertyObjectIds(a,l.b.elementNodes).forEach((function(e){return o.appendBase(e),!0}));var s=this.utils.tryGetObjectFromRevision(i.val,e.runtime.FavoredObjects,e.runtime.BaseObjects);this.get_mergeableObjectUtilities().getPropertyObjectIds(s,l.b.elementNodes).forEach((function(e){return o.appendFavored(e),!0}));var u=this.utils.tryGetObjectFromRevision(i.val,e.runtime.UnfavoredObjects,e.runtime.BaseObjects);return this.get_mergeableObjectUtilities().getPropertyObjectIds(u,l.b.elementNodes).forEach((function(e){return o.appendUnfavored(e),!0})),r.val=o,!0},e.prototype.PreprocessRevisionOutlineGroups=function(e,t,n,r,i){var o=this,a=!0;return e.forEach((function(e){var s=t(e);return o.get_mergeableObjectUtilities().getPropertyObjectIds(s,l.b.elementNodes).forEach((function(t){return n.add(t),r.containsKey(t)?((a=r.get_item(t).equals(e)&&a)||g.p.get_instance().traceTag(4273300,1,2,"PreprocessRevisionOutlineGroups {0}: Failed. [OutlineElementId: {1}] [OutlineGroupId: {2}] [OutputMapping: {3}]",i,t,e,r.get_item(t)),a):(r.set_item(t,e),!0)})),!0})),a},e.prototype.GetOutlineElementsFromOutlineGroupCollection=function(e,t,n,r,i,o){var a=this;n.val=new p.o(u.h,null),r.val=new p.o(u.h,null),i.val=new p.o(u.h,null),o.val=new c.e(u.h,u.h);var s=e.runtime.BaseObjects;return!!this.PreprocessRevisionOutlineGroups(t.get_BaseObjectIds(),(function(e){return s.get_item(e)}),n.val,o.val,"Base")&&(!!this.PreprocessRevisionOutlineGroups(t.get_FavoredChildrenIds(),(function(t){return a.utils.tryGetObjectFromRevision(t,e.runtime.FavoredObjects,s)}),r.val,o.val,"Favored")&&!!this.PreprocessRevisionOutlineGroups(t.get_UnfavoredChildrenIds(),(function(t){return a.utils.tryGetObjectFromRevision(t,e.runtime.UnfavoredObjects,s)}),i.val,o.val,"Unfavored"))},e.prototype.FinishInterOutlineGroupMerge=function(e,t,n,r){var i=this,o=!0,s=e.runtime.BaseObjects,d=e.runtime.FavoredObjects,_=e.runtime.UnfavoredObjects,f=e.runtime.MergedObjects,m=new p.o(u.h,null),y=new c.e(u.h,h.u.$$(u.h));if(n.forEach((function(t){var n=r.get_item(t);return n?(n.equals(m.last())||(m.add(n),y.add(n,new p.o(u.h,null))),y.get_item(n).add(t),e.runtime.ChildMergeSkippableIds.add(t),!0):(g.p.get_instance().traceTag(4220306,1,1,"OutlineElementId {0} does not have an OutlineGroup parent in oeToOgMapping.",t),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"FinishInterOutlineGroupMerge",eventId:"aqgws"})),o=!1,!1)})),!o)return!1;y.forEach((function(t,n){var r=i.utils.tryGetLatestRelevantObject(t,d,_,s).cloneForMerge();return i.get_mergeableObjectUtilities().setPropertyObjectIds(r,l.b.elementNodes,n),f.set_item(t,new F.o(r,!0)),f.get_item(t).addTouchedProperty(l.b.elementNodes),e.runtime.ChildMergeSkippableIds.add(t),o}));var S=this.utils.tryGetLatestRelevantObject(t,d,_,s).cloneForMerge();return this.get_mergeableObjectUtilities().setPropertyObjectIds(S,l.b.elementNodes,m),f.set_item(t,new F.o(S,!0)),f.get_item(t).addTouchedProperty(l.b.elementNodes),e.runtime.ChildMergeSkippableIds.add(t),o},e.prototype.MergeWordSectionContent=function(e,t,n){var r,i,o,a;if(!this.GetOutlineElementsFromOutlineGroupCollection(e,n,(0,s.m)((function(){return r}),(function(e){return r=e})),(0,s.m)((function(){return i}),(function(e){return i=e})),(0,s.m)((function(){return o}),(function(e){return o=e})),(0,s.m)((function(){return a}),(function(e){return a=e}))))return!1;var l=this.PartitionOutlineElements(r,i,o),u=this.OutlineElementCollectionsThreewayChildMerge(e,l);return!!u&&this.FinishInterOutlineGroupMerge(e,t,u,a)},e.prototype.OutlineElementContainerThreewayChildMerge=function(e,t){if(t.propertyIsDifferent(l.b.elementNodes)){var n=this.GetOutlineElementCollectionsFromContainer(t),r=this.OutlineElementCollectionsThreewayChildMerge(e,n);if(!r)return g.p.get_instance().traceTag(4220308,1,1,"OutlineElementContainerThreewayChildMerge: While attempting to merge node {0}, OutlineElementCollectionsThreewayChildMerge returned null list -- rejecting the change.",t.BaseObject.get_id()),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"OutlineElementContainerThreewayChildMerge",eventId:"aqgwu"})),T.e.log(t.BaseObject,"OutlineElementContainerThreewayChildMerge_Base",1),T.e.log(t.FavoredObject,"OutlineElementContainerThreewayChildMerge_Favored",1),T.e.log(t.UnfavoredObject,"OutlineElementContainerThreewayChildMerge_Unfavored",1),!1;var i=t.FavoredObject.cloneForMerge();this.get_mergeableObjectUtilities().setPropertyObjectIds(i,l.b.elementNodes,r),e.runtime.MergedObjects.set_item(i.get_id(),new F.o(i,!0)),e.runtime.MergedObjects.get_item(i.get_id()).addTouchedProperty(l.b.elementNodes)}return!0},e.prototype.TableCellThreewayChildMerge=function(e,t){var n=t.FavoredObject.hasProperty(l.b.elementNodes),r=t.UnfavoredObject.hasProperty(l.b.elementNodes);n&&(n=!!this.get_mergeableObjectUtilities().getPropertyObjectIds(t.FavoredObject,l.b.elementNodes).get_length());r&&(r=!!this.get_mergeableObjectUtilities().getPropertyObjectIds(t.UnfavoredObject,l.b.elementNodes).get_length());return n!==r?(e.logger.logMergeFailureDetail((0,a.m)(new w.g,{info:"TableCell OE missing children, ghost cell likely touched"})),!1):this.OutlineElementContainerThreewayChildMerge(e,t)},e.prototype.GetOutlineElementCollectionsFromContainer=function(e){var t,n,r;return this.GetElementNodesForTriplet(e,(0,s.m)((function(){return t}),(function(e){return t=e})),(0,s.m)((function(){return n}),(function(e){return n=e})),(0,s.m)((function(){return r}),(function(e){return r=e}))),this.PartitionOutlineElements(t,n,r)},e.prototype.OutlineElementCollectionsThreewayChildMerge=function(e,t){var n=this;g.p.get_instance().traceTag(4220309,1,4,"Considering {0} OutlineElement collections for merge.",t.get_length());var r=new p.o(u.h,null),o=!1;return t.forEach((function(l){if(!l)return g.p.get_instance().shipAssertTag(4740611,1,!1,"Mapping is null."),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"OutlineElementCollectionsThreewayChildMerge",eventId:"asfyd"})),o=!1,!1;if(1===l.get_MinSize()&&1===l.get_MaxSize()){var d=l.get_BaseObjectIds().get_item(0),h=l.get_FavoredChildrenIds().get_item(0),_=l.get_UnfavoredChildrenIds().get_item(0);if(d&&d.equals(h)&&d.equals(_))return r.add(d),!0;if(1!==t.get_length())return g.p.get_instance().shipAssertTag(4030554,1,!1,"OutlineElementCollectionsThreewayChildMerge: A 1-1-1 mapping found which somehow contains differing objects. [Base: {0}] [Favored: {1}] [Unfavored: {2}] [Total Collections: {3}].",d,h,_,t.get_length()),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"OutlineElementCollectionsThreewayChildMerge",eventId:"apyb0"})),o=!1,!1}var f,m=new c.e(u.h,u.h),y=new p.o(i.v,null),S=new p.o(i.v,null),I=new p.o(i.v,null),C=e.runtime.BaseObjects;return l.get_BaseObjectIds().forEach((function(t){return o=n.ProcessOutlineElement(e,t,(function(e){return C.get_item(e)}),y,m,"Base")})),o?(l.get_FavoredChildrenIds().forEach((function(t){return o=n.ProcessOutlineElement(e,t,(function(t){return n.utils.tryGetObjectFromRevision(t,e.runtime.FavoredObjects,C)}),S,m,"Favored")})),o?(l.get_UnfavoredChildrenIds().forEach((function(t){return o=n.ProcessOutlineElement(e,t,(function(t){return n.utils.tryGetObjectFromRevision(t,e.runtime.UnfavoredObjects,C)}),I,m,"Unfavored")})),o?n.paragraphMergeFunction(e,y,S,I,(0,s.m)((function(){return f}),(function(e){return f=e})))&&f?(f.forEach((function(t){return t.getTouchedProperties().get_count()>0&&e.runtime.MergedObjects.set_item(t.mergeableObject.get_id(),t),r.add(m.get_item(t.mergeableObject.get_id())),!0})),!0):(o=!1,!1):(g.p.get_instance().traceTag(4285056,1,3,"OutlineElementCollectionsThreewayChildMerge: Failed to process unfavored outlines."),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"OutlineElementCollectionsThreewayChildMerge",eventId:"aqwka"})),!1)):(g.p.get_instance().traceTag(4285027,1,3,"OutlineElementCollectionsThreewayChildMerge: Failed to process favored outlines."),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"OutlineElementCollectionsThreewayChildMerge",eventId:"aqwj9"})),!1)):(g.p.get_instance().traceTag(4285026,1,3,"OutlineElementCollectionsThreewayChildMerge: Failed to process base outlines."),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"OutlineElementCollectionsThreewayChildMerge",eventId:"aqwj8"})),!1)})),o?r:null},e.prototype.ProcessOutlineElement=function(e,t,n,r,i,o){var s=n(t);if(!s)return g.p.get_instance().traceTag(4285057,1,1,"ProcessOutlineElement {0}: Failed to find OutlineElement with [Id: {1}]",o,t),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"ProcessOutlineElement",eventId:"aqwkb",info:String.format("[Revision: {0}] Failed to find OutlineElement",o)})),!1;var u=this.get_mergeableObjectUtilities().getPropertyObjectIds(s,l.b.contentNodes);if(!u||!u.get_length())return g.p.get_instance().traceTag(4285058,1,1,"ProcessOutlineElement {0}: OutlineElement [Id: {1}] has no children.",o,t),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"ProcessOutlineElement",eventId:"aqwkc",info:String.format("[Revision: {0}] OutlineElement has no children",o)})),T.e.log(s,"ProcessOutlineElement_"+o,1),!1;var c=u.getItemAt(0),d=n(c);return d?(r.add(d),i.add(c,t),e.runtime.ChildMergeSkippableIds.add(c),!0):(g.p.get_instance().traceTag(4285059,1,1,"ProcessOutlineElement {0}: Failed to find ParagraphNode with [Id: {1}] as a child of OutlineElement with [Id: {2}]",o,c,t),e.logger.logMergeFailureDetail((0,a.m)(new v,{funcSource:"ProcessOutlineElement",eventId:"aqwkd",info:String.format("[Revision: {0}] Failed to find correct ParagraphNode in OutlineElement",o)})),!1)},e.prototype.GetElementNodesForTriplet=function(e,t,n,r){t.val=this.get_mergeableObjectUtilities().getPropertyObjectIds(e.BaseObject,l.b.elementNodes),n.val=this.get_mergeableObjectUtilities().getPropertyObjectIds(e.FavoredObject,l.b.elementNodes),r.val=this.get_mergeableObjectUtilities().getPropertyObjectIds(e.UnfavoredObject,l.b.elementNodes)},e.prototype.PartitionOutlineElements=function(t,n,r){for(var i=e.FindMatchedGuids(t,n,r),o=0,a=0,s=0,l=new M,u=new p.o(M,null),c=0;c<i.get_length();c++){var d=i.getItemAt(c+1);for(l.appendBase(t.getItemAt(o)),l.appendFavored(n.getItemAt(a)),l.appendUnfavored(r.getItemAt(s)),o++,a++,s++;o<t.get_length()&&(!d||!d.equals(t.getItemAt(o)));)l.appendBase(t.getItemAt(o)),o++;for(;a<n.get_length()&&(!d||!d.equals(n.getItemAt(a)));)l.appendFavored(n.getItemAt(a)),a++;for(;s<r.get_length()&&(!d||!d.equals(r.getItemAt(s)));)l.appendUnfavored(r.getItemAt(s)),s++;u.add(l),l=new M}for(;o<t.get_length();)l.appendBase(t.getItemAt(o)),o++;for(;a<n.get_length();)l.appendFavored(n.getItemAt(a)),a++;for(;s<r.get_length();)l.appendUnfavored(r.getItemAt(s)),s++;return l.get_IsEmpty()||u.add(l),u},e.PartitionObjectByClassId=function(e,t){return t.containsKey(e.get_runtimeClassId())||t.set_item(e.get_runtimeClassId(),new p.o(i.v,null)),t.get_item(e.get_runtimeClassId()).add(e),!0},e.FindMatchedGuids=function(e,t,n){var r=new p.o(u.h,null),i=t.toHashSet(),o=n.toHashSet();return e.forEach((function(e){return i.contains(e)&&o.contains(e)&&r.add(e),!0})),r},e.PageContentNodeObjectId=u.h.createFromString("{4215CA2B-DF37-4aaa-89ED-F1646178CD20}{1}"),e}();(0,r.l)(R,"342caab4$ChildNodeListMerge",null,[o])},5484:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("6d0533e8$IFileNameDialogFactory"),o=n(3019),a=n(363),s=n(8192),l=n(3545),u=(0,r.y)("73c5c39c$IFileNameDialog"),c=n(8027),d=n(7597),p=function(){function e(){}return e.get_dialogHtml=function(){return c.o.formatHtml(e.DialogHtmlFormat,CommonUIStrings.l_SaveACopyFileName)},e.DialogHtmlFormat="<div class='WACDialogRow' id='DocumentFolderBlock'> <label id='lblFolderName' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='DocumentNameBlock'> <label id='lblFileName' class='WACDialogLabel' for='txtFileName' >{0}</label> <input type='text' id='txtFileName' class='WACDialogInput' autocomplete=\"off\"/> </div>",e}();(0,r.l)(p,"8c56ba8c$FileNameDialogHtml",null,[]);var g=n(2575),h=n(6378),_=function(e){function t(n,r,i,o){var a=this;return a._actionManager=null,a._aframeApplication=null,a._uploadToCloudManager=null,a._folderUrl=null,a._folderId=null,a._options=null,(a=e.call(this)||this)._actionManager=n,a._aframeApplication=r,a._uploadToCloudManager=i,a.setButtonText(1,CommonUIStrings.l_SaveButtonLabel),a.set_dialogHtml(p.get_dialogHtml()),a.set_dialogId(t.Id),a._options=o,a}return(0,l.t)(t,e),t.prototype.displayDialog=function(e,n,i){this._folderId=e,this._folderUrl=i;var o={txtFileName:h.l.getFileNameWithoutExtension(g.AFrameworkApplication.docPropertiesProvider.get_breadcrumbDocName()),lblFolderName:String.format(CommonUIStrings.l_DestinationFolder,n)};this.initializeAndShow(CommonUIStrings.l_SaveToOneDrive,r.i(this,this.FileNameDialogHandler,"FileNameDialogHandler"),o),d.ULS.sendTraceTag(7174148,216,50,"The file name dialog is initialized and shown."),document.getElementById(t.FileNameTextbox).focus()},t.prototype.FileNameDialogHandler=function(e,n){if(1!==e)d.ULS.sendTraceTag(7165650,216,50,"User click cancel to cancel upload file in file name dialog.");else{var r=n[t.FileNameTextbox].trim();d.ULS.sendTraceTag(7165651,216,50,"User click save to upload file with new name.");var i=h.l.getFileExtension(g.AFrameworkApplication.fileName);r&&""!==r&&""!==i&&(r+=i),this._uploadToCloudManager.startUpload(this._folderId,this._folderUrl,r,this._options)}},t.FileNameTextbox="txtFileName",t.FolderNameLabel="lblFolderName",t.Id="FileNameDialog-SaveACopy",t}(c.o);(0,r.l)(_,"72961df5$FileNameDialog",c.o,[u]);var f=function(){function e(e,t,n){this._actionManager=null,this._aframeApplication=null,this._uploadToCloudManager=null,this._actionManager=e,this._aframeApplication=t,this._uploadToCloudManager=n}return e.prototype.create=function(e){return new _(this._actionManager,this._aframeApplication,this._uploadToCloudManager,e)},e}();(0,r.l)(f,"98093ac1$FileNameDialogFactory",null,[i]);var m=n(2494),y=n(8530),v=n(9910),S=function(e){function t(t){var n=this;return n._actionManager=null,(n=e.call(this)||this).set_buttonsOption(1),n.setButtonText(1,CommonUIStrings.l_RetryButtonLabel),n.setButtonText(0,CommonUIStrings.l_DialogClose),n._actionManager=t,n}return(0,l.t)(t,e),t.prototype.displayError=function(e){d.ULS.sendTraceTag(7165652,216,50,"Show error dialog here {0}.",e),this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ErrorSavingToOneDrive,r.i(this,this.RetryDialogHandler,"RetryDialogHandler"))},t.prototype.RetryDialogHandler=function(e,t){1===e?(d.ULS.sendTraceTag(7165653,216,50,"User click to retry the action."),this._actionManager.processAction(v.b.saveACopy,2,null)):d.ULS.sendTraceTag(7165654,216,50,"User cancel the error dialog.")},t}(y.StandardDialog);(0,r.l)(S,"3f5777dc$RetryDialog",y.StandardDialog,[m.v]);var I=n(6978),C=n(1991),T=n(3608),b=n(2192),A=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i)||this;return o._oneDriveFilePickerApiManager$1=null,o._oneDriveFilePickerApiManager$1=n,o}return(0,l.t)(t,e),t.prototype.isUIEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("SaveACopyBrsIsEnabled")},t.prototype.getActionId=function(){return v.b.saveACopy},t.prototype.callDownloadQueueActionsForOneDriveApi=function(){T.z.registerDispatchHandler(r.i(this,this.saveToCloudActionDispatcher,"saveToCloudActionDispatcher")),T.z.enqueueActions([new C.f(v.b.saveACopy,b.m.frame,0)],this._oneDriveFilePickerApiManager$1.getOneDriveApi())},t.prototype.recordExecuteTrace=function(){d.ULS.sendTraceTag(7205456,216,50,"User clicked on SaveAs button from the backstage.")},t}(I.j);(0,r.l)(A,"10f60512$SaveACopyActor",I.j,[]);var M=n(6684),P=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,n,r,i,o,a,s)||this;return l._fileNameFactory=null,l._fileNameFactory=t,l}return(0,l.t)(t,e),t.prototype.onSuccess=function(e){e&&e.data&&e.data.folders?(d.ULS.sendTraceTag(7165655,216,50,"User selected which folder to upload file to."),this._fileNameFactory.create(this._options).displayDialog(e.data.folders[0].id,e.data.folders[0].name,e.data.folders[0].urls.viewInBrowser)):(d.ULS.sendTraceTag(7165656,216,10,"Fail to select folder to upload file."),this.showErrorDialog())},t.prototype.onFailure=function(t){t&&t.error&&"user_canceled"===t.error.code&&d.ULS.sendTraceTag(7205457,216,50,"User cancelled upload to their OneDrive in Save A Copy."),e.prototype.onFailure.call(this,t)},t.prototype.showErrorDialog=function(){d.ULS.sendTraceTag(7205458,216,50,"Error occur in Save A Copy Manager."),e.prototype.showErrorDialog.call(this)},t}(M.a);(0,r.l)(P,"7c6cfea$SaveACopyManager",M.a,[]);var F=n(2132),w=function(e){function t(t,n,r,i,o,a){var s=e.call(this,n,r,i,o,a)||this;return s._actionManager=null,s._actionManager=t,s}return(0,l.t)(t,e),t.prototype.showErrorUI=function(){d.ULS.sendTraceTag(7205459,216,50,"Display Error for Save A Copy."),e.prototype.showErrorUI.call(this)},t.prototype.redirectToFolder=function(){d.ULS.sendTraceTag(7205460,216,50,"Redirecting to OneDrive Folder for Save A Copy."),e.prototype.redirectToFolder.call(this)},t.prototype.redirectToEditUrl=function(t){d.ULS.sendTraceTag(7205461,216,50,"Redirecting to edit url {0} for Save A Copy.",t),e.prototype.redirectToEditUrl.call(this,t)},t.prototype.executeUpload=function(){var t=this;if(this._options&&"true"===this._options.SkipSaveToHost)e.prototype.executeUpload.call(this);else if(32!==this._actionManager.processAction(v.b.saveFileChange,1,null))d.ULS.sendTraceTag(8741711,216,15,"The save file change is not supported, this operation may result in data loss"),e.prototype.executeUpload.call(this);else{this._actionManager.processActionWithData(v.b.saveFileChange,2,[function(e){d.ULS.sendTraceTag(8741712,216,50,"Call the force save file change successfully."),F.t.prototype.executeUpload.call(t)},function(e,n){d.ULS.sendTraceTag(8741713,216,15,"The file change is not saved successfully, this operation may lead to data loss."),t.showErrorUI()}],null)}},t}(F.t);(0,r.l)(w,"7aa6c003$SaveACopyUploadToCloudManager",F.t,[]);var R=n(3603),E=n(8939),k=n(1526),D=n(8056),O=n(4311);n.d(t,{PackageManager:function(){return U}});var U=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"Common.App.SaveACopy"},e.prototype.init=function(){g.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(r.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){g.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveACopyBrsIsEnabled")&&this._container.resolve(A).registerActions()},e.prototype.dispose=function(){},e.prototype.configure=function(e){this._container=e,this._container.register(w).usingFactory((function(){return new w(g.AFrameworkApplication.get_theActionManager(),e.resolve(E.p),(function(){return new O.c(!1)}),(function(){return new S(g.AFrameworkApplication.get_theActionManager())}),g.AFrameworkApplication.get_activeFrame(),g.AFrameworkApplication.get_activeFrame().get_theStopwatchBuilder())})).singleInstance(),this._container.register(f).as(i).usingFactory((function(){return new f(g.AFrameworkApplication.get_theActionManager(),g.AFrameworkApplication.get_activeFrame().get_applicationInstance(),e.resolve(w))})).singleInstance(),this._container.register(A).usingFactory((function(){return new A(e.resolve(P),e.resolve(o.v),g.AFrameworkApplication.appSettingsManager,g.AFrameworkApplication.get_activeFrame().get_theStopwatchBuilder())})).singleInstance(),this._container.register(P).usingFactory((function(){return new P(e.resolve(f),e.resolve(R.m),D.SignOutResponse.get_instance(),e.resolve(w),g.AFrameworkApplication.appSettingsManager,g.AFrameworkApplication.get_environment(),(function(){return new S(g.AFrameworkApplication.get_theActionManager())}))})).singleInstance()},e.main=function(){k.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(U,"ba6034b5$PackageManager",null,[a.u,s.s])},5526:function(e,t,n){"use strict";n.d(t,{j:function(){return r}});var r=(0,n(423).y)("2344776a$ISignInDialogFactory")},5554:function(e,t,n){"use strict";n.r(t),t.default={Image16by16:{btnFootnote:"IMGMAP@we@Footnote_16x16x32",btnNewComment:"IMGMAP@we@NewComment_16x16x32",cellShadingColor:"IMGMAP@we@FillColorSplitDropdown_16x16x32",jbtnDirectPrint:"IMGMAP@we@Print_16x16x32",jbtnPrintToPdf:"IMGMAP@we@Print_16x16x32",jbtnTermsOfUse:"IMGMAP@we@Info_16x16x32",jbtnWheresTheSaveButton:"IMGMAP@we@WheresTheSaveButtonMenuItem_16x16x32",jbtnHelp:"IMGMAP@we@OfficeAssistant_16x16x32"},LabelText:{btnDeleteComment:"STR@L_btnDeleteComment_FriendlyLabel",btnEndnote:"STR@L_btnEndnote_FriendlyLabel",btnFootnote:"STR@L_btnFootnote_FriendlyLabel",btnImageGrow:"STR@L_btnImageGrow_FriendlyLabel",btnImageShrink:"STR@L_btnImageShrink_FriendlyLabel",btnjClose:"STR@L_btnjClose_FriendlyLabel",btnNextComment:"STR@L_btnNextComment_FriendlyLabel",btnPreviousComment:"STR@L_btnPreviousComment_FriendlyLabel",btnViewHeaderFooter:"STR@L_btnOpenHeaderFooter_FriendlyLabel",buttonBandedColumn:"STR@L_buttonBandedColumn_FriendlyLabel",buttonBandedRow:"STR@L_buttonBandedRow_FriendlyLabel",buttonFirstColumn:"STR@L_buttonFirstColumn_FriendlyLabel",buttonFirstRow:"STR@L_buttonFirstRow_FriendlyLabel",buttonLastColumn:"STR@L_buttonLastColumn_FriendlyLabel",buttonLastRow:"STR@L_buttonLastRow_FriendlyLabel",buttonMarginsCustom:"STR@L_buttonMarginsCustom_FriendlyLabel",buttonMarginsModerate:"STR@L_buttonMarginsModerate_FriendlyLabel",buttonMarginsNarrow:"STR@L_buttonMarginsNarrow_FriendlyLabel",buttonMarginsNormal:"STR@L_buttonMarginsNormal_FriendlyLabel",buttonMarginsOffice2003:"STR@L_buttonMarginsOffice2003_FriendlyLabel",buttonMarginsWide:"STR@L_buttonMarginsWide_FriendlyLabel",buttonNumberStyle1:"STR@L_buttonNumberStyle1_FriendlyLabel",buttonNumberStyle2:"STR@L_buttonNumberStyle2_FriendlyLabel",buttonNumberStyle3:"STR@L_buttonNumberStyle3_FriendlyLabel",buttonNumberStyle4:"STR@L_buttonNumberStyle4_FriendlyLabel",buttonNumberStyle5:"STR@L_buttonNumberStyle5_FriendlyLabel",buttonOrientationLandscape:"STR@L_buttonOrientationLandscape_FriendlyLabel",buttonOrientationPortrait:"STR@L_buttonOrientationPortrait_FriendlyLabel",buttonSizeA4:"STR@L_buttonSizeA4_FriendlyLabel",buttonSizeA5:"STR@L_buttonSizeA5_FriendlyLabel",buttonSizeExecutive:"STR@L_buttonSizeExecutive_FriendlyLabel",buttonSizeLegal:"STR@L_buttonSizeLegal_FriendlyLabel",buttonSizeLetter:"STR@L_buttonSizeLetter_FriendlyLabel",CenterJustify:"STR@L_CenterJustify_FriendlyLabel",EditingFind:"STR@L_FindInDocument",faAbout:"STR@L_faAbout_FriendlyLabel",faNew:"STR@L_faNew_FriendlyLabel",flyInsertSymbols:"STR@L_InsertSymbolFriendlyName",flyInsertTable:"STR@L_MenuInsertTable",flyOrientation:"STR@L_flyOrientation_FriendlyLabel",flySize:"STR@L_flySize_FriendlyLabel",fseaInsertClipart:"STR@L_fseaInsertClipart_FriendlyLabel",fseaInsertHyperlink:"STR@L_fseaInsertHyperlink_FriendlyLabel",fseaInsertPageBreak:"STR@L_fseaInsertPageBreak_FriendlyLabel",fseaInsertOnlinePicture:"STR@L_fseaInsertOnlinePicture_FriendlyLabel",fseaInsertPicture:"STR@L_fseaInsertPicture_FriendlyLabel",fsfaMoreStyles:"STR@L_fsfaMoreStyles_FriendlyLabel",fsfaMoreTableStyles:"STR@L_fsfaMoreTableStyles_FriendlyLabel",fsfaPageNumbers:"STR@L_fsfaPageNumbers_FriendlyLabel",fsfaTableStyleTheme:"STR@L_fsfaTableStyleTheme_FriendlyLabel",FullJustify:"STR@L_FullJustify_FriendlyLabel","grpPictureFormat.PictureStyleAnchor":"STR@L_grpPictureFormat_PictureStyleAnchor_FriendlyLabel",jbtnDownloadACopy:"STR@L_jbtnDownloadACopy_FriendlyLabel",jbtnFileEmbed:"STR@L_jbtnFileEmbed_FriendlyLabel",jbtnFileSharing:"STR@L_ShareViaEmail",jbtnRenameDialog:"STR@L_jbtnRenameDialog_FriendlyLabel",TextDirLTR:"STR@L_TextDirLTR_FriendlyLabel",TextDirRTL:"STR@L_TextDirRTL_FriendlyLabel",fseaWordCountToggle:"STR@L_WordCountToggleTellMe"},Alt:{EditingFind:null}}},5669:function(e,t,n){"use strict";n.d(t,{c:function(){return i}});var r=n(423),i=function(){return function(e,t,n){this.textIdFinalAbove=null,this.paraIdNew=null,this.textIdNew=null,null!=e&&(this.textIdFinalAbove=e),null!=t&&(this.paraIdNew=t),null!=n&&(this.textIdNew=n)}}();(0,r.l)(i,"189bb82a$AddParaData",null,[])},5902:function(e,t,n){"use strict";n.d(t,{b:function(){return o}});var r=n(8540),i=n(423),o=function(){function e(){}return e.prototype.appendMergeBlock=function(e,t){return e+="[Block: "+t+"] "},e.GetCreator=function(e,t,i,o,a,s,l){return 393230===t.get_runtimeClassId()?new(n(6973).ParagraphMergeBlockCreator)(e,t,i,o,a,s,l):393250===t.get_runtimeClassId()?new(n(4236).TableMergeBlockCreator)(t,i):(r.p.get_instance().traceTag(4051652,1,1,"Trying to Run GetMergeBlockList on unknown Runtime Class ID {0}.",t.get_runtimeClassId()),null)},e}();(0,i.l)(o,"5c620ce9$MergeBlockCreator",null,[])},5941:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});var r=(0,n(423).y)("99a95598$IPresenceSender")},5967:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var r=n(423),i=function(){function e(t,n){this._items=null,this._readIndex=0,this._writeIndex=0,this._capacity=0,this._count=0,this._countForShrinking=0,this._minCapacity=0,r.m(this,e.$$(t)),this._minCapacity=isFinite(n)?Math.max(n,e.$$(r.f(this,"Common.Collections.Queue$1").T).DefaultMinCapacity):e.$$(r.f(this,"Common.Collections.Queue$1").T).DefaultMinCapacity,this._items=new Array(this._minCapacity),this._readIndex=0,this._writeIndex=0,this._count=0,this._countForShrinking=this.GetCountForShrinking(this._minCapacity)}return e.prototype.get_count=function(){return this._count},e.prototype.get_isEmpty=function(){return!this._count},e.prototype.enqueue=function(e){this._count===this._capacity&&this.IncreaseCapacity(),this._items[this._writeIndex]=e,this._writeIndex++,this._writeIndex===this._capacity&&(this._writeIndex=0),this._count++},e.prototype.dequeue=function(){if(!this._count)throw Error.create("Empty Queue");var e=this._items[this._readIndex];return this._readIndex++,this._readIndex===this._capacity&&(this._readIndex=0),this._count--,this._count<=this._countForShrinking&&this.DecreaseCapacity(),e},e.prototype.peek=function(){if(!this._count)throw Error.create("Empty Queue");return this._items[this._readIndex]},e.prototype.IncreaseCapacity=function(){var t=this._capacity*e.$$(r.f(this,"Common.Collections.Queue$1").T).GrowthFactor;this.SetNewBackingArrayWithCapacity(t)},e.prototype.DecreaseCapacity=function(){var t=Math.max(this._capacity/e.$$(r.f(this,"Common.Collections.Queue$1").T).GrowthFactor,this._minCapacity);this._count>t||this.SetNewBackingArrayWithCapacity(t)},e.prototype.SetNewBackingArrayWithCapacity=function(e){var t=new Array(e),n=0;if(this._readIndex<this._writeIndex||!this._count)for(var r=this._readIndex;r<this._writeIndex;r++)t[n]=this._items[r],n++;else{for(r=this._readIndex;r<this._capacity;r++)t[n]=this._items[r],n++;for(r=0;r<this._writeIndex;r++)t[n]=this._items[r],n++}this._items=t,this._capacity=e,this._readIndex=0,this._writeIndex=n,this._countForShrinking=this.GetCountForShrinking(e)},e.prototype.GetCountForShrinking=function(t){return t<=this._minCapacity?-1:Math.floor(t*e.$$(r.f(this,"Common.Collections.Queue$1").T).ShrinkThreshold)},e.$$=function(t){return r.o("Common.Collections.Queue$1",e,[{T:t}],null,[],{DefaultMinCapacity:function(){return 8},GrowthFactor:function(){return 2},ShrinkThreshold:function(){return.25}})},e}()},6039:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("51f43c05$ITrie"),o=n(1822),a=n(9580),s=function(){return function(e){this.nextShorterResult=null,this.succeeded=!1,this.trieId=0,this.isTagged=!1,this.tagValue=0,this.length=0,this.nextShorterResult=e,this.succeeded=!1,this.trieId=e?e.trieId:0,this.isTagged=!1,this.tagValue=0,this.length=0}}();(0,r.l)(s,"63873aa5$TrieResult",null,[]);var l=function(){function e(e,t,n){this.m_lookupString=null,this.m_iChar=0,this.m_endIndex=0,this.m_result=new s(null),this.m_lookupString=e,this.m_iChar=t,this.m_endIndex=t+n-1}return e.prototype.get_result=function(){return this.m_result},e.prototype.getNextChar=function(e){return this.m_iChar<=this.m_endIndex?(e.val=this.m_lookupString.charAt(this.m_iChar),++this.m_iChar,!0):(e.val="\0",!1)},e.prototype.registerTrieEnding=function(e,t,n){e&&(this.m_result.isTagged=!0,this.m_result.tagValue=t),this.m_result.length=this.m_iChar,this.m_result.succeeded=!0,this.m_result.trieId=n,this.m_iChar!==this.m_endIndex+1&&(this.m_result=new s(this.m_result))},e}();(0,r.l)(l,"3605a6d7$LookUpStringVisitor",null,[a.l]);var u=n(6329),c=function(){return function(){this.cCharFlagsCodesMax=0,this.cTagsCodesMax=0,this.cMRPointersCodesMax=0,this.cSROffsetsCodesMax=0,this.cUniqueSROffsets=0,this.cUniqueCharFlags=0,this.cUniqueTags=0,this.cUniqueMRPointers=0,this.cbHeader=0}}();(0,r.l)(c,"20d69ca7$TRIESTATS",null,[]);var d=function(){return function(){this.numOfBytes=0,this.symbol=0,this.numOfBytes=0,this.symbol=0}}();(0,r.l)(d,"6f3818a0$TrieSymbol",null,[]),n.d(t,{h:function(){return p}});var p=function(){function e(t,n){this.m_bytes=null,this.m_fContainsEmptyString=!1,this.m_fEmptyStringTagged=!1,this.m_emptyStringTagValue=0,this.m_stats=null,this.m_iCharFlagsCodes=0,this.m_iTagsCodes=0,this.m_iMRPointersCodes=0,this.m_iSROffsetsCodes=0,this.m_iCharFlags=0,this.m_iTags=0,this.m_iMRPointers=0,this.m_iSROffsets=0,this.m_iTrie=0,this.m_bytes=t;var r=n;if(t.readInt(r,4)!==e.c_MAGIC_NUMBER)throw Error.argument("Input does not represent a trie");r+=4,this.m_fContainsEmptyString=1===t.readInt(r,4),r+=4,this.m_fEmptyStringTagged=1===t.readInt(r,4),r+=4,this.m_emptyStringTagValue=t.readInt(r,4),r+=4;var i=t.readInt(r,4);if(r+=4,i){var o=r;this.m_stats=this.ReadTRIESTATS(o);var a=o+e.c_cBytesInTRIESTATS;if(this.m_iCharFlagsCodes=a,a+=e.c_cBytesInWORD*(this.m_stats.cCharFlagsCodesMax+(this.m_stats.cCharFlagsCodesMax%2?1:0)),this.m_iTagsCodes=a,a+=e.c_cBytesInWORD*(this.m_stats.cTagsCodesMax+(this.m_stats.cTagsCodesMax%2?1:0)),this.m_iMRPointersCodes=a,a+=e.c_cBytesInWORD*(this.m_stats.cMRPointersCodesMax+(this.m_stats.cMRPointersCodesMax%2?1:0)),this.m_iSROffsetsCodes=a,a+=e.c_cBytesInWORD*(this.m_stats.cSROffsetsCodesMax+(this.m_stats.cSROffsetsCodesMax%2?1:0)),this.m_iCharFlags=a,a+=e.c_cBytesInCHARFLAGS*this.m_stats.cUniqueCharFlags,this.m_iTags=a,a+=e.c_cBytesInDWORD*this.m_stats.cUniqueTags,this.m_iMRPointers=a,a+=e.c_cBytesInDWORD*this.m_stats.cUniqueMRPointers,this.m_iSROffsets=a,(a+=e.c_cBytesInDWORD*this.m_stats.cUniqueSROffsets)!==o+this.m_stats.cbHeader)throw Error.argument("Corrupted trie binary");this.m_iTrie=a}else this.m_stats=null}return e.prototype.lookUpString=function(e,t,n,r){var i=new l(e,t,n);return this.visitPrefixes(i,r),i.get_result()},e.prototype.getStringForTrieId=function(t){if(this.m_fContainsEmptyString){if(!t)return"";--t}if(!this.m_stats)throw Error.argument("Invalid trieID");var n=new u.n;n.wFlags=0,this.TrieGetNextState(n);for(var r=[];;){if(n.wFlags&e.TRIE_NODE_VALID){if(!t)return Array.add(r,n.wch),String.fromCharCode.apply(null,r);--t}var i=!!(n.wFlags&e.TRIE_NODE_END),o=this.GetCountOfStringsBelow(n,!0);if(i||t<o){if(Array.add(r,n.wch),!this.TrieGetNextState(n))throw Error.argument("Invalid trieID")}else if(t-=o,!this.TrieGetNextNode(n))throw Error.argument("Invalid trieID")}},e.prototype.visitPrefixes=function(t,n){var r=0;if(this.m_fContainsEmptyString&&(t.registerTrieEnding(this.m_fEmptyStringTagged,this.m_emptyStringTagValue,0),++r),this.m_stats){var i=new u.n;if(i.wFlags=0,this.TrieGetNextState(i))for(var a=function(){var a;if(!t.getNextChar((0,o.m)((function(){return a}),(function(e){return a=e}))))return{value:void 0};n&&(a=n(a));for(var l=a.toString().charCodeAt(0),u=!1;!u;){var c=!!(i.wFlags&e.TRIE_NODE_VALID);if(i.wch===l){if(u=!0,c&&t.registerTrieEnding(!!(i.wFlags&e.TRIE_NODE_TAGGED),i.tagData,r),!s.TrieGetNextState(i))return{value:void 0}}else if(r+=s.GetCountOfStringsBelow(i,!0),!s.TrieGetNextNode(i))return{value:void 0};c&&++r}},s=this;;){var l=a();if("object"==typeof l)return l.value}}},e.prototype.TrieGetNextState=function(t){return t.wFlags?!!(t.wFlags&e.TRIE_NODE_DOWN)&&(t.iSRDown=0,t.iNode=t.iDown,this.TrieDecompressNode(t),!0):(this.TrieDecompressNode(t),!0)},e.prototype.TrieGetNextNode=function(t){return!(t.wFlags&e.TRIE_NODE_END)&&(this.TrieDecompressNode(t),!0)},e.prototype.GetCountOfStringsBelow=function(t,n){return t.wFlags&e.TRIE_NODE_COUNT?t.cWords:t.wFlags&e.TRIE_NODE_DOWN?!n&&t.wFlags&e.TRIE_NODE_END?this.GetCountOfStringsBelowRecursive(t):1:0},e.prototype.GetCountOfStringsBelowRecursive=function(t){if(t=e.CloneTrieScan(t),!this.TrieGetNextState(t))return 0;var n=0;do{t.wFlags&e.TRIE_NODE_VALID&&++n,n+=this.GetCountOfStringsBelow(t,!1)}while(this.TrieGetNextNode(t));return n},e.prototype.TrieDecompressNode=function(t){t.wFlags||(t.iSRDown=0,t.iNode=this.m_iTrie);var n=this.DecompressSymbol(this.m_iCharFlagsCodes,t.iNode),r=n.symbol;t.iNode+=n.numOfBytes;var i=this.m_bytes.readInt(this.m_iCharFlags+e.c_cBytesInCHARFLAGS*r,e.c_cBytesInCHARFLAGS);if(t.wch=65535&i,t.wFlags=i>>16,t.wFlags&e.TRIE_NODE_COUNT&&(t.cWords=this.DecodeCompressedInt(t)),t.wFlags&e.TRIE_NODE_TAGGED){var o=this.DecompressSymbol(this.m_iTagsCodes,t.iNode),a=o.symbol;t.iNode+=o.numOfBytes,t.tagData=this.m_bytes.readInt(this.m_iTags+4*a,4)}if(t.wFlags&e.TRIE_DOWN_ABS)t.iDown=this.m_iTrie+((this.m_bytes.get_item(t.iNode)<<8|this.m_bytes.get_item(t.iNode+1))<<8|this.m_bytes.get_item(t.iNode+2)),t.iNode+=3;else if(t.wFlags&e.TRIE_DOWN_INLINE)t.iDown=t.iNode,t.iSRDown=t.iDown;else if(t.wFlags&e.TRIE_DOWN_MULTI){var s=(l=this.DecompressSymbol(this.m_iMRPointersCodes,t.iNode)).symbol;t.iNode+=l.numOfBytes,t.iDown=this.m_iTrie+this.m_bytes.readInt(this.m_iMRPointers+4*s,4)}else if(t.wFlags&e.TRIE_NODE_DOWN){var l,u=(l=this.DecompressSymbol(this.m_iSROffsetsCodes,t.iNode)).symbol;t.iNode+=l.numOfBytes,t.iSRDown||(t.iSRDown=t.iNode),t.iSRDown+=this.m_bytes.readInt(this.m_iSROffsets+4*u,4),t.iDown=t.iSRDown}},e.prototype.DecompressSymbol=function(e,t){for(var n=new d,r=0;;){r+=this.m_bytes.get_item(t),++t,++n.numOfBytes;var i=this.m_bytes.readInt(e,2);if(r<i)break;n.symbol+=i,r-=i,e+=2,r<<=8}return n.symbol+=r,n},e.prototype.DecodeCompressedInt=function(e){var t=this.m_bytes.get_item(e.iNode);return t>=192?(t=(63&t)<<15,t|=(127&this.m_bytes.get_item(e.iNode+1))<<8,t|=this.m_bytes.get_item(e.iNode+2),e.iNode+=3):t>=128?(t=(127&t)<<8,t|=this.m_bytes.get_item(e.iNode+1),e.iNode+=2):e.iNode+=1,t},e.prototype.ReadTRIESTATS=function(e){var t=new c;return t.cCharFlagsCodesMax=this.m_bytes.readInt(e+12,2),t.cTagsCodesMax=this.m_bytes.readInt(e+14,2),t.cMRPointersCodesMax=this.m_bytes.readInt(e+16,2),t.cSROffsetsCodesMax=this.m_bytes.readInt(e+18,2),t.cUniqueSROffsets=this.m_bytes.readInt(e+24,4),t.cUniqueCharFlags=this.m_bytes.readInt(e+28,4),t.cUniqueTags=this.m_bytes.readInt(e+32,4),t.cUniqueMRPointers=this.m_bytes.readInt(e+36,4),t.cbHeader=this.m_bytes.readInt(e+40,4),t},e.CloneTrieScan=function(e){var t=new u.n;return t.wch=e.wch,t.wFlags=e.wFlags,t.cWords=e.cWords,t.iNode=e.iNode,t.iDown=e.iDown,t.iSRDown=e.iSRDown,t.tagData=e.tagData,t},e.c_MAGIC_NUMBER=1654263084,e.c_cBytesInTRIESTATS=48,e.c_cBytesInWORD=2,e.c_cBytesInDWORD=4,e.c_cBytesInCHARFLAGS=4,e.TRIE_NODE_VALID=1,e.TRIE_NODE_END=2,e.TRIE_NODE_COUNT=4,e.TRIE_NODE_TAGGED=8,e.TRIE_NODE_DOWN=16,e.TRIE_NODE_RIGHT=32,e.TRIE_DOWN_INLINE=64,e.TRIE_DOWN_MULTI=128,e.TRIE_DOWN_ABS=256,e.TRIE_NODE_SKIP=512,e.TRIE_NODE_SKIP_COUNT=1024,e}();(0,r.l)(p,"9f41ed2c$Trie",null,[i])},6068:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var r=(0,n(423).y)("d333fc7b$IParagraphMerge")},6086:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var r=(0,n(423).y)("1b4bd32a$IPresenceBootTelemetry")},6154:function(e,t,n){"use strict";n.r(t);var r=n(773),i=n(363),o=n(8192),a=n(2575),s=n(3772),l=n(4764),u=n(8631),c=n(1526),d=n(5419),p=n(3545),g=n(423),h=(0,g.y)("868821db$IZoomActor"),_=n(9910),f=n(2192),m=function(){function e(e,t,n){this._actionManager=null,this._zoomManager=null,this._appSettingsManager=null,this._actionManager=e,this._zoomManager=t,this._appSettingsManager=n}return e.prototype.registerActions=function(){this._appSettingsManager.getBooleanAppSetting("ZoomPopupDialogIsEnabled")&&(this._actionManager.addAction(_.b.showZoomDialog,f.m.frame,g.i(this._zoomManager,this._zoomManager.showZoomDialog,"showZoomDialog")),this._actionManager.addActionWithFlags(_.b.queryZoomText,f.m.frame,g.i(this._zoomManager,this._zoomManager.onQueryZoomText,"onQueryZoomText"),96),this._actionManager.addAction(_.b.zoomDialogFocusForward,f.m.frame,g.i(this._zoomManager,this._zoomManager.zoomDialogTabFocusHandler,"zoomDialogTabFocusHandler")),this._actionManager.addAction(_.b.zoomDialogFocusBackward,f.m.frame,g.i(this._zoomManager,this._zoomManager.zoomDialogTabFocusHandler,"zoomDialogTabFocusHandler")))},e}();(0,g.l)(m,"c18527f$CommonZoomActor",null,[h]);var y=n(7106),v=n(5516),S=n(925),I=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i._wordEditorZoomManager=null,i._wordEditorZoomManager=n,i}return(0,p.t)(t,e),t.prototype.registerActions=function(){e.prototype.registerActions.call(this),this._appSettingsManager.getBooleanAppSetting("ZoomPopupDialogIsEnabled")&&(this._actionManager.addAction(v.u.zoomInOut,f.m.frame,S.ActionManager.doNothingButReportHandler),this._actionManager.addAction(v.u.zoomTo100Percent,f.m.frame,g.i(this._wordEditorZoomManager,this._wordEditorZoomManager.zoomTo100,"zoomTo100"))),this._wordEditorZoomManager.get_zoomImprovementsIsEnabled()&&(this._actionManager.addAction(_.b.increaseZoom,f.m.frame,g.i(this._wordEditorZoomManager,this._wordEditorZoomManager.increaseZoom,"increaseZoom")),this._actionManager.addAction(_.b.decreaseZoom,f.m.frame,g.i(this._wordEditorZoomManager,this._wordEditorZoomManager.decreaseZoom,"decreaseZoom"))),this._wordEditorZoomManager.get_zoomDropDownInRibbonIsEnabled()&&(this._actionManager.addAction(v.u.selectZoomOptionInRibbon,f.m.frame,g.i(this._wordEditorZoomManager,this._wordEditorZoomManager.setZoomLevelFromRibbon,"setZoomLevelFromRibbon")),this._actionManager.addActionWithFlags(v.u.queryCurrentZoomLevelText,f.m.frame,g.i(this._wordEditorZoomManager,this._wordEditorZoomManager.onQueryZoomText,"onQueryZoomText"),96)),this._actionManager.addAction(y.u.ctrlPlus,f.m.frame,S.ActionManager.doNothingButReportHandler),this._actionManager.addAction(y.u.ctrlMinus,f.m.frame,S.ActionManager.doNothingButReportHandler),this._actionManager.addAction(y.u.ctrlZero,f.m.frame,S.ActionManager.doNothingButReportHandler),this._actionManager.addAction(y.u.ctrlScroll,f.m.frame,S.ActionManager.doNothingButReportHandler),this._actionManager.addAction(v.u.updateZoom,f.m.frame,S.ActionManager.doNothingButReportHandler)},t}(m);(0,g.l)(I,"7d723420$WordEditorZoomActor",m,[]);var C=n(6455),T=n(1822),b=n(7597),A=n(279),M=n(2879),P=n(213),F=n(25),w=n(4072),R=n(6378),E=function(){function e(t,n){this.appSettingsManager=null,this.actionManager=null,this.$$pf_CurrentZoom=0,this.delta=.1,this.pageMargin=0,this._dialog=null,this.defaultDialogOptions=[CommonUIStrings.l_FullPage,CommonUIStrings.l_PageWidth,"200%","150%","100%","75%","50%"],this.defaultDialogValues=[e.dialogResult_FullPage,e.dialogResult_PageWidth,"200","150","100","75","50"],this.currentZoomStatus=3,this.eventSource=new w.f,this.appSettingsManager=t,this.actionManager=n,this.set_currentZoom(1)}return e.prototype.get_currentZoom=function(){return this.$$pf_CurrentZoom},e.prototype.set_currentZoom=function(e){return this.$$pf_CurrentZoom=e,e},e.prototype.get_currentZoomOnUI=function(){return Math.round(100*this.get_currentZoom())},e.prototype.get_nextValueIncreaseZoom=function(){return Math.floor(this.get_currentZoomOnUI()/10)/10+this.delta},e.prototype.get_nextValueDecreaseZoom=function(){return Math.ceil(this.get_currentZoomOnUI()/10)/10-this.delta},e.prototype.get__actionManager=function(){return a.AFrameworkApplication.get_theActionManager()},e.prototype.add_zoomChanged=function(t){this.eventSource.addHandler(e.ZoomChangedEventName,t)},e.prototype.remove_zoomChanged=function(t){this.eventSource.removeHandler(e.ZoomChangedEventName,t)},e.prototype.registerZoomChangedEvent=function(e){this.add_zoomChanged(e)},e.prototype.removeZoomChangedEvent=function(e){this.remove_zoomChanged(e)},e.prototype.zoomElement=function(e){this.zoomElementTo(e,this.get_currentZoom())},e.prototype.zoomElementTo=function(e,t){null!==e&&F.o.setScale(e,t)},e.prototype.setZoom=function(e){var t=100*e;this.setCustomZoom(0,null,2,null,t)},e.prototype.setZoomDuringResize=function(e,t){var n=3|(t?0:4);this.updateZoom(e,n)},e.prototype.isInScope=function(e){return!0},e.prototype.onZoomChange=function(e,t,n,r,i){if(1===n)return this.isReadyForRibbon()?32:8;var o=i/100;return o<this.get_minimumZoom()?o=this.get_minimumZoom():o>this.get_maximumZoom()&&(o=this.get_maximumZoom()),this.onZoomChangeCustomAction(o),this.updateZoom(o,0),r&&(r.dataValue1=Math.floor(100*o)),32},e.prototype.onQueryZoomLevel=function(e,t,n,r,i){return 1===n?32:(i.value=Math.floor(100*this.get_currentZoom()),32)},e.prototype.onQueryZoomText=function(e,t,n,r,i){if(1===n)return 32;var o=i,s="";return R.l.formatNumberToString(this.get_currentZoomOnUI(),6,a.AFrameworkApplication.get_numberFormat(),(0,T.m)((function(){return s}),(function(e){return s=e}))),o[this.get_zoomLabelTextDictionaryKey()]=s,32},e.prototype.onZoomChangeCustomAction=function(e){},e.prototype.isReadyForRibbon=function(){return!0},e.prototype.getZoomDialogOptionList=function(){return this.defaultDialogOptions},e.prototype.getZoomDialogValueList=function(){return this.defaultDialogValues},e.prototype.getCurrentZoomValueBasedOnZoomStatus=function(){var t=Math.floor(100*this.get_currentZoom()).toString();return 1===this.currentZoomStatus?t=e.dialogResult_FullPage:2===this.currentZoomStatus&&(t=e.dialogResult_PageWidth),t},e.prototype.increaseZoom=function(e,t,n,r,i){return 1===n?32:(this.logUpdateZoomEvents(this.actionManager?this.actionManager.get_commandLocation():0,"IncreaseZoom"),this.updateZoom(this.get_nextValueIncreaseZoom(),0),32)},e.prototype.decreaseZoom=function(e,t,n,r,i){return 1===n?32:(this.logUpdateZoomEvents(this.actionManager?this.actionManager.get_commandLocation():0,"DecreaseZoom"),this.updateZoom(this.get_nextValueDecreaseZoom(),0),32)},e.prototype.setZoomLevelFromRibbon=function(e,t,n,r,i){var o=this;if(1===n)return 32;this.logUpdateZoomEvents(this.actionManager?this.actionManager.get_commandLocation():0,"SetZoomLevelFromRibbon");var a=i.Value;if(a.toLowerCase().startsWith("fit")){var s=new M.c(0,1,0,(function(e){o.zoomToPageWidth(0,null,2,null,null)}),138,null,!0);return P.y.get_instance().addTask(s),32}var l=parseInt(a)/100;return isNaN(l)?2:(this.updateZoom(l,0),32)},e.prototype.logUpdateZoomEvents=function(e,t){b.ULS.sendTraceTag(42341577,353,50,"Update Zoom. CommandLocation: {0}; Command: {1}; ZoomImprovementIsEnabled: {2}; IsSLR: {3}",e,t,a.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ZoomDropdownInSlrIsEnabled"),a.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled())},e.prototype.showZoomDialog=function(e,t,n,r,i){if(1===n)return 32;b.ULS.sendTraceTag(7176728,353,50,"Customer is trying to trigger the Zoom dialog"),this._dialog=new A.j(this.getZoomDialogOptionList(),this.getZoomDialogValueList(),g.i(this,this.handleZoomDialogResult,"handleZoomDialogResult"),l.FocusManager.instance());var o=this.getCurrentZoomValueBasedOnZoomStatus();return this._dialog.showZoomDialog(CommonUIStrings.l_ZoomDialogTitle,o),32},e.prototype.isDialogResultFullPage=function(t){return t.toLowerCase()===e.dialogResult_FullPage.toLowerCase()},e.prototype.isDialogResultPageWidth=function(t){return t.toLowerCase()===e.dialogResult_PageWidth.toLowerCase()},e.prototype.handleZoomDialogResult=function(e){var t=8;if(this.isDialogResultFullPage(e))this.currentZoomStatus=1,t=this.zoomToFit(0,null,2,null,null);else if(this.isDialogResultPageWidth(e))this.currentZoomStatus=2,t=this.zoomToPageWidth(0,null,2,null,null);else{var n=Number.parseInvariant(e);n?(this.currentZoomStatus=0,t=this.setCustomZoom(0,null,2,null,n)):t=8}32===t?b.ULS.sendTraceTag(7176729,353,50,"Succeeded to Zoom: {0}",{DialogResult:e}):b.ULS.sendTraceTag(7156360,353,10,"Failed to Zoom: {0}",{DialogResult:e})},e.prototype.raiseZoomChangedEvent=function(){this.eventSource.raiseEvent(e.ZoomChangedEventName,null,null)},e.prototype.zoomDialogTabFocusHandler=function(e,t,n,r,i){if(!this._dialog)return 2;var o=this._dialog.get_focusManager().getCurrentRegion().listing.get_currentElement();if(o===this._dialog._btnCancel&&e===_.b.zoomDialogFocusForward||o===this._dialog._btnAction&&e===_.b.zoomDialogFocusBackward)this._dialog.get_activeSelection()||this._dialog.selectFirstZoomOption(),this._dialog.get_focusManager().getCurrentRegion().listing.trySetCurrentElement(this._dialog.get_activeSelection());else if(o.id.startsWith(this._dialog.get_radioboxPrefix())||o.className.startsWith(this._dialog.get_radioRowClassName())){var a=null;e===_.b.zoomDialogFocusForward?a=this._dialog._btnAction:e===_.b.zoomDialogFocusBackward&&(a=this._dialog._btnCancel),this._dialog.get_focusManager().getCurrentRegion().listing.trySetCurrentElement(a),Sys.UI.DomElement.removeCssClass(this._dialog.get_activeSelection().parentNode,this._dialog.get_radioRowHighlightClassName())}else if(e===_.b.zoomDialogFocusForward)this._dialog.get_focusManager().getCurrentRegion().moveForward();else{if(e!==_.b.zoomDialogFocusBackward)return 2;this._dialog.get_focusManager().getCurrentRegion().moveBackward()}return 32},e.dialogResult_FullPage="FullPage",e.dialogResult_PageWidth="PageWidth",e.ZoomChangedEventName="ZoomChanged",e}();(0,g.l)(E,"74f7084a$ZoomManager",null,[r.w]);var k=n(1135),D=n(6301),O=n(5362),U=n(6382),x=n(4364),L=n(7074),N=n(4178),B=n(9423),H=n(5575),$=n(7801),G=n(2007),W=n(6654),V=n(4782),j=n(4359),q=n(5321),z=function(e){function t(t,n,r,i,o,a,s){var l=this;return l.resizeEventRegistered=!1,l._keepViewAfterZoom=!1,l._wordSectionNavigator=null,l._mouseInputManager=null,l._focusManager=null,l._clickInputManager=null,l._zoomImprovementsIsEnabled=!1,l._zoomShortCutIsEnabled=!1,l._zoomCtrlScrollIsEnabled=!1,l._isSimplifiedReactRibbonUxEnabled=!1,l._zoomDropdownIsEnabled=!1,l._zoomLabel=null,l._statusBarUser=null,l.wordEditorDialogOptions=[CommonUIStrings.l_PageWidth,"200%","150%","125%","100%","75%","50%"],l.wordEditorDialogValues=[E.dialogResult_PageWidth,"200","150","125","100","75","50"],(l=e.call(this,t,n)||this)._wordSectionNavigator=r,l._mouseInputManager=i,l._focusManager=o,l._clickInputManager=a,l._isSimplifiedReactRibbonUxEnabled=s,l._keepViewAfterZoom=t.getBooleanAppSetting("KeepViewAfterZoomIsEnabled"),l._zoomImprovementsIsEnabled=t.getBooleanAppSetting("ZoomDropdownInSlrIsEnabled"),l._zoomShortCutIsEnabled=t.getBooleanAppSetting("ZoomShortCutIsEnabled"),l._zoomCtrlScrollIsEnabled=t.getBooleanAppSetting("ZoomCtrlScrollIsEnabled"),l._zoomDropdownIsEnabled=l._isSimplifiedReactRibbonUxEnabled&&l._zoomImprovementsIsEnabled,l.RegisterEvents(),l}return(0,p.t)(t,e),t.prototype.get_zoomDropDownInRibbonIsEnabled=function(){return this._zoomDropdownIsEnabled},t.prototype.get_zoomImprovementsIsEnabled=function(){return this._zoomImprovementsIsEnabled},t.prototype.get_appName=function(){return"WordEditor"},t.prototype.get_maximumZoom=function(){return 4},t.prototype.get_minimumZoom=function(){return.1},t.prototype.get_zoomLabelTextDictionaryKey=function(){return this._zoomImprovementsIsEnabled?N.i.Value:L.g.LabelText},t.prototype.get_StatusBarUser=function(){return this._statusBarUser||(this._statusBarUser=U.w.get_instance().tryResolve(C.f))},t.prototype.updateZoom=function(e,t){if(a.AFrameworkApplication.get_theActionManager().processAction(v.u.updateZoom,2,null),this.get_currentZoom()!==e){e>this.get_maximumZoom()?e=this.get_maximumZoom():e<this.get_minimumZoom()&&(e=this.get_minimumZoom()),1===e||!!(1&t)||a.AFrameworkApplication.get_theActionManager().processAction(v.u.zoomInOut,2,null);try{var n=null;B.App.get_activeAppFrame()&&g.r($.t,B.App.get_activeAppFrame().workspace.get_contentView())&&(n=B.App.get_activeAppFrame().workspace.get_contentView());var r=-1,i=-1,o=-1,s=!(2&t);this._keepViewAfterZoom&&s&&(r=G.SelectionEditor.getVerticalPercentageFromSelection(W.SelectionManager.get_instance().get_selectionCollection().get_currentSelection(),n),i=n.get_scrollContainer().scrollLeft,o=n.get_scrollContainer().scrollTop);var l=this.get_currentZoom();if(this.set_currentZoom(e),this.raiseZoomChangedEvent(),!(4&t)){if(this._zoomDropdownIsEnabled){var u={SelectZoomOption:"ComboBoxModel"};B.App.get_activeAppFrame().updateRibbonControls(u)}this.updateZoomPercentageDisplay()}s&&this.UpdateScrollAfterZoom(n,r,i,o,l)}catch(e){b.ULS.sendTraceTag(7185431,353,10,"UpdateZoom error:{0}",e)}}},t.prototype.UpdateScrollAfterZoom=function(e,t,n,r,i){e&&e.get_isActive()?this._keepViewAfterZoom?t>=0&&t<=100?e.get_autoScroller().scrollSelectionIntoView(100-t,!0,!0,null):e.get_autoScroller().keepPageTopAfterZoom(n,r,i,this.get_currentZoom()):e.get_autoScroller().scrollSelectionIntoView(-1,!1,!1,null):b.ULS.sendTraceTag(7185430,353,10,"UpdateZoom: Failed to get PageView to scroll content")},t.prototype.zoomTo100=function(e,t,n,r,i){return 2===n&&(this.logUpdateZoomEvents(this.actionManager?this.actionManager.get_commandLocation():0,"ZoomTo100"),this.currentZoomStatus=0,this.updateZoom(1,0)),32},t.prototype.setCustomZoom=function(e,t,n,r,i){this.currentZoomStatus=0;var o=Number.parseInvariant(String.format("{0}",i))/100;return b.ULS.sendTraceTag(7410915,353,50,"Word Editor - Zoom to custom value: {0}",o),this.updateZoom(o,0),32},t.prototype.zoomToFit=function(e,t,n,r,i){return 32},t.prototype.zoomToPageWidth=function(e,t,n,r,i){return b.ULS.sendTraceTag(7410944,353,50,"Word Editor - Zoom to fit page width"),this.currentZoomStatus=2,this.EnsureResizeEventRegistered(),this.FitPageWidth()},t.prototype.getZoomDialogOptionList=function(){return this.wordEditorDialogOptions},t.prototype.getZoomDialogValueList=function(){return this.wordEditorDialogValues},t.prototype.EnsureResizeEventRegistered=function(){this.resizeEventRegistered||(B.App.get_activeAppFrame()?(B.App.get_activeAppFrame().add_onResize(g.i(this,this.ResizeAppFrame,"ResizeAppFrame")),this.resizeEventRegistered=!0):b.ULS.sendTraceTag(7185432,353,10,"EnsureResizeEventRegistered: Failed to get PageManager to register event"))},t.prototype.FitPageWidth=function(){var e=B.App.get_activeAppFrame()?B.App.get_activeAppFrame().workspace.get_contentView():null;if(e&&e.get_editingView()&&e.get_editingView().get_targetNode()&&B.App.get_activeAppFrame().get_viewPanelContainer()){var t=this._wordSectionNavigator.navigateToWordSectionNode(e.get_editingView().get_targetNode());if(!t&&e.get_selectionManager()&&e.get_selectionManager().get_selectionCollection().get_currentSelection()&&e.get_selectionManager().get_selectionCollection().get_currentSelection().get_firstContext()&&e.get_selectionManager().get_selectionCollection().get_currentSelection().get_firstContext().get_node()&&(t=this._wordSectionNavigator.navigateToWordSectionNode(e.get_selectionManager().get_selectionCollection().get_currentSelection().get_firstContext().get_node())),null!==t){var n=V.p.get_instance().getPageWidth(t),r=x.j.twipsToPixels(n,0,!0),i=(B.App.get_activeAppFrame().get_viewPanelContainer().offsetWidth-2*j.t.wordOutlineMargin)/r;return this.updateZoom(i,0),32}b.ULS.sendTraceTag(7185433,353,10,"Zoom to page width: cannot find word section node.")}else b.ULS.sendTraceTag(7185434,353,10,"Zoom to page width: cannot find editing view node.");return 8},t.prototype.ResizeAppFrame=function(){2===this.currentZoomStatus&&this.FitPageWidth()},t.prototype.updateZoomPercentageDisplay=function(){this.get_StatusBarUser()&&this.get_StatusBarUser().pollControl(this._zoomImprovementsIsEnabled?q.t.zoomStatusLabelId:q.t.zoomStatusDialogId)},t.prototype.RegisterEvents=function(){if(this._mouseInputManager){var e=document.getElementById(H.u.documentPanelId);e&&this._mouseInputManager.registerHandler(k.d.get_mouseWheel(),e,g.i(this,this.CtrlScrollZoomHandler,"CtrlScrollZoomHandler"))}if(this._zoomImprovementsIsEnabled){if(this._focusManager){var t=this._focusManager.getScope(H.u.editingFocusID);this._zoomShortCutIsEnabled&&(t.bindAction(O.KeyInputManager.hashKey(D.v.get_vK_EqualSign(),O.KeyInputManager.get_commandKeyModifier()),_.b.increaseZoom),t.bindAction(O.KeyInputManager.hashKey(D.v.vK_NumPadPlus,O.KeyInputManager.get_commandKeyModifier()),_.b.increaseZoom),t.bindAction(O.KeyInputManager.hashKey(D.v.get_vK_Hyphen(),O.KeyInputManager.get_commandKeyModifier()),_.b.decreaseZoom),t.bindAction(O.KeyInputManager.hashKey(D.v.vK_NumPadMinus,O.KeyInputManager.get_commandKeyModifier()),_.b.decreaseZoom),t.bindAction(O.KeyInputManager.hashKey(D.v.vK_0,O.KeyInputManager.get_commandKeyModifier()),v.u.zoomTo100Percent))}this._clickInputManager&&(this._zoomLabel=document.getElementById("LabelShowZoomValue-MediumCompact"),this._zoomLabel&&this._clickInputManager.registerHandler(k.d.click,this._zoomLabel,g.i(this,this.OnZoomLabelClickEvent,"OnZoomLabelClickEvent")))}},t.prototype.CtrlScrollZoomHandler=function(e){if(e.get_ctrlKey()&&(a.AFrameworkApplication.get_theActionManager().processAction(y.u.ctrlScroll,2,null),this._zoomImprovementsIsEnabled&&this._zoomCtrlScrollIsEnabled)){var t=e.get_wheelData();return!!t&&(this.updateZoom(this.get_currentZoom()-t,0),this.logUpdateZoomEvents(6,"CtrlScroll"),!0)}return!1},t.prototype.OnZoomLabelClickEvent=function(e){return b.ULS.sendTraceTag(42341578,353,50,"Click event detected on Zoom Label. IsSLR: {0}",this._isSimplifiedReactRibbonUxEnabled),!0},t}(E);(0,g.l)(z,"28541f58$WordEditorZoomManager",E,[]),n.d(t,{ZoomPackage:function(){return K}});var K=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"WordEditor.Zoom"},e.prototype.init=function(){a.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ZoomPopupDialogIsEnabled")&&(this._container.resolve(I).registerActions(),Sys.UI.DomElement.overrideGetBounds=!0)},e.prototype.dispose=function(){},e.prototype.configure=function(e){var t=this;this._container=e,a.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ZoomPopupDialogIsEnabled")&&(this._container.register(z).as(r.w).usingFactory((function(){return new z(a.AFrameworkApplication.appSettingsManager,a.AFrameworkApplication.get_theActionManager(),d.d.get_instance(),u.p.get_instance(),l.FocusManager.instance(),s.s.get_instance(),a.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled())})).singleInstance(),this._container.register(I).usingFactory((function(){return new I(a.AFrameworkApplication.get_theActionManager(),t._container.resolve(z),a.AFrameworkApplication.appSettingsManager)})).singleInstance())},e.main=function(){c.o.get_instance().registerPackage(new e,0,!1)},e}();(0,g.l)(K,"c602e2be$ZoomPackage",null,[i.u,o.s])},6222:function(e,t,n){"use strict";n.r(t),t.default=window.AccCheckerPaneData={name:"CommandUI",attrs:{xmlns:"http://schemas.microsoft.com/sharepoint/"},children:[{name:"TaskPane",attrs:{Id:"AccCheckerTaskPane",Width:"300",Overflow:"auto"},children:[{name:"Groups",attrs:{},children:[{name:"Group",attrs:{Id:"AccCheckResultsPlaceHolder",IsStretched:"true",MinHeight:"400"}}]}]}]}},6307:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var r=n(4574),i=n(423),o=function(){function e(){this.$$pf_Query=null,this.$$pf_ResultGroups=null,this.$$pf_Attributes=null,this.set_resultGroups([])}return e.prototype.get_query=function(){return this.$$pf_Query},e.prototype.set_query=function(e){return this.$$pf_Query=e,e},e.prototype.get_resultGroups=function(){return this.$$pf_ResultGroups},e.prototype.set_resultGroups=function(e){return this.$$pf_ResultGroups=e,e},e.prototype.get_attributes=function(){return this.$$pf_Attributes},e.prototype.set_attributes=function(e){return this.$$pf_Attributes=e,e},e.prototype.addResultGroup=function(e){this.get_resultGroups().push(e)},e}();(0,i.l)(o,"e2b6e6d7$SimpleResultsUpdatedEventArgs",null,[r.e])},6311:function(e,t,n){"use strict";n.d(t,{u:function(){return l}});var r=n(423),i=n(8576),o=n(7597),a=n(1135),s=n(6301),l=function(){function e(e,t){this._element=null,this._clickInputManager=null,this._keyInputManager=null,this._clickInputManager=t,this._keyInputManager=e}return e.prototype.get_element=function(){return this._element||(this._element=this.createDomElement(),this.RegisterEvents()),this._element},e.prototype.set_element=function(e){return this._element=e,e},e.prototype.dispose=function(){this.get_element()&&(this.UnregisterEvents(),this.set_element(null))},e.prototype.RegisterEvents=function(){this._clickInputManager&&this._keyInputManager?(this._clickInputManager.registerHandler(a.d.click,this.get_element(),r.i(this,this.onClick,"onClick")),this._keyInputManager.registerHandler(a.d.keyDown,this.get_element(),r.i(this,this.onKeyPress,"onKeyPress"))):o.ULS.shipAssertTag(19789026,334,!1,String.format("ClickInputManager or KeyInputManager is null. Couldn't register events on element ( ID: {0}).",this.get_element().id))},e.prototype.UnregisterEvents=function(){this._clickInputManager&&this._keyInputManager&&(this._clickInputManager.unregisterHandler(a.d.click,this.get_element(),r.i(this,this.onClick,"onClick")),this._keyInputManager.unregisterHandler(a.d.keyDown,this.get_element(),r.i(this,this.onKeyPress,"onKeyPress")))},e.prototype.onClick=function(e){return this.onInvoke(),!0},e.prototype.onKeyPress=function(e){var t=e.innerEvent.keyCode;return!!this.isKeyCodeAccepted(t)&&(this.onInvoke(),!0)},e.prototype.isKeyCodeAccepted=function(e){return e===s.v.vK_Spacebar||e===s.v.vK_Enter},e}();(0,r.l)(l,"deee758b$AInteractivePaneElement",null,[i.c,Sys.IDisposable])},6329:function(e,t,n){"use strict";n.d(t,{n:function(){return i}});var r=n(423),i=function(){return function(){this.wch=0,this.wFlags=0,this.cWords=0,this.iNode=0,this.iDown=0,this.iSRDown=0,this.tagData=0}}();(0,r.l)(i,"6c5ae399$TRIESCAN",null,[])},6346:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(363),o=n(8192),a=n(7597),s=function(){return function(){this.onSuccess=null,this.onFailure=null}}();(0,r.l)(s,"90976477$ExecuteVersionHistoryData",null,[]);var l=n(5377),u=n(1443),c=n(3362),d=n(8996),p=function(){function e(){}return e.deserializeResponse=function(t){try{var n=d.x.deserialize(t);return n.Versions.sort(e.VersionInfoComparer),n}catch(e){a.ULS.sendTraceTag(38908771,202,10,"VersionHistoryResponseSerializeHelper:DeserializeResponse - Failed to deserialize the response - {0}",t)}return null},e.VersionInfoComparer=function(e,t){var n=new Date(e.Time.toString());return+new Date(t.Time.toString())-+n},e}();(0,r.l)(p,"8d0d714b$VersionHistoryResponseSerializeHelper",null,[]);var g=n(2575),h=n(3096),_=n(3386),f=n(6378),m=function(){function e(e,t){this._clientRequestManager=null,this._appSettingsManager=null,this._clientRequestManager=e,this._appSettingsManager=t}return e.prototype.init=function(){},e.prototype.executeVersionHistory=function(t){e._requestCount=0,this.ExecuteVersionHistoryInternal(t,!0)},e.prototype.ExecuteVersionHistoryInternal=function(t,n){var i=this.BuildVersionHistoryRequestUri(),o={};o[e.ContentHeader]=e.ContentHeaderValue,o[e.CacheControlHeader]=e.CacheControlHeaderValue,_.s.addAppPLTEventToLog("LoadVersionListStart"),e._startTime=new Date,e._requestCount++,this.get_RequestManager().addRequest(i,1,"",o,!1,2,r.i(this,this.OnVersionHistorySuccess,"OnVersionHistorySuccess"),n?r.i(this,this.OnVersionHistoryFailureRetry,"OnVersionHistoryFailureRetry"):r.i(this,this.OnVersionHistoryFailureNoRetry,"OnVersionHistoryFailureNoRetry"),t,null,!1,null,null,null,null,!1,null,!1)},e.prototype.BuildVersionHistoryRequestUri=function(){return this.BuildServiceUri()},e.prototype.BuildServiceUri=function(){var t=(this._appSettingsManager.get_value().get_appSettings().VersionHistoryWebServiceBase||"")+e.HandlerName;return t=h.n.addOrReplaceParameterValue(t,e.HandlerQuerySigParam,f.l.urlKeyValueEncode(g.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),!1)},e.prototype.OnVersionHistorySuccess=function(t){a.ULS.sendTraceTag(38908766,202,50,"ExecuteVersionHistoryHandler:OnVersionHistorySuccess Time to get VersionList - {0}ms",+new Date-+e._startTime);var n=t.get_data().responseData,r=p.deserializeResponse(n);r.OperationResult=0,_.s.addAppPLTEventToLog("LoadVersionListEnd"),t.get_data().state.onSuccess(r)},e.prototype.OnVersionHistoryFailureRetry=function(t){2!==t.get_data().status?(_.s.addAppPLTEventToLog("LoadVersionListRetry"),a.ULS.sendTraceTag(38908767,202,50,"ExecuteVersionHistoryHandler:OnVersionHistoryFailureRetry VersionHistory request failed. Retrying..."),this.ExecuteVersionHistoryInternal(t.get_data().state,e._requestCount<e.RetryLimit)):(_.s.addAppPLTEventToLog("LoadVersionListFailure"),this.OnVersionHistoryFailureNoRetry(t))},e.prototype.OnVersionHistoryFailureNoRetry=function(e){a.ULS.sendTraceTag(38908768,202,50,"ExecuteVersionHistoryHandler:OnVersionHistoryFailureNoRetry VersionHistory failed second try"),e.get_data().state.onFailure(-1)},e.prototype.get_RequestManager=function(){return this._clientRequestManager.get_value()},e.get_instance=function(){return e._instance||(e._instance=e.GetAnInstanceWithResolvedDependecies())},e.GetAnInstanceWithResolvedDependecies=function(){return new e(new c.q(l.u,(function(){return g.AFrameworkApplication.theClientRequestManager})),new c.q(u.x,(function(){return g.AFrameworkApplication.appSettingsManager})))},e.ContentHeader="Content-Type",e.ContentHeaderValue="application/json; charset=utf-8",e.CacheControlHeader="Cache-Control",e.CacheControlHeaderValue="no-cache, no-store, must-revalidate",e.HandlerName="versions.ashx",e.HandlerQuerySigParam="DocID",e.RetryLimit=5,e._instance=null,e._startTime=null,e._requestCount=0,e}();(0,r.l)(m,"cdd365f$ExecuteVersionHistoryHandler",null,[]);var y=function(){function e(){this._container=null,this._executeVersionHistoryHandler=m.get_instance()}return e.prototype.get_name=function(){return"Common.App.VersionHistory.VersionHistoryExecutor"},e.prototype.configure=function(e){this._container=e},e.prototype.init=function(){g.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(r.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){g.AFrameworkApplication.isVersionHistorySupported()?(a.ULS.sendTraceTag(38908770,202,50,"VersionHistoryRequestExecutorPackageManager:OnFullAppSettingsReady - Initializing the VersionHistoryRequestExecutor package"),m.get_instance().init(),g.AFrameworkApplication.executeVersionHistory=r.i(this,this.executeVersionHistory,"executeVersionHistory")):a.ULS.sendTraceTag(38908769,202,50,"VersionHistoryRequestExecutorPackageManager:OnFullAppSettingsReady - Not initializing the VersionHistoryRequestExecutor package because the feature is disabled.")},e.prototype.executeVersionHistory=function(e,t){var n=new s;n.onSuccess=e,n.onFailure=t,this._executeVersionHistoryHandler.executeVersionHistory(n)},e.prototype.dispose=function(){},e}();(0,r.l)(y,"2f7841c9$PackageManager",null,[i.u,o.s]);var v=n(1526);n.d(t,{Program:function(){return S}});var S=function(){function e(){}return e.main=function(){v.o.get_instance().registerPackage(new y,0,!1)},e}();(0,r.l)(S,"cbcc7334$Program",null,[])},6369:function(e,t,n){"use strict";var r=n(3545),i=n(423),o=n(3623),a=n(5541),s=n(1822),l=n(9961),u=n(7847),c=n(7597),d=n(9988),p=n(2575),g=n(1135),h=n(2879),_=n(213),f=n(7413),m=n(6410),y=(0,i.y)("42df923c$IOverlayControlStyle"),v=function(){return function(){this.ipDivHeight=0,this.left=0,this.top=0,this.height=0,this.shouldApplyStyle=!1}}();(0,i.l)(v,"e00cbb69$PresenceIpControlStyle",null,[y]);var S=function(e){function t(t,n){var r=e.call(this)||this;return r.paragraphId=null,r.leftDirty=!1,r.paragraphId=t,r.leftDirty=n,r}return(0,r.t)(t,e),t.prototype.get_paragraphId=function(){return this.paragraphId},t.prototype.get_leftDirty=function(){return this.leftDirty},t}(Sys.EventArgs);(0,i.l)(S,"f2a56539$PresenceIpControlRenderedEventArgs",Sys.EventArgs,[]);var I=n(3380),C=function(e){function t(n,r,i,o,a,s,l){var c=e.call(this,null)||this;return c._tooltipFactory=null,c._pointerInputManager=null,c._futureZoomManager=null,c._tooltip=null,c._showingOfControlTask=null,c._ipDiv=null,c._smallBox=null,c._currentViewId=0,c._htmlViewElement=null,c._coauthTelemetry=null,c._appSettingsManager=null,c._floodgateTimeLapseSec=0,c._triggerThreshold=0,c._sifAsync=null,c._counter=0,c.leftRenderDirty=!1,c.presenceData=null,c.anonymousPresenceDictionary=null,c.resolvedPresenceDictionary=null,c.tooltipState=0,c.presenceData=n,c._tooltipFactory=r,c._pointerInputManager=i,c._futureZoomManager=o,c._coauthTelemetry=a,t._greatestZIndex=0,c.anonymousPresenceDictionary=new u.w(Boolean),c.resolvedPresenceDictionary=new u.w(Boolean),c._sifAsync=s,c._appSettingsManager=l,c._floodgateTimeLapseSec=c._appSettingsManager.getIntAppSetting("PresenceIpRenderedFloodgateTimeLapseSec",30),c._triggerThreshold=c._appSettingsManager.getIntAppSetting("PresenceIpRenderedFloodgateTriggerThreshold",3),c._counter=0,c}return(0,r.t)(t,e),t.prototype.get_leftRenderDirty=function(){return this.leftRenderDirty},t.prototype.get_ModernInCanvasPresenceEnabled=function(){return p.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled")},t.prototype.add_controlRendered=function(e){this.addHandler(t.ControlRenderedEventKey,e)},t.prototype.remove_controlRendered=function(e){this.removeHandler(t.ControlRenderedEventKey,e)},t.prototype.renderControl=function(e,n,r){if(t.LogFirstUse(this.presenceData.get_user().get_clientId(),e.get_viewId()),this._htmlViewElement=e,r){var i=!this.element;i&&this.CreateControl(n.ownerDocument),i||!this.element.parentNode?n.appendChild(this.element):this.element.parentNode!==n&&(this.element.parentNode.removeChild(this.element),n.appendChild(this.element)),this._currentViewId=e.get_viewId(),this.updateControlHtml(e),this._coauthTelemetry.presenceRendered(this.presenceData.get_user().get_clientId())}this.leftRenderDirty=!r,this.RaiseOnRenderedEvent()},t.prototype.RaiseOnRenderedEvent=function(){this.raiseEvent(t.ControlRenderedEventKey,new S(this.presenceData.get_ip().get_paragraphId(),this.get_leftRenderDirty()),null)},t.prototype.CreateControl=function(e){this.element=e.createElement("div"),this.element.className=t.PaddingElementClassName,this.element.dir=p.AFrameworkApplication.get_isRtl()?"rtl":"ltr",this._pointerInputManager.registerHandler(g.d.pointerOver,this.element,i.i(this,this.OnPointerOver,"OnPointerOver")),this.get_ModernInCanvasPresenceEnabled()&&(this._pointerInputManager.registerHandler(g.d.pointerOut,this.element,i.i(this,this.OnPointerOut,"OnPointerOut")),this._pointerInputManager.registerHandler(g.d.pointerDown,this.element,i.i(this,this.OnTooltipTouch,"OnTooltipTouch"))),this._ipDiv=this.createElement("div"),this._ipDiv.className=t.PresenceIpLineClassName,this.get_ModernInCanvasPresenceEnabled()||(this._smallBox=this.createElement("div"),this._smallBox.className=t.PresenceSmallBoxClassName,this._ipDiv.appendChild(this._smallBox)),this._tooltip=this._tooltipFactory.createCompactTooltip(this.createElement("div"),this.get_ModernInCanvasPresenceEnabled()),this._tooltip.addUser(this.presenceData.get_user()),this._tooltip.hide(),Sys.UI.DomElement.addCssClass(this._tooltip.get_element(),this.get_ModernInCanvasPresenceEnabled()?t.PresenceClassName:t.PawnClassName),this._ipDiv.appendChild(this._tooltip.get_element()),this.element.appendChild(this._ipDiv)},t.prototype.OnPointerOver=function(e){return!this._tooltip||this.get_ModernInCanvasPresenceEnabled()&&!this._tooltip.eventHappenedInsideControl(e)||(this.MoveToFrontInCanvas(),this.ScheduleTooltipControl(e)),this.updateControlHtml(this._htmlViewElement),!1},t.prototype.OnPointerOut=function(e){return this._tooltip&&this.HideTooltip(),!1},t.prototype.OnTooltipTouch=function(e){return this._tooltip&&3===e.get_inputSource()&&(2!==this.tooltipState?(this.MoveToFrontInCanvas(),this.ScheduleTooltipControl(e)):this.HideTooltip()),!1},t.prototype.DeleteExistingHideTask=function(){this._showingOfControlTask&&(_.y.get_instance().deleteTask(this._showingOfControlTask),this._showingOfControlTask=null)},t.prototype.ShowTooltip=function(e){for(var n=0,r=this._tooltip.get_presenceUserList();n<r.length;n++){var i=r[n];if(i.get_clientId()===this.presenceData.get_user().get_clientId()&&!i.equals(this.presenceData.get_user())){this._tooltip.addUser(this.presenceData.get_user());break}}var o=!1;return t.DefaultColorForAnonymousUsers===this.presenceData.get_user().get_color()?(this.anonymousPresenceDictionary.tryGetValue(this.presenceData.get_user().get_clientId(),(0,s.m)((function(){return o}),(function(e){return o=e}))),o||(this.anonymousPresenceDictionary.set_item(this.presenceData.get_user().get_clientId(),!0),c.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.presenceData.get_user().get_clientId()+'" , "Event" : "RenderGrayPawn"}'))):(this.resolvedPresenceDictionary.tryGetValue(this.presenceData.get_user().get_clientId(),(0,s.m)((function(){return o}),(function(e){return o=e}))),o||(this.resolvedPresenceDictionary.set_item(this.presenceData.get_user().get_clientId(),!0),c.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.presenceData.get_user().get_clientId()+'" , "Event" : "RenderColoredPawn"}'))),e||this.presenceData.get_showFullTooltip()||2===this.tooltipState?(this.LogPresenceIpRenderedActivity(),this._tooltip.showIconAndText(),this.presenceData.set_showFullTooltip(!1),this.presenceData.set_isRendered(!0),this.tooltipState=2,t.TimeToShowIpOnExpand):this.presenceData.get_isRendered()&&1!==this.tooltipState?0:(this.LogPresenceIpRenderedActivity(),this._tooltip.showIconOnly(),this.presenceData.set_isRendered(!0),this.tooltipState=1,t.TimeToShowIpMs)},t.prototype.ScheduleTooltipControl=function(e){this.DeleteExistingHideTask();var t=this.ShowTooltip(!!e);this.get_ModernInCanvasPresenceEnabled()&&e&&e.eventName===g.d.pointerOver||this.ScheduleHideTask(t)},t.prototype.HideTooltip=function(){return this._tooltip&&this.tooltipState&&(this.ResetPositionInCanvas(),this._tooltip.hide(),this.tooltipState=0),!1},t.prototype.ScheduleHideTask=function(e){var t=this;this._showingOfControlTask=new h.c(2,1,e,(function(e){t._showingOfControlTask=null,t.HideTooltip()}),56,null,!1),_.y.get_instance().addTask(this._showingOfControlTask)},t.prototype.updatePosition=function(e){if(this.element&&this.element.parentNode){var n=this.GetIpBounds(e);if(n){var r,i,o,a=Sys.UI.DomElement.getBounds(this.element.parentNode),l=new Sys.UI.Bounds(n.x-a.x,n.y-a.y,t.IpWidth,n.height);this.GetPresenceIPControlPosition(l,a,this.element.parentNode,this._futureZoomManager.get_instance(),(0,s.m)((function(){return r}),(function(e){return r=e})),(0,s.m)((function(){return i}),(function(e){return i=e})),(0,s.m)((function(){return o}),(function(e){return o=e}))),this.element.style.height=2*t.PaddingWidth+o+"px",this.element.style.top=i-t.PaddingWidth+"px",this.element.style.left=r-t.PaddingWidth+"px",this._ipDiv.style.height=Math.max(t.MinHeightOfIp,o)+"px",this.ScheduleTooltipControl(null)}}},t.prototype.removeControl=function(e){e&&this.element&&e===this.element.parentNode&&(m.s.removeElement(this.element),this.RaiseOnRenderedEvent())},t.prototype.computeStyle=function(e,n,r,i){var o=new v;if(!r||!n)return o;var a=this.GetIpBounds(e);if(!a)return o;var s=new Sys.UI.Bounds(a.x-n.x,a.y-n.y,t.IpWidth,a.height),l=s.y,u=s.x,c=s.height,d=this._futureZoomManager.get_instance();if(i&&d){var p=d.get_currentZoom();l=Math.round(l/p),u=Math.round(u/p),c=Math.round(c/p)}return o.top=l-t.PaddingWidth,o.left=u-t.PaddingWidth,o.height=2*t.PaddingWidth+c,o.ipDivHeight=Math.max(t.MinHeightOfIp,c),o.shouldApplyStyle=!0,o},t.prototype.renderControlWithStyle=function(e,n,r,i){var o=r;if(t.LogFirstUse(this.presenceData.get_user().get_clientId(),e.get_viewId()),this._htmlViewElement=e,i){var a=!this.element;a&&this.CreateControl(n.ownerDocument),a||!this.element.parentNode?n.appendChild(this.element):this.element.parentNode!==n&&(this.element.parentNode.removeChild(this.element),n.appendChild(this.element)),this._currentViewId=e.get_viewId();var s=this.presenceData.get_user().get_color();this._ipDiv.style.borderColor=s,this.get_ModernInCanvasPresenceEnabled()||(this._smallBox.style.borderColor=s),this.element.id=t.GenerateId(this.presenceData),o.shouldApplyStyle&&(this.element.style.height=o.height+"px",this.element.style.top=o.top+"px",this.element.style.left=o.left+"px",this._ipDiv.style.height=o.ipDivHeight+"px",this.ScheduleTooltipControl(null))}this.leftRenderDirty=!i,this.RaiseOnRenderedEvent()},t.prototype.dispose=function(){this.element&&(this.removeControl(this.element.parentNode),this._pointerInputManager.unregisterHandler(g.d.pointerOver,this.element,i.i(this,this.OnPointerOver,"OnPointerOver")),this.get_ModernInCanvasPresenceEnabled()&&(this._pointerInputManager.unregisterHandler(g.d.pointerOut,this.element,i.i(this,this.OnPointerOut,"OnPointerOut")),this._pointerInputManager.unregisterHandler(g.d.pointerDown,this.element,i.i(this,this.OnTooltipTouch,"OnTooltipTouch"))),f.d.safeDispose(this._tooltip),this._tooltip=null,this.element=null)},t.prototype.updateControlHtml=function(e){var n=this.presenceData.get_user().get_color();this._ipDiv.style.borderColor=n,this.get_ModernInCanvasPresenceEnabled()||(this._smallBox.style.borderColor=n),this.element.id=t.GenerateId(this.presenceData),this.updatePosition(e)},t.prototype.GetPresenceIPControlPosition=function(e,t,n,r,i,o,a){o.val=e.y,i.val=e.x,a.val=e.height,(Math.abs(t.width-n.offsetWidth)>1||Math.abs(t.height-n.offsetHeight)>1)&&r&&(o.val=Math.round(o.val/r.get_currentZoom()),i.val=Math.round(i.val/r.get_currentZoom()),a.val=Math.round(a.val/r.get_currentZoom()))},t.prototype.GetIpBounds=function(e){var t,n=this.presenceData.get_ip();if(!n)return null;try{var r=n.get_presenceCp().get_cp();t=I.n.boundsFromIp(r,e,r>0,!1,!1,!1)}catch(e){c.ULS.sendTraceTag(4301318,302,50,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",_.y.get_instance().get_isYielding(),e.message,e.stack),t=null}return t},t.prototype.MoveToFrontInCanvas=function(){if(i.r(d.b,this._tooltip)){var e=(0,a.e)(d.b,this._tooltip);t._greatestZIndex=t._greatestZIndex>0?t._greatestZIndex+1:e.get_defaultZIndex()+1,e.set_zIndex(t._greatestZIndex),this.element.style.zIndex=String(t._greatestZIndex)}},t.prototype.ResetPositionInCanvas=function(){if(i.r(d.b,this._tooltip)){var e=(0,a.e)(d.b,this._tooltip);t._greatestZIndex=e.get_defaultZIndex(),e.set_zIndex(e.get_defaultZIndex()),this.element.style.zIndex=String(e.get_defaultZIndex())}},t.prototype.LogPresenceIpRenderedActivity=function(){var e=this;this._sifAsync&&!this.TriggerThresholdMet()&&this._sifAsync.CW((function(t){e._sifAsync.get_result().logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",e._floodgateTimeLapseSec)&&e._counter++}))},t.prototype.TriggerThresholdMet=function(){return this._counter>=this._triggerThreshold},t.LogFirstUse=function(e,n){t._firstPresenceRendered||(t._firstPresenceRendered=!0,c.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))},t.GenerateId=function(e){return t.idPrefix+e.getHashKey()},t.idPrefix="ipId_",t.PawnClassName="WacPawn",t.PresenceClassName="WacPresence",t.IpWidth=2,t.TimeToShowIpMs=7e3,t.TimeToShowIpOnExpand=2e3,t.PaddingWidth=5,t.PaddingElementClassName="PresenceIpPaddingDiv",t.PresenceIpLineClassName="presenceIp",t.PresenceSmallBoxClassName="PresenceSmallBox",t.MinHeightOfIp=10,t._firstPresenceRendered=!1,t._greatestZIndex=0,t.ControlRenderedEventKey="CR",t.DefaultColorForAnonymousUsers="0xcccccc",t}(l.l);(0,i.l)(C,"9ecc6719$PresenceIpControl",l.l,[o.v,Sys.IDisposable]),n.d(t,{m:function(){return T}});var T=function(){function e(e,t,n,r,i,o){this._tooltipFactory=null,this._pointerInputManager=null,this._zoomManager=null,this._coauthTelemetry=null,this._sifAsync=null,this._appSettingsManager=null,this._currentControls={},this._tooltipFactory=e,this._pointerInputManager=t,this._zoomManager=n,this._coauthTelemetry=r,this._sifAsync=i,this._appSettingsManager=o}return e.prototype.get_CurrentControls=function(){return this._currentControls},e.prototype.getPresenceIpControl=function(e,t){var n=e.get_user().get_clientId(),r=this._currentControls[n];return r&&r.presenceData.get_user().equals(e.get_user())?(r.presenceData=e,t.val=!0,r):(t.val=!1,this._currentControls[n]=new C(e,this._tooltipFactory,this._pointerInputManager,this._zoomManager,this._coauthTelemetry,this._sifAsync,this._appSettingsManager))},e.prototype.GetControlIfCached=function(e){return this._currentControls[e]},e.prototype.DisposeAllControls=function(){var e=this._currentControls;for(var t in e){({key:t,value:e[t]}).value.dispose()}},e}();(0,i.l)(T,"b5c336d8$PresenceIpControlProvider",null,[])},6604:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var r=n(3545),i=n(423),o=function(e){function t(t){var n=e.call(this)||this;return n.clientsCleared=null,n.clientsCleared=t,n}return(0,r.t)(t,e),t.prototype.get_clientsCleared=function(){return this.clientsCleared},t}(Sys.EventArgs);(0,i.l)(o,"11332922$PersistentStateClearedEventArgs",Sys.EventArgs,[])},6628:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(1443),o=n(7314),a=n(423),s=(0,a.y)("9d049ffc$IVersionHistoryPaneActor"),l=n(4194),u=n(363),c=n(8192),d=n(6653),p=n(7597),g=n(2575),h=n(2130),_=n(3772),f=n(1090),m=n(4764),y=(0,a.y)("777ce84d$IAppVersionControllerImplWrapperFactory"),v=(0,a.y)("9090be39$IAppVersionControllerImplWrapper"),S=n(1838),I=function(){function e(e,t,n){this.m_versionsViewController=null;var r=new wordVersionHistory.AppBootSettings;r.RenderServiceBase="",r.IsRtl=!1,r.Logger=new S.s,r.UseReactPdf=e.wordVHReactPdfIsEnabled,r.DiffEnabled=e.versionHistoryDiffEnabled,r.pdfUrlsInHeader=e.wordEditRenderReadUrlFromHeader,r.UserSessionId=g.AFrameworkApplication.userSessionId,r.publicScriptPath=g.AFrameworkApplication.get_staticContentScriptNameBase(),r.IsInHighContrastMode=!1,t&&(r.IsInHighContrastMode=t.get_isInHighContrastMode()),r.IsInHighContrastMode&&(r.ClientColorSettings=t.get_highContrastColors().foregroundTextColor+"_"+t.get_highContrastColors().backgroundColor+"_"+t.get_highContrastColors().linkColor),this.m_versionsViewController=new wordVersionHistory.AppVersionControllerImpl(r,n)}return e.prototype.onVersionSelected=function(e,t,n){this.m_versionsViewController.onVersionSelected(e,t,n)},e.prototype.getRenderFailureEvent=function(){return this.m_versionsViewController.getRenderFailureEvent()},e.prototype.getLoadFinishEvent=function(){return this.m_versionsViewController.getLoadFinishEvent()},e}();(0,a.l)(I,"2857d110$AppVersionControllerImplWrapper",null,[v]);var C=function(){function e(){}return e.prototype.create=function(e,t,n){return new I(e,t,n)},e}();(0,a.l)(C,"8c22dfa4$AppVersionControllerImplWrapperFactory",null,[y]);var T=(0,a.y)("a9f1b705$IVersionHistoryControllerFactory"),b=function(){function e(){}return e.prototype.getVersionHistoryControllerInstance=function(e){return versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(e)},e}();(0,a.l)(b,"121991ec$VersionHistoryControllerFactory",null,[T]);var A=n(2118),M=n(5214),P=function(){return function(){this.appColor=null,this.appName=0,this.fileExtension=null,this.wdEnableDownloadTokens=!1,this.retryCount=0,this.wdEnableSaveACopy=!1,this.wdEnableRestore=!1,this.wdEnableIterator=!1,this.userSessionId=null,this.wacCluster=null,this.uiLocale=null,this.isRtl=!1,this.useXhr=!1,this.wdEnableIteratorBasedHeaderAlignment=!1,this.viewerRootPositionRelative=!1,this.wdEnableHiddenButtonsUntilVersionLoadComplete=!1,this.wdEnableShowVersionChanges=!1,this.disableSaveACopy=!1,this.wdEnableCompareVersionsByGroup=!1}}();(0,a.l)(P,"b39009e7$AppSettings",null,[]);var F=function(){return function(){this.ulsLogger=null,this.serviceBase=null,this.latestStreamServiceBase=null,this.docId=null,this.appSettings=null,this.perfTelemetryInfos=null}}();(0,a.l)(F,"a01e4671$ControllerFactoryParameters",null,[]);var w=n(9910),R=n(4551),E=n(8996),k=n(3386),D=n(9641),O=n(6382),U=n(2192),x=n(3667),L=n(5575),N=function(){function e(e,t,n,r,i,o,a,s,l,u){this._actionManager=null,this.m_controller=null,this.m_highContrastDetector=null,this.m_telemetryDictionary=null,this.m_currentVersion=null,this.m_baseVersion=null,this.m_perfTelemetryInfos=null,this.m_typescriptPanePromise=null,this.m_focusManager=null,this.m_f6Manager=null,this.m_clickInputManager=null,this.m_browserUtils=null,this.m_sessionTelemetry=null,this.m_versionHistoryLaunchSessionId=null,this._wordVHSettings=null,this.m_versionHistoryViewerIds=null,this.m_firstVersionRevisionId="",this.m_versionHistoryControllerFactory=null,this.m_appSettingsManager=null,this.m_appVersionControllerImplWrapper=null,this.m_appVersionControllerImplWrapperFactory=null,this._actionManager=e,this._wordVHSettings=o,this.m_highContrastDetector=t,this.m_focusManager=n,this.m_f6Manager=r,this.m_clickInputManager=i,this.m_telemetryDictionary={},this.m_sessionTelemetry={},this.m_versionHistoryViewerIds={},this.m_browserUtils=a,this.m_versionHistoryControllerFactory=s,this.m_appSettingsManager=l,this.m_appVersionControllerImplWrapperFactory=u}return e.prototype.registerActions=function(){this._actionManager.addAction(w.b.showVersionHistoryDialog,U.m.frame,a.i(this,this.ShowVersionHistoryDialogAction,"ShowVersionHistoryDialogAction"))},e.prototype.SetVersionHistoryController=function(e){this.m_controller=e},e.prototype.ShowVersionHistoryDialogAction=function(e,t,n,r,i){return 2===n&&(this.m_versionHistoryLaunchSessionId=D.l.create().toString(),p.ULS.sendTraceTag(40702434,3005,50,"Execute ShowVersionHistoryDialogAction. VersionHistoryLaunchSessionId: {0}",this.m_versionHistoryLaunchSessionId),this.m_telemetryDictionary.ShowVersionHistoryDialog=(new Date).getTime().toString(),this.m_sessionTelemetry.VersionHistoryLaunchSessionId=this.m_versionHistoryLaunchSessionId,this.m_perfTelemetryInfos=[],this.m_controller||(this.m_controller=this.m_versionHistoryControllerFactory.getVersionHistoryControllerInstance((0,M.m)(new F,{ulsLogger:new S.s,serviceBase:this.m_appSettingsManager.get_appSettings().VersionHistoryWebServiceBase,docId:g.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,appSettings:(0,M.m)(new P,{appColor:"#2B579A",fileExtension:"docx",wdEnableDownloadTokens:this._wordVHSettings.wordWdDownloadTokenIsEnabled,wdEnableSaveACopy:this._wordVHSettings.wordVHEnableSaveACopy,wdEnableRestore:this._wordVHSettings.wordVHEnableRestore,userSessionId:g.AFrameworkApplication.userSessionId,wacCluster:this.m_appSettingsManager.getStringAppSetting("WacCluster"),uiLocale:g.AFrameworkApplication.uiCulture?g.AFrameworkApplication.uiCulture:"en-us",wdEnableHiddenButtonsUntilVersionLoadComplete:this._wordVHSettings.wordWHEnableHiddenButtonsUntilVersionLoadComplete}),perfTelemetryInfos:this.m_perfTelemetryInfos}))),this.m_controller&&this.m_controller.setDisableSaveACopy(g.AFrameworkApplication.get_protectedFile()),this.showVersionHistoryDialogImpl()),32},e.prototype.showVersionHistoryDialogImpl=function(){if(document.getElementById(e.c_VersionHistoryOverlayId))this.ActivateFocus();else{this.RegisterForVersionReadyEvent(),this.RegisterForVersionSelectedEvent(),this.RegisterForCloseSelectedEvent(),this.RegisterForFullAppErrorEvent(),this.RegisterForSaveACopySelectedEvent(),this._wordVHSettings.wordWdDownloadTokenRegisterIsEnabled&&this.RegisterForDownloadTokenReadyEvent(),this.RegisterForRestoreVersionSelectedEvent();var t=document.createElement("div");t.id=e.c_VersionHistoryOverlayId,t.style.width="100%",t.style.height="calc(100% + "+R.AFrame.statusBarHeight+"px)",t.style.zIndex="998",t.style.display="block",t.style.position="absolute",t.style.top="0px",document.getElementById("WACInnerFrame").appendChild(t),this.m_typescriptPanePromise=this.m_controller.createVersionHistoryDialog(t),this.SetupFocus()}document.getElementById(e.c_VersionHistoryOverlayId).style.display="block",this.m_controller.getVersions("")},e.prototype.RegisterForFullAppErrorEvent=function(){var t=this;this.m_controller.getFullAppErrorEvent().addListener((function(n){try{var r=void 0;switch(n){case 101:r="VHFailedToGetDownloadToken";break;case 100:r="VHFailedToLoadVersionList";break;case 104:r="VHVersioningNotEnabled";break;case 105:r="VHFileNotFound";break;case 106:r="VHVersionTooOld";break;default:r="None"}t.m_sessionTelemetry[e.c_TelemetryErrorCodeKey]=r,p.ULS.sendTraceTag(40702435,3005,50,"Full App Error Event: {0}, VersionHistoryLaunchSessionId: {1}",r,t.m_versionHistoryLaunchSessionId)}catch(e){p.ULS.sendTraceTag(40702464,3005,10,"Exception in FullAppErrorEvent call back: {0}.",e)}}))},e.prototype.RegisterForVersionReadyEvent=function(){var t=this;this.m_controller.getVersionsReadyEvent().addListener((function(n){t.ResetAppVersionController(n.containerDiv),n.versions&&(t.m_firstVersionRevisionId=e.GetRevisionIdFromVersionInfo(n.versions[n.versions.length-1])),t.ActivateFocus();try{t.m_currentVersion&&""!==t.m_currentVersion.DownloadUrl&&t.m_appVersionControllerImplWrapper&&(t.WritePerfTelemetryInfosToDictionary(),t._wordVHSettings.versionHistoryDiffEnabled?t.m_appVersionControllerImplWrapper.onVersionSelected(t.m_currentVersion,t.m_baseVersion,t.m_telemetryDictionary):t.m_appVersionControllerImplWrapper.onVersionSelected(t.m_currentVersion,null,t.m_telemetryDictionary),t.m_perfTelemetryInfos=[],t.m_telemetryDictionary={})}catch(e){p.ULS.sendTraceTag(40191171,3005,10,"VersionHistoryPaneActor: Exception in VersionReadyEvent callback: {0}",e)}}))},e.prototype.RegisterForVersionSelectedEvent=function(){var t=this;this.m_controller.getVersionSelectedEvent().addListener((function(n){if(t.m_currentVersion=n.currentVersion,t.m_baseVersion=n.baseVersion,t.m_appVersionControllerImplWrapper)try{t.WritePerfTelemetryInfosToDictionary(),t._wordVHSettings.versionHistoryDiffEnabled?(t.m_baseVersion&&""!==t.m_baseVersion.DownloadUrl||e.GetRevisionIdFromVersionInfo(t.m_currentVersion)===t.m_firstVersionRevisionId)&&t.m_appVersionControllerImplWrapper.onVersionSelected(n.currentVersion,n.baseVersion,t.m_telemetryDictionary):t.m_appVersionControllerImplWrapper.onVersionSelected(t.m_currentVersion,null,t.m_telemetryDictionary),t.m_perfTelemetryInfos=[],t.m_telemetryDictionary={}}catch(e){p.ULS.sendTraceTag(40191172,3005,10,"VersionHistoryPaneActor: Exception in VersionSelectedEvent callback: {0}",e)}}))},e.prototype.RegisterForDownloadTokenReadyEvent=function(){var t=this;this.m_controller.getDownloadTokenReadyEvent().addListener((function(n){try{if(p.ULS.sendTraceTag(40912896,3005,50,"VersionHistoryPaneActor - GetDownloadTokenReadyEvent called."),!t.m_baseVersion)return void p.ULS.sendTraceTag(40912897,3005,50,"VersionHistoryPaneActor - m_baseVersion is null in GetDownloadTokenReadyEvent callback.");if(n&&n.updatedVersions&&n.updatedVersions.length>=2){for(var r=null,i=null,o=e.GetRevisionIdFromVersionInfo(t.m_currentVersion),a=e.GetRevisionIdFromVersionInfo(t.m_baseVersion),s=0,l=n.updatedVersions;s<l.length;s++){var u=l[s],c=e.GetRevisionIdFromVersionInfo(u);if(o===c?r=u:a===c&&(i=u),r&&i)break}r&&i?(t.m_currentVersion=r,t.m_baseVersion=i,t.m_appVersionControllerImplWrapper.onVersionSelected(t.m_currentVersion,t.m_baseVersion,t.m_telemetryDictionary)):p.ULS.sendTraceTag(40912898,3005,50,"VersionHistoryPaneActor - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: {0}, RevisionID[N-1]: {1}.",o,a)}else p.ULS.sendTraceTag(40912899,3005,50,"VersionHistoryPaneActor - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.")}catch(e){p.ULS.sendTraceTag(40912900,3005,10,"VersionHistoryPaneActor: Exception in GetDownloadTokenReadyEvent callback: {0}",e)}}))},e.prototype.RegisterForCloseSelectedEvent=function(){var e=this;this.m_controller.getCloseSelectedEvent().addListener((function(t){e.CloseVersionHistoryDialog(),e.LaunchVHExitFloodgateSurvey()}))},e.prototype.RegisterForSaveACopySelectedEvent=function(){var e=this;this.m_controller.getSaveACopySelectedEvent().addListener((function(t){p.ULS.sendTraceTag(40464782,3005,15,"VersionHistoryPaneActor: RegisterForSaveACopySelectedEvent: {0}",t),e.NotifyVHExitFloodgateSurvey();var n=e._actionManager.processActionWithData(w.b.saveToSharePoint,2,{FileDownloadUrl:t},null);32!==n&&p.ULS.sendTraceTag(50643490,3005,10,"SaveToSharePoint failed with result : "+n.toString())}))},e.prototype.RegisterForRestoreVersionSelectedEvent=function(){this.m_controller.getRestoreVersionSelectedEvent().addListener((function(e){p.ULS.sendTraceTag(41177942,3005,50,"VersionHistoryPaneActor:  RegisterForRestoreVersionSelectedEvent: {0}",e)}))},e.prototype.RegisterForViewerErrorEvent=function(){var e=this;this.m_appVersionControllerImplWrapper.getRenderFailureEvent().addListener((function(t){try{"ViewerErrorCode"in e.m_sessionTelemetry?e.m_sessionTelemetry.ViewerErrorCode+="; "+t:e.m_sessionTelemetry.ViewerErrorCode=t,e.m_controller.setViewerError(!0),p.ULS.sendTraceTag(40478016,3005,50,"Versions viewer error code: {0}",t)}catch(e){p.ULS.sendTraceTag(40478017,3005,10,"Failed to set viewer error: {0}",e)}}))},e.prototype.RegisterForLoadFinishEvent=function(){var e=this;this.m_appVersionControllerImplWrapper.getLoadFinishEvent().addListener((function(t){e.m_controller.setVersionLoadComplete()}))},e.prototype.ActivateFocus=function(){this.m_f6Manager.deactivateFocus(L.u.ribbonFocusId),this.m_f6Manager.deactivateFocus(R.AFrame.documentFocusID),this.m_f6Manager.deactivateFocus(L.u.statusBarFocusId),this.m_focusManager.pushScope(e.c_VersionHistoryHeaderFocusId,!0),this.m_f6Manager.activateFocus(e.c_VersionHistoryHeaderFocusId),this.m_focusManager.pushScope(e.c_VersionHistoryOverlayId,!0),this.m_f6Manager.activateFocus(e.c_VersionHistoryOverlayId)},e.prototype.DeactivateFocus=function(){this.m_f6Manager.activateFocus(L.u.ribbonFocusId),this.m_f6Manager.activateFocus(R.AFrame.documentFocusID),this.m_f6Manager.activateFocus(L.u.statusBarFocusId),this.m_f6Manager.deactivateFocus(e.c_VersionHistoryOverlayId),this.m_focusManager.popScope(e.c_VersionHistoryOverlayId,!0),this.m_f6Manager.deactivateFocus(e.c_VersionHistoryHeaderFocusId),this.m_focusManager.popScope(e.c_VersionHistoryHeaderFocusId,!0)},e.prototype.CloseVersionHistoryDialog=function(){document.getElementById(e.c_VersionHistoryOverlayId).style.display="none",this.m_sessionTelemetry.browser=x.y.get_browserNameForlogging(),this.DeactivateFocus(),p.ULS.sendTraceTag(40478018,3005,50,E.x.serialize(this.m_sessionTelemetry))},e.prototype.WritePerfTelemetryInfosToDictionary=function(){for(var e=0,t=this.m_perfTelemetryInfos;e<t.length;e++){var n=t[e],r=n.TelemetryEventKey?n.TelemetryEventKey:n.telemetryEventKey?n.telemetryEventKey:"",i=n.TelemetryEventData?n.TelemetryEventData:n.telemetryEventData?n.telemetryEventData:"";""!==r&&""!==i&&(this.m_telemetryDictionary[r]=i)}},e.prototype.ResetAppVersionController=function(e){try{this.m_appVersionControllerImplWrapper?k.s.setIsPageLoadForFirstTime(!1):(k.s.setIsPageLoadForFirstTime(!0),this.m_appVersionControllerImplWrapper=this.m_appVersionControllerImplWrapperFactory.create(this._wordVHSettings,this.m_highContrastDetector,e),this.RegisterForViewerErrorEvent(),this.RegisterForLoadFinishEvent())}catch(e){p.ULS.sendTraceTag(39966497,3005,10,"WordVersionHistorySelectionHandler: ResetAppVersionController failed due to exception. {0}",e)}},e.prototype.CreateFocusScope=function(e){var t=this.m_focusManager.getScope(e);return t.parent=R.AFrame.mainAppFocusId,this.m_f6Manager.addF6(e,!0),t.set_keyDownHandledExternally(!0),t},e.prototype.SetupFocus=function(){var t=this;this.CreateFocusScope(e.c_VersionHistoryOverlayId).addOnFocus((function(n,r){try{r.name===e.c_VersionHistoryOverlayId&&t.m_typescriptPanePromise.then((function(e){return e.enterFocusTrapZone(),null}))}catch(e){p.ULS.sendTraceTag(40935437,3005,10,"VersionHistoryPaneActor: exception in SetupFocus callback: {0}.",e)}})),this.m_clickInputManager.addFocusEvent(e.c_VersionHistoryOverlayId,document.getElementById(e.c_VersionHistoryOverlayId),!1),this.CreateFocusScope(e.c_VersionHistoryHeaderFocusId).addOnFocus((function(n,r){try{r.name===e.c_VersionHistoryHeaderFocusId&&t.m_typescriptPanePromise.then((function(e){return e.enterHeaderFocusTrapZone(),null}))}catch(e){p.ULS.sendTraceTag(42243355,3005,10,"VersionHistoryPaneActor: exception in SetupFocus callback: {0}.",e)}})),this.m_clickInputManager.addFocusEvent(e.c_VersionHistoryHeaderFocusId,document.getElementById(e.c_VersionHistoryHeaderDivId),!1)},e.prototype.LaunchVHExitFloodgateSurvey=function(){var e=O.w.get_instance().tryResolve(A.t);e?(e.logActivity("VersionHistoryExited","WordVersionHistoryFGIsEnabled"),e.logActivity("VersionHistoryCheckExited","WordVersionHistoryFGIsEnabled")):p.ULS.sendTraceTag(41264064,3005,10,"ISystemInitiatedFeedback was null")},e.prototype.NotifyVHExitFloodgateSurvey=function(){var e=O.w.get_instance().tryResolve(A.t);e?e.logActivity("VersionHistoryExited","WordVersionHistoryFGIsEnabled"):p.ULS.sendTraceTag(41501776,3005,10,"ISystemInitiatedFeedback was null")},e.GetRevisionIdFromVersionInfo=function(e){return e.RevisionID?e.RevisionID:e.revisionID?e.revisionID:""},e.c_TelemetryErrorCodeKey="ErrorCode",e.c_VersionHistoryOverlayId="VersionHistoryOverlay",e.c_VersionHistoryHeaderFocusId="VersionHistoryHeader",e.c_VersionHistoryHeaderDivId="vhHeader",e}();(0,a.l)(N,"4002fd35$VersionHistoryPaneActor",null,[s]);var B=function(){return function(){this.wordWdDownloadTokenIsEnabled=!1,this.versionHistoryDiffEnabled=!1,this.wordVHReactPdfIsEnabled=!1,this.wordVHEnableSaveACopy=!1,this.wordWdDownloadTokenRegisterIsEnabled=!1,this.wordVHEnableRestore=!1,this.wordEditRenderReadUrlFromHeader=!1,this.wordWHEnableHiddenButtonsUntilVersionLoadComplete=!1}}();(0,a.l)(B,"a44f9c2f$WordVersionHistorySettings",null,[]);var H=function(){function e(){this._container=null,this._appSettingsManager=null}return e.prototype.get_name=function(){return"WordEditor.VersionHistory"},e.prototype.init=function(){var e=this;g.AFrameworkApplication.isVersionHistorySupported()?(p.ULS.sendTraceTag(39966528,3005,50,"WordVersionHistoryPackageManager:Init - Initializing the React VersionHistory package"),h.AppLifecycleManager.get_instance().executeWhen(7,(function(){e._container.resolve(o.d).getScriptLoader().loadScript("wordVersionHistory").catch((function(e){return p.ULS.sendTraceTag(39966529,3005,10,"Failed to load the resources for the versionHistory feature: {0}",e)})).then((function(t){return e.OnVersionHistoryScriptLoaded(t)})).catch((function(e){return p.ULS.sendTraceTag(39966530,3005,10,"Failed to initialize the versionHistory feature: {0}",e)}))}),d.d.onlyOnRanToCompletion)):p.ULS.sendTraceTag(39966498,3005,50,"WordVersionHistoryPackageManager:Init - Not initializing the React VersionHistory package because the feature is disabled")},e.prototype.OnVersionHistoryScriptLoaded=function(e){return this._container.resolve(s).registerActions(),null},e.prototype.dispose=function(){},e.prototype.configure=function(e){var t=this;if(this._container=e,this._appSettingsManager=this._container.resolve(i.x),this._appSettingsManager.getBooleanAppSetting("AppSupportsVersionHistory")){var n=new B;n.wordWdDownloadTokenIsEnabled=this._appSettingsManager.getBooleanAppSetting("WordWdDownloadTokenIsEnabled"),n.versionHistoryDiffEnabled=this._appSettingsManager.getBooleanAppSetting("VersionHistoryDiffEnabled"),n.wordVHReactPdfIsEnabled=this._appSettingsManager.getBooleanAppSetting("WordVHReactPdfIsEnabled"),n.wordVHEnableSaveACopy=this._appSettingsManager.getBooleanAppSetting("WordVHEnableSaveACopy"),n.wordWdDownloadTokenRegisterIsEnabled=this._appSettingsManager.getBooleanAppSetting("WordWdDownloadTokenRegisterIsEnabled"),n.wordVHEnableRestore=this._appSettingsManager.getBooleanAppSetting("WordVHEnableRestore"),n.wordEditRenderReadUrlFromHeader=this._appSettingsManager.getBooleanAppSetting("WordEditRenderReadUrlFromHeader"),n.wordWHEnableHiddenButtonsUntilVersionLoadComplete=this._appSettingsManager.getBooleanAppSetting("WordVHEnableHiddenButtonsUntilVersionLoadComplete"),this._container.register(s).usingFactory((function(){return new N(g.AFrameworkApplication.get_theActionManager(),g.AFrameworkApplication.get_activeFrame().get_highContrastDetector(),m.FocusManager.instance(),f.F6Manager.get_instance(),_.s.get_instance(),n,t._container.resolve(l.q),new b,g.AFrameworkApplication.appSettingsManager,new C)})).singleInstance()}},e}();(0,a.l)(H,"e5a828d0$WordVersionHistoryPackage",null,[u.u,c.s]),n.d(t,{Program:function(){return $}});var $=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new H,0,!1)},e}();(0,a.l)($,"9bcb6e28$Program",null,[])},6642:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(4736),o=n(9937),a=n(1775),s=n(423),l=(0,s.y)("5fb5d7f9$IGraphMergeBackupThrottler"),u=(0,s.y)("2c1fe250$IWordEditorGraphMerger"),c=n(5206),d=n(363),p=n(8192),g=n(3362),h=n(2575),_=n(9423),f=n(9959),m=n(7597),y=n(2953),v=n(6827),S=n(3545),I=n(3190),C=function(e){function t(){var t=e.call(this)||this;return t.Prompt=0,t.FileId=null,t}return(0,S.t)(t,e),t.prototype.getClassId=function(){return 100},t.construct=function(e,n){var r=new t;return r.FileId=e,r.Prompt=n,r},t}(I.b);(0,s.l)(C,"83616359$GraphMergeConsentChangedRequest",I.b,[]);var T=n(4537),b=n(5358),A=function(){function e(e,t,n,r,i,o,a){if(this._disposed=!1,this._graphSpaceReplicator=null,this.isWaitingOnSendingConsentRequest=!1,this.sentConsentRequest=!1,this._getRootQuerySignature=null,this._wordEditorGraphMerger=null,this._backupThrottler=null,this._collectionConsentManager=null,this._localCobaltLocationInfo=null,this._batchedServerOperationGenerator=null,this._getRootQuerySignature=e,this._wordEditorGraphMerger=n,this._backupThrottler=r,this._collectionConsentManager=i,this._wordEditorGraphMerger&&this._wordEditorGraphMerger.add_onGraphMergeComplete(s.i(this,this.HandleOnGraphMergeComplete,"HandleOnGraphMergeComplete")),this._localCobaltLocationInfo=o||T.n.get_instance(),!a){var l=new v.l;a=function(e){return l.getBatchedServerOperation(0,e)}}this._batchedServerOperationGenerator=a}return e.prototype.get_isWaitingOnSendingConsentRequest=function(){return this.isWaitingOnSendingConsentRequest},e.prototype.get_sentConsentRequest=function(){return this.sentConsentRequest},e.prototype.ConsentChoiceMade=function(){if(this._backupThrottler.get_hasOutboundRequest())this.isWaitingOnSendingConsentRequest=!0;else if(this.isWaitingOnSendingConsentRequest=!1,!this.get_sentConsentRequest()){this.sentConsentRequest=!0;var e=this._collectionConsentManager.get_promptStatus();if(m.ULS.sendTraceTag(39084353,300,50,"GraphMerge consent given: {0}",400===e),100===e||400===e){var t=C.construct(this._getRootQuerySignature(),e);this.SendRequest(t)}}},e.prototype.HandleOnGraphMergeComplete=function(e,t){t&&t.get_mergeResponse()&&t.get_mergeResponse().createGraphMergerReplayRequest&&(this._backupThrottler.get_isThrottled()||(this._backupThrottler.updateAfterCapture(),this._backupThrottler.set_hasOutboundRequest(!0),this.SendRequest(t.get_mergeResponse().createGraphMergerReplayRequest)))},e.prototype.SendRequest=function(e){var t=this,n=new b.g;n.set_requestObject(e),n.status=1;var r=this._batchedServerOperationGenerator((function(r){t.ResponseHandler(n,33===e.getClassId())}));r.addOperation(n),r.dispatchRequest()},e.prototype.ResponseHandler=function(e,t){if(!this._disposed)if(t&&this._backupThrottler.set_hasOutboundRequest(!1),2===e.statusCode&&!y.p.isNullOrEmptyList(e.get_responseObjects())&&1===e.get_responseObjects().length&&e.get_responseObjects()[0]){var n=e.get_responseObjects()[0];n.StatusCode?this._backupThrottler.setPermanentThrottle():t&&this._collectionConsentManager.requestConsentIfNeeded(s.i(this,this.ConsentChoiceMade,"ConsentChoiceMade")),this._localCobaltLocationInfo.updateLocalCobaltLocationInfoIfNecessary(n),this.get_isWaitingOnSendingConsentRequest()&&this.ConsentChoiceMade()}else this._backupThrottler.setPermanentThrottle()},e.prototype.onGraphSpaceReplicatorAvailable=function(e){this._graphSpaceReplicator=e,this._graphSpaceReplicator.add_onAfterReplication(s.i(this,this.HandleOnAfterReplication,"HandleOnAfterReplication")),this._graphSpaceReplicator.add_onAfterResponseReceived(s.i(this,this.handleOnAfterResponseReceived,"handleOnAfterResponseReceived"))},e.prototype.HandleOnAfterReplication=function(e,t){t&&(t.get_wasChangeRejected()&&this._backupThrottler.updateAfterCapture())},e.prototype.handleOnAfterResponseReceived=function(e,t){if(t){var n=t;n.ShowMergePrompt&&this._collectionConsentManager.requestConsentIfNeeded(s.i(this,this.ConsentChoiceMade,"ConsentChoiceMade")),h.AFrameworkApplication.dataPlumber&&(h.AFrameworkApplication.dataPlumber.SessionMergeInfo|=n.PartMergeInfo)}},e.prototype.dispose=function(){this._disposed||(this._wordEditorGraphMerger&&this._wordEditorGraphMerger.remove_onGraphMergeComplete(s.i(this,this.HandleOnGraphMergeComplete,"HandleOnGraphMergeComplete")),this._graphSpaceReplicator&&(this._graphSpaceReplicator.remove_onAfterReplication(s.i(this,this.HandleOnAfterReplication,"HandleOnAfterReplication")),this._graphSpaceReplicator.remove_onAfterResponseReceived(s.i(this,this.handleOnAfterResponseReceived,"handleOnAfterResponseReceived"))),this._disposed=!0)},e}();(0,s.l)(A,"5480e959$GraphMergeBackupManager",null,[c.t,Sys.IDisposable]);var M=function(){function e(e,t,n,r){if(this._collectionConsentManager=null,this._currentTimeGetter=null,this._minDelayBetweenBackupsInMs=0,this._maxBackupsAllowed=0,this._backupsCreated=0,this._isPermanentlyThrottled=!1,this.$$pf_HasOutboundRequest=!1,this._lastCaptureTime=new Date(0),this._collectionConsentManager=e,this._currentTimeGetter=t||function(){return new Date},!n){n=h.AFrameworkApplication.appSettingsManager?h.AFrameworkApplication.appSettingsManager.getIntAppSetting("WordEditorGraphMergeBackupDelayInMs",12e4):12e4}if(this._minDelayBetweenBackupsInMs=n,!r){r=h.AFrameworkApplication.appSettingsManager?h.AFrameworkApplication.appSettingsManager.getIntAppSetting("WordEditorGraphMergeMaxBackups",1):1}this._maxBackupsAllowed=r}return e.prototype.get_hasOutboundRequest=function(){return this.$$pf_HasOutboundRequest},e.prototype.set_hasOutboundRequest=function(e){return this.$$pf_HasOutboundRequest=e,e},e.prototype.get_IsThrottledDueToTime=function(){return+this._currentTimeGetter()-+this._lastCaptureTime<this._minDelayBetweenBackupsInMs},e.prototype.get_isThrottled=function(){return 500!==this._collectionConsentManager.get_promptStatus()&&(100===this._collectionConsentManager.get_promptStatus()||(this._isPermanentlyThrottled||this.get_hasOutboundRequest()||this.get_IsThrottledDueToTime()))},e.prototype.updateAfterCapture=function(){this._lastCaptureTime=this._currentTimeGetter(),this._backupsCreated++,this._backupsCreated>=this._maxBackupsAllowed&&this.setPermanentThrottle()},e.prototype.setPermanentThrottle=function(){this._isPermanentlyThrottled||(this._isPermanentlyThrottled=!0,m.ULS.sendTraceTag(39084356,300,50,"Permanently throttling merge reports after creating {0} out of a maximum of {1} reports.",this._backupsCreated,this._maxBackupsAllowed))},e}();(0,s.l)(M,"4db89750$GraphMergeBackupThrottler",null,[l]);var P=function(){function e(e,t,n){this._businessBarControllerFuture=null,this._featureHelperLazy=null,this._hasEverRequestedConsent=!1,this.$$pf_PromptStatus=0,this._businessBarControllerFuture=e,this._featureHelperLazy=t,null==n&&(n=!!h.AFrameworkApplication.appSettingsManager&&h.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorGraphMergeBypassConsentPrompt")),this.set_promptStatus(n?500:300)}return e.prototype.get_promptStatus=function(){return this.$$pf_PromptStatus},e.prototype.set_promptStatus=function(e){return this.$$pf_PromptStatus=e,e},e.prototype.requestConsentIfNeeded=function(e){var t=this;if(!this._hasEverRequestedConsent&&300===this.get_promptStatus()){var n=this._featureHelperLazy.get_value();n&&n.isFeatureEnabled(59)&&(this._hasEverRequestedConsent=!0,this._businessBarControllerFuture.execute((function(n){n.showGraphMergePrompt((function(){t.ConsentReceived(e)}),(function(){t.ConsentDenied(e)}))})))}},e.prototype.ConsentDenied=function(e){300===this.get_promptStatus()&&(m.ULS.sendTraceTag(42333270,300,50,"Consent denied for investigating merge failures."),this.set_promptStatus(100),e()),this.RemoveGraphMergeConsentBusinessBarEntry()},e.prototype.ConsentReceived=function(e){300===this.get_promptStatus()&&(m.ULS.sendTraceTag(42333271,300,50,"Consent received for investigating merge failures."),this.set_promptStatus(400),e()),this.RemoveGraphMergeConsentBusinessBarEntry()},e.prototype.RemoveGraphMergeConsentBusinessBarEntry=function(){this._businessBarControllerFuture.execute((function(e){e.hideGraphMergePrompt()}))},e}();(0,s.l)(P,"c915eecf$GraphMergeCollectionConsentManager",null,[i.i]);var F=n(8367),w=n(7175),R=n(257),E=n(389),k=n(5214),D=n(1822),O=n(4455),U=n(1308),x=n(3795),L=n(3748),N=n(5479),B=n(8540),H=n(9725),$=n(4168),G=n(7842),W=n(6382),V=n(9636),j=n(4192),q=n(706),z=function(){function e(e){this.mergedRevisions=null,this.createGraphMergerReplayRequest=null,this.partMergeInfo=0,this.mergedRevisions=e}return e.prototype.get_mergedRevisions=function(){return this.mergedRevisions},e}();(0,s.l)(z,"c68dd1c2$GraphMergerResponse",null,[]);var K=n(9237),Q=n(6510),Z=n(8047),J=n(1183),X=function(e){function t(){var t=e.call(this)||this;return t.FileId=null,t.BaseRevisions=null,t.MergedRevision=null,t.TheirRevisions=null,t.YourRevisions=null,t.IgnoreConflictsInLastServerRevision=!1,t.MergeHint=0,t.ObjectSpaceId=null,t.RequestId=null,t.Source=0,t.Reason=0,t.Prompt=0,t}return(0,S.t)(t,e),t.prototype.getClassId=function(){return 33},t.construct=function(e,n,r,i,o,a,s,l,u,c,d){var p=new t;return p.FileId=e,p.BaseRevisions=n,p.TheirRevisions=r,p.YourRevisions=i,p.IgnoreConflictsInLastServerRevision=o,p.MergeHint=a,p.ObjectSpaceId=s?J.j.serialize(s):null,p.RequestId=l?J.j.serialize(l):null,p.Source=u,p.Reason=c,p.Prompt=d,p},t}(I.b);(0,s.l)(X,"63d808c2$CreateGraphMergeReplayRequest",I.b,[]);var Y,ee=n(3629),te=n(382),ne=n(7518);!function(e){e[e.none=0]="none",e[e.browser=1]="browser",e[e.serverPutChanges=2]="serverPutChanges",e[e.syncDiff=3]="syncDiff",e[e.docxMerge=4]="docxMerge",e[e.undo=5]="undo"}(Y||(Y={})),(0,s.h)("aa295e3b$GraphMergeSource",Y);var re=function(){function e(e){this._state=null,this._mergeFuncStep="",this._failureDetail=null,this._lastLoggedTime=0,this._endTime=0,this._logDict=new x.e(String,Object),this._timestepDict=new x.e(String,Number),this._additionalMergeFailureDetails=new N.o(te.x,null),this._mergeUtils=new j.s,this._state=e}return e.prototype.setStartTime=function(e){this._lastLoggedTime=e},e.prototype.logMergeFunctionChain=function(e,t){this._mergeFuncStep=String.format("{0}-{1}",e,t)},e.prototype.logMergeFailureDetail=function(e){this._failureDetail?this._additionalMergeFailureDetails.add(e):this._failureDetail=e},e.prototype.logMergeEndTime=function(){this._endTime=this.GetCurrentTimeInMs(),this.logMergeTimestep("MergeEnd")},e.prototype.logMergeTimestep=function(e){var t=this.GetCurrentTimeInMs();this._timestepDict.set_item(e,t-this._lastLoggedTime),this._lastLoggedTime=t},e.prototype.getMergeJsonLogs=function(){return this._logDict.set_item("Id",this._state.input.MergeId.toString()),this._logDict.set_item("Source",Y[this._state.input.Source]),this._logDict.set_item("Base",e.XDictToDict(String,Object,this.GetBaseRevisionSummary())),this._logDict.set_item("Favored",e.XDictToDict(String,Object,this.GetRevisionSummary(!0))),this._logDict.set_item("Unfavored",e.XDictToDict(String,Object,this.GetRevisionSummary(!1))),this._logDict.set_item("NodesRolledBack",e.XDictToDict(String,Number,this.GetNodesRolledBack())),this._logDict.set_item("FuncStep",this._mergeFuncStep),this._logDict.set_item("FailureDetail",e.XDictToDict(String,Object,this.GetFailureDetail())),this._logDict.set_item("ExtraDetails",this.GetExtraFailureDetails()),this._logDict.set_item("Timeline",e.XDictToDict(String,Number,this._timestepDict)),this._logDict.set_item("Result",e.XDictToDict(String,Object,this.GetMergeResult())),JSON.stringify(e.XDictToDict(String,Object,this._logDict))},e.prototype.GetCurrentTimeInMs=function(){return(new Date).getTime()},e.prototype.GetGraphFeatures=function(){if(!this._state.runtime.InitializedRuntimeState)return null;var e=new x.e(String,Number),t=U.h.createFromString("{0B310978-27EA-4A49-A620-7E588CFE64C6}{1}"),n=this._state.runtime.FavoredObjects.getOrElse(t,this._state.runtime.BaseObjects.get_item(t)||this._state.runtime.UnfavoredObjects.get_item(t));if(!n)return null;for(var r=0,i=n.listProperties();r<i.length;r++){var o=i[r],a=this._mergeUtils.getPropertyUint32(n,o)||0;e.set_item(ne.d.toPropertyId(o).toString(),a)}return e},e.prototype.GetBaseRevisionSummary=function(){for(var e=new x.e(String,Object),t=this._state.input.YourChanges,n=this._state.runtime.CommonBaseLastChange?this._state.runtime.CommonBaseLastChange.get_id():U.h.get_nil(),r=!1,i=0;i<t.get_length();i++)if(t.get_item(i).get_id().equals(n)){r=!0;break}return e.set_item("LastId",n.toString()),e.set_item("Length",r?i+1:-1),e},e.prototype.GetRevisionSummary=function(e){var t,n=new x.e(String,Object);return this._state.input.MergeHint?(t=e?2===this._state.input.MergeHint?this._state.input.TheirChanges:this._state.input.YourChanges:2===this._state.input.MergeHint?this._state.input.YourChanges:this._state.input.TheirChanges,n.set_item("FirstId",t.get_item(0).get_id().toString()),n.set_item("LastId",t.get_length()?t.get_item(t.get_length()-1).get_id().toString():null),n.set_item("Length",t.get_length()),n):null},e.prototype.GetNodesRolledBack=function(){if(!this._state.runtime.InitializedRuntimeState)return null;var e=this._state.runtime.UnfavoredObjects,t=new x.e(String,Number);return e.forEach((function(e,n){var r;return t.tryGetValue(n.get_runtimeClassId().toString(),(0,D.m)((function(){return r}),(function(e){return r=e}))),t.set_item(n.get_runtimeClassId().toString(),r+1),!0})),t},e.prototype.GetFailureDetail=function(){return this._failureDetail?this._failureDetail.getFailureDetail():null},e.prototype.GetExtraFailureDetails=function(){var t=new N.o(Object,null);return this._additionalMergeFailureDetails.forEach((function(n){return t.add(e.XDictToDict(String,Object,n.getFailureDetail())),!0})),t.toArray()},e.prototype.GetMergeResult=function(){var e=new x.e(String,Object);return e.set_item("Succeeded",this._state.output.Succeeded),e.set_item("Timeout",this._state.output.Timeout),e.set_item("Crash",this._state.output.Crash),e.set_item("MergedRevisions",this._state.output.MergedRevisions?this._state.output.MergedRevisions.get_length():-1),e.set_item("Duration",this._endTime-this._state.input.StartingTimeInMs),e},e.XDictToDict=function(e,t,n){if(!n)return null;var r={};return n.forEach((function(e,t){return r[e.toString()]=t,!0})),r},e}();(0,s.l)(re,"faab3468$MergeLogger",null,[]);var ie=function(){return function(){this.Source=0,this.TheirChanges=null,this.YourChanges=null,this.MergeId=null,this.ObjectSpaceId=null,this.MergeHint=0,this.IgnoreConflictsInLastServerRevision=!1,this.StartingTimeInMs=0,this.Mode=0,this.FeatureHelperFactory=null,this.MergeId=U.h.create()}}();(0,s.l)(ie,"424311aa$InputState",null,[]);var oe=function(){return function(){this.Crash=!1,this.Succeeded=!1,this.Timeout=!1,this.MergedRevisions=null}}();(0,s.l)(oe,"fc473ac3$OutputState",null,[]);var ae=function(){return function(){this.ShouldTraceVerbose=!1,this.ShouldTraceInfo=!1,this.InitializedRuntimeState=!1,this.CommonBaseLastChange=null,this.FavoredRevisionId=null,this.UnfavoredRevisionId=null,this.BaseObjects=null,this.FavoredObjects=null,this.UnfavoredObjects=null,this.MergedObjects=null,this.FavoredRemovedObjectIds=null,this.UnfavoredRemovedObjectIds=null,this.NodeTripletsByClassId=null,this.ThrowIfTimeElapsed=null,this.ChildMergeSkippableIds=null,this.FeatureHelper=null}}();(0,s.l)(ae,"8223d8c0$RuntimeState",null,[]);var se=function(){return function(){this.input=null,this.runtime=null,this.output=null,this.logger=null,this.input=new ie,this.runtime=new ae,this.output=new oe,this.logger=new re(this)}}();(0,s.l)(se,"a031b64b$MergeState",null,[]);var le=n(9168),ue=function(){function e(e,t,n){this._runtimeMergeState=null,this._baseObjects=null,this._modifiedServerObjects=null,this._modifiedLocalObjects=null,this._mergeableObjectUtilities=null,this._localChangeRejected=!1,this._paragraphMergeDelegate=null,this._runtimeMergeState=e,this._baseObjects=e.baseObjects,this._modifiedServerObjects=e.theirObjects,this._modifiedLocalObjects=e.yourObjects,this._localChangeRejected=e.localChangeRejected,this._mergeableObjectUtilities=t||new j.s,this._paragraphMergeDelegate=n||s.i(this,this.DoParagraphMergeForModifiedObject,"DoParagraphMergeForModifiedObject")}return e.prototype.DoMergeToUpdateSelectionRecords=function(e){for(var t=new N.o(ee.w,null),n=0;n<e.get_length();n++){var r=this.DoMergeToUpdateSelectionRecord(e.get_item(n));t.add(r)}return t},e.prototype.DoMergeToUpdateSelectionRecordForDeletedParagraph=function(e,t,n){var r=e,i=e.startObjectId===e.endObjectId&&e.startCp===e.endCp;return t&&(this.UpdateSelectionRecordForDeletedParagraph(e.startObjectId,e.startCp,(0,D.m)((function(){return r.startObjectId}),(function(e){return r.startObjectId=e})),(0,D.m)((function(){return r.startCp}),(function(e){return r.startCp=e}))),i&&(r.endObjectId=r.startObjectId,r.endCp=r.startCp)),n&&!i&&this.UpdateSelectionRecordForDeletedParagraph(e.endObjectId,e.endCp,(0,D.m)((function(){return r.endObjectId}),(function(e){return r.endObjectId=e})),(0,D.m)((function(){return r.endCp}),(function(e){return r.endCp=e}))),r},e.prototype.DoMergeToUpdateSelectionRecord=function(e){if(e.startObjectId===e.endObjectId){var t,n,r=new N.o(Number,null);return r.add(e.startCp),r.add(e.endCp),this.UpdateSelectionRecordsForParagraph(e.startObjectId,r,(0,D.m)((function(){return t}),(function(e){return t=e})),(0,D.m)((function(){return n}),(function(e){return n=e}))),new ee.w(t,n.get_item(0),t,n.get_item(1),null,null,null)}var i,o,a,s,l=new N.o(Number,null),u=new N.o(Number,null);return l.add(e.startCp),this.UpdateSelectionRecordsForParagraph(e.startObjectId,l,(0,D.m)((function(){return i}),(function(e){return i=e})),(0,D.m)((function(){return a}),(function(e){return a=e}))),u.add(e.endCp),this.UpdateSelectionRecordsForParagraph(e.endObjectId,u,(0,D.m)((function(){return o}),(function(e){return o=e})),(0,D.m)((function(){return s}),(function(e){return s=e}))),new ee.w(i,a.get_item(0),o,s.get_item(0),null,null,null)},e.prototype.UpdateSelectionRecordsForParagraph=function(e,t,n,r){if(n.val=e,r.val=t,this._baseObjects.get_item(e)){if(this._modifiedServerObjects.get(e))this._paragraphMergeDelegate(e,t,n,r);else if(this._runtimeMergeState.incomingRevisions&&!this._runtimeMergeState.incomingRevisions.get_item(this._runtimeMergeState.incomingRevisions.get_length()-1).isObjectReferenced(e)){r.val=new N.o(Number,null);for(var i=function(i){var a;o.UpdateSelectionRecordForDeletedParagraph(e,t.get_item(i),n,(0,D.m)((function(){return a}),(function(e){return a=e}))),r.val.add(a)},o=this,a=0;a<t.get_length();a++)i(a)}}else m.ULS.sendTraceTag(4339675,318,50,"UpdateSelectionRecordsForParagraph: Not updating the selection record for [Paragraph: {0}] as it is new in this revision",e)},e.prototype.GetLoggableString=function(e){var t="";return e.forEach((function(e){return t+=e.toLoggableString(),t+=" ",!0})),t},e.prototype.GetMergeStateBasedOnMergeHint=function(e){var t=W.w.get_instance().tryResolve(a.d),n=new se;return n.input.Source=this._runtimeMergeState.graphMergeSource,n.input.MergeHint=this._runtimeMergeState.mergeHint,n.input.FeatureHelperFactory=function(e){return t},n.runtime.BaseObjects=this._baseObjects,n.runtime.CommonBaseLastChange=this._runtimeMergeState.commonDependency,1===e?(n.runtime.FavoredObjects=this._modifiedLocalObjects,n.runtime.UnfavoredObjects=this._modifiedServerObjects,n.runtime.FavoredRevisionId=this._runtimeMergeState.lastLocalChangeId,n.runtime.UnfavoredRevisionId=this._runtimeMergeState.lastServerChangeId):2===e&&(n.runtime.FavoredObjects=this._modifiedServerObjects,n.runtime.UnfavoredObjects=this._modifiedLocalObjects,n.runtime.FavoredRevisionId=this._runtimeMergeState.lastServerChangeId,n.runtime.UnfavoredRevisionId=this._runtimeMergeState.lastLocalChangeId),n.runtime.FeatureHelper=t,n},e.prototype.DoParagraphMergeForModifiedObject=function(e,t,n,r){n.val=e,r.val=t;var i=this._modifiedServerObjects.get(e);if(i){var o=new N.o(E.v,null);o.add(i);var a=this._modifiedLocalObjects.get(e)||this._baseObjects.get_item(e),s=new N.o(E.v,null);s.add(a);var l=new N.o(E.v,null);l.add(this._baseObjects.get_item(e)),m.ULS.sendTraceTag(17409890,318,50,"Performing CpMerge: [Source: {0}] [MergeHint: {1}] [LocalRevisionObjects: {2}] [ServerRevisionObjects: {3}]",this._runtimeMergeState.graphMergeSource,this._runtimeMergeState.mergeHint,this.GetLoggableString(s),this.GetLoggableString(o));var u=this.GetMergeStateBasedOnMergeHint(this._runtimeMergeState.mergeHint),c=new le.o(u,l,1===u.input.MergeHint?s:o,1===u.input.MergeHint?o:s,this.GetMergeStateBasedOnMergeHint(1),s,o,null);r.val=new N.o(Number,null);for(var d=function(i){var o;p._runtimeMergeState.throwIfTimeElapsed("GraphMergeSelectionRecordUpdater.DoParagraphMergeForModifiedObject");var a=c.updateCpAccordingToIncomingChange(e,t.get_item(i),n,(0,D.m)((function(){return o}),(function(e){return o=e})));r.val.add(o),a?m.ULS.sendTraceTag(17409891,318,50,"UpdateSelectionRecordsForParagraph: Updating the selection record for [Paragraph: {0}] [Cp: {1}] to [Result Paragraph: {2}] [Result Cp: {3}] ",e,t.get_item(i),n.val,o):m.ULS.sendTraceTag(4339677,318,15,"UpdateSelectionRecordsForParagraph: UpdateCpAccordingToIncomingChange was unable to update the cp for [Paragraph: {0}]",e)},p=this,g=0;g<t.get_length();g++)d(g)}},e.prototype.GetParagraphIndexInList=function(e,t,n){n.val=0;for(var r=0;r<e.get_length();r++)if(t.equals(e.get_item(r)))return n.val=r,!0;return!1},e.prototype.UpdateSelectionRecordForDeletedParagraph=function(e,t,n,r){var i,o=this,a=this._localChangeRejected&&!!this._modifiedLocalObjects.get_item(e)&&!this._baseObjects.get_item(e);i=a?this._modifiedLocalObjects:this._modifiedServerObjects;var s,l=e,u=t,c=!1,d=!1;(i.forEach((function(t,n){if(o._runtimeMergeState.throwIfTimeElapsed("GraphMergeSelectionRecordUpdater.UpdateSelectionRecordForDeletedParagraph"),o.IsOutlineElementAncestor(n.get_runtimeClassId())&&o._baseObjects.get_item(t)){var r=null,i=void 0;if(a)r=o.GetParagraphNodesUnderObject((function(e){return o._modifiedLocalObjects.get_item(e)||o._baseObjects.get_item(e)}),t),i=o.IsObjectIdInList(r,e);else{var s=o.GetParagraphNodesUnderObject((function(e){return o._baseObjects.get_item(e)}),t);i=o.IsObjectIdInList(s,e)}if(i){d=!0,r||(r=o.GetParagraphNodesUnderObject((function(e){return o._modifiedLocalObjects.get_item(e)||o._baseObjects.get_item(e)}),t));var p=o.GetParagraphNodesUnderObject((function(e){return o._modifiedServerObjects.get_item(e)||o._baseObjects.get_item(e)}),t),g=0;if(o.GetParagraphIndexInList(r,e,(0,D.m)((function(){return g}),(function(e){return g=e})))){for(var h=g+1;h<r.get_length();h++)if(o.IsObjectIdInList(p,r.get_item(h)))return u=0,l=r.get_item(h),c=!0,!1;for(h=g-1;h>=0;h--)if(o.IsObjectIdInList(p,r.get_item(h)))return u=Number.MAX_VALUE,l=r.get_item(h),c=!0,!1}}}return!0})),c)||(m.ULS.sendTraceTag(4339678,318,15,"UpdateSelectionRecordForDeletedParagraph: Was unable to reposition the selection record [ObjectID : {0}] [Cp: {1}] [IsNewParaInRejectedLocalChange: {2}] [FoundDeletedNode: {3}]",e,t,a,d),5===this._runtimeMergeState.graphMergeSource&&(m.ULS.sendTraceTag(17340240,318,50,"UpdateSelectionRecordForDeletedParagraph: Unable to position IP, Trying to update to first para in server revision for Undo",l),this.GetFirstParagraphInIncomingChange((0,D.m)((function(){return s}),(function(e){return s=e})))?(l=s,u=0,m.ULS.sendTraceTag(17340241,318,15,"UpdateSelectionRecordForDeletedParagraph: Did not find any paragraphs that were common on client and server. Repositioning to the start of the first [Paragraph:{0}] in the incoming revision",l)):m.ULS.sendTraceTag(17340242,318,15,"UpdateSelectionRecordForDeletedParagraph: Unable to get the first para in an incoming change",l)));n.val=l,r.val=u},e.prototype.GetFirstParagraphInIncomingChange=function(e){var t=this;e.val=U.h.get_nil();var n=new N.o(U.h,null);return this._modifiedServerObjects.forEach((function(e,r){return t._runtimeMergeState.throwIfTimeElapsed("GraphMergeSelectionRecordUpdater.UpdateSelectionRecordForDeletedParagraph"),!t.IsOutlineElementAncestor(r.get_runtimeClassId())||(n=t.GetParagraphNodesUnderObject((function(e){return t._modifiedServerObjects.get_item(e)||t._baseObjects.get_item(e)}),e),!1)})),n.get_length()>0&&(e.val=n.get_item(0),!0)},e.prototype.IsOutlineElementAncestor=function(e){return 393241===e||393250===e||393251===e||393252===e},e.prototype.GetParagraphNodesUnderObject=function(e,t){var n=e(t),r=new N.o(U.h,null);if(!this.IsOutlineElementAncestor(n.get_runtimeClassId()))return r;for(var i=this._mergeableObjectUtilities.getPropertyObjectIds(n,O.b.elementNodes),o=0;o<i.get_length();o++){var a=new N.o(U.h,null);this.GetParagraphNodesUnderObjectInternal(e,i.get_item(o),a),r.insertRange(r.get_length(),a)}return r},e.prototype.GetParagraphNodesUnderObjectInternal=function(e,t,n){var r=e(t);if(r)if(393230!==r.get_runtimeClassId())if(393229!==r.get_runtimeClassId())if(393250!==r.get_runtimeClassId()&&393251!==r.get_runtimeClassId()&&393252!==r.get_runtimeClassId());else for(var i=this._mergeableObjectUtilities.getPropertyObjectIds(r,O.b.elementNodes),o=0;o<i.get_length();o++)this.GetParagraphNodesUnderObjectInternal(e,i.get_item(o),n);else{var a=this._mergeableObjectUtilities.getPropertyObjectIds(r,O.b.contentNodes).getItemAt(0);this.GetParagraphNodesUnderObjectInternal(e,a,n)}else n.add(t)},e.prototype.IsObjectIdInList=function(e,t){for(var n=0;n<e.get_length();n++)if(t.equals(e.get_item(n)))return!0;return!1},e}();(0,s.l)(ue,"8a836c6a$GraphMergeSelectionRecordUpdater",null,[]);var ce=n(6812),de=n(5483),pe=n(7114),ge=function(e){function t(){var t=e.call(this)||this;return t.stacktrace=null,t.willContinue=!1,t}return(0,S.t)(t,e),t.prototype.get_failureType=function(){return"Crash"},t.prototype.getFailureDetail=function(){return this.detail.set_item("Type",this.get_failureType()),this.detail.set_item("Trace",this.TruncateStacktrace(this.stacktrace)),this.detail.set_item("Continue",this.willContinue),this.detail},t.prototype.TruncateStacktrace=function(e){for(var t=e.split("\n"),n=t.length>4?4:t.length,r=new Sys.StringBuilder,i=0;i<n;i++)i===n-1?r.append(String.format("{0}...",t[i])):r.append(String.format("{0}\n",t[i]));return r.toString()},t}(pe.w);(0,s.l)(ge,"ec9ac406$CrashMergeFailureDetail",pe.w,[]);var he=n(2186),_e=(0,s.y)("44bc5c69$IGraphNodeMerge"),fe=function(){return function(e,t,n,r,i,o){this.shouldTraceVerbose=!1,this.mergeableObjectUtilities=null,this.mergeState=null,this.baseFavoredDiffLazy=null,this.baseConflictDiffLazy=null,this.conflictFavoredDiffLazy=null,this.graphNodeComplexMerge=null,this.mergedProperties=null,this.propertiesToRemove=null,this.wasNodeLogged=!1,this.isSuccessful=!1,this.mergedObject=null,this.shouldTraceVerbose=e.runtime.ShouldTraceVerbose,this.mergeState=e,this.mergeableObjectUtilities=t,this.baseFavoredDiffLazy=n,this.baseConflictDiffLazy=r,this.conflictFavoredDiffLazy=i,this.graphNodeComplexMerge=o}}();(0,s.l)(fe,"e85277d7$GraphNodeComplexMergeState",null,[]);var me=n(6902),ye=n(833),ve=function(){function e(e,t){this.mergeFunctions=null,this.mergeableObjectUtilities=null,this.mergeableObjectUtilities=e||new j.s,this.mergeFunctions=t||this.getMergeFunctions()}return e.prototype.get_mergeFunctions=function(){return this.mergeFunctions},e.prototype.get_mergeableObjectUtilities=function(){return this.mergeableObjectUtilities},e.prototype.getMergeFunctions=function(){return[s.i(this,this.SimpleMerge,"SimpleMerge"),s.i(this,this.ComplexMerge,"ComplexMerge")]},e.prototype.SetupState=function(e,t,n,r,i,o){var a=new fe(e,n,new g.q(me.p,(function(){return new me.p(r?r.mergeableObject:null,i)})),new g.q(me.p,(function(){return new me.p(r?r.mergeableObject:null,o)})),new g.q(me.p,(function(){return new me.p(o,i)})),t.createGraphNodeComplexMerge(i,(function(t){return e.runtime.FeatureHelper.isFeatureEnabled(t)})));return a.mergedProperties=r.getTouchedProperties(),a.propertiesToRemove=new N.o(Number,null),a},e.prototype.merge=function(e,t,n,r,i,o,a){for(var s=this.SetupState(e,t,n,r,i,o),l=!0,u=0;u<this.get_mergeFunctions().length&&l;u++){(l=(0,this.get_mergeFunctions()[u])(s))||e.logger.logMergeFunctionChain("GraphNodeMerge.GetMergeFunctions()",u)}return a.val=s.isSuccessful&&s.mergedObject?new ye.o(s.mergedObject,!1):null,a.val&&a.val.setTouchedProperties(s.mergedProperties),s.isSuccessful},e.prototype.SimpleMerge=function(e){var t=e.graphNodeComplexMerge.get_propertyMergeStrategies();if(!e.baseConflictDiffLazy.get_value().isDifferentWithExceptions(t)||!e.conflictFavoredDiffLazy.get_value().isDifferentWithExceptions(t))return e.isSuccessful=!0,!1;if(!e.baseFavoredDiffLazy.get_value().isDifferentWithExceptions(t)){var n=e.baseConflictDiffLazy.get_value().get_newObject();return e.isSuccessful=!0,e.mergedObject=n.cloneForMerge(),!1}return!0},e.prototype.ComplexMerge=function(e){var t=e.baseConflictDiffLazy.get_value().get_newObject();e.shouldTraceVerbose&&B.p.get_instance().traceTag(4018183,1,4,"ComplexMerge: Begin [Id: {0}] [ClassId: {1}]",t.get_id(),t.get_runtimeClassId());var n=e.graphNodeComplexMerge.tryMergeNode(e);return e.isSuccessful=n,B.p.get_instance().traceTag(4018184,1,n?4:3,"ComplexMerge: {0} for object: [Id: {1}] [ClassId: {2}] [MergedObject returned: {3}]",n?"Succeeded":"Failed",t.get_id(),t.get_runtimeClassId(),!!e.mergedObject),n},e}();(0,s.l)(ve,"bf1e5760$GraphNodeMerge",null,[_e]);var Se=n(687),Ie=n(9755),Ce=n(294),Te=function(){function e(e,t,n,r,i,o,s,l,u,c,d,p){this._getRootQuerySignature=null,this._backupThrottler=null,this._collectionConsentManager=null,this.graphMergeBackupCases=0,this.revisionDifferFactory=null,this.revisionFactory=null,this.mergeableObjectUtilities=null,this.mergeFunctions=null,this.graphNodeComplexMergeFactory=null,this.graphNodeMerge=null,this.maxMergeTimeInMs=0,this.childMerge=null,this.featureHelperFactory=null,this._getRootQuerySignature=e||function(){return h.AFrameworkApplication.get_rootQuerySignature()},t||(t=function(e){return new K.i(e)}),this.revisionFactory=t,this.mergeableObjectUtilities=n||new j.s,this.childMerge=s||new de.ChildNodeListMerge(null,null,null,null,null),this.revisionDifferFactory=l,this.get_revisionDifferFactory()||(this.revisionDifferFactory=function(e,t,n){return new Q.b(e,t,n,!1)}),this.mergeFunctions=r||this.GetMergeFunctions(),this.graphNodeComplexMergeFactory=i||new he.GraphNodeComplexMergeFactory,this.graphNodeMerge=o||new ve(this.get_mergeableObjectUtilities(),null),this.maxMergeTimeInMs=isNullOrUndefined(u)||-1===u?Z.App.wordEditorGraphMergeMaxBrowserTimeInMs:u,this._backupThrottler=c,this._collectionConsentManager=d,this.graphMergeBackupCases=this.DetermineGraphMergeBackupCases(p),this.featureHelperFactory=function(e){return W.w.get_instance().tryResolve(a.d)}}return e.prototype.DetermineGraphMergeBackupCases=function(e){if(!e){e=h.AFrameworkApplication.appSettingsManager?h.AFrameworkApplication.appSettingsManager.getIntAppSetting("WordEditorGraphMergeBackupCasesBrowser",0):0}return e},e.prototype.GetCurrentTimeInMs=function(){return(new Date).getTime()},e.prototype.StringFormat=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return String.format.apply(null,[e].concat(t))},e.prototype.ThrowException=function(e){throw H.t.invalidOperation(e)},e.prototype.GetExceptionLog=function(e){return String.format("Name: {0}, Message: {1}, Stack: {2}",e.name,e.message,e.stack)},e.prototype.PrepareBackupIfNeeded=function(t){if(this._backupThrottler&&this._backupThrottler.get_isThrottled())return null;var n,r,i;if(!this.SupportsMergeReplaysForResult(t))return null;this.LogMergeDetails(t),this.CreateSerializedRevisionLists(q.q,t,s.i(this,this.CreateSerializedRevisionFrom,"CreateSerializedRevisionFrom"),(0,D.m)((function(){return n}),(function(e){return n=e})),(0,D.m)((function(){return r}),(function(e){return r=e})),(0,D.m)((function(){return i}),(function(e){return i=e})));var o=e.GetGraphMergeReplayReason(t),a=X.construct(this._getRootQuerySignature(),n.toArrayList(),r.toArrayList(),i.toArrayList(),t.input.IgnoreConflictsInLastServerRevision,t.input.MergeHint,t.input.ObjectSpaceId,t.input.MergeId,t.input.Source,o,this._collectionConsentManager.get_promptStatus()),l=t.output.MergedRevisions;return 3===o&&l.get_length()>0&&(a.MergedRevision=this.CreateSerializedRevisionFrom(t.output.MergedRevisions.last())),a},e.prototype.CreateSerializedRevisionFrom=function(e){var t=e.get_baseMergeableRevision(),n=e,r=_.App.get_activeAppFrame().workspace.get_activePage();return new q.q(n,t,r.get_contentObjectSpace(),r.get_fileId(),r.get_relativePath(),r.get_contextId(),t?t.get_id():U.h.get_nil(),this.get_revisionDifferFactory(),!1,!0)},e.prototype.doMergeToUpdateSelectionRecords=function(e,t){return new ue(e,null,null).DoMergeToUpdateSelectionRecords(t)},e.prototype.doMergeToUpdateSelectionRecordForDeletedParagraph=function(e,t,n,r){return new ue(e,null,null).DoMergeToUpdateSelectionRecordForDeletedParagraph(t,n,r)},e.prototype.get_revisionDifferFactory=function(){return this.revisionDifferFactory},e.prototype.get_revisionFactory=function(){return this.revisionFactory},e.prototype.get_mergeableObjectUtilities=function(){return this.mergeableObjectUtilities},e.prototype.get_mergeFunctions=function(){return this.mergeFunctions},e.prototype.get_graphNodeComplexMergeFactory=function(){return this.graphNodeComplexMergeFactory},e.prototype.get_graphNodeMerge=function(){return this.graphNodeMerge},e.prototype.get_maxMergeTimeInMs=function(){return this.maxMergeTimeInMs},e.prototype.get_childMerge=function(){return this.childMerge},e.prototype.get_featureHelperFactory=function(){return this.featureHelperFactory},e.prototype.mergeChanges=function(e,t,n,r,i,o,a){var s=this.CreateMergeStateAndPopulateInputState(e,t,r,i,o,a,this.get_featureHelperFactory()),l=0,u=s.runtime.ShouldTraceInfo,c=null;try{if(u){var d=e.get_length()?e.getItemAt(e.get_length()-1):null,p=t.get_length()?t.getItemAt(t.get_length()-1):null;B.p.get_instance().traceTag(4051606,1,3,"MergeChanges: Begin. [MergeId: {0}] [TheirChanges - Length:{1} Last:{2} Base:{3}] [YourChanges - Length:{4} Last:{5} Base:{6}] [MergeHint: {7}] [IgnoreConflictsInLastServerRevision: {8}] [MaxMergeTimeInMs: {9}] [Source: {10}]",s.input.MergeId,e.get_length(),d?d.get_id():U.h.get_nil(),d&&d.get_baseMergeableRevision()?d.get_baseMergeableRevision().get_id():U.h.get_nil(),t.get_length(),p?p.get_id():U.h.get_nil(),p&&p.get_baseMergeableRevision()?p.get_baseMergeableRevision().get_id():U.h.get_nil(),i,o,this.get_maxMergeTimeInMs(),a)}for(;l<this.get_mergeFunctions().length;l++){if(!(0,this.get_mergeFunctions()[l])(s)){s.logger.logMergeFunctionChain("GraphMerger.GetMergeFunctions()",l);break}}return c=new z(s.output.MergedRevisions)}catch(e){var g=!s.output.Timeout;s.output.Crash=g;var h=this.GetExceptionLog(e),_=this.StringFormat("Merge {0}! [MergeId: {1}] Failing the merge. [Will continue: {2}] [{3}]",g?"Crashed":"Timed Out",s.input.MergeId,!!s.output.MergedRevisions,h);if(g?(B.p.get_instance().traceTag(4051608,1,1,"MergeChanges Crash. [Error: {0}]",_),s.logger.logMergeFailureDetail((0,k.m)(new ge,{stacktrace:h,willContinue:!!s.output.MergedRevisions}))):B.p.get_instance().traceTag(4993346,1,2,"MergeChanges Timeout. [Error: {0}]",_),s.output.MergedRevisions)return c=new z(s.output.MergedRevisions);throw e}finally{s.output.Succeeded?u&&B.p.get_instance().traceTag(4059162,1,3,this.GetEndingLogMessage(s,l,"Succeeded")):s.output.Timeout?B.p.get_instance().traceTag(4059163,1,2,this.GetEndingLogMessage(s,l,"Timeout")):s.output.Crash?s.output.MergedRevisions?B.p.get_instance().traceTag(4059165,1,1,this.GetEndingLogMessage(s,l,"Crash - Rejection")):B.p.get_instance().shipAssertTag(4059166,1,!1,this.GetEndingLogMessage(s,l,"Crash - Failed")):B.p.get_instance().traceTag(4059164,1,2,this.GetEndingLogMessage(s,l,"Rejection")),s.logger.logMergeEndTime(),B.p.get_instance().traceMultiPartMessageTag(42350232,1,s.output.Succeeded?3:2,"MergeLogger",s.logger.getMergeJsonLogs());var f=2*(a-1),m=s.output.Succeeded?2:1;if(c.partMergeInfo=c.partMergeInfo|m<<f,c)try{c.createGraphMergerReplayRequest=this.PrepareBackupIfNeeded(s)}catch(e){B.p.get_instance().shipAssertTag(4059166,1,!1,"Failed to create merge report {0}",e)}}},e.prototype.LogMergeDetails=function(e){B.p.get_instance().traceTag(4535064,1,3,"Sending merge backup. [MergeId: {0}] [Crash: {1}] [Timeout: {2}]",e.input.MergeId,e.output.Crash,e.output.Timeout)},e.prototype.GetEndingLogMessage=function(e,t,n){var r=e.output.MergedRevisions,i=r&&r.get_length()?r.getItemAt(r.get_length()-1):null;return this.StringFormat("MergeChanges: End for [MergeId: {0}] with result {1}. [ElapsedTime: {2}ms] [Function: {3}] [MergedRevisions - Length:{4} Last:{5} Base:{6}] [Source: {7}]",e.input.MergeId,n,this.GetCurrentTimeInMs()-e.input.StartingTimeInMs,t,r?r.get_length():0,i?i.get_id():U.h.get_nil(),i&&i.get_baseMergeableRevision()?i.get_baseMergeableRevision().get_id():U.h.get_nil(),e.input.Source)},e.prototype.CreateMergeStateAndPopulateInputState=function(e,t,n,r,i,o,a){var s=this,l=new se,u=l.input;u.TheirChanges=e,u.YourChanges=t,u.ObjectSpaceId=n,u.MergeHint=r,u.IgnoreConflictsInLastServerRevision=i,u.Source=o,u.FeatureHelperFactory=a,u.StartingTimeInMs=this.GetCurrentTimeInMs(),l.logger.setStartTime(u.StartingTimeInMs);var c=l.runtime;c.ShouldTraceVerbose=B.p.get_instance().shouldTrace(1,4),c.ShouldTraceInfo=B.p.get_instance().shouldTrace(1,3);var d="";return c.ThrowIfTimeElapsed=function(e){if(s.get_maxMergeTimeInMs()){var t=s.GetCurrentTimeInMs()-u.StartingTimeInMs,n=t>s.get_maxMergeTimeInMs();if(d+=s.StringFormat(" ({0}: {1})",e,t),n){l.output.Timeout=!0;var r=s.StringFormat("[MergeId: {0}] Exceeded [MaxMergeTimeInMs: {1}] when we reached [Details: {2}] [Elapsed Time: {3}] [Timeline: {4}]",u.MergeId,s.get_maxMergeTimeInMs(),e,t,d);s.ThrowException(r)}}},l},e.prototype.GetMergeFunctions=function(){return[s.i(this,this.OtherAuthorsHaveChangesToMerge,"OtherAuthorsHaveChangesToMerge"),s.i(this,this.IsInputValid,"IsInputValid"),s.i(this,this.InitializeOutputMergeState,"InitializeOutputMergeState"),s.i(this,this.InitializeRuntimeMergeState,"InitializeRuntimeMergeState"),Ie.i.preProcessUpdateHintsContainer,s.i(this.get_childMerge(),this.get_childMerge().mergeChildNodeLists,"mergeChildNodeLists"),s.i(this,this.TryObjectMerge,"TryObjectMerge"),Ie.i.postProcessUpdateHintsContainer,s.i(this,this.AddMergeResultsToOutput,"AddMergeResultsToOutput")]},e.prototype.OtherAuthorsHaveChangesToMerge=function(e){var t=e.input.TheirChanges,n=e.output;return t?!!t.get_length()||(B.p.get_instance().traceTag(4051610,1,4,"OtherAuthorsHaveChangesToMerge: Received an empty list of changes to merge."),n.MergedRevisions=t,n.Succeeded=!0,!1):(B.p.get_instance().traceTag(4051609,1,4,"OtherAuthorsHaveChangesToMerge: Didn't receive any changes to merge."),n.MergedRevisions=t,n.Succeeded=!0,!1)},e.prototype.IsInputValid=function(e){var t=e.input,n=t.TheirChanges,r=t.YourChanges,i=t.ObjectSpaceId,o=t.MergeHint,a=t.IgnoreConflictsInLastServerRevision,s=e.output;if(!r||!r.get_length())return B.p.get_instance().traceTag(42350233,1,4,"IsInputValid: No local changes to merge."),s.MergedRevisions=n,s.Succeeded=!0,!1;var l=!0;if(2!==o&&1!==o)return s.MergedRevisions=n,!1;i&&i!==U.h.get_nil()||(l=!1);var u=a?2:1;return n.get_length()<u&&(B.p.get_instance().traceTag(4051614,1,4,"IsInputValid: Too few revisions. This will happen if the server failed its merge and rejected your change.  [ignoreConflictsInLastServerRevision: {0}]",a),l=!1),l||(s.MergedRevisions=2===o?n:r),l},e.prototype.InitializeRuntimeMergeState=function(e){var t,n,r,i,o,a,s,l,u=e.input,c=u.TheirChanges,d=u.YourChanges,p=u.MergeHint,g=u.IgnoreConflictsInLastServerRevision;return this.GetLastRevisions(e,c,d,g,(0,D.m)((function(){return t}),(function(e){return t=e})),(0,D.m)((function(){return n}),(function(e){return n=e})),(0,D.m)((function(){return r}),(function(e){return r=e}))),r?(e.runtime.CommonBaseLastChange=r,this.DetermineWhichRevisionToFavor(p,t,n,(0,D.m)((function(){return i}),(function(e){return i=e})),(0,D.m)((function(){return o}),(function(e){return o=e}))),this.GetModifiedObjects(e,i,o,r,(0,D.m)((function(){return a}),(function(e){return a=e})),(0,D.m)((function(){return s}),(function(e){return s=e})),(0,D.m)((function(){return l}),(function(e){return l=e}))),e.runtime.BaseObjects=l,e.runtime.UnfavoredObjects=a,e.runtime.FavoredObjects=s,e.runtime.MergedObjects=new x.e(U.h,ye.o),e.runtime.FavoredRevisionId=o.get_id(),e.runtime.UnfavoredRevisionId=i.get_id(),e.runtime.NodeTripletsByClassId=new x.e(V.g,$.r.$$(U.h,Se.x)),e.runtime.ChildMergeSkippableIds=new L.f(U.h),e.runtime.FeatureHelper=e.input.FeatureHelperFactory(e),e.runtime.InitializedRuntimeState=!0,!0):(B.p.get_instance().traceTag(4273301,1,2,"MergeChanges: Couldn't find a common base change. [TheirLastChange.Id: {0}] [YourLastChange.Id: {1}]",t.get_id(),n.get_id()),e.logger.logMergeFailureDetail((0,k.m)(new ce.d,{funcSource:"InitializeRuntimeMergeState",eventId:"aqtsv",info:"Couldn't find a common base change"})),this.LogRevisionChain(t,c.get_length(),"TheirChanges"),this.LogRevisionChain(n,d.get_length(),"YourChanges"),e.output.MergedRevisions=2===p?c:d,!1)},e.prototype.LogRevisionChain=function(e,t,n){for(var r=this,i=new N.o(R.k,null),o=e;o;)i.add(o),o=o.get_baseMergeableRevision();var a=new Sys.StringBuilder;a.append(this.StringFormat("{0} [PartialChainLength: {1}] [FullChainLength: {2}]",n,t,i.get_length()));var s=i.get_length(),l=0;i.forEach((function(e){return r.AddSingleRevisionToLog(50,a,e,i,(0,D.m)((function(){return s}),(function(e){return s=e})),(0,D.m)((function(){return l}),(function(e){return l=e})))})),B.p.get_instance().traceTag(4273302,1,3,a.toString())},e.prototype.AddSingleRevisionToLog=function(e,t,n,r,i,o){return t.append(this.StringFormat(" [{0} {1} {2}]",i.val,n.get_isServerRevision()?"S":"B",n.get_id())),i.val--,o.val++,!(e<o.val&&r.get_length()!==o.val)||(t.append(" ...Truncated."),!1)},e.prototype.GetLastRevisions=function(e,t,n,r,i,o,a){var s=r?1:0;i.val=t.getItemAt(t.get_length()-1-s),o.val=n.getItemAt(n.get_length()-1),a.val=i.val.getCommonDependency(o.val),e.runtime.ThrowIfTimeElapsed("GetCommonBase"),e.logger.logMergeTimestep("GetCommonBase")},e.prototype.GetModifiedObjects=function(e,t,n,r,i,o,a){t.mergeObjectsUntilRevision(r,i),e.runtime.ThrowIfTimeElapsed("GetUnfavoredChanges"),e.logger.logMergeTimestep("GetUnfavoredChanges");var l=new x.e(U.h,E.v);n.mergeObjectsUntilRevision(r,(0,D.m)((function(){return l}),(function(e){return l=e}))),5===e.input.Source&&(e.runtime.FavoredRemovedObjectIds=K.i.getRemovedObjects(n.toRevision()),e.runtime.UnfavoredRemovedObjectIds=K.i.getRemovedObjects(t.toRevision())),o.val=l,e.runtime.ThrowIfTimeElapsed("GetFavoredChanges"),e.logger.logMergeTimestep("GetFavoredChanges"),a.val=new G.s(U.h,E.v,s.i(r,r.getMergeableObject,"getMergeableObject")),e.runtime.ThrowIfTimeElapsed("GetModifiedObjects"),e.logger.logMergeTimestep("GetModifiedObjects")},e.prototype.DetermineWhichRevisionToFavor=function(e,t,n,r,i){2===e?(i.val=t,r.val=n):(i.val=n,r.val=t)},e.prototype.InitializeOutputMergeState=function(e){var t=e.input,n=t.TheirChanges,r=t.YourChanges,i=2===t.MergeHint?n:r;return e.output.MergedRevisions=i.shallowClone(),e.runtime.ThrowIfTimeElapsed("InitializeOutputMergeState"),e.logger.logMergeTimestep("InitializeOutputMergeState"),!0},e.prototype.AddMergeResultsToOutput=function(e){var t=e.input.ObjectSpaceId,n=e.runtime.MergedObjects,r=e.output.MergedRevisions,i=this.CreateMergedRevision(e,r.getItemAt(r.get_length()-1),t,U.h.create());return this.FillRevision(e,i,n),i.endRevisionConstruction(),r.add(i),e.output.Succeeded=!0,!0},e.prototype.CreateMergedRevision=function(e,t,n,r){e.runtime.ShouldTraceInfo&&B.p.get_instance().traceTag(4051616,1,3,"AddMergeRevisionToList: Creating mergeRevision with [objectSpaceId: {0}] [revisionId: {1}].",n,r);var i=this.get_revisionFactory()(r);return i.beginRevisionConstructionWithBaseRevision(t,n),i},e.prototype.FillRevision=function(e,t,n){e.runtime.ShouldTraceInfo&&B.p.get_instance().traceTag(4059167,1,3,"FillRevision: Adding {0} objects to merged revision.",n.get_count()),n.forEach((function(e,n){return t.addRevisedMergeableObject(n.mergeableObject),!0}))},e.prototype.TryObjectMerge=function(e){var t=this,n=e.runtime,r=n.BaseObjects,i=n.UnfavoredObjects,o=n.FavoredObjects,a=n.MergedObjects,s=!0,l=e.runtime.ShouldTraceVerbose,u=0,c=0,d=0;return i.forEach((function(n,i){if(l&&B.p.get_instance().traceTag(4051617,1,4,"Merging Object: [Id: {0}] [ClassId: {1}]",n,i.get_runtimeClassId()),50===++c&&(u++,e.runtime.ThrowIfTimeElapsed(t.StringFormat("ObjectMerge [Cycles: {0}] [ComplexMerges: {1}]",u,d)),c=0),t.SkipMergeForNodeClass(i.get_runtimeClassId()))return!0;var p=o.get(n);if(!p)return a.containsKey(n)?a.get_item(n).mergeWith(i):a.set_item(n,new ye.o(i,!1)),!0;if(!r.get_item(n)&&!t.MergeWithoutBaseObject(p.get_runtimeClassId())){var g=!!e.input.TheirChanges&&!!e.input.TheirChanges.last()&&e.input.TheirChanges.last().isObjectReferenced(n),h=!!e.input.YourChanges&&!!e.input.YourChanges.last()&&e.input.YourChanges.last().isObjectReferenced(n),_=new me.p(p,i);return B.p.get_instance().traceTag(4051618,1,2,"Merging Object: [Id: {0}] [ClassId: {1}]. Object wasn't in base revision, but was in conflict and favored. [ReferencedInFavored: {2}] [ReferencedInUnfavored: {3}] [Identical: {4}] [Source: {5}].",n,i.get_runtimeClassId(),g,h,!_.get_isDifferent(),e.input.Source),e.logger.logMergeFailureDetail((0,k.m)(new ce.d,{funcSource:"GraphMerger.TryObjectMerge",eventId:"ap3k8"})),5!==e.input.Source||_.get_isDifferent()?(s=!1,!1):(a.set_item(n,new ye.o(p,!1)),!0)}var f,m=a.getOrElse(n,new ye.o(r.get_item(n),!0));return s=t.get_graphNodeMerge().merge(e,t.get_graphNodeComplexMergeFactory(),t.get_mergeableObjectUtilities(),m,p,i,(0,D.m)((function(){return f}),(function(e){return f=e}))),d++,s&&(e.runtime.ThrowIfTimeElapsed(t.StringFormat("ObjectMerge [Id: {0}] [ClassId: {1}] [ComplexMerges: {2}] [Cycles: {3}]",n,i.get_runtimeClassId(),d,u)),f&&(a.containsKey(f.mergeableObject.get_id())?a.get_item(f.mergeableObject.get_id()).mergeWith(f.mergeableObject):a.set_item(f.mergeableObject.get_id(),f))),s})),e.logger.logMergeTimestep("ObjectMerge"),s&&5===e.input.Source&&e.runtime.UnfavoredRemovedObjectIds.get_length()&&o.forEach((function(t,n){if(393230===n.get_runtimeClassId()&&e.runtime.UnfavoredRemovedObjectIds.contains(t,(function(e,t){return e.equals(t)}))){if(r.get_item(t)){var i=new j.s,o=new Ce.u(O.b.richEditTextUnicode,i.getPropertyString(r.get_item(t),O.b.richEditTextUnicode),i.getPropertyString(n,O.b.richEditTextUnicode));s=!o.get_isDifferent()}else s=!1;if(!s)return B.p.get_instance().traceTag(16869081,1,2,"Failed to Merge Object {0} which was changed in the favored and removed in the unfavored.",t),e.logger.logMergeFailureDetail((0,k.m)(new ce.d,{funcSource:"GraphMerger.TryObjectMerge",eventId:"baw1z"})),!1}return!0})),l&&B.p.get_instance().traceTag(4059168,1,4,"TryObjectMerge: Merged {0} objects. {1} were complex merges.",i.get_count(),d),s},e.prototype.SkipMergeForNodeClass=function(e){switch(e){case 1074135137:case 1074135138:case 1074135139:case 1074135140:case 131162:case 4325465:return!0}return!1},e.prototype.MergeWithoutBaseObject=function(e){switch(e){case 1074135162:return!0}return!1},e.prototype.CreateSerializedRevisionLists=function(e,t,n,r,i,o){var a=new N.o(e,null),s=new N.o(e,null),l=new N.o(e,null),u=t.runtime.CommonBaseLastChange,c=u?u.get_id():U.h.get_nil();this.ListRevisionsUntil(u,null).forEach((function(e){return a.add(n(e)),!0}));var d=t.input.TheirChanges.getItemAt(t.input.TheirChanges.get_length()-1);this.ListRevisionsUntil(d,c).forEach((function(e){return s.add(n(e)),!0}));var p=t.input.YourChanges.getItemAt(t.input.YourChanges.get_length()-1);this.ListRevisionsUntil(p,c).forEach((function(e){return l.add(n(e)),!0})),r.val=a,i.val=s,o.val=l},e.prototype.ListRevisionsUntil=function(e,t){var n=new N.o(R.k,null);for(t||(t=U.h.get_nil());e&&!t.equals(e.get_id());)n.add(e),e=e.get_baseMergeableRevision();return n.reverse(),n},e.prototype.SupportsMergeReplaysForResult=function(e){var t=3===this.graphMergeBackupCases,n=!1;e.output.Succeeded||(2===this.graphMergeBackupCases||e.output.Crash&&1===this.graphMergeBackupCases)&&(n=!0);var r=!1;return!!e.input.TheirChanges&&e.input.TheirChanges.get_length()>0&&(t||n)&&e.runtime.FavoredObjects&&e.runtime.BaseObjects&&e.runtime.FeatureHelper&&(r=e.runtime.FeatureHelper.isFeatureEnabled(59)),r},e.GetGraphMergeReplayReason=function(e){return e.output.Crash?2:e.output.Succeeded?3:1},e.GraphFeaturesNodeObjectId=U.h.createFromString("{0B310978-27EA-4A49-A620-7E588CFE64C6}{1}"),e}();(0,s.l)(Te,"375289d6$GraphMerger",null,[w.j]);var be=n(4072),Ae=function(e){function t(t){var n=e.call(this)||this;return n.mergeResponse=null,n.mergeResponse=t,n}return(0,S.t)(t,e),t.prototype.get_mergeResponse=function(){return this.mergeResponse},t}(Sys.EventArgs);(0,s.l)(Ae,"8d7eb386$GraphMergeCompleteEventArgs",Sys.EventArgs,[]);var Me=function(e){function t(t,n,r){var i=this;return i._eventSource=new be.f,i=e.call(this,t,null,null,null,null,null,null,null,-1,n,r,null)||this}return(0,S.t)(t,e),t.prototype.get_promptStatus=function(){return this._collectionConsentManager?this._collectionConsentManager.get_promptStatus():0},t.prototype.get_delayedMergeOperation=function(){return null},t.prototype.set_delayedMergeOperation=function(e){return e},t.prototype.add_onGraphMergeComplete=function(e){this._eventSource.addHandler(t.graphMergeCompleteEventKey,e)},t.prototype.remove_onGraphMergeComplete=function(e){this._eventSource.removeHandler(t.graphMergeCompleteEventKey,e)},t.prototype.shouldMergeBeResolvedOnServer=function(e,t,n,r,i,o){return!1},t.prototype.mergeChanges=function(n,r,i,o,a,s,l){var u=e.prototype.mergeChanges.call(this,n,r,i,o,a,s,l);return u&&this._eventSource.raiseEvent(t.graphMergeCompleteEventKey,new Ae(u),null),u},t.graphMergeCompleteEventKey="GMC",t}(Te);(0,s.l)(Me,"23b80c19$WordEditorGraphMerger",Te,[u,F.o,w.j]);var Pe=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"WordEditor.GraphMerge"},e.prototype.configure=function(e){var t=this;this._container=e,this._container.register(P).as(i.i).singleInstance().usingFactory((function(){return new P(t._container.resolveFuture(o.d),new g.q(a.d,(function(){return e.tryResolve(a.d)})),null)})),this._container.register(M).as(l).singleInstance().usingFactory((function(){return new M(t._container.resolve(i.i),null,null,null)})),this._container.register(Me).as(u).singleInstance().usingFactory((function(){return new Me((function(){return h.AFrameworkApplication.get_rootQuerySignature()}),t._container.resolve(l),t._container.resolve(i.i))})),this._container.register(A).as(c.t).singleInstance().usingFactory((function(){return new A((function(){return h.AFrameworkApplication.get_rootQuerySignature()}),h.AFrameworkApplication.get_theActionManager(),t._container.resolve(u),t._container.resolve(l),t._container.resolve(i.i),null,null)}))},e.prototype.init=function(){_.App.theGraphMerger||(_.App.theGraphMerger=f.q.createAnInstanceWithResolvedDependencies());var e=this._container.resolve(u);_.App.theGraphMerger.bindToImpl(e),this._container.resolve(c.t)},e.prototype.dispose=function(){var e=this._container.tryResolve(c.t);e&&(e.dispose(),e=null)},e}();(0,s.l)(Pe,"9bb34ede$GraphMergePackage",null,[d.u,p.s]),n.d(t,{Program:function(){return Fe}});var Fe=function(){function e(){}return e.Main=function(){r.o.get_instance().registerPackage(new Pe,0,!1)},e}();(0,s.l)(Fe,"da9ac2a4$Program",null,[])},6684:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("69d0501a$ISaveToCloudManager"),o=n(7597);n.d(t,{a:function(){return a}});var a=function(){function e(e,t,n,r,i,o){this._signInFactory=null,this._errorDialogFactory=null,this._signOutResponse=null,this._uploadToCloudManager=null,this._appSettingsManager=null,this._appEnvironment=0,this._options=null,this._signInFactory=e,this._signOutResponse=t,this._uploadToCloudManager=n,this._appSettingsManager=r,this._appEnvironment=i,this._errorDialogFactory=o}return e.prototype.start=function(e){this._options=e,this._signOutResponse.get_isAuthenticated()?(o.ULS.sendTraceTag(6590559,216,50,"User is signed in. We will show file picker."),this.callFilePicker()):(o.ULS.sendTraceTag(6590560,216,50,"User is not signed in. We will show sign in dialog."),this.showSignInDialog())},e.prototype.showSignInDialog=function(){this._signInFactory.create().displayDialog()},e.prototype.showErrorDialog=function(){this._errorDialogFactory().displayError(0)},e.prototype.callFilePicker=function(){try{o.ULS.sendTraceTag(6590561,216,50,"Initializing OneDrive API");var e={client_id:this._appSettingsManager.get_appSettings().UploadToSkyDriveClientId,env:"INT"};1!==this._appEnvironment&&2!==this._appEnvironment||(e={client_id:this._appSettingsManager.get_appSettings().UploadToSkyDriveClientId});WL.init(e),o.ULS.sendTraceTag(6590562,216,50,"OneDrive API is initialized. Launching file dialogue"),WL.fileDialog({mode:"save",lightbox:"grey"}).then(r.i(this,this.onSuccess,"onSuccess"),r.i(this,this.onFailure,"onFailure"))}catch(e){o.ULS.sendTraceTag(6590563,216,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",e,e.stack),this.showErrorDialog()}},e.prototype.onSuccess=function(e){o.ULS.sendTraceTag(6590592,216,50,"Success Callback called. Calling UploadToCloudManger to start upload."),e&&e.data&&e.data.folders&&this._uploadToCloudManager.startUpload(e.data.folders[0].id,e.data.folders[0].urls.viewInBrowser,null,this._options)},e.prototype.onFailure=function(e){if(e&&e.error){if("user_canceled"===e.error.code)return void o.ULS.sendTraceTag(6590593,216,50,"User cancelled upload to their OneDrive.");o.ULS.sendTraceTag(6590594,216,50,"File Dialog returned with error code:{0}, and error message: {1}",e.error.code,e.error.message)}else o.ULS.sendTraceTag(6590595,216,50,"File Dialog returned with no response");this.showErrorDialog()},e}();(0,r.l)(a,"2adc9933$SaveToCloudManager",null,[i])},6716:function(e,t,n){"use strict";n.d(t,{w:function(){return r}});var r=(0,n(423).y)("2f018694$IRtcBasicProvider")},6812:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var r=n(3545),i=n(7114),o=n(423),a=function(e){function t(){var t=e.call(this)||this;return t.eventId=null,t.funcSource=null,t.info=null,t}return(0,r.t)(t,e),t.prototype.get_failureType=function(){return"Misc"},t.prototype.getFailureDetail=function(){return this.detail.set_item("Type",this.get_failureType()),this.detail.set_item("EventId",this.eventId),this.detail.set_item("Func",this.funcSource),this.detail.set_item("Info",this.info),this.detail},t}(i.w);(0,o.l)(a,"dd3a7b57$BasicMergeFailureDetail",i.w,[])},6849:function(e,t,n){"use strict";n.d(t,{y:function(){return a}});var r=n(3545),i=n(6812),o=n(423),a=function(e){function t(){return e.call(this)||this}return(0,r.t)(t,e),t.prototype.get_failureType=function(){return"Conflict"},t}(i.d);(0,o.l)(a,"df68e5b$ConflictMergeFailureDetail",i.d,[])},6902:function(e,t,n){"use strict";n.d(t,{p:function(){return l}});var r=n(423),i=n(3362),o=n(3795),a=n(7518),s=n(294),l=function(){function e(e,t){var n=this;this._isDifferent=null,this._propertyDiffs=null,this.oldObject=null,this.newObject=null,this.oldObject=e,this.newObject=t,this._isDifferent=new i.q(Boolean,(function(){return n.isDifferentWithExceptions(null)})),this._propertyDiffs=new i.q(o.e.$$(Number,s.u),r.i(this,this.EvaluatePropertyDiffs,"EvaluatePropertyDiffs"))}return e.prototype.get_oldObject=function(){return this.oldObject},e.prototype.get_newObject=function(){return this.newObject},e.prototype.get_isAdded=function(){return!!this.get_newObject()&&!this.get_oldObject()},e.prototype.get_isDeleted=function(){return!this.get_newObject()&&!!this.get_oldObject()},e.prototype.get_isDifferent=function(){return this.get_isAdded()||this.get_isDeleted()||this._isDifferent.get_value()},e.prototype.get_propertyDiffs=function(){return this._propertyDiffs.get_value()},e.prototype.isDifferentWithExceptions=function(e){var t=!1;return this.get_propertyDiffs().forEach((function(n,r){return!(t=r.get_isDifferent()&&(!e||7!==e.get_item(n)))})),t},e.prototype.EvaluatePropertyDiffs=function(){var e=new o.e(Number,s.u),t=this.get_newObject(),n=this.get_oldObject();if(this.get_isAdded())for(var r=t.listProperties(),i=0;i<r.length;i++){var l=r[i],u=a.d.toPropertyId(l);e.set_item(u,new s.u(l,null,t.getMergeableProperty(l)))}else if(this.get_isDeleted()){var c=n.listProperties();for(i=0;i<c.length;i++){l=c[i],u=a.d.toPropertyId(l);e.set_item(u,new s.u(l,n.getMergeableProperty(l),null))}}else{for(c=n.listProperties(),i=0;i<c.length;i++){l=c[i],u=a.d.toPropertyId(l);var d=n.getMergeableProperty(l),p=t.hasProperty(l)?t.getMergeableProperty(l):null;e.set_item(u,new s.u(l,d,p))}for(r=t.listProperties(),i=0;i<r.length;i++){l=r[i];if(!n.hasProperty(l)){u=a.d.toPropertyId(l);var g=t.getMergeableProperty(l);e.set_item(u,new s.u(l,null,g))}}}return e},e}();(0,r.l)(l,"998b7cee$MergeableObjectDiff",null,[])},6973:function(e,t,n){"use strict";n.r(t);var r=n(3545),i=n(5902),o=n(4455),a=n(2506),s=n(1308),l=n(5479),u=n(8540),c=n(4192),d=n(1388),p=n(3320),g=n(8466),h=n(423),_=function(){function e(e,t,n){this.author=null,this.millisecondsSinceEpoch=0,this.previousRunFormattingId=null,this.author=e,this.millisecondsSinceEpoch=t,this.previousRunFormattingId=n||s.h.get_nil()}return e.prototype.isEquivalentTo=function(e){return!!e&&(this.author===e.author&&this.millisecondsSinceEpoch===e.millisecondsSinceEpoch&&this.previousRunFormattingId===e.previousRunFormattingId)},e}();(0,h.l)(_,"9e131c8$RunMergeBlockTrackedChangeAttribute",null,[]);var f=function(){function e(t,n,r){this.insertion=null,this.deletion=null,this.previousFormatting=null,this.insertion=t||e.EmptyAttribute,this.deletion=n||e.EmptyAttribute,this.previousFormatting=r||e.EmptyAttribute}return e.prototype.get_hasInsertion=function(){return this.insertion.author.length>0},e.prototype.get_hasDeletion=function(){return this.deletion.author.length>0},e.prototype.get_hasPreviousFormatting=function(){return this.previousFormatting.author.length>0},e.prototype.isEquivalentTo=function(e){return!!e&&(this.insertion.isEquivalentTo(e.insertion)&&this.deletion.isEquivalentTo(e.deletion)&&this.previousFormatting.isEquivalentTo(e.previousFormatting))},e.EmptyAttribute=new _("",0,null),e}();(0,h.l)(f,"8f35851a$RunMergeBlockTrackedChangeInfo",null,[]);var m=n(1098);n.d(t,{ParagraphMergeBlockCreator:function(){return y}});var y=function(e){function t(t,n,r,i,d,p,h){var _,f=e.call(this)||this;if(f._allObjects=null,f._paraObject=null,f._mergeableObjectUtilities=null,f._wordId=0,f._paragraphText=null,f._runIds=null,f._paraIds=null,f._runIndices=null,f._formattingIds=null,f._newlyTypedRuns=null,f._pendingProofingRuns=null,f._spellErrorRuns=null,f._grammarErrorRuns=null,f._proofingErrorHints=null,f._changeIds=null,f._runIdx=0,f._isFinished=!1,f._isValidObject=!1,f._source=0,f._mergeBlockList="",f._skipMergeBlockCreationForEmptyPara=!1,f._forceProofing=!1,f._isCatchUpActivityEnabled=!1,f.MaxValue=Number.MAX_VALUE,f._mergeableTrackedChangesProperties=new g.x,f._allObjects=t,f._paraObject=n,f._source=r,f._skipMergeBlockCreationForEmptyPara=i,f._forceProofing=d,f._isCatchUpActivityEnabled=p,f._mergeableObjectUtilities=h||new c.s,!f._mergeableObjectUtilities.hasProperty(f._paraObject,o.b.richEditTextUnicode))return u.p.get_instance().traceTag(3993794,1,1,"MergeBlockIterator: RichEditTextUnicode is null on [Object: {0}]",n.get_id()),f;if(!f._mergeableObjectUtilities.hasProperty(f._paraObject,a.j.wordId))return u.p.get_instance().traceTag(3993795,1,1,"MergeBlockIterator: RichEditTextUnicode is null on [Object: {0}]",n.get_id()),f;if(!f._mergeableObjectUtilities.hasProperty(f._paraObject,a.j.runIds))return u.p.get_instance().traceTag(3993796,1,1,"MergeBlockIterator: RunIds is null on [Object: {0}]",n.get_id()),f;if(!f._mergeableObjectUtilities.hasProperty(f._paraObject,a.j.paraIds))return u.p.get_instance().traceTag(3993797,1,1,"MergeBlockIterator: ParaIds is null on [Object: {0}]",n.get_id()),f;if(!f._mergeableObjectUtilities.hasProperty(f._paraObject,o.b.textRunFormatting))return u.p.get_instance().traceTag(3993798,1,1,"MergeBlockIterator: FormattingIds is null on [Object: {0}]",n.get_id()),f;if(f._paragraphText=f._mergeableObjectUtilities.getPropertyString(f._paraObject,o.b.richEditTextUnicode),f._wordId=f._mergeableObjectUtilities.getPropertyUint32(f._paraObject,a.j.wordId),f._runIds=f._mergeableObjectUtilities.getPropertyUint32s(f._paraObject,a.j.runIds),f._paraIds=f._mergeableObjectUtilities.getPropertyUint32s(f._paraObject,a.j.paraIds),f._formattingIds=f._mergeableObjectUtilities.getPropertyObjectIds(f._paraObject,o.b.textRunFormatting),!f._paragraphText&&""!==f._paragraphText)return u.p.get_instance().traceTag(4322133,1,1,"MergeBlockIterator: RichEditTextUnicode is null on [Object: {0}]",n.get_id()),f;if(f._paragraphText.length||1!==f._formattingIds.get_length()||(f._runIds.get_length()||(f._runIds.add(0),u.p.get_instance().traceTag(4322134,1,2,"MergeBlockIterator: Paragraph contains one formattingID, but no runIDs, fixing it")),f._paraIds.get_length()||(f._paraIds.add(0),u.p.get_instance().traceTag(4322135,1,2,"MergeBlockIterator: Paragraph contains one formattingID, but no paraIDs, fixing it"))),f._newlyTypedRuns=f.GetBoolArrayPropertyOrDefault(f._paraObject,a.j.newlyTypedRuns,f._runIds.get_length(),!1),f._pendingProofingRuns=f.GetBoolArrayPropertyOrDefault(f._paraObject,o.b.notProofedRuns,f._runIds.get_length(),!1),f._spellErrorRuns=f.GetBoolArrayPropertyOrDefault(f._paraObject,o.b.spellErrorRuns,f._runIds.get_length(),!1),f._grammarErrorRuns=f.GetBoolArrayPropertyOrDefault(f._paraObject,a.j.grammarErrorRuns,f._runIds.get_length(),!1),f._proofingErrorHints=f.GetUintArrayPropertyOrDefault(f._paraObject,a.j.proofingErrorHints,f._runIds.get_length(),0),f.InitTrackedChangesProperties(),_=f._mergeableObjectUtilities.hasProperty(f._paraObject,o.b.textRunIndex)?f._mergeableObjectUtilities.getPropertyUint32s(f._paraObject,o.b.textRunIndex):new l.o(Number,null),f.SetRunIndicesBounds(_),f._runIds.get_length()!==f._paraIds.get_length())return u.p.get_instance().traceTag(3993799,1,1,"MergeBlockIterator: Length of RunIds and ParaIds does not match on [Object: {0}]",n.get_id()),f;if(f._runIds.get_length()!==f._formattingIds.get_length())return u.p.get_instance().traceTag(3993800,1,1,"MergeBlockIterator: Length of FormattingIds and ParaIds does not match on [Object: {0}]",n.get_id()),f;if(f._runIds.get_length()!==f._newlyTypedRuns.get_length())return u.p.get_instance().traceTag(4208071,1,1,"MergeBlockIterator: Length of NewlyTypedRuns and ParaIds does not match on [Object: {0}]",n.get_id()),f;if(f._isCatchUpActivityEnabled&&(f._mergeableObjectUtilities.hasProperty(f._paraObject,a.j.changeIds)?f._changeIds=f._mergeableObjectUtilities.getPropertyObjectIds(f._paraObject,a.j.changeIds):(u.p.get_instance().traceTag(40939931,1,2,"MergeBlockIterator: ChangeIds are null on [Object: {0}]",n.get_id()),f._changeIds=f.CreateArray(s.h,f._runIds.get_length(),s.h.get_nil())),f._runIds.get_length()!==f._changeIds.get_length()&&(u.p.get_instance().traceTag(40939932,1,2,"MergeBlockIterator: Length of RunIds and ChangeIds don't match on [Object: {0}]. RunIds Length: {1} ChangeIds Length: {2}",n.get_id(),f._runIds.get_length(),f._changeIds.get_length()),f._changeIds=f.CreateArray(s.h,f._runIds.get_length(),s.h.get_nil()))),f._runIds.get_length()!==f._pendingProofingRuns.get_length()||f._runIds.get_length()!==f._spellErrorRuns.get_length()||f._runIds.get_length()!==f._grammarErrorRuns.get_length()||f._runIds.get_length()!==f._proofingErrorHints.get_length()){f._runIds.get_length()===f._pendingProofingRuns.get_length()||f._forceProofing||u.p.get_instance().traceTag(8266445,1,1,"MergeBlockIterator: Length of NotProofedRuns and ParaIds does not match on [Object: {0}] [RunIds Length: {1}] [NotProofedRuns Length: {2}]",n.get_id(),f._runIds.get_length(),f._pendingProofingRuns.get_length()),f._runIds.get_length()===f._spellErrorRuns.get_length()||f._forceProofing||u.p.get_instance().traceTag(8266446,1,1,"MergeBlockIterator: Length of SpellErrorRuns and ParaIds does not match on [Object: {0}] [RunIds Length: {1}] [SpellErrorRuns Length: {2}]",n.get_id(),f._runIds.get_length(),f._spellErrorRuns.get_length()),f._runIds.get_length()===f._grammarErrorRuns.get_length()||f._forceProofing||u.p.get_instance().traceTag(20742792,1,1,"MergeBlockIterator: Length of GrammarErrorRuns and ParaIds does not match on [Object: {0}] [RunIds Length: {1}] [GrammarErrorRuns Length: {2}]",n.get_id(),f._runIds.get_length(),f._grammarErrorRuns.get_length()),f._runIds.get_length()===f._proofingErrorHints.get_length()||f._forceProofing||u.p.get_instance().traceTag(25274202,1,1,"MergeBlockIterator: Length of ProofingErrorHints and ParaIds does not match on [Object: {0}] [RunIds Length: {1}] [ProofingErrorHints Length: {2}]",n.get_id(),f._runIds.get_length(),f._proofingErrorHints.get_length());var m=f._mergeableObjectUtilities.getPropertyBool(f._paraObject,o.b.containsIgnoredSpellingError);u.p.get_instance().traceTag(17877020,1,3,"MergeBlockIterator: Reproofing Para {0}. [ForceProofing: {1}] [ContainsIgnoredSpellingErrors: {2}]",n.get_id(),d,null!=m&&m),f._pendingProofingRuns=f.CreateArray(Boolean,f._runIds.get_length(),!0),f._spellErrorRuns=f.CreateArray(Boolean,f._runIds.get_length(),!1),f._grammarErrorRuns=f.CreateArray(Boolean,f._runIds.get_length(),!1),f._proofingErrorHints=f.CreateArray(Number,f._runIds.get_length(),0),f._mergeableObjectUtilities.setPropertyBool(f._paraObject,o.b.containsIgnoredSpellingError,!1)}return f._mergeableTrackedChangesProperties.validatePropertySizesMatch(f._runIds.get_length())?(f._runIndices.get_length()!==f._runIds.get_length()+1&&u.p.get_instance().traceTag(3993801,1,1,"MergeBlockIterator: Length of RunIdexes is different than expected for [Object: {0}] [RunIds Length: {1}] [RunIndices Length: {2}]",n.get_id(),f._runIds.get_length(),f._runIndices.get_length()),f._isValidObject=!0,f):(u.p.get_instance().traceTag(23205786,1,1,"MergeBlockIterator: Length of RunIds and tracked changes properties does not match on [Object: {0}]",n.get_id()),f)}return(0,r.t)(t,e),t.prototype.InitTrackedChangesProperties=function(){this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.insertedTrackedChangesRuns)?this._mergeableTrackedChangesProperties.insertedRuns=this._mergeableObjectUtilities.getPropertyBools(this._paraObject,a.j.insertedTrackedChangesRuns):this._mergeableTrackedChangesProperties.insertedRuns=this.CreateArray(Boolean,this._runIds.get_length(),!1),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.deletedTrackedChangesRuns)?this._mergeableTrackedChangesProperties.deletedRuns=this._mergeableObjectUtilities.getPropertyBools(this._paraObject,a.j.deletedTrackedChangesRuns):this._mergeableTrackedChangesProperties.deletedRuns=this.CreateArray(Boolean,this._runIds.get_length(),!1),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.insertedTrackedChangesRunsAuthors)?this._mergeableTrackedChangesProperties.insertedAuthors=this._mergeableObjectUtilities.getPropertyStrings(this._paraObject,a.j.insertedTrackedChangesRunsAuthors):this._mergeableTrackedChangesProperties.insertedAuthors=this.CreateArray(String,this._runIds.get_length(),""),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.deletedTrackedChangesRunsAuthors)?this._mergeableTrackedChangesProperties.deletedAuthors=this._mergeableObjectUtilities.getPropertyStrings(this._paraObject,a.j.deletedTrackedChangesRunsAuthors):this._mergeableTrackedChangesProperties.deletedAuthors=this.CreateArray(String,this._runIds.get_length(),""),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.insertedTrackedChangesRunsTimestamps)?this._mergeableTrackedChangesProperties.insertedTimestampsInEpoch=this._mergeableObjectUtilities.getPropertyListOfMilliseconds(this._paraObject,a.j.insertedTrackedChangesRunsTimestamps):this._mergeableTrackedChangesProperties.insertedTimestampsInEpoch=this.CreateArray(Number,this._runIds.get_length(),0),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.deletedTrackedChangesRunsTimestamps)?this._mergeableTrackedChangesProperties.deletedTimestampsInEpoch=this._mergeableObjectUtilities.getPropertyListOfMilliseconds(this._paraObject,a.j.deletedTrackedChangesRunsTimestamps):this._mergeableTrackedChangesProperties.deletedTimestampsInEpoch=this.CreateArray(Number,this._runIds.get_length(),0),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.previousRunFormattingIsTracked)?this._mergeableTrackedChangesProperties.previousRunFormattings=this._mergeableObjectUtilities.getPropertyBools(this._paraObject,a.j.previousRunFormattingIsTracked):this._mergeableTrackedChangesProperties.previousRunFormattings=this.CreateArray(Boolean,this._runIds.get_length(),!1),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.trackedPreviousRunFormattingAuthors)?this._mergeableTrackedChangesProperties.previousRunFormattingAuthors=this._mergeableObjectUtilities.getPropertyStrings(this._paraObject,a.j.trackedPreviousRunFormattingAuthors):this._mergeableTrackedChangesProperties.previousRunFormattingAuthors=this.CreateArray(String,this._runIds.get_length(),""),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.trackedPreviousRunFormattingTimestamps)?this._mergeableTrackedChangesProperties.previousRunFormattingTimestampsInEpoch=this._mergeableObjectUtilities.getPropertyListOfMilliseconds(this._paraObject,a.j.trackedPreviousRunFormattingTimestamps):this._mergeableTrackedChangesProperties.previousRunFormattingTimestampsInEpoch=this.CreateArray(Number,this._runIds.get_length(),0),this._mergeableObjectUtilities.hasProperty(this._paraObject,a.j.trackedPreviousRunFormatting)?this._mergeableTrackedChangesProperties.previousRunFormattingIds=this._mergeableObjectUtilities.getPropertyObjectIds(this._paraObject,a.j.trackedPreviousRunFormatting):this._mergeableTrackedChangesProperties.previousRunFormattingIds=this.CreateArray(s.h,this._runIds.get_length(),s.h.get_nil())},t.prototype.GetBoolArrayPropertyOrDefault=function(e,t,n,r){return this._mergeableObjectUtilities.hasProperty(e,t)?this._mergeableObjectUtilities.getPropertyBools(e,t):this.CreateArray(Boolean,n,r)},t.prototype.GetUintArrayPropertyOrDefault=function(e,t,n,r){return this._mergeableObjectUtilities.hasProperty(e,t)?this._mergeableObjectUtilities.getPropertyUint32s(e,t):this.CreateArray(Number,n,r)},t.prototype.CreateArray=function(e,t,n){for(var r=new l.o(e,null),i=0;i<t;i++)r.add(n);return r},t.prototype.SetRunIndicesBounds=function(e){this._runIndices=new l.o(Number,null),this._runIndices.add(0);for(var t=0;t<e.get_length();t++)this._runIndices.insert(t+1,e.getItemAt(t));this._runIndices.insert(this._runIndices.get_length(),this._paragraphText.length)},t.prototype.GetTextFromIndex=function(e){var t=this._runIndices.getItemAt(e),n=this._runIndices.getItemAt(e+1);return this._paragraphText.substring(t,n)},t.prototype.GetNextBlock=function(){if(this._isFinished)return null;var e=this._runIdx<this._runIds.get_length()?this._runIds.getItemAt(this._runIdx):this.MaxValue;if(e===this.MaxValue||this._skipMergeBlockCreationForEmptyPara&&!this._paragraphText.length){this._isFinished=!0;var n=new p.u(this._source,this._paraObject.get_id(),this._wordId);return this._mergeBlockList=this.appendMergeBlock(this._mergeBlockList,n.toString()),n}var r=this._paraIds.getItemAt(this._runIdx),i=this._formattingIds.getItemAt(this._runIdx),o=this._newlyTypedRuns.getItemAt(this._runIdx),a=this._pendingProofingRuns.getItemAt(this._runIdx),s=this._spellErrorRuns.getItemAt(this._runIdx),l=this._grammarErrorRuns.getItemAt(this._runIdx),u=this._proofingErrorHints.getItemAt(this._runIdx),c=this._isCatchUpActivityEnabled?this._changeIds.getItemAt(this._runIdx):null,d=null;this._mergeableTrackedChangesProperties.insertedRuns.getItemAt(this._runIdx)&&(d=new _(this._mergeableTrackedChangesProperties.insertedAuthors.getItemAt(this._runIdx)||"",this._mergeableTrackedChangesProperties.insertedTimestampsInEpoch.getItemAt(this._runIdx),null));var g=null;this._mergeableTrackedChangesProperties.deletedRuns.getItemAt(this._runIdx)&&(g=new _(this._mergeableTrackedChangesProperties.deletedAuthors.getItemAt(this._runIdx)||"",this._mergeableTrackedChangesProperties.deletedTimestampsInEpoch.getItemAt(this._runIdx),null));var h=null;this._mergeableTrackedChangesProperties.previousRunFormattings.getItemAt(this._runIdx)&&(h=new _(this._mergeableTrackedChangesProperties.previousRunFormattingAuthors.getItemAt(this._runIdx)||"",this._mergeableTrackedChangesProperties.previousRunFormattingTimestampsInEpoch.getItemAt(this._runIdx),this._mergeableTrackedChangesProperties.previousRunFormattingIds.getItemAt(this._runIdx)));var y=new f(d,g,h),v=this.GetTextFromIndex(this._runIdx);this._runIdx++;var S=v.startsWith(t.HyperlinkMark),I=new m.q(this._allObjects,this._source,this._paraObject.get_id(),r,e,i,v,o,!S,a,s,l,u,y,c);return this._mergeBlockList=this.appendMergeBlock(this._mergeBlockList,I.toString()),I},t.prototype.GetMergeBlockList=function(e,t){if(e.val=null,t.val="",this._isValidObject){var n=this.GetNextBlock();for(n&&(e.val=new l.o(d.AMergeBlock,null),e.val.add(n));n=this.GetNextBlock();)e.val.add(n);t.val=this._mergeBlockList}},t.HyperlinkMark="\ufddfHYPERLINK ",t}(i.b);(0,h.l)(y,"72a8fc07$ParagraphMergeBlockCreator",i.b,[])},6978:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("b5efcd5b$ISaveToCloudStorageActor"),o=n(127),a=n(7597),s=n(9910),l=n(1991),u=n(3608),c=n(2192);n.d(t,{j:function(){return d}});var d=function(){function e(e,t,n,r){this._saveToCloudManager=null,this._oneDriveFilePickerApiManager=null,this._appSettingsManager=null,this._stopwatchBuilder=null,this._responseTimeToSaveToOneDriveAction=null,this._loadApiTaskCompletionSource=null,this._saveToCloudManager=e,this._appSettingsManager=n,this._oneDriveFilePickerApiManager=t,this._loadApiTaskCompletionSource=new o.z(Boolean),this._stopwatchBuilder=r}return e.prototype.isUIEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")},e.prototype.getActionId=function(){return s.b.saveToCloudStorage},e.prototype.callDownloadQueueActionsForOneDriveApi=function(){u.z.registerDispatchHandler(r.i(this,this.saveToCloudActionDispatcher,"saveToCloudActionDispatcher")),u.z.enqueueActions([new l.f(s.b.saveToCloudStorage,c.m.frame,0)],this._oneDriveFilePickerApiManager.getOneDriveApi())},e.prototype.registerActions=function(){var e=this,t=this._oneDriveFilePickerApiManager.getOneDriveApi();t?(t.add_loadFinished((function(t,n){e._loadApiTaskCompletionSource.setResult(!0)})),this.callDownloadQueueActionsForOneDriveApi()):a.ULS.sendTraceTag(6590596,216,15,"Failure with OneDrive API download as the onedrive url received is empty ")},e.prototype.recordExecuteTrace=function(){a.ULS.sendTraceTag(6590597,216,50,"User clicked on SaveToOneDrive button")},e.prototype.saveToCloudActionDispatcher=function(t,n,r,i,o){var s=this;if(n.get_contextId()!==c.m.frame||t!==this.getActionId())return 2;if(!this.isUIEnabled())return 8;if(1===r)return 32;if(2===r){this.recordExecuteTrace();var l=o;return l&&l.FileDownloadUrl&&a.ULS.sendTraceTag(50708835,216,50,"SaveToCloudStorageActor FileDownloadUrl is there"),this._stopwatchBuilder&&(this._responseTimeToSaveToOneDriveAction=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown",e.SaveToOneDriveReponseTime)),this._loadApiTaskCompletionSource.get_task().CW((function(e){s._responseTimeToSaveToOneDriveAction&&(s._responseTimeToSaveToOneDriveAction.stop(),s._responseTimeToSaveToOneDriveAction=null),s._saveToCloudManager.start(l)})),32}return 8},e.SaveToOneDriveReponseTime="SaveToOneDriveReponseTime",e}();(0,r.l)(d,"8100c152$SaveToCloudStorageActor",null,[i])},7065:function(e,t,n){"use strict";n.r(t),n.d(t,{PresenceUser:function(){return a}});var r=n(7772),i=n(877),o=n(423),a=function(){function e(e,t,n,r,o,a,s,l,u,c,d,p,g){this.$$pf_IsAnonymous=!1,this.$$pf_Email=null,this.$$pf_ClientId=null,this.$$pf_UserName=null,this.$$pf_Color=null,this.$$pf_Capabilities=null,this.$$pf_ChatThreadId=null,this.$$pf_ChatThreadDiscoveryUri=null,this.$$pf_InChat=!1,this.$$pf_Client=null,this.$$pf_IsReadOnly=!1,this.$$pf_JoinTime=0,this.$$pf_PresenceStatus=null,this.set_clientId(e),this.set_userName(t),this.set_color(n),this.set_capabilities(r||new i.w(0)),this.set_chatThreadId(o),this.set_chatThreadDiscoveryUri(l),this.set_inChat(c),this.set_email(a),this.set_client(s),this.set_isAnonymous(u),this.set_isReadOnly(d),this.set_joinTime(p),this.set_presenceStatus(g)}return e.prototype.get_isAnonymous=function(){return this.$$pf_IsAnonymous},e.prototype.set_isAnonymous=function(e){return this.$$pf_IsAnonymous=e,e},e.prototype.get_email=function(){return this.$$pf_Email},e.prototype.set_email=function(e){return this.$$pf_Email=e,e},e.prototype.get_clientId=function(){return this.$$pf_ClientId},e.prototype.set_clientId=function(e){return this.$$pf_ClientId=e,e},e.prototype.get_userName=function(){return this.$$pf_UserName},e.prototype.set_userName=function(e){return this.$$pf_UserName=e,e},e.prototype.get_color=function(){return this.$$pf_Color},e.prototype.set_color=function(e){return this.$$pf_Color=e,e},e.prototype.get_capabilities=function(){return this.$$pf_Capabilities},e.prototype.set_capabilities=function(e){return this.$$pf_Capabilities=e,e},e.prototype.get_chatThreadId=function(){return this.$$pf_ChatThreadId},e.prototype.set_chatThreadId=function(e){return this.$$pf_ChatThreadId=e,e},e.prototype.get_chatThreadDiscoveryUri=function(){return this.$$pf_ChatThreadDiscoveryUri},e.prototype.set_chatThreadDiscoveryUri=function(e){return this.$$pf_ChatThreadDiscoveryUri=e,e},e.prototype.get_inChat=function(){return this.$$pf_InChat},e.prototype.set_inChat=function(e){return this.$$pf_InChat=e,e},e.prototype.get_client=function(){return this.$$pf_Client},e.prototype.set_client=function(e){return this.$$pf_Client=e,e},e.prototype.get_isReadOnly=function(){return this.$$pf_IsReadOnly},e.prototype.set_isReadOnly=function(e){return this.$$pf_IsReadOnly=e,e},e.prototype.get_joinTime=function(){return this.$$pf_JoinTime},e.prototype.set_joinTime=function(e){return this.$$pf_JoinTime=e,e},e.prototype.get_presenceStatus=function(){return this.$$pf_PresenceStatus},e.prototype.set_presenceStatus=function(e){return this.$$pf_PresenceStatus=e,e},e.prototype.equals=function(e){return!!e&&e.get_color()===this.get_color()&&e.get_userName()===this.get_userName()&&e.get_clientId()===this.get_clientId()&&e.get_isAnonymous()===this.get_isAnonymous()&&e.get_email()===this.get_email()&&e.get_inChat()===this.get_inChat()&&this.get_capabilities().equals(e.get_capabilities())&&e.get_presenceStatus()===this.get_presenceStatus()},e.prototype.clone=function(){return new e(this.get_clientId(),this.get_userName(),this.get_color(),this.get_capabilities().clone(),this.get_chatThreadId(),this.get_email(),this.get_client(),this.get_chatThreadDiscoveryUri(),this.get_isAnonymous(),this.get_inChat(),this.get_isReadOnly(),this.get_joinTime(),this.get_presenceStatus())},e.prototype.isComplete=function(){return this.isValid()&&!!this.get_userName()&&!(this.get_userName()===CommonUIStrings.l_AnonymousUserName&&!this.get_isAnonymous())},e.prototype.isValid=function(){return!!this.get_clientId()},e.prototype.toString=function(){return Object.prototype.toString.call(this)},e.createFromClientId=function(t){return new e(t,null,null,new i.w(0),null,null,null,null,!1,!1,!1,0,null)},e}();(0,o.l)(a,"337f1e53$PresenceUser",null,[r.t])},7073:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(423),o=(0,i.y)("2a3baeb7$IDocChatActor"),a=n(3656),s=n(7772),l=n(2407),u=(0,i.y)("7e9431e4$IDocChatUserIdFactory"),c=n(5354),d=n(5941),p=(0,i.y)("8e35f724$ISkypeChatNotifier"),g=n(9937),h=n(3093),_=n(363),f=n(8192),m=n(3362),y=n(7597),v=n(2575),S=function(){function e(e,t,n){this._postInitCallback=null,this._lazyActor=null,this._futureBasicChatUxController=null,this._initialized=!1,this._lazyActor=e,this._futureBasicChatUxController=t,this._postInitCallback=n}return e.prototype.init=function(){this._initialized?y.ULS.sendTraceTag(9000738,333,15,"Init called multiple times"):(this._initialized=!0,v.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocChatIsEnabled")&&this._futureBasicChatUxController.execute(i.i(this,this.OnBasicChatUserExperienceController,"OnBasicChatUserExperienceController")))},e.prototype.OnBasicChatUserExperienceController=function(e){var t=this;e.get_capabilitiesAsync().CW((function(n){var r=e.get_capabilitiesAsync().get_result();r.get_fullExperienceIsEnabled()?t.InitInternal(r):r.get_anonymousExperienceSupport()&&(v.AFrameworkApplication.userNameUnknown&&3!==e.get_experience()?y.ULS.sendTraceTag(18121750,333,50,"DocChatBootstrapper: Anonymous Doc Chat is not available because the user name is unknown."):t.InitInternal(r))}))},e.prototype.InitInternal=function(e){y.ULS.sendTraceTag(9000739,333,15,"DocChatBootStrapper: Doc chat is enabled."),this._lazyActor.get_value().registerActionsAndInitializeTask(v.AFrameworkApplication.userName,e),this._postInitCallback&&this._postInitCallback()},e}();(0,i.l)(S,"29baef30$DocChatBootstrapper",null,[]);var I=n(934),C=n(3545),T=(0,i.y)("b185c3f7$IChatAvailabilityFinder"),b=n(4304),A=n(4072),M=function(){function e(){this._eventSource=null,this._previousAvailability=!1,this._eventSource=new A.f}return e.prototype.add_availabilityChanged=function(t){this._eventSource.addHandler(e.AvailabilityChangedEventKey,t)},e.prototype.remove_availabilityChanged=function(t){this._eventSource.removeHandler(e.AvailabilityChangedEventKey,t)},e.prototype.add_coauthorAvailabilityChanged=function(t){this._eventSource.addHandler(e.CoauthorAvailabilityChangedEventKey,t)},e.prototype.remove_coauthorAvailabilityChanged=function(t){this._eventSource.removeHandler(e.CoauthorAvailabilityChangedEventKey,t)},e.prototype.add_myPresenceUpdated=function(t){this._eventSource.addHandler(e.MyPresenceUpdatedEventKey,t)},e.prototype.remove_myPresenceUpdated=function(t){this._eventSource.removeHandler(e.MyPresenceUpdatedEventKey,t)},e.prototype.raiseAvailabilityChangedEventIfNeeded=function(t){t!==this._previousAvailability&&(this._eventSource.raiseEvent(e.AvailabilityChangedEventKey,new b.e(t,!1),null),this._previousAvailability=t,y.ULS.sendTraceTag(6603939,333,50,"Chat availability changed to now be {0}",t))},e.prototype.raiseCoauthorAvailabilityChangedEvent=function(t){this._eventSource.raiseEvent(e.CoauthorAvailabilityChangedEventKey,new Sys.EventArgs,null),y.ULS.sendTraceTag(42521618,333,50,"Chat availability changed for the following coauthors {0}",t)},e.prototype.raiseMyPresenceUpdatedEvent=function(){this._eventSource.raiseEvent(e.MyPresenceUpdatedEventKey,null,null)},e.AvailabilityChangedEventKey="AVCEK",e.CoauthorAvailabilityChangedEventKey="CACEK",e.MyPresenceUpdatedEventKey="MPUEK",e}();(0,i.l)(M,"4cb93daf$AChatAvailabilityFinder",null,[T]);var P=n(6720),F=n(3517),w=function(){return function(e,t,n){this.Email=e,this.InChat=t,this.Capabilities=n}}();(0,i.l)(w,"42f7013f$ChatPersistentState",null,[]);n(1480);var R=function(e){function t(t,n,r,i,o,a){var s=e.call(this)||this;return s._rtc=null,s._presenceContext=null,s._rtcTask=null,s._presenceContextTask=null,s._presenceSenderTask=null,s._presenceConverterTask=null,s._appSettingsManager=null,s._presenceSender=null,s._userIdFactory=null,s._presenceConverter=null,s._myEmail=null,s._initialized=!1,s._availableCoauthors=null,s._rtcTask=t,s._presenceContextTask=n,s._presenceSenderTask=r,s._userIdFactory=i,s._presenceConverterTask=o,s._appSettingsManager=a,s._availableCoauthors=new P.c(String),s}return(0,C.t)(t,e),t.prototype.init=function(){return y.ULS.sendTraceTag(9000769,333,50,"Init - RtcChatAvailabilityFinder"),F.Task.WAA(this._userIdFactory.get_userIdAsync(),this._rtcTask,this._presenceSenderTask,this._presenceConverterTask,this._presenceContextTask).CW(i.i(this,this.OnAllTasksReady,"OnAllTasksReady"))},t.prototype.OnAllTasksReady=function(e){y.ULS.sendTraceTag(6603968,333,50,"All prerequisite ready for RtcChatAvailabilityFinder"),this._rtc=this._rtcTask.get_result(),this._presenceSender=this._presenceSenderTask.get_result(),this._presenceContext=this._presenceContextTask.get_result(),this._myEmail=this._userIdFactory.get_userIdAsync().get_result(),this._presenceConverter=this._presenceConverterTask.get_result(),this._rtc.add_connectionStateChanged(i.i(this,this.OnConnectionStateChanged,"OnConnectionStateChanged")),this._rtc.add_presenceUpdated(i.i(this,this.OnPresenceUpdated,"OnPresenceUpdated")),this._rtc.add_myPresenceUpdated(i.i(this,this.OnMyPresenceUpdated,"OnMyPresenceUpdated")),this._rtc.add_persistentStateUpdated(i.i(this,this.OnPersistentStateUpdated,"OnPersistentStateUpdated")),this._myEmail||this._presenceContext.get_email()?(this._presenceContext.set_email(this._presenceContext.get_email()||this._myEmail),this.setMyAvailability(!0),this._initialized=!0,this.anyoneToChatWith()):y.ULS.sendTraceTag(6603969,333,10,"Email in presence context is null or undefined. This will cause Skype to not work")},t.prototype.setMyAvailability=function(e){this.SetMyPresenceAvailability(e),this.SetMyPersistentStateAvailability(e)},t.prototype.SetMyPresenceAvailability=function(e){this._presenceContext&&this._presenceSender&&(e?this._presenceContext.get_capabilities().setFlag(4):this._presenceContext.get_capabilities().unsetFlag(4),this._presenceSender.sendCurrentSelection())},t.prototype.SetMyPersistentStateAvailability=function(e){if(this._rtc){var t=this.GetMyPersistentState();t&&(t.Email=this._myEmail,t.Capabilities=e?1:0,this._rtc.sendPersistentState(1,t))}},t.prototype.GetMyPersistentState=function(){var e=this._rtc.getAllPersistentState(1);return e&&this._rtc.get_clientId()in e?e[this._rtc.get_clientId()]:new w("",!1,0)},t.prototype.OnConnectionStateChanged=function(e,t){this.anyoneToChatWith()},t.prototype.OnPresenceUpdated=function(e,t){var n=Date.now();this.anyoneToChatWith(),this.OnPresenceUpdatedInternal(t.get_updatedClients()),t.trackDurationInMilliseconds("RtcChatAvailabilityFinder",Date.now()-n)},t.prototype.OnMyPresenceUpdated=function(e,t){this.raiseMyPresenceUpdatedEvent()},t.prototype.OnPersistentStateUpdated=function(e,t){1===t.get_type()&&this.anyoneToChatWith()},t.prototype.anyoneToChatWith=function(){if(!this._initialized)return y.ULS.sendTraceTag(6603970,333,50,"Anyone to chat with was called before component was initialized"),this.raiseAvailabilityChangedEventIfNeeded(!1),!1;if(2!==this._rtc.get_connectionState())return y.ULS.sendTraceTag(6649866,333,50,"Rtc Connection not yet established: state:{0}",this._rtc.get_connectionState()),this.raiseAvailabilityChangedEventIfNeeded(!1),!1;var e=this._rtc.getAllPresence(),t=this._rtc.getAllPersistentState(1),n=this.IsThereMoreThanOneUniqueAuthorInPresence(e)||this.IsThereMoreThanOneUniqueAuthorInPersistentState(t);return this.raiseAvailabilityChangedEventIfNeeded(n),n},t.prototype.OnPresenceUpdatedInternal=function(e){if(this._appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled")){var t=new P.c(String);for(var n in e){var r={key:n,value:e[n]},i=this._presenceConverter.getPresenceUserFromDictEntry(r);if(i){var o=this.findCoauthorAvailability(i.get_clientId());this._availableCoauthors.indexOf(i.get_clientId())>=0&&!o?(this._availableCoauthors.remove(i.get_clientId()),t.add(i.get_clientId())):this._availableCoauthors.indexOf(i.get_clientId())<0&&o&&(this._availableCoauthors.add(i.get_clientId()),t.add(i.get_clientId()))}else y.ULS.sendTraceTag(42824128,333,15,"Presence was null when we should always have a defined value from updatedClients")}t.get_count()>0&&this.raiseCoauthorAvailabilityChangedEvent(t)}},t.prototype.findCoauthorAvailability=function(e){if(!this._initialized)return y.ULS.sendTraceTag(42521619,333,50,"Find Coauthor Availability with was called before component was initialized"),!1;if(2!==this._rtc.get_connectionState())return y.ULS.sendTraceTag(42521620,333,50,"Rtc Connection not yet established: state: {0}",this._rtc.get_connectionState()),!1;var t={};t[e]=this._rtc.getAllPersistentState(1)[e];var n=this.IsThereMoreThanOneUniqueAuthorInPersistentState(t),r={};r[e]=this._rtc.getAllPresence()[e];var i=this.IsThereMoreThanOneUniqueAuthorInPresence(r);return n||i},t.prototype.IsThereMoreThanOneUniqueAuthorInPresence=function(e){if(!e)return!1;for(var t in e){var n={key:t,value:e[t]},r=this._presenceConverter.getPresenceUserFromDictEntry(n);if(r&&r.get_email()&&r.get_capabilities()&&r.get_capabilities().hasFlag(4)&&r.get_email()!==this._myEmail)return!0}return!1},t.prototype.IsThereMoreThanOneUniqueAuthorInPersistentState=function(e){if(!e)return!1;for(var t in e){var n={key:t,value:e[t]}.value;if(n&&n.Email&&1&n.Capabilities&&n.Email!==this._myEmail)return!0}return!1},t}(M);(0,i.l)(R,"b48ff2b$RtcChatAvailabilityFinder",M,[]);var E=n(127),k=n(9910),D=n(8996),O=function(){function e(){}return e.deserialize=function(e){if(!e)return y.ULS.sendTraceTag(5328905,333,10,"Response from SkypeProxy was null"),null;try{return D.x.deserialize(e)}catch(t){y.ULS.sendTraceTag(5328906,333,10,"could not parse the response of request: {0}",e.substr(0,Math.min(e.length,250)))}return null},e}();(0,i.l)(O,"e5c7ff02$SkypeProxyResponseHelper",null,[]);var U=function(){function e(e,t){this.chatThreadId=null,this.chatThreadDiscoveryUri=null,this.chatThreadId=e,this.chatThreadDiscoveryUri=t}return e.prototype.get_chatThreadId=function(){return this.chatThreadId},e.prototype.get_chatThreadDiscoveryUri=function(){return this.chatThreadDiscoveryUri},e}();(0,i.l)(U,"baf7df7b$DocChatInfo",null,[]);var x=n(9354),L=n(7374),N=n(2192),B=n(6363),H=n(9703),$=function(){function e(e,t,n,r,i){this._unreadConversationsCount=0,this._chatPaneEverOpened=!1,this._createChatThreadPending=!1,this._buttonWasMadeAvailable=!1,this._chatClientIsReady=!1,this._anyoneToChatWith=!1,this._docChatInitiated=!1,this._isChatClientAvailable=!1,this._docChatFailureLogged=!1,this._docChatUsageLogged=!1,this._docChatAvailabilityLogged=!1,this._chatThreadJoined=!1,this._chatThreadJoinPending=!1,this._chatThreadDisconnected=!1,this._shouldRetryJoin=!1,this._userFriendlyName=null,this._notifierTask=null,this._notifier=null,this._basicChatCapabilities=null,this._requestHandler=null,this._availabilityFinder=null,this._docChatInitiatedAndChatPaneToggled=!1,this._registerAndInitTcs=null,this.actionManager=null,this._docChatClientFactory=null,this._docChatClient=null,this.priorChatThreadInfo=null,this.chatThreadInfo=null,this.actionManager=e,this._notifierTask=n,this._chatClientIsReady=!1,this._requestHandler=r,this._availabilityFinder=i,this._docChatClientFactory=t}return e.prototype.get_DocChatJoinInfoFromServerIsEnabled=function(){return v.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocChatJoinInfoFromServerIsEnabled")},e.prototype.get_DocChatDiscoveryViaPersistentStateChannelIsEnabled=function(){return v.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocChatDiscoveryViaPersistentStateChannelIsEnabled")},e.prototype.get_actionManager=function(){return this.actionManager},e.prototype.get_settings=function(){return L.c.getChatButtonSettings()},e.prototype.get_isDocChatAvailable=function(){return this._anyoneToChatWith&&this._isChatClientAvailable},e.prototype.registerActionsAndInitializeTask=function(e,t){return this._userFriendlyName=e,this._basicChatCapabilities=t,this._registerAndInitTcs?this._registerAndInitTcs.get_task():(this._registerAndInitTcs=new E.z(Boolean),this._docChatClientFactory?(this.InitializeTask(),this._registerAndInitTcs.get_task()):(y.ULS.sendTraceTag(8730523,333,15,"docChatClient is null"),this._registerAndInitTcs.setResult(!1),this._registerAndInitTcs.get_task()))},e.prototype.registerActions=function(){y.ULS.shipAssertTag(5269512,333,!!this.get_actionManager(),null),this.get_actionManager().addActionWithFlags(this.get_settings().queryStatusActionId,N.m.frame,i.i(this,this.queryChatButtonStatus,"queryChatButtonStatus"),96),this.get_actionManager().addAction(this.get_settings().togglePaneActionId,N.m.frame,i.i(this,this.docChatClickHandler,"docChatClickHandler")),this.get_DocChatJoinInfoFromServerIsEnabled()?this.get_actionManager().addAction(this.get_settings().joinChatActionId,N.m.frame,i.i(this,this.RetrieveAndJoinChatThread,"RetrieveAndJoinChatThread")):this.get_actionManager().addAction(this.get_settings().joinChatActionId,N.m.frame,i.i(this,this.JoinChatThreadFoundFromOthersHandler,"JoinChatThreadFoundFromOthersHandler")),this.get_actionManager().addActionWithFlags(this.get_settings().refreshControlActionId,N.m.frame,i.i(this,this.refreshChatControl,"refreshChatControl"),96),this.get_actionManager().addAction(k.b.isJoined,N.m.frame,i.i(this,this.isChatClientJoined,"isChatClientJoined"))},e.prototype.InitializeTask=function(){var e=this;this._docChatClient=this._docChatClientFactory.create();var t=this._docChatClient.ready();t.CW((function(n){var r=t.get_result();e.OnDocChatClientReady(r),e._registerAndInitTcs.setResult(r)}))},e.prototype.OnUnreadConversationsChanged=function(e,t){this._unreadConversationsCount=t.unreadConversations,this.refreshChatButton()},e.prototype.OnPaneStateChanged=function(e,t){this.refreshChatButton(),this._chatPaneEverOpened=this._chatPaneEverOpened||1===this._docChatClient.get_paneState(),this.LogSuccessOfDocChat()},e.prototype.LogSuccessOfDocChat=function(){this._docChatInitiated&&1===this._docChatClient.get_paneState()&&!this._docChatInitiatedAndChatPaneToggled&&(y.ULS.sendTraceTag(6129288,333,50,"Doc chat started and pane toggled"),this._docChatInitiatedAndChatPaneToggled=!0)},e.prototype.LogAvailabilityOfDocChat=function(){!this._docChatAvailabilityLogged&&this._anyoneToChatWith&&(y.ULS.sendTraceTag(37597725,333,15,"Doc chat is available"),this._docChatAvailabilityLogged=!0)},e.prototype.AvailabilityChanged=function(e,t){this._anyoneToChatWith=t.get_isAvailable(),this.LogAvailabilityOfDocChat(),this.refreshChatButton()},e.prototype.OnDocChatClientReady=function(e){var t=this;e?(this.registerActions(),this._chatClientIsReady=!0,this._docChatClient.add_paneStateChanged(i.i(this,this.OnPaneStateChanged,"OnPaneStateChanged")),this._docChatClient.add_unreadConversationsChanged(i.i(this,this.OnUnreadConversationsChanged,"OnUnreadConversationsChanged")),this._docChatClient.add_availabilityChanged(i.i(this,this.OnChatClientAvailabilityChanged,"OnChatClientAvailabilityChanged")),this._notifierTask&&this._notifierTask.CW((function(e){t.OnNotifierReady()})),this._availabilityFinder&&this._availabilityFinder.init().CW((function(e){t.OnAvailabilityFinderReady()})),this.UpdateChatClientAvailability(!0,!1)):y.ULS.sendTraceTag(9000770,333,10,"Doc chat client not ready")},e.prototype.OnChatClientAvailabilityChanged=function(e,t){this.UpdateChatClientAvailability(t.get_isAvailable(),t.get_chatThreadDisconnected())},e.prototype.UpdateChatClientAvailability=function(e,t){this._isChatClientAvailable=e,this._chatThreadDisconnected=this._chatThreadJoined&&t,this._chatThreadJoined=this._chatThreadJoined&&!this._chatThreadDisconnected,this.refreshChatButton()},e.prototype.OnNotifierReady=function(){this._notifier=this._notifierTask.get_result(),this._notifier.add_newChatThreadIdDetected(i.i(this,this.OnChatThreadFoundFromOthers,"OnChatThreadFoundFromOthers")),this.get_DocChatDiscoveryViaPersistentStateChannelIsEnabled()&&this._notifier.add_docChatDetected(i.i(this,this.OnDocChatDetected,"OnDocChatDetected")),this._notifier.init()},e.prototype.OnAvailabilityFinderReady=function(){y.ULS.sendTraceTag(9000771,333,50,"AvailabilityFinder ready"),this._availabilityFinder.add_availabilityChanged(i.i(this,this.AvailabilityChanged,"AvailabilityChanged")),this._availabilityFinder.add_myPresenceUpdated(i.i(this,this.OnMyPresenceUpdated,"OnMyPresenceUpdated")),this._anyoneToChatWith=this._availabilityFinder.anyoneToChatWith(),this.LogAvailabilityOfDocChat(),this.refreshChatButton()},e.prototype.queryChatButtonStatus=function(e,t,n,r,i){var o=i,a=this.ShouldChatButtonBeVisible();return o[B.e.Visible]=a,this.SetDocChatButtonProperties(o),this.LogFirstTimeButtonIsVisible(a),32},e.prototype.SetDocChatButtonProperties=function(e){this._basicChatCapabilities.get_supportsAnonymousChatOnly()&&(e[B.e.On]=1===this._docChatClient.get_paneState(),v.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled()?v.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactRibbonTabRefreshEnabled()?e[H.b.Icon]=this._unreadConversationsCount>0?"DocChatUnreadGray_16":"DocChat_20":e[H.b.Icon]=this._unreadConversationsCount>0?"DocChatUnread_20":"DocChatGlyph_20":e[B.e.Image16by16Class]=x.ImageClusteringHelper.getImageClass(this._unreadConversationsCount>0?this.get_settings().unreadImageName:this.get_settings().imageName))},e.prototype.LogFirstTimeButtonIsVisible=function(e){e&&!this._buttonWasMadeAvailable&&(y.ULS.sendTraceTag(6350045,333,15,"Setting visibility of the chat button to true"),this._buttonWasMadeAvailable=!0)},e.prototype.ShouldChatButtonBeVisible=function(){return this.get_isDocChatAvailable()||!!this.chatThreadInfo},e.prototype.OnChatThreadFoundFromOthers=function(e,t){this.get_actionManager().processActionWithData(k.b.joinChatThread,2,t.get_chatThreadInfo(),null)},e.prototype.OnDocChatDetected=function(e,t){this.get_DocChatJoinInfoFromServerIsEnabled()&&this.get_actionManager().processActionWithData(k.b.joinChatThread,2,null,null)},e.prototype.JoinChatThreadFoundFromOthersHandler=function(e,t,n,r,i){if(2!==n)return 32;if(this.logUsageOfDocChat(),!this._chatClientIsReady)return y.ULS.sendTraceTag(16808076,333,15,"Join operation before client is ready"),this.LogDocChatFailure(),8;var o=i;return o?this._chatThreadJoinPending||this._chatThreadJoined?(y.ULS.sendTraceTag(18900674,333,50,String.format("Ignoring chat thread {0}. Already connecting or connected to it.",o.get_chatThreadId())),32):(this.chatThreadInfo&&!this._chatThreadDisconnected||(y.ULS.sendTraceTag(18900675,333,50,String.format("Co-authors sent chat thread {0} and we're not connected to it...attempt to connect.",o.get_chatThreadId())),this.EnsureConnectedAndInviteOthersToDocChatSession(o,!1)),32):(y.ULS.sendTraceTag(18493662,333,10,"Invalid ChatThreadInfo."),this.LogDocChatFailure(),8)},e.prototype.RetrieveAndJoinChatThread=function(e,t,n,r,i){return 2!==n?32:(this.logUsageOfDocChat(),this._chatClientIsReady?this._createChatThreadPending||this._chatThreadJoinPending?(y.ULS.sendTraceTag(22045828,333,50,"Ignoring coauthors' InChat flag. Already retrieving the chat info or connecting to doc chat."),1):this._chatThreadJoined?(y.ULS.sendTraceTag(21550146,333,50,"Ignoring coauthors' InChat flag. Already connected to doc chat."),32):(this.chatThreadInfo&&!this._chatThreadDisconnected||(y.ULS.sendTraceTag(21550147,333,50,"Co-authors sent InChat flag and we're not connected to the Doc Chat...attempt to connect."),this.GetOrCreateChatThread(!1)),32):(y.ULS.sendTraceTag(21550145,333,15,"Join operation before client is ready"),this.LogDocChatFailure(),8))},e.prototype.OnMyPresenceUpdated=function(e,t){this._chatThreadJoinPending||this._chatThreadJoined||this.chatThreadInfo&&this._chatThreadDisconnected&&(y.ULS.sendTraceTag(18900676,333,50,String.format("User is active but disconnected from doc chat. Attempting to reconnect to chat thread {0}...",this.chatThreadInfo.get_chatThreadId())),this.get_actionManager().processActionWithData(k.b.joinChatThread,2,this.chatThreadInfo,null))},e.prototype.JoinChatClientToThreadInfo=function(e){var t=this;this._chatThreadJoinPending=!0,this._chatThreadJoined=!1,this._chatThreadDisconnected=!1,this._docChatClient.joinConversation(this.chatThreadInfo,i.i(this,this.OnChatClientJoinSuccess,"OnChatClientJoinSuccess"),(function(){t.OnChatClientJoinFailure(e)}),this._userFriendlyName)},e.prototype.OnChatClientJoinSuccess=function(){this._chatThreadJoinPending=!1,this._chatThreadJoined=!0,y.ULS.sendTraceTag(5616863,333,50,"Join operation was successful")},e.prototype.OnChatClientJoinFailure=function(e){if(this._shouldRetryJoin)return this._shouldRetryJoin=!1,y.ULS.sendTraceTag(38088785,333,15,"Join operation failed, retrying."),void this.JoinChatClientToThreadInfo(e);this._chatThreadJoinPending=!1,e&&this.showErrorNotificationAndLog(),y.ULS.sendTraceTag(5616860,333,10,"Join operation failed even after retrying.")},e.prototype.isChatClientJoined=function(e,t,n,r,i){return this._chatThreadJoined&&!this._chatThreadDisconnected?32:8},e.prototype.NotifyOthers=function(){var e=this;this._notifierTask.CW((function(t){e._notifierTask.get_result().notifyOtherClientsOfNewChatThread(e.chatThreadInfo),e.get_DocChatDiscoveryViaPersistentStateChannelIsEnabled()&&e._notifier.notifyDocChatInitiated()}))},e.prototype.EnsureConnectedAndInviteOthersToDocChatSession=function(e,t){e?(this.chatThreadInfo=e,t&&this._docChatClient.showDocChatPane(),this.JoinChatClientToThreadInfo(t),this.NotifyOthers()):y.ULS.sendTraceTag(18419974,333,10,"Unexpected attempt to get on the doc chat without any chat thread info!")},e.prototype.docChatClickHandler=function(e,t,n,r,i){if(2===n){if(this.logUsageOfDocChat(),!this._chatClientIsReady)return this.LogDocChatFailure(),8;if(this._createChatThreadPending)return 1;this._docChatInitiated=!0,this._shouldRetryJoin=!0,this.get_isDocChatAvailable()&&!this.chatThreadInfo?this.GetOrCreateChatThread(!0):this.ShouldDocChatClickJustHideDocChatPane()?this._docChatClient.hideDocChatPane():this.EnsureConnectedAndInviteOthersToDocChatSession(this.chatThreadInfo,!0)}return this._chatClientIsReady?32:8},e.prototype.GetOrCreateChatThread=function(e){var t=this;y.ULS.sendTraceTag(5616864,333,50,"Trying to create a new thread"),this._createChatThreadPending=!0,this._requestHandler.createThread((function(n){t.OnCreateThreadSuccess(n,e)}),(function(n){t.OnCreateThreadFailure(n,e)}))},e.prototype.OnCreateThreadSuccess=function(e,t){y.ULS.sendTraceTag(5616865,333,50,"Thread created successfully");var n=!1;if(e.get_data()){var r=e.get_data().responseData;if(r){var i=O.deserialize(r);i&&i.Success?(y.ULS.sendTraceTag(5328903,333,50,"Created ChatThreadId is :{0}",i.ThreadId),this.EnsureConnectedAndInviteOthersToDocChatSession(new U(i.ThreadId,i.DiscoveryUri),t),n=!0):y.ULS.sendTraceTag(5616866,333,10,"Could not parse the response, parsed response is null or create thread operation failed.")}else y.ULS.sendTraceTag(5328902,333,10,"ResponseData is null")}else y.ULS.sendTraceTag(5328901,333,10,"e.Data is null");t&&!n&&this.showErrorNotificationAndLog(),this._createChatThreadPending=!1},e.prototype.showErrorNotificationAndLog=function(){this.LogDocChatFailure(),this.showErrorNotification()},e.prototype.LogDocChatFailure=function(){this._docChatFailureLogged||(this._docChatFailureLogged=!0,y.ULS.sendTraceTag(36705359,333,15,"Bad user interaction with doc chat."))},e.prototype.logUsageOfDocChat=function(){this._docChatUsageLogged||(this._docChatUsageLogged=!0,y.ULS.sendTraceTag(36705360,333,15,"Usage of doc chat"))},e.prototype.showErrorNotification=function(){},e.prototype.OnCreateThreadFailure=function(e,t){this._createChatThreadPending=!1,t&&this.showErrorNotificationAndLog(),y.ULS.sendTraceTag(5328904,333,15,"Try to create thread for this user failed")},e.prototype.refreshChatControl=function(e,t,n,r,i){return this.refreshChatButton(),32},e.prototype.ShouldDocChatClickJustHideDocChatPane=function(){return this._basicChatCapabilities.get_supportsAnonymousChatOnly()&&1===this._docChatClient.get_paneState()},e}();(0,i.l)($,"aa368d2$SkypeChatActor",null,[o]);var G=function(e){function t(t){var n=e.call(this)||this;return n.chatThreadInfo=null,n.chatThreadInfo=t,n}return(0,C.t)(t,e),t.prototype.get_chatThreadInfo=function(){return this.chatThreadInfo},t}(Sys.EventArgs);(0,i.l)(G,"c36e443e$DocChatEventArgs",Sys.EventArgs,[]);var W=function(){function e(){this._eventSource=new A.f}return e.prototype.raiseChatThreadIdDetected=function(t){this._eventSource.raiseEvent(e.NewChatThreadIdDetectedEventKey,new G(t),null)},e.prototype.add_newChatThreadIdDetected=function(t){this._eventSource.addHandler(e.NewChatThreadIdDetectedEventKey,t)},e.prototype.remove_newChatThreadIdDetected=function(t){this._eventSource.removeHandler(e.NewChatThreadIdDetectedEventKey,t)},e.prototype.add_docChatDetected=function(t){this._eventSource.addHandler(e.DocChatDetectedEventKey,t)},e.prototype.remove_docChatDetected=function(t){this._eventSource.removeHandler(e.DocChatDetectedEventKey,t)},e.prototype.raiseDocChatDetected=function(){this._eventSource.raiseEvent(e.DocChatDetectedEventKey,null,null)},e.NewChatThreadIdDetectedEventKey="NTID_EK",e.DocChatDetectedEventKey="DCD_EK",e}();(0,i.l)(W,"a48ca03c$ASkypeChatNotifier",null,[p]);var V=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o._rtcTask=null,o._rtc=null,o._presenceManagerTask=null,o._myPresenceUserTask=null,o._myPresenceUser=null,o._presenceUpdateLogged=!1,o._presenceConverterTask=null,o._presenceConverter=null,o._persistentStateUpdateLogged=!1,y.ULS.sendTraceTag(5895065,333,50,"Initializing chat notifier"),o._rtcTask=t,o._myPresenceUserTask=r,o._presenceManagerTask=n,o._presenceConverterTask=i,o}return(0,C.t)(t,e),t.prototype.init=function(){return F.Task.WAA.call(null,this._presenceConverterTask,this._rtcTask,this._myPresenceUserTask).CW(i.i(this,this.onAllTasksReady,"onAllTasksReady"))},t.prototype.onAllTasksReady=function(e){y.ULS.sendTraceTag(6603971,333,50,"All prerequisite ready for SkypeChatNotifier"),this._presenceConverter=this._presenceConverterTask.get_result(),this._myPresenceUser=this._myPresenceUserTask.get_result(),this._rtc=this._rtcTask.get_result(),this.OnPresenceDataAvailable(this._rtc.getAllPresence()),this.OnPersistentStateDataAvailable(this._rtc.getAllPersistentState(1)),y.ULS.sendTraceTag(5898719,333,50,"Subscribing to presence updates"),this._rtc.add_presenceUpdated(i.i(this,this.OnPresenceUpdated,"OnPresenceUpdated")),this._rtc.add_persistentStateUpdated(i.i(this,this.OnPersistentStateUpdated,"OnPersistentStateUpdated"))},t.prototype.OnPresenceUpdated=function(e,t){var n=Date.now();this._myPresenceUser&&(this._presenceUpdateLogged||(this._presenceUpdateLogged=!0,y.ULS.sendTraceTag(6555618,333,50,"SkypeChat complemented recorded presence update")),this.OnPresenceDataAvailable(t.get_updatedClients()),t.trackDurationInMilliseconds("SkypeChatRtcNotifier",Date.now()-n))},t.prototype.OnPresenceDataAvailable=function(e){for(var t in e){var n={key:t,value:e[t]},r=this._presenceConverter.getPresenceUserFromDictEntry(n);if(r){var i=r.get_chatThreadId();if(i&&r.get_clientId()!==this._myPresenceUser.get_clientId())return y.ULS.sendTraceTag(5895069,333,50,String.format("Chat thread id found : {0}",i)),void this.raiseChatThreadIdDetected(new U(i,r.get_chatThreadDiscoveryUri()))}}},t.prototype.OnPersistentStateUpdated=function(e,t){1===t.get_type()&&(this._persistentStateUpdateLogged||(this._persistentStateUpdateLogged=!0,y.ULS.sendTraceTag(21803734,333,50,"SkypeChat recorded persistent state update")),this.OnPersistentStateDataAvailable(t.get_updatedClients()))},t.prototype.OnPersistentStateDataAvailable=function(e){for(var t in e){var n={key:t,value:e[t]},r=n.value;if(r&&(r.InChat&&n.key!==this._rtc.get_clientId()))return y.ULS.sendTraceTag(21803735,333,50,"User found in chat"),void this.raiseDocChatDetected()}},t.prototype.notifyOtherClientsOfNewChatThread=function(e){return this._presenceManagerTask.CWO(i.i(this,this.ResendPresence,"ResendPresence"),e)},t.prototype.notifyDocChatInitiated=function(){return this._rtcTask.CW(i.i(this,this.ResendPersistentState,"ResendPersistentState"))},t.prototype.ResendPresence=function(e,t){var n=this;F.Task.WAA(this._myPresenceUserTask,this._presenceManagerTask).CW((function(e){n._myPresenceUserTask.get_result().set_chatThreadId(t.get_chatThreadId()),n._myPresenceUserTask.get_result().set_chatThreadDiscoveryUri(t.get_chatThreadDiscoveryUri()),y.ULS.sendTraceTag(5898752,333,50,"Re-sending the latest presence with the chatThreadId:{0}, chatThreaddiscoveryUri:{1}",n._myPresenceUserTask.get_result().get_chatThreadId(),n._myPresenceUserTask.get_result().get_chatThreadDiscoveryUri()),n._presenceManagerTask.get_result().sendCurrentSelection()}))},t.prototype.ResendPersistentState=function(e){var t=this;F.Task.WAA(this._rtcTask).CW((function(e){var n,r=t._rtcTask.get_result().getAllPersistentState(1);(n=r&&t._rtcTask.get_result().get_clientId()in r?r[t._rtcTask.get_result().get_clientId()]:new w("",!1,0)).InChat=!0,y.ULS.sendTraceTag(21803737,333,50,"Re-sending the latest persistent state"),t._rtcTask.get_result().sendPersistentState(1,n)}))},t}(W);(0,i.l)(V,"2775bf98$SkypeChatRtcNotifier",W,[]);var j=n(5377),q=function(){function e(e){this.BaseDocQuerySignature=null,this.BaseDocQuerySignature=e}return e.prototype.serialization=function(){return D.x.serialize([this.getClassId(),this])},e}();(0,i.l)(q,"9ca9d925$ASkypeProxyRequest",null,[]);var z=function(e){function t(t){return e.call(this,t)||this}return(0,C.t)(t,e),t.prototype.getClassId=function(){return 1},t}(q);(0,i.l)(z,"e00d0eae$SkypeProxyCreateThreadRequest",q,[]);var K=function(){function e(e,t,n){this._clientRequestManager=null,this._stopwatchBuilder=null,this._handlerName=null,this._clientRequestManager=e,this._stopwatchBuilder=t,this._handlerName=n}return e.prototype.get_RequestManager=function(){return this._clientRequestManager.get_value()},e.prototype.createThread=function(e,t){var n=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","CreateSkypeChatThread");this.Execute(new z(v.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),(function(t){n.stop(),e(t)}),(function(e){n.stop(),t(e)}))},e.prototype.Execute=function(t,n,r){var i={};i[e.ContentHeader]=e.ContentHeaderValue,this.get_RequestManager().addRequest(this._handlerName,2,t.serialization(),i,!1,2,n,r,null,null,!1,null,null,null,null,!1,null,!1)},e.getAnInstanceWithResolvedDependencies=function(t,n){return n=n||e.HandlerName,new e(new m.q(j.u,(function(){return v.AFrameworkApplication.theClientRequestManager})),t,n)},e.ContentHeader="Content-Type",e.ContentHeaderValue="application/json; charset=utf-8",e.HandlerName="skypeproxy.ashx",e}();(0,i.l)(K,"43f947e2$SkypeProxyRequestHandler",null,[]);var Q=n(2449),Z=n(9423),J=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,t,n,r,i,o)||this;return l._businessBarController=null,l._standaloneRoot=null,l._businessBarController=a,l._standaloneRoot=s,l}return(0,C.t)(t,e),t.prototype.showErrorNotification=function(){this._businessBarController.showDocChatFailedBusinessBar()},t.prototype.refreshChatButton=function(){v.AFrameworkApplication.get_activeFrame()&&v.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled()?Z.App.get_box4Bridge().get_commandUi().updateDocChatControl():(this._standaloneRoot.pollForControlState(this.get_settings().id),Z.App.get_box4Bridge().get_commandUi().scaleRibbonHeader())},t}($);(0,i.l)(J,"502a5520$WoncaSkypeChatActor",$,[]);var X=function(){function e(e,t){this._basicChatUxControllerAsync=null,this._chatClientFactoryAsync=null,this._userIdTcs=null,this._chatClient=null,this._basicChatUxControllerAsync=e,this._chatClientFactoryAsync=t}return e.prototype.get_userIdAsync=function(){return this._userIdTcs?this._userIdTcs.get_task():(this._userIdTcs=new E.z(String),this._basicChatUxControllerAsync.CW(i.i(this,this.OnBasicChatUserExperienceController,"OnBasicChatUserExperienceController")),this._userIdTcs.get_task())},e.prototype.get_alternativeUserIdAsync=function(){return F.Task.fromResult(String,"")},e.prototype.OnBasicChatUserExperienceController=function(e){var t=this,n=this._basicChatUxControllerAsync.get_result();n.get_capabilitiesAsync().CW((function(e){3===n.get_experience()?t._userIdTcs.setResult(v.AFrameworkApplication.userSessionId):n.get_capabilitiesAsync().get_result().get_fullExperienceIsEnabled()?t.GetUserIdFromBasicChatClient():t.GetUserIdFromAlternativeRoute()}))},e.prototype.GetUserIdFromBasicChatClient=function(){var e=this;this._chatClientFactoryAsync.CW((function(t){e._chatClient=e._chatClientFactoryAsync.get_result().create(null),e._chatClient.init().CW((function(t){e._chatClient.get_idAsync().CW((function(t){e._userIdTcs.setResult(e._chatClient.get_idAsync().get_result())}))}))}))},e.prototype.GetUserIdFromAlternativeRoute=function(){var e=this;this.get_alternativeUserIdAsync().CW((function(t){e._userIdTcs.setResult(e.get_alternativeUserIdAsync().get_result())}))},e}();(0,i.l)(X,"1f7582ad$DocChatUserIdFactory",null,[u]);var Y=n(969),ee=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._coauthManager=null,r._editorsReplicator=null,r._emailTcs=new E.z(String),r}return(0,C.t)(t,e),t.prototype.get_alternativeUserIdAsync=function(){var e=this;return Y.h.get_coauthManagerTask().CW((function(t){e._coauthManager=Y.h.get_coauthManagerTask().get_result();var n=e._coauthManager.get_me().EmailAddress;n?e._emailTcs.setResult(n):(e._editorsReplicator=e._coauthManager.get_editorsReplicator(),e._editorsReplicator.add_onSuccessfulReplication(i.i(e,e.OnEditorsReplication,"OnEditorsReplication")))})),this._emailTcs.get_task()},t.prototype.OnEditorsReplication=function(e,t){var n=this._coauthManager.get_me();n.EmailAddress&&(this._emailTcs.setResult(n.EmailAddress),this._editorsReplicator.remove_onSuccessfulReplication(i.i(this,this.OnEditorsReplication,"OnEditorsReplication")))},t}(X);(0,i.l)(ee,"fa2adede$WordDocChatUserIdFactory",X,[u]);var te=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"WordEditor.SkypeChat"},e.prototype.init=function(){var e=this;Z.App.wordEditorPresenceIsEnabled&&new S(new m.q(o,(function(){return e._container.resolve($)})),this._container.resolveFuture(a.l),i.i(this,this.ResolveWordSpecificComponents,"ResolveWordSpecificComponents")).init()},e.prototype.ResolveWordSpecificComponents=function(){this._container.resolve(V)},e.prototype.dispose=function(){},e.prototype.configure=function(e){this._container=e;var t=Q.q.taskFromFuture(s.t,e.resolveFuture(s.t)),n=Q.q.taskFromFuture(l.r,e.resolveFuture(l.r));e.register(K).singleInstance().usingFactory((function(){return K.getAnInstanceWithResolvedDependencies(Z.App.get_activeAppFrame().get_theStopwatchBuilder(),null)})),e.register(u).singleInstance().usingFactory((function(){return new ee(Q.q.taskFromFuture(a.l,e.resolveFuture(a.l)),Q.q.taskFromFuture(c.n,e.resolveFuture(c.n)))})),e.register(V).singleInstance().usingFactory((function(){return new V(Z.App.get_theRealtimeChannelBasicAsync(),Q.q.taskFromFuture(d.r,e.resolveFuture(d.r)),t,n)})),e.register(R).singleInstance().usingFactory((function(){return new R(Z.App.get_theRealtimeChannelBasicAsync(),t,Q.q.taskFromFuture(d.r,e.resolveFuture(d.r)),e.resolve(u),n,v.AFrameworkApplication.appSettingsManager)})),e.register(J).as($).as(o).singleInstance().usingFactory((function(){return new J(v.AFrameworkApplication.get_theActionManager(),e.resolve(I.v),Q.q.taskFromFuture(p,e.resolveFuture(V)),e.resolve(K),e.resolve(R),e.resolve(g.d),e.resolve(h.r).get_sharedStandaloneRoot())}))},e}();(0,i.l)(te,"bc159230$WordSkypeChatPackage",null,[_.u,f.s]),n.d(t,{Program:function(){return ne}});var ne=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new te,0,!0)},e}();(0,i.l)(ne,"f4f309da$Program",null,[])},7114:function(e,t,n){"use strict";n.d(t,{w:function(){return a}});var r=n(382),i=n(3795),o=n(423),a=function(){return function(){this.detail=new i.e(String,Object)}}();(0,o.l)(a,"bc6a002c$AMergeFailureDetail",null,[r.x])},7154:function(e,t,n){"use strict";n.d(t,{k:function(){return i}});var r=n(423),i=function(){return function(e,t,n,r,i,o,a,s,l,u,c,d,p,g){this.packetId=0,this.version=0,this.client=0,this.operationType=0,this.clientId=null,this.anchorObject=null,this.wacData=null,this.addParaData=null,this.mergeRemoveParaData=null,this.splitParaData=null,this.textIdFinal=null,this.text=null,this.symbolData=null,this.strictlySequentialId=null,this.packetId=e,this.client=n,this.operationType=r,this.clientId=t.toLowerCase(),this.anchorObject=i,this.version=p,o&&(this.wacData=o),null!=a&&(this.textIdFinal=a),isNullOrUndefined(s)||(this.text=s),l&&(this.addParaData=l),u&&(this.mergeRemoveParaData=u),c&&(this.splitParaData=c),d&&(this.symbolData=d),this.strictlySequentialId=g}}();(0,r.l)(i,"c6b6cb7b$RTTData",null,[])},7282:function(e,t,n){"use strict";n.r(t),n.d(t,{MyPresenceUser:function(){return u}});var r=n(3545),i=n(7553),o=n(7772),a=n(9562),s=n(2575),l=n(423),u=function(e){function t(){var t=this;return t.$$pf_LocalCobaltLocationInfo=null,t.$$pf_PresenceStatusProvider=null,t=e.call(this)||this}return(0,r.t)(t,e),t.prototype.get_localCobaltLocationInfo=function(){return this.$$pf_LocalCobaltLocationInfo},t.prototype.set_localCobaltLocationInfo=function(e){return this.$$pf_LocalCobaltLocationInfo=e,e},t.prototype.get_presenceStatusProvider=function(){return this.$$pf_PresenceStatusProvider},t.prototype.set_presenceStatusProvider=function(e){return this.$$pf_PresenceStatusProvider=e,e},t.prototype.getMyUser=function(){var e=s.AFrameworkApplication.userName,t=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("UserPrincipalName"),n=this.get_localCobaltLocationInfo()?this.get_localCobaltLocationInfo().get_localCobaltSessionId():null,r=s.AFrameworkApplication.userNameUnknown||s.AFrameworkApplication.limitedEdit,i=this.get_presenceStatusProvider()?this.get_presenceStatusProvider().getStatus():null;return new a.PresenceUser(this.get_clientId(),e,this.get_color(),this.get_capabilities(),n,this.get_chatThreadId(),t,this.get_client(),this.get_chatThreadDiscoveryUri(),r,this.get_inChat(),this.get_isReadOnly(),i)},t}(a.PresenceUser);(0,l.l)(u,"c4725be2$MyPresenceUser",a.PresenceUser,[i.y,o.t])},7482:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("5b262545$ISymbolsActor"),o=(0,r.y)("aaa8201f$ISymbolsLoader"),a=(0,r.y)("cf42f2f3$ISymbolsUIBuilder"),s=n(974),l=n(363),u=n(8192),c=n(2575),d=n(1526),p=n(6910),g=n(1822),h=n(3362),_=n(163),f=n(7597),m=n(7106),y=n(4764),v=n(6379),S=n(6382),I=n(9944),C=n(3545),T=n(2954),b=n(431),A=n(8027),M=function(){function e(){}return e.get_dialogHtml=function(){return A.o.formatHtml(e.DialogHtmlFormat,Box4Intl.Box4Strings.L_SymbolUnicodeNameLabel,"")},e.DialogHtmlFormat="<div class='WACDialogRow' id='SymbolsTable'> <div id='symbolsContainer'></div> </div> <div class='WACDialogRow' id='SymbolName'> <label id='SymbolNameLabel' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='SymbolNameValue'> <label id='SymbolNameValueLabel' class='WACDialogLabel' >{1}</label> </div>",e}();(0,r.l)(M,"7167e51d$InsertSymbolsDialogHtml",null,[]);var P=n(1135),F=n(2612),w=n(6301),R=function(e){function t(n,r,i){var o=this;return o._actionManager=null,o._focusManager=null,o._symbolsUiBuilder=null,o._symbolClickHandler=null,o._symbolKeyHandler=null,o._lastFocusedSymbol=null,o._insertedSymbolCount=0,(o=e.call(this)||this)._actionManager=n,o._focusManager=r,o._symbolsUiBuilder=i,o.setButtonText(1,Box4Intl.Box4Strings.L_SymbolInsertButtonText),o.setButtonText(0,CommonUIStrings.l_DialogClose),o._hideOnButtonClick=!1,o.set_dialogHtml(M.get_dialogHtml()),o.set_dialogId(t.Id),o}return(0,C.t)(t,e),t.prototype.dispose=function(){t._totalInsertedSymbolCount>0&&f.ULS.sendTraceTag(8778014,348,50,"InsertSymbolsDialog: InsertedSymbolCount={0}, TotalInsertedSymbolCount={1}",this._insertedSymbolCount,t._totalInsertedSymbolCount),t._dialogCloseCount++,f.ULS.sendTraceTag(8778015,348,50,"InsertSymbolsDialog: DialogCloseCount={0}",t._dialogCloseCount),this._symbolsUiBuilder=null,this._actionManager=null,e.prototype.dispose.call(this)},t.prototype.showAndFocus=function(){this.initializeAndShow(Box4Intl.Box4Strings.L_SymbolSingle,r.i(this,this.InsertSymbolsDialogHandler,"InsertSymbolsDialogHandler"),null),this._insertedSymbolCount=0,t._dialogOpenCount++,f.ULS.sendTraceTag(8778013,348,50,"InsertSymbolsDialog: DialogOpenCount={0}",t._dialogOpenCount);var e=this.GetSymbolElement(t.SymbolIdPrefixInDialog+t._lastSelectSymbolIndex);e&&e.focus()},t.prototype.hide=function(){var n=document.getElementById(t.SymbolsContainerID);if(n){var i=n.getElementsByTagName("a");if(i)for(var o=0;o<i.length;o++)F.n.removeHandler(i[o],P.d.focus,r.i(this,this.SymbolFocusHandler,"SymbolFocusHandler"))}e.prototype.hide.call(this)},t.prototype.InsertSymbolsDialogHandler=function(e,n){1===e?(this.OnInsertSymbol(t.SymbolIdPrefixInDialog+t._lastSelectSymbolIndex),this._focusManager.pushScope(this.get_fullDialogFocusId(),!0),this._focusManager.getCurrentRegion().listing.trySetCurrentElement(this._btnAction),this._btnAction.focus()):this.hide()},t.prototype.get_lastTop=function(){return t._lastTop},t.prototype.set_lastTop=function(e){return t._lastTop=e,e},t.prototype.get_lastLeft=function(){return t._lastLeft},t.prototype.set_lastLeft=function(e){return t._lastLeft=e,e},t.prototype.onInnerHtmlSet=function(){e.prototype.onInnerHtmlSet.call(this);var n=document.getElementById(t.SymbolsContainerID);if(n){n.innerHTML=this._symbolsUiBuilder.buildFullSymbolsTable();var i=n.getElementsByTagName("a");if(i)for(var o=0;o<i.length;o++)F.n.addHandler(i[o],P.d.focus,r.i(this,this.SymbolFocusHandler,"SymbolFocusHandler"))}},t.prototype.attachDialogEvents=function(){var n=document.getElementById(t.SymbolsContainerID);n&&(this._symbolClickHandler||(this._symbolClickHandler=r.i(this,this.SymbolClickHandler,"SymbolClickHandler"),this._clickManager.registerHandler(P.d.click,n,this._symbolClickHandler),this._clickManager.registerHandler(P.d.doubleClick,n,this._symbolClickHandler)),this._symbolKeyHandler||(this._symbolKeyHandler=r.i(this,this.SymbolKeyHandler,"SymbolKeyHandler"),this._keyInputManager.registerHandler(P.d.keyDown,n,this._symbolKeyHandler),this._keyInputManager.registerHandler(P.d.keyPress,n,this._symbolKeyHandler),this._keyInputManager.registerHandler(P.d.keyUp,n,this._symbolKeyHandler))),e.prototype.attachDialogEvents.call(this)},t.prototype.detachDialogEvents=function(){var n=document.getElementById(t.SymbolsContainerID);n&&(this._symbolClickHandler&&(this._clickManager.unregisterHandler(P.d.click,n,this._symbolClickHandler),this._clickManager.unregisterHandler(P.d.doubleClick,n,this._symbolClickHandler),this._symbolClickHandler=null),this._symbolKeyHandler&&(this._keyInputManager.unregisterHandler(P.d.keyDown,n,this._symbolKeyHandler),this._keyInputManager.unregisterHandler(P.d.keyPress,n,this._symbolKeyHandler),this._keyInputManager.unregisterHandler(P.d.keyUp,n,this._symbolKeyHandler),this._symbolKeyHandler=null)),e.prototype.detachDialogEvents.call(this)},t.prototype.onSelectedSymbolChanged=function(e){this.SetSymbolElementSelectedStatus(t.SymbolIdPrefixInDialog+t._lastSelectSymbolIndex,!1),t._lastSelectSymbolIndex=parseInt(e.substr(e.lastIndexOf("_")+1)),this.SetSymbolElementSelectedStatus(e,!0);var n=document.getElementById("SymbolNameValueLabel");if(n){var r=this.GetSymbolByIndex(t._lastSelectSymbolIndex);n.innerText=r.get_altText()}},t.prototype.GetSymbolByIndex=function(e){var t=this._symbolsUiBuilder.get_symbolsLoader().get_symbolsDictionary().get_value();return t[b.p.getKeys(t)[e]]},t.prototype.SymbolFocusHandler=function(e){if(e.target!==this._lastFocusedSymbol){var t=this._focusManager.getCurrentRegion();t&&t.listing&&(t.listing.trySetCurrentElement(e.target),this._lastFocusedSymbol=e.target)}this.onSelectedSymbolChanged(e.target.id)},t.prototype.SymbolClickHandler=function(e){var t=e.get_sourceElement();return"a"===t.tagName.toLowerCase()&&(e.eventName===P.d.doubleClick&&this.OnInsertSymbol(t.id),this._focusManager.pushScope(this.get_fullDialogFocusId(),!0),this._focusManager.getCurrentRegion().listing.trySetCurrentElement(t),t.focus(),!0)},t.prototype.SymbolKeyHandler=function(e){var n=e.get_sourceElement();if("a"!==n.tagName.toLowerCase())return!1;var r=parseInt(n.id.substr(n.id.lastIndexOf("_")+1));if(e.innerEvent.ctrlKey||e.innerEvent.altKey||e.innerEvent.keyCode>=w.v.vK_F1&&e.innerEvent.keyCode<=w.v.vK_F12)return!1;if(e.eventName===P.d.keyDown){var i=e.innerEvent.keyCode,o=-1;if(i===Sys.UI.Key.enter?(this.OnInsertSymbol(n.id),this._focusManager.pushScope(this.get_fullDialogFocusId(),!0),this._focusManager.getCurrentRegion().listing.trySetCurrentElement(n),n.focus()):i===Sys.UI.Key.up?o=r-t.SymbolsPerLineInDialog:i===Sys.UI.Key.down?o=r+t.SymbolsPerLineInDialog:i===Sys.UI.Key.left?o=c.AFrameworkApplication.get_isRtl()?r+1:r-1:i===Sys.UI.Key.right&&(o=c.AFrameworkApplication.get_isRtl()?r-1:r+1),o>=0){var a=this.GetSymbolElement(t.SymbolIdPrefixInDialog+o);a&&a.focus()}}return!0},t.prototype.OnInsertSymbol=function(e){this._insertedSymbolCount++,t._totalInsertedSymbolCount++;var n=parseInt(e.substr(e.lastIndexOf("_")+1)),r=this.GetSymbolByIndex(n),i={};i.SourceControlId=t.SymbolIdPrefix+n+"_"+r.get_symbolCharacter(),this._actionManager.processActionWithData(m.u.insertSymbol,2,i,null),f.ULS.sendTraceTag(8778016,348,50,"InsertSymbolsDialog: Insert symbol, index={0}",n)},t.prototype.GetSymbolElement=function(e){var n=document.getElementById(t.SymbolsContainerID);return n?n.querySelector("#"+e):null},t.prototype.SetSymbolElementSelectedStatus=function(e,t){var n=this.GetSymbolElement(e);n&&(t?n.setAttribute("selected","true"):n.removeAttribute("selected"))},t.Id="InsertSymbolsDialog",t.SymbolIdPrefix="symbol_",t.SymbolIdPrefixInDialog="symbol_d_",t.SymbolsContainerID="symbolsContainer",t.SymbolsPerLineInDialog=15,t._lastSelectSymbolIndex=0,t._lastTop=null,t._lastLeft=null,t._dialogOpenCount=0,t._dialogCloseCount=0,t._totalInsertedSymbolCount=0,t}(T.b);(0,r.l)(R,"1aaac7b8$InsertSymbolsDialog",T.b,[]);var E=n(2007),k=n(329),D=n(1751),O=n(283),U=function(){function e(e,t,n,i,o,a,s,l){this._actionManager=null,this._graphIteratorFactory=null,this._symbolDropDownMenuProps=null,this._symbolsDropDownXml=null,this._graphTransactionFactory=null,this._symbolsDictionary=null,this._symbolsUiBuilder=null,this._lockedRangeEditor=null,this._appFeaturesLookup=null,this._selectionManager=null,this._externalSelectionManagerFuture=null,this._actionManager=e,this._graphIteratorFactory=t,this._symbolDropDownMenuProps=new h.q(v.b,r.i(this,this.GetSymbolsDropDownMenuProps,"GetSymbolsDropDownMenuProps")),this._symbolsDropDownXml=new h.q(String,r.i(this,this.GetSymbolsDropDownXml,"GetSymbolsDropDownXml")),this._symbolsDictionary=i.get_symbolsLoader().get_symbolsDictionary(),this._graphTransactionFactory=n,this._symbolsUiBuilder=i,this._lockedRangeEditor=o,this._appFeaturesLookup=a,this._selectionManager=s,this._externalSelectionManagerFuture=l}return e.prototype.GetSymbolsDropDownMenuProps=function(){return this._symbolsUiBuilder.buildProps()},e.prototype.GetSymbolsDropDownXml=function(){return this._symbolsUiBuilder.build()},e.prototype.registerActions=function(){this._actionManager.addActionWithFlags(m.u.queryInsertSymbols,D.d.application,r.i(this,this.queryInsertSymbols,"queryInsertSymbols"),96),this._actionManager.addAction(m.u.populateSymbolsDropDown,D.d.view,r.i(this,this.populateSymbolsDropDown,"populateSymbolsDropDown")),this._actionManager.addAction(m.u.symbolsDropDownOpen,D.d.view,r.i(this,this.symbolsDropDownOpenHandler,"symbolsDropDownOpenHandler")),this._actionManager.addAction(m.u.querySymbolPosition,D.d.view,r.i(this,this.QuerySymbolPositionHandler,"QuerySymbolPositionHandler")),this._actionManager.addAction(m.u.insertSymbol,D.d.view,r.i(this,this.insertSymbolViewHandler,"insertSymbolViewHandler")),this._actionManager.addAction(m.u.populateSymbolsDropDown,D.d.insertionPoint,r.i(this,this.populateSymbolsDropDown,"populateSymbolsDropDown")),this._actionManager.addAction(m.u.symbolsDropDownOpen,D.d.insertionPoint,r.i(this,this.symbolsDropDownOpenHandler,"symbolsDropDownOpenHandler")),this._actionManager.addAction(m.u.querySymbolPosition,D.d.insertionPoint,r.i(this,this.QuerySymbolPositionHandler,"QuerySymbolPositionHandler")),this._actionManager.addAction(m.u.insertSymbol,D.d.insertionPoint,r.i(this,this.insertSymbolHandler,"insertSymbolHandler")),this._actionManager.setActionFlags(m.u.populateSymbolsDropDown,100),this._actionManager.setActionFlags(m.u.symbolsDropDownOpen,12),this._actionManager.setActionFlags(m.u.querySymbolPosition,100),this._actionManager.setActionFlags(m.u.insertSymbol,12),c.AFrameworkApplication.appSettingsManager&&c.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("InsertMoreSymbolsIsEnabled")&&(this._actionManager.addAction(m.u.insertMoreSymbols,D.d.view,r.i(this,this.showInsertMoreSymbolsDialogHandler,"showInsertMoreSymbolsDialogHandler")),this._actionManager.addAction(m.u.insertMoreSymbols,D.d.insertionPoint,r.i(this,this.showInsertMoreSymbolsDialogHandler,"showInsertMoreSymbolsDialogHandler")),this._actionManager.setActionFlags(m.u.insertMoreSymbols,100))},e.prototype.QuerySymbolPositionHandler=function(e,t,n,r,i){if(1===n)return 32;var o=i,a=this._symbolsUiBuilder.parseSymbol(o),s=this._symbolsUiBuilder.get_symbolGalleryButton(),l=String.format(s,a.character);return o[I.u.InnerHTML]=l,o[I.u.On]=!1,32},e.prototype.insertSymbolViewHandler=function(e,t,n,r,i){var o,a,s;if(this.DefaultActionHandler(t,n,(0,g.m)((function(){return o}),(function(e){return o=e})),(0,g.m)((function(){return a}),(function(e){return a=e})),(0,g.m)((function(){return s}),(function(e){return s=e}))))return s;var l=E.SelectionEditor.isInsertionPointContext(a),u=!0,c=8,d=this._graphTransactionFactory.getTransaction(15,0);if(d.setFromNode(o.get_targetNode()),!l){var p=32===(c=this._actionManager.processActionAgainstContext(t,m.u.deleteForReplace,2,!0,r,null,null));f.ULS.shipAssertTag(6407387,348,p,"DeleteForReplace did not succeed. Response is {0}",c),u=p}if(u){var h=o.get_selectionManager().get_selectionContextForActionDispatch(),_=E.SelectionEditor.isInsertionPointContext(h);f.ULS.shipAssertTag(6407388,348,_,"Context is not an InsertionPointContext after DeleteForReplace. Context is {0}",h.get_contextId()),c=8,_&&(c=this._actionManager.processActionAgainstContext(h,m.u.insertSymbol,2,!1,r,i,null),f.ULS.shipAssertTag(6407389,348,32===c,"Insertion at IP context did not succeed. Response is {0}",c),32===c&&y.FocusManager.instance().setScope(o.get_focusScopeId()))}return d.dispose(),c},e.prototype.DefaultActionHandler=function(e,t,n,r,i){var o=e;return n.val=null,o.view.get_isInteractiveView()&&(n.val=o.view),r.val=null,n.val&&n.val.get_selectionManager()?(r.val=n.val.get_selectionManager().get_selectionContextForActionDispatch(),r.val?this._appFeaturesLookup.get_item(14)&&this._lockedRangeEditor.contextSetContainsLockedRange(r.val,!1)?(i.val=8,!0):n.val.get_selectionManager().get_selectionCollection().isOutlineLevelSelection?(i.val=2,!0):this._externalSelectionManagerFuture&&this._externalSelectionManagerFuture.get_instance()&&this._externalSelectionManagerFuture.get_instance().isExternalSelectionContext(r.val)?(i.val=2,!0):E.SelectionEditor.isBlobOrAnyImageContext(e.get_nextContext())?(i.val=2,!0):(i.val=32,1===t):(i.val=2,!0)):(_.r.traceTag(16851359,315,50,"DefaultActionHandler would have crashed. The context passed in was {0} which does not contain a selection manager",e.toString()),i.val=8,!0)},e.prototype.insertSymbolHandler=function(t,n,r,i,o){if(1===r)return 32;if(E.SelectionEditor.isBlobOrAnyImageContext(n))return 2;var a=o,s=this._symbolsUiBuilder.parseSymbol(a);i.dataValue1=s.index;var l=n,u=this._graphIteratorFactory.getGraphIteratorFromNode(l.get_node()),c=u.tryToRootAtAncestorOfType(11);f.ULS.shipAssertTag(6379466,324,c,"could not root iterator at ancestor of type OutlineElement. NodeType: {0}",O.l[l.get_node().get_type()]);var d=this._graphTransactionFactory.getTransaction(15,0);d.setFromIterator(u),e.get_characterPropertiesEditor().replaceTextRange(n,s.character,!0,!1,0);var p=k.SelectionFactory.createIpSelection(u.get_currentNode(),n.get_cpBegin()+1);return this._selectionManager.setSelection(p,null,!1,!1),d.dispose(),32},e.prototype.populateSymbolsDropDown=function(e,t,n,r,i){if(1===n)return 32;var o=i;return c.AFrameworkApplication.get_activeFrame()&&c.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled()?o.MenuItems=this._symbolDropDownMenuProps.get_value():o.PopulationXML=this._symbolsDropDownXml.get_value(),32},e.prototype.symbolsDropDownOpenHandler=function(e,t,n,r,i){var o,a,s;return this.DefaultActionHandler(t,n,(0,g.m)((function(){return o}),(function(e){return o=e})),(0,g.m)((function(){return a}),(function(e){return a=e})),(0,g.m)((function(){return s}),(function(e){return s=e}))),s},e.prototype.showInsertMoreSymbolsDialogHandler=function(e,t,n,r,i){2===n&&new R(this._actionManager,y.FocusManager.instance(),S.w.get_instance().resolve(a)).showAndFocus();return 32},e.prototype.queryInsertSymbols=function(e,t,n,r,i){return 32},e.get_characterPropertiesEditor=function(){return e._characterPropertiesEditor||(e._characterPropertiesEditor=S.w.get_instance().resolve(p.x))},e.set_characterPropertiesEditor=function(t){return e._characterPropertiesEditor=t,t},e._characterPropertiesEditor=null,e}();(0,r.l)(U,"caef9f6c$SymbolsActor",null,[i]);var x=function(){function e(e,t){this.symbolCharacter=null,this.altText=null,this.symbolCharacter=e,this.altText=t}return e.prototype.get_symbolCharacter=function(){return this.symbolCharacter},e.prototype.get_altText=function(){return this.altText},e}();(0,r.l)(x,"79de9234$Symbol",null,[]);var L=function(){function e(){this._symbolsDictionary=null,this._symbolKeys=null,this._symbolsDictionary=new h.q(Object,e.CreateSymbolDictionary)}return e.prototype.get_symbolsDictionary=function(){return this._symbolsDictionary},e.prototype.getKeyIndex=function(e){return this._symbolKeys||(this._symbolKeys=b.p.getKeys(this._symbolsDictionary.get_value())),Array.indexOf(this._symbolKeys,e)},e.CreateSymbolDictionary=function(){var e={};return e["\u2022"]=new x("\u2022",Box4Intl.Box4Strings.L_Bullet),e["\u20ac"]=new x("\u20ac",Box4Intl.Box4Strings.L_EuroSign),e["\xa3"]=new x("\xa3",Box4Intl.Box4Strings.L_PoundSign),e["\xa5"]=new x("\xa5",Box4Intl.Box4Strings.L_YenSign),e["\xa9"]=new x("\xa9",Box4Intl.Box4Strings.L_CopyrightSign),e["\xae"]=new x("\xae",Box4Intl.Box4Strings.L_RegisteredSign),e["\u2122"]=new x("\u2122",Box4Intl.Box4Strings.L_TradeMarkSign),e["\xb1"]=new x("\xb1",Box4Intl.Box4Strings.L_PlusMinusSign),e["\u2260"]=new x("\u2260",Box4Intl.Box4Strings.L_NotEqualTo),e["\u2264"]=new x("\u2264",Box4Intl.Box4Strings.L_LessThanOrEqualTo),e["\u2265"]=new x("\u2265",Box4Intl.Box4Strings.L_GreaterThanOrEqualTo),e["\xf7"]=new x("\xf7",Box4Intl.Box4Strings.L_DivisionSign),e["\xd7"]=new x("\xd7",Box4Intl.Box4Strings.L_MultiplicationSign),e["\u221e"]=new x("\u221e",Box4Intl.Box4Strings.L_Infinity),e["\xb5"]=new x("\xb5",Box4Intl.Box4Strings.L_MicroSign),e["\u03b1"]=new x("\u03b1",Box4Intl.Box4Strings.L_GreekSmallLetterAlpha),e["\u03b2"]=new x("\u03b2",Box4Intl.Box4Strings.L_GreekSmallLetterBeta),e["\u03c0"]=new x("\u03c0",Box4Intl.Box4Strings.L_GreekSmallLetterPi),e["\u03a9"]=new x("\u03a9",Box4Intl.Box4Strings.L_OhmSign),e["\u03a3"]=new x("\u03a3",Box4Intl.Box4Strings.L_NArySummation),e["\xb0"]=new x("\xb0",Box4Intl.Box4Strings.L_DegreeSign),e["\u0394"]=new x("\u0394",Box4Intl.Box4Strings.L_CapitalLetterDelta),e["\u263a"]=new x("\u263a",Box4Intl.Box4Strings.L_WhiteSmilingFace),e["\u2665"]=new x("\u2665",Box4Intl.Box4Strings.L_BlackHeartSuit),e["\u20b9"]=new x("\u20b9",Box4Intl.Box4Strings.L_IndianRupeeSign),e["\xbf"]=new x("\xbf",Box4Intl.Box4Strings.L_InvertedQuestionMark),e["\xa1"]=new x("\xa1",Box4Intl.Box4Strings.L_InvertedExclamationMark),e["\u2014"]=new x("\u2014",Box4Intl.Box4Strings.L_EmDash),e["\u2026"]=new x("\u2026",Box4Intl.Box4Strings.L_HorizontalEllipsis),e["\xc0"]=new x("\xc0",Box4Intl.Box4Strings.L_LatinCapitalLetterAWithGrave),e["\xc1"]=new x("\xc1",Box4Intl.Box4Strings.L_LatinCapitalLetterAWithAcute),e["\xc2"]=new x("\xc2",Box4Intl.Box4Strings.L_LatinCapitalLetterAWithCircumflex),e["\xc3"]=new x("\xc3",Box4Intl.Box4Strings.L_LatinCapitalLetterAWithTilde),e["\xc4"]=new x("\xc4",Box4Intl.Box4Strings.L_LatinCapitalLetterAWithDiaeresis),e["\xc5"]=new x("\xc5",Box4Intl.Box4Strings.L_LatinCapitalLetterAWithRingAbove),e["\xc6"]=new x("\xc6",Box4Intl.Box4Strings.L_LatinCapitalLetterAe),e["\xc7"]=new x("\xc7",Box4Intl.Box4Strings.L_LatinCapitalLetterCWithCedilla),e["\xc8"]=new x("\xc8",Box4Intl.Box4Strings.L_LatinCapitalLetterEWithGrave),e["\xc9"]=new x("\xc9",Box4Intl.Box4Strings.L_LatinCapitalLetterEWithAcute),e["\xca"]=new x("\xca",Box4Intl.Box4Strings.L_LatinCapitalLetterEWithCircumflex),e["\xcb"]=new x("\xcb",Box4Intl.Box4Strings.L_LatinCapitalLetterEWithDiaeresis),e["\xcc"]=new x("\xcc",Box4Intl.Box4Strings.L_LatinCapitalLetterIWithGrave),e["\xcd"]=new x("\xcd",Box4Intl.Box4Strings.L_LatinCapitalLetterIWithAcute),e["\xce"]=new x("\xce",Box4Intl.Box4Strings.L_LatinCapitalLetterIWithCircumflex),e["\xcf"]=new x("\xcf",Box4Intl.Box4Strings.L_LatinCapitalLetterIWithDiaeresis),e["\xd1"]=new x("\xd1",Box4Intl.Box4Strings.L_LatinCapitalLetterNWithTilde),e["\xd2"]=new x("\xd2",Box4Intl.Box4Strings.L_LatinCapitalLetterOWithGrave),e["\xd3"]=new x("\xd3",Box4Intl.Box4Strings.L_LatinCapitalLetterOWithAcute),e["\xd4"]=new x("\xd4",Box4Intl.Box4Strings.L_LatinCapitalLetterOWithCircumflex),e["\xd5"]=new x("\xd5",Box4Intl.Box4Strings.L_LatinCapitalLetterOWithTilde),e["\xd6"]=new x("\xd6",Box4Intl.Box4Strings.L_LatinCapitalLetterOWithDiaeresis),e["\xd9"]=new x("\xd9",Box4Intl.Box4Strings.L_LatinCapitalLetterUWithGrave),e["\xda"]=new x("\xda",Box4Intl.Box4Strings.L_LatinCapitalLetterUWithAcute),e["\xdb"]=new x("\xdb",Box4Intl.Box4Strings.L_LatinCapitalLetterUWithCircumflex),e["\xdc"]=new x("\xdc",Box4Intl.Box4Strings.L_LatinCapitalLetterUWithDiaeresis),e["\xdf"]=new x("\xdf",Box4Intl.Box4Strings.L_LatinSmallLetterSharpS),e["\xe0"]=new x("\xe0",Box4Intl.Box4Strings.L_LatinSmallLetterAWithGrave),e["\xe1"]=new x("\xe1",Box4Intl.Box4Strings.L_LatinSmallLetterAWithAcute),e["\xe2"]=new x("\xe2",Box4Intl.Box4Strings.L_LatinSmallLetterAWithCircumflex),e["\xe3"]=new x("\xe3",Box4Intl.Box4Strings.L_LatinSmallLetterAWithTilde),e["\xe4"]=new x("\xe4",Box4Intl.Box4Strings.L_LatinSmallLetterAWithDiaeresis),e["\xe5"]=new x("\xe5",Box4Intl.Box4Strings.L_LatinSmallLetterAWithRingAbove),e["\xe6"]=new x("\xe6",Box4Intl.Box4Strings.L_LatinSmallLetterAe),e["\xe7"]=new x("\xe7",Box4Intl.Box4Strings.L_LatinSmallLetterCWithCedilla),e["\xe8"]=new x("\xe8",Box4Intl.Box4Strings.L_LatinSmallLetterEWithGrave),e["\xe9"]=new x("\xe9",Box4Intl.Box4Strings.L_LatinSmallLetterEWithAcute),e["\xea"]=new x("\xea",Box4Intl.Box4Strings.L_LatinSmallLetterEWithCircumflex),e["\xeb"]=new x("\xeb",Box4Intl.Box4Strings.L_LatinSmallLetterEWithDiaeresis),e["\xec"]=new x("\xec",Box4Intl.Box4Strings.L_LatinSmallLetterIWithGrave),e["\xed"]=new x("\xed",Box4Intl.Box4Strings.L_LatinSmallLetterIWithAcute),e["\xee"]=new x("\xee",Box4Intl.Box4Strings.L_LatinSmallLetterIWithCircumflex),e["\xef"]=new x("\xef",Box4Intl.Box4Strings.L_LatinSmallLetterIWithDiaeresis),e["\xf1"]=new x("\xf1",Box4Intl.Box4Strings.L_LatinSmallLetterNWithTilde),e["\xf2"]=new x("\xf2",Box4Intl.Box4Strings.L_LatinSmallLetterOWithGrave),e["\xf3"]=new x("\xf3",Box4Intl.Box4Strings.L_LatinSmallLetterOWithAcute),e["\xf4"]=new x("\xf4",Box4Intl.Box4Strings.L_LatinSmallLetterOWithCircumflex),e["\xf5"]=new x("\xf5",Box4Intl.Box4Strings.L_LatinSmallLetterOWithTilde),e["\xf6"]=new x("\xf6",Box4Intl.Box4Strings.L_LatinSmallLetterOWithDiaeresis),e["\xf9"]=new x("\xf9",Box4Intl.Box4Strings.L_LatinSmallLetterUWithGrave),e["\xfa"]=new x("\xfa",Box4Intl.Box4Strings.L_LatinSmallLetterUWithAcute),e["\xfb"]=new x("\xfb",Box4Intl.Box4Strings.L_LatinSmallLetterUWithCircumflex),e["\xfc"]=new x("\xfc",Box4Intl.Box4Strings.L_LatinSmallLetterUWithDiaeresis),e["\xff"]=new x("\xff",Box4Intl.Box4Strings.L_LatinSmallLetterYWithDiaeresis),e["\u011e"]=new x("\u011e",Box4Intl.Box4Strings.L_LatinCapitalLetterGWithBreve),e["\u011f"]=new x("\u011f",Box4Intl.Box4Strings.L_LatinSmallLetterGWithBreve),e["\u0130"]=new x("\u0130",Box4Intl.Box4Strings.L_LatinCapitalLetterIWithDotAbove),e["\u0131"]=new x("\u0131",Box4Intl.Box4Strings.L_LatinSmallLetterDotlessI),e["\u0152"]=new x("\u0152",Box4Intl.Box4Strings.L_LatinCapitalLigatureOe),e["\u0153"]=new x("\u0153",Box4Intl.Box4Strings.L_LatinSmallLigatureOe),e["\u015e"]=new x("\u015e",Box4Intl.Box4Strings.L_LatinCapitalLetterSWithCedilla),e["\u015f"]=new x("\u015f",Box4Intl.Box4Strings.L_LatinSmallLetterSWithCedilla),e["\u0178"]=new x("\u0178",Box4Intl.Box4Strings.L_LatinCapitalLetterYWithDiaeresis),e},e}();(0,r.l)(L,"efd42476$SymbolsLoader",null,[o]);var N=n(5214),B=n(6253),H=n(8967),$=n(4381),G=n(625),W=n(9354),V=n(9633),j=n(6378),q=function(){function e(e){this.$$pf_SymbolsLoader=null,this.set_symbolsLoader(e)}return e.prototype.get_symbolsLoader=function(){return this.$$pf_SymbolsLoader},e.prototype.set_symbolsLoader=function(e){return this.$$pf_SymbolsLoader=e,e},e.prototype.get_symbolGalleryButton=function(){return e.SymbolGalleryButtonFormattableString},e.prototype.parseSymbol=function(t){var n=t[e.SourceControlIdPropertyName].split("_"),r={};return 2===n.length?(r.character=n[1],r.index=this.get_symbolsLoader().getKeyIndex(r.character)):(r.character=n[2],r.index=parseInt(n[1])),r},e.prototype.buildProps=function(){return this.GetSymbolsDropdownProperties()},e.prototype.build=function(){return this.GetSymbolsDropDownXml()},e.prototype.buildFullSymbolsTable=function(){var t=new Sys.StringBuilder;t.append('<table class="moreSymbolsTable">');for(var n=this.get_symbolsLoader().get_symbolsDictionary().get_value(),r=b.p.getKeys(n),i=0;i<r.length;){i%e.SymbolsPerLineInDialog||t.append('<tr role="presentation">');var o=n[r[i]],a=e.SymbolIdPrefixInDialog+i;t.append(String.format('<td unselectable="on">\r\n\t\t\t\t\t<div unselectable="on" role="presentation">\r\n\t\t\t\t\t\t<a id="{0}" aria-label="{2}" title="{2}" role="button" tabindex="0" unselectable="on">{1}</a>\r\n\t\t\t\t\t</div></td>',a,j.l.htmlEncode(o.get_symbolCharacter()),j.l.htmlEncode(o.get_altText()))),++i%e.SymbolsPerLineInDialog&&i!==r.length||t.append("</tr>")}return t.append("</table>"),t.toString()},e.prototype.GetSymbolsDropDownXml=function(){var e=this.GetSymbolsDropdownProperties();return $.s.getXmlFromMenuProps(e)},e.prototype.GetSymbolsDropdownProperties=function(){var e=(0,N.m)(new v.b,{Id:"menuSymbolsDropDown",MenuSectionList:[]});return Array.add(e.MenuSectionList,this.AddSymbolsPositionsGallery()),c.AFrameworkApplication.appSettingsManager&&c.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("InsertMoreSymbolsIsEnabled")&&Array.add(e.MenuSectionList,this.AddMoreSymbolsButton()),e},e.prototype.AddMoreSymbolsButton=function(){var e=(0,N.m)(new V.x,{Id:"msMoreSymbols",Title:"",DisplayMode:"Menu16",ControlsId:"ctrlMoreSymbols",ControlList:[]}),t=(0,N.m)(new H.k,{Id:"btnMoreSymbols",Command:"3574218963",LabelText:j.l.xmlEncode(Box4Intl.Box4Strings.L_InsertMoreSymbols),Alt:j.l.xmlEncode(Box4Intl.Box4Strings.L_InsertMoreSymbols),Image16by16:c.AFrameworkApplication.get_imageClusterPath(),Image16by16Class:W.ImageClusteringHelper.getImageClass("Symbol_16x16x32"),KeyTip:CommonUIStrings.l_InsertMoreSymbolsKeytip});return Array.add(e.ControlList,t),e},e.prototype.AddSymbolsPositionsGallery=function(){for(var t=(0,N.m)(new V.x,{Id:"msSymbolsPosition",ShowMenuSectionSeparator:!1,ControlList:[]}),n=(0,N.m)(new G.b,{Type:1,Id:"gallerySymbolsPosition",ExternalId:"InsertSymbols",ExternalGalleryId:"InsertSymbolGallery",Width:e.NoOfPositionPerRow,ElementDimensions:"Size16by16",GalleryItems:new Array(0)}),r=this.get_symbolsLoader().get_symbolsDictionary().get_value(),i=b.p.getKeys(r),o=Math.min(e.NoOfSymbolsInDropdown,i.length),a=0;a<o;a++){var s=r[i[a]],l=(0,N.m)(new B.n,{Id:String.format("{0}{1}_{2}",e.SymbolIdPrefix,a,s.get_symbolCharacter()),Character:s.get_symbolCharacter(),Command:"3966968829",QueryCommand:"816646517",Alt:j.l.xmlEncode(s.get_altText())});n.GalleryItems.push(l)}return Array.add(t.ControlList,n),t},e.NoOfPositionPerRow=5,e.NoOfSymbolsInDropdown=25,e.SymbolIdPrefix="symbol_",e.SymbolIdPrefixInDialog="symbol_d_",e.SourceControlIdPropertyName="SourceControlId",e.SymbolGalleryButtonFormattableString='<div class="SymbolButtonInnerHTML" aria-hidden="true" style="color: black">{0}</div>',e.SymbolsPerLineInDialog=15,e}();(0,r.l)(q,"e528823a$SymbolsUiBuilder",null,[a]);var z=n(6654),K=n(2735),Q=n(5910),Z=n(7852),J=n(842);n.d(t,{Box4SymbolsPackage:function(){return X}});var X=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"Box4.Symbols"},e.prototype.init=function(){c.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("InsertSymbolIsEnabled")&&this._container.resolve(i).registerActions()},e.prototype.dispose=function(){},e.prototype.configure=function(e){var t=this;this._container=e,this._container.register(L).as(o).singleInstance(),this._container.register(q).as(a).singleInstance().usingFactory((function(){return new q(t._container.resolve(o))})),this._container.register(U).as(i).singleInstance().usingFactory((function(){return new U(c.AFrameworkApplication.get_theActionManager(),new Z.c,new J.b,t._container.resolve(a),K.k.get_instance(),Q.n.get_instance(),z.SelectionManager.get_instance(),t._container.resolveFuture(s.i))}))},e.main=function(){d.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(X,"8b0f173c$Box4SymbolsPackage",null,[l.u,u.s])},7499:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("e68dd2bd$ICommandEventsCache"),o=n(9910),a=n(8391),s=n(6935),l=function(){function e(){}return e.contextToString=function(t){for(var n=[];t;)Array.add(n,e.SeralizeContextLevel(t)),t=t.get_nextContext();return n.reverse(),"{"+n.join(", ")+"}"},e.SeralizeContextLevel=function(e){return"{ContextId:"+e.get_contextId()+", IsGraphNodeContext:"+e.get_isGraphNodeContext()+"}"},e}();(0,r.l)(l,"f128b0bb$ContextSerializer",null,[]);var u=(0,r.y)("88523604$IReadableCorrelationRecord"),c=function(){function e(){this.$$pf_SessionId=null,this.$$pf_InteractionId=null}return e.prototype.get_sessionId=function(){return this.$$pf_SessionId},e.prototype.set_sessionId=function(e){return this.$$pf_SessionId=e,e},e.prototype.get_interactionId=function(){return this.$$pf_InteractionId},e.prototype.set_interactionId=function(e){return this.$$pf_InteractionId=e,e},e}();(0,r.l)(c,"97489e75$CorrelationRecord",null,[u]);var d=function(){function e(e){this._record=null,this._record=e}return e.prototype.buildErrorDictionary=function(e){return{SessionID:this._record.get_sessionId(),CorrelationID:this._record.get_interactionId(),Time:(new Date).getTime(),ErrorMessage:e}},e}();(0,r.l)(d,"e87f2cc$ErrorLogger",null,[]);var p=function(){function e(e,t){this._logger=null,this._inSearchBox=!1,this._menuLaunched=!1,this._skipEndLogging=!1,this._isSimplifiedReactRibbonUx=!1,this._controlsToSkipEndLogging=null,this._logger=e,this._inSearchBox=!1,this._menuLaunched=!1,this._skipEndLogging=!1,this._isSimplifiedReactRibbonUx=!1,this._controlsToSkipEndLogging=t}return e.prototype.get_record=function(){return this._logger.get_record()},e.prototype.beginQuery=function(e,t){this._logger.logQuery(e,t)},e.prototype.endQuery=function(e,t,n){this._logger.logResponse(e,n),this._logger.logParameters(t,n)},e.prototype.onInputFocus=function(e){this._logger.beginCorrelation(e),this._inSearchBox=!0,this._skipEndLogging=!1},e.prototype.onInputBlur=function(){this._inSearchBox=!1,this._menuLaunched||this._logger.endCorrelation()},e.prototype.onCommandExecution=function(e,t,n,r,i){this._isSimplifiedReactRibbonUx;for(var o=0,a=this._controlsToSkipEndLogging;o<a.length;o++){var s=a[o];if(e.startsWith(s)){this._skipEndLogging=!0;break}}this._logger.logCommandExecution(e,t,n,r,i)},e.prototype.onMenuClose=function(){this._menuLaunched=!1,this._inSearchBox||this._skipEndLogging||this._logger.endCorrelation()},e.prototype.onMenuOpen=function(e){this._logger.logMenuLaunch(e),this._menuLaunched=!0},e.prototype.onInteractionBegin=function(e,t){this._isSimplifiedReactRibbonUx=t,this._logger.setParentSurface(t?s.CuiHelper.simplifiedTellMeSearchBoxId:s.CuiHelper.tellMeSearchBoxId),e.length>0&&this._logger.logCommandClickedEvents(e,t)},e.prototype.logSessionFlags=function(e){this._logger.logAppSessionContextFlags(e)},e.prototype.onRequestComplete=function(e,t,n,r,i,o,a,s){this._logger.logLatency(e,t,n,r,i,o,a,s)},e}();(0,r.l)(p,"f0b3de8e$InteractionLogger",null,[]);var g=(0,r.y)("e0e5288e$IControlsManager"),h=n(2433),_=n(4381),f=n(6378),m=function(){function e(e,t,n,r,i){this._searchHelpCommandString=null,this._searchHelpAltCommandString=null,this._testHookEnabled=!1,this._helpOnHelpEnabled=!1,this._ignoreQueryForHelp=!1,this._searchHelpCommandString=e,this._searchHelpAltCommandString=t,this._testHookEnabled=n,this._helpOnHelpEnabled=r,this._ignoreQueryForHelp=i}return e.prototype.get_resultBindingType=function(){return 0},e.prototype.createMenuItem=function(t,n){var r=n.get_sessionId()+"|"+n.get_interactionId()+"|"+t.value;if(this._ignoreQueryForHelp||this._helpOnHelpEnabled){var i=this._ignoreQueryForHelp||f.l.toUpper(CommonUIStrings.l_HelpTooltip)===f.l.toUpper(t.value.trim());if(this._testHookEnabled&&t.value.length>2){var o=t.value;";"===o.charAt(0)&&";"===o.charAt(o.length-1)&&o.substring(1,o.length-1)===e.helpButtonId&&(i=!0)}var a=i?CommonUIStrings.l_HelpButtonTextNoPlaceholder:String.format(CommonUIStrings.l_HelpButtonTextWithQuotation,t.value);return this.generateSearchHelpButtonXml(r,f.l.xmlEncode(a),i)}return this.generateSearchHelpButtonXml(r,f.l.xmlEncode(String.format(CommonUIStrings.l_HelpButtonTextWithQuotation,t.value)),!1)},e.prototype.generateSearchHelpButtonXml=function(t,n,r){return _.s.buildButtonXml(e.helpButtonId,r?this._searchHelpAltCommandString:this._searchHelpCommandString,n,e.HelpButtonIcon,"A0",f.l.xmlEncode(t),n,null,null)},e.helpButtonId="bSearchHelp",e.helpButtonSimplifiedId="GetHelpFromTellMe",e.HelpButtonIcon="OfficeAssistant_16x16x32",e}();(0,r.l)(m,"2d7fe98f$AssistanceMenuItemFactory",null,[h.p]);var y=n(2575),v=n(9354),S=function(){function e(){}return e.prototype.get_resultBindingType=function(){return 3},e.prototype.createMenuItem=function(t,n){return e.BuildFirstRunButton()},e.BuildFirstRunButton=function(){return _.s.buildButtonXmlEx(e.firstRunButtonId,"798637440",f.l.xmlEncode(CommonUIStrings.l_LookupFirstRunExperienceTitle),y.AFrameworkApplication.get_imageClusterPath(),v.ImageClusteringHelper.getImageClass(e.FirstRunIcon),null,null,f.l.xmlEncode(CommonUIStrings.l_LookupFirstRunExperienceTitle),"Menu32",null,null,f.l.xmlEncode(CommonUIStrings.l_LookupFirstRunExperienceDescription),null,null,!0,null,null,null,null,null,null,null)},e.firstRunButtonId="bTellMeFirstRun",e.FirstRunIcon="Info_32x32x32",e}();(0,r.l)(S,"c8b8097a$FirstRunMenuItemFactory",null,[h.p]);var I=n(3803),C=function(){function e(e){this._insightsButtonText=null,this._insightsButtonText=e||CommonUIStrings.l_InsightsButtonText}return e.prototype.get_resultBindingType=function(){return 4},e.prototype.createMenuItem=function(e,t){var n=e.value,r="";r=y.AFrameworkApplication.smartLookupIsEnabled?I.q.createSerializedSmartLookupApplicationInterface(n,null,1):I.q.createSerializedInsightsParameters(n);var i=String.format(this._insightsButtonText,n);return this.generateInsightsButtonXml(r,i)},e.prototype.generateInsightsButtonXml=function(t,n){return _.s.buildButtonXml(e.insightsButtonId,y.AFrameworkApplication.smartLookupIsEnabled?"606289265":"3317204163",f.l.xmlEncode(n),I.q.get_insightsIcon(),null,f.l.xmlEncode(t),f.l.xmlEncode(n),null,null)},e.insightsButtonId="bInsights",e.insightsButtonSimplifiedId="SmartLookupFromTellMe",e}();(0,r.l)(C,"c5eac1c$InsightsMenuItemFactory",null,[h.p]);var T=function(){function e(e,t){this._noResultsImageName=null,this._noResultsDescription=null,this._noResultsImageName=e,this._noResultsDescription=t||CommonUIStrings.l_LookupNoResultsDescription}return e.prototype.get_resultBindingType=function(){return 5},e.prototype.createMenuItem=function(e,t){var n=String.format(this._noResultsDescription,e.value);return this.buildNoResultsButton(n)},e.prototype.buildNoResultsButton=function(t){return _.s.buildButtonXmlEx(e.noResultsId,"798637440",f.l.xmlEncode(CommonUIStrings.l_LookupNoResultsTitle),this._noResultsImageName?y.AFrameworkApplication.get_imageClusterPath():null,this._noResultsImageName,null,null,f.l.xmlEncode(CommonUIStrings.l_LookupNoResultsTitle),"Menu32",null,null,f.l.xmlEncode(t),null,null,!0,null,null,null,null,null,null,null)},e.noResultsId="lookupNoResults",e}();(0,r.l)(T,"8d44d10a$NoCommandsFoundMenuItemFactory",null,[h.p]);var b=n(5083),A=function(){function e(e,t){this._maxSize=0,this._isSimplifiedRibbonUxEnabled=!1,this._mruControlNames=[],this._maxSize=e,this._isSimplifiedRibbonUxEnabled=t}return e.prototype.getControlIds=function(){return this._mruControlNames},e.prototype.resetMaxSize=function(e){this._maxSize=e},e.prototype.IsControlSupportedForMRU=function(e){var t=e.ControlId;return!this.IsAppForOfficeControl(t)&&(e.ParentControlId&&e.ParentControlId!==s.CuiHelper.tellMeSearchBoxId&&(t=e.ParentControlId),(!this._isSimplifiedRibbonUxEnabled||t!==m.helpButtonSimplifiedId&&t!==C.insightsButtonId&&!t.startsWith(I.q.get_tryQueryIdSimplified()))&&(t!==m.helpButtonId&&t!==S.firstRunButtonId&&t!==C.insightsButtonId&&t!==T.noResultsId&&!t.startsWith(I.q.get_tryQueryId())&&!!this.isCommandSupportedForMRU(t)))},e.prototype.addControl=function(e){var t=e.ControlId;this.IsControlSupportedForMRU(e)&&(e.ParentControlId&&e.ParentControlId!==s.CuiHelper.tellMeSearchBoxId&&(t=e.ParentControlId),t=this.RemoveUnwantedPrefix(t),this.RemoveOlderInstance(t),this.OverflowIfFull(),Array.insert(this._mruControlNames,0,t))},e.prototype.isControlExistsInMRU=function(e){if(!this.IsControlSupportedForMRU(e))return!1;var t=e.ControlId;return e.ParentControlId&&e.ParentControlId!==s.CuiHelper.tellMeSearchBoxId&&(t=e.ParentControlId),t=this.RemoveUnwantedPrefix(t),Array.contains(this._mruControlNames,t)},e.prototype.RemoveOlderInstance=function(e){var t=Array.indexOf(this._mruControlNames,e);t>=0&&Array.removeAt(this._mruControlNames,t)},e.prototype.RemoveUnwantedPrefix=function(e){return e.startsWith("m_excelWebRenderer_ewaCtl_")?e.substr("m_excelWebRenderer_ewaCtl_".length,e.length):e},e.prototype.OverflowIfFull=function(){this._mruControlNames.length===this._maxSize&&Array.removeAt(this._mruControlNames,this._mruControlNames.length-1)},e.prototype.IsAppForOfficeControl=function(e){var t=e.split("|"),n="";if(t.length>=6)n=t[0];else if(t.length>=3){if("3"===t[0])return!0;n=t[1]}return n.startsWith("WA")},e.prototype.isCommandSupportedForMRU=function(e){switch(e){case"AnswerForSearch":return!1}return!0},e.createInstance=function(){return new e(b.s.maxResults,!!y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled())},e}();(0,r.l)(A,"ccd7822d$MruControlsManager",null,[g]);var M=(0,r.y)("92e7d3e6$IParameterizedCommandManager"),P=function(){function e(e){this._parameterData=null,this._parameterData=e}return e.prototype.createMenuItem=function(e,t){var n=null;return e.parameterValue&&(n=this._parameterData[e.value])?n.createMenuItem(e,t):(n=this.GetCommandByParameterizedId(e.value))?n.createMenuItem(n.get_mostRecentClickedResult(),t):null},e.prototype.getParameterValueForCommand=function(e,t){var n=this._parameterData[e];if(n)for(var r=0,i=t;r<i.length;r++){var o=i[r],a=I.q.getParameter(o);if(a.get_key()===n.get_parameterType())return a.get_value()}return null},e.prototype.notifyCommandClicked=function(e){var t=this.GetCommandByParameterizedId(e);t&&t.notifyClicked()},e.prototype.GetCommandByParameterizedId=function(e){var t=e.indexOf(I.q.get_parameterId());return t>0?this._parameterData[e.substring(0,t)]:null},e}();(0,r.l)(P,"2133cb2f$ParameterizedCommandManager",null,[M]);var F=function(){return function(){this.queryText=""}}();(0,r.l)(F,"c34bafee$TellMeQuery",null,[]);var w=n(3572),R=function(){function e(){}return e.mru="mru",e.query="query",e.parameterQuery="parameterQuery",e.test="test",e.tryQuery="tryQuery",e.tryCommand="tryCommand",e}();(0,r.l)(R,"4a54f44e$Sources",null,[]);var E=function(){return function(e,t,n){this.id=null,this.legacyId=null,this.timeElapsedSinceClick=0,this.id=e,this.legacyId=t,this.timeElapsedSinceClick=n}}();(0,r.l)(E,"f62184f6$CommandClickedEvent",null,[]);var k=n(4741),D=function(){function e(e,t){this._tellMeActor=null,this._requestNumber=0,this._tellMeActor=e,this._requestNumber=t}return e.prototype.resultsUpdated=function(e){this._tellMeActor.OnRequestCompleted(e.get_query().queryText,e.get_resultGroups(),e.get_attributes(),this._requestNumber)},e}();(0,r.l)(D,"d9c596f4$ResultsUpdatedCallback",null,[k.k]);var O,U=n(5214),x=n(6720),L=function(){function e(e,t,n){this.menuModel=null,this.resultCount=0,this.displayedTryQueries=null,this.menuModel=e,this.resultCount=t,this.displayedTryQueries=n}return e.prototype.get_displayedTryQueries=function(){return this.displayedTryQueries},e}();(0,r.l)(L,"c9aee353$GeneratedMenuModel",null,[]),function(e){e[e.command=0]="command",e[e.contentArea=1]="contentArea",e[e.docFind=2]="docFind",e[e.recentlyUsed=3]="recentlyUsed",e[e.tryQuery=4]="tryQuery",e[e.empty=5]="empty",e[e.tryCommand=6]="tryCommand",e[e.help=7]="help",e[e.answer=8]="answer",e[e.definition=9]="definition",e[e.entity=10]="entity",e[e.none=11]="none"}(O||(O={})),(0,r.h)("51f70ad3$ResultGroupType",O);var N=function(){return function(){this.title=null,this.sections=null}}();(0,r.l)(N,"f5f0b691$MenuModel",null,[]);var B=function(){function e(e,t,n){this._applicationData=null,this._updateRibbonControls=null,this._parameterData=null,this._applicationData=e,this._parameterData=t,this._updateRibbonControls=n}return e.prototype.generateTellMeMenuDefinition=function(e,t){var n=0,r=0,i=new N,o=[];i.sections=new Array(0);for(var a=0,s=e;a<s.length;a++){for(var l=s[a],u=(I.q.get_tellMeDisplayMode(),new x.c(String)),c=new x.c(String),d=new x.c(String),p=0,g=l.get_results();p<g.length;p++){var h=g[p];if(h.value.indexOf(I.q.get_simplifiedUxParameterizedSuffix())>=0){if(h.parameterValue){var _=this._parameterData[h.value];if(_&&h.value.endsWith(I.q.get_simplifiedUxParameterizedSuffix())){var f=new Array(0);f.push(appChrome.actions.setControlLabel(h.value,_.getLabelFromResult(h))),f.push(appChrome.actions.setButtonCommandValueId(h.value,_.getCommandValueIdFromResult(h))),appChrome.api.dispatch(f);var m=h.value.replace(I.q.get_simplifiedUxParameterizedSuffix(),"");c.remove(m)||d.add(m),c.add(h.value),r++}}}else 1!==h.type||d.contains(h.value)?4!==h.type&&h.type&&12!==h.type&&13!==h.type&&14!==h.type?11===h.type&&c.add(h.parameterValue):c.add(h.value):(c.add(h.value),r++)}if(c.get_count()>0){if(this._updateRibbonControls){for(var y={},v=c.$$lge();v.$$mn();){var S=v.$$cu();y[S]=appChrome.selectors.getModelType(S)}this._updateRibbonControls(y)}var C=appChrome.api.menuSection(c.toArray(),l.get_displayName(),null,O[l.getGroupType()]);o.push(C)}if(u.get_count()>0){C=appChrome.api.menuSection(u.toArray(),l.get_displayName(),null,O[l.getGroupType()]);o.push(C)}n=n||c.get_count()}var T=null;return r>0&&(T=1!==r?String.format(CommonUIStrings.l_LookupLiveNotificationResultPluralFormText,r):CommonUIStrings.l_LookupLiveNotificationResultSingularFormText),appChrome.api.dispatch(appChrome.actions.updateTellMeAriaLiveRegionText(T)),i.sections=o,new L(i,n,[])},e.get_emptyMenuModel=function(){return e._emptyMenuModel||(e._emptyMenuModel=new L((0,U.m)(new N,{sections:new Array(0)}),0,new Array(0)))},e._emptyMenuModel=null,e}();(0,r.l)(B,"78e9a785$TellMeMenuDefintionGenerator",null,[]);var H=n(5541),$=function(){function e(e,t,n){this.xml=null,this.resultCount=0,this.displayedResults=null,this.xml=e,this.resultCount=t,this.displayedResults=n}return e.prototype.get_displayedResults=function(){return this.displayedResults},e}();(0,r.l)($,"1b0f9125$GeneratedMenuXml",null,[]);var G=function(){function e(){this._AnswerTitleText=null,this._AnswerTitleText="Answer"}return e.prototype.get_resultBindingType=function(){return 12},e.prototype.createMenuItem=function(e,t){var n=e.parameterValue,r=f.l.xmlEncode(e.value),i=f.l.xmlEncode(n),o=f.l.xmlEncode(String.format(this._AnswerTitleText,n));return this.generateAnswerButtonXml(r,i,o)},e.prototype.generateAnswerButtonXml=function(e,t,n){return _.s.buildButtonXml(e,null,null,null,null,null,null,null,null)},e}();(0,r.l)(G,"abc08b15$AnswerMenuItemFactory",null,[h.p]);var W=function(){function e(e,t){this._controlMetadata=null,this._parameterizedCommandManager=null,this._controlMetadata=e||{},this._parameterizedCommandManager=t}return e.prototype.get_resultBindingType=function(){return 1},e.prototype.createMenuItem=function(e,t){return this._parameterizedCommandManager.createMenuItem(e,t)||this.BuildClonedControlWithOverrides(e.value)},e.prototype.BuildClonedControlWithOverrides=function(t){var n=this._controlMetadata[t]||null;return e.BuildClonedControl(t,n)},e.BuildClonedControl=function(e,t){var n='<ClonedControl Id="{0}" ';for(var r in n=String.format(n,e),t){var i={key:r,value:t[r]},o=i.value?f.l.xmlEncode(i.value.toString()):"";n+=String.format('{0}="{1}" ',i.key,o)}return n+="/>"},e}();(0,r.l)(W,"8070fb2e$CommandMenuItemFactory",null,[h.p]);var V=function(){function e(){this._DefinitionTitleText=null,this._DefinitionTitleText="Definition"}return e.prototype.get_resultBindingType=function(){return 13},e.prototype.createMenuItem=function(e,t){var n=e.parameterValue,r=f.l.xmlEncode(e.value),i=f.l.xmlEncode(n),o=f.l.xmlEncode(String.format(this._DefinitionTitleText,n));return this.generateDefinitionButtonXml(r,i,o)},e.prototype.generateDefinitionButtonXml=function(e,t,n){return _.s.buildButtonXml(e,null,null,null,null,null,null,null,null)},e}();(0,r.l)(V,"d8f8411c$DefinitionMenuItemFactory",null,[h.p]);var j=function(){function e(){this._findInDocumentButtonText=null,this._findInDocumentButtonText=CommonUIStrings.l_FindInDocumentText}return e.prototype.get_resultBindingType=function(){return 7},e.prototype.createMenuItem=function(e,t){var n=e.parameterValue,r=f.l.xmlEncode(e.value),i=f.l.xmlEncode(n),o=f.l.xmlEncode(String.format(this._findInDocumentButtonText,n));return this.generateFindInDocumentButtonXml(r,i,o)},e.prototype.generateFindInDocumentButtonXml=function(e,t,n){return _.s.buildButtonXml(e,"1540292897",n,I.q.get_findInDocumentIcon(),null,t,n,null,null)},e}();(0,r.l)(j,"7fe63744$FindInDocumentMenuItemFactory",null,[h.p]);var q=function(){function e(e){this._controlMetadata=null,this._controlMetadata=e||{}}return e.prototype.get_resultBindingType=function(){return 2},e.prototype.createMenuItem=function(e,t){return this.BuildClonedControlWithOverrides(e.value)},e.prototype.BuildClonedControlWithOverrides=function(t){var n=this._controlMetadata[t]||null;return e.BuildClonedControl(t,n)},e.BuildClonedControl=function(e,t){var n='<ClonedControl Id="{0}" ';for(var r in n=String.format(n,e),t){var i={key:r,value:t[r]},o=i.value?f.l.xmlEncode(i.value.toString()):"";n+=String.format('{0}="{1}" ',i.key,o)}return n+="/>"},e}();(0,r.l)(q,"53fe7639$HeroMenuItemFactory",null,[h.p]);var z=function(){function e(){}return e.prototype.get_resultBindingType=function(){return 11},e.prototype.createMenuItem=function(e,t){var n=(0,H.e)(w.y,e);return this.generateTryQueryButtonXml(f.l.xmlEncode(e.value),n.id)},e.prototype.generateTryQueryButtonXml=function(e,t){return _.s.buildButtonXml(t,"1404166600",e,null,null,e,e,null,null)},e}();(0,r.l)(z,"fd043d1c$TryQueryMenuItemFactory",null,[h.p]);var K=function(){function e(e){this._factories=null,this._applicationData=null,this._factories=[],this._applicationData=e}return e.prototype.getFactory=function(e){for(var t=0,n=this._factories;t<n.length;t++){var r=n[t];if(r.get_resultBindingType()===e)return r}return null},e.prototype.registerFactory=function(e){this._factories.push(e)},e.prototype.registerDefaultFactories=function(e){this.registerFactory(new W(this._applicationData.get_controlMetadata(),e)),this.registerFactory(new q(this._applicationData.get_controlMetadata())),this.registerFactory(new T(this._applicationData.get_noResultsImage(),null)),this.registerFactory(new m(this._applicationData.get_searchHelpCommandString(),this._applicationData.get_searchHelpAltCommandString(),this._applicationData.get_testHookIsEnabled(),this._applicationData.get_helpOnHelpIsEnabled(),this._applicationData.get_shouldIgnoreQueryForHelp())),this.registerFactory(new C(null)),this.registerFactory(new j),this.registerFactory(new S),this.registerFactory(new z),this.registerFactory(new G),this.registerFactory(new V),this._applicationData.registerAppSpecificMenuItemFactories(this)},e}();(0,r.l)(K,"7256205c$MenuItemFactoryRegistry",null,[]);var Q=n(904),Z=function(){function e(e,t){this._applicationData=null,this._menuItemFactory=null,this._applicationData=e,this._menuItemFactory=new K(this._applicationData),this._menuItemFactory.registerDefaultFactories(t)}return e.prototype.generateTellMeMenuXml=function(t,n){for(var r=0,i=[],o=[],a=0,s=t;a<s.length;a++){for(var l=s[a],u=I.q.get_tellMeDisplayMode(),c=[],d=[],p=0,g=l.get_results();p<g.length;p++){var h=g[p];if("AnswerForSearch"!==h.value){var f=this._menuItemFactory.getFactory(h.type).createMenuItem(h,n);if(2===h.type){d.push(f);var m=_.s.buildControlsGroupXml("TellMeDropdownControls",d),y=_.s.buildMenuSectionXml("TellMeDropdownMenuSection",m,"Menu32",l.get_displayName(),null,null,null);i.push(y)}else u=I.q.get_tellMeDisplayMode(),c.push(f);3!==h.type&&5!==h.type||(u="Menu32"),9===h.type&&(u="MenuTellMeExtended"),h.groupType=l.getGroupType(),o.push((0,H.e)(Q.b,h))}}r=r||c.length;var v=_.s.buildControlsGroupXml("TellMeDropdownControls",c),S=_.s.buildMenuSectionXml("TellMeDropdownMenuSection",v,u,l.get_displayName(),null,null,null);i.push(S)}var C=_.s.buildMenuXml(i,e.TellMeMenuId);return new $(C,r,o)},e.get_emptyMenuXml=function(){return e._emptyMenuXml||(e._emptyMenuXml=new $(_.s.buildMenuXml(new Array(0),e.TellMeMenuId),0,new Array(0)))},e.TellMeMenuId="LookupDropdownMenu",e._emptyMenuXml=null,e}();(0,r.l)(Z,"e636c4b3$TellMeXmlGenerator",null,[]);var J=(0,r.y)("60aee7d8$IUsageLogger"),X=n(7597),Y=function(){function e(){}return e.appName="AppName",e.closeAllMenus="CloseAllMenus",e.commandId="CommandId",e.context="Context",e.culture="Culture",e.errorMessage="ErrorMessage",e.event="Event",e.interactionId="CorrelationID",e.parentUiElement="ParentUiElement",e.query="Input",e.queryId="QueryID",e.queryLength="QueryLength",e.resultsList="ResultsList",e.sessionId="SessionID",e.source="Source",e.timeStamp="Time",e.uiElement="UiElement",e.isSimplifiedReactRibbonUx="ReactUx",e.value="Val",e.statusCode="StatusCode",e.service="Service",e.isSuccess="IsSuccess",e.tokenAcquired="TokenAcquired",e.latencyType="LatencyType",e}();(0,r.l)(Y,"42be8ea5$Columns",null,[]);var ee=function(){function e(){}return e.click="Click",e.interactionBegin="InteractionBegin",e.interactionEnd="InteractionEnd",e.menuLaunched="MenuLaunched",e.query="Query",e.queryResponse="QueryResponse",e.parameterResponse="ParameterResponse",e.commandClicksRecorded="Clicks",e.sessionContextRecorded="SessionContext",e.latency="Latency",e}();(0,r.l)(ee,"79b72b18$EventNames",null,[]);var te=(0,r.y)("afbb0b2f$IOtelLogger"),ne=n(8768),re=n(8977),ie=n(1120),oe=function(){function e(e,t){this._parentSurface=null,this._triggerMethod=null,this._scope="TellMe",this._internalScope="TellMeWAC.",this._parentSurface=e,this._triggerMethod=t}return e.prototype.sendTellMeUserActionEvent=function(e,t){var n=re.j.dictionaryToDataFields(t,null,null),r=re.j.createUserActionEvent(e,this._parentSurface,this._triggerMethod,this._scope,n,null,null,null,null);ie.k.sendTellMeUserActionEvent(r,this._internalScope)},e.prototype.sendTellMeActivityEvent=function(e,t,n){var r=re.j.dictionaryToDataFields(t,null,null);ie.k.sendTellMeActivityEvent((0,U.m)(new ne.z,{name:e,dataFields:r,durationMs:n}),this._internalScope)},e}();(0,r.l)(oe,"1ef3d73f$TellMeOtelLogger",null,[te]);var ae=n(9641),se=function(){function e(e,t,n,r,i){this._appName=null,this._culture=null,this._record=null,this._parentSurface="",this._otelLogger=null,this._shouldLogQuery=!1,this._appName=e,this._culture=t,this._record=n,this._shouldLogQuery=r,this._otelLogger=i||new oe(this._parentSurface,null)}return e.prototype.setParentSurface=function(e){this._parentSurface=e},e.prototype.get_record=function(){return this._record},e.prototype.beginCorrelation=function(e){this._record.get_interactionId()||(this._record.set_interactionId(ae.l.create().toString()),this.LogBeginCorrelation(e))},e.prototype.endCorrelation=function(){this._record.get_interactionId()&&this.LogEndCorrelation(),this._record.set_interactionId(null)},e.prototype.LogBeginCorrelation=function(e){var t=this.CreateLog(ee.interactionBegin);t[Y.culture]=this._culture,t[Y.appName]=this._appName,t[Y.context]=e,this._otelLogger.sendTellMeUserActionEvent(ee.interactionBegin,t),X.ULS.sendTraceTag(4334090,1300,50,"{0}",t)},e.prototype.LogEndCorrelation=function(){var e=this.CreateLog(ee.interactionEnd);this._otelLogger.sendTellMeActivityEvent(ee.interactionEnd,e,0),X.ULS.sendTraceTag(4334091,1300,50,"{0}",e)},e.prototype.logQuery=function(e,t){var n=this.CreateLog(ee.query);n[Y.query]=this._shouldLogQuery?e:"!",n[Y.queryId]=t,n[Y.queryLength]=e.length,this._otelLogger.sendTellMeUserActionEvent(ee.query,n),X.ULS.sendTraceTag(4334092,1300,50,"{0}",n)},e.prototype.logResponse=function(e,t){var n=this.CreateLog(ee.queryResponse);n[Y.resultsList]=e,n[Y.queryId]=t,this._otelLogger.sendTellMeActivityEvent(ee.queryResponse,n,0),X.ULS.sendTraceTag(4334093,1300,50,"{0}",n)},e.prototype.logLatency=function(e,t,n,r,i,o,a,s){var l=this.CreateLog(ee.latency);l[Y.culture]=this._culture,l[Y.queryLength]=e,l[Y.uiElement]=t,l[Y.statusCode]=n,l[Y.service]=i,l[Y.isSuccess]=o,l[Y.latencyType]=a,s&&(l[Y.tokenAcquired]=s),this._otelLogger.sendTellMeActivityEvent(ee.latency,l,r),X.ULS.sendTraceTag(0,1300,50,"{0}",l)},e.prototype.logParameters=function(e,t){if(e){var n=this.CreateLog(ee.parameterResponse);n[Y.resultsList]=e,n[Y.queryId]=t,this._otelLogger.sendTellMeActivityEvent(ee.queryResponse,n,0),X.ULS.sendTraceTag(17162522,1300,50,"{0}",n)}},e.prototype.logCommandExecution=function(e,t,n,r,i){var o=this.CreateLog(ee.click);o[Y.uiElement]=e,o[Y.parentUiElement]=t,o[Y.commandId]=n,o[Y.closeAllMenus]=r,o[Y.source]=i,this._otelLogger.sendTellMeUserActionEvent(ee.click,o),X.ULS.sendTraceTag(4334094,1300,50,"{0}",o)},e.prototype.logMenuLaunch=function(e){var t=this.CreateLog(ee.menuLaunched);t[Y.queryId]=e,this._otelLogger.sendTellMeActivityEvent(ee.menuLaunched,t,0),X.ULS.sendTraceTag(4334095,1300,50,"{0}",t)},e.prototype.logCommandClickedEvents=function(e,t){var n=this.CreateLog(ee.commandClicksRecorded);n[Y.value]=e,n[Y.isSimplifiedReactRibbonUx]=t,this._otelLogger.sendTellMeUserActionEvent(ee.commandClicksRecorded,n),X.ULS.sendTraceTag(36742614,1300,50,"{0}",n)},e.prototype.logAppSessionContextFlags=function(e){var t=this.CreateLog(ee.sessionContextRecorded);t[Y.value]=e,this._otelLogger.sendTellMeUserActionEvent(ee.sessionContextRecorded,t)},e.prototype.CreateLog=function(e){return{SessionID:this._record.get_sessionId(),CorrelationID:this._record.get_interactionId(),Time:(new Date).getTime(),Event:e}},e}();(0,r.l)(se,"899c851$UsageLogger",null,[J]);var le=n(4764),ue=n(2906),ce=n(1193),de=n(2879),pe=n(1991),ge=n(3608),he=n(8648),_e=n(2192),fe=n(6020),me=n(87),ye=n(3667);n.d(t,{p:function(){return ve}});var ve=function(){function e(){this._applicationData=null,this._resultsProvider=null,this._xmlGenerator=null,this._menuDefintionGenerator=null,this._interactionLogger=null,this._errorLogger=null,this._actionManager=null,this._taskManager=null,this._applicationFeatureHelperFuture=null,this._appSettingsManager=null,this._focusManager=null,this._mruManager=null,this._parameterizedCommandManager=null,this._isZeroTerm=!1,this._isSessionContextFlagsLogged=!1,this._currentlyDisplayedMenuXml=null,this._currentlyDisplayedQuery=null,this._currentDisplayedMenuModel=null,this._cachedRefreshMenuTask=null,this._requestNumber=0,this._menuLaunchingRequestNumber=0,this._commandClickedEvents=[]}return e.prototype.getCommandClickedEvents=function(){return this._commandClickedEvents},e.prototype.getInteractionLogger=function(){return this._interactionLogger},e.prototype.getTellMeSessionId=function(){return this._interactionLogger?this._interactionLogger.get_record().get_interactionId():null},e.prototype.initialize=function(e,t,r,i,o,a,s,l,u){if(this._applicationData=e,this._interactionLogger=i,this._parameterizedCommandManager=new P(this._applicationData.get_parameterData()),this._xmlGenerator=r||new Z(this._applicationData,this._parameterizedCommandManager),this._menuDefintionGenerator=this._menuDefintionGenerator||new B(this._applicationData,this._applicationData.get_parameterData(),s),this._focusManager=le.FocusManager.instance(),this._mruManager=A.createInstance(),this._resultsProvider=t||n(4084).AggregatorResultsProvider.CreateInstance(this._mruManager,this._applicationData,this._parameterizedCommandManager),this._actionManager=o||y.AFrameworkApplication.get_theActionManager(),this._taskManager=a||y.AFrameworkApplication.get_theTaskManager(),this._applicationFeatureHelperFuture=u,this._appSettingsManager=l,!i){var g=new c;g.set_sessionId(y.AFrameworkApplication.userSessionId);var h=he.i.getCultureInfo(y.AFrameworkApplication.lcid)||he.i.get_invariantCulture();this._interactionLogger=new p(new se(this._applicationData.get_application(),h.get_name(),g,e.get_shouldLogQuery(),null),this._applicationData.get_controlsToSkipEndLogging())}this._errorLogger=new d(this._interactionLogger.get_record()),this._currentlyDisplayedMenuXml=Z.get_emptyMenuXml()},e.prototype.registerActions=function(){var t=this;this._appSettingsManager&&!this._appSettingsManager.getBooleanAppSetting(e.OcpsIsEnabled)||!this._applicationFeatureHelperFuture?this.AddTellMeActions():this._applicationFeatureHelperFuture.execute((function(n){n.isFeatureEnabled(e.ConnectedServicesFeature,!0).then((function(e){return e&&t.AddTellMeActions(),null}))}))},e.prototype.AddTellMeActions=function(){this._actionManager.addAction(o.b.tellMe,_e.m.frame,r.i(this,this.tellMe,"tellMe")),this._actionManager.addActionWithFlags(o.b.tellMeCacheAsyncMenuRefresh,_e.m.frame,r.i(this,this.cacheAsyncMenuRefreshFunction,"cacheAsyncMenuRefreshFunction"),96),this._actionManager.addActionWithFlags(o.b.tellMeLogCommandExecuted,_e.m.frame,r.i(this,this.logItemExecuted,"logItemExecuted"),96),this._actionManager.addActionWithFlags(o.b.tellMeLogMenuClose,_e.m.frame,r.i(this,this.logCloseMenu,"logCloseMenu"),96),this._actionManager.addActionWithFlags(o.b.tellMeLogInputFocus,_e.m.frame,r.i(this,this.logInputFocus,"logInputFocus"),96),this._actionManager.addActionWithFlags(o.b.tellMeInteractionBegin,_e.m.frame,r.i(this,this.interactionBegin,"interactionBegin"),96),this._actionManager.addActionWithFlags(o.b.tellMeRestoreFocus,_e.m.frame,r.i(this,this.interactionBegin,"interactionBegin"),96),this._actionManager.addActionWithFlags(o.b.tellMeLogInputBlur,_e.m.frame,r.i(this,this.logInputBlur,"logInputBlur"),96),this._actionManager.addActionWithFlags(o.b.tellMeLogMenuOpen,_e.m.frame,r.i(this,this.logMenuOpen,"logMenuOpen"),96),this._actionManager.addActionWithFlags(o.b.tellMeFocusInput,_e.m.frame,r.i(this,this.focusSearchBox,"focusSearchBox"),96),this._actionManager.addActionWithFlags(o.b.tellMeAccessibilityMenuText,_e.m.frame,r.i(this,this.constructLiveNotificationForMenu,"constructLiveNotificationForMenu"),96),this._actionManager.addActionWithFlags(o.b.tellMeTryQuery,_e.m.frame,r.i(this,this.insertTryQuery,"insertTryQuery"),96)},e.prototype.registerActionsDeferred=function(t){var n=this;this._appSettingsManager&&!this._appSettingsManager.getBooleanAppSetting(e.OcpsIsEnabled)||!this._applicationFeatureHelperFuture?this.RegisterDispatchHandlerAndEnqueueActions(t):this._applicationFeatureHelperFuture.execute((function(r){r.isFeatureEnabled(e.ConnectedServicesFeature,!0).then((function(e){return e&&n.RegisterDispatchHandlerAndEnqueueActions(t),null}))}))},e.prototype.RegisterDispatchHandlerAndEnqueueActions=function(e){ge.z.registerDispatchHandler(r.i(this,this.Dispatcher,"Dispatcher")),ge.z.enqueueActions([new pe.f(o.b.tellMe,_e.m.frame,96),new pe.f(o.b.tellMeCacheAsyncMenuRefresh,_e.m.frame,96),new pe.f(o.b.tellMeLogCommandExecuted,_e.m.frame,0),new pe.f(o.b.tellMeLogMenuClose,_e.m.frame,0),new pe.f(o.b.tellMeLogInputFocus,_e.m.frame,96),new pe.f(o.b.tellMeInteractionBegin,_e.m.frame,96),new pe.f(o.b.tellMeRestoreFocus,_e.m.frame,96),new pe.f(o.b.tellMeLogInputBlur,_e.m.frame,96),new pe.f(o.b.tellMeLogMenuOpen,_e.m.frame,0),new pe.f(o.b.tellMeFocusInput,_e.m.frame,0),new pe.f(o.b.tellMeAccessibilityMenuText,_e.m.frame,96),new pe.f(o.b.tellMeTryQuery,_e.m.frame,0)],e)},e.prototype.Dispatcher=function(e,t,n,r,i){if(t.get_contextId()===_e.m.frame)switch(e){case o.b.tellMe:return this.tellMe(e,t,n,r,i);case o.b.tellMeCacheAsyncMenuRefresh:return this.cacheAsyncMenuRefreshFunction(e,t,n,r,i);case o.b.tellMeLogCommandExecuted:return this.logItemExecuted(e,t,n,r,i);case o.b.tellMeLogMenuClose:return this.logCloseMenu(e,t,n,r,i);case o.b.tellMeLogInputFocus:return this.logInputFocus(e,t,n,r,i);case o.b.tellMeInteractionBegin:return this.interactionBegin(e,t,n,r,i);case o.b.tellMeRestoreFocus:return this.restoreFocus(e,t,n,r,i);case o.b.tellMeLogInputBlur:return this.logInputBlur(e,t,n,r,i);case o.b.tellMeLogMenuOpen:return this.logMenuOpen(e,t,n,r,i);case o.b.tellMeFocusInput:return this.focusSearchBox(e,t,n,r,i);case o.b.tellMeAccessibilityMenuText:return this.constructLiveNotificationForMenu(e,t,n,r,i);case o.b.tellMeTryQuery:return this.insertTryQuery(e,t,n,r,i)}return 2},e.prototype.focusSearchBox=function(e,t,n,r,i){if(1===n)return 32;if(this.SetRibbonScope(),!y.AFrameworkApplication.get_activeFrame()||!y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSharedHeaderSearchUxEnabled())return le.FocusManager.tryFocus($get(this._applicationData.get_isSimplifiedReactRibbonUxEnabled()?s.CuiHelper.simplifiedTellMeSearchBoxId:s.CuiHelper.tellMeSearchBoxId))?32:8;for(var o=document.getElementsByClassName("ms-suiteux-search-box"),a=0;a<o.length;a++){var l=o[a].querySelector("input[type=search]");if(l)return le.FocusManager.tryFocus(l)?32:8}return 8},e.prototype.insertTryQuery=function(e,t,n,r,i){if(1===n)return 32;this.SetRibbonScope();var o=i,a=o.CommandValueId,l=this._applicationData.get_isSimplifiedReactRibbonUxEnabled()?s.CuiHelper.simplifiedTellMeSearchBoxId:s.CuiHelper.tellMeSearchBoxId;if(this._applicationData.get_isSimplifiedReactRibbonUxEnabled()&&this._applicationData.get_moveFocusAfterCommandIsEnabled()&&!me.n.isNullOrUndefined(o[ce.z.shouldCanvasTakeFocus])&&(o[ce.z.shouldCanvasTakeFocus]=!1),a){if(this._applicationData.get_isSimplifiedReactRibbonUxEnabled())return le.FocusManager.tryFocus($get(l))?(this.ExecuteTellMeQuery(a),32):8;var u=$get(l);u&&(u.value=a)}return le.FocusManager.tryFocus($get(l))?32:8},e.prototype.SetRibbonScope=function(){this._focusManager.pushScope(this._applicationData.get_ribbonFocusScopeName(),!1)},e.prototype.GetAccessibleStringForResult=function(e,t){switch(e){case 0:return String.format(CommonUIStrings.l_TellMeClassifierCommandAccessibleLabelFormat,t);case 3:return String.format(CommonUIStrings.l_TellMeRecentlyUsedAccessibleLabelFormat,t);case 4:return String.format(CommonUIStrings.l_TellMeTryQueryAccessibleLabelFormat,t);case 6:return String.format(CommonUIStrings.l_TellMeTryCommandAccessibleLabelFormat,t)}return t},e.prototype.constructLiveNotificationForMenu=function(e,t,n,i,o){if(1===n)return 32;var a=o,s=this._currentlyDisplayedMenuXml?this._currentlyDisplayedMenuXml.resultCount:0;if(a.Value=1!==s?String.format(CommonUIStrings.l_LookupLiveNotificationResultPluralFormText,s):CommonUIStrings.l_LookupLiveNotificationResultSingularFormText,this._currentlyDisplayedMenuXml)for(var l=0,u=this._currentlyDisplayedMenuXml.get_displayedResults();l<u.length;l++){var c=u[l],d="";d=r.r(w.y,c)?c.id:f.l.replaceAll(c.value,'"',"");var p=$get(d+"-"+I.q.get_tellMeDisplayMode());p&&fe.t.setAriaAttribute(p,fe.t.ariaLabelAttribute,f.l.xmlEncode(this.GetAccessibleStringForResult(c.groupType,p.innerText)))}return 32},e.prototype.cacheAsyncMenuRefreshFunction=function(e,t,n,r,i){return 1!==n&&(this._cachedRefreshMenuTask=new de.c(2,1,0,(function(){i[ue.o.Callback]()}),97,null,!1),this._currentlyDisplayedMenuXml&&this._taskManager.addTask(this._cachedRefreshMenuTask)),32},e.prototype.logItemExecuted=function(e,t,n,r,i){if(i){var o=i;if(o.CloseAllMenus){var a=o.ControlId.startsWith(this._applicationData.get_isSimplifiedReactRibbonUxEnabled()?I.q.get_tryQueryIdSimplified():I.q.get_tryQueryId()),s=this._isZeroTerm&&this._mruManager.isControlExistsInMRU(o),l=this._isZeroTerm&&!s&&!a,u=this.DetermineSource(a,s,o.ControlId.endsWith(I.q.get_parameterId()),l);this._interactionLogger.onCommandExecution(o.ControlId,o.ParentControlId,o.CommandId,o.CloseAllMenus,u),this._parameterizedCommandManager.notifyCommandClicked(o.ControlId),this._mruManager.addControl(o)}}return 32},e.prototype.logCloseMenu=function(e,t,n,r,i){return this._interactionLogger.onMenuClose(),this._applicationData.get_isSimplifiedReactRibbonUxEnabled()&&(this._currentDisplayedMenuModel=null,this._interactionLogger.onInputBlur()),32},e.prototype.logInputFocus=function(e,t,n,r,i){return this._interactionLogger.onInputFocus(l.contextToString(t)),32},e.prototype.logInputBlur=function(e,t,n,r,i){return this._interactionLogger.onInputBlur(),32},e.prototype.logMenuOpen=function(e,t,n,r,i){return this._interactionLogger.onMenuOpen(this._menuLaunchingRequestNumber),32},e.prototype.generateCommandClickedBuffer=function(t){if(!t.get_count())return"";for(var n=[],r="",i=t.$$lge();i.$$mn();){var o=i.$$cu(),a=o.get_parentMenuId();!isNullOrUndefined(a)&&a.length&&"sbTellMe"!==a||(a=o.get_controlId());var s=(Date.now()-o.get_time())/1e3;s=e.TruncateToSignificantDigits(s,5),r.length>0&&(r+=";"),r+=a,r+=":",r+=s.toString(),Array.add(n,new E(a,o.get_legacyId(),s))}return this._commandClickedEvents=n,r},e.prototype.OnInteractionBegin=function(){if(this._isZeroTerm=!0,!this._isSessionContextFlagsLogged){this._isSessionContextFlagsLogged=!0;var e={};e.IsSLREnabled=this._applicationData.get_isSimplifiedReactRibbonUxEnabled(),e.IsSharedHeaderEnabled=!!y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactSharedHeaderUxEnabled(),e.IsSearchUxEnabled=!!y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSharedHeaderSearchUxEnabled(),e.IsTellMeServiceResultsEnabled=!!y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isTellMeServiceResultsForSearchEnabled(),e.ShouldFetchTokens=!!y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_shouldFetchTokensForSearch(),e.SmartLookupIsEnabled=this._applicationData.get_smartLookupIsEnabled(),this._interactionLogger.logSessionFlags(JSON.stringify(e))}var t=this.generateCommandClickedBuffer(a.a.get_instance().getCommandClicks());this._interactionLogger.onInteractionBegin(t,this._applicationData.get_isSimplifiedReactRibbonUxEnabled())},e.prototype.interactionBegin=function(e,t,n,r,i){if(1===n)return 32;if(ye.y.get_isInternetExplorer11Up())return 32;this.OnInteractionBegin();var o=new D(this,0);return this._currentlyDisplayedMenuXml=Z.get_emptyMenuXml(),this._currentDisplayedMenuModel=B.get_emptyMenuModel(),this._resultsProvider.issueQuery(new F,o,this._applicationData.get_isSimplifiedReactRibbonUxEnabled()),this._cachedRefreshMenuTask&&this._taskManager.addTask(this._cachedRefreshMenuTask),32},e.prototype.restoreFocus=function(e,t,n,r,i){return this._focusManager.popScope(this._applicationData.get_ribbonFocusScopeName(),!0),32},e.prototype.tellMe=function(e,t,n,r,i){if(1===n)return 32;var o=i,a=o.Value;return this._applicationData.get_isSimplifiedReactRibbonUxEnabled()||a&&""!==a.trim()?(!this._currentDisplayedMenuModel&&this._applicationData.get_isSimplifiedReactRibbonUxEnabled()&&(this._interactionLogger.onInputFocus(l.contextToString(t)),this.OnInteractionBegin()),this.ExecuteTellMeQuery(a),o.PopulationXML=this._currentlyDisplayedMenuXml.xml):this._isZeroTerm?o.PopulationXML=this._currentlyDisplayedMenuXml.xml:(o.PopulationXML=Z.get_emptyMenuXml().xml,this._currentDisplayedMenuModel=B.get_emptyMenuModel(),this._currentlyDisplayedQuery=""),32},e.prototype.ExecuteTellMeQuery=function(e){if(this._applicationData.get_isSimplifiedReactRibbonUxEnabled()&&appChrome.api.dispatch(appChrome.actions.updateTellMeSearchText(e)),e&&e.trim().length>0&&(this._isZeroTerm=!1),this._applicationData.ensureTrimmedIdsAreSet(),e!==this._currentlyDisplayedQuery||this._applicationData.get_isSimplifiedReactRibbonUxEnabled()){this._applicationData.get_isSimplifiedReactRibbonUxEnabled()&&!this._currentDisplayedMenuModel||this._interactionLogger.beginQuery(e,this._requestNumber);var t=new F;t.queryText=e;var n=new D(this,this._requestNumber);this._currentlyDisplayedMenuXml=Z.get_emptyMenuXml(),this._currentDisplayedMenuModel=B.get_emptyMenuModel(),this._resultsProvider.issueQuery(t,n,this._applicationData.get_isSimplifiedReactRibbonUxEnabled()),this._menuLaunchingRequestNumber=this._requestNumber,this._currentlyDisplayedQuery=e,this._requestNumber++}},e.prototype.LogReturnedCommands=function(e,t,n){for(var r=[],i=0,o=e.get_results();i<o.length;i++){var a=o[i];1===a.type&&r.push(a.value)}var s=null;if(t){for(var l=[],u=0,c=t;u<c.length;u++){var d=c[u],p=I.q.getParameter(d);l.push(p.get_key())}s=l.length>0?"{"+l.join(", ")+"}":null}this._interactionLogger.endQuery("{"+r.join(", ")+"}",s,n)},e.prototype.OnRequestCompleted=function(e,t,n,r){""!==e&&this.LogReturnedCommands(t[0],n,r),this._currentlyDisplayedMenuXml=this._xmlGenerator.generateTellMeMenuXml(t,this._interactionLogger.get_record()),this._applicationData.get_isSimplifiedReactRibbonUxEnabled()&&(this._currentDisplayedMenuModel=this._menuDefintionGenerator.generateTellMeMenuDefinition(t,this._interactionLogger.get_record()),appChrome.api.dispatch(appChrome.actions.updateTellMeSearchResults(this._currentDisplayedMenuModel.menuModel,e))),this._cachedRefreshMenuTask&&this._taskManager.addTask(this._cachedRefreshMenuTask)},e.prototype.DetermineSource=function(e,t,n,r){return e?R.tryQuery:r?R.tryCommand:t?R.mru:n?R.parameterQuery:R.query},e.prototype.addProvider=function(e){this._resultsProvider&&this._resultsProvider.addProvider(e)},e.get_instance=function(){return e._instance||(e._instance=new e)},e.TruncateToSignificantDigits=function(e,t){if(!e)return 0;var n=Math.pow(10,t);return Math.round(e*n)/n},e._instance=null,e.OcpsIsEnabled="OcpsIsEnabled",e.ConnectedServicesFeature="ConnectedServices",e}();(0,r.l)(ve,"249d4ed2$TellMeActor",null,[i])},7500:function(e,t,n){"use strict";n.d(t,{j:function(){return l}});var r=n(3545),i=n(4130),o=n(1308),a=n(6902),s=n(423),l=function(e){function t(t,n,r,i,o,a,s,l,u,c,d,p,g,h){var _=this;return _.paraId=0,_.runId=0,_.newlyTypedRun=!1,_.allObjects=null,_.formatId=null,_.isPendingProofing=!1,_.hasSpellingError=!1,_.hasGrammarError=!1,_.proofingErrorHint=0,_.runMergeBlockTrackedChangeInfo=null,_.changeId=null,(_=e.call(this,n,r,i)||this).paraId=o,_.runId=a,_.newlyTypedRun=l,_.set_formatId(s),_.allObjects=t,_.isPendingProofing=u,_.hasSpellingError=c,_.hasGrammarError=d,_.proofingErrorHint=p,_.runMergeBlockTrackedChangeInfo=g,_.changeId=h,_}return(0,r.t)(t,e),t.prototype.get_allObjects=function(){return this.allObjects},t.prototype.get_formatId=function(){return this.formatId},t.prototype.set_formatId=function(e){return this.formatId=e,e},t.prototype.get_formatObj=function(){return this.get_allObjects()(this.get_formatId())},t.prototype.toString=function(){var t=e.prototype.toString.call(this);return String.format("{0} [ParaId: {1}] [RunId: {2}] [NewlyTypedRun: {3}] [FormatId: {4}] [ChangeId: {5}]",t,this.paraId,this.runId,this.newlyTypedRun,this.get_formatId().toString(),this.changeId?this.changeId.toString():"NULL")},t.prototype.isEquivalentTo=function(t,n,r,i){if(!e.prototype.isEquivalentTo.call(this,t,n,r,i))return!1;var s=t;if(i)return!0;if(!this.runMergeBlockTrackedChangeInfo.isEquivalentTo(s.runMergeBlockTrackedChangeInfo))return!1;if(this.changeId&&!this.changeId.equals(s.changeId))return!1;if(this.get_formatId().equals(s.get_formatId())||this.get_formatId().equals(o.h.get_nil())||s.get_formatId().equals(o.h.get_nil()))return!0;var l=new a.p(this.get_formatObj(),s.get_formatObj()),u=n.createGraphNodeComplexMerge(this.get_formatObj(),r);return!l.isDifferentWithExceptions(u.get_propertyMergeStrategies())},t}(i.ATextMergeBlock);(0,s.l)(l,"ee2b386c$AUserRunMergeBlock",i.ATextMergeBlock,[])},7553:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});var r=(0,n(423).y)("a2c696b$IMyPresenceUser")},7559:function(e,t,n){"use strict";n.d(t,{d:function(){return r}});var r=(0,n(423).y)("45070766$IPresenceStatusProvider")},7562:function(e,t,n){"use strict";n.d(t,{j:function(){return r}});var r=(0,n(423).y)("32a5ccbd$IAccessibilityCheckPane")},7589:function(e,t,n){"use strict";n.r(t);var r=n(3545),i=n(423),o=n(870),a=n(9910),s=(0,i.y)("ad9b6c62$IAccessibilityCheckPaneHeader"),l=n(8576),u=n(2664),c=n(3150),d=n(3829),p=n(6020),g=function(){function e(t,n,r,i){this._recheckButton=null,this._closeButton=null,this._checkStatusLabel=null,this._stringsProvider=null,this.$$pf_Element=null,this._recheckButton=t,this._closeButton=n,this._checkStatusLabel=r,this._stringsProvider=i,this.set_element(u.j.createUnselectableDomElement("div",e.PaneHeaderId,e.PaneHeaderClassName));var o=u.j.createUnselectableDomElement("div",e.PaneTitleId,e.PaneTitleClassName);o.innerText=this._stringsProvider.get_paneTitle(),o.title=this._stringsProvider.get_paneTitle(),c.a.setAttribute(o,d.x.role,p.t.ariaHeadingRole),this.get_element().appendChild(o),this.get_element().appendChild(this._closeButton.get_element()),this.get_element().appendChild(this.CreateHeaderControlsDom())}return e.prototype.get_element=function(){return this.$$pf_Element},e.prototype.set_element=function(e){return this.$$pf_Element=e,e},e.prototype.get_recheckButtonEnabled=function(){return this._recheckButton.get_enabled()},e.prototype.set_recheckButtonEnabled=function(e){return this._recheckButton.set_enabled(e),e},e.prototype.CreateHeaderControlsDom=function(){var t=u.j.createUnselectableDomElement("div",e.HeaderControlsId,e.HeaderControlsClassName);t.appendChild(this._recheckButton.get_element()),t.appendChild(this._checkStatusLabel.get_element()),this._recheckButton.set_enabled(!0);var n=u.j.createUnselectableDomElement("div",e.SectionDividerId,e.SectionDividerClassName);return t.appendChild(n),t},e.prototype.updateCheckStatusLabel=function(e){this._checkStatusLabel.update(e)},e.prototype.setFocusOnRecheckButton=function(e){this._recheckButton.focus(e)},e.prototype.dispose=function(){this._recheckButton&&(this._recheckButton.dispose(),this._recheckButton=null),this._closeButton&&(this._closeButton.dispose(),this._closeButton=null),this._checkStatusLabel&&(this._checkStatusLabel.dispose(),this._checkStatusLabel=null),this.set_element(null)},e.PaneHeaderId="AccCheckerPaneHeaderId",e.PaneHeaderClassName="AccCheckerPaneHeader",e.PaneTitleId="AccessibilityCheckerPaneTitleId",e.PaneTitleClassName="cui-taskPaneTitle AccCheckerPaneTitle",e.HeaderControlsId="AccessibilityCheckerPaneControlsId",e.HeaderControlsClassName="AccCheckerPaneControls",e.SectionDividerId="AccCheckerSectionDividerId",e.SectionDividerClassName="AccCheckerSectionDivider",e}();(0,i.l)(g,"92ea00ab$AccessibilityCheckPaneHeader",null,[s,l.c,Sys.IDisposable]);var h=(0,i.y)("27218ea5$IAccessibilityCheckPaneHelpSection"),_=n(6378),f=function(){function e(t,n){this._helpLink=null,this.$$pf_Element=null,this._helpLink=t,this.set_element(u.j.createDomElement("div","","AccCheckerHelpContent"));var r=u.j.createUnselectableDomElement("div","AccCheckerInstructionId","AccCheckerInstruction");r.innerText=n.get_resultInstruction(),this.get_element().appendChild(r);var i=u.j.createUnselectableDomElement("div",e.AdditionalInfoHeaderId,"AccCheckerAdditionalInfoTitle");i.innerText=n.get_additionalInfoTitle(),this.get_element().appendChild(i);var o=u.j.createUnselectableDomElement("div","AccCheckerPaneAdditionalInfoContainer","AccCheckerAdditionalInfoBody"),a=u.j.createUnselectableDomElement("span",e.AdditionalInfoTextId,"");a.innerText=n.get_additionalInfoContent(),o.appendChild(a),this.get_element().appendChild(o),this.get_element().appendChild(this._helpLink.get_element())}return e.prototype.get_element=function(){return this.$$pf_Element},e.prototype.set_element=function(e){return this.$$pf_Element=e,e},e.prototype.dispose=function(){this._helpLink&&(this._helpLink.dispose(),this._helpLink=null)},e.prototype.get_helpLinkUrl=function(){return this._helpLink.get_url()},e.prototype.set_helpLinkUrl=function(e){return _.l.isLinkable(e)&&this._helpLink.set_url(e),e},e.prototype.get_helpLinkFocusRegion=function(){return this._helpLink.get_focusRegion()},e.prototype.set_helpLinkFocusRegion=function(e){return this._helpLink.set_focusRegion(e),e},e.AdditionalInfoTextId="AccCheckerPaneAdditionalInfo",e.AdditionalInfoHeaderId="AccCheckerPaneAdditionalInfoTitle",e}();(0,i.l)(f,"e161430c$AccessibilityCheckPaneHelpSection",null,[h,l.c,Sys.IDisposable]);var m=(0,i.y)("9fb45db0$IAccessibilityHelpLink"),y=n(6311),v=n(163),S=n(7597),I=n(4551),C=n(5989),T=function(e){function t(t,n,r,i){var o=e.call(this,t,n)||this;return o._focusManager=null,o._stringsProvider=null,o.$$pf_FocusRegion=null,o._focusManager=r,o._stringsProvider=i,o}return(0,r.t)(t,e),t.prototype.get_AnchorLink=function(){return this.get_element()},t.prototype.get_focusRegion=function(){return this.$$pf_FocusRegion},t.prototype.set_focusRegion=function(e){return this.$$pf_FocusRegion=e,e},t.prototype.get_url=function(){return this.get_AnchorLink().href},t.prototype.set_url=function(e){return _.l.isLinkable(e)&&(this.get_AnchorLink().href=e),e},t.prototype.createDomElement=function(){var e=u.j.createUnselectableDomElement("a",t.HelpLinkId,"AccCheckerHelpLink");return e.innerText=this._stringsProvider.get_externalHelpLinkText(),e.target="_blank",e.setAttribute(p.t.ariaRoleAttribute,p.t.ariaLinkRole),p.t.setAriaAttribute(e,p.t.ariaDisabledAttribute,p.t.ariaFalseValue),p.t.setAriaAttribute(e,p.t.ariaDescribedByAttribute,String.format("{0} {1} {2}",t.InstructionTextId,t.AdditionalInfoHeaderId,t.AdditionalInfoTextId)),e},t.prototype.onInvoke=function(){this.get_focusRegion()&&this.get_url()?(v.r.traceTag(19969186,200,50,"{0}",{externalHelpLinkInvoked:1}),this._focusManager.scopeChanged(I.AFrame.accCheckerPaneFocusId),this.get_focusRegion().listing.trySetCurrentElement(this.get_element()),C.g.followHyperlinkWithNoReferrer(this.get_url())):S.ULS.shipAssertTag(19743971,334,!1,"Hyperlink invoked without URL and/or FocusRegion set")},t.InstructionTextId="AccCheckerInstructionId",t.AdditionalInfoHeaderId="AccCheckerPaneAdditionalInfoTitle",t.AdditionalInfoTextId="AccCheckerPaneAdditionalInfo",t.HelpLinkId="AccCheckerHelpLinkId",t}(y.u);(0,i.l)(T,"20f89139$AccessibilityHelpLink",y.u,[m,l.c,Sys.IDisposable]);var b=(0,i.y)("67763226$ICheckResultsSurface"),A=n(2575),M=n(9354),P=n(1135),F=n(6301),w=n(8114),R=n(6410),E=function(){function e(t,n,r,i,o){this._resultSurface=null,this._listExpandIcon=null,this._listCollapseIcon=null,this._checkCompleteMessage=null,this._categories=null,this._ruleNameElements=null,this._resultContentElements=null,this._ruleResultSectionDict=null,this._categoryResultSectionDict=null,this._navigate=null,this._stringsProvider=null,this._clickInputManager=null,this._keyInputManager=null,this._focusManager=null,this._categoryListExpanded=!1,this.$$pf_FocusRegion=null,this._keyInputManager=t,this._clickInputManager=n,this._navigate=i,this._stringsProvider=o,this._focusManager=r,this._ruleResultSectionDict={},this._categoryResultSectionDict={},this._categories=[],this._ruleNameElements=[],this._resultContentElements=[],this._resultSurface=u.j.createDomElement("div",e.ResultSurfaceId,"AccCheckerResultSurface")}return e.prototype.get_focusRegion=function(){return this.$$pf_FocusRegion},e.prototype.set_focusRegion=function(e){return this.$$pf_FocusRegion=e,e},e.prototype.get_CheckCompleteMessage=function(){return this._checkCompleteMessage||(this._checkCompleteMessage=u.j.createDomElement("div","",e.CheckCompleteClassName),this._checkCompleteMessage.innerText=this._stringsProvider.get_checkCompleteNotification(),this._checkCompleteMessage.tabIndex=0),this._checkCompleteMessage},e.prototype.get_ListExpandIcon=function(){return this._listExpandIcon||(this._listExpandIcon=M.ImageClusteringHelper.createClusteredImage(16,16,"CommentExpand_16x16x32",e.ListIconClassName,!0,"")),this._listExpandIcon.cloneNode(!0)},e.prototype.get_ListCollapseIcon=function(){return this._listCollapseIcon||(this._listCollapseIcon=M.ImageClusteringHelper.createClusteredImage(16,16,"CommentCollapse_16x16x32",e.ListIconClassName,!0,"")),this._listCollapseIcon.cloneNode(!0)},e.prototype.display=function(e){if(e){var t=0;if(e.Results&&e.Results.length>0){t=e.Results.length;var n=this.BuildCheckResultDom(e);this._resultSurface.appendChild(n)}else this._resultSurface.appendChild(this.get_CheckCompleteMessage());v.r.traceTag(19969187,200,50,"{0}",{numberOfAccCheckResults:t})}},e.prototype.clear=function(){if(this._resultSurface){for(;this._resultSurface.hasChildNodes();)this._resultSurface.removeChild(this._resultSurface.lastChild);for(var e=0;e<this._resultContentElements.length;e++){var t=this._resultContentElements[e];this._clickInputManager.unregisterHandler(P.d.click,t,i.i(this,this.onSelectResult,"onSelectResult")),this._keyInputManager.unregisterHandler(P.d.keyDown,t,i.i(this,this.onSelectResultKeyPress,"onSelectResultKeyPress"))}Array.clear(this._resultContentElements);for(e=0;e<this._ruleNameElements.length;e++){t=this._ruleNameElements[e];this._clickInputManager.unregisterHandler(P.d.click,t,i.i(this,this.onResultListClick,"onResultListClick")),this._keyInputManager.unregisterHandler(P.d.keyDown,t,i.i(this,this.onResultListKeyPress,"onResultListKeyPress"))}Array.clear(this._ruleNameElements);for(e=0;e<this._categories.length;e++){var n=this._categories[e];this._clickInputManager.unregisterHandler(P.d.click,n,i.i(this,this.onResultCategoryClick,"onResultCategoryClick")),this._keyInputManager.unregisterHandler(P.d.keyDown,n,i.i(this,this.onResultCategoryKeyPress,"onResultCategoryKeyPress"))}Array.clear(this._categories)}},e.prototype.CreateGroupDivider=function(){return u.j.createDomElement("div","",e.GroupDividerClassName)},e.prototype.GetRuleResultSection=function(t){if(!this._ruleResultSectionDict[t.RuleId]){var n=u.j.createDomElement("li","",e.RuleResultSectionClassName),r=u.j.createDomElement("div","",e.RuleNameSectionClassName),i=u.j.createDomElement("div","",e.ListIconContainerClassName);i.appendChild(this.get_ListCollapseIcon());var o=u.j.createDomElement("div","","AccCheckerRuleTitle"),a=t.RuleName;o.innerText=a,r.title=a;var s=u.j.createDomElement("div","",e.RuleResultCountClassName);r.appendChild(i),r.appendChild(o),r.appendChild(s),n.appendChild(r);var l=u.j.createDomElement("ul","",e.ContentListClassName);n.appendChild(l),this._ruleResultSectionDict[t.RuleId]=n}return this._ruleResultSectionDict[t.RuleId].cloneNode(!0)},e.prototype.BuildCheckResultDom=function(t){var n=0,r=u.j.createDomElement("div",e.ResultcontainerId,"AccCheckerResultContainer");p.t.setAriaAttribute(r,p.t.ariaRoleAttribute,p.t.ariaTreeRole);for(var i={},o={},a=t.AccessibilityRules,s=0,l=t.Results;s<l.length;s++){var c=l[s],d=c.RuleId;if(!i[d]){var g=a[d],h=this.GetRuleResultSection(g);i[d]=h;var _=R.s.getChildByClassName(h,e.RuleNameSectionClassName);_.tabIndex=0,_.id="AccCheckRule"+ ++n,e.SetAriaTreeItemRoleAttribute(_,2),this.SetAriaExpandAttribute(_,!0),this.RegisterAndSaveEventForRuleNameSection(_);var f=w.v[g.Category];if(!o[f]){var m=this.GetCategoryResultSection(g.Category);this.InitializeRuleCategoryElement(m),o[f]=m}var y=o[f];R.s.getChildByClassName(y,e.CategoryListClassName).appendChild(h)}var v=i[d],S=this.CreateResultContentDom(c);R.s.getChildByClassName(v,e.ContentListClassName).appendChild(S),this._categoryListExpanded=!0}return this.AttachResultToResultSurface(r,o),r},e.prototype.AttachResultToResultSurface=function(e,t){"error"in t&&e.appendChild(t.error),"warning"in t&&e.appendChild(t.warning),"tip"in t&&e.appendChild(t.tip),"intelligentService"in t&&e.appendChild(t.intelligentService)},e.prototype.InitializeRuleCategoryElement=function(t){var n=R.s.getChildByClassName(t,e.CategoryNameClassName);n.tabIndex=0,this.RegisterAndSaveEventForResultCategory(n),e.SetAriaTreeItemRoleAttribute(n,1),this.SetAriaExpandAttribute(n,!0)},e.prototype.SetAriaExpandAttribute=function(e,t){p.t.setAriaAttribute(e,p.t.ariaExpandedAttribute,t?p.t.ariaTrueValue:p.t.ariaFalseValue)},e.prototype.CreateResultContentDom=function(t){var n=u.j.createDomElement("li",t.ResultId,e.CheckResultClassName);return n.innerText=t.ContentName,n.title=t.ContentName,n.tabIndex=0,this.RegisterAndSaveEventForResultContentElement(n),e.SetAriaTreeItemRoleAttribute(n,3),n},e.prototype.RegisterAndSaveEventForResultContentElement=function(e){Array.add(this._resultContentElements,e),this._clickInputManager.registerHandler(P.d.click,e,i.i(this,this.onSelectResult,"onSelectResult")),this._keyInputManager.registerHandler(P.d.keyDown,e,i.i(this,this.onSelectResultKeyPress,"onSelectResultKeyPress"))},e.prototype.onSelectResult=function(e){var t=e.get_caughtElement();return this.get_focusRegion().listing.trySetCurrentElement(t),this._navigate(t.id),!0},e.prototype.onSelectResultKeyPress=function(t){var n=this,r=t.get_sourceElement();return this.OnTreeNodeKeyPress(t,(function(){return n._navigate(r.id),!0}),(function(){var t=R.s.getAncestorByClassName(r,e.RuleResultSectionClassName),i=R.s.getChildByClassName(t,e.RuleNameSectionClassName);return n.get_focusRegion().listing.trySetCurrentElement(i),!0}),(function(){return!1}))},e.prototype.RegisterAndSaveEventForRuleNameSection=function(e){Array.add(this._ruleNameElements,e),this._clickInputManager.registerHandler(P.d.click,e,i.i(this,this.onResultListClick,"onResultListClick")),this._keyInputManager.registerHandler(P.d.keyDown,e,i.i(this,this.onResultListKeyPress,"onResultListKeyPress"))},e.prototype.RegisterAndSaveEventForResultCategory=function(e){Array.add(this._categories,e),this._clickInputManager.registerHandler(P.d.click,e,i.i(this,this.onResultCategoryClick,"onResultCategoryClick")),this._keyInputManager.registerHandler(P.d.keyDown,e,i.i(this,this.onResultCategoryKeyPress,"onResultCategoryKeyPress"))},e.prototype.GetCategoryResultSection=function(t){if(!this._categoryResultSectionDict[w.v[t]]){var n=u.j.createDomElement("div","",e.CategoryItemClassName),r=u.j.createDomElement("div","",e.CategoryNameClassName),i=u.j.createDomElement("div","","AccCheckerResultCategory"),o=u.j.createDomElement("ul","",e.CategoryListClassName);i.innerText=this.GetCategoryNameString(t),r.appendChild(i),r.appendChild(this.CreateGroupDivider()),n.appendChild(r),n.appendChild(o),this._categoryResultSectionDict[w.v[t]]=n}return this._categoryResultSectionDict[w.v[t]].cloneNode(!0)},e.prototype.GetCategoryNameString=function(e){switch(e){case 0:return this._stringsProvider.get_categoryError();case 1:return this._stringsProvider.get_categoryWarning();case 2:return this._stringsProvider.get_categoryTip();case 3:return this._stringsProvider.get_categoryIntelligentService();default:return S.ULS.shipAssertTag(19789058,334,!1,String.format("Category {0} is not a known Accessiblity category!",w.v[e])),w.v[e]}},e.prototype.ToggleResultList=function(e){this.ExpandCollapseResultList(e,!this.IsResultListExpanded(e))},e.prototype.IsResultListExpanded=function(t){var n=R.s.getChildByClassName(t.parentNode,e.ContentListClassName);return!!n&&"none"!==n.style.display},e.prototype.ExpandCollapseResultList=function(t,n){var r=R.s.getChildByClassName(t.parentNode,e.ContentListClassName),i=R.s.getChildByClassName(t,e.ListIconContainerClassName),o=R.s.getChildByClassName(i,e.ListIconClassName+" clip16x16"),a=R.s.getChildByClassName(t,e.RuleResultCountClassName);if(!a.hasChildNodes()){var s=R.s.getChildrenByClassName(r,e.CheckResultClassName),l=u.j.createDomElement("span","","");l.innerText="("+s.length+")",a.appendChild(l)}R.s.removeElement(o);var c="none",d="inline-block",p=this.get_ListExpandIcon();n&&(c="block",p=this.get_ListCollapseIcon(),d="none"),a.style.display=d,r.style.display=c,i.appendChild(p),this.SetAriaExpandAttribute(t,n)},e.prototype.ExpandCollapseAllCategoryLists=function(){this._categoryListExpanded=!this._categoryListExpanded;for(var t=this._categoryListExpanded?"block":"none",n=0;n<this._categories.length;n++){R.s.getChildByClassName(this._categories[n].parentNode,e.CategoryListClassName).style.display=t,this.SetAriaExpandAttribute(this._categories[n],this._categoryListExpanded)}},e.prototype.onResultListClick=function(e){return this._focusManager.scopeChanged(I.AFrame.accCheckerPaneFocusId),this.get_focusRegion().listing.trySetCurrentElement(e.get_caughtElement()),this.ToggleResultList(e.get_caughtElement()),!0},e.prototype.onResultCategoryClick=function(e){return this._focusManager.scopeChanged(I.AFrame.accCheckerPaneFocusId),this.get_focusRegion().listing.trySetCurrentElement(e.get_caughtElement()),this.ExpandCollapseAllCategoryLists(),!0},e.prototype.onResultListKeyPress=function(t){var n=this,r=t.get_sourceElement();return this.OnTreeNodeKeyPress(t,(function(){return n.ToggleResultList(r),!0}),(function(){if(n.IsResultListExpanded(r))n.ExpandCollapseResultList(r,!1);else{var t=R.s.getAncestorByClassName(r,e.CategoryItemClassName),i=R.s.getChildByClassName(t,e.CategoryNameClassName);n.get_focusRegion().listing.trySetCurrentElement(i)}return!0}),(function(){return n.IsResultListExpanded(r)?n.get_focusRegion().moveForward():n.ExpandCollapseResultList(r,!0),!0}))},e.prototype.onResultCategoryKeyPress=function(e){var t=this;return this.OnTreeNodeKeyPress(e,(function(){return t.ExpandCollapseAllCategoryLists(),!0}),(function(){return t._categoryListExpanded&&t.ExpandCollapseAllCategoryLists(),!0}),(function(){return t._categoryListExpanded?t.get_focusRegion().moveForward():t.ExpandCollapseAllCategoryLists(),!0}))},e.prototype.get_FirstFocusableElement=function(){return n(7589).AAccessibilityCheckPane.GetFirstFocusableElement(this._resultSurface)},e.prototype.get_LastFocusableElement=function(){return n(7589).AAccessibilityCheckPane.GetLastFocusableElement(this._resultSurface)},e.prototype.OnTreeNodeKeyPress=function(e,t,n,r){var i=e.innerEvent.keyCode;if(i===F.v.vK_LeftArrow||i===F.v.vK_RightArrow)return i===F.v.vK_LeftArrow!==A.AFrameworkApplication.get_isRtl()?n():r();switch(i){case F.v.vK_Spacebar:case F.v.vK_Enter:return t();case F.v.vK_UpArrow:var o=this.get_focusRegion().listing.get_previousElement();return this.get_focusRegion().listing.trySetCurrentElement(this._resultSurface.contains(o)?o:this.get_LastFocusableElement());case F.v.vK_DownArrow:var a=this.get_focusRegion().listing.get_nextElement();return this.get_focusRegion().listing.trySetCurrentElement(this._resultSurface.contains(a)?a:this.get_FirstFocusableElement())}return!1},e.prototype.dispose=function(){this.clear()},e.prototype.get_element=function(){return this._resultSurface},e.SetAriaTreeItemRoleAttribute=function(e,t){p.t.setAriaAttribute(e,p.t.ariaRoleAttribute,p.t.ariaTreeItemRole),p.t.setAriaAttribute(e,p.t.ariaLevelAttribute,t.toString())},e.ResultSurfaceId="AccCheckerResultSurfaceId",e.ResultcontainerId="AccCheckerResultContainerId",e.GroupDividerClassName="AccCheckerGroupDivider",e.RuleResultSectionClassName="AccCheckerRuleList",e.ListIconContainerClassName="AccCheckerListIconContainer",e.ListIconClassName="AccCheckerListIcon",e.ContentListClassName="AccCheckerContentList",e.RuleResultCountClassName="AccCheckerRuleResultCount",e.CheckResultClassName="AccCheckerCheckResult",e.RuleNameSectionClassName="AccCheckerRuleNameSection",e.CheckCompleteClassName="AccCheckerCheckComplete",e.CategoryItemClassName="AccCheckerResults",e.CategoryListClassName="AccCheckerCategoryResultList",e.CategoryNameClassName="AccCheckerResultCategoryName",e}();(0,i.l)(E,"a88ed66f$CheckResultsSurface",null,[b,l.c,Sys.IDisposable]);var k=(0,i.y)("1b2423fb$ICheckStatusLabel"),D=function(){function e(t){this._stringsProvider=null,this.$$pf_Element=null,this._errorStatusLabel=null,this._successStatusLabel=null,this._checkingStatusLabel=null,this._stringsProvider=t,this.set_element(u.j.createUnselectableDomElement("div",e.StatusLabelId,e.StatusLabelClass))}return e.prototype.get_element=function(){return this.$$pf_Element},e.prototype.set_element=function(e){return this.$$pf_Element=e,e},e.prototype.update=function(e){var t=null;switch(e){case 0:t=this.get_CheckingStatusLabel();break;case 1:t=this.get_SuccessStatusLabel();break;case 2:t=this.get_ErrorStatusLabel()}t.title=t.innerText;var n=R.s.getChildByClassNameStartWith(this.get_element(),"AccCheckerLabelContent");n&&R.s.removeElement(n),this.get_element().appendChild(t)},e.prototype.CreateErrorStatusIcon=function(){var t=u.j.createDomElement("div","",e.StatusIconClassName),n=M.ImageClusteringHelper.createClusteredImage(16,16,"AlertWarning_16x16x32","",!0,"");return t.appendChild(n),t},e.prototype.CreateSuccessStatusIcon=function(){var t=u.j.createDomElement("div","",e.StatusIconClassName),n=M.ImageClusteringHelper.createClusteredImage(16,16,"PersonaStatusOnlineAlt_16x16x32","",!0,"");return t.appendChild(n),t},e.prototype.get_ErrorStatusLabel=function(){if(!this._errorStatusLabel){this._errorStatusLabel=u.j.createDomElement("div","",e.LabelContentClass);var t=this.CreateErrorStatusIcon(),n=u.j.createDomElement("div","",String.format("{0} {1}",e.LabelTextClass,e.ErrorTextClass));n.innerText=this._stringsProvider.get_serviceUnavailable(),this._errorStatusLabel.appendChild(t),this._errorStatusLabel.appendChild(n)}return this._errorStatusLabel},e.prototype.get_SuccessStatusLabel=function(){if(!this._successStatusLabel){this._successStatusLabel=u.j.createDomElement("div","",e.LabelContentClass);var t=this.CreateSuccessStatusIcon(),n=u.j.createDomElement("div","",String.format("{0} {1}",e.LabelTextClass,e.SuccessTextClass));this._successStatusLabel.appendChild(t),this._successStatusLabel.appendChild(n)}var r=new Date;return this._successStatusLabel.lastChild.innerText=String.format(this._stringsProvider.get_lastTimeChecked(),r.localeFormat(A.AFrameworkApplication.shortTimeFormat)),this._successStatusLabel},e.prototype.get_CheckingStatusLabel=function(){if(!this._checkingStatusLabel){this._checkingStatusLabel=u.j.createDomElement("div","",e.LabelContentClass);var t=u.j.createDomElement("div","",String.format("{0} {1}",e.LabelTextClass,e.CheckingTextClass));t.innerText=this._stringsProvider.get_checkingNow(),this._checkingStatusLabel.appendChild(t)}return this._checkingStatusLabel},e.prototype.dispose=function(){},e.StatusIconClassName="AccCheckerStatusIcon",e.StatusLabelId="AccCheckerStatusLabel",e.StatusLabelClass="AccCheckerStatusLabel",e.LabelContentClass="AccCheckerLabelContent",e.LabelTextClass="AccCheckerStatusLabelText",e.SuccessTextClass="AccCheckerStatusLabelSuccessText",e.ErrorTextClass="AccCheckerStatusLabelErrorText",e.CheckingTextClass="AccCheckerStatusLabelCheckingText",e}();(0,i.l)(D,"17100992$CheckStatusLabel",null,[k,l.c,Sys.IDisposable]);var O=(0,i.y)("8e3d7363$IPaneButton"),U=n(340),x=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i._behavior=null,i._behavior=r,i}return(0,r.t)(t,e),t.prototype.get_enabled=function(){return!!this.get_element()&&!this.get_element().disabled},t.prototype.set_enabled=function(e){return U.x.setButtonEnabledState(this.get_element(),e),e},t.prototype.focus=function(e){S.ULS.shipAssertTag(19789027,334,!!e,String.format("FocusRegion is null. Couldn't set current element ( ID: {0}) in region.",this.get_element().id)),e.listing.trySetCurrentElement(this.get_element()),this.get_element().focus()},t.prototype.onInvoke=function(){this._behavior()},t}(y.u);(0,i.l)(x,"251c266b$APaneButton",y.u,[O,l.c,Sys.IDisposable]);var L=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return(0,r.t)(t,e),t.prototype.createDomElement=function(){return U.x.createButton(t.Id,t.ClassName,CommonUIStrings.l_Close,t.ImageName,!1)},t.Id="CloseAccCheckerPane",t.ClassName="AccCheckerPaneCloseButton",t.ImageName="ClosePaneGlyph_16x16x32",t}(x);(0,i.l)(L,"b47be486$CloseButton",x,[]);var N=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r)||this;return o._stringsProvider=null,o._stringsProvider=i,o}return(0,r.t)(t,e),t.prototype.createDomElement=function(){var e=u.j.createDomElement("div",t.ButtonId,String.format("{0} {1} {2}","StandardButton",t.ButtonClassName,"StandardButtonNoImage"));e.tabIndex=0;var n=u.j.createDomElement("div","",String.format("{0} {1}","StandardButtonLabel","AccCheckerCheckButtonText"));return n.innerText=this._stringsProvider.get_reCheckButton(),n.title=this._stringsProvider.get_reCheckButton(),e.appendChild(n),p.t.setAriaAttribute(e,p.t.ariaRoleAttribute,p.t.ariaButtonRole),p.t.setAriaAttribute(e,p.t.ariaDescribedByAttribute,String.format("{0} {1}",t.AccCheckerPaneTitleId,t.StatusLabelId)),e},t.AccCheckerPaneTitleId="AccessibilityCheckerPaneTitleId",t.ButtonId="AccCheckerBtnId",t.StatusLabelId="AccCheckerStatusLabel",t.ButtonClassName="AccCheckerCheckButton",t}(x);(0,i.l)(N,"55184881$RecheckButton",x,[]);var B=n(7155),H=n(2192),$=n(5362);n.d(t,{AAccessibilityCheckPane:function(){return G}});var G=function(e){function t(t,n,r,o,a,s,l,u,c,d,p){var g=this;return g._actionManager=null,g._header=null,g._resultsSurface=null,g._helpSection=null,g._helpContentContainer=null,g._focusRegion=null,(g=e.call(this,n,r,o,a,u,c,p)||this)._actionManager=t,g._header=s||g.CreateHeader(),g._resultsSurface=l||new E(g.get_keyInputManager(),g._clickInputManager,g._focusManager,i.i(g,g.invokeNavigate,"invokeNavigate"),g._stringsProvider),g._helpSection=d||g.CreateHelpSection(),g}return(0,r.t)(t,e),t.prototype.CreateHeader=function(){var e=new N(this.get_keyInputManager(),this._clickInputManager,i.i(this,this.invokeRecheckButton,"invokeRecheckButton"),this._stringsProvider),t=new L(this.get_keyInputManager(),this._clickInputManager,i.i(this,this.invokeCloseButton,"invokeCloseButton")),n=new D(this._stringsProvider);return new g(e,t,n,this._stringsProvider)},t.prototype.CreateHelpSection=function(){return new f(new T(this.get_keyInputManager(),this._clickInputManager,this._focusManager,this._stringsProvider),this._stringsProvider)},t.prototype.get_helpContentContainer=function(){return this._helpContentContainer||(this._helpContentContainer=u.j.createDomElement("div","","AccCheckerHelpContentContainer"))},t.prototype.get_actionManager=function(){return this._actionManager||(this._actionManager=A.AFrameworkApplication.get_theActionManager())},t.prototype.set_actionManager=function(e){return this._actionManager=e,e},t.prototype.createControls=function(){var e=u.j.createDomElement("div","AccessibilityCheckerPane","AccCheckerPane");return e.appendChild(this._header.get_element()),e.appendChild(this._resultsSurface.get_element()),this.get_helpContentContainer().appendChild(this._outOfSyncNotification.get_element()),this.get_helpContentContainer().appendChild(this._partialResultNotification.get_element()),this.get_helpContentContainer().appendChild(this._helpSection.get_element()),e.appendChild(this.get_helpContentContainer()),this._helpSection.set_helpLinkUrl(this.get_externalHelpLinkUrl()),e},t.prototype.displayResults=function(e){if(e){var t=2;e.IsSuccess&&(this._resultDictionary=this.buildResultDictionary(e),this._resultsSurface.display(e),t=1,e.IsPartialResult&&this.showHidePartialResultNotification(!0)),this._header.updateCheckStatusLabel(t),this._header.set_recheckButtonEnabled(!0),this.setDefaultFocus(),this.resizeCheckResultSurface()}},t.prototype.showHideOutOfSyncNotification=function(e){this.get_isVisible()&&this.showHideNotification(this._outOfSyncNotification,e)},t.prototype.showHidePartialResultNotification=function(e){this.showHideNotification(this._partialResultNotification,e)},t.prototype.showHideNotification=function(e,t){t?e.show():e.hide(),this.resizeCheckResultSurface()},t.prototype.showPane=function(){this.show(),this._f6Manager.activateFocus(I.AFrame.accCheckerPaneFocusId),this._focusManager.pushScope(I.AFrame.accCheckerPaneFocusId,!0),this.invokeRecheckButton(),this.resizeCheckResultSurface()},t.prototype.hidePane=function(){this.hide(),this._f6Manager.deactivateFocus(I.AFrame.accCheckerPaneFocusId),this._focusManager.popScope(I.AFrame.accCheckerPaneFocusId,!0)},t.prototype.initialize=function(e){this._accessibilityCheckManager=e,this._rootElement=this.createControls(),this.get_rootPane().appendChild(this._rootElement),this.setupFocus(),this.registerActions()},t.prototype.dispose=function(){this.unregisterActions();var n=this._focusManager.getScope(I.AFrame.accCheckerPaneFocusId);n.unBindAction(t.EndHash),n.unBindAction(t.EscapeHash),n.unBindAction(t.HomeHash),n.unBindAction(t.PageDownHash),n.unBindAction(t.PageUpHash),n.unBindAction(t.ShiftTabHash),n.unBindAction(t.TabHash),this._header&&(this._header.dispose(),this._header=null),this._resultsSurface&&(this._resultsSurface.dispose(),this._resultsSurface=null),this._outOfSyncNotification&&(this._outOfSyncNotification.dispose(),this._outOfSyncNotification=null),this._partialResultNotification&&(this._partialResultNotification.dispose(),this._partialResultNotification=null),this._helpSection&&(this._helpSection.dispose(),this._helpSection=null),e.prototype.dispose.call(this)},t.prototype.registerActions=function(){this.get_actionManager().addActionWithFlags(a.b.accCheckerFocusForward,H.m.frame,i.i(this,this.accCheckerTabFocusHandler,"accCheckerTabFocusHandler"),64),this.get_actionManager().addActionWithFlags(a.b.accCheckerFocusBackward,H.m.frame,i.i(this,this.accCheckerTabFocusHandler,"accCheckerTabFocusHandler"),64),this.get_actionManager().addActionWithFlags(a.b.accCheckerFocusTop,H.m.frame,i.i(this,this.accCheckerTopBottomFocusHandler,"accCheckerTopBottomFocusHandler"),64),this.get_actionManager().addActionWithFlags(a.b.accCheckerFocusBottom,H.m.frame,i.i(this,this.accCheckerTopBottomFocusHandler,"accCheckerTopBottomFocusHandler"),64)},t.prototype.setupFocus=function(){var e=this,t=this._focusManager.getScope(I.AFrame.accCheckerPaneFocusId);t.parent=I.AFrame.mainAppFocusId,this._clickInputManager.addFocusEvent(I.AFrame.accCheckerPaneFocusId,this._rootElement,!1),t.addSetFocus((function(){e.onSetFocus()})),this._f6Manager.addF6KeyBindings(I.AFrame.accCheckerPaneFocusId)},t.prototype.onSetFocus=function(){var e=this;if(this._f6Manager.activateFocus(I.AFrame.accCheckerPaneFocusId),this._focusManager.setScope(I.AFrame.accCheckerPaneFocusId),this._focusRegion=this._focusManager.getRegion(I.AFrame.accCheckerPaneFocusId),!this._focusRegion){var n=this._focusManager.getScope(I.AFrame.accCheckerPaneFocusId),r=new B.DOMFocusListing((function(){return e._rootElement}));r.rememberFirstElement=!0;for(var i=0,a=o.m.validTags;i<a.length;i++){var s=a[i];r.addValidTag(s)}this._focusRegion=this._focusManager.buildRegionWithDelegate((function(){return e._rootElement}),n,r),this._focusRegion.rememberFocusStealers(),this._focusRegion.looped=!0,this._focusRegion.contained=!0,this._resultsSurface.set_focusRegion(this._focusRegion),this._helpSection.set_helpLinkFocusRegion(this._focusRegion),t.RebindKeyboardNavigationHandlers(n)}this.setDefaultFocus()},t.prototype.accCheckerTopBottomFocusHandler=function(e,n,r,i,o){if(1===r)return 32;if(!this._resultsSurface||!this._focusRegion)return 8;var s,l=this._resultsSurface.get_element(),u=this._focusRegion.listing,c=u.get_currentElement();if(!l.contains(c))return 2;if(e===a.b.accCheckerFocusBottom)s=t.GetLastFocusableElement(l);else{if(e!==a.b.accCheckerFocusTop)return 8;s=t.GetFirstFocusableElement(l)}return u.trySetCurrentElement(s)?32:8},t.prototype.accCheckerTabFocusHandler=function(e,n,r,i,o){if(1===r)return 32;if(!this._resultsSurface||!this._focusRegion)return 8;var s,l=this._resultsSurface.get_element(),u=this._focusRegion.listing,c=u.get_currentElement();if(e===a.b.accCheckerFocusForward)s=l.contains(c)?u.trySetCurrentElement(t.GetFirstFocusableElement(l.nextSibling)):this._focusRegion.moveForward();else{if(e!==a.b.accCheckerFocusBackward)return 8;s=l.contains(c)?u.trySetCurrentElement(t.GetLastFocusableElement(l.previousSibling)):l.contains(u.get_previousElement())?u.trySetCurrentElement(t.GetFirstFocusableElement(l)):this._focusRegion.moveBackward()}return s?32:8},t.prototype.setDefaultFocus=function(){this._header.setFocusOnRecheckButton(this._focusRegion)},t.prototype.ensureFocus=function(){this._focusManager.scopeChanged(I.AFrame.accCheckerPaneFocusId)},t.prototype.resizeCheckResultSurface=function(){var e=this._header.get_element().offsetHeight,t=this.get_helpContentContainer().offsetHeight;this._resultsSurface.get_element().style.top=e+"px",this._resultsSurface.get_element().style.bottom=t+"px"},t.prototype.invokeRecheckButton=function(){this._header.get_recheckButtonEnabled()&&(this._header.set_recheckButtonEnabled(!1),this._header.updateCheckStatusLabel(0),this.showHideOutOfSyncNotification(!1),this.showHidePartialResultNotification(!1),this._resultDictionary=null,this._resultsSurface.clear(),this._focusManager.scopeChanged(I.AFrame.accCheckerPaneFocusId),this._accessibilityCheckManager.onCheckButtonClick())},t.RebindKeyboardNavigationHandlers=function(e){e.unBindAction(t.EndHash),e.unBindAction(t.EscapeHash),e.unBindAction(t.HomeHash),e.unBindAction(t.PageDownHash),e.unBindAction(t.PageUpHash),e.unBindAction(t.ShiftTabHash),e.unBindAction(t.TabHash),e.bindAction(t.EndHash,a.b.accCheckerFocusBottom),e.bindAction(t.EscapeHash,a.b.closeAccessibilityCheckerPane),e.bindAction(t.HomeHash,a.b.accCheckerFocusTop),e.bindAction(t.PageDownHash,a.b.accCheckerFocusBottom),e.bindAction(t.PageUpHash,a.b.accCheckerFocusTop),e.bindAction(t.ShiftTabHash,a.b.accCheckerFocusBackward),e.bindAction(t.TabHash,a.b.accCheckerFocusForward)},t.GetFirstFocusableElement=function(e){return B.DOMFocusListing.firstInElement(e,o.m.validTags)},t.GetLastFocusableElement=function(e){return B.DOMFocusListing.lastInElement(e,o.m.validTags)},t.EndHash=$.KeyInputManager.hashKey(F.v.vK_End,0),t.EscapeHash=$.KeyInputManager.hashKey(F.v.vK_Escape,0),t.HomeHash=$.KeyInputManager.hashKey(F.v.vK_Home,0),t.PageDownHash=$.KeyInputManager.hashKey(F.v.vK_PageDown,0),t.PageUpHash=$.KeyInputManager.hashKey(F.v.vK_PageUp,0),t.ShiftTabHash=$.KeyInputManager.hashKey(F.v.vK_Tab,4),t.TabHash=$.KeyInputManager.hashKey(F.v.vK_Tab,0),t}(o.m);(0,i.l)(G,"9bc719b5$AAccessibilityCheckPane",o.m,[])},7664:function(e,t,n){"use strict";var r=n(1482),i=n(1775),o=n(9402),a=n(7597),s=n(1308),l=n(6382),u=n(9562),c=n(7154),d=n(423),p=function(){return function(e,t,n,r,i,o,a,s,l){this.LocalCobaltSessionId=e,this.SkypeChatThreadId=t,this.ChatThreadDiscoveryUri=n,this.InChat=r,this.Capabilities=i,this.Email=o,this.UserName=a,this.IsAnonymous=s,this.PresenceStatus=l}}();(0,d.l)(p,"fb4f0a85$SerializableWacData",null,[]);var g=n(9974),h=n(3040);n.d(t,{m:function(){return _}});var _=function(){function e(e,t,n){this._packetId=0,this._matchedForRendering=!1,this.$$pf_Ip=null,this.$$pf_IsRendered=!1,this.$$pf_ShowFullTooltip=!1,this.$$pf_User=null,this._packetId=e,this.set_ip(n),this.set_user(t)}return e.prototype.get_ip=function(){return this.$$pf_Ip},e.prototype.set_ip=function(e){return this.$$pf_Ip=e,e},e.prototype.get_matchedForRendering=function(){return this._matchedForRendering},e.prototype.set_matchedForRendering=function(e){(this._matchedForRendering=e,this._matchedForRendering)&&this.get_ip().onPresenceMatchedForRendering();return e},e.prototype.get_isRendered=function(){return this.$$pf_IsRendered},e.prototype.set_isRendered=function(e){return this.$$pf_IsRendered=e,e},e.prototype.get_showFullTooltip=function(){return this.$$pf_ShowFullTooltip},e.prototype.set_showFullTooltip=function(e){return this.$$pf_ShowFullTooltip=e,e},e.prototype.get_user=function(){return this.$$pf_User},e.prototype.set_user=function(e){return this.$$pf_User=e,e},e.prototype.getSerializedData=function(){var e=g.q.get_instance().getNextPacketIdForPresence();return new c.k(this._packetId,this.get_user().get_clientId(),1,0,this.get_ip()?this.get_ip().getData():null,new p(this.get_user().get_localCobaltSessionId(),this.get_user().get_chatThreadId(),this.get_user().get_chatThreadDiscoveryUri(),this.get_user().get_inChat(),this.get_user().get_capabilities().capabilities,this.get_user().get_email(),this.get_user().get_userName(),this.get_user().get_isAnonymous(),this.get_user().get_presenceStatus()),null,null,null,null,null,null,0,e)},e.prototype.isEmptyPresence=function(){return!this.get_ip()},e.prototype.getHashKey=function(){return this.get_user().get_clientId()+(this.get_ip()?this.get_ip().get_paragraphId().toString():s.h.get_nil().toString())},e.prototype.isValid=function(){var e=!!this.get_user()&&this.get_user().isValid(),t=!this.get_ip()||this.get_ip().isValid();return e&&t},e.prototype.clone=function(){var t=new e;return t._packetId=this._packetId,t._matchedForRendering=this._matchedForRendering,t.set_user(this.get_user()?this.get_user().clone():null),t.set_ip(this.get_ip()?this.get_ip().clone():null),t.set_isRendered(this.get_isRendered()),t.set_showFullTooltip(this.get_showFullTooltip()),t},e.get_FeatureHelper=function(){return l.w.get_instance().tryResolve(i.d)},e.createFromRTTData=function(t,n,r,i,o){return t&&e.get_FeatureHelper().isFeatureEnabled(128)&&n?t.operationType?(a.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",t.operationType),null):(s=isNullOrUndefined(t.wacData)?u.PresenceUser.createFromPlainRttData(t.clientId,null,null,0,null,null,null,t.client,null,!1,!1,!1,null):u.PresenceUser.createFromPlainRttData(t.clientId,t.wacData.UserName,null,t.wacData.Capabilities,t.wacData.LocalCobaltSessionId,t.wacData.SkypeChatThreadId,t.wacData.Email,t.client,t.wacData.ChatThreadDiscoveryUri,t.wacData.InChat,!1,t.wacData.IsAnonymous,t.wacData.PresenceStatus),new e(t.packetId,s,h.t.CreateFromPlainData(t.anchorObject,n,r,i,o))):null;var s},e}();(0,d.l)(_,"63e32284$WordPresenceInfo",null,[r.b,o.v.$$(r.b)])},7701:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(1775),o=n(363),a=n(8192),s=n(9423),l=n(423),u=n(974),c=n(7734),d=(0,l.y)("2d263906$IPageBreakActor"),p=n(7597),g=n(7106),h=n(5516),_=n(4551),f=n(2575),m=n(4764),y=n(6301),v=n(5362),S=n(6382),I=n(5575),C=n(2007),T=n(6057),b=n(2735),A=n(5910),M=n(1751),P=n(9802),F=n(842),w=n(3316),R=n(1442),E=n(2162),k=n(4533),D=n(2468),O=n(7523),U=n(3336),x=n(6910),L=(0,l.y)("85ce414d$IPageBreakInserter"),N=n(6720),B=n(2506),H=n(420),$=n(329),G=n(6654),W=n(5934),V=n(3626),j=n(1783),q=n(7852),z=n(456),K=n(9266),Q=function(){function e(t,n,r,i,o,a,s,l,u,c,d,p){this._graphIteratorFactory=null,this._graphTransactionFactory=null,this._createIpContextAtEndOfParagraphDelegate=null,this._autoCorrectScheduler=null,this._pageBreakBlobObjectFactory=null,this._outlineElementEditor=null,this._blobEditor=null,this._ccReader=null,this._ccEditor=null,this._ccConverterFuture=null,this._ccConfigSettings=null,this._listReader=null,this._autoCorrectScheduler=r,this._pageBreakBlobObjectFactory=i,this._graphIteratorFactory=t,this._graphTransactionFactory=n,this._outlineElementEditor=o,this._blobEditor=a,this._ccReader=s,this._ccEditor=l,this._ccConverterFuture=u,this._ccConfigSettings=c,this._listReader=d,this._createIpContextAtEndOfParagraphDelegate=p||e.CreateIpContextAtEndOfParagraph}return e.prototype.get_IsContentControlEditingEnabled=function(){return!!this._ccConfigSettings&&this._ccConfigSettings.get_isContentControlEditingEnabled()},e.prototype.insertAtIpContext=function(e){return this.InsertPageBreak(e,0)},e.prototype.insertBeforeTableContext=function(e){return this.InsertPageBreak(e,1)},e.prototype.InsertPageBreak=function(e,t){var n=null;n=e;var r=null;if(this.get_IsContentControlEditingEnabled()&&this._ccReader&&(this._ccConverterFuture.get_instance()&&this._ccConverterFuture.get_instance().tryToConvertInlineContentControlToBlock(e),t?1===t&&(r=this._ccReader.getLowestContentControlAncestorNotStartWithTable(n.get_node())):r=this._ccReader.getContentControlWrappedIp(n.get_node(),n.get_cpBegin(),n.get_ccBoundaryIdxAtCpBegin()),r&&!r.getValueWithDefault(Boolean,B.j.isBlockContentControl,!1)))return p.ULS.shipAssertTag(24749379,368,!1,"Try to insert page break to inconvertible inline content control"),2;var i=P.g.fromIGraphIterator(this._graphIteratorFactory.getGraphIterator());i.set(n.get_node()),i.tryToRootAtAncestorOfType(10);var o=this._graphTransactionFactory.getTransaction(15,0);if(o.setFromIterator(i),t)V.OutlineElementNavigator.returnToOutlineElement(i);else this.SplitParagraph(i,n),this._autoCorrectScheduler.tryToAutocorrectAtTextBreak(n.get_node(),y.v.vK_Enter,-1);var a=W.ParagraphReader.getFirstParagraphUnderNode(i.get_currentNode(),!0,!1);if(this.InsertPageBreakAtParagraphStart(i),this.get_IsContentControlEditingEnabled()&&r&&this._ccEditor){var s=new N.c(z.k);s.add(i.get_currentNode()),this._ccEditor.addBlockContentControlInformationToParagraphs(s,r.get_id())}return this.SetIpAtParagraphStart(a),o.dispose(),32},e.prototype.SetIpAtParagraphStart=function(e){var t=$.SelectionFactory.createIpSelection(e,0);G.SelectionManager.get_instance().setSelection(t,null,!1,!1)},e.prototype.InsertPageBreakAtParagraphStart=function(e){this._outlineElementEditor.insertOutlineElementAsSibling(e,!0,!0,null,!1,!1);var t=V.OutlineElementNavigator.moveToContent(e,!1);this.InsertBlobAtEnd(t)},e.prototype.SplitParagraph=function(e,t){var n=V.OutlineElementNavigator.returnToOutlineElement(e);if(t.get_cpBegin()||this.get_IsContentControlEditingEnabled()&&(!this.get_IsContentControlEditingEnabled()||-1!==t.get_ccBoundaryIdxAtCpBegin())){A.n.get_instance().get_item(50)&&s.App.get_theCoauthManager().get_isCoauthorable()&&t.get_cpBegin()!==W.ParagraphReader.textLength(t.get_node())&&s.App.get_theCoauthManager().get_theLockManager().acquireAndApplyLock(t.get_node()),this._outlineElementEditor.insertOutlineElementAsSibling(e,!1,!0,null,!1,!0);var r=P.g.fromIGraphIterator(this._graphIteratorFactory.getGraphIterator());r.set(n),this._outlineElementEditor.splitAtIp(r,e,t,!0,!0,!0,!1)}},e.prototype.InsertBlobAtEnd=function(e){var t=this._createIpContextAtEndOfParagraphDelegate(e);this._blobEditor.insertPageBreakBlobAtIp(t)},e.get_CharacterPropertiesEditor=function(){return e._characterPropertiesEditor||(e._characterPropertiesEditor=S.w.get_instance().resolve(x.x))},e.CreateInstanceWithResolvedDependencies=function(){return new e(new q.c,new F.b,S.w.get_instance().resolve(w.g),K.u.get_instance(),S.w.get_instance().resolve(R.p),S.w.get_instance().resolve(E.c),S.w.get_instance().tryResolve(k.c),S.w.get_instance().tryResolve(D.p),S.w.get_instance().resolveFuture(O.t),S.w.get_instance().tryResolve(H.i),S.w.get_instance().resolve(U.c),null)},e.get_instance=function(){return e._instance||(e._instance=e.CreateInstanceWithResolvedDependencies())},e.CreateIpContextAtEndOfParagraph=function(e){return j.y.createIpContextAtEndOfParagraph(e)},e._characterPropertiesEditor=null,e._instance=null,e}();(0,l.l)(Q,"53250ec4$PageBreakInserter",null,[L]);var Z=function(){function e(e,t,n,r,i,o,a,s){this._actionManager=null,this._inserter=null,this._graphTransactionFactory=null,this._externalSelectionManagerFuture=null,this._isSelectionIpContext=null,this._lockedRangeEditor=null,this._isIpInHyperlink=null,this._trackChangeManager=null,this._actionManager=e,this._inserter=t,this._graphTransactionFactory=n,this._externalSelectionManagerFuture=r,this._isSelectionIpContext=i,this._lockedRangeEditor=o,this._isIpInHyperlink=a,this._trackChangeManager=s}return e.prototype.registerActions=function(){this._actionManager.addAction(h.u.insertPageBreak,M.d.view,l.i(this,this.insertPageBreakViewHandler,"insertPageBreakViewHandler")),this._actionManager.addAction(h.u.insertPageBreak,M.d.insertionPoint,l.i(this,this.insertPageBreakIpHandler,"insertPageBreakIpHandler")),this._actionManager.addAction(h.u.insertPageBreak,M.d.table,l.i(this,this.insertPageBreakBeforeTableHandler,"insertPageBreakBeforeTableHandler")),this._actionManager.setActionFlags(h.u.insertPageBreak,4)},e.prototype.registerShortcuts=function(){var e=m.FocusManager.instance().getScope(I.u.editingFocusID);_.AFrame.bindWithDoNothingFallback(e,v.KeyInputManager.hashKey(y.v.vK_Enter,v.KeyInputManager.get_commandKeyModifier()),h.u.insertPageBreak)},e.prototype.insertPageBreakViewHandler=function(e,t,n,r,i){var o=t,a=o.view,s=a.get_selectionManager().get_selectionContextForActionDispatch();if(!s)return 2;if(!this.CheckCanDoInsertPageBreak(o))return 8;if(1===n)return 32;var l=!0,u=8,c=this._isSelectionIpContext(s),d=this._graphTransactionFactory.getTransaction(15,0);if(d.setFromNode(a.get_targetNode()),!c){var h=32===(u=this._actionManager.processActionAgainstContext(t,g.u.deleteForReplace,2,!0,r,null,null));p.ULS.shipAssertTag(4208012,314,h,null),l=h}if(l){var _=a.get_selectionManager().get_selectionContextForActionDispatch(),f=this._isSelectionIpContext(_);p.ULS.shipAssertTag(4208013,314,f,"{0}",{ContextId:t.get_contextId()}),u=8,f&&(u=this._inserter.insertAtIpContext(_),p.ULS.shipAssertTag(4208014,314,32===u,null))}return d.dispose(),32===u&&this._trackChangeManager.alertUntrackedChange(7),u},e.prototype.IsIpInTable=function(e){var t=e;return this.IsInTable(t.get_iterator())},e.prototype.IsRangeSelectionInTable=function(e){var t=e.get_item(0),n=C.SelectionEditor.collapseToIp(t,!0,!1,!0,!1);if(this.IsInTable(n.get_firstContext().get_iterator()))return!0;var r=C.SelectionEditor.collapseToIp(t,!1,!1,!0,!1);return this.IsInTable(r.get_firstContext().get_iterator())},e.prototype.IsInTable=function(e){return e.tryToRootAtAncestorOfType(14)},e.prototype.insertPageBreakIpHandler=function(e,t,n,r,i){if(!t||t.get_contextId()!==M.d.insertionPoint)return 8;if(1===n)return t.get_contextId()===M.d.insertionPoint?32:8;if(2===n){if(!this.CheckCanDoInsertPageBreak(t))return 8;var o=this._inserter.insertAtIpContext(t);return 32===o&&this._trackChangeManager.alertUntrackedChange(7),o}return 32},e.prototype.insertPageBreakBeforeTableHandler=function(e,t,n,r,i){if(!t||t.get_contextId()!==M.d.table)return 8;if(1===n)return 32;if(2===n){if(!this.CheckCanDoInsertPageBreak(t))return 8;var o=this._inserter.insertBeforeTableContext(t);return 32===o&&this._trackChangeManager.alertUntrackedChange(7),o}return 32},e.prototype.CheckCanDoInsertPageBreak=function(e){var t=null,n=e;if(n.get_contextId()===M.d.view){if(!(t=n.view).get_features().supportsPageBreak)return!1;if(!(n=t.get_selectionManager().get_selectionContextForActionDispatch()))return!1}else{var r=P.g.createFromNode(n.get_node());if(r.tryToRootAtAncestorOfType(36)||r.tryToRootAtAncestorOfType(38)||r.tryToRootAtAncestorOfType(40)||r.tryToRootAtAncestorOfType(14))return!1}if(n.get_contextId()===M.d.table)return A.n.get_instance().get_item(14)&&this._lockedRangeEditor.isInsertPageBreakBeforeTableAllowed(n.get_node());if(A.n.get_instance().get_item(14)&&!this._lockedRangeEditor.isInsertPageBreakAllowed(n))return!1;if(this._externalSelectionManagerFuture&&this._externalSelectionManagerFuture.get_instance()&&this._externalSelectionManagerFuture.get_instance().isExternalSelectionContext(n))return!1;var i=this._isSelectionIpContext(n);return!(i?this.IsIpInTable(n):this.IsRangeSelectionInTable(t.get_selectionManager().get_selectionCollection()))&&(!i||!this._isIpInHyperlink(n,!0))},e.CreateInstanceWithResolvedDependencies=function(){return new e(f.AFrameworkApplication.get_theActionManager(),Q.get_instance(),new F.b,S.w.get_instance().resolveFuture(u.i),C.SelectionEditor.isInsertionPointContext,b.k.get_instance(),T.HyperlinkReader.isIpInHyperlink,S.w.get_instance().resolve(c.b).get_instance())},e.get_instance=function(){return e._instance||(e._instance=e.CreateInstanceWithResolvedDependencies())},e._instance=null,e}();(0,l.l)(Z,"f4453daf$PageBreakActor",null,[d]);var J=function(){function e(){this._container=null,this._pageBreakActor=null}return e.prototype.get_name=function(){return"WordEditor.PageBreak"},e.prototype.configure=function(e){this._container=e},e.prototype.init=function(){var e=this;this._container.resolve(i.d).get_graphFeaturesNodeTask().CW((function(t){e.OnAfterGraphFeaturesNodeLoaded()}))},e.prototype.OnAfterGraphFeaturesNodeLoaded=function(){this._container.resolve(i.d).isFeatureEnabled(94)&&(this._pageBreakActor=Z.get_instance(),this._pageBreakActor.registerActions(),this._pageBreakActor.registerShortcuts(),s.App.get_activeAppFrame().updateCommandUI(!1))},e.prototype.dispose=function(){},e}();(0,l.l)(J,"551b74e1$PackageManager",null,[o.u,a.s]),n.d(t,{Program:function(){return X}});var X=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new J,0,!1)},e}();(0,l.l)(X,"b6257a9c$Program",null,[])},7772:function(e,t,n){"use strict";n.d(t,{t:function(){return r}});var r=(0,n(423).y)("fcd35382$IPresenceUser")},7794:function(e,t,n){"use strict";n.d(t,{p:function(){return c}});var r=n(3545),i=n(423),o=n(8027),a=n(7597),s=n(2575),l=n(2612),u=n(6378),c=function(e){function t(t,n,r,i,o,a,s){var l=this;return l._fileNameTextbox=null,l._errorDialogFactory=null,l._uploadToHostManager=null,l._actionManager=null,l._aframeApplication=null,l._appSettingsManager=null,l._activeFrame=null,l._extraCharsInFileNameIsEnabled=!1,l._options=null,(l=e.call(this)||this)._actionManager=n,l._aframeApplication=i,l._uploadToHostManager=a,l._appSettingsManager=t,l._errorDialogFactory=o,l._activeFrame=r,l._extraCharsInFileNameIsEnabled=l._appSettingsManager.getBooleanAppSetting("SaveToHostWithExtraCharsInFileName"),l._options=s,l.setButtonText(1,CommonUIStrings.l_SaveButtonLabel),l}return(0,r.t)(t,e),t.prototype.get_activeFrame=function(){return this._activeFrame},t.prototype.disableSaveButton=function(e,n){this.setButtonState(1,!!e&&e!==n),this._fileNameTextbox=document.getElementById(t.fileNameTextbox),l.n.addHandler(this._fileNameTextbox,"change",i.i(this,this.onFileNameChange,"onFileNameChange")),l.n.addHandler(this._fileNameTextbox,"input",i.i(this,this.onFileNameChange,"onFileNameChange")),this._fileNameTextbox.focus()},t.prototype.fileNameHasInvalidChars=function(e){return this._extraCharsInFileNameIsEnabled?new RegExp("["+this.EscapeRegExpString('\\/:*?"<>|')+"]").test(e):new RegExp("["+this.EscapeRegExpString('\\/:*?"<>|#{}%~&')+"]").test(e)},t.prototype.EscapeRegExpString=function(e){return e.replace(new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),"\\\\$&")},t.prototype.handleFileNameChanged=function(){var e=u.l.getFileNameWithoutExtension(s.AFrameworkApplication.docPropertiesProvider.get_breadcrumbDocName());this.setButtonState(1,!!this._fileNameTextbox&&""!==this._fileNameTextbox.value&&this._fileNameTextbox.value!==e)},t.prototype.onFileNameChange=function(e){var t=this;this._fileNameTextbox&&window.setTimeout((function(){t.handleFileNameChanged()}),0)},t.prototype.fileNameDialogHandler=function(e,n){if(1!==e)a.ULS.sendTraceTag(23881882,216,50,"User click cancel to cancel upload file in file name dialog.");else{var r=n[t.fileNameTextbox],i=t.overwriteCheckbox in n&&n[t.overwriteCheckbox];a.ULS.sendTraceTag(23881883,216,50,"User click save to upload file with new name {0} and overwrite the target {1}.",u.l.redactForLogging(r),i);var o=u.l.getFileExtension(s.AFrameworkApplication.fileName);if((!(r=r?r.trim():null)||""===r||""===o)&&1!==this.get_activeFrame().get_state())return void this._errorDialogFactory.create().displayError(2,r,i);if(this.fileNameHasInvalidChars(r))return void this._errorDialogFactory.create().displayError(1,r,i);this._uploadToHostManager.startUpload(r+o,i,this._options)}},t.prototype.dispose=function(){this._fileNameTextbox&&(l.n.removeHandler(this._fileNameTextbox,"change",i.i(this,this.onFileNameChange,"onFileNameChange")),l.n.removeHandler(this._fileNameTextbox,"input",i.i(this,this.onFileNameChange,"onFileNameChange")),this._fileNameTextbox=null),e.prototype.dispose.call(this)},t.fileNameTextbox="txtFileName",t.overwriteCheckbox="chkOverwrite",t}(o.o);(0,i.l)(c,"b159422d$FileNameDialogBase",o.o,[])},7905:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(423),o=n(2298),a=n(7553),s=n(7772),l=n(2407),u=n(9137),c=n(4533),d=n(3757),p=n(2893),g=n(5373),h=n(6716),_=n(7862),f=n(1227),m=n(6455),y=n(7373),v=n(773),S=n(7639),I=n(7559),C=n(1782),T=n(1266),b=n(4568),A=n(363),M=n(8192),P=n(3362),F=n(7597),w=n(4556),R=n(4956),E=(0,i.y)("ad7dd33$IPresenceTooltipFactory"),k=n(9988),D=n(3772),O=n(2753),U=n(5379),x=function(){function e(t){this._settings=null,this._settings=t,this._settings.AddSettingIfNotAlreadySet(w.p,10,D.s.get_instance()),this._settings.AddSettingIfNotAlreadySet(R.k,9,U.z.get_instance()),this._settings.AddSettingIfNotAlreadySet(Number,6,e.ImageDimension),this._settings.AddSettingIfNotAlreadySet(O.r,13,O.r.get_instance()),this._settings.AddSettingIfNotAlreadySet(Boolean,17,!1)}return e.prototype.createExpandableTooltip=function(e,t,n){return this._settings.AddSettingIfNotAlreadySet(Boolean,15,n),new k.b(e,t,this._settings)},e.prototype.createCompactTooltip=function(t,n){return this._settings.AddSettingIfNotAlreadySet(Boolean,15,n),new k.b(t,e.ImageDimension,this._settings)},e.ImageDimension=20,e}();(0,i.l)(x,"7e0a5d05$ModernPresenceTooltipFactory",null,[E]);var L=n(3545),N=n(4925),B=n(5541),H=n(9961),$=n(1331),G=n(1135),W=n(6410),V=function(e){function t(n,r){var o=e.call(this,n)||this;return o._clickInputManager=null,o._pointerInputManager=null,o._contextMenuInputManager=null,o._ul=null,o._dimension=0,o._rtl=!1,o.users=null,o._rtl=r.get(Boolean,8),o._dimension=r.get(Number,6),o.element=n,o.element.className=t.FlyoutContainerClassName,o._ul=o.createElement("ul"),o.element.appendChild(o._ul),o._clickInputManager=r.get(w.p,10),o._clickInputManager.registerHandler(G.d.click,o.element,i.i(o,o.OnClick,"OnClick")),o._pointerInputManager=r.get(R.k,9),o._pointerInputManager.registerHandler(G.d.pointerOut,o.element,i.i(o,o.OnPointerOut,"OnPointerOut")),o._pointerInputManager.registerHandler(G.d.pointerDown,o.element,i.i(o,o.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),o._contextMenuInputManager=r.get(O.r,13),o._contextMenuInputManager.registerHandler(o.element,i.i(o,o.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),o}return(0,L.t)(t,e),t.prototype.add_InteractivityChanged=function(e){this.addHandler($.q.InteractivityChangedEventKey,e)},t.prototype.remove_InteractivityChanged=function(e){this.removeHandler($.q.InteractivityChangedEventKey,e)},t.prototype.get_users=function(){return this.users},t.prototype.dispose=function(){this.element&&(this._clickInputManager.unregisterHandler(G.d.click,this.element,i.i(this,this.OnClick,"OnClick")),this._pointerInputManager.unregisterHandler(G.d.pointerDown,this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),this._pointerInputManager.unregisterHandler(G.d.pointerOut,this.element,i.i(this,this.OnPointerOut,"OnPointerOut")),this._contextMenuInputManager.unregisterHandler(this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior"))),e.prototype.dispose.call(this)},t.prototype.Hide=function(){this.set_visible(!1)},t.prototype.Show=function(e,t,n){this.Hide(),!e||e.length<=0||(this._rtl?this.element.style.right=t+"px":this.element.style.left=t+"px",this.element.style.top=n+"px",this.AddUsers(e),this.set_visible(!0))},t.prototype.AddUsers=function(e){this.users=e,W.s.clearElement(this._ul);for(var t=e.length-1;t>=0;t--)this.AddUser(e[t])},t.prototype.AddUser=function(e){var n=document.createElement("li");n.style.backgroundColor=e.get_color(),n.style.height=this._dimension+"px",n.id=t._flyoutIdPrefix+e.get_clientId(),n.style.lineHeight=this._dimension+"px",W.s.setElementText(n,e.get_userName()),n.setAttribute("dir","auto"),this._ul.appendChild(n)},t.prototype.OnClick=function(e){return this.Hide(),!1},t.prototype.OnPointerOut=function(e){return this.raiseEvent($.q.InteractivityChangedEventKey,new $.q(3,e),null),!1},t.FlyoutContainerClassName="prFlyout UIFont",t._flyoutIdPrefix="fly_",t}(H.l);(0,i.l)(V,"6f439034$PresenceTooltipFlyoutControl",H.l,[]);var j=n(9354),q=function(e){function t(n,r,i){var o=e.call(this,n)||this;return o._img=null,o._settings=null,o._isGroup=!0,o._clickManager=null,o._pointerManager=null,o._contextMenuInputManager=null,o._users=[],o.element.className=t.CssClassName,o._settings=r,o._pointerManager=o._settings.get(R.k,9),o._clickManager=o._settings.get(w.p,10),o._contextMenuInputManager=o._settings.get(O.r,13),o.HookEvents(),o.AddUser(i),o._isGroup=!1,o}return(0,L.t)(t,e),t.prototype.get_numOfUsers=function(){return this._users.length},t.prototype.get_users=function(){return this._users},t.prototype.add_InteractivityChanged=function(e){this.addHandler($.q.InteractivityChangedEventKey,e)},t.prototype.remove_InteractivityChanged=function(e){this.removeHandler($.q.InteractivityChangedEventKey,e)},t.prototype.dispose=function(){this.UnhookEvents(),e.prototype.dispose.call(this)},t.prototype.AddUser=function(e){Array.add(this._users,e),2===this.get_numOfUsers()?this.UpdateImage(!0):1===this.get_numOfUsers()?this.UpdateImage(!1):this.UpdateImage(this._isGroup)},t.prototype.RemoveUser=function(e){this.FindAndRemoveUser(e)&&(this.get_numOfUsers()>1&&this.UpdateImage(!0),1===this.get_numOfUsers()?this.UpdateImage(!1):this.get_numOfUsers()<1&&this.Hide())},t.prototype.Show=function(){this.UpdateImage(this.get_numOfUsers()>=2),this.set_visible(!0)},t.prototype.Hide=function(){this.set_visible(!1)},t.prototype.GetImageTag=function(e){return e?this.GetClusteredImageTag(0,5):this.GetClusteredImageTag(1,4)},t.prototype.FindAndRemoveUser=function(e){for(var t=0;t<this.get_numOfUsers();t++)if(this._users[t].get_clientId()===e){var n=this._users[t];return Array.removeAt(this._users,t),n}return null},t.prototype.UpdateImage=function(e){this._isGroup!==e&&(this._img&&this.element.removeChild(this._img),this._img=this.GetImageTag(e),this.element.appendChild(this._img),this._isGroup=e),this._img.childNodes[0].style.backgroundColor=this._users[this._users.length-1].get_color()},t.prototype.GetClusteredImageTag=function(e,n){var r=this._settings.get(Number,6),i=this._settings.get(Object,14);return j.ImageClusteringHelper.createClusteredImageFromClusterWithImageClass(r,r,this._settings.get(String,e),this._settings.get(String,n),t.ImageClassName,"",!1,"",this.element.ownerDocument,i?i.cloneNode(!0):null)},t.prototype.OnPointerOver=function(e){return 3!==e.get_inputSource()&&this.raiseEvent($.q.InteractivityChangedEventKey,new $.q(2,e),null),!1},t.prototype.OnClick=function(e){return this.raiseEvent($.q.InteractivityChangedEventKey,new $.q(1,e),null),!0},t.prototype.OnPointerOut=function(e){return 3!==e.get_inputSource()&&this.raiseEvent($.q.InteractivityChangedEventKey,new $.q(3,e),null),!1},t.prototype.UnhookEvents=function(){this.element&&(this._pointerManager.unregisterHandler(G.d.pointerDown,this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),this._pointerManager.unregisterHandler(G.d.pointerOver,this.element,i.i(this,this.OnPointerOver,"OnPointerOver")),this._pointerManager.unregisterHandler(G.d.pointerOut,this.element,i.i(this,this.OnPointerOut,"OnPointerOut")),this._clickManager.unregisterHandler(G.d.doubleClick,this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),this._clickManager.unregisterHandler(G.d.click,this.element,i.i(this,this.OnClick,"OnClick")),this._contextMenuInputManager.unregisterHandler(this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")))},t.prototype.HookEvents=function(){this.element&&(this._pointerManager.registerHandler(G.d.pointerDown,this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),this._pointerManager.registerHandler(G.d.pointerOver,this.element,i.i(this,this.OnPointerOver,"OnPointerOver")),this._pointerManager.registerHandler(G.d.pointerOut,this.element,i.i(this,this.OnPointerOut,"OnPointerOut")),this._clickManager.registerHandler(G.d.doubleClick,this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),this._clickManager.registerHandler(G.d.click,this.element,i.i(this,this.OnClick,"OnClick")),this._contextMenuInputManager.registerHandler(this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")))},t.ImageClassName="cui-img-cont-float cui-img-16by16",t.CssClassName="prGlyph",t}(H.l);(0,i.l)(q,"f7dd78a4$PresenceTooltipGlyph",H.l,[]);var z=n(7413),K=n(5989),Q=n(2953),Z=function(e){function t(n,r,o){var a=e.call(this,n)||this;a.get_element=a.get_Element$2,a._glyphContainer=null,a._numOfUsersToOverflow=0,a._isRtl=!1,a._forcedFlyout=!1,a._isVertical=!1,a._showingAllFlyouts=!1,a._size=0,a._settings=null,a._idToGlyph=null,a.flyout=null,a.activeGlyph=null,a.imageDimension=0,a._users=[],a._tooltipGlyphs=[],a._idToGlyph={},a._settings=o,a._isRtl=o.get(Boolean,8),a._isVertical=o.get(Boolean,11);var s=o.get(Number,12);a.imageDimension=o.get(Number,6),a._size=r,a.element.id=t.GenerateId(),a.element.className=H.l.createRtlFriendlyClassName(t.PresenceTooltipClassName,a._isRtl),s&&a.set_zIndex(s),a.set_rtl(a._isRtl),a.SetControlDimensions(r),a._glyphContainer=a.createElement("div"),a._glyphContainer.className=a._isVertical?t.GlyphContainerVerticalClassName:t.GlyphContainerHorizontalClassName,a.element.appendChild(a._glyphContainer),a.flyout=new Array(a._numOfUsersToOverflow);for(var l=0;l<a._numOfUsersToOverflow;l++)a.get_flyout()[l]=new V(a.createElement("div"),a._settings),a.get_flyout()[l].add_InteractivityChanged(i.i(a,a.OnInteractivityChanged,"OnInteractivityChanged")),a.element.appendChild(a.get_flyout()[l].element);return a}return(0,L.t)(t,e),t.prototype.get_presenceUserList=function(){return Q.p.clone(this._users)},t.prototype.getGlyph=function(e){return this._idToGlyph[e]},t.prototype.get_flyout=function(){return this.flyout},t.prototype.get_activeGlyph=function(){return this.activeGlyph},t.prototype.get_SpaceForOneGlyph=function(){return this.imageDimension+t.PaddingAroundControls},t.prototype.get_width=function(){return this._isVertical?this.get_SpaceForOneGlyph():this._size},t.prototype.get_height=function(){return this._isVertical?this._size:this.get_SpaceForOneGlyph()},t.prototype.get_Element$2=function(){return this.element},t.prototype.add_interactivityChanged=function(e){this.addHandler($.q.InteractivityChangedEventKey,e)},t.prototype.remove_interactivityChanged=function(e){this.removeHandler($.q.InteractivityChangedEventKey,e)},t.prototype.dispose=function(){if(this.get_flyout())for(var t=0,n=this.get_flyout();t<n.length;t++){var r=n[t];r.remove_InteractivityChanged(i.i(this,this.OnInteractivityChanged,"OnInteractivityChanged")),z.d.safeDispose(r)}z.d.safeDisposeArray(this._tooltipGlyphs),this.flyout=null,this._tooltipGlyphs=null,e.prototype.dispose.call(this)},t.prototype.showIconOnly=function(){this.HideAllFlyouts(),this.ShowGlyphs(),this.set_visible(!0),this._forcedFlyout=!1},t.prototype.showIconAndText=function(){!this._tooltipGlyphs||this._tooltipGlyphs.length<1||(this.HideAllFlyouts(),this.set_visible(!0),this.ShowGlyphs(),this.PositionAndShowFlyout(this._tooltipGlyphs[this._tooltipGlyphs.length-1],0),this._forcedFlyout=!0)},t.prototype.showAllIconsAndTexts=function(){if(this._tooltipGlyphs&&!(this._tooltipGlyphs.length<1)){this.set_visible(!0),this.ShowGlyphs();for(var e=0,t=0,n=this._tooltipGlyphs;t<n.length;t++){var r=n[t];this.PositionAndShowFlyout(r,e++)}this._forcedFlyout=!1,this._showingAllFlyouts=!0}},t.prototype.hide=function(){this.set_visible(!1),this.HideAllFlyouts();for(var e=0;e<this._tooltipGlyphs.length;e++)this._tooltipGlyphs[e].Hide();this._forcedFlyout=!1},t.prototype.CheckFlyoutsVisibility=function(){if(!this._showingAllFlyouts)return!1;for(var e=0,t=0,n=this.get_flyout();t<n.length;t++){n[t].get_visible()&&e++}return this._showingAllFlyouts=e>0&&(this._users.length<=this._numOfUsersToOverflow?e===this._users.length:e===this._numOfUsersToOverflow),this._showingAllFlyouts},t.prototype.addUser=function(e){if(!(this._numOfUsersToOverflow<=0)){if(e.get_clientId()||e.set_clientId((t._instanceCounter++).toString()),e.get_clientId()in this._idToGlyph){var n=this.FindUserIndex(e.get_clientId());if(n>=0){var r=this._users[n];if(r.get_color()===e.get_color()&&r.get_userName()===e.get_userName())return;this.removeUser(e.get_clientId())}}var o,a=this.CheckFlyoutsVisibility(),s=0;this._users.length<this._numOfUsersToOverflow?((o=new q(this.createElement("div"),this._settings,e)).add_InteractivityChanged(i.i(this,this.OnInteractivityChanged,"OnInteractivityChanged")),this._isRtl&&!this._isVertical&&this._users.length>0?this._glyphContainer.insertBefore(o.element,this._glyphContainer.firstChild):(this._glyphContainer.appendChild(o.element),s=this._tooltipGlyphs.length),Array.add(this._tooltipGlyphs,o)):(this._isRtl&&!this._isVertical?o=this._tooltipGlyphs[0]:(s=this._tooltipGlyphs.length-1,o=this._tooltipGlyphs[s]),o.AddUser(e)),o.Show(),this._idToGlyph[e.get_clientId()]=o,Array.add(this._users,e),this.UpdateFlyout(o,s),a&&this.showAllIconsAndTexts()}},t.prototype.removeUser=function(e){var t=this.CheckFlyoutsVisibility();t&&this.HideAllFlyouts(),this.RemoveUserInternal(e),this._users.length>=this._numOfUsersToOverflow&&this._tooltipGlyphs.length<this._numOfUsersToOverflow&&this.ReconstructGlyphs(),this._users.length<=0?this.hide():t&&this.showAllIconsAndTexts()},t.prototype.RemoveUserInternal=function(e){var t=this.FindUserIndex(e);if(!(t<0)){var n=this._users[t];Array.removeAt(this._users,t);var r=this._idToGlyph[n.get_clientId()];delete this._idToGlyph[n.get_clientId()],r.RemoveUser(n.get_clientId()),this.UpdateFlyout(r,0),r.get_numOfUsers()<=0&&(this._glyphContainer.removeChild(r.element),Array.remove(this._tooltipGlyphs,r),r.dispose())}},t.prototype.setUserEditingState=function(e,t){},t.prototype.setSelectionMode=function(e){},t.prototype.ReconstructGlyphs=function(){var e=this,t=this.GetOverflowGlyph();if(t&&!(t.get_users().length<=1)){var n=Array.clone(this._users);Array.forEach(n,(function(t){e.RemoveUserInternal(t.get_clientId())})),Array.forEach(n,(function(t){e.addUser(t)}))}},t.prototype.FindUserIndex=function(e){for(var t=0;t<this._users.length;t++)if(this._users[t].get_clientId()===e)return t;return-1},t.prototype.GetOverflowGlyph=function(){return this._isRtl&&!this._isVertical?this._tooltipGlyphs[0]:this._tooltipGlyphs[this._tooltipGlyphs.length-1]},t.prototype.isPointInControl=function(e,t){for(var n=0;n<this._tooltipGlyphs.length;n++){var r=this._tooltipGlyphs[n],i=this.AddBufferToBounds(K.g.getElementBounds(r.element),t,this._isRtl);if(r.get_visible()&&K.g.isPointInBounds(i,e))return!0}for(n=0;n<this._numOfUsersToOverflow;n++)if(this.get_flyout()[n]&&this.get_flyout()[n].get_visible()){var o=this.AddBufferToBounds(K.g.getElementBounds(this.get_flyout()[n].element),t,!this._isRtl);if(K.g.isPointInBounds(o,e))return!0}return!1},t.prototype.AddBufferToBounds=function(e,t,n){var r=e.height+2*t,i=e.width+t,o=e.y-t,a=n?e.x:e.x-t;return new Sys.UI.Bounds(a,o,i,r)},t.prototype.positionOnDiv=function(e,n){var r,i;this._isVertical?(r=this._isRtl?e+t.PaddingAroundControls:-this.imageDimension-t.PaddingAroundControls,i=n-this._size):(r=this._isRtl?0:e-this._size,i=-this.imageDimension-t.PaddingAroundControls),this.position(r,i)},t.prototype.position=function(e,t){this.element.style.top=t+"px",this.element.style.left=e+"px"},t.prototype.ShowGlyphs=function(){for(var e=0;e<this._tooltipGlyphs.length;e++)this._tooltipGlyphs[e].Show()},t.prototype.HideAllFlyouts=function(){for(var e=0;e<this._numOfUsersToOverflow;e++)this.get_flyout()[e].Hide();this._showingAllFlyouts=!1},t.prototype.PositionAndShowFlyout=function(e,n){if(e)if(this.activeGlyph=e,this._isVertical){var r=this.imageDimension;if(e.get_users().length>1)this.get_flyout()[n].Show(e.get_users(),r,this.get_height()-this.imageDimension);else for(var i=this._glyphContainer.children.length,o=0;o<this._glyphContainer.children.length;o++)e.element===this._glyphContainer.children[o]&&this.get_flyout()[n].Show(e.get_users(),r,this.get_height()-(i-o)*this.get_SpaceForOneGlyph()+t.PaddingAroundControls)}else this.get_flyout()[n].Show(e.get_users(),this.get_width(),0)},t.prototype.OnInteractivityChanged=function(e,t){var n=(0,B.e)(q,e),r=n?this.FindGlyphIndex(n):-1;if(2===t.type||1===t.type&&-1!==r&&!this.get_flyout()[r].get_visible())this.PositionAndShowFlyout(e,0);else if(1===t.type)this.HideAllFlyouts(),this._forcedFlyout=!1;else if(3===t.type){if(this.eventHappenedInsideControl(t.eventArgs))return;this._forcedFlyout||this.HideAllFlyouts()}this.raiseEvent($.q.InteractivityChangedEventKey,t,null)},t.prototype.eventHappenedInsideControl=function(e){for(var n=t.GetRelatedTargetFromEvent(e),r=!1,i=0,o=this.get_flyout();i<o.length;i++){var a=o[i];if(W.s.isDescendantOf(a.element,n)){r=!0;break}}return this._glyphContainer!==n&&W.s.isDescendantOf(this._glyphContainer,n)||r},t.prototype.UpdateFlyout=function(e,t){var n=this.IsActiveGlyphAndVisible(e);n&&e.get_numOfUsers()<=0?this.get_flyout()[t].Hide():n?this.PositionAndShowFlyout(e,0):this.get_flyout()[t].Hide()},t.prototype.FindGlyphIndex=function(e){for(var t=0,n=0,r=this._tooltipGlyphs;n<r.length;n++){if(e===r[n])return t;t++}return-1},t.prototype.IsActiveGlyphAndVisible=function(e){var t=this.FindGlyphIndex(e);return!!this.get_activeGlyph()&&e===this.get_activeGlyph()&&-1!==t&&this.get_flyout()[t].get_visible()},t.prototype.SetControlDimensions=function(e){this._numOfUsersToOverflow=e===this.imageDimension?1:Math.floor(e/this.get_SpaceForOneGlyph()),this._isVertical?(this.element.style.height=e+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=e+"px",this.element.style.height=this.imageDimension+"px")},t.GenerateId=function(){return String.format("{0}-{1}",t.PresencetooltipIdPrefix,t._instanceCounter++)},t.GetRelatedTargetFromEvent=function(e){var t=e.innerEvent.rawEvent;return t.relatedTarget||t.toElement},t.PresencetooltipIdPrefix="presencetooltip",t.PresenceTooltipClassName="prControl",t.GlyphContainerHorizontalClassName="prContainerHr",t.GlyphContainerVerticalClassName="prContainerV",t.PaddingAroundControls=2,t._instanceCounter=0,t}(H.l);(0,i.l)(Z,"72dabfe9$PresenceTooltipControl",H.l,[N.x,Sys.IDisposable]);var J,X=function(){function e(t){this._settings=null,this._settings=t,this._settings.AddSettingIfNotAlreadySet(w.p,10,D.s.get_instance()),this._settings.AddSettingIfNotAlreadySet(R.k,9,U.z.get_instance()),this._settings.AddSettingIfNotAlreadySet(Number,6,e.ImageDimension),this._settings.AddSettingIfNotAlreadySet(O.r,13,O.r.get_instance())}return e.prototype.createExpandableTooltip=function(e,t,n){return new Z(e,t,this._settings)},e.prototype.createCompactTooltip=function(t,n){return new Z(t,e.ImageDimension,this._settings)},e.ImageDimension=16,e}();(0,i.l)(X,"87dbdc5a$PresenceTooltipFactory",null,[E]),function(e){e[e.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName",e[e.peopleImageClassName=1]="peopleImageClassName",e[e.peopleImageClusterPath=4]="peopleImageClusterPath",e[e.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath",e[e.imageDimension=6]="imageDimension",e[e.rtl=8]="rtl",e[e.pointerInputManager=9]="pointerInputManager",e[e.clickInputManager=10]="clickInputManager",e[e.vertical=11]="vertical",e[e.zIndex=12]="zIndex",e[e.contextMenuInputManager=13]="contextMenuInputManager",e[e.imageDomElement=14]="imageDomElement",e[e.useIdleTooltip=15]="useIdleTooltip",e[e.viewportBoundsCallback=16]="viewportBoundsCallback",e[e.flipHorizontalDirection=17]="flipHorizontalDirection"}(J||(J={})),(0,i.h)("39b2e3c$PresenceTooltipSettingKeys",J);var Y=function(){function e(){this._dictionary={}}return e.prototype.get=function(e,t){var n=J[t];if(e===Number){var r=this._dictionary[n];return r?Number.parseInvariant(r.toString()):0}return this._dictionary[n]},e.prototype.add=function(e,t,n){this._dictionary[J[t]]=n},e.prototype.AddSettingIfNotAlreadySet=function(e,t,n){J[t]in this._dictionary||(this._dictionary[J[t]]=n)},e.prototype.remove=function(e){delete this._dictionary[J[e]]},e}();(0,i.l)(Y,"8256d84b$PresenceTooltipSettings",null,[]);var ee=n(6720),te=n(3517),ne=n(9910),re=n(2879),ie=function(){function e(t,n,r,o,a,s,l,u,c){this._activeCoauthors=null,this._firstRun=!0,this._awayCoauthorsTask=null,this._myPresenceUser=null,this._awayThreshold=0,this._rtcTask=null,this._rtc=null,this._presenceRemoverTask=null,this._presenceManager=null,this._presenceConverter=null,this._processAction=null,this._notificationBar=null,this._removeToasts=!1,this._myPresenceUser=t,this._rtcTask=n,this._presenceRemoverTask=r,this._presenceConverter=o,this._awayThreshold=s,e._taskManager=a,this._processAction=l,this._notificationBar=u,this._removeToasts=c,te.Task.WAA(n,r).CW(i.i(this,this.InitOnTaskReady,"InitOnTaskReady"))}return e.prototype.InitOnTaskReady=function(t){this._rtcTask.get_result()&&this._presenceRemoverTask.get_result()&&(this._rtc=this._rtcTask.get_result(),this._presenceManager=this._presenceRemoverTask.get_result(),this._rtc.add_presenceUpdated(i.i(this,this.OnPresenceUpdated,"OnPresenceUpdated")),this._awayCoauthorsTask=new re.c(2,2,this._awayThreshold,i.i(this,this.UpdateAwayClientsTask,"UpdateAwayClientsTask"),88,null,!1),e._taskManager.addTask(this._awayCoauthorsTask))},e.prototype.OnPresenceUpdated=function(t,n){var r=Date.now();(this._firstRun||this.ReceivedUpdateFromInactiveUser(n.get_updatedClients()))&&e._taskManager.resetInterval(this._awayCoauthorsTask,0),n.trackDurationInMilliseconds("AwayManager",Date.now()-r)},e.prototype.ReceivedUpdateFromInactiveUser=function(e){for(var t in e){var n={key:t,value:e[t]},r=this._presenceConverter.getPresenceUserFromDictEntry(n);if(r&&r.get_clientId()){var i=r.get_clientId().toLowerCase(),o=this._activeCoauthors[i]||this._activeCoauthors[i.toUpperCase()];if(o&&2===o.status)return!0}}return!1},e.prototype.UpdateAwayClientsTask=function(t){var n=this.GetCoauthorStatus();if(n){var r=new ee.c(String),i=new ee.c(String),o=new Date,a=!1;if(this._firstRun){this._activeCoauthors=n,this._firstRun=!1;var s=this._activeCoauthors;for(var l in s){var u=(p={key:l,value:s[l]}).value;u.lastStatusChange<o&&(o=u.lastStatusChange),2===u.status&&this._presenceManager.removeUserPresence(p.key)}e._taskManager.resetInterval(t,this.getNextInterval(o))}else{var c=this._activeCoauthors;for(var d in c){var p;if((p={key:d,value:c[d]}).key in this._activeCoauthors&&this._myPresenceUser.get_clientId()!==p.key){var g=this._activeCoauthors[p.key],h=n[p.key];g&&h&&(2===g.status&&1===h.status?(r.add(p.key),F.ULS.sendTraceTag(38052609,392,50,p.key+" returned from away")):1===g.status&&2===h.status&&(this._presenceManager.removeUserPresence(p.key),F.ULS.sendTraceTag(38052610,392,50,p.key+" went away"),a||(a=!0)),1===h.status&&h.lastStatusChange<o&&(o=h.lastStatusChange))}}this._activeCoauthors=n,e._taskManager.resetInterval(t,this.getNextInterval(o)),r.get_count()>0&&!this._removeToasts&&(i=this.GetCoauthorNames(r),this.ToastReturningCoauthors(i)),(a||i.get_count()>0)&&this._processAction(ne.b.coauthoringRefreshControl,2,null)}}},e.prototype.ToastReturningCoauthors=function(e){if(e.get_count()){for(var t=e.$$lge();t.$$mn();){var n=t.$$cu(),r=this._notificationBar.createEntry(String.format(CommonUIStrings.l_EditorsToastArriving,n),!1);r.set_image(5),r.set_imagePath("CoAuth_AuthorStatus_16x16x32"),this._notificationBar.addEntry(r)}this._processAction(ne.b.coauthoringRefreshControl,2,null)}},e.prototype.GetCoauthorStatus=function(){return this._rtc.getAllUsersStatusInfo()},e.prototype.GetCoauthorNames=function(e){var t=this._rtc.getAllPresence(),n=new ee.c(String);for(var r in t){var i={key:r,value:t[r]};if(e.contains(i.key)){var o=this._presenceConverter.getPresenceUserFromDictEntry(i);o&&(n.add(o.get_userName()),e.remove(i.key))}}return n.get_count()||F.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found"),n},e.prototype.getNextInterval=function(e){var t=new Date;return Math.max(e.getTime()+this._awayThreshold-t.getTime(),0)},e._taskManager=null,e}();(0,i.l)(ie,"415a90fd$AwayManager",null,[]);var oe=n(1822),ae=n(7847),se=n(163),le=n(2658),ue=function(){function e(e){this.updates=0,this.updates=e}return e.prototype.get_hasUpdates=function(){return!!this.updates},e.prototype.hasFlag=function(e){return!!(this.updates&e)},e.prototype.setFlag=function(e){this.updates=this.updates|e},e.prototype.toString=function(){if(this.hasFlag(0))return"none";var e=new ee.c(String);return this.hasFlag(1)&&e.add("user(s) joined"),this.hasFlag(2)&&e.add("user(s) disconnected"),this.hasFlag(4)&&e.add("user(s) updated"),e.toArray().join(", ")},e}();(0,i.l)(ue,"96d47d8c$UserUpdateEvent",null,[]);var ce=n(7065),de=n(877),pe=(n(1480),n(4072)),ge=function(){function e(e,t,n,r){var o=this;this._rtcProxy=null,this._editorsTableManager=null,this._peopleColorUtils=null,this._presenceConverter=null,this._disposed=!1,this._noUsersAvailableLogged=!1,this._nameMismatchLogged=!1,this._eventSource=new pe.f,this._users=new ae.w(s.t),e.CW((function(t){o._rtcProxy=e.get_result(),o._rtcProxy.add_presenceUpdated(i.i(o,o.OnRtcPresenceUpdate,"OnRtcPresenceUpdate")),o._rtcProxy.add_connectionStateChanged(i.i(o,o.OnRtcConnectionChange,"OnRtcConnectionChange"))})),t.CW((function(e){o._editorsTableManager=t.get_result(),o._editorsTableManager.add_editorsTableUpdated(i.i(o,o.OnEditorsTableUpdated,"OnEditorsTableUpdated"))})),this._peopleColorUtils=n,this._presenceConverter=r}return e.prototype.get_Users=function(){return this._users},e.prototype.add_usersUpdated=function(t){this._eventSource.addHandler(e.UsersUpdatedEventKey,t)},e.prototype.remove_usersUpdated=function(t){this._eventSource.removeHandler(e.UsersUpdatedEventKey,t)},e.prototype.getAllUsers=function(){this.get_Users().get_count()||(this._noUsersAvailableLogged||(se.r.traceTag(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this._noUsersAvailableLogged=!0),this.PopulateUserTableFromRtcAndEditorsTable());for(var e=[],t=this.get_Users().getEnumerator();t.$$mn();){var n=t.$$cu();Array.add(e,n.get_value())}return e},e.prototype.PopulateUserTableFromRtcAndEditorsTable=function(){if(this._rtcProxy){var e=this._rtcProxy.getAllPresence();this.MergeRtcUpdates(e)}if(this._editorsTableManager)for(var t=0,n=this._editorsTableManager.getAllAuthors();t<n.length;t++){var r=n[t];if(r.Id){var i=this.CreateUserFromClientId(r.Id);this.UpdateUserRecordWithInformationFromEditorsTable(new ue(0),i)}}},e.prototype.lookupUser=function(e){var t;return this.get_Users().tryGetValue(e,(0,oe.m)((function(){return t}),(function(e){return t=e}))),t},e.prototype.dispose=function(){this._disposed||(this._rtcProxy&&(this._rtcProxy.remove_presenceUpdated(i.i(this,this.OnRtcPresenceUpdate,"OnRtcPresenceUpdate")),this._rtcProxy.remove_connectionStateChanged(i.i(this,this.OnRtcConnectionChange,"OnRtcConnectionChange"))),this._editorsTableManager&&this._editorsTableManager.remove_editorsTableUpdated(i.i(this,this.OnEditorsTableUpdated,"OnEditorsTableUpdated")),this._disposed=!0)},e.prototype.OnRtcConnectionChange=function(e,t){if(2===t.get_newState()){var n=this.MergeRtcUpdates(this._rtcProxy.getAllPresence());n.get_hasUpdates()&&this.SendUsersUpdatedNotification(n)}},e.prototype.OnEditorsTableUpdated=function(e,t){for(var n=new ue(0),r=0,i=this._editorsTableManager.getAllAuthors();r<i.length;r++){var o=i[r].Id,a=this.CreateUserFromClientId(o);this.UpdateUserRecordWithInformationFromEditorsTable(n,a)}var s=t.get_leaving();if(s&&s.get_length()>0)for(var l=function(e){var t;u.get_Users().tryGetValue(s.get_item(e).Id,(0,oe.m)((function(){return t}),(function(e){return t=e})))&&t&&(u.get_Users().remove(s.get_item(e).Id),n.setFlag(2))},u=this,c=0;c<s.get_length();c++)l(c);n.get_hasUpdates()&&this.SendUsersUpdatedNotification(n)},e.prototype.OnRtcPresenceUpdate=function(e,t){for(var n=Date.now(),r=this.MergeRtcUpdates(t.get_updatedClients()),i=0,o=t.get_disconnectedClients();i<o.length;i++){var a=o[i];this.get_Users().containsKey(a)&&(r.setFlag(2),this.get_Users().remove(a))}r.get_hasUpdates()&&this.SendUsersUpdatedNotification(r),t.trackDurationInMilliseconds("PeopleInfoProvider",Date.now()-n)},e.prototype.MergeRtcUpdates=function(e){var t=new ue(0);if(!e)return t;for(var n in e){var r={key:n,value:e[n]},i=this._presenceConverter.getPresenceUserFromDictEntry(r);if(i){var o=i.clone();this.UpdateUserRecordWithInformationFromEditorsTable(t,o)}}return t},e.prototype.UpdateUserRecordWithInformationFromEditorsTable=function(e,t){if(!t)return null;var n,r,i=t.get_clientId();return r=this.resolveUserWithEditorsTableData(t),this.get_Users().tryGetValue(i,(0,oe.m)((function(){return n}),(function(e){return n=e})))?n.equals(r)||(e.setFlag(4),this.get_Users().set_item(i,r)):(e.setFlag(1),this.get_Users().set_item(i,r)),r},e.prototype.CreateUserFromClientId=function(e){return this.get_Users().containsKey(e)?this.get_Users().get_item(e):ce.PresenceUser.createFromClientId(e)},e.prototype.resolveUserWithEditorsTableData=function(e){if(!e||!e.get_clientId()||!this._editorsTableManager)return e;var t=e.clone(),n=this._editorsTableManager.getCoauthorInfo(t.get_clientId());return n&&(t.set_isReadOnly(!(!t.get_isReadOnly()&&!n.IsReadOnly)),t.set_userName(this.ResolveUserName(t,n)),t.set_capabilities(this.MergeUserCapabilitiesFromAuthorCapabilities(t.get_capabilities(),n.Capabilities)),t.set_email(t.get_email()||n.SIPAddress||n.EmailAddress),n.JoinCoauthTime&&t.set_joinTime(n.JoinCoauthTime)),t.set_color(this._peopleColorUtils.getUserColor(new le.r(t.get_email(),null,t.get_userName(),null,t.get_isAnonymous(),t.get_clientId()),3,!0)),t},e.prototype.CompareDisplayNames=function(e,t){if(t.Name&&e.get_userName()&&t.Name!==e.get_userName()&&!this._nameMismatchLogged){this._nameMismatchLogged=!0,se.r.traceTag(42316243,302,15,"User names in EditorsTable and RTC don't match");var n=!e.get_userName().toUpperCase().localeCompare(CommonUIStrings.l_AnonymousUserName.toUpperCase()),r=!t.Name.toUpperCase().localeCompare(CommonUIStrings.l_AnonymousUserName.toUpperCase());(n||r)&&F.ULS.sendTraceTag(42316244,302,15,'"Anonymous user" received as user name from {0}',n?"RTC":"Editor's Table")}},e.prototype.MergeUserCapabilitiesFromAuthorCapabilities=function(e,t){var n=e||new de.w(0);return t&&(t.SupportsRealtimeChannel&&n.setFlag(1),t.SupportsRename&&n.setFlag(2),t.SupportsChat&&n.setFlag(4)),n},e.prototype.ResolveUserName=function(e,t){return this.CompareDisplayNames(e,t),t.Name||e.get_userName()||(e.get_isAnonymous()||t.IsAnonymous?CommonUIStrings.l_GuestUserName:null)},e.prototype.SendUsersUpdatedNotification=function(t){F.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",t.toString()),this._eventSource.raiseEvent(e.UsersUpdatedEventKey,null,null)},e.UsersUpdatedEventKey="UU",e}();(0,i.l)(ge,"ebf646c$PeopleInfoProvider",null,[o.d,Sys.IDisposable]);var he=n(2575),_e=n(213),fe=n(6382),me=n(2449),ye=n(9423),ve=n(7282),Se=n(6369),Ie=n(1185),Ce=n(8546),Te=function(){return function(e,t,n){this.schedulerTimeSaved=0,this.inboundTimer=null,this.lastReplicatedRevisionId=null,this.schedulerTimeSaved=e,this.inboundTimer=t,this.lastReplicatedRevisionId=n}}();(0,i.l)(Te,"ae3e6ab2$SuccessfulInboundReplicationCallbackData",null,[]);var be=n(8154),Ae=function(){function e(e,t,n,r,o,a,s,l){this.rtc=null,this.stopwatchBuilder=null,this._getReplicatorFunc=null,this._coauthManager=null,this._throttleInboundRequests=!1,this._editorsCountForUsingThrottling=0,this._inboundMultiCounter=null,this._isShuttingDown=null,this.rtc=e,this._getReplicatorFunc=t,this._coauthManager=n,this._throttleInboundRequests=o,this._editorsCountForUsingThrottling=a,this._inboundMultiCounter=s,this._isShuttingDown=r,this.stopwatchBuilder=l,this.get_rtc().add_updateNotificationReceived(i.i(this,this.RtcOnUpdateNotificationReceived,"RtcOnUpdateNotificationReceived"))}return e.prototype.get_rtc=function(){return this.rtc},e.prototype.RtcOnUpdateNotificationReceived=function(t,n){if(!n.get_type()){this._inboundMultiCounter.increment(e.ContentUpdateNotificationReceived);var r=this._coauthManager.get_editorsCount()>=this._editorsCountForUsingThrottling;if(this._throttleInboundRequests&&r){var i=this._getReplicatorFunc();if(!i)return void F.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");i.ensureInboundPending()&&this._inboundMultiCounter.increment(e.PendingInbound)}else this.forceInbound()}},e.prototype.forceInbound=function(){var e=this._getReplicatorFunc();if(e){if(!this._isShuttingDown()&&e.get_lastReplicationSuccessful()){var t=-1;i.r(be.r,e)&&(t=e.replicationTimer.requestIntervalRemaining());var n=this.stopwatchBuilder.makeAndStartStopwatch("Task","ShoulderTapInboundReplicationTimer");e.forceInbound(i.i(this,this.OnSuccessfulReplication,"OnSuccessfulReplication"),null,new Te(t,n,e.get_lastReplicated()))}}else F.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.")},e.prototype.OnSuccessfulReplication=function(e){var t=(0,B.e)(Te,e);if(t){var n=t.inboundTimer.get_ageInMilliseconds().toString(),r=this._getReplicatorFunc(),i=r.get_lastReplicated(),o="";i!==t.lastReplicatedRevisionId&&(F.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",t.schedulerTimeSaved.toString()),o=this.GetNewRevisionIds(r,i,t.lastReplicatedRevisionId)),F.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",o,n)}else F.ULS.sendTraceTag(19964235,500,10,"The callback data was null")},e.prototype.GetNewRevisionIds=function(e,t,n){var r=new Sys.StringBuilder,i=e.get_node().get_contentObjectSpace().get_store().getRevision(t);if(!i)return F.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{lastRevisionId:t}),"";for(r.append(i.get_id().guid);t!==n&&(r.append(", "),r.append(t.guid),i=i.get_baseRevision());)t=i.get_id();return r.toString()},e.ContentUpdateNotificationReceived="CU",e.PendingInbound="PI",e}();(0,i.l)(Ae,"9689ed09$ContentNotificationManager",null,[]);var Me=n(4517),Pe=function(e){function t(t,n,r,i,o,a,s,l){return e.call(this,t,n,r,i,o,a,s,l)||this}return(0,L.t)(t,e),t.get_RtcProxyProvider=function(){return t._rtcProxyProvider||(t._rtcProxyProvider=fe.w.get_instance().resolve(g.q))},t.init=function(){if(ye.App.get_activeAppFrame()){var e=ye.App.get_activeAppFrame().workspace;if(e){e.add_appIsInteractive(t.OnAppIsInteractive);var n=e.get_activePage();n&&(t._replicator=n.get_contentReplicator(),t._replicator&&ye.App.get_theCoauthManagerAsync().CW(t.OnCoauthManagerReady))}}},t.OnCoauthManagerReady=function(e){t._coauthManager=ye.App.get_theCoauthManagerAsync().get_result(),t._coauthManager&&t._coauthManager.get_isCoauthorable()&&t.get_RtcProxyProvider().getInstanceAsync().CW(t.OnRtcProxyReady)},t.OnRtcProxyReady=function(e){if(t._rtcProxy=t.get_RtcProxyProvider().getInstanceAsync().get_result(),t._rtcProxy){var n=he.AFrameworkApplication.appSettingsManager,r=n.getBooleanAppSetting("Box4ThrottleInboundRequests"),i=n.getIntAppSetting("Box4ThrottleInboundsAtUserCount",20),o=new Me.g(11,1);t._replicator.set_getRtcMachineConnectionString((function(){return t._rtcProxy.get_machineConnectionString()})),t._cnm=t._cnm||new t(t._rtcProxy,(function(){return t._replicator}),t._coauthManager,(function(){return he.AFrameworkApplication.isShuttingDown}),r,i,o,ye.App.get_activeAppFrame().get_theStopwatchBuilder()),t._cnm.forceInbound()}},t.OnAppIsInteractive=function(e,n){t._cnm||(e.remove_appIsInteractive(t.OnAppIsInteractive),t.init())},t._cnm=null,t._rtcProxyProvider=null,t._rtcProxy=null,t._replicator=null,t._coauthManager=null,t}(Ae);(0,i.l)(Pe,"39215da4$WordContentNotificationManager",Ae,[]);var Fe=n(1546),we=(0,i.y)("17c57870$IWordPresenceCp"),Re=n(9402),Ee=n(1308),ke=n(1783),De=function(){function e(e,t,n,r,i,o){this._presenceIp=null,this._cp=null,this._translator=null,this._objectSpace=null,this._characterPointConverter=null,this._contentControlReader=null,this.wordTextOffset=null,this._presenceIp=e,this._translator=n,this._objectSpace=r,this._characterPointConverter=i,this._contentControlReader=o,this.wordTextOffset=t}return e.prototype.clone=function(){return new e(this._presenceIp,this.get_wordTextOffset().clone(),this._translator,this._objectSpace,this._characterPointConverter,this._contentControlReader)},e.prototype.get_wordTextOffset=function(){return this.wordTextOffset},e.prototype.get_cp=function(){if(null!=this._cp)return this._cp;var e=this._presenceIp.get_paragraphId();if(e.equals(Ee.h.get_nil()))return 0;var t=this._objectSpace.getObject(e);if(!t)return F.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;var n=this._translator.cpFromWordTextOffset(this._translator.paragraphNodePropsOnGraphNode(t.get_characterData(),t.get_characterProperties()),this.get_wordTextOffset());if(this._characterPointConverter&&this._contentControlReader&&t.get_hasContentControl()){var r=ke.y.createIpContext(t,n),i=this.get_wordTextOffset().contentControlIndicator;r.set_ccBoundaryIdxAtCpBegin(this._contentControlReader.getNearestContentControlBoundaryIdx(t,n,i)),n=this._characterPointConverter.convertGncToBrowserCp(r,!0)}return n},e.prototype.onPresenceMatchedForRendering=function(){null==this._cp&&(this._cp=this.get_cp())},e.prototype.equals=function(e){var t=e;return!!t&&this.get_wordTextOffset().isEqual(t.get_wordTextOffset(),!1)},e}();(0,i.l)(De,"b86a5bd9$WordPresenceCp",null,[Fe.i,Re.v.$$(Fe.i),we]);var Oe=function(){function e(e,t){this._characterPointConverter=null,this._contentControlReader=null,this._characterPointConverter=e,this._contentControlReader=t}return e.prototype.create=function(e,t,n,r){return new De(e,t,n,r,this._characterPointConverter,this._contentControlReader)},e}();(0,i.l)(Oe,"a0d00a6d$Factory",null,[u.u]);var Ue=n(5118),xe=function(){function e(t){var n=this;this._currentPageCalculator=null,this._eventSource=new pe.f,this._currentPageCalculator=t,this._currentPageCalculator.CWR(Function,(function(t){return n._currentPageCalculator.get_result().add_currentPageUpdated((function(t,r){n._eventSource.raiseEvent(e.OnPresenceStatusUpdatedKey,null,null)}))}))}return e.prototype.add_presenceStatusUpdated=function(t){this._eventSource.addHandler(e.OnPresenceStatusUpdatedKey,t)},e.prototype.remove_presenceStatusUpdated=function(t){this._eventSource.removeHandler(e.OnPresenceStatusUpdatedKey,t)},e.prototype.getStatus=function(){return this._currentPageCalculator.get_isCompleted()&&this._currentPageCalculator.get_result()?this._currentPageCalculator.get_result().get_currentPage().toString():e.InvalidPageNumber},e.OnPresenceStatusUpdatedKey="X",e.InvalidPageNumber="0",e}();(0,i.l)(xe,"b6b8375f$WordPresenceStatusProvider",null,[I.d]);var Le=function(){function e(e,t,n,r,o){this._localCobaltLocationInfo=null,this._rtcTask=null,this._rtcProxy=null,this._myPresenceUserInstance=null,this._loggedFirstFailureOfLocalCobalt=!1,this._firstPresenceLogged=!1,this._coauthManager=null,this._coauthTelemetry=null,this.foundNotWac=!1,this._coauthManager=e,this._localCobaltLocationInfo=t,this._rtcTask=n,n.CW(i.i(this,this.OnRtcReady,"OnRtcReady")),this._myPresenceUserInstance=r,this._myPresenceUserInstance.set_localCobaltLocationInfo(this._localCobaltLocationInfo),this._coauthTelemetry=o}return e.prototype.get_foundNotWac=function(){return this.foundNotWac},e.prototype.get_IsCoauthManagerInitialized=function(){return!!this._coauthManager&&!!this._coauthManager.get_value()},e.prototype.OnRtcReady=function(e){if(this._rtcTask.get_isCompleted()&&this._rtcTask.get_result())return this._rtcProxy=this._rtcTask.get_result(),this._rtcProxy.add_presenceUpdated(i.i(this,this.OnPresenceUpdated,"OnPresenceUpdated")),void F.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.");F.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")},e.prototype.OnPresenceUpdated=function(e,t){var n=Date.now(),r=t.get_updatedClients();for(var o in r){var a={key:o,value:r[o]}.value;if(!this._firstPresenceLogged&&this.get_IsCoauthManagerInitialized()&&this.HandleClientTypeForPresenceBootTelemetry(a.get_user().get_client()),!this._loggedFirstFailureOfLocalCobalt&&a.get_user().get_localCobaltSessionId()&&a.get_user().get_localCobaltSessionId()!==this._localCobaltLocationInfo.get_localCobaltSessionId()){F.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this._localCobaltLocationInfo.get_localCobaltSessionId(),a.get_user().get_localCobaltSessionId()),this._loggedFirstFailureOfLocalCobalt=!0;break}}this._loggedFirstFailureOfLocalCobalt&&this._rtcProxy.remove_presenceUpdated(i.i(this,this.OnPresenceUpdated,"OnPresenceUpdated")),this._firstPresenceLogged||(F.ULS.sendTraceTag(5604374,302,50,"First presence received"),this._firstPresenceLogged=!0,this.get_IsCoauthManagerInitialized()&&this._coauthTelemetry.endTelemetry(this.get_foundNotWac()?1:0)),t.trackDurationInMilliseconds("WordPresenceUpdateMonitor",Date.now()-n)},e.prototype.HandleClientTypeForPresenceBootTelemetry=function(e){e&&1===e||(this.foundNotWac=!0)},e}();(0,i.l)(Le,"5e9520b7$WordPresenceUpdateMonitor",null,[]);var Ne=n(9999),Be=n(5592),He=n(127),$e=n(1323),Ge=n(5104),We=n(448),Ve=n(8047),je=n(8361),qe=n(8729),ze=(0,i.y)("15ed7e12$IRtcProxyController"),Ke=n(6604),Qe=n(7929),Ze=n(4541),Je=n(8996),Xe=n(5479),Ye=n(628),et=function(){function e(e,t,n,r,o,a,s,l){var u=this;this._dependentServices=null,this._forceConnectionToRtc=null,this._isAppShuttingDown=null,this._loggedFirstConnection=!1,this._taskManager=null,this._keepInForeverDisconnectedState=!1,this._myPresenceUser=null,this._appSettings=null,this._isUpdateNotificationSynchronized=!1,this._isHistogramLogged=!1,this._aggregator=null,this._coauthManagerAsync=null,this._updateNotificationHighRuntimeCount=0,this._updateNotificationTotal=0,this._updateNotificationTypeCountBuckets=null,this._rtc=null,this._eventSource=new pe.f,this._myPresenceUser=a,this._myPresenceUser.set_clientId(e.get_clientId()),this._rtc=e,this._coauthManagerAsync=t,this._isAppShuttingDown=r,this._forceConnectionToRtc=o,this._taskManager=n,this._dependentServices=new Xe.o(je.r,null),this._appSettings=s,this._aggregator=l,this._coauthManagerAsync&&this._coauthManagerAsync.CW((function(e){u._coauthManagerAsync.get_isCanceled()||u._coauthManagerAsync.get_isFaulted()||u._coauthManagerAsync.get_result().add_amIAloneChanged(i.i(u,u.onAmIAloneChanged,"onAmIAloneChanged"))}))}return e.prototype.get_connectionState=function(){return this._rtc.get_connectionState()},e.prototype.add_presenceUpdated=function(t){this._eventSource.addHandler(e.PresenceUpdatedEventKey,t)},e.prototype.remove_presenceUpdated=function(t){this._eventSource.removeHandler(e.PresenceUpdatedEventKey,t)},e.prototype.add_connectionStateChanged=function(t){this._eventSource.addHandler(e.ConnectedStateChangedEventKey,t)},e.prototype.remove_connectionStateChanged=function(t){this._eventSource.removeHandler(e.ConnectedStateChangedEventKey,t)},e.prototype.add_persistentStateUpdated=function(t){this._eventSource.addHandler(e.PersistentStateUpdatedEventKey,t)},e.prototype.remove_persistentStateUpdated=function(t){this._eventSource.removeHandler(e.PersistentStateUpdatedEventKey,t)},e.prototype.add_persistentStateCleared=function(t){this._eventSource.addHandler(e.PersistentStateClearedEventKey,t)},e.prototype.remove_persistentStateCleared=function(t){this._eventSource.removeHandler(e.PersistentStateClearedEventKey,t)},e.prototype.sendPresence=function(e){return null},e.prototype.add_myPresenceUpdated=function(e){this._rtc.add_myPresenceUpdated(e)},e.prototype.remove_myPresenceUpdated=function(e){this._rtc.remove_myPresenceUpdated(e)},e.prototype.get_clientId=function(){return this._rtc.get_clientId()},e.prototype.add_updateNotificationReceived=function(t){this._eventSource.addHandler(e.UpdateNotificationEventKey,t)},e.prototype.remove_updateNotificationReceived=function(t){this._eventSource.removeHandler(e.UpdateNotificationEventKey,t)},e.prototype.InitUpdateNotificationHeuritics=function(){var e=this;this._updateNotificationTypeCountBuckets=new Array(12);for(var t=0;t<12;t++)this._updateNotificationTypeCountBuckets[t]=0;this._isUpdateNotificationSynchronized=!!this._appSettings&&this._appSettings.getBooleanAppSetting("UpdateNotificationTaskExperimentIsEnabled"),he.AFrameworkApplication.subscribeToBeforeAppShutDown((function(t,n){e.LogUpdateNotificationHeuristics()}))},e.prototype.init=function(){this._rtc.add_connectionStateChanged(i.i(this,this.onConnectionStateChanged,"onConnectionStateChanged")),this._rtc.add_presenceUpdated(i.i(this,this.onPresenceUpdated,"onPresenceUpdated")),this._rtc.add_persistentStateUpdated(i.i(this,this.onPersistentStateUpdated,"onPersistentStateUpdated")),this._rtc.add_persistentStateCleared(i.i(this,this.onPersistentStateCleared,"onPersistentStateCleared")),this._rtc.add_updateNotificationReceived(i.i(this,this.onUpdateNotificationReceived,"onUpdateNotificationReceived")),this.connectToRtcIfInCoauthSessionAndDisconnectFromRtcIfAlone(),this.InitUpdateNotificationHeuritics()},e.prototype.registerService=function(e){this._dependentServices.contains(e,(function(e,t){return e===t}))||(this._dependentServices.add(e),2===this.get_connectionState()&&e.start())},e.prototype.unregisterService=function(e){for(var t=0;t<this._dependentServices.get_length();t++)if(this._dependentServices.get_item(t)===e){this._dependentServices.deleteAt(t);break}},e.prototype.connect=function(){this._keepInForeverDisconnectedState||this._rtc.connect()},e.prototype.disconnect=function(){this._rtc.disconnect()},e.prototype.get_rtcInstance=function(){return this._rtc},e.prototype.deserializePresenceInfo=function(e){return Ye.l.createFromPlainData(e)},e.prototype.serializePresenceInfo=function(e,t){return new Ye.l(e,t).getSerializedData()},e.prototype.sendPresenceIp=function(e){return e&&e.isValid()&&!this._isAppShuttingDown()?this._rtc.sendPresence(this.serializePresenceInfo(this._myPresenceUser.getMyUser(),e)):te.Task.fromResult(Object,null)},e.prototype.sendPersistentState=function(e,t){return this._rtc.sendPersistentState(e,t)},e.prototype.getAllPersistentState=function(e){return this._rtc.getAllPersistentState(e)},e.prototype.getAllUsersStatusInfo=function(){return this._rtc.getAllUsersStatusInfo()},e.prototype.sendUpdateNotification=function(e,t,n){return this._rtc.sendUpdateNotification(e,t,n)},e.prototype.getAllPresence=function(){return this.CreateDeserializedPresenceDictionary(this._rtc.getAllPresence())},e.prototype.sendLastUpdateNotificationWhenConnected=function(e,t){this.sendUpdateNotification(e,t,!0)},e.prototype.get_machineConnectionString=function(){return this._rtc.get_machineConnectionString()},e.prototype.onConnectionStateChanged=function(t,n){2===n.get_newState()&&this._dependentServices.forEach((function(e){return e.start(),!0})),n.get_newState()||this._appSettings.getBooleanAppSetting("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this._keepInForeverDisconnectedState||this._dependentServices.forEach((function(e){return e.stop(),!0})),this._eventSource.raiseEvent(e.ConnectedStateChangedEventKey,n,null)},e.prototype.FixCaseForClientID=function(e){return e.toLowerCase()},e.prototype.onPresenceUpdated=function(t,n){var r=this;if(!this._isAppShuttingDown()){var i=this.CreateDeserializedPresenceDictionary(n.get_updatedClients()),o=this.CreateDisconnectedClientsList(n.get_disconnectedClients()),a=new Ze.m(i,o,this._aggregator),s=new re.c(0,1,0,(function(t){r._eventSource.raiseEvent(e.PresenceUpdatedEventKey,a,null)}),57,null,!1);this._taskManager.addTask(s)}},e.prototype.CreateDeserializedPresenceDictionary=function(e){var t={};for(var n in e){var r={key:n,value:e[n]},i=this.deserializePresenceInfo(r.value);i&&i.isValid()?t[this.FixCaseForClientID(r.key)]=i:F.ULS.sendTraceTag(4564932,302,50,"No Valid User {0}",Je.x.serialize(r.value))}return t},e.prototype.CreateDisconnectedClientsList=function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=this.FixCaseForClientID(e[n]);return t},e.prototype.onPersistentStateUpdated=function(t,n){var r=this;if(!this._isAppShuttingDown()){var i={},o=n.get_updatedClients();for(var a in o){var s={key:a,value:o[a]};i[this.FixCaseForClientID(s.key)]=s.value}var l=new re.c(0,1,0,(function(t){r._eventSource.raiseEvent(e.PersistentStateUpdatedEventKey,new Qe.k(n.get_type(),i),null)}),80,null,!1);this._taskManager.addTask(l)}},e.prototype.onPersistentStateCleared=function(t,n){var r=this;if(!this._isAppShuttingDown()){var i=this.CreateDisconnectedClientsList(n.get_clientsCleared()),o=new Ke.m(i),a=new re.c(0,1,0,(function(t){r._eventSource.raiseEvent(e.PersistentStateClearedEventKey,o,null)}),81,null,!1);this._taskManager.addTask(a)}},e.prototype.onUpdateNotificationReceived=function(e,t){var n=this;if(he.AFrameworkApplication.logUniqueFlightedSettingUsage("Microsoft.Office.Web.SessionSettings.IWacWordUpdateNotificationTaskExperimentSettings"),this._isUpdateNotificationSynchronized)this.OnUpdateNotificationReceivedInternal(t);else{var r=new re.c(0,1,0,(function(e){n.OnUpdateNotificationReceivedInternal(t)}),58,null,!1);this._taskManager.addTask(r)}},e.prototype.OnUpdateNotificationReceivedInternal=function(t){var n=Date.now();this._eventSource.raiseEvent(e.UpdateNotificationEventKey,t,null);var r=Date.now()-n;r>=e.UpdateNotificationRuntimeThreshold&&(this._updateNotificationHighRuntimeCount++,F.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",t.get_type(),r),this.FindUpdateNotificationTypeHeuristics(t)),this._updateNotificationTotal++},e.prototype.FindUpdateNotificationTypeHeuristics=function(e){e.get_type()<0||e.get_type()>=12?F.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",e.get_type()):this._updateNotificationTypeCountBuckets[e.get_type()]++},e.prototype.LogUpdateNotificationHeuristics=function(){if(!this._isHistogramLogged){var e={};e.TC=this._updateNotificationTotal,e.HRC=this._updateNotificationHighRuntimeCount,this._updateNotificationTypeCountBuckets&&this._updateNotificationHighRuntimeCount>0&&(e.TBC=this._updateNotificationTypeCountBuckets),this._updateNotificationTotal=0,this._updateNotificationHighRuntimeCount=0,this._updateNotificationTypeCountBuckets=null,F.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",e),this._isHistogramLogged=!0}},e.prototype.dispose=function(){var e=this;this._dependentServices=new Xe.o(je.r,null),this._rtc.remove_connectionStateChanged(i.i(this,this.onConnectionStateChanged,"onConnectionStateChanged")),this._rtc.remove_presenceUpdated(i.i(this,this.onPresenceUpdated,"onPresenceUpdated")),this._rtc.remove_persistentStateUpdated(i.i(this,this.onPersistentStateUpdated,"onPersistentStateUpdated")),this._rtc.remove_persistentStateCleared(i.i(this,this.onPersistentStateCleared,"onPersistentStateCleared")),this._rtc.remove_updateNotificationReceived(i.i(this,this.onUpdateNotificationReceived,"onUpdateNotificationReceived")),this._coauthManagerAsync&&this._coauthManagerAsync.CW((function(t){e._coauthManagerAsync.get_isCanceled()||e._coauthManagerAsync.get_isFaulted()||e._coauthManagerAsync.get_result().remove_amIAloneChanged(i.i(e,e.onAmIAloneChanged,"onAmIAloneChanged"))})),this._rtc.disconnect(),F.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")},e.prototype.onAmIAloneChanged=function(e,t){this.connectToRtcIfInCoauthSessionAndDisconnectFromRtcIfAlone()},e.prototype.connectToRtcIfInCoauthSessionAndDisconnectFromRtcIfAlone=function(){var e=this,t=!1;if(!this._coauthManagerAsync)return this.connect(),void F.ULS.sendTraceTag(50931285,302,15,"Connecting to rtc on boot");this._coauthManagerAsync.CW((function(n){e._coauthManagerAsync.get_isCanceled()||e._coauthManagerAsync.get_isFaulted()||(t=!e._coauthManagerAsync.get_result().get_amIAlone()),e._rtc.get_connectionState()||!t&&!e._forceConnectionToRtc()?2!==e._rtc.get_connectionState()||t||(e.disconnect(),F.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(e.connect(),F.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc")),!e._loggedFirstConnection&&t&&(F.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),e._loggedFirstConnection=!0)}))},e.prototype.disconnectForever=function(){this._keepInForeverDisconnectedState=!0,this.disconnect(),F.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")},e.PresenceUpdatedEventKey="PU",e.UpdateNotificationEventKey="UN",e.ConnectedStateChangedEventKey="CSC",e.PersistentStateUpdatedEventKey="PSU",e.PersistentStateClearedEventKey="PSC",e.UpdateNotificationRuntimeThreshold=500,e}();(0,i.l)(et,"b5e9957$RtcProxy",null,[Ne.z,Sys.IDisposable,qe.j,ze]);var tt=n(3127),nt=n(7664),rt=n(3040),it=function(e){function t(t,n,r,i,o,a,s,l,u,c,d,p,g,h){var _=this;return _._statusBarUser=null,_._paragraphWordIdMapping=null,_._translator=null,_._lazyobjectSpace=null,_._packetIdGenerator=null,_._statusBarUserGetter=null,_._wordPresenceCpFactory=null,(_=e.call(this,t,n,r,i,o,a,g,h)||this)._paragraphWordIdMapping=s,_._translator=l,_._lazyobjectSpace=u,_._packetIdGenerator=c,_._statusBarUserGetter=d,_._wordPresenceCpFactory=p,_}return(0,L.t)(t,e),t.prototype.get_StatusBarUser=function(){return this._statusBarUser||(this._statusBarUser=this._statusBarUserGetter())},t.prototype.onConnectionStateChanged=function(t,n){2===n.get_newState()&&F.ULS.sendTraceTag(4315102,302,50,"RTC Connected"),this.UpdateRtcConnectionStatusDisplay(),e.prototype.onConnectionStateChanged.call(this,t,n)},t.prototype.UpdateRtcConnectionStatusDisplay=function(){this.get_StatusBarUser()&&this.get_StatusBarUser().pollControl(t.RtcConnectionStatusLabelId)},t.prototype.deserializePresenceInfo=function(e){return nt.m.createFromRTTData(tt.e.versionedDeserialize(e),this._paragraphWordIdMapping,this._translator,this._lazyobjectSpace.get_value(),this._wordPresenceCpFactory)},t.prototype.serializePresenceInfo=function(t,n){if(i.r(rt.t,n)){var r=new nt.m(this._packetIdGenerator.getNextPacketId(),t,n);return tt.e.versionedSerialize(r.getSerializedData())}return e.prototype.serializePresenceInfo.call(this,t,n)},t.RtcConnectionStatusLabelId="RtcConnectionStatusLabel",t}(et);(0,i.l)(it,"90f9ec3a$WordRtcProxy",et,[]);var ot=n(4422),at=function(e){function t(t){var n=e.call(this,qe.j)||this;return n.$$this=null,n.$$v_0_rtcPrxy=null,n._awaiting=null,n._state=0,n.$$this=t,n._nextMethod=n.$$sm_0_initial,n.moveNext(),n}return(0,L.t)(t,e),t.prototype.$$sm_0_initial=function(){return this._awaiting=this.$$this.getInstanceAsync().G(),this._awaiting.get_isCompleted()||(this._state=2,this._awaiting.onCompleted(i.i(this,this.moveNext,"moveNext"))),this.$$sm_1_after_await},t.prototype.$$sm_1_after_await=function(){this.$$v_0_rtcPrxy=this._awaiting.getResult(),this.set_result(this.$$v_0_rtcPrxy),this.dispose(),this._state=3,this.setCompleted(!0)},t.prototype.dispose=function(){},t.prototype.moveNext=function(){try{for(this._state=1;1===this._state;)this._nextMethod=this._nextMethod()}catch(e){this.dispose(),this.set_exception(e),this._state=3}},t}(ot.Task$1);(0,i.l)(at,"8331b06$$$sm_WordEditor$Presence$WordRtcProxyProvider$GetInstanceAsRealtimeChannelBasicAsync",ot.Task$1.$$(qe.j),[Sys.IDisposable]);var st=function(){function e(e,t,n,r,i,o,a,s,l,u,c,d,p){this._buildVersion=null,this._stopwatchBuilder=null,this._taskManager=null,this._isAppShuttingDown=null,this._myPresenceUser=null,this._paragraphWordIdMapping=null,this._wordTextOffsetTranslator=null,this._lazyObjectSpace=null,this._packetIdGenerator=null,this._statusBarUserGetter=null,this._sessionExpirationManagerFuture=null,this._wordPresenceCpFactory=null,this._appSettingsManager=null,this._shouldTryCreatingRtcInstance=!0,this._tcs=new He.z(Ne.z),this._buildVersion=e,this._stopwatchBuilder=t,this._taskManager=n,this._isAppShuttingDown=r,this._myPresenceUser=i,this._paragraphWordIdMapping=o,this._wordTextOffsetTranslator=a,this._lazyObjectSpace=s,this._packetIdGenerator=l,this._statusBarUserGetter=u,this._sessionExpirationManagerFuture=c,this._wordPresenceCpFactory=d,this._appSettingsManager=p}return e.prototype.getInstanceAsync=function(){return this.TryCreateInstanceAsync(),this._tcs.get_task()},e.prototype.getInstanceAsRealtimeChannelBasicAsync=function(){return new at(this)},e.prototype.TryCreateInstanceAsync=function(){if(this._shouldTryCreatingRtcInstance)if(this._shouldTryCreatingRtcInstance=!1,ye.App.isSignalRLoaded()&&ye.App.isJQueryLoaded()){var t=he.AFrameworkApplication.theClientRequestManager;if(t){var n="{"+he.AFrameworkApplication.userSessionId+"}",r=he.AFrameworkApplication.userSessionId,i=he.AFrameworkApplication.rtcTransportProtocol,o=We.RealtimeChannel.createInstance(n,r,i,t,this._sessionExpirationManagerFuture,1,this._stopwatchBuilder,this._appSettingsManager.getStringAppSetting("RtcEndpointUrl"),null,null,this._appSettingsManager.getBooleanAppSetting("FindSessionOnBootIsEnabled")?fe.w.get_instance().resolve(Be.a):null),a=new it(o,this._appSettingsManager.getBooleanAppSetting("StartRTCOnBootIsEnabled")?null:ye.App.get_theCoauthManagerAsync(),this._taskManager,this._isAppShuttingDown,e.ForceConnectionToRtc,this._myPresenceUser,this._paragraphWordIdMapping,this._wordTextOffsetTranslator,this._lazyObjectSpace,this._packetIdGenerator,this._statusBarUserGetter,this._wordPresenceCpFactory,he.AFrameworkApplication.appSettingsManager,$e.n.$$(Number).getAnInstance(22,1,new Ge.c(Number,null),!0,null));ye.App.setRealtimeChennelBasic(a),a.init(),Ve.App.rtcProxyController=a,this._sessionExpirationManagerFuture.execute((function(e){e.add_onSessionExpired((function(e,t){a.disconnectForever()}))})),this._tcs.setResult(a)}else F.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else F.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")},e.ForceConnectionToRtc=function(){return!1},e}();(0,i.l)(st,"285bf97b$WordRtcProxyProvider",null,[g.q,h.w]);var lt=n(523),ut=n(4537),ct=function(){function e(){this._container=null,this._disposed=!1}return e.prototype.get_name=function(){return"WordEditor.Presence"},e.prototype.init=function(){F.ULS.sendTraceTag(50995799,302,15,"PresencePackage Init"),ye.App.wordEditorPresenceIsEnabled&&(this._container.resolve(st).getInstanceAsync(),Ue.o.init(),this._container.resolve(Le)),ye.App.contentNotificationIsEnabled&&Pe.init(),this._container.resolve(ie),this._container.resolve(o.d)},e.prototype.dispose=function(){if(!this._disposed){this._disposed=!0,Ue.o.getInstanceAsync().CW((function(e){z.d.safeDispose(Ue.o.getInstanceAsync().get_result())}));var e=this._container.resolve(ve.MyPresenceUser);e&&e.get_presenceStatusProvider()&&e.get_presenceStatusProvider().remove_presenceStatusUpdated(Ue.o.OnPresenceStatusUpdated)}},e.prototype.configure=function(t){this._container=t,this._container.register(ve.MyPresenceUser).as(a.y).as(s.t).as(l.r).singleInstance().usingFactory((function(){return new ve.MyPresenceUser})),t.register(u.u).singleInstance().usingFactory((function(){return new Oe(t.resolve(Ie.i),t.resolve(c.c))})),t.register(Le).singleInstance().usingFactory((function(){return new Le(new P.q(d.g,(function(){return ye.App.get_theCoauthManager()})),ut.n.get_instance(),t.resolve(st).getInstanceAsRealtimeChannelBasicAsync(),t.resolve(a.y),t.resolve(p.a))})),t.register(st).singleInstance().as(g.q).as(h.w).usingFactory((function(){return new st(he.AFrameworkApplication.buildVersion,ye.App.get_activeAppFrame().get_theStopwatchBuilder(),_e.y.get_instance(),(function(){return he.AFrameworkApplication.isShuttingDown}),fe.w.get_instance().resolve(a.y),fe.w.get_instance().tryResolve(lt.h),fe.w.get_instance().resolve(_.l),new P.q(f.f,(function(){return ye.App.get_activeAppFrame().workspace.get_activePage().get_contentObjectSpace()})),Ce.k.get_instance(),(function(){return fe.w.get_instance().tryResolve(m.f)}),fe.w.get_instance().resolveFuture(y.k),fe.w.get_instance().resolve(u.u),he.AFrameworkApplication.appSettingsManager)})),t.register(Se.m).singleInstance().usingFactory((function(){return new Se.m(e.CreateTooltipFactory(),U.z.get_instance(),fe.w.get_instance().resolveFuture(v.w),fe.w.get_instance().resolve(p.a),me.q.taskFromFuture(S.x,fe.w.get_instance().resolveFuture(S.x)),he.AFrameworkApplication.appSettingsManager)})),t.register(ie).singleInstance().usingFactory((function(){return new ie(fe.w.get_instance().resolve(s.t),fe.w.get_instance().resolve(st).getInstanceAsRealtimeChannelBasicAsync(),Ue.o.getPresenceRemoverAsync(),fe.w.get_instance().resolve(l.r),_e.y.get_instance(),he.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AwayStatusOneMinuteTimeoutIsEnabled")?6e4:he.AFrameworkApplication.appSettingsManager.getIntAppSetting("AwayCoauthorThresholdMs",9e5),i.i(he.AFrameworkApplication.get_theActionManager(),he.AFrameworkApplication.get_theActionManager().processAction,"processAction"),ye.App.get_activeAppFrame().get_notificationBar(),he.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled"))})),t.register(xe).singleInstance().as(I.d).usingFactory((function(){return new xe(me.q.taskFromFuture(C.y,fe.w.get_instance().resolveFuture(C.y)))})),t.register(ge).singleInstance().as(o.d).usingFactory((function(){return new ge(t.resolve(st).getInstanceAsRealtimeChannelBasicAsync(),ye.App.get_theCoauthManagerAsync().CWR(T.l,(function(e){return ye.App.get_theCoauthManagerAsync().get_result().get_theEditorsTableManager()})),t.resolve(b.r),t.resolve(l.r))}))},e.CreateTooltipFactory=function(){var t=he.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled"),n=new Y;return n.add(String,0,j.ImageClusteringHelper.getImageClassWithCluster(he.AFrameworkApplication.get_imageClusterName(),e.MultiUserIconClassName)),n.add(String,5,he.AFrameworkApplication.get_imageClusterPath()),n.add(String,1,j.ImageClusteringHelper.getImageClassWithCluster(he.AFrameworkApplication.get_imageClusterName(),t?e.ModernUserIconClassName:e.SingleUserIconClassName)),n.add(String,4,he.AFrameworkApplication.get_imageClusterPath()),n.add(Number,12,1),n.add(Boolean,8,he.AFrameworkApplication.get_isRtl()),t?new x(n):new X(n)},e.SingleUserIconClassName="SingleCollabUserGlyph16",e.ModernUserIconClassName="DoughboyWhiteGlyph_20x20x32",e.MultiUserIconClassName="MoreUsersGlyph16",e}();(0,i.l)(ct,"75040eb0$WordPresencePackage",null,[A.u,M.s]),n.d(t,{Program:function(){return dt}});var dt=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new ct,0,!1)},e}();(0,i.l)(dt,"d1c3c949$Program",null,[])},7929:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var r=n(3545),i=n(423),o=function(e){function t(t,n){var r=e.call(this)||this;return r.type=0,r.updatedClients=null,r.type=t,r.updatedClients=n,r}return(0,r.t)(t,e),t.prototype.get_type=function(){return this.type},t.prototype.get_updatedClients=function(){return this.updatedClients},t}(Sys.EventArgs);(0,i.l)(o,"c4eb77cb$PersistentStateUpdateEventArgs",Sys.EventArgs,[])},7970:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(6182),o=n(363),a=n(8192),s=n(2575),l=function(){return function(){}}();(0,r.l)(l,"aea33d4f$EventTimingData",null,[]);var u=n(1135),c=n(2612),d=n(1526),p=n(1323),g=n(1874),h=n(1282);n.d(t,{EventTimingMeterPackage:function(){return _}});var _=function(){function e(){this._aggregateEventTimingHandler=null}return e.prototype.configure=function(e){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EventTimingMeterIsEnabled")&&e.register(i.w).singleInstance().usingFactory((function(){return new EventTiming.EventTimingMeter}))},e.prototype.get_name=function(){return"Common.App.EventTimingMeter"},e.prototype.init=function(){var e=new h.z(s.AFrameworkApplication.appSettingsManager.getIntAppSetting("EventTimingMeterEventSamplingPercent",0)/100),t=new g.m(l,r.i(e,e.shouldBeInSample,"shouldBeInSample")),n=p.n.$$(l).getAnInstance(16,1,t,!0,null);this._aggregateEventTimingHandler=function(e){for(var t=0,r=e.rawEvent.detail;t<r.length;t++){var i=r[t];n.track(i,"EventTimingData")}},c.n.addHandler(window.self,u.d.aggregateEventTiming,this._aggregateEventTimingHandler)},e.prototype.dispose=function(){this._aggregateEventTimingHandler&&(c.n.removeHandler(window.self,u.d.aggregateEventTiming,this._aggregateEventTimingHandler),this._aggregateEventTimingHandler=null)},e.main=function(){d.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(_,"3c68ca8$EventTimingMeterPackage",null,[o.u,a.s])},8089:function(e,t,n){Type.registerNamespace("Box4.ParagraphRenderMetrics"),Type.registerNamespace("Common.App.ParagraphRenderMetrics"),n(1381).ParagraphRenderMetricsPackage.main(),Type.registerNamespace("Box4.Symbols"),n(7482).Box4SymbolsPackage.main(),Type.registerNamespace("Common.App.AccessibilityChecker"),Type.registerNamespace("Common.App.Assistance"),n(559).default,Type.registerNamespace("CACPU"),n(2536).CpuMeterPackage.main(),Type.registerNamespace("CAEventTimingMeter"),n(7970).EventTimingMeterPackage.main(),Type.registerNamespace("Common.App.GestureInput"),n(1759).GestureInputPackage.main(),Type.registerNamespace("Common.App.GestureManager"),n(8482).GestureInputManagerPackage.main(),Type.registerNamespace("Common.App.OfflineLogger"),n(135).PackageManager.main(),Type.registerNamespace("Common.App.O365Shell"),n(2052).PackageManager.main(),Type.registerNamespace("Common.App.SensitiveLogging"),n(757).SensitiveLoggingPackage.main(),Type.registerNamespace("Common.App.Rename"),n(1502).Program.main(),Type.registerNamespace("Common.App.Rename.RenameExecutor"),n(2347).Program.main(),Type.registerNamespace("Common.App.VersionHistory"),n(9697).Program.main(),Type.registerNamespace("Common.App.VersionHistory.VersionHistoryExecutor"),n(6346).Program.main(),Type.registerNamespace("Common.App.SaveAsToHost"),n(8586).SaveAsToHostPackage.main(),Type.registerNamespace("Common.App.SaveToCloudStorage"),n(9695).PackageManager.main(),Type.registerNamespace("Common.App.SaveACopy"),n(5484).PackageManager.main(),Type.registerNamespace("Common.App.SaveToSharePoint"),n(1357).PackageManager.main(),Type.registerNamespace("Common"),Type.registerNamespace("Common.App.SkypeChat"),n(361).SkypeChatPackage.main(),Type.registerNamespace("Common.App.TellMe"),Type.registerNamespace("Common.App.TellMe.Suggestions.LRModel"),Type.registerNamespace("CATypingSpeedMeter"),n(2206).TypingSpeedMeterPackage.main(),Type.registerNamespace("Box4.AccessibilityChecker"),n(6222).default,Type.registerNamespace("Wonca.SkypeChat"),Type.registerNamespace("WordEditor.FrameTiming"),n(5128).FrameTimingPackageManager.main(),Type.registerNamespace("WordEditor.Pagination"),n(9200).Program.main(),Type.registerNamespace("WEDSM"),n(8660).WordEditorDocxSaveMonitorPackage.main(),Type.registerNamespace("WEFP"),n(1044).default,n(9149).WordEditorFormatPicturePackage.main(),Type.registerNamespace("Common.App.VersionHistory"),Type.registerNamespace("WordEditor.VersionHistory"),n(6628).Program.main(),Type.registerNamespace("WordEditor.GraphMerge"),n(4130).ATextMergeBlock.prototype.toString=n(1388).AMergeBlock.prototype.toString,n(9495).ParagraphMergeUtils.graphNodeComplexMergeFactory=new(n(2186).GraphNodeComplexMergeFactory),n(6642).Program.Main(),Type.registerNamespace("WordEditor.Zoom"),n(6154).ZoomPackage.main(),Type.registerNamespace("WordEditor.AccessibilityChecker"),n(865).Program.main(),Type.registerNamespace("WordEditor.PageBreak"),n(7701).Program.main(),Type.registerNamespace("WordEditor.TellMe"),n(5380).default;var r;n(5554).default;n(4621).Program.main(),Type.registerNamespace("WETF"),n(8925).WordEditorTestFeaturePackage.main(),Type.registerNamespace("WordEditor.WetChangeLockHistogramTelemetry"),n(525).Program.main(),Type.registerNamespace("AppRealtimeChannel"),Type.registerNamespace("B4RT"),n(4019).Program.main(),Type.registerNamespace("WordEditor.InteractivePerfTaskPane"),n(9882).default,n(3486).InteractivePerfTaskPanePackageManager.main(),Type.registerNamespace("WordEditor.SkypeChat"),n(7073).Program.main(),Type.registerNamespace("WordEditor.TrackChange"),n(2096).ActorProgram.main(),Type.registerNamespace("Common.App.CoauthTelemetry"),n(5093).CoauthTelemetryPackage.main(),Type.registerNamespace("Common.App.CollabControls"),Type.registerNamespace("BPr"),n(9562).PresenceUser.prototype.toString=n(7065).PresenceUser.prototype.toString,n(7282).MyPresenceUser.prototype.toString=n(7065).PresenceUser.prototype.toString,Type.registerNamespace("Box4.Presence"),Type.registerNamespace("WordEditor.Presence"),n(7905).Program.main(),Type.registerNamespace("WERTT"),n(5003).WordEditorRealTimeTypingPackage.main(),Type.registerNamespace("RealtimePresenceUI"),Type.registerNamespace("RealtimePresenceUI"),Type.registerNamespace("RealtimePresenceUI"),Type.registerNamespace("WordEditor.PeoplesWellControl"),n(8894).Program.main(),Type.registerNamespace("NLRT"),function(e){var t=function(){function e(){this.events=[]}return e.keySequenceShouldBeTimedFromKeyDown=function(t){return t.ctrlKey&&"Control"!==t.key||t.altKey&&"Alt"!==t.key||!!e.keyDownKeysToProcess[t.key]},e.buildMetadata=function(t){var n,r;return n=e.keySequenceShouldBeTimedFromKeyDown(t)?t.key:" "===t.key?"Space":"CharacterKey",(r={}).altPressed=(!!t.altKey).toString(),r.ctrlPressed=(!!t.ctrlKey).toString(),r.key=n,r.repeat=(!!t.repeat).toString(),r.shiftPressed=(!!t.shiftKey).toString(),r},e.isPerformanceNowBased=function(e){return window.performance&&window.performance.now&&e.timeStamp<performance.now()},e.eventShouldBeTimedFromKeyDown=function(t){return!!t&&e.isPerformanceNowBased(t)&&e.keySequenceShouldBeTimedFromKeyDown(t)},e.eventShouldBeTimedFromKeyPress=function(t){return!!t&&e.isPerformanceNowBased(t)&&!e.keySequenceShouldBeTimedFromKeyDown(t)},e.prototype.keyPressedEventHandlerStart=function(t){e.eventShouldBeTimedFromKeyPress(t)&&this.startTimingKeyEvent(t)},e.prototype.keyPressedEventHandlerEnd=function(t){e.eventShouldBeTimedFromKeyPress(t)&&this.stopTimingKeyEvent(t)},e.prototype.keyDownEventHandlerStart=function(t){e.eventShouldBeTimedFromKeyDown(t)&&this.startTimingKeyEvent(t)},e.prototype.keyDownEventHandlerEnd=function(t){e.eventShouldBeTimedFromKeyDown(t)&&this.stopTimingKeyEvent(t)},e.prototype.startTimingKeyEvent=function(t){var n,r=((n={}).metadata=e.buildMetadata(t),n.timeStamp=t.timeStamp,n.timeToHandlerFinishMs=0,n.timeToHandlerStartMs=performance.now()-t.timeStamp,n.eventDurationMs=0,n.timeToRequestAnimationFrameMs=0,n);this.events.push(r),this.registerRequestAnimationFrameCallback()},e.prototype.stopTimingKeyEvent=function(e){if(0!==this.events.length)for(var t=this.events.length-1;t>=0;t-=1){var n=this.events[t];if(n.timeStamp===e.timeStamp){n.timeToHandlerFinishMs=performance.now()-e.timeStamp,n.eventDurationMs=n.timeToHandlerFinishMs-n.timeToHandlerStartMs;break}}},e.prototype.registerRequestAnimationFrameCallback=function(){var e=this;this.requestAnimationFrameCallbackRegistered||(requestAnimationFrame((function(){e.requestAnimationFrameCallbackRegistered=!1;var t=performance.now();e.events.forEach((function(e){e.timeToRequestAnimationFrameMs=t-e.timeStamp}));var n=document.createEvent("CustomEvent");n.initCustomEvent("aggregateeventtiming",!1,!1,e.events.slice(0)),dispatchEvent(n),e.events=[]})),this.requestAnimationFrameCallbackRegistered=!0)},e.keyDownKeysToProcess={ArrowDown:!0,ArrowLeft:!0,ArrowRight:!0,ArrowUp:!0,Backspace:!0,Delete:!0,End:!0,Enter:!0,Escape:!0,Home:!0,PageDown:!0,PageUp:!0,Tab:!0},e}();e.EventTimingMeter=t}(r||(r={})),function(e){var t=function(){function e(){var t=this;this.maxFrameLength=null,this.lastMeasuredTime=null,this.measuringLoopId=null,this.reportingLoopId=null,this.isStarted=!1,this.reportIntervalStartTime=null,this.frameCounts=[],this.updateMeasureCurrentFrameLoop=function(){e.isPageVisible()&&null==t.measuringLoopId?(t.lastMeasuredTime=null,t.measuringLoopId=requestAnimationFrame(t.measureCurrentFrame)):null!=t.measuringLoopId&&(cancelAnimationFrame(t.measuringLoopId),t.measuringLoopId=null)},this.measureCurrentFrame=function(n){if(null!=t.lastMeasuredTime){var r=n-t.lastMeasuredTime;(null==t.maxFrameLength||t.maxFrameLength<r)&&(t.maxFrameLength=r);for(var i=0;i<e.ranges.length;++i)if(r<e.ranges[i]){++t.frameCounts[i];break}}t.lastMeasuredTime=n,t.measuringLoopId=requestAnimationFrame(t.measureCurrentFrame)},this.reportMeasuredFrames=function(){if(null!=t.maxFrameLength){for(var n={},r=0;r<e.ranges.length;++r)n[e.ranges[r]]=t.frameCounts[r],t.frameCounts[r]=0;var i,o=performance.now(),a=((i={}).intervalStart=t.reportIntervalStartTime,i.intervalEnd=o,i.maxFrameLengthMs=t.maxFrameLength,i.frameData=n,i),s=document.createEvent("CustomEvent");s.initCustomEvent("reportframetiming",!1,!1,a),dispatchEvent(s),t.maxFrameLength=null,t.reportIntervalStartTime=o}}}return e.isPerformanceNowSupported=function(){return!!window.performance&&!!window.performance.now},e.prototype.start=function(t){!this.isStarted&&e.isPerformanceNowSupported()&&(this.setupArrays(),this.reportingLoopId=setInterval(this.reportMeasuredFrames,1e3*t),this.reportIntervalStartTime=performance.now(),this.updateMeasureCurrentFrameLoop(),document.addEventListener("visibilitychange",this.updateMeasureCurrentFrameLoop),this.isStarted=!0)},e.prototype.stop=function(){this.isStarted&&(document.removeEventListener("visibilitychange",this.updateMeasureCurrentFrameLoop),null!=this.reportingLoopId&&(clearInterval(this.reportingLoopId),this.reportingLoopId=null),null!=this.measuringLoopId&&(cancelAnimationFrame(this.measuringLoopId),this.measuringLoopId=null),this.reportMeasuredFrames(),this.isStarted=!1)},Object.defineProperty(e.prototype,"isRunning",{get:function(){return this.isStarted},enumerable:!0,configurable:!0}),e.prototype.setupArrays=function(){this.frameCounts=[];for(var t=0;t<e.ranges.length;++t)this.frameCounts.push(0)},e.isPageVisible=function(){return"visible"===document.visibilityState},e.ranges=[17,34,42,67,100,200,400,800,1e3,1500,2e3,3e3,Number.POSITIVE_INFINITY],e}();e.FrameTimingMeter=t}(r||(r={})),window.EventTiming=r},8114:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var r,i=n(423);!function(e){e[e.error=0]="error",e[e.warning=1]="warning",e[e.tip=2]="tip",e[e.intelligentService=3]="intelligentService"}(r||(r={})),(0,i.h)("eb7ca39$AccessibilityRuleCategory",r)},8129:function(e,t,n){"use strict";var r=n(3234),i=n(9402),o=n(1308),a=n(1546),s=n(423),l=function(){function e(e){this._cp=0,this._cp=e}return e.prototype.get_cp=function(){return this._cp},e.prototype.equals=function(e){var t=e;return!!t&&this.get_cp()===t.get_cp()},e.prototype.clone=function(){return new e(this._cp)},e}();(0,s.l)(l,"e4553494$PresenceCp",null,[a.i,i.v.$$(a.i)]);var u=function(){return function(e,t,n,r){this.paragraphId=e,this.cp=t,this.length=n,this.shapeId=r}}();(0,s.l)(u,"3a1020b7$SerializablePresenceIpData",null,[]),n.d(t,{b:function(){return c}});var c=function(){function e(e,t,n,r){this.$$pf_ParagraphId=null,this.$$pf_PresenceCp=null,this.$$pf_ParagraphVersionRep=0,this.$$pf_ShapeId=0,e&&this.set_paragraphId(o.h.createFromString(e)),this.set_presenceCp(new l(t)),this.set_paragraphVersionRep(n),this.set_shapeId(r)}return e.prototype.get_paragraphId=function(){return this.$$pf_ParagraphId},e.prototype.set_paragraphId=function(e){return this.$$pf_ParagraphId=e,e},e.prototype.get_presenceCp=function(){return this.$$pf_PresenceCp},e.prototype.set_presenceCp=function(e){return this.$$pf_PresenceCp=e,e},e.prototype.get_paragraphVersionRep=function(){return this.$$pf_ParagraphVersionRep},e.prototype.set_paragraphVersionRep=function(e){return this.$$pf_ParagraphVersionRep=e,e},e.prototype.get_shapeId=function(){return this.$$pf_ShapeId},e.prototype.set_shapeId=function(e){return this.$$pf_ShapeId=e,e},e.prototype.isValid=function(){return this.get_presenceCp().get_cp()>=0&&!!this.get_paragraphId()&&!this.get_paragraphId().equals(o.h.get_nil())},e.prototype.getData=function(){return new u(this.get_paragraphId().toString(),this.get_presenceCp().get_cp(),this.get_paragraphVersionRep(),this.get_shapeId())},e.prototype.clone=function(){var t=new e;return t.set_paragraphId(this.get_paragraphId()),t.set_presenceCp(this.get_presenceCp()?this.get_presenceCp().clone():null),t.set_paragraphVersionRep(this.get_paragraphVersionRep()),t.set_shapeId(this.get_shapeId()),t},e.CreateFromPlainData=function(t){return!t.paragraphId||isNullOrUndefined(t.cp)||isNullOrUndefined(t.length)?null:new e(t.paragraphId,t.cp,t.length,0)},e}();(0,s.l)(c,"8f2b41e$PresenceIp",null,[r.n,i.v.$$(r.n)])},8361:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});var r=(0,n(423).y)("8aa7778e$IRtcDependentService")},8466:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});var r=n(1308),i=n(5479),o=n(423),a=function(){function e(){this.insertedRuns=null,this.deletedRuns=null,this.previousRunFormattings=null,this.insertedAuthors=null,this.deletedAuthors=null,this.previousRunFormattingAuthors=null,this.insertedTimestampsInEpoch=null,this.deletedTimestampsInEpoch=null,this.previousRunFormattingTimestampsInEpoch=null,this.previousRunFormattingIds=null,this.reset()}return e.prototype.reset=function(){this.insertedRuns=new i.o(Boolean,null),this.deletedRuns=new i.o(Boolean,null),this.previousRunFormattings=new i.o(Boolean,null),this.insertedAuthors=new i.o(String,null),this.deletedAuthors=new i.o(String,null),this.previousRunFormattingAuthors=new i.o(String,null),this.insertedTimestampsInEpoch=new i.o(Number,null),this.deletedTimestampsInEpoch=new i.o(Number,null),this.deletedTimestampsInEpoch=new i.o(Number,null),this.previousRunFormattingTimestampsInEpoch=new i.o(Number,null),this.previousRunFormattingIds=new i.o(r.h,null)},e.prototype.validatePropertySizesMatch=function(e){return this.HasExpectedSize(Boolean,this.insertedRuns,e)&&this.HasExpectedSize(Boolean,this.deletedRuns,e)&&this.HasExpectedSize(Boolean,this.previousRunFormattings,e)&&this.HasExpectedSize(String,this.insertedAuthors,e)&&this.HasExpectedSize(String,this.deletedAuthors,e)&&this.HasExpectedSize(String,this.previousRunFormattingAuthors,e)&&this.HasExpectedSize(Number,this.insertedTimestampsInEpoch,e)&&this.HasExpectedSize(Number,this.deletedTimestampsInEpoch,e)&&this.HasExpectedSize(Number,this.previousRunFormattingTimestampsInEpoch,e)&&this.HasExpectedSize(r.h,this.previousRunFormattingIds,e)},e.prototype.HasExpectedSize=function(e,t,n){return!t||!t.get_length()||t.get_length()===n},e}();(0,o.l)(a,"b821c40c$MergeableTrackedChangesProperties",null,[])},8482:function(e,t,n){"use strict";n.r(t);var r=n(9795),i=n(363),o=n(8192),a=n(3545),s=n(423),l=(0,s.y)("1117fc9f$IHammerManager"),u=n(5541),c=n(5214),d=n(1822),p=n(2612),g=n(6720),h=n(7847),_=n(5398),f=n(7597),m=function(){return function(){this.gestureAdapter=null,this.recognizer=null}}();(0,s.l)(m,"392de305$GestureAdapterInfo",null,[]);var y=(0,s.y)("55cf98ab$IHammerJsDependencyLoader"),v=n(2575),S=n(3608),I=n(7167),C=function(){function e(){this._dependenciesTask=null}return e.prototype.loadDependenciesAsync=function(){if(!this._dependenciesTask){var t=v.AFrameworkApplication.scriptUrlFromName(String.format("{0}",e.HammerJSName),5),n=I.v.create(t,null,null);S.z.enqueueResourceWithoutEnabling(n),this._dependenciesTask=n.get_loadFinishedTask()}return this._dependenciesTask},e.get_Instance=function(){return e._instance||(e._instance=new e),e._instance},e.HammerJSName="hammer.min.js",e._instance=null,e}();(0,s.l)(C,"fdb0cfc2$HammerJsDependencyLoader",null,[y]);var T,b=n(1135),A=function(){function e(){}return e.createRecognizer=function(e,t,n){if(isNullOrUndefined(t))throw f.ULS.sendTraceTag(42256258,310,10,"manager cannot be null"),Error.argumentNull("manager can not be null");var r=null;switch(e){case b.d.pinch:r=new Hammer.Pinch(n);break;case b.d.pan:r=new Hammer.Pan(n)}return r&&(r.manager=t),r},e}();(0,s.l)(A,"f160b8b9$RecognizerFactory",null,[]),function(e){e[e.none=-1]="none",e[e.pinch=0]="pinch",e[e.pan=1]="pan",e[e.swipe=2]="swipe"}(T||(T={})),(0,s.h)("b1ecbd25$GestureEvent",T);var M=n(9665),P=function(e){function t(t,n,r,i,o,a,s,l,u){var c=e.call(this,t,r,i,a)||this;return c._shiftKey=!1,c._ctrlKey=!1,c._clientPoint=null,c.gestureData=null,c.isPointerEvent=!1,c._clientPoint=n,c._shiftKey=s,c._ctrlKey=l,c.isPointerEvent=u,c.gestureData=o,c}return(0,a.t)(t,e),t.prototype.get_shiftKey=function(){return this._shiftKey},t.prototype.get_ctrlKey=function(){return this._ctrlKey},t.prototype.get_clientPoint=function(){return this._clientPoint},t.prototype.get_gestureData=function(){return this.gestureData},t.prototype.get_isPointerEvent=function(){return this.isPointerEvent},t.create=function(e,n,r,i,o,a){var s;if(r.rawEvent)if(a){var l=r.rawEvent;s=new Sys.UI.Point(l.clientX,l.clientY)}else s=M.a.getClientPointFromTouchEvent(r);else s=new Sys.UI.Point(r.clientX,r.clientY);return new t(e,s,n,r,i,o,r.shiftKey,r.ctrlKey,a)},t}(M.a);(0,s.l)(P,"218829a2$GestureEventArgs",M.a,[]);var F=function(){return function(){this.pointers=null,this.changedPointers=null,this.pointerType=null,this.srcEvent=null,this.overallVelocityX=0,this.overallVelocityY=0,this.overallVelocity=0,this.distance=0,this.angle=0,this.scale=0,this.rotation=0,this.maxPointers=0,this.target=null,this.center=null,this.additionalEvent=null,this.isFirst=!1,this.isFinal=!1,this.eventType=0,this.deltaX=0,this.deltaY=0,this.timeStamp=0,this.deltaTime=0,this.offsetDirection=null}}();(0,s.l)(F,"ddf643ca$GestureManagerData",null,[]);var w=function(){function e(){}return e.statE_POSSIBLE=1,e.statE_BEGAN=2,e.statE_CHANGED=4,e.statE_ENDED=8,e.statE_RECOGNIZED=8,e.statE_CANCELLED=16,e.statE_FAILED=32,e}();(0,s.l)(w,"1a201d$HammerConstants",null,[]);var R=n(664),E=n(2072),k=n(3249),D=n(6378),O=function(e){function t(){var t=e.call(this)||this;return t.session=null,t.handlers=null,t.element=null,t.curRecognizer=null,t._onGestureEvent=null,t._gestureEvents=null,t._eventHandlerManager=null,t._handled=!1,t._currentGestureTarget=null,t._inputDataName=E.z.gestureAdapterCache,t._pointerEventsEnabled=!!window.PointerEvent,t._touchEventsEnabled=window.hasOwnProperty("ontouchstart"),t._pointerEventsCache=new h.w(Sys.UI.DomEvent),t._gestureRegions=new g.c(Object),t._eventHandlerManager=R.EventHandlerManager.get_instance(),t._pointerEventsEnabled?(t._onGestureEvent=s.i(t,t.OnPointerEvent,"OnPointerEvent"),t._gestureEvents=b.d.get_gesturePointerEvents()):t._touchEventsEnabled?(t._onGestureEvent=s.i(t,t.OnTouchEvent,"OnTouchEvent"),t._gestureEvents=b.d.get_touchEvents()):(t._onGestureEvent=s.i(t,t.OnMouseEvent,"OnMouseEvent"),t._gestureEvents=b.d.get_gestureMouseEvents()),t}return(0,a.t)(t,e),t.prototype.initializeForElement=function(t){e.prototype.initializeForElement.call(this,t),this._eventHandlerManager.initializeListForElement(this._gestureEvents,t,0,this._onGestureEvent)},t.prototype.deinitializeForElement=function(t){e.prototype.deinitializeForElement.call(this,t),this._eventHandlerManager.deinitializeListForElement(t,this._gestureEvents)},t.prototype.registerGestureAdapter=function(e,t,n,r,i){var o=this;v.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MultiTouchGestureIsEnabled")?C.get_Instance().loadDependenciesAsync().CW((function(a){if(!t)throw Error.argumentNull("source element can not be null");var s=k.q.getObject(t,o._inputDataName);isNullOrUndefined(s)&&(s=new h.w(m),k.q.setObject(t,o._inputDataName,s),o.RegisterGestureRegion(t));var l=null;if(s.containsKey(T[e])||(l=(0,c.m)(new m,{recognizer:A.createRecognizer(T[e],o,i),gestureAdapter:n}),s.add(T[e],l)),!isNullOrUndefined(r))for(var u=0;u<r.length;u++)if(s.containsKey(T[r[u]])){var d=s.get_item(T[r[u]]);l.recognizer.recognizeWith(d.recognizer)}})):f.ULS.sendTraceTag(42256219,310,10,"Multi Touch is not enabled either from common BRS or from your app BRS")},t.prototype.unregisterGestureAdapter=function(e,t){f.ULS.sendTraceTag(42256223,310,t?100:10,"source element {0} ",t.id);var n=k.q.getObject(t,this._inputDataName);isNullOrUndefined(n)||(n.remove(T[e]),n.get_count()||this.UnregisterGestureRegion(t))},t.prototype.RegisterGestureRegion=function(e){this._gestureRegions.add(e),this._eventHandlerManager.initializeListForElement(this._gestureEvents,e,0,this._onGestureEvent)},t.prototype.UnregisterGestureRegion=function(e){this._gestureRegions.remove(e),this._eventHandlerManager.deinitializeListForElement(e,this._gestureEvents)},t.prototype.recognize=function(e){for(var t=new Array(e.pointers.length),n=0;n<e.pointers.length;n++)t[n]=e.pointers[n].target;var r=null;for(this._currentGestureTarget=this.getLowestCommonAncestor(t);!isNullOrUndefined(this._currentGestureTarget)&&(r=k.q.getObject(this._currentGestureTarget,this._inputDataName),isNullOrUndefined(r));this._currentGestureTarget=this._currentGestureTarget.parentNode);if(!isNullOrUndefined(r)){this.curRecognizer&&this.curRecognizer.state===w.statE_RECOGNIZED&&(this.curRecognizer=null);for(var i=r.get_keys().$$ge();i.$$mn();){var o=i.$$cu(),a=r.get_item(o);isNullOrUndefined(a)||isNullOrUndefined(a.recognizer)||(isNullOrUndefined(this.curRecognizer)||a.recognizer===this.curRecognizer||a.recognizer.canRecognizeWith(this.curRecognizer))&&a.recognizer.recognize(e);var s=a.recognizer.state;this.curRecognizer||w.statE_BEGAN!==s&&w.statE_CHANGED!==s&&w.statE_ENDED!==s||(this.curRecognizer=a.recognizer)}}},t.prototype.emit=function(e,t){if("hammer.input"!==e){this._handled=!1;var n=null,r=P.create(e,this._currentGestureTarget,t.srcEvent,t,3,this._pointerEventsEnabled),i=k.q.getObject(this._currentGestureTarget,this._inputDataName),o=-1;if(this.IsPinchEvent(e))o=0;else if(this.IsPanEvent(e))o=1;else{if(!this.IsSwipeEvent(e))return void f.ULS.sendTraceTag(42256256,310,15,"Event can not be recognized by current manager");o=2}if(i.tryGetValue(T[o],(0,d.m)((function(){return n}),(function(e){return n=e}))),!isNullOrUndefined(n)){var a=n.gestureAdapter;a.isGesturePossible(r)?e.endsWith("start")?this._handled=a.onGestureStart(r):e.endsWith("end")?(a.onGestureEnd(r),this._handled=!0):e.endsWith("cancel")?(a.onGestureCancel(r),this._handled=!0):e.endsWith("move")&&(this._handled=a.onGestureEvent(r)):f.ULS.sendTraceTag(42256257,310,50,"App rejected to perform gesture now : {0}",e)}}},t.prototype.get=function(e){return(0,u.e)(Hammer.Recognizer,e)},t.prototype.getLowestCommonAncestor=function(e){if(e.length<1)return null;if(1===e.length)return e[0];for(var t=e[0],n=!0,r=1;r<e.length;r++){if(!e[r])return null;if(t!==e[r]){n=!1;break}}if(n)return t;for(var i=this.GetAncestryList(e[0]),o=0,a=0,s=e;a<s.length;a++){var l=s[a],u=this.GetAncestryList(l);if(i.get_item(i.get_count()-1)!==u.get_item(u.get_count()-1))return null;for(var c=i.get_count()-2,d=u.get_count()-2;c>=o&&d>=0;c--,d--)if(i.get_item(c)!==u.get_item(d)){o=c+1;break}}return i.get_item(o)},t.prototype.GetAncestryList=function(e){for(var t=new g.c(Object);!isNullOrUndefined(e);e=e.parentNode)t.add(e);return t},t.prototype.GetInputType=function(e){switch(e){case b.d.touchStart:case b.d.browserPointerDown:return 1;case b.d.touchMove:case b.d.browserPointerMove:return 2;case b.d.touchEnd:case b.d.browserPointerUp:return 4;case b.d.touchCancel:case b.d.browserPointerCancel:return 8}return 0},t.prototype.OnTouchEvent=function(e,t,n){var r=this.GetInputType(e),i=this.GetInputDataFromTouchEvents(n,r);return Hammer.inputHandler(this,r,i),this._handled&&n.preventDefault(),this._handled},t.prototype.OnPointerEvent=function(e,t,n){var r=n.rawEvent.pointerType.toString(),i=n.rawEvent.pointerId.toString();if("touch"!==r)return!1;var o=this.GetInputType(e);if(1!==o&&!this._pointerEventsCache.containsKey(i))return!1;this._pointerEventsCache.set_item(i,n);var a=this.GetInputDataFromPointerEvents(this._pointerEventsCache,n,r);return Hammer.inputHandler(this,o,a),4!==o&&8!==o||(this._pointerEventsCache.remove(i),this._pointerEventsCache.get_count()||(this.session=null)),this._handled&&n.preventDefault(),this._handled},t.prototype.OnMouseEvent=function(e,t,n){return!1},t.prototype.GetInputDataFromTouchEvents=function(e,t){var n=new F,r=e.rawEvent,i=r.touches,o=r.changedTouches;n.pointers=Array.clone(i);var a=i.length>0?i:o;return n.pointers=Array.clone(a),n.changedPointers=Array.clone(o),n.srcEvent=e,n.pointerType="touch",n},t.prototype.GetInputDataFromPointerEvents=function(e,t,n){var r=new F;e.get_keys();return r.pointers=_.Enumerable.toArray(Sys.UI.DomEvent,e.get_values()),r.changedPointers=[t],r.pointerType=n,r.srcEvent=t,r},t.prototype.IsPinchEvent=function(e){return D.l.startsWith(e,b.d.pinch)},t.prototype.IsPanEvent=function(e){return D.l.startsWith(e,b.d.pan)},t.prototype.IsSwipeEvent=function(e){return D.l.startsWith(e,b.d.swipe)},t}(p.n);(0,s.l)(O,"7c446d9$GestureInputManager",p.n,[r.k,l]);var U=n(1526);n.d(t,{GestureInputManagerPackage:function(){return x}});var x=function(){function e(){this._container=null,this._isInitialized=!1}return e.prototype.get_name=function(){return"Common.App.GestureInputManager"},e.prototype.configure=function(e){e.register(O).as(r.k).singleInstance().usingFactory((function(){return new O})),this._container=e},e.prototype.init=function(){this._isInitialized||(this._container.resolve(O),this._isInitialized=!0)},e.prototype.dispose=function(){},e.main=function(){U.o.get_instance().registerPackage(new e,0,!1)},e}();(0,s.l)(x,"f6b04223$GestureInputManagerPackage",null,[i.u,o.s])},8546:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("330e1122$IPacketIdGenerator");n.d(t,{k:function(){return o}});var o=function(){function e(){this._packetId=0,this._packetId=0}return e.prototype.getNextPacketId=function(){return this._packetId++,this._packetId===Number.MAX_VALUE&&(this._packetId=1),this._packetId},e.get_instance=function(){return e._packetIdGenerator},e._packetIdGenerator=new e,e}();(0,r.l)(o,"7ace284b$PacketIdGenerator",null,[i])},8576:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});var r=(0,n(423).y)("64bdfecb$IPaneElement")},8586:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(1330),o=n(8761),a=(0,r.y)("74299a05$IFileNameDialogFactory"),s=n(363),l=n(8192),u=n(3545),c=(0,r.y)("b97ff3a0$IErrorRetryDialog"),d=n(8530),p=n(7597),g=n(9910),h=n(9474),_=function(e){function t(t,n){var r=this;return r._actionManager=null,r._extraCharsInFileNameIsEnabled=!1,r._overwriteTarget=!1,r._fileName=null,(r=e.call(this)||this)._actionManager=t,r._extraCharsInFileNameIsEnabled=n,r.showSessionId=!1,r}return(0,u.t)(t,e),t.prototype.displayError=function(e,t,n){this._fileName=t,this._overwriteTarget=n,p.ULS.sendTraceTag(8194008,216,50,"Display error with code:{0}, overwriteTarget:{1}.",e,n),(e=this.CheckErrorCode(e))?(this.set_buttonsOption(0),this.setButtonText(1,CommonUIStrings.l_DialogClose)):(this.set_buttonsOption(6),this.setButtonText(0,CommonUIStrings.l_DialogClose)),e||p.ULS.sendTraceTag(8194009,216,50,"Show standard error dialog."),this.showError(h.p.saveAsToHostFailed,this.GetDialogTitle(e),this.GetDialogText(e,t),r.i(this,this.RetryDialogHandler,"RetryDialogHandler"),!0)},t.prototype.RetryDialogHandler=function(e,t){1===e?(p.ULS.sendTraceTag(8194010,216,50,"User click to retry button in error dialog."),this._fileName?this._actionManager.processActionWithData(g.b.saveAsToHost,2,[this._fileName,this._overwriteTarget],null):this._actionManager.processAction(g.b.saveAsToHost,2,null)):p.ULS.sendTraceTag(8194011,216,50,"User cancel the error dialog.")},t.prototype.CheckErrorCode=function(e){return e<0||e>6?(p.ULS.sendTraceTag(8194012,216,15,"Unexpected error code {0}.",e),0):e},t.prototype.GetDialogText=function(e,t){return e=this.CheckErrorCode(e),this._extraCharsInFileNameIsEnabled?[CommonUIStrings.l_FailToSaveFile,CommonUIStrings.l_InvalidFileNameAllowPercentOctothorpe,CommonUIStrings.l_EmptyNameText,CommonUIStrings.l_InvalidPermissionText,String.format(CommonUIStrings.l_OverwriteTargetText,t),CommonUIStrings.l_LockTargetText,CommonUIStrings.l_InvalidFileNameDisallowPercentOctothorpe][e]:[CommonUIStrings.l_FailToSaveFile,CommonUIStrings.l_InvalidFileNameText,CommonUIStrings.l_EmptyNameText,CommonUIStrings.l_InvalidPermissionText,String.format(CommonUIStrings.l_OverwriteTargetText,t),CommonUIStrings.l_LockTargetText,CommonUIStrings.l_InvalidFileNameText][e]},t.prototype.GetDialogTitle=function(e){return e=this.CheckErrorCode(e),[CommonUIStrings.l_GeneralFailTitle,CommonUIStrings.l_InvalidFileNameTitle,CommonUIStrings.l_EmptyNameTitle,CommonUIStrings.l_GeneralFailTitle,CommonUIStrings.l_GeneralFailTitle,CommonUIStrings.l_GeneralFailTitle,CommonUIStrings.l_InvalidFileNameTitle][e]},t}(d.StandardDialog);(0,r.l)(_,"c30aed89$ErrorRetryDialog",d.StandardDialog,[c]);var f=function(){function e(e,t){this._actionManager=null,this._appSettingsManager=null,this._extraCharsInFileNameIsEnabled=!1,this._appSettingsManager=e,this._actionManager=t,this._extraCharsInFileNameIsEnabled=this._appSettingsManager.getBooleanAppSetting("SaveToHostWithExtraCharsInFileName")}return e.prototype.create=function(){return new _(this._actionManager,this._extraCharsInFileNameIsEnabled)},e}();(0,r.l)(f,"552ff3d$ErrorRetryDialogFactory",null,[i.o]);var m=(0,r.y)("21d46bf1$IFileNameDialog"),y=n(7794),v=n(8027),S=function(){function e(){}return e.get_dialogHtml=function(){return v.o.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_SaveACopyFileName,CommonUIStrings.l_SaveAsToHostOverwrite)},e.dialogHtmlFormat="<div class='WACDialogRow' id='DocumentFolderBlock'> <label id='lblFolderName' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='DocumentNameBlock'> <label id='lblFileName' class='WACDialogLabel' for='txtFileName' >{0}</label> <input type='text' id='txtFileName' class='WACDialogInput' autocomplete=\"off\"/> </div> <div class='WACDialogRow' id='OverwriteBlock'> <span id='OverwriteBlockSpan' class='WACDialogSpan'><input type='checkbox' id='chkOverwrite' class='WACDialogCheckBox'></input> <label id='lbcOverwrite' class='\"WACDialogInlineLabel\"' for='chkOverwrite'>{1}</label></span> </div>",e}();(0,r.l)(S,"8a8dde81$FileNameDialogHtml",null,[]);var I=n(2575),C=n(6378),T=function(e){function t(n,r,i,o,a,s){var l=e.call(this,n,r,i,o,a,s,null)||this;return l.set_dialogHtml(S.get_dialogHtml()),l.set_dialogId(t.Id),l}return(0,u.t)(t,e),t.prototype.displayDialog=function(e,t){var n=C.l.getFileNameWithoutExtension(I.AFrameworkApplication.docPropertiesProvider.get_breadcrumbDocName()),i={txtFileName:e||n,lblFolderName:CommonUIStrings.l_ToCurrentFolder,chkOverwrite:t};this.initializeAndShow(CommonUIStrings.L_SaveAs,r.i(this,this.fileNameDialogHandler,"fileNameDialogHandler"),i),this.disableSaveButton(e,n)},t.FolderNameLabel="lblFolderName",t.Id="FileNameDialog-SaveAsToHost",t}(y.p);(0,r.l)(T,"c5112978$FileNameDialog",y.p,[m]);var b=function(){function e(e,t,n,r,i,o){this._actionManager=null,this._aframeApplication=null,this._uploadToHostManager=null,this._errorDialogFactory=null,this._appSettingsManager=null,this._activeFrame=null,this._actionManager=t,this._appSettingsManager=e,this._aframeApplication=r,this._uploadToHostManager=o,this._errorDialogFactory=i,this._activeFrame=n}return e.prototype.create=function(){return new T(this._appSettingsManager,this._actionManager,this._activeFrame,this._aframeApplication,this._errorDialogFactory,this._uploadToHostManager)},e}();(0,r.l)(b,"87331e0c$FileNameDialogFactory",null,[a]);var A=n(2192),M=function(){function e(e,t,n){this._appSettingsManager=null,this._fileNameDialogFactory=null,this._uploadToHostManager=null,this._uploadToHostManager=n,this._fileNameDialogFactory=t,this._appSettingsManager=e}return e.prototype.registerActions=function(){2===I.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_officeAppType()?I.AFrameworkApplication.get_theActionManager().addActionWithFlags(g.b.saveAsToHost,A.m.frame,r.i(this,this.SaveAsToHostActionDispatcher,"SaveAsToHostActionDispatcher"),4):I.AFrameworkApplication.get_theActionManager().addAction(g.b.saveAsToHost,A.m.frame,r.i(this,this.SaveAsToHostActionDispatcher,"SaveAsToHostActionDispatcher"))},e.prototype.SaveAsToHostActionDispatcher=function(e,t,n,r,i){if(t.get_contextId()!==A.m.frame||e!==g.b.saveAsToHost)return 2;if(!this._appSettingsManager.getBooleanAppSetting("SaveAsToHostBrsIsEnabled"))return 8;if(1===n)return 32;if(2===n){var o=i;p.ULS.sendTraceTag(8194015,216,50,"User clicked on SaveAsToHost button from the backstage.");var a=this._fileNameDialogFactory.create();return i&&Object.getType(i)===Array&&2===o.length?a.displayDialog(o[0],!!o[1]):a.displayDialog(null,!1),32}return 8},e}();(0,r.l)(M,"949e7ab2$SaveAsToHostActor",null,[]);var P=n(1822),F=n(8996),w=n(3096),R=n(5989),E=n(5227),k=n(1638),D=n(275),O=n(5634),U=function(){function e(e,t,n,r,i,o,a,s){this._activeFrame=null,this._progressDialog=null,this._progressDialogFactory=null,this._errorDialogFactory=null,this._clientRequestManager=null,this._actionManager=null,this._isApplicationShuttingdown=null,this._appSettingsManager=null,this._webServiceBase=null,this._handlerName=null,this._failedCanary=!1,this._overwriteTarget=!1,this._fileName=null,this._options=null,this._stopwatchBuilder=null,this._uploadTimeStopwatch=null,this._appSettingsManager=t,this._webServiceBase=this._appSettingsManager.get_appSettings().SaveAsToHostWebServiceBase,this._isApplicationShuttingdown=r,this._progressDialogFactory=i,this._clientRequestManager=n,this._errorDialogFactory=o,this._stopwatchBuilder=s,this._activeFrame=a,this._actionManager=e,this._handlerName=t.getStringAppSetting("SaveAsToHostUploadHandler")||"hostuploadhandler.ashx"}return e.prototype.showWaitUI=function(){1!==this._activeFrame.get_state()&&(this._progressDialog=this._progressDialogFactory(),this._progressDialog.set_message(CommonUIStrings.l_CommentProgressTooltip),this._progressDialog.set_buttonsOption(5),this._progressDialog.set_hasCloseGlyph(!1),this._progressDialog.showProgressDialog(CommonUIStrings.l_DefaultDialogTitle,null,null))},e.prototype.showErrorUI=function(e){1!==this._activeFrame.get_state()&&this._errorDialogFactory.create().displayError(e,C.l.getFileNameWithoutExtension(this._fileName),this._overwriteTarget)},e.prototype.redirectToFolder=function(){var e=this._appSettingsManager.get_appSettings().BreadcrumbFolderUrl;p.ULS.sendTraceTag(8194016,216,50,"Redirecting to OneDrive for business Folder."),window.open(e,R.g.windowTargetToString(3))},e.prototype.redirectToEditUrl=function(e){var t=!1,n=!1;if(this._appSettingsManager&&(t=this._appSettingsManager.getBooleanAppSetting("SaveACopyIsEnabledForUiHost"),n=this._appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures")),p.ULS.sendTraceTag(8194017,216,50,"Redirecting to edit url {0}. IsEnabledForUiHost {1}",e,t),t&&n){p.ULS.sendTraceTag(51245197,216,50,"UploadToHostManager.RedirectToEditUrl: Sending DocumentRefresh post message.");var r={};r[k.t.rebootMode]="1",r[k.t.documentUrl]=e,I.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessageWithRetry(D.a.documentRefresh,r,"",0)}))}else window.open(e,R.g.windowTargetToString(3))},e.prototype.startUpload=function(t,n,r){p.ULS.sendTraceTag(8194018,216,50,"Starting to upload file"),this._isApplicationShuttingdown&&!this._isApplicationShuttingdown()&&this._clientRequestManager&&(this._stopwatchBuilder&&(this._uploadTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown",e.saveAsToHostPerf)),this.showWaitUI(),this._overwriteTarget=n,this._fileName=t,this._options=r,this._options&&"true"===this._options.SkipSaveToHost?this.ExcuteUploadInternal():this.executeUpload())},e.prototype.executeUpload=function(){var e=this;if(32!==this._actionManager.processAction(g.b.saveFileChange,1,null))p.ULS.sendTraceTag(18989378,219,15,"The save file change is not supported, this operation may exist data losting."),this.ExcuteUploadInternal();else{this._actionManager.processActionWithData(g.b.saveFileChange,2,[function(t){p.ULS.sendTraceTag(18989379,219,50,"Call the force save file change successfully."),e.ExcuteUploadInternal()},function(t,n){p.ULS.sendTraceTag(18989380,219,15,"The file change is not saved successfully, this operation may lead to data loss."),e.showErrorUI(n)}],null)}},e.prototype.OnUploadFinished=function(e){if(this.dismissWaitUI(),this._failedCanary=!1,!e||!e.get_data()||!e.get_data().responseData)return p.ULS.sendTraceTag(8194019,216,10,"UploadToHostManager failure. Response data is null"),void this.showErrorUI(0);var t;if(!F.x.tryDeserialize(Object,e.get_data().responseData,(0,P.m)((function(){return t}),(function(e){return t=e}))))return p.ULS.sendTraceTag(8194048,216,10,"Failed to deserialize : {0}",{ResponseData:O.l.truncateIfNecessary(e.get_data().responseData)}),void this.showErrorUI(0);var n=t;if(n.StatusCode!==E.k.oK_200&&n.StatusCode!==E.k.created_201)return p.ULS.sendTraceTag(8194049,216,10,"UploadToHostManager failure. Response data is not JSON."),void this.showErrorUI(parseInt(n.ExtraInfo));p.ULS.sendTraceTag(8194050,216,50,"UploadToHost execute success.");try{n.NewDocumentUrl&&""!==n.NewDocumentUrl?this.redirectToEditUrl(n.NewDocumentUrl):this.redirectToFolder()}catch(e){p.ULS.sendTraceTag(37025699,216,15,"Redirect failed with exception: {0}",e.toString())}this.PerfWatchStop()},e.prototype.OnUploadFailed=function(e){5!==e.get_data().status&&12!==e.get_data().status||this._failedCanary?(p.ULS.sendTraceTag(8194052,216,10,"UploadToHostManager HTTP failure with code: {0}",{Status:e.get_data().status,HttpStatus:e.get_data().httpStatus}),this.dismissWaitUI(),this.showErrorUI(0),this.PerfWatchStop()):(p.ULS.sendTraceTag(8194051,216,10,"UploadToHostManager failure. Retry automatically."),this._failedCanary=!0,this._options&&"true"===this._options.SkipSaveToHost?this.ExcuteUploadInternal():this.executeUpload())},e.prototype.dismissWaitUI=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},e.prototype.PerfWatchStop=function(){this._uploadTimeStopwatch&&(this._uploadTimeStopwatch.stop(),this._uploadTimeStopwatch=null)},e.prototype.ExcuteUploadInternal=function(){var t={};t[e.contentHeader]=e.contentHeaderValue;var n=this._webServiceBase+this._handlerName;n=w.n.addOrReplaceParameterValue(n,e.handlerQuerySigParam,C.l.urlKeyValueEncode(I.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),!1),n=w.n.addOrReplaceParameterValue(n,e.handlerTimeParam,C.l.urlKeyValueEncode((new Date).getTime().toString()),!1),n=w.n.addOrReplaceParameterValue(n,e.handlerOverwriteParam,C.l.urlKeyValueEncode(this._overwriteTarget.toString()),!1),n=w.n.addOrReplaceParameterValue(n,e.handlerFilenameParam,C.l.urlKeyValueEncode(this._fileName),!1),this._options&&this._options.FileDownloadUrl&&(n=w.n.addOrReplaceParameterValue(n,e.handlerFileDownloadUrlParam,C.l.urlKeyValueEncode(this._options.FileDownloadUrl),!1)),this._clientRequestManager.addRequest(n,1,"",t,!1,2,r.i(this,this.OnUploadFinished,"OnUploadFinished"),r.i(this,this.OnUploadFailed,"OnUploadFailed"),null,null,!1,null,null,"1",null,!1,null,!1)},e.contentHeader="Content-Type",e.saveAsToHostPerf="SaveAsToHostUploadTime",e.contentHeaderValue="application/json; charset=utf-8",e.handlerOverwriteParam="ov",e.handlerQuerySigParam="qs",e.handlerFilenameParam="fn",e.handlerTimeParam="n",e.handlerFileDownloadUrlParam="furl",e}();(0,r.l)(U,"c1dc2b3a$UploadToHostManager",null,[o.h]);var x=n(1526),L=n(4311);n.d(t,{SaveAsToHostPackage:function(){return N}});var N=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"Common.App.SaveAsToHost"},e.prototype.init=function(){I.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(r.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){I.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveAsToHostBrsIsEnabled")&&this._container.resolve(M).registerActions()},e.prototype.configure=function(e){this._container=e,this._container.register(f).as(i.o).usingFactory((function(){return new f(I.AFrameworkApplication.appSettingsManager,I.AFrameworkApplication.get_theActionManager())})).singleInstance(),this._container.register(U).as(o.h).usingFactory((function(){return new U(I.AFrameworkApplication.get_theActionManager(),I.AFrameworkApplication.appSettingsManager,I.AFrameworkApplication.theClientRequestManager,(function(){return I.AFrameworkApplication.isShuttingDown}),(function(){return new L.c(!1)}),e.resolve(i.o),I.AFrameworkApplication.get_activeFrame(),I.AFrameworkApplication.get_activeFrame().get_theStopwatchBuilder())})).singleInstance(),this._container.register(b).as(a).usingFactory((function(){return new b(I.AFrameworkApplication.appSettingsManager,I.AFrameworkApplication.get_theActionManager(),I.AFrameworkApplication.get_activeFrame(),I.AFrameworkApplication.get_activeFrame().get_applicationInstance(),e.resolve(i.o),e.resolve(U))})).singleInstance(),this._container.register(M).usingFactory((function(){return new M(I.AFrameworkApplication.appSettingsManager,e.resolve(b),e.resolve(U))})).singleInstance()},e.prototype.dispose=function(){},e.main=function(){x.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(N,"983d7023$SaveAsToHostPackage",null,[s.u,l.s])},8660:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(976),o=n(9092),a=n(363),s=n(8192),l=n(7597),u=n(2575),c=n(1526),d=n(505),p=n(8056),g=(0,r.y)("8aafd561$IClientRequestAdapter"),h=function(){function e(e,t,n){this._clientRequestManager=null,this._simpleClientRequestSender=null,this._rawWebRequestsIsEnabled=!1,this._clientRequestManager=e,this._simpleClientRequestSender=t,this._rawWebRequestsIsEnabled=n}return e.prototype.addRequest=function(e,t,n,r,i,o,a,s,l,u,c,d,p,g,h,_){return this._rawWebRequestsIsEnabled?this._simpleClientRequestSender.addRequest(e,t,n,r,i,o,a,s,l,u,c,p,g):this._clientRequestManager.addRequest(e,t,n,r,i,o,a,s,l,u,c,d,p,g,h,_,null,!1)},e.prototype.getRequestStatus=function(e){return this._rawWebRequestsIsEnabled?this._simpleClientRequestSender.getRequestStatus():this._clientRequestManager.getRequestStatus(e)},e}();(0,r.l)(h,"d2fdfaa8$ClientRequestAdapter",null,[g]);var _=(0,r.y)("ac4ee3f3$ISimpleClientRequestSender"),f=n(494),m=n(5227),y=n(2460),v=n(814),S=n(2561),I=n(6378),C=function(){function e(e,t,n){this._userSessionId=null,this._wacClusterId=null,this._defaultSentTimeoutMs=0,this._userSessionId=e,this._wacClusterId=t,this._defaultSentTimeoutMs=n}return e.prototype.addRequest=function(e,t,n,r,i,o,a,s,c,d,p,g,h){var _=this,m=new XMLHttpRequest,y="",S="";2===t?(y="POST",n&&(S=n)):y="GET";var C={};if(this._userSessionId&&(e=f.h.AddGlobalRequestInfo(C,e,f.h.userSessionIdHeaderName,u.AFrameworkApplication.userSessionIdQueryParam,this._userSessionId)),m.open(y,e,!0),this.BuildRequestHeader(C,e),r)for(var T in r){var b={key:T,value:r[T]};m.setRequestHeader(b.key,I.l.httpHeaderEncode(b.value))}for(var A in C){b={key:A,value:C[A]};m.setRequestHeader(b.key,b.value)}var M=g||this._defaultSentTimeoutMs;M>0&&(m.timeout=M);var P=[];Array.add(P,f.h.correlationIdHeaderName);var F=new Sys.Net.WebRequest,w=new v.n(1,2,F,P,i,a,s,c,p,d,h,!1,null);m.onreadystatechange=function(){_.OnReadyStateChanged(m,w)};try{m.send(S)}catch(e){l.ULS.sendTraceTag(24938643,205,15,"Invoke failed in SimpleClientRequestSender")}return 1},e.prototype.getRequestStatus=function(){return 1},e.prototype.OnReadyStateChanged=function(e,t){if(this.CheckRequestOnStateChange(e,t)&&4===e.readyState){if(e.getResponseHeader(f.h.EndSessionHeaderName)&&u.AFrameworkApplication.endSessionHeaderReceivedCallback)return void u.AFrameworkApplication.endSessionHeaderReceivedCallback();var n=e.getResponseHeader(f.h.CanaryNewValueHeaderName);f.h.updateCanary(n),this.UpdateRequestItem(e,t),e.status===m.k.oK_200?(t.status=2,t.successCallback(new S.y(t))):(e.status&&e.status!==m.k.requestTimeout_408?e.status===m.k.preconditionFailed_412?t.status=5:t.status=3:t.status=7,t.failureCallback(new y.o(t)))}},e.prototype.BuildRequestHeader=function(e,t){e["X-xhr"]=1,u.AFrameworkApplication.isLoggingHostRequests&&(e[f.h.LogHostRequestsHeaderName]=1),u.AFrameworkApplication.buildVersion&&(e[f.h.officeVersionHeaderName]=I.l.httpHeaderEncode(u.AFrameworkApplication.buildVersion)),this._wacClusterId&&(e[f.h.wacClusterHeaderName]=this._wacClusterId),u.AFrameworkApplication.canary&&(e[f.h.CanaryHeaderName]=I.l.httpHeaderEncode(u.AFrameworkApplication.canary),u.AFrameworkApplication.logCanaryInBrowser&&l.ULS.sendTraceTag(24938644,205,50,"Canary in request: {0}",e[f.h.CanaryHeaderName])),u.AFrameworkApplication.get_accessToken()&&(f.h.CheckParamInUrl(t,u.AFrameworkApplication.accessTokenParamName)||(e[f.h.AccessTokenHeaderName]=I.l.httpHeaderEncode(u.AFrameworkApplication.get_accessToken())),f.h.CheckParamInUrl(t,u.AFrameworkApplication.accessTokenTtlParamName)||(e[f.h.AccessTokenTtlHeaderName]=u.AFrameworkApplication.accessTokenServerExpirationTime.toString())),u.AFrameworkApplication.userType&&(e[f.h.UserTypeHeaderName]=I.l.httpHeaderEncode(u.AFrameworkApplication.userType))},e.prototype.UpdateRequestItem=function(e,t){t.httpStatus=e.status?e.status:m.k.requestTimeout_408;try{if(t.responseData=e.responseText,!isNullOrUndefined(t.responseHeadersToSet)){t.responseHeaders={};for(var n=0;n<t.responseHeadersToSet.length;++n){var r=t.responseHeadersToSet[n];t.responseHeaders[r]=e.getResponseHeader(r)}}t.shouldSetResponseXml&&(e.responseText&&e.responseText.length?t.responseXml=e.responseXML:t.responseXml=null)}catch(n){l.ULS.sendTraceTag(24938645,205,10,"OnRequestCompleted: Unable to get ResponseData/XML, Id={0}, Url={1} ResponseAvailable={2}",t.id,t.request.get_url(),4===e.readyState)}},e.prototype.CheckRequestOnStateChange=function(e,t){return e?!!t||(l.ULS.sendTraceTag(24938648,205,15,"OnRequestCompleted in SimpleClientRequestSender: RequestItem doesn't exist."),!1):(l.ULS.sendTraceTag(24938646,205,15,"OnRequestCompleted in SimpleClientRequestSender: XMLHttpRequest doesn't exist."),!1)},e}();(0,r.l)(C,"5a6d87fa$SimpleClientRequestSender",null,[_]);var T=n(6382),b=n(9423),A=n(3687),M=n(8047),P=n(5214),F=n(1822),w=n(1664),R=n(1658),E=n(1308),k=n(8996),D=n(9962),O=n(5734),U=n(4100),x=n(3431),L=n(1012),N=n(1183),B=function(){function e(){this._reason=0}return e.prototype.get_isEmpty=function(){return!this._reason},e.prototype.addRetryCondition=function(e){this._reason|=e},e.prototype.isRetryConditionSet=function(e){return!!(this._reason&e)},e.prototype.clear=function(){this._reason=0},e}();(0,r.l)(B,"618d44c1$RetryAttempt",null,[]);var H,$=n(3545),G=n(3190),W=function(e){function t(){var t=e.call(this)||this;return t.FileId=null,t.CellId=null,t}return(0,$.t)(t,e),t.prototype.getClassId=function(){return 37},t.construct=function(e){var n=new t;return n.FileId=e.getParentGraphSpace().get_fileQuerySignature(),n.CellId=N.j.serialize(e.get_containingObjectSpace().get_id()),n},t}(G.b);(0,r.l)(W,"828e2b74$LastSavedRevisionRequest",G.b,[]),function(e){e[e.noResultYet=-1]="noResultYet",e[e.upToDate=0]="upToDate",e[e.sessionLost=1]="sessionLost",e[e.userSignedOut=2]="userSignedOut",e[e.previousRequestPending=3]="previousRequestPending",e[e.requestFailed=4]="requestFailed",e[e.shuttingDown=5]="shuttingDown",e[e.nullResponseData=6]="nullResponseData",e[e.invalidResponseData=7]="invalidResponseData",e[e.failedRevisionLookup=8]="failedRevisionLookup",e[e.savedWithinThreshold=9]="savedWithinThreshold",e[e.notSavedWarning=10]="notSavedWarning",e[e.kickoutThreshold=11]="kickoutThreshold",e[e.unknownRevision=12]="unknownRevision",e[e.contentNotYetLoaded=13]="contentNotYetLoaded",e[e.sessionExpired=14]="sessionExpired",e[e.canaryError=15]="canaryError",e[e.timeout=16]="timeout",e[e.kickoutThreshold_Offline=17]="kickoutThreshold_Offline",e[e.dssSessionDeleted=18]="dssSessionDeleted",e[e.dssSessionExpired=19]="dssSessionExpired"}(H||(H={})),(0,r.h)("cdbc171d$SaveMonitorResult",H);var V=n(2098),j=n(1067),q=function(){function e(e,t,n,i,o,a,s,l,u,c,d,p,g,h,_,f,m,y,v,S,I,C,T,b){this._infoRequestLoggingEnabled=!1,this._allowedFailedRequestRetries=null,this._retriedUnrecognizedOperationResult=null,this._queueTimeoutMs=0,this._sentTimeoutMs=0,this._intervalMs=0,this._successIntervalMs=0,this._failureIntervalMs=0,this._warningMs=0,this._shouldKickout=!1,this._kickoutMs=0,this._lastSuccessfulIterationTime=null,this._clientRequestAdapter=null,this._getTargetNode=null,this._isUserSignedIn=null,this._isSessionLost=null,this._isSessionExpired=null,this._kickoutExecutor=null,this._isAppShuttingDown=null,this._localCobaltLocationInfo=null,this._currentTimeGetter=null,this._requestStartTimeGetter=null,this._docxSaveMonitorTaskManager=null,this._isRequestPending=!1,this._requestStartTime=null,this._currentFailedRequestRetries=null,this._requestLifeCycleTelemetryManager=null,this._monitorStateMachine=null,this._oldestAllowedLocalRevisionMs=0,this._prevOldestLocalRevisionTime=null,this._prevOldestLocalRevisionStuckIterations=0,this._kickoutOnOldestAllowedLocalRevisionExceededEnabled=!1,this._getOldestAllowedLocalRevisionKickoutDiagnosticLog=null,this.docxSaveMonitorTaskId=0,this.$$pf_ConsecutiveErrors=0,this._mostRecentRevisionIdResult=E.h.get_nil(),this._mostRecentRevisionIdOrigin=0,this._requestId=-1,this._lastHttpStatus=-1,this._successIntervalMs=e,this._failureIntervalMs=t,this._intervalMs=e,this._warningMs=n,this._shouldKickout=i,this._kickoutMs=o,this._queueTimeoutMs=a,this._sentTimeoutMs=s,this._oldestAllowedLocalRevisionMs=l,this._docxSaveMonitorTaskManager=u,this._clientRequestAdapter=c,this._kickoutExecutor=d,this._localCobaltLocationInfo=p,this._getTargetNode=g,this._isUserSignedIn=h,this._isSessionLost=_,this._isSessionExpired=f,this._isAppShuttingDown=m,this._currentTimeGetter=y,this._requestStartTimeGetter=v,this._currentFailedRequestRetries=new B,this._retriedUnrecognizedOperationResult=new w.e(String,R.b.get_ordinal()),this._getOldestAllowedLocalRevisionKickoutDiagnosticLog=b,this._kickoutOnOldestAllowedLocalRevisionExceededEnabled=T,this._monitorStateMachine=new D.n(-1),this._monitorStateMachine.add_stateChanged(r.i(this,this.ResultStateChanged,"ResultStateChanged")),this._requestLifeCycleTelemetryManager=S,this._lastSuccessfulIterationTime=y(),this._infoRequestLoggingEnabled=I,this._allowedFailedRequestRetries=C}return e.prototype.get_docxSaveMonitorTaskId=function(){return this.docxSaveMonitorTaskId},e.prototype.get_isUpToDate=function(){return!this.GetCurrentRevision()||this._mostRecentRevisionIdResult.equals(this.GetCurrentRevision().get_id())},e.prototype.get_consecutiveErrors=function(){return this.$$pf_ConsecutiveErrors},e.prototype.set_consecutiveErrors=function(e){return this.$$pf_ConsecutiveErrors=e,e},e.prototype.Start=function(){this.docxSaveMonitorTaskId=this._docxSaveMonitorTaskManager.createTask(r.i(this,this.FireRequestIfNecessary,"FireRequestIfNecessary"),this._intervalMs)},e.prototype.updateInterval=function(e){if(!this.get_docxSaveMonitorTaskId()||this._intervalMs===e)return!1;var t=this._intervalMs;return this._intervalMs=e,this.Stop("changing save monitor interval from "+t+"ms to "+e+"ms"),this.Start(),!0},e.prototype.setMostRecentRevisionId=function(e,t){t>=this._mostRecentRevisionIdOrigin&&e&&!E.h.get_nil().equals(e)&&(this._mostRecentRevisionIdOrigin=t,this._mostRecentRevisionIdResult=e)},e.prototype.Stop=function(e){this.DeleteTask(e)},e.prototype.DeleteTask=function(t){this.get_docxSaveMonitorTaskId()&&(l.ULS.sendTraceTag(5830084,e.MonitorLogCategory,50,"Stopping DocxSaveMonitor because {0}!",t),this._docxSaveMonitorTaskManager.deleteTask(this.get_docxSaveMonitorTaskId()),this.docxSaveMonitorTaskId=0)},e.prototype.FireRequestIfNecessary=function(){var t=this._lastSuccessfulIterationTime;if(this._lastSuccessfulIterationTime=this._currentTimeGetter(),this._isAppShuttingDown())return this._monitorStateMachine.event(5,null),void this.Stop("session has shut down");this._intervalMs===e.RetryOnceImmediatelyIntervalMs&&this.updateInterval(this._failureIntervalMs);var n=this._getTargetNode();if(n){if(!this.IsSessionLostOrExpired())if(this._isUserSignedIn())if(this.get_isUpToDate())this._monitorStateMachine.event(0,null);else if(this._lastSuccessfulIterationTime=t,this._isRequestPending){if(this._monitorStateMachine.event(3,null),this._currentTimeGetter().getTime()-this._requestStartTime.getTime()>this._kickoutMs){var i=this._clientRequestAdapter.getRequestStatus(this._requestId);l.ULS.sendTraceTag(19161610,205,50,"DocxSaveMonitorKickout: Status for presumably pending request {0} is {1}",this._requestId,O.e[i]),this._requestLifeCycleTelemetryManager&&this._requestLifeCycleTelemetryManager.log(),this.Stop("stuck on previousRequestPending"),this.Kickout(U.o.docxSaveMonitorKickout)}}else{var o=L.x.constructFromSingleRequest(W.construct(n)),a={"Content-Type":"application/json; charset=utf-8"};if(this._isRequestPending=!0,this._requestStartTime=this._requestStartTimeGetter(),this._requestId=this._clientRequestAdapter.addRequest(e.ServiceUrl,2,o,a,!1,0,r.i(this,this.CheckSaveRequestSucceeded,"CheckSaveRequestSucceeded"),r.i(this,this.CheckSaveRequestFailed,"CheckSaveRequestFailed"),null,null,!1,this._queueTimeoutMs,this._sentTimeoutMs,null,null,!0),this._requestId<=0)this._isRequestPending=!1,l.ULS.sendTraceTag(19161611,205,50,"DocxSaveMonitorKickout: Request {0} was not added to the queue.",this._requestId.toString());else{var s=100;((i=this._clientRequestAdapter.getRequestStatus(this._requestId))&&1!==i||this._infoRequestLoggingEnabled)&&(s=50),l.ULS.sendTraceTag(19161612,e.MonitorLogCategory,s,"DocxSaveMonitor: Sending Request {0}",{Id:this._requestId,Status:O.e[i]}),this._requestLifeCycleTelemetryManager&&this._requestLifeCycleTelemetryManager.start(this._requestId)}}else this._monitorStateMachine.event(2,null)}else this._monitorStateMachine.event(13,null)},e.prototype.HandleExceededOldestAllowedLocalRevision=function(){if(this._oldestAllowedLocalRevisionMs<=0)return!1;var t=this.GetOldestLocalRevision();if(!t)return this._prevOldestLocalRevisionTime=null,this._prevOldestLocalRevisionStuckIterations=0,!1;var n=t.get_firstCreationTime();if(n===this._prevOldestLocalRevisionTime?this._prevOldestLocalRevisionStuckIterations++:(this._prevOldestLocalRevisionTime=n,this._prevOldestLocalRevisionStuckIterations=1),this._prevOldestLocalRevisionStuckIterations<e.MinOldestLocalRevisionStuckIterationsBeforeKickout)return!1;var r=+this._currentTimeGetter()-+n;if(r<=this._oldestAllowedLocalRevisionMs)return!1;var i="";try{this._getOldestAllowedLocalRevisionKickoutDiagnosticLog&&(i=this._getOldestAllowedLocalRevisionKickoutDiagnosticLog())}catch(t){var o={Kind:"Exception",Stack:t.stack,Message:t.message,FileName:t.fileName,LineNumber:t.lineNumber};i=k.x.serialize(o),l.ULS.sendTraceTag(50426817,e.MonitorLogCategory,15,"Exception when getting log extra details for exceeding max allowed local revision age. {0}",i)}return l.ULS.sendTraceTag(50426818,e.MonitorLogCategory,15,"Oldest local revision was created at {0} which is {1}ms ago and exceeds max allowed age of {2}ms.  Extra Details: {3}",n.toISOString(),r,this._oldestAllowedLocalRevisionMs,i),this._oldestAllowedLocalRevisionMs=-1,!!this._kickoutOnOldestAllowedLocalRevisionExceededEnabled&&(this.Stop("Exceeded oldest allowed local revision"),this.Kickout(U.o.docxSaveMonitorKickout_ReplicationStuck),!0)},e.prototype.GetOldestLocalRevision=function(){for(var e=null,t=this.GetCurrentRevision();t&&!t.get_isServerRevision();)e=t,t=t.get_baseRevision();return e},e.prototype.IsSessionLostOrExpired=function(){return this._isSessionLost()?(this._monitorStateMachine.event(1,null),this.Stop("session is lost"),!0):!!this._isSessionExpired()&&(this._monitorStateMachine.event(14,null),l.ULS.sendTraceTag(20029718,e.MonitorLogCategory,15,"ExpiredSessionNotLostYet"),this.Stop("session is expired"),this.Kickout(U.o.docxSaveMonitorKickout_SessionAccessTokenExpired),!0)},e.prototype.GetContentObjectSpace=function(){return this._getTargetNode().get_containingObjectSpace()},e.prototype.GetCurrentRevision=function(){return this.GetContentObjectSpace().get_currentRevision()},e.prototype.CanRetry=function(e){return this._allowedFailedRequestRetries.isRetryConditionSet(e)&&!this._currentFailedRequestRetries.isRetryConditionSet(e)},e.prototype.CheckSaveRequestFailed=function(t){this.set_consecutiveErrors(this.get_consecutiveErrors()+1),this._isRequestPending=!1;var n=!1,r=!1,i=t.get_data();if(i)if(13===i.status&&l.ULS.sendTraceTag(22552772,e.MonitorLogCategory,15,"Request expired in CRM queue {0}",{Id:i.id,ConsecutiveErrors:this.get_consecutiveErrors()}),r=7===i.status||13===i.status,this.CanRetry(2)&&r)this._currentFailedRequestRetries.addRetryCondition(2),n=!0,this._lastHttpStatus=i.httpStatus,this._monitorStateMachine.event(16,null);else if(this.CanRetry(1)&&5===i.status)this._currentFailedRequestRetries.addRetryCondition(1),n=!0,this._lastHttpStatus=i.httpStatus,this._monitorStateMachine.event(15,null);else{this._monitorStateMachine.event(4,null);var o=i.responseHeaders?i.responseHeaders[f.h.correlationIdHeaderName]:"";l.ULS.sendTraceTag(22552773,e.MonitorLogCategory,15,"Request failed {0}",{Status:i.status,HttpStatus:i.httpStatus,Correlation:o,Id:i.id,ConsecutiveErrors:this.get_consecutiveErrors()}),this._lastHttpStatus=i.httpStatus}else this._monitorStateMachine.event(4,null),l.ULS.sendTraceTag(23425240,e.MonitorLogCategory,15,"RequestFailed and event data is null");if(!n&&(this._currentFailedRequestRetries.clear(),r?this.KickoutIfIntervalElapsed(17,U.o.docxSaveMonitorKickout_Offline,"while offline"):this.KickoutIfIntervalElapsed(11,U.o.docxSaveMonitorKickout,"while online")))return;this.updateInterval(n?e.RetryOnceImmediatelyIntervalMs:this._failureIntervalMs)},e.prototype.KickoutIfIntervalElapsed=function(e,t,n){return this._currentTimeGetter().getTime()-this._lastSuccessfulIterationTime.getTime()>this._kickoutMs&&(this._monitorStateMachine.event(e,{}),this.Stop("request failed after kickout interval "+n),this.Kickout(t),!0)},e.prototype.CheckSaveRequestSucceeded=function(t){this.set_consecutiveErrors(this.get_consecutiveErrors()+1),this._isRequestPending=!1;var n={};this._currentFailedRequestRetries.clear();var r=t.get_data();if(r){var i=r.responseHeaders?r.responseHeaders[f.h.correlationIdHeaderName]:"";n.HttpStatus=r.httpStatus,n.Correlation=i,n.Id=r.id,l.ULS.sendTraceTag(23425242,e.MonitorLogCategory,this._infoRequestLoggingEnabled?50:100,"Request succeeded at the HTTP level {0}",n),this._lastHttpStatus=r.httpStatus}else l.ULS.sendTraceTag(23425241,e.MonitorLogCategory,15,"Request succeeded with null response data");if(this._isAppShuttingDown()||!this.get_docxSaveMonitorTaskId())return this._monitorStateMachine.event(5,null),void this.Stop("session has shut down");if(!this.IsSessionLostOrExpired()){if(!r||!r.responseData)return this._monitorStateMachine.event(6,null),void this.KickoutOnUnrecognizedDataIfNeeded("null response",n);var o=this.deserializeResponse(r.responseData);if(!o)return this._monitorStateMachine.event(7,null),void this.KickoutOnUnrecognizedDataIfNeeded("invalid response",n);if(this._localCobaltLocationInfo.updateLocalCobaltLocationInfoIfNecessary(o),o.StatusCode){var a=!1,s=8;switch(o.StatusCode){case 88:s=18,a=!0,this.Stop("deleted DSS session");break;case 89:s=19,a=!0,this.Stop("expired DSS session");break;case 104:a=!0,this.Stop("this operation is disabled on the server")}var u=!1;return a||(u=this.KickoutOnUnrecognizedDataIfNeeded("unrecognized OperationResult: "+o.StatusCode,n)),void(u||this._monitorStateMachine.event(s,n))}this.set_consecutiveErrors(0),this._lastSuccessfulIterationTime=this._currentTimeGetter(),this._retriedUnrecognizedOperationResult.clear();var c={LastSavedRevisionId:o.LastSavedRevisionId},d=N.j.toExtendedGuid(o.LastSavedRevisionId);this.setMostRecentRevisionId(d,3);var p=this.GetContentObjectSpace().get_store().getRevision(d);if(p){for(var g=null,h=this.GetCurrentRevision(),_=p.getCommonDependency(h),m=_?_.get_id():E.h.get_nil(),y=h;y&&!y.get_id().equals(m);)g=y,y=y.get_baseRevision();this.HandleProblemState(g,c,h)||this._monitorStateMachine.event(9,null)}else this.HandleExceededOldestAllowedLocalRevision()||this._monitorStateMachine.event(12,c);this.updateInterval(this._successIntervalMs)&&l.ULS.sendTraceTag(22552774,e.MonitorLogCategory,50,"Received response from server -- going back to normal interval")}},e.prototype.KickoutOnUnrecognizedDataIfNeeded=function(t,n){if(this._retriedUnrecognizedOperationResult.contains(t)){if(this.KickoutIfIntervalElapsed(11,U.o.docxSaveMonitorKickout,t))return n.ConsecutiveErrors=this.get_consecutiveErrors(),n.Reason=t,l.ULS.sendTraceTag(41997899,e.MonitorLogCategory,15,"DocxSaveMonitor kickout. {0}",n),!0}else this._retriedUnrecognizedOperationResult.add(t);return this.updateInterval(this._failureIntervalMs),!1},e.prototype.HandleProblemState=function(t,n,r){var i=!1;if(t){var o=this._currentTimeGetter().getTime()-t.get_creationTime().getTime();o>=this._warningMs&&(i=!0,e.MergeDictionaries(n,this.GetRevisionLoggingInfo(t,o,r)),o>=this._kickoutMs&&10===this._monitorStateMachine.get_currentState()?(this._monitorStateMachine.event(11,n),this.Stop("didn't save in time"),this.Kickout(U.o.docxSaveMonitorKickout)):(this._monitorStateMachine.event(10,n),this.forceSave()))}return i},e.prototype.deserializeResponse=function(e){var t;return j.j.tryDeserializeServerResponse(e,(0,F.m)((function(){return t}),(function(e){return t=e})))?t.Responses[0]:null},e.prototype.GetRevisionLoggingInfo=function(e,t,n){var r={};return r.FirstUnsavedRevisionId=e.get_id().toString(),r.FirstUnsavedRevisionLengthToRoot=e.get_lengthToRoot(),r.UnsavedTimeInMs=t,r.CurrentRevisionId=n.get_id().toString(),r.CurrentRevisionLengthToRoot=n.get_lengthToRoot(),r},e.prototype.forceSave=function(){V.q.forceSaveAsync(8,null,null,null)},e.prototype.Kickout=function(t){this._shouldKickout?(this.Stop(e.KickoutStopMessage),t===U.o.docxSaveMonitorKickout_SessionAccessTokenExpired?this._kickoutExecutor.get_value().kickout(t,(0,P.m)(new x.g,{businessBarButtonType:4,businessBarDescription:Box4Intl.Box4Strings.L_SessionExpiredMessageDescription,businessBarTitle:Box4Intl.Box4Strings.L_SessionExpiredMessageTitle,showDescription:!0}),null):this._kickoutExecutor.get_value().kickout(t,new x.g,null)):l.ULS.sendTraceTag(19247383,e.MonitorLogCategory,50,"Kickout disabled")},e.prototype.ResultStateChanged=function(t,n){var r={};r.DocxSaveMonitorState=H[n.get_newState()],r.PreviousState=H[n.get_previousState()],r.PreviousStateHits=n.get_previousStateHitCount(),r.LastHttpStatus=this._lastHttpStatus,r.LastSuccessTime=this._lastSuccessfulIterationTime.toISOString(),this._requestStartTime&&(r.LastRequestStartTime=this._requestStartTime.toISOString());var i=n.get_stateData();i&&e.MergeDictionaries(r,i);var o=n.get_newState();switch(o){case 13:l.ULS.sendTraceTag(5830086,e.MonitorLogCategory,50,"{0}",r);break;case 1:l.ULS.sendTraceTag(5884125,e.MonitorLogCategory,50,"{0}",r);break;case 0:l.ULS.sendTraceTag(5830087,e.MonitorLogCategory,50,"{0}",r);break;case 2:l.ULS.sendTraceTag(5830088,e.MonitorLogCategory,50,"{0}",r);break;case 3:l.ULS.sendTraceTag(5830089,e.MonitorLogCategory,50,"{0}",r);break;case 4:l.ULS.sendTraceTag(5884126,e.MonitorLogCategory,50,"{0}",r);break;case 5:l.ULS.sendTraceTag(5884127,e.MonitorLogCategory,50,"{0}",r);break;case 6:l.ULS.shipAssertTag(5830090,e.MonitorLogCategory,!1,"{0}",r);break;case 7:l.ULS.shipAssertTag(5830091,e.MonitorLogCategory,!1,"{0}",r);break;case 8:l.ULS.sendTraceTag(5830092,e.MonitorLogCategory,15,"{0}",r);break;case 10:l.ULS.sendTraceTag(5830094,e.MonitorLogCategory,15,"{0}",r);break;case 9:l.ULS.sendTraceTag(5884128,e.MonitorLogCategory,50,"{0}",r);break;case 11:l.ULS.sendTraceTag(5830096,e.MonitorLogCategory,15,"{0}",r);break;case 17:l.ULS.sendTraceTag(37835678,e.MonitorLogCategory,15,"{0}",r);break;case 12:l.ULS.sendTraceTag(5830095,e.MonitorLogCategory,50,"{0}",r);break;case 18:l.ULS.sendTraceTag(38122832,e.MonitorLogCategory,50,"{0}",r);break;case 19:l.ULS.sendTraceTag(38122833,e.MonitorLogCategory,50,"{0}",r);break;case 14:l.ULS.sendTraceTag(6575508,e.MonitorLogCategory,50,"{0}",r);break;case 15:l.ULS.sendTraceTag(36739287,e.MonitorLogCategory,50,"{0}",r);break;case 16:l.ULS.sendTraceTag(36767649,e.MonitorLogCategory,50,"{0}",r);break;default:l.ULS.shipAssertTag(5884129,e.MonitorLogCategory,!1,"Bad state:{0} logInfo:{1}",o,r)}},e.MergeDictionaries=function(e,t){for(var n in t){var r={key:n,value:t[n]};e[r.key]=r.value}},e.RetryOnceImmediatelyIntervalMs=0,e.ServiceUrl=b.App.webServiceBase+"OneNote.ashx",e.KickoutStopMessage="kickout",e.MonitorLogCategory=343,e.MinOldestLocalRevisionStuckIterationsBeforeKickout=5,e}();(0,r.l)(q,"8c0e6844$DocxSaveMonitor",null,[o.o]);var z=n(5516),K=n(1751),Q=function(){function e(e,t){this._saveMonitor=null,this._hasPendingOutboundsCallback=null,this._saveMonitor=e,this._hasPendingOutboundsCallback=t}return e.prototype.RegisterActions=function(e){e.addAction(z.u.pendingAutosavesCheck,K.d.view,r.i(this,this.PendingAutosavesCheck,"PendingAutosavesCheck")),e.addAction(z.u.updateDocxSaveMonitorInterval,K.d.view,r.i(this,this.UpdateDocxSaveMonitorInterval,"UpdateDocxSaveMonitorInterval")),e.setActionFlags(z.u.updateDocxSaveMonitorInterval,101)},e.prototype.PendingAutosavesCheck=function(e,t,n,r,i){var o=this._hasPendingOutboundsCallback();return 32!==o?o:!this._saveMonitor||this._saveMonitor.get_isUpToDate()?32:this._saveMonitor.get_consecutiveErrors()>=2?8:4},e.prototype.UpdateDocxSaveMonitorInterval=function(e,t,n,r,i){if(this._saveMonitor){var o=parseInt(i.toString());this._saveMonitor.updateInterval(o)}return 32},e}();(0,r.l)(Q,"9cae562f$DocxSaveMonitorActor",null,[]);var Z=(0,r.y)("dd14f7b3$IDocxSaveMonitorTaskManager"),J=function(){function e(){}return e.prototype.createTask=function(e,t){return window.setInterval(e,t)},e.prototype.deleteTask=function(e){window.clearInterval(e)},e.instance=new e,e}();(0,r.l)(J,"3d819bda$DocxSaveMonitorTaskManager",null,[Z]);var X=(0,r.y)("85a39c6b$IRequestLifeCycleTelemetryManager"),Y=function(){function e(e){this._storage=null,this._requestId=0,this._storage=e}return e.prototype.start=function(e){this._storage&&(this._requestId=e,this._storage.reset())},e.prototype.log=function(){if(this._storage){var e={};e.RequstId=this._requestId,e.InvokeCount=this._storage.invokeCount,e.InvokeFailedCount=this._storage.invokeFailedCount,e.NoOpenConnectionCount=this._storage.noOpenConnectionCount,e.SynchronousNotificationCount=this._storage.synchronousNotificationCount,e.ResponseNotAvailable=this._storage.get_responseNotAvailableIds(),l.ULS.sendTraceTag(19161613,205,50,"ClientRequestManagerTelemetryStorage: {0}",e)}},e}();(0,r.l)(Y,"ff04a602$RequestLifeCycleTelemetryManager",null,[X]);var ee=n(4537);n.d(t,{WordEditorDocxSaveMonitorPackage:function(){return te}});var te=function(){function e(){this._saveMonitor=null,this._container=null}return e.prototype.get_name=function(){return"WordEditor.DocxSaveMonitor"},e.prototype.init=function(){(b.App.get_canEdit()||b.App.get_isReviewer())&&(this._saveMonitor=this._container.resolve(q),new Q(this._saveMonitor,(function(){return A.WoncaApp.get_theReplicationScheduler().hasPendingOutboundReplications()})).RegisterActions(u.AFrameworkApplication.get_theActionManager()))},e.prototype.CreateSaveMonitor=function(){var e=u.AFrameworkApplication.appSettingsManager;if(!e.getBooleanAppSetting("DocxSaveMonitorEnabled"))return null;var t=e.getBooleanAppSetting("DocxSaveMonitorKickoutEnabled"),n=e.getIntAppSetting("DocxSaveMonitorIntervalMs",6e4),o=e.getIntAppSetting("DocxSaveMonitorFailureIntervalMs",5e3),a=e.getIntAppSetting("DocxSaveMonitorWarningTimeMs",12e4),s=e.getIntAppSetting("DocxSaveMonitorKickoutTimeMs",3e5),c=e.getIntAppSetting("DocxSaveMonitorQueueTimeoutMs",6e4),g=e.getIntAppSetting("DocxSaveMonitorSentTimeoutMs",12e4),_=e.getIntAppSetting("DocxSaveMonitorOldestAllowedLocalRevisionMs",3e5),f=e.getBooleanAppSetting("DocxSaveMonitorTelemetryInfoEnabled"),m=e.getBooleanAppSetting("DocxSaveMonitorInfoRequestLoggingEnabled"),y=e.getBooleanAppSetting("DocxSaveMonitorRawWebRequestsEnabled"),v=e.getBooleanAppSetting("DocxSaveMonitorMaxLocalRevisionAgeEnforcementIsEnabled"),S=u.AFrameworkApplication.theClientRequestManager,I=y?new C(u.AFrameworkApplication.userSessionId,S.get_wacClusterId(),S.get_defaultSentTimeoutMs()):null,A=new h(S,I,y),M=f&&S&&!y?new Y(S.get_telemetryStorage()):null,P=new B;P.addRetryCondition(1),P.addRetryCondition(2);var F=new q(n,o,a,t,s,c,g,_,J.instance,A,T.w.get_instance().resolveLazy(i.r),ee.n.get_instance(),r.i(this,this.GetTargetNode,"GetTargetNode"),(function(){return!u.AFrameworkApplication.needsSignOutChecking||p.SignOutResponse.get_instance().get_isAuthenticated()}),(function(){return b.App.get_lostSession()}),r.i(d.c.get_instance(),d.c.get_instance().checkAndTriggerSessionHasExpired,"checkAndTriggerSessionHasExpired"),(function(){return u.AFrameworkApplication.isShuttingDown}),(function(){return new Date}),(function(){return new Date}),M,m,P,v,r.i(this,this.GetOldestAllowedLocalRevisionKickoutDiagnosticLog,"GetOldestAllowedLocalRevisionKickoutDiagnosticLog"));return F.Start(),l.ULS.sendTraceTag(5884131,q.MonitorLogCategory,50,"SaveMonitor initialized"),F},e.prototype.GetTargetNode=function(){var e=b.App.get_activeAppFrame().workspace.get_contentView();return e?e.get_targetNode():null},e.prototype.GetOldestAllowedLocalRevisionKickoutDiagnosticLog=function(){var e={};return u.AFrameworkApplication.get_theTaskManager()&&(e.TM=u.AFrameworkApplication.get_theTaskManager().getDiagnosticStateForLogging()),A.WoncaApp.get_theReplicationScheduler()&&(e.RS=A.WoncaApp.get_theReplicationScheduler().getDiagnosticStateForLogging()),M.App.theCoauthReplicationScheduler&&(e.CRS=M.App.theCoauthReplicationScheduler.getDiagnosticStateForLogging()),b.App.get_activeAppFrame()&&b.App.get_activeAppFrame().workspace&&b.App.get_activeAppFrame().workspace.get_activePage()&&b.App.get_activeAppFrame().workspace.get_activePage().get_contentReplicator()&&(e.GSR=b.App.get_activeAppFrame().workspace.get_activePage().get_contentReplicator().getDiagnosticStateForLogging()),u.AFrameworkApplication.get_isSleeping()&&(e.S=1),b.App.get_lostSession()&&(e.LS=1),b.App.get_theCoauthManager()&&b.App.get_theCoauthManager().get_isKickedOut()&&(e.KO=1),Sys.Serialization.JavaScriptSerializer.serialize(e)},e.prototype.dispose=function(){this._saveMonitor&&this._saveMonitor.Stop("WordEditorDocxSaveMonitorPackage is being disposed")},e.prototype.configure=function(e){this._container=e,(b.App.get_canEdit()||b.App.get_isReviewer())&&e.register(q).as(o.o).singleInstance().usingFactory(r.i(this,this.CreateSaveMonitor,"CreateSaveMonitor"))},e.main=function(){c.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(te,"cd680411$WordEditorDocxSaveMonitorPackage",null,[a.u,s.s])},8692:function(e,t,n){"use strict";n.d(t,{d:function(){return o}});var r=n(5200),i=n(423),o=function(){function e(){}return e.prototype.findResultChanged=function(e,t){},e.prototype.findComplete=function(){},e.prototype.setTotalHitCount=function(e){},e.prototype.setActiveHitNumber=function(e){},e.prototype.reset=function(){},e.prototype.findStarted=function(){},e.prototype.update=function(){},e.prototype.setResultsOutOfSyncWithDocument=function(e){},e.prototype.dispose=function(){},e}();(0,i.l)(o,"4be769b$FindStatusManagerStub",null,[r.v,Sys.IDisposable])},8761:function(e,t,n){"use strict";n.d(t,{h:function(){return r}});var r=(0,n(423).y)("34c55df3$IUploadToHostManager")},8816:function(e,t,n){"use strict";n.r(t),n.d(t,{CpDataHelper:function(){return a}});var r=n(1822),i=n(4439),o=n(423),a=function(){function e(){}return e.validateCpDataV1=function(e){return"number"==typeof e.CP&&((null==e.FB||"number"==typeof e.FB)&&((null==e.FE||"number"==typeof e.FE)&&((null==e.HB||"number"==typeof e.HB)&&((null==e.HE||"number"==typeof e.HE)&&((null==e.CB||"number"==typeof e.CB)&&((null==e.CE||"number"==typeof e.CE)&&((null==e.R||"number"==typeof e.R)&&((null==e.E||"number"==typeof e.E)&&((null==e.TW||"number"==typeof e.TW)&&((null==e.PB||"number"==typeof e.PB)&&((null==e.SYM||"number"==typeof e.SYM)&&((null==e.IE||"number"==typeof e.IE)&&((null==e.OO||"number"==typeof e.OO)&&((null==e.AX||"number"==typeof e.AX)&&(null==e.CCI||"number"==typeof e.CCI)))))))))))))))},e.isEqual=function(e,t){return!e&&!t||!(!e||!t)&&(e.CP===t.CP&&(e.FB===t.FB&&(e.FE===t.FE&&(e.HB===t.HB&&(e.HE===t.HE&&(e.CB===t.CB&&(e.CE===t.CE&&(e.R===t.R&&(e.E===t.E&&(e.TW===t.TW&&(e.PB===t.PB&&(e.SYM===t.SYM&&(e.IE===t.IE&&(e.OO===t.OO&&(e.AX===t.AX&&e.CCI===t.CCI)))))))))))))))},e.isSupportedCpVersion=function(e){return 1===e},e.GetUsableCpData=function(t,n){var r=t,i=0;if("number"==typeof r.VS&&(i=r.VS),!("number"!=typeof r.VS&&"number"!=typeof r.CP))return n.val=i,r;var o=t;r=null;for(var a=0;a<o.length;a++){var s=o[a];e.isSupportedCpVersion(s.VS)&&s.VS>i&&(i=s.VS,r=o[a])}return n.val=i,r},e.validateVersionedCpData=function(t){var n,i=e.GetUsableCpData(t,(0,r.m)((function(){return n}),(function(e){return n=e})));if(!i)return!1;switch(n){case 0:case 1:return e.validateCpDataV1(i);default:return!1}},e.versionedDeserialize=function(t){if(!t)return null;var n,o=e.GetUsableCpData(t,(0,r.m)((function(){return n}),(function(e){return n=e})));if(!o)return null;switch(n){case 0:case 1:return i.x.deserializeCpData(o);default:return null}},e}();(0,o.l)(a,"1021eda1$CpDataHelper",null,[])},8894:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(423),o=n(1227),a=n(984),s=n(2298),l=n(7862),u=n(9137),c=n(3093),d=n(8832),p=n(5373),g=n(363),h=n(8192),_=n(3362),f=n(7597),m=n(6935),y=n(2575),v=function(){function e(e,t,n,r,i){this._settings=null,this.clientId=null,this.getUserPresence=null,this.getUserStatusInfo=null,this.displayOnlyUniqueUsers=!1,this._settings=e,this.clientId=t,this.displayOnlyUniqueUsers=i,this.getUserPresence=n||function(e){return null},this.getUserStatusInfo=r||function(e){return null}}return e.prototype.get_id=function(){return this._settings.get_id()},e.prototype.get_actionIdCommand=function(){return this._settings.get_actionIdCommand()},e.prototype.get_actionIdQueryStatus=function(){return this._settings.get_actionIdQueryStatus()},e.prototype.get_actionIdPopulateFlyout=function(){return this._settings.get_actionIdPopulateFlyout()},e.prototype.get_actionIdCommandMenuOpen=function(){return this._settings.get_actionIdCommandMenuOpen()},e.prototype.get_actionIdCommandMenuClose=function(){return this._settings.get_actionIdCommandMenuClose()},e.prototype.get_actionIdUserButtonClick=function(){return this._settings.get_actionIdUserButtonClick()},e.prototype.get_actionIdRefreshControl=function(){return this._settings.get_actionIdRefreshControl()},e.prototype.get_singleUserCollabGlyph16=function(){return this._settings.get_singleUserCollabGlyph16()},e.prototype.get_singleUserCollabGlyph32=function(){return this._settings.get_singleUserCollabGlyph32()},e.prototype.get_multipleUserCollabGlyph16=function(){return this._settings.get_multipleUserCollabGlyph16()},e.prototype.get_groupChatButtonGlyph32=function(){return this._settings.get_groupChatButtonGlyph32()},e.prototype.get_clientId=function(){return this.clientId},e.prototype.get_getUserPresence=function(){return this.getUserPresence},e.prototype.get_getUserStatusInfo=function(){return this.getUserStatusInfo},e.prototype.get_displayOnlyUniqueUsers=function(){return this.displayOnlyUniqueUsers},e.createInstance=function(t,n,r,i,o){return new e(t,n,r,i,o)},e}();(0,i.l)(v,"55e2753$PeoplesWellSettings",null,[]);var S=n(6382),I=n(2449),C=n(9423),T=n(3545),b=n(2893),A=n(1822),M=n(5214),P=n(127),F=n(9910),w=n(8967),R=n(4381),E=n(6379),k=n(9633),D=function(e){function t(){var t=e.call(this)||this;return t.JoinTimeInMS=0,t.IsAnonymous=!1,t.ImageUrl=null,t.ActiveStatus=!1,t.CanJump=!1,t.ChatCapable=!1,t.Upn=null,t}return(0,T.t)(t,e),t}(w.k);(0,i.l)(D,"49287798$PeopleButtonProps",w.k,[]);var O=n(7065),U=n(877),x=n(9641),L=(0,i.y)("6c66b114$IUserTracker"),N=n(7847),B=function(){function e(e){this.clientId=null,this.currentUserInstance=null,this.userToInstanceMapping=new N.w(Array),this.clientId=e}return e.prototype.setUsers=function(e){this.RemoveAllUserMappings(),this.SetCurrentUserInstance(e);for(var t=0,n=e;t<n.length;t++){var r=n[t];r.get_clientId()!==this.clientId&&this.addUserInstance(r)}},e.prototype.get_userList=function(){for(var e=new Array(0),t=this.userToInstanceMapping.get_values().$$ge();t.$$mn();){var n=t.$$cu(),r=this.selectRepresenativeUserInstance(n);Array.add(e,r)}return e},e.prototype.get_numUsers=function(){return this.userToInstanceMapping.get_count()},e.prototype.addUserMapping=function(e,t){var n;e=e.toUpperCase(),this.userToInstanceMapping.tryGetValue(e,(0,A.m)((function(){return n}),(function(e){return n=e})))||(n=new Array(0),this.userToInstanceMapping.set_item(e,n)),Array.add(n,t)},e.prototype.RemoveAllUserMappings=function(){this.userToInstanceMapping=new N.w(Array)},e.prototype.SetCurrentUserInstance=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r.get_clientId()===this.clientId)return void(this.currentUserInstance=r)}},e}();(0,i.l)(B,"90feba5d$UserTracker",null,[L]);var H=n(1658),$=function(e){function t(t,n){var r=e.call(this,t)||this;return r._getUserStatusInfoDelegate=null,r._getUserStatusInfoDelegate=n,r}return(0,T.t)(t,e),t.prototype.addUserInstance=function(e){!e.get_isAnonymous()&&e.get_email()?this.currentUserInstance&&H.b.get_ordinalIgnoreCase().equals(this.currentUserInstance.get_email(),e.get_email())||this.addUserMapping(e.get_email(),e):this.addUserMapping(e.get_clientId(),e)},t.prototype.selectRepresenativeUserInstance=function(e){for(var t=new Date(0),n=e.length>0?e[0]:null,r=0,i=e;r<i.length;r++){var o=i[r],a=this._getUserStatusInfoDelegate(o.get_clientId());a&&(t.getTime()<a.lastStatusChange.getTime()&&(t=a.lastStatusChange,n=o))}return n},t}(B);(0,i.l)($,"ed5c0a8e$UniqueUserTracker",B,[]);var G=function(e){function t(t){return e.call(this,t)||this}return(0,T.t)(t,e),t.prototype.addUserInstance=function(e){this.addUserMapping(e.get_clientId(),e)},t.prototype.selectRepresenativeUserInstance=function(e){return e[0]},t}(B);(0,i.l)(G,"3a3f62f4$UserInstanceTracker",B,[]);var W=function(){function e(){}return e.CreateInstance=function(e,t,n){return n?new $(e,t):new G(e)},e}();(0,i.l)(W,"38c62e29$UserTrackerFactory",null,[]);var V=n(2192),j=n(6378),q=n(7074),z=n(509),K=function(){function e(t,n,r,o){var a=this;this._defaultInfoForCurrentUser=null,this._isStatusLabelDirty=!1,this._peoplesWellActionHandlersRegistered=!1,this.settings=null,this.userTracker=null,this.peopleManager=null,this._peopleInfoProvider=null,this._chatAvailabilityFinder=null,this.isForeverAlone=!1,this._timeOfRenderTcs=new P.z(Number),this.settings=t,this.peopleManager=n,r&&r.CW((function(e){a._peopleInfoProvider=r.get_result(),a._peopleInfoProvider.add_usersUpdated(i.i(a,a.onUsersUpdated,"onUsersUpdated")),a.refreshControlDataAndView()})),o&&o.CW((function(e){a._chatAvailabilityFinder=o.get_result(),a._chatAvailabilityFinder.add_coauthorAvailabilityChanged(i.i(a,a.onUsersUpdated,"onUsersUpdated")),a.refreshControlDataAndView()})),this._defaultInfoForCurrentUser=new O.PresenceUser(this.get_settings().get_clientId(),e.DefaultUsername,e.DefaultUserColor,new U.w(7),null,null,null,null,!1,!1,!1,0,null),this._isStatusLabelDirty=!0,this.isForeverAlone=!0,this._peoplesWellActionHandlersRegistered=!1,this.userTracker=W.CreateInstance(this.get_settings().get_clientId(),this.get_settings().get_getUserStatusInfo(),t.get_displayOnlyUniqueUsers())}return e.prototype.get_settings=function(){return this.settings},e.prototype.get_IsColorPresenceHashEnabled=function(){return!!y.AFrameworkApplication.appSettingsManager&&y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ColorPresenceHashIsEnabled")},e.prototype.getControlStatusData=function(e,t,n,r,i,o){var a,s,l,u,c=this.getControlStatusString();this.userTracker.get_numUsers()?1===this.userTracker.get_numUsers()?(a=!0,s=this.get_settings().get_singleUserCollabGlyph16().cluster,l=this.get_settings().get_singleUserCollabGlyph16().css,u=this.userTracker.get_userList()[0].get_color()):(a=!0,s=this.get_settings().get_multipleUserCollabGlyph16().cluster,l=this.get_settings().get_multipleUserCollabGlyph16().css,u=""):(a=!1,s="",l="",u=""),e.val=c[0],t.val=c.slice(1),n.val=a,r.val=s,i.val=l,o.val=u},e.prototype.getControlStatusString=function(){if(this.userTracker.get_numUsers()>=2)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.userTracker.get_numUsers())];if(1===this.userTracker.get_numUsers()){var e=this.userTracker.get_userList()[0],t=this.get_settings().get_getUserStatusInfo()(e.get_clientId());return t&&2===t.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,e.get_userName()]:[e.get_isReadOnly()?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,e.get_userName()]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]},e.prototype.getUserStatusString=function(e){return this.getUserStatusStringInternal(e)},e.prototype.canJumpToUserLocationInternal=function(e,t,n){if(!t)return n&&f.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1;if(!this.canJumpToUserLocation(e,t))return n&&f.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1;var r=this.get_settings().get_getUserStatusInfo()(e);return!r||2!==r.status},e.prototype.getStatusStringForNonRealitimeChannelCapableUsers=function(e){return e.get_isReadOnly()?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown},e.prototype.getUserStatusStringInternal=function(e){if(!e.get_capabilities().hasFlag(1))return this.getStatusStringForNonRealitimeChannelCapableUsers(e);var t=e.get_isReadOnly(),n=this.get_settings().get_getUserStatusInfo()(e.get_clientId()),r=this.get_settings().get_getUserPresence()(e.get_clientId());if(!n)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(n.status){case 1:return r?t?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.convertUserPresenceToStatusString(e.get_clientId(),t,r)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}},e.prototype.getImageUrlForUser=function(e){return this.peopleManager.createUserProfilePictureUrl(e.get_email(),"O365",y.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,0)},e.prototype.getUserActiveState=function(e){var t=this.get_settings().get_getUserStatusInfo()(e.get_clientId());return!(t&&(!t||1!==t.status))},e.prototype.getUserChatCapability=function(e){return this._chatAvailabilityFinder?this._chatAvailabilityFinder.findCoauthorAvailability(e.get_clientId()):e.get_capabilities().hasFlag(4)},e.prototype.getUserButtonProps=function(t){var n=String.format("buttonPeoplesWellUser-{0}",t.get_clientId()),r=t.get_clientId(),i=this.getUserStatusString(t),o=t.get_userName(),a=t.get_color(),s=(0,M.m)(new D,{Id:n,Command:this.get_settings().get_actionIdUserButtonClick().toString(),LabelText:"{0}",Image32by32:this.get_settings().get_singleUserCollabGlyph32().cluster,Image32by32Class:this.get_settings().get_singleUserCollabGlyph32().css,MenuItemId:r,CommandValueId:r,Alt:o,DisplayMode:this.getDisplayMode(),LabelCss:e.CssForCoauthorButton,Description:i,ImageBackColor:a,IsAnonymous:t.get_isAnonymous(),LabelTextUserGeneratedPlaceholderReplacements:z.n.encodeStringArrayXmlAttribute([o]),Upn:t.get_email()});if(y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled")&&this.peopleManager){var l=this.getImageUrlForUser(t),u=this.getUserActiveState(t);s.ImageUrl=l,s.ActiveStatus=u;var c=t.get_joinTime();s.JoinTimeInMS=c;var d=this.canJumpToUserLocationInternal(t.get_clientId(),this.get_settings().get_getUserPresence()(t.get_clientId()),!1),p=this.getUserChatCapability(t);s.CanJump=d,s.ChatCapable=p,""===l&&f.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed")}return s},e.prototype.getGroupChatButtonProps=function(){return(0,M.m)(new w.k,{Id:e.SkypeButtonPrefixId,Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:e.CssForCoauthorButton})},e.prototype.getDisplayMode=function(){return this.get_IsColorPresenceHashEnabled()?"Initials":"Menu32"},e.prototype.getUserButtonsProps=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n],o=this.getUserButtonProps(i);Array.add(t,o)}return t},e.prototype.isControlEnabled=function(){return this.userTracker.get_numUsers()>0},e.prototype.queryUsers=function(e){return!this._isStatusLabelDirty||(this.isForeverAlone||(e[q.g.Visible]=!0),this.getControlStatusData((0,A.m)((function(){return t}),(function(e){return t=e})),(0,A.m)((function(){return n}),(function(e){return n=e})),(0,A.m)((function(){return r}),(function(e){return r=e})),(0,A.m)((function(){return i}),(function(e){return i=e})),(0,A.m)((function(){return o}),(function(e){return o=e})),(0,A.m)((function(){return a}),(function(e){return a=e}))),e[q.g.LabelText]=t,n&&n.length&&(e[q.g.LabelTextUserGeneratedPlaceholderReplacements]=n),e[q.g.ImageIsVisible]=r,e[q.g.Image16by16Class]=o,e[q.g.ImageBackColor]=a,this._isStatusLabelDirty=!1,!0);var t,n,r,i,o,a},e.prototype.populateFlyoutContents=function(e){if(this.userTracker.get_numUsers()<=0)return!1;var t=this.sortUsers(this.userTracker.get_userList()),n=this.getUserButtonsProps(t),r=(0,M.m)(new E.b,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]}),i=(0,M.m)(new k.x,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.getDisplayMode(),ControlList:n});if(y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.peopleManager&&(i.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,i.TitleId="menuCoauthorsTitle",i.Theme="Light"),Array.add(r.MenuSectionList,i),y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocChatIsEnabled")&&y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled")&&y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled()){var o=[];Array.add(o,this.getGroupChatButtonProps());var a=(0,M.m)(new k.x,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:o});Array.add(r.MenuSectionList,a)}return y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled()?e.MenuItems=r:e.PopulationXML=R.s.getXmlFromMenuProps(r),!0},e.prototype.userButtonClick=function(e){f.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");var t=e.MenuItemId;if(!t)return!1;var n=this.get_settings().get_getUserPresence()(t);return!!this.canJumpToUserLocationInternal(t,n,!0)&&(this.jumpToUserLocation(t,n),!0)},e.prototype.refreshControlData=function(){var e=this.getAllUsersInfoInternal();this.userTracker.setUsers(e),this.isForeverAlone&&this.userTracker.get_numUsers()>=1&&(f.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.isForeverAlone=!1),this._isStatusLabelDirty=!0},e.prototype.refreshControlView=function(){this.refreshControlViewImpl()},e.prototype.onUsersUpdated=function(e,t){this.refreshControlDataAndView()},e.prototype.getAllUsersInfoInternal=function(){var e=null;e||(e=this.getAllUsersInfo()||[]);for(var t=0,n=e;t<n.length;t++){var r=n[t];this.SanityCheckPresenceUser(r)}return e},e.prototype.SanityCheckPresenceUser=function(t){t.get_clientId()||t.set_clientId(x.l.create().toString()),t.get_userName()||t.set_userName(e.DefaultUsername),t.get_capabilities()||t.set_capabilities(new U.w(0)),t.get_color()||t.set_color(e.DefaultUserColor),t.get_joinTime()||t.set_joinTime(0)},e.prototype.sortUsers=function(t){var n=[];return Array.addRange(n,t),n.sort(e.OrderByRealTimeThenLocale),n},e.prototype.registerPeoplesWellControl=function(){y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PeoplesWellExtraButtonInfoIsEnabled")&&y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CoauthorGalleryTelemetryIsEnabled")&&y.AFrameworkApplication.get_theActionManager().addAction(F.b.coauthorsRendered,V.m.frame,i.i(this,this.OnCoauthorGalleryFirstRender,"OnCoauthorGalleryFirstRender")),this.registerPeoplesWellControlActionHandlers(),this._peoplesWellActionHandlersRegistered=!0,this.refreshControlDataAndView()},e.prototype.OnCoauthorGalleryFirstRender=function(e,t,n,r,i){return this._timeOfRenderTcs.trySetResult(i.RenderTime),32},e.prototype.get_timeOfRenderAsync=function(){return this._timeOfRenderTcs.get_task()},e.prototype.refreshControlDataAndView=function(){this._peoplesWellActionHandlersRegistered||(this._timeOfRenderTcs.trySetResult((new Date).getTime()),f.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time")),this.refreshControlData(),this.refreshControlViewImpl()},e.prototype.dispose=function(){this._peopleInfoProvider&&(this._peopleInfoProvider.remove_usersUpdated(i.i(this,this.onUsersUpdated,"onUsersUpdated")),this._peopleInfoProvider=null),this._chatAvailabilityFinder&&(this._chatAvailabilityFinder.remove_coauthorAvailabilityChanged(i.i(this,this.onUsersUpdated,"onUsersUpdated")),this._chatAvailabilityFinder=null)},e.OrderByRealTimeThenLocale=function(e,t){var n=e,r=t;return n.get_capabilities().hasFlag(1)&&r.get_capabilities().hasFlag(1)||!n.get_capabilities().hasFlag(1)&&!r.get_capabilities().hasFlag(1)?j.l.localeCompare(e.get_userName(),t.get_userName()):n.get_capabilities().hasFlag(1)?-1:1},e.CssForCoauthorButton="display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",e.DefaultUserColor="#cccccc",e.DefaultUsername="Anonymous user",e.SkypeButtonPrefixId="BasicChat",e}();(0,i.l)(K,"6b68f617$APeoplesWell",null,[a.t,Sys.IDisposable]);var Q=n(1751),Z=function(e){function t(t,n,r,i){var o=this;return o._dummyTrue=null,o._actionManager=null,(o=e.call(this,t,r,i,null)||this)._dummyTrue=function(e){return!0},o._actionManager=n,o}return(0,T.t)(t,e),t.prototype.queryUsersProxy=function(e){return this.queryUsers(e)},t.prototype.populateFlyoutContentsProxy=function(e){return this.populateFlyoutContents(e)},t.prototype.userButtonClickProxy=function(e){return this.userButtonClick(e)},t.prototype.handleAction=function(e,n,r,i,o,a,s){var l=!1;switch(r){case 1:l=a(o);break;case 2:l=s(o)}return t.BoolToActionResponse(l)},t.prototype.isControlEnabledHandler=function(e,t,n,r,i){var o=this;return this.handleAction(e,t,n,r,i,(function(e){return o.isControlEnabled()}),this._dummyTrue)},t.prototype.queryUsersHandler=function(e,t,n,r,o){return this.handleAction(e,t,n,r,o,i.i(this,this.queryUsersProxy,"queryUsersProxy"),this._dummyTrue)},t.prototype.populateFlyoutContentsHandler=function(e,t,n,r,o){return this.handleAction(e,t,n,r,o,this._dummyTrue,i.i(this,this.populateFlyoutContentsProxy,"populateFlyoutContentsProxy"))},t.prototype.commandMenuOpenHandler=function(e,t,n,r,i){return this.handleAction(e,t,n,r,i,this._dummyTrue,this._dummyTrue)},t.prototype.commandMenuCloseHandler=function(e,t,n,r,i){return this.handleAction(e,t,n,r,i,this._dummyTrue,this._dummyTrue)},t.prototype.userButtonClickHandler=function(e,t,n,r,o){return this.handleAction(e,t,n,r,o,this._dummyTrue,i.i(this,this.userButtonClickProxy,"userButtonClickProxy"))},t.prototype.peoplesWellRefreshControlHandler=function(e,t,n,r,i){var o=this;return this.handleAction(e,t,n,r,i,this._dummyTrue,(function(e){return o.refreshControlDataAndView(),!0}))},t.prototype.registerPeoplesWellControlActionHandlers=function(){this._actionManager.addAction(this.get_settings().get_actionIdCommand(),Q.d.application,i.i(this,this.isControlEnabledHandler,"isControlEnabledHandler")),this._actionManager.addActionWithFlags(this.get_settings().get_actionIdQueryStatus(),Q.d.application,i.i(this,this.queryUsersHandler,"queryUsersHandler"),96),this._actionManager.addActionWithFlags(this.get_settings().get_actionIdCommandMenuOpen(),Q.d.application,i.i(this,this.commandMenuOpenHandler,"commandMenuOpenHandler"),96),this._actionManager.addActionWithFlags(this.get_settings().get_actionIdCommandMenuClose(),Q.d.application,i.i(this,this.commandMenuCloseHandler,"commandMenuCloseHandler"),96),this._actionManager.addActionWithFlags(this.get_settings().get_actionIdPopulateFlyout(),Q.d.application,i.i(this,this.populateFlyoutContentsHandler,"populateFlyoutContentsHandler"),96),this._actionManager.addAction(this.get_settings().get_actionIdUserButtonClick(),Q.d.application,i.i(this,this.userButtonClickHandler,"userButtonClickHandler")),this._actionManager.addActionWithFlags(this.get_settings().get_actionIdRefreshControl(),Q.d.application,i.i(this,this.peoplesWellRefreshControlHandler,"peoplesWellRefreshControlHandler"),96)},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.BoolToActionResponse=function(e){return e?32:8},t}(K);(0,i.l)(Z,"e04fbe0$ABox4PeoplesWell",K,[]);var J=n(7106),X=n(4551),Y=n(4764),ee=n(2879),te=n(213),ne=n(9658),re=n(6654),ie=n(5934),oe=n(1783),ae=n(3127),se=n(7664),le=function(e){function t(n,r,i,o,a,s,l,u,c,d,p,g,h,_,f){var m=this;return m._canScrollToParagraphDelegate=null,m._scrollToParagraphDelegate=null,m._refreshControlViewDelegate=null,m._selectionManager=null,m._paragraphWordIdMapping=null,m._translator=null,m._lazyobjectSpace=null,m._wordPresenceCpFactoryFuture=null,m._coauthTelemetry=null,(m=e.call(this,n,s,f,r)||this)._canScrollToParagraphDelegate=i,m._scrollToParagraphDelegate=o,m._refreshControlViewDelegate=a,m._selectionManager=l,t._workspace=u,m._paragraphWordIdMapping=c,m._translator=d,m._lazyobjectSpace=p,m._wordPresenceCpFactoryFuture=g,m._coauthTelemetry=_,m}return(0,T.t)(t,e),t.prototype.userButtonClick=function(t){var n=t.CommandValueId;return this._coauthTelemetry.jumpToUserLocationStart(n),e.prototype.userButtonClick.call(this,t)},t.prototype.jumpToUserLocation=function(e,n){var r,i=this;if(this.IsPresenceDataValidAndGetPresenceInfo(n,(0,A.m)((function(){return r}),(function(e){return r=e})))){if(this._scrollToParagraphDelegate(r.get_ip().get_paragraphId(),r.get_ip().get_presenceCp().get_cp()),y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorMoveIpToUserLocationIsEnabled")){var o=t.GetSelectionToMoveIp(r);isNullOrUndefined(o)?f.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined"):(f.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this._selectionManager.setSelection(o,null,!1,!1),Y.FocusManager.usable()&&Y.FocusManager.instance().setScope(X.AFrame.documentFocusID))}var a=new ee.c(2,1,0,(function(e){i._actionManager.processActionWithData(J.u.showPresenceFullTooltipForUser,2,r,null)}),0,null,!1);te.y.get_instance().addTask(a)}},t.prototype.GetPresenceInfo=function(e){if(!e)return null;var t=se.m.createFromRTTData(ae.e.versionedDeserialize(e),this._paragraphWordIdMapping,this._translator,this._lazyobjectSpace.get_value(),this._wordPresenceCpFactoryFuture.get_instance());return t&&t.isValid()&&t.get_ip()?t:null},t.prototype.canJumpToUserLocation=function(e,t){return this.IsPresenceDataValid(t)?!!this.CanScrollToParagraph(t)||(f.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(f.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)},t.prototype.IsPresenceDataValid=function(e){return!!this.GetPresenceInfo(e)},t.prototype.IsPresenceDataValidAndGetPresenceInfo=function(e,t){return t.val=this.GetPresenceInfo(e),!!t.val},t.prototype.CanScrollToParagraph=function(e){var t;return!!this.IsPresenceDataValidAndGetPresenceInfo(e,(0,A.m)((function(){return t}),(function(e){return t=e})))&&this._canScrollToParagraphDelegate(t.get_ip().get_paragraphId(),t.get_ip().get_presenceCp().get_cp())},t.prototype.getAllUsersInfo=function(){return this._peopleInfoProvider?this._peopleInfoProvider.getAllUsers():new Array(0)},t.prototype.convertUserPresenceToStatusString=function(e,t,n){var r;return this.IsPresenceDataValidAndGetPresenceInfo(n,(0,A.m)((function(){return r}),(function(e){return r=e})))&&!!r.get_user()&&!!r.get_user().get_presenceStatus()&&"0"!==r.get_user().get_presenceStatus()?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,r.get_user().get_presenceStatus()):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown},t.prototype.refreshControlViewImpl=function(){this._refreshControlViewDelegate(this.get_settings().get_id())},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.createInstance=function(e,n,r,i,o,a,s,l){var u=C.App.get_activeAppFrame().workspace,c=y.AFrameworkApplication.get_theActionManager(),d=re.SelectionManager.get_instance(),p=S.w.get_instance().resolve(b.a);return new t(e,n,(function(e,t){return!!u.get_contentView().get_isPageView()&&u.get_contentView().canScrollToParagraphMatchingNodeId(e,t,!0)}),(function(e,t){u.get_contentView().get_isPageView()&&u.get_contentView().scrollToParagraphMatchingNodeId(e,t,!0,!0)}),(function(e){y.AFrameworkApplication.get_activeFrame()&&y.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isSimplifiedReactRibbonUxEnabled()?C.App.get_box4Bridge().get_commandUi().updatePeopleWellControl():(s.pollForControlState(e),C.App.get_box4Bridge().get_commandUi().scaleRibbonHeader())}),c,d,u,r,i,o,a,s,p,l)},t.GetSelectionToMoveIp=function(e){var n=t._workspace.get_activePage().get_contentObjectSpace().getObject(e.get_ip().get_paragraphId());if(isNullOrUndefined(n))return f.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!ie.ParagraphReader.isParagraphNode(n))return f.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;var r=oe.y.createIpContext(n,e.get_ip().get_presenceCp().get_cp());return new ne.Selection([r],!0,null)},t._workspace=null,t}(Z);(0,i.l)(le,"92d609cc$WordEditorPeoplesWell",Z,[]);var ue=n(523),ce=function(){function e(){}return e.prototype.get_name=function(){return"WordEditor.PeoplesWellControl"},e.prototype.configure=function(t){e._container=t},e.prototype.init=function(){y.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(i.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){y.AFrameworkApplication.peoplesWellIsEnabled?e.get_RtcProxyProvider().getInstanceAsync().CW(i.i(this,this.OnRtcProxyReady,"OnRtcProxyReady")):f.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")},e.prototype.OnRtcProxyReady=function(t){e._rtcProxy=e.get_RtcProxyProvider().getInstanceAsync().get_result(),e._rtcProxy?(e._lazyobjectSpace=new _.q(o.f,(function(){var e=C.App.get_activeAppFrame().workspace;return e?e.get_activePage()?e.get_activePage().get_contentObjectSpace():(f.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(f.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)})),C.App.get_theCoauthManagerAsync().CW((function(t){var n=C.App.get_theCoauthManagerAsync().get_result().get_myId(),r=m.CuiHelper.getPeoplesWellDefaultControlSettings(y.AFrameworkApplication.get_imageClusterPath(),e.SingleCollabUserGlyphCss16,y.AFrameworkApplication.get_imageClusterPath(),e.SingleCollabUserGlyphCss32,y.AFrameworkApplication.get_imageClusterPath(),e.MultipleCollabUserGlyphCss16,y.AFrameworkApplication.get_imageClusterPath(),e.GroupChatButtonGlyphCss32),o=v.createInstance(r,n,i.i(e._rtcProxy.get_rtcInstance(),e._rtcProxy.get_rtcInstance().getUserPresence,"getUserPresence"),i.i(e._rtcProxy.get_rtcInstance(),e._rtcProxy.get_rtcInstance().getUserStatusInfo,"getUserStatusInfo"),y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorPresenceDedupeMultipleCoauthorInstances"));S.w.get_instance().register(le).as(a.t).singleInstance().usingFactory((function(){return le.createInstance(o,I.q.taskFromFuture(s.d,e._container.resolveFuture(s.d)),e._container.tryResolve(ue.h),e._container.tryResolve(l.l),e._lazyobjectSpace,e._container.resolveFuture(u.u),e._container.resolve(c.r).get_sharedStandaloneRoot(),e._container.resolve(d.h))})),e._instance=S.w.get_instance().resolve(a.t),e._instance.registerPeoplesWellControl(),f.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")}))):f.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")},e.prototype.dispose=function(){e._instance&&(e._instance.dispose(),e._instance=null)},e.get_RtcProxyProvider=function(){return e._rtcProxyProvider||(e._rtcProxyProvider=S.w.get_instance().resolve(p.q))},e._instance=null,e._container=null,e._lazyobjectSpace=null,e._rtcProxy=null,e.SingleCollabUserGlyphCss16="we_SingleCollabUserGlyph16",e.SingleCollabUserGlyphCss32="we_SingleCollabUserGlyph32",e.MultipleCollabUserGlyphCss16="we_MoreUsersGlyph16",e.GroupChatButtonGlyphCss32="we_CommentComment_24x24x32",e._rtcProxyProvider=null,e}();(0,i.l)(ce,"d83db231$WordEditorPeoplesWellControlPackage",null,[g.u,h.s]),n.d(t,{Program:function(){return de}});var de=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new ce,0,!1)},e}();(0,i.l)(de,"6771fe55$Program",null,[])},8925:function(e,t,n){"use strict";n.r(t),n.d(t,{WordEditorTestFeaturePackage:function(){return m}});var r=n(423),i=n(1775),o=n(363),a=n(8192),s=n(5516),l=n(4551),u=n(2575),c=n(4764),d=n(6301),p=n(5362),g=n(1526),h=n(8530),_=n(5575),f=n(1751),m=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"WordEditor.TestFeature"},e.prototype.init=function(){var e=this;this._container.resolve(i.d).get_graphFeaturesNodeTask().CW((function(t){e.OnAfterGraphFeaturesNodeLoaded()}))},e.prototype.dispose=function(){},e.prototype.OnAfterGraphFeaturesNodeLoaded=function(){if(this._container.resolve(i.d).isFeatureEnabled(139)){u.AFrameworkApplication.get_theActionManager().addActionWithFlags(s.u.wordTestFeature,f.d.view,r.i(this,this.TestFeature,"TestFeature"),96);var e=c.FocusManager.instance().getScope(_.u.editingFocusID);l.AFrame.bindWithDoNothingFallback(e,p.KeyInputManager.hashKey(d.v.vK_F,5|p.KeyInputManager.get_commandKeyModifier()),s.u.wordTestFeature)}},e.prototype.TestFeature=function(e,t,n,r,i){if(2===n){var o=new h.StandardDialog;o.set_buttonsOption(0),o.showInformation(WordEditorIntl.WordEditorStrings.L_WordTestFeature,WordEditorIntl.WordEditorStrings.L_WordTestFeatureDialogText,null)}return 32},e.prototype.configure=function(e){this._container=e},e.main=function(){g.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(m,"e8a90891$WordEditorTestFeaturePackage",null,[o.u,a.s])},8934:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});var r=(0,n(423).e)("a83919f3$IReadOnlyList$1")},8939:function(e,t,n){"use strict";var r=n(4424),i=n(423),o=(0,i.y)("af700279$ISkyDriveUploadCaller"),a=n(2575),s=n(3096),l=n(6378),u=function(){function e(e,t,n,r,i,o,a){this._webServiceBase=null,this._fileName=null,this._fileNewName=null,this._folderId=null,this._querySig=null,this._handlerName=null,this._options=null,this._webServiceBase=e,this._fileName=t,this._fileNewName=n,this._folderId=r,this._querySig=i,this._handlerName=o,this._options=a}return e.prototype.execute=function(t,n){if(!a.AFrameworkApplication.isShuttingDown&&a.AFrameworkApplication.theClientRequestManager){var r={};r[e.contentHeader]=e.contentHeaderValue;var i=this._webServiceBase+this._handlerName;i=s.n.addOrReplaceParameterValue(i,e.handlerFolderParam,l.l.urlKeyValueEncode(this._folderId),!1),i=s.n.addOrReplaceParameterValue(i,e.handlerFilenameParam,l.l.urlKeyValueEncode(this._fileName),!1),i=s.n.addOrReplaceParameterValue(i,e.handlerQuerySigParam,l.l.urlKeyValueEncode(this._querySig),!1),i=s.n.addOrReplaceParameterValue(i,e.handlerTimeParam,l.l.urlKeyValueEncode((new Date).getTime().toString()),!1),this._options&&this._options.FileDownloadUrl&&(i=s.n.addOrReplaceParameterValue(i,e.handlerFileDownloadUrlParam,l.l.urlKeyValueEncode(this._options.FileDownloadUrl),!1)),this._fileNewName&&(i=s.n.addOrReplaceParameterValue(i,e.handlerFileNewNameParam,l.l.urlKeyValueEncode(this._fileNewName),!1)),a.AFrameworkApplication.theClientRequestManager.addRequest(i,1,"",r,!1,2,t,n,null,null,!1,null,null,null,null,!1,null,!1)}},e.contentHeader="Content-Type",e.contentHeaderValue="application/json; charset=utf-8",e.handlerFolderParam="fo",e.handlerFilenameParam="fn",e.handlerFileNewNameParam="fnn",e.handlerQuerySigParam="qs",e.handlerTimeParam="n",e.handlerFileDownloadUrlParam="furl",e}();(0,i.l)(u,"a8ba3fb0$SkyDriveUploadCaller",null,[o]),n.d(t,{p:function(){return c}});var c=function(){function e(e){this._webServiceUrl=null,this._fileName=null,this._handlerName=null,this._appSettingsManager=null,this._appSettingsManager=e,this._webServiceUrl=e.get_appSettings().SkyDriveUploadWebServiceBase,this._fileName=e.get_appSettings().FileName,this._handlerName=e.getStringAppSetting("SkyDriveUploadHandler")||"skydriveuploadhandler.ashx"}return e.prototype.create=function(e,t,n){return new u(this._webServiceUrl,this._fileName,t,e,a.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,this._handlerName,n)},e}();(0,i.l)(c,"c0419364$SkydriveUploadCallerFactory",null,[r.p])},9137:function(e,t,n){"use strict";n.d(t,{u:function(){return r}});var r=(0,n(423).y)("5c2384$IWordPresenceCpFactory")},9149:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("70b1f19e$IFormatPictureManager"),o=(0,r.y)("11c8ca17$IFormatPicturePane"),a=n(4939),s=n(9119),l=n(363),u=n(8192),c=n(3362),d=n(2575),p=n(925),g=n(3772),h=n(4764),_=n(2612),f=n(1526),m=n(9423),y=n(618),v=n(8047),S=n(5516),I=n(6363),C=n(1751),T=function(){function e(e,t,n){this._isTabsEnabled=!1,this._actionManager=null,this._iFormatPictureManager=null,this._actionManager=e,this._iFormatPictureManager=t,this._isTabsEnabled=n}return e.prototype.dispose=function(){this._iFormatPictureManager&&this._iFormatPictureManager.dispose()},e.prototype.RegisterActions=function(){this._actionManager.addAction(S.u.toggleFormatPicturePane,C.d.view,r.i(this,this.ToggleFormatPicturePane,"ToggleFormatPicturePane")),this._actionManager.addAction(S.u.showFormatPicturePane,C.d.view,r.i(this,this.ShowFormatPicturePane,"ShowFormatPicturePane")),this._actionManager.addAction(S.u.hideFormatPicturePane,C.d.view,r.i(this,this.HideFormatPicturePane,"HideFormatPicturePane")),this._actionManager.addAction(S.u.showFormatPicturePaneAltTextSection,C.d.view,r.i(this,this.ShowFormatPicturePane,"ShowFormatPicturePane")),this._actionManager.addAction(S.u.showFormatPicturePaneCropSection,C.d.view,r.i(this,this.ShowFormatPicturePane,"ShowFormatPicturePane")),this._actionManager.addAction(S.u.showFormatPicturePaneRotateSection,C.d.view,r.i(this,this.ShowFormatPicturePane,"ShowFormatPicturePane")),this._isTabsEnabled&&(this._actionManager.addActionWithFlags(S.u.queryFormatPicturePanePictureTab,C.d.view,r.i(this,this.QueryFormatPicturePane,"QueryFormatPicturePane"),96),this._actionManager.addAction(S.u.showFormatPicturePanePictureTab,C.d.view,r.i(this,this.ShowFormatPicturePane,"ShowFormatPicturePane")),this._actionManager.addActionWithFlags(S.u.queryFormatPicturePanePropertiesTab,C.d.view,r.i(this,this.QueryFormatPicturePane,"QueryFormatPicturePane"),96),this._actionManager.addAction(S.u.showFormatPicturePanePropertiesTab,C.d.view,r.i(this,this.ShowFormatPicturePane,"ShowFormatPicturePane")))},e.prototype.QueryFormatPicturePane=function(e,t,n,r,i){if(1===n)return 32;var o=i;switch(e){case S.u.queryFormatPicturePanePictureTab:o[I.e.On]=1===this._iFormatPictureManager.get_currentTab();break;case S.u.queryFormatPicturePanePropertiesTab:o[I.e.On]=2===this._iFormatPictureManager.get_currentTab()}return 32},e.prototype.ShowFormatPicturePane=function(e,t,n,r,i){if(1===n)return 32;if(2===n){var o=this._iFormatPictureManager.getVisibility(),a=1===i;this._iFormatPictureManager.setVisibility(!0,a);var s=0,l=0;switch(e){case S.u.showFormatPicturePanePictureTab:s=1;break;case S.u.showFormatPicturePanePropertiesTab:s=2;break;case S.u.showFormatPicturePaneAltTextSection:s=2,l=1;break;case S.u.showFormatPicturePaneCropSection:s=1,l=2;break;case S.u.showFormatPicturePaneRotateSection:s=1,l=3;break;case S.u.toggleFormatPicturePane:s=this._iFormatPictureManager.get_currentTab(),this._isTabsEnabled&&!s&&(s=1);break;default:s=0,l=0}return o&&e===S.u.showFormatPicturePane||this._iFormatPictureManager.setFormatPictureMode(s,l,a),32}return 8},e.prototype.HideFormatPicturePane=function(e,t,n,r,i){return this.ToggleButton(i,!1),this.CloseFormatPicturePane(e,t,n,r,i)},e.prototype.CloseFormatPicturePane=function(e,t,n,r,i){return 1===n?32:(this._iFormatPictureManager.setVisibility(!1,!1),32)},e.prototype.ToggleFormatPicturePane=function(e,t,n,r,i){return this._iFormatPictureManager.getVisibility()?this.HideFormatPicturePane(e,t,n,r,i):this.ShowFormatPicturePane(e,t,n,r,i)},e.prototype.ToggleButton=function(e,t){e&&(e[I.e.On]=t)},e}();(0,r.l)(T,"6f5d7af$FormatPictureActor",null,[Sys.IDisposable]);var b=function(){function e(e,t){this._taskPane=null,this._isTabsEnabled=!1,this._taskPaneInitialized=!1,this._taskPane=e,this._isTabsEnabled=t}return e.prototype.get_currentTab=function(){return this._taskPane.get_currentFormatPictureTab()},e.prototype.setFormatPictureMode=function(e,t,n){switch(e){case 0:case 1:this._taskPane.showPictureTab(t,n);break;case 2:this._taskPane.showPropertiesTab(t,n)}},e.prototype.getVisibility=function(){return this._taskPane.get_isVisible()},e.prototype.setVisibility=function(e,t){this._taskPaneInitialized||this.InitializeTaskPane(),this._taskPane.rootCommitPendingChange(),e?this._taskPane.showPane(t):this._taskPane.hidePane()},e.prototype.dispose=function(){this._taskPane.dispose()},e.prototype.InitializeTaskPane=function(){this._taskPaneInitialized||(this._taskPane.initialize(),this._taskPaneInitialized=!0)},e}();(0,r.l)(b,"c669417$FormatPictureManager",null,[i,Sys.IDisposable]);var A=n(6720),M=n(6935),P=n(4551),F=n(6301),w=n(5362),R=n(3068),E=n(3117),k=function(){function e(){}return e.taskPaneId=E.u.formatPictureTaskPaneFocusId,e.paneWidth=300,e.panePosition=1,e.paneTitle=WordEditorIntl.WordEditorStrings.L_FormatPicture,e.dataSource="FormatPictureTaskPaneData",e}();(0,r.l)(k,"8b8b82f3$FormatPicturePaneConstants",null,[]);var D=function(){function e(){}return e.groupFormatPictureControlsId="GroupFormatPictureControls",e.groupAllInOneControlsId="GroupAllInOne",e.pictureTabButtonId="btnPicture-Large30",e.propertiesTabButtonId="btnProperties-Large30",e.altTextCollapsibleSectionId="AltTextCollapsibleSection",e.cropCollapsibleSectionId="CropCollapsibleSection",e.rotateCollapsibleSectionId="RotateCollapsibleSection",e.altTextCollapsibleSectionTitleId="AltTextCollapsibleSection-Title",e.cropCollapsibleSectionTitleId="CropCollapsibleSection-Title",e.rotateCollapsibleSectionTitleId="RotateCollapsibleSection-Title",e.altTextTitleTextBoxId="txtBoxAltTextTitle",e.altTextDescriptionTextBoxId="txtBoxAltTextDescription",e.cropTopSpinnerId="spnCropTop",e.cropBottomSpinnerId="spnCropBottom",e.cropLeftSpinnerId="spnCropLeft",e.cropRightSpinnerId="spnCropRight",e.rotateAngleSpinnerId="spnRotateAngle",e}();(0,r.l)(D,"163dd76a$FormatPicturePaneControls",null,[]);var O=function(){function e(e,t,n,r,i,o,a,s){this._taskPane=null,this._taskPaneUtils=null,this._formatPicturePaneTab=0,this._lazyFocusManager=null,this._lazyF6Manager=null,this._clickInputManager=null,this._cancelEvent=null,this._isTabsEnabled=!1,this._isCropEnabled=!1,this._isRotationEnabled=!1,this._focusRegion=null,this.$$pf_IsVisible=!1,this._pictureTabControlIds=new A.c(String),this._propertiesTabControlIds=new A.c(String),this._taskPaneUtils=e,this._lazyFocusManager=t,this._lazyF6Manager=n,this._clickInputManager=r,this._cancelEvent=i,this._isTabsEnabled=o,this._isCropEnabled=a,this._isRotationEnabled=s}return e.prototype.initialize=function(){this.BuildTaskPane(),this.SetupFocus()},e.prototype.get_isVisible=function(){return this.$$pf_IsVisible},e.prototype.set_isVisible=function(e){return this.$$pf_IsVisible=e,e},e.prototype.showPane=function(e){e?this._taskPaneUtils.showTaskPane(this._taskPane):this._taskPaneUtils.showTaskPaneWithoutFocus(this._taskPane),this._taskPane.registerOnTaskPaneHidden(r.i(this,this.OnTaskPaneHidden,"OnTaskPaneHidden")),this.set_isVisible(!0)},e.prototype.hidePane=function(){this.SetFocusScopeForHide(),this.set_isVisible(!1),this._taskPaneUtils.hideTaskPane(this._taskPane)},e.prototype.showPictureTab=function(e,t){this._formatPicturePaneTab=1,this._isTabsEnabled&&(this.ShowPictureControls(),this.HidePropertiesControls()),this.SetFocusOnSection(e,t)},e.prototype.showPropertiesTab=function(e,t){this._formatPicturePaneTab=2,this._isTabsEnabled&&(this.HidePictureControls(),this.ShowPropertiesControls()),this.SetFocusOnSection(e,t)},e.prototype.get_currentFormatPictureTab=function(){return this._formatPicturePaneTab},e.prototype.rootCommitPendingChange=function(){this._taskPane.commitAnyPendingChange()},e.prototype.dispose=function(){this._taskPane&&(this.get_FocusManager().getScope(k.taskPaneId).unBindAction(w.KeyInputManager.hashKey(F.v.vK_Esc,0)),this._taskPane.unsetFocusRegion(),this._taskPaneUtils.disposeTaskPane(k.taskPaneId,this._taskPane),this._taskPane=null)},e.prototype.BuildTaskPane=function(){var e=[WoncaIntl.WoncaStrings],t=new M.CuiHelper(R.f.box4ImageBase,WordEditorIntl.WordEditorStrings,null,null,e);this._taskPane=this._taskPaneUtils.createTaskPaneFromResource(k.taskPaneId,k.panePosition,k.paneWidth,k.dataSource,t),this._formatPicturePaneTab=0,this._isTabsEnabled||this.SetControlVisibility(D.groupFormatPictureControlsId,!1),this._propertiesTabControlIds.add(D.altTextCollapsibleSectionId),this._pictureTabControlIds.add(D.cropCollapsibleSectionId),this._pictureTabControlIds.add(D.rotateCollapsibleSectionId),this._isCropEnabled||(this.SetControlVisibility(D.cropCollapsibleSectionId,!1),this._pictureTabControlIds.remove(D.cropCollapsibleSectionId)),this._isRotationEnabled||(this.SetControlVisibility(D.rotateCollapsibleSectionId,!1),this._pictureTabControlIds.remove(D.rotateCollapsibleSectionId))},e.prototype.ShowPictureControls=function(){for(var e=this._pictureTabControlIds.$$lge();e.$$mn();){var t=e.$$cu();this.SetControlVisibility(t,!0)}},e.prototype.HidePictureControls=function(){for(var e=this._pictureTabControlIds.$$lge();e.$$mn();){var t=e.$$cu();this.SetControlVisibility(t,!1)}},e.prototype.ShowPropertiesControls=function(){for(var e=this._propertiesTabControlIds.$$lge();e.$$mn();){var t=e.$$cu();this.SetControlVisibility(t,!0)}},e.prototype.HidePropertiesControls=function(){for(var e=this._propertiesTabControlIds.$$lge();e.$$mn();){var t=e.$$cu();this.SetControlVisibility(t,!1)}},e.prototype.RefreshTaskPane=function(){this._taskPane.refresh()},e.prototype.SetControlVisibility=function(e,t){var n=this.GetTaskpaneDomElement(e);n&&(n.style.display=t?"block":"none")},e.prototype.GetTaskpaneDomElement=function(e){return $get(e,this._taskPane.get_element())},e.prototype.OnTaskPaneHidden=function(e){e===this._taskPane&&this.hidePane()},e.prototype.get_taskPane=function(){return this._taskPane},e.prototype.get_FocusManager=function(){return this._lazyFocusManager.get_value()},e.prototype.get_F6Manager=function(){return this._lazyF6Manager.get_value()},e.prototype.IsTaskPaneInFocus=function(){return!!this.get_FocusManager().get_currentScope()&&this.get_FocusManager().get_currentScope().name===k.taskPaneId},e.prototype.OnSetFocus=function(e,t){this.get_F6Manager().activateFocus(k.taskPaneId),this.get_FocusManager().setScope(k.taskPaneId),this.SetDefaultFocus()},e.prototype.SetupFocus=function(){var e=this.get_FocusManager().getScope(k.taskPaneId);e.parent=P.AFrame.mainAppFocusId,this._clickInputManager.addFocusEvent(k.taskPaneId,this._taskPane.get_element(),!1),e.addSetFocus(r.i(this,this.OnSetFocus,"OnSetFocus")),this.get_F6Manager().addF6KeyBindings(k.taskPaneId),e.unBindAction(w.KeyInputManager.hashKey(F.v.vK_Esc,0)),e.bindAction(w.KeyInputManager.hashKey(F.v.vK_Esc,0),S.u.hideFormatPicturePane)},e.prototype.SetFocusScopeForHide=function(){this.IsTaskPaneInFocus()&&this.get_FocusManager().setScope(this.get_FocusManager().get_defaultScopeName()),this.get_F6Manager().deactivateFocus(k.taskPaneId)},e.prototype.SetDefaultFocus=function(){this._focusRegion=this.get_FocusManager().getRegion(k.taskPaneId);var e=this.GetTaskpaneDomElement(document.activeElement.id),t=this._focusRegion.listing.get_currentElement();if(t&&(e=t),e){var n=this.GetSectionId(e.id);this.SetCollapsibleSection(n,!1),this.SetFocusOnId(e.id)}else{var r=this._focusRegion.listing.get_firstElement();this._focusRegion.listing.trySetCurrentElement(r),e=this._focusRegion.listing.get_nextElement(),this._focusRegion.listing.trySetCurrentElement(e),e.focus()}},e.prototype.SetFocusOnId=function(e){var t=this.GetTaskpaneDomElement(e);this._focusRegion=this.get_FocusManager().getRegion(k.taskPaneId),this._focusRegion.listing.trySetCurrentElement(t),t.focus()},e.prototype.SetFocusOnSection=function(e,t){var n="";switch(e){case 1:this.SetCollapsibleSection(D.altTextCollapsibleSectionId,!1),n=D.altTextTitleTextBoxId;break;case 2:this.SetCollapsibleSection(D.cropCollapsibleSectionId,!1),n=D.cropTopSpinnerId;break;case 3:this.SetCollapsibleSection(D.rotateCollapsibleSectionId,!1),n=D.rotateAngleSpinnerId;break;case 0:default:this._isTabsEnabled?1===this._formatPicturePaneTab?n=D.pictureTabButtonId:2===this._formatPicturePaneTab&&(n=D.propertiesTabButtonId):n=D.altTextCollapsibleSectionTitleId}t&&this.SetFocusOnId(n)},e.prototype.SetCollapsibleSection=function(e,t){var n=e+"-Body",r=e+"-Title",i=this.GetTaskpaneDomElement(n);if(i){var o="none"===i.style.display;(t&&!o||!t&&o)&&(i=this.GetTaskpaneDomElement(r)).click()}},e.prototype.GetSectionId=function(e){var t;switch(e){case D.altTextTitleTextBoxId:case D.altTextDescriptionTextBoxId:t=D.altTextCollapsibleSectionId;break;case D.cropTopSpinnerId:case D.cropBottomSpinnerId:case D.cropLeftSpinnerId:case D.cropRightSpinnerId:t=D.cropCollapsibleSectionId;break;case D.rotateAngleSpinnerId:t=D.rotateAngleSpinnerId;break;default:t=D.altTextCollapsibleSectionTitleId}return t},e}();(0,r.l)(O,"d94b0afe$FormatPicturePane",null,[o,Sys.IDisposable]);var U=n(5541),x=n(5214),L=n(8400),N=n(7106),B=n(2355),H=n(406),$=n(287),G=n(5815),W=function(){return function(){this.type="FormatPictureTaskPaneProps",this.section=0,this.numberFormatInfo=null,this.title=null,this.description=null,this.topCrop=0,this.bottomCrop=0,this.leftCrop=0,this.rightCrop=0,this.rotationAngle=0,this.onTitleChange=null,this.onDescriptionChange=null,this.onCropSpinButtonChange=null,this.onRotationSpinButtonChange=null,this.disabled=!1}}();(0,r.l)(W,"89035bd$FormatPictureTaskPaneProps",null,[]);var V=function(){function e(e,t,n,r,i){this._taskPaneUtils=null,this._lazyFocusManager=null,this._lazyF6Manager=null,this._lazyActionManager=null,this._clickInputManager=null,this._formatPicturePaneTab=0,this._section=0,this._titleText=null,this._descriptionText=null,this._topCrop=0,this._bottomCrop=0,this._leftCrop=0,this._rightCrop=0,this._rotationAngle=0,this._disabled=!1,this.$$pf_IsVisible=!1,this._taskPaneUtils=e,this._lazyFocusManager=t,this._lazyF6Manager=n,this._lazyActionManager=r,this._clickInputManager=i}return e.prototype.initialize=function(){this.BuildTaskPane(),this.SetupFocus()},e.prototype.get_isVisible=function(){return this.$$pf_IsVisible},e.prototype.set_isVisible=function(e){return this.$$pf_IsVisible=e,e},e.prototype.showPane=function(e){this.ShowReactPane(e)},e.prototype.hidePane=function(){this.SetFocusScopeForHide(),this.HideReactPane()},e.prototype.showPictureTab=function(e,t){this.SetTabInternal(e,1)},e.prototype.showPropertiesTab=function(e,t){this.SetTabInternal(e,2)},e.prototype.SetTabInternal=function(e,t){this._formatPicturePaneTab=t,this._section=e},e.prototype.get_currentFormatPictureTab=function(){return this._formatPicturePaneTab},e.prototype.rootCommitPendingChange=function(){},e.prototype.dispose=function(){},e.prototype.BuildTaskPane=function(){this._taskPaneUtils.createReactTaskPaneContainer(),this._formatPicturePaneTab=0,this._section=0},e.prototype.get_FocusManager=function(){return this._lazyFocusManager.get_value()},e.prototype.get_F6Manager=function(){return this._lazyF6Manager.get_value()},e.prototype.get_ActionManager=function(){return this._lazyActionManager.get_value()},e.prototype.IsTaskPaneInFocus=function(){return!!this.get_FocusManager().get_currentScope()&&this.get_FocusManager().get_currentScope().name===k.taskPaneId},e.prototype.OnSetFocus=function(e,t){this.SetFocusInternal()},e.prototype.SetFocusInternal=function(){this.get_F6Manager().activateFocus(k.taskPaneId),this.get_FocusManager().setScope(k.taskPaneId)},e.prototype.SetupFocus=function(){var e=this.get_FocusManager().getScope(k.taskPaneId);e.parent=P.AFrame.mainAppFocusId,e.addSetFocus(r.i(this,this.OnSetFocus,"OnSetFocus")),this.get_F6Manager().addF6KeyBindings(k.taskPaneId)},e.prototype.SetFocusScopeForHide=function(){this.IsTaskPaneInFocus()&&this.get_FocusManager().setScope(this.get_FocusManager().get_defaultScopeName()),this.get_F6Manager().deactivateFocus(k.taskPaneId)},e.prototype.ShowReactPane=function(e){var t=this;$.UISurfaces.getTaskPaneAPIAsync().then((function(n){return n.showTaskPane(k.taskPaneId,t.CreateTaskPaneData(e)),t.get_isVisible()&&e&&t.get_FocusManager().setScope(k.taskPaneId),null}))},e.prototype.UpdateReactPane=function(){var e=this;$.UISurfaces.getTaskPaneAPIAsync().then((function(t){return t.updateTaskPane(k.taskPaneId,e.CreateTaskPaneData(!1)),null}))},e.prototype.HideReactPane=function(){$.UISurfaces.getTaskPaneAPIAsync().then((function(e){return e.hideTaskPane(k.taskPaneId,2),null}))},e.prototype.CreateTaskPaneData=function(e){var t=this,n=new W;return this.SetupProps(n),(0,x.m)(new H.q,{title:k.paneTitle,hideHeader:!1,width:320,location:2,contentProps:n,onOpen:function(e){t.set_isVisible(!0),m.App.get_activeAppFrame().add_onCommandUiUpdate(r.i(t,t.PollForStateAndUpdate,"PollForStateAndUpdate")),m.App.get_activeAppFrame().updateCommandUI(!1),t.SetFocusInternal(),t._clickInputManager.addFocusEvent(k.taskPaneId,e,!1)},onClose:function(e){t.SetFocusScopeForHide(),t.set_isVisible(!1),m.App.get_activeAppFrame().remove_onCommandUiUpdate(r.i(t,t.PollForStateAndUpdate,"PollForStateAndUpdate")),m.App.get_activeAppFrame().updateCommandUI(!1)}})},e.prototype.SetupProps=function(e){var t=(0,U.e)(Object,B.AppChromeUtils.getRenderAppChromeSettings().numberFormatInfo);e.section=this._section,e.numberFormatInfo=t,e.title=this._titleText,e.description=this._descriptionText,e.topCrop=this._topCrop,e.bottomCrop=this._bottomCrop,e.leftCrop=this._leftCrop,e.rightCrop=this._rightCrop,e.rotationAngle=this._rotationAngle,e.onTitleChange=this.OnTitleChange(),e.onDescriptionChange=this.OnDescriptionChange(),e.onCropSpinButtonChange=this.OnCropSpinButtonChange(),e.onRotationSpinButtonChange=this.OnRotationSpinButtonChange(),e.disabled=this._disabled},e.prototype.OnTitleChange=function(){var e=this;return function(t){if(t!==e._titleText){e._titleText=t;var n=new G.DictionaryPropertySet;n.setValue(L.Properties.imageAltTextTitle,t),e.get_ActionManager().processActionWithData(N.u.setImageAltTextTitle,2,n,null),e.UpdateReactPane()}}},e.prototype.OnDescriptionChange=function(){var e=this;return function(t){if(t!==e._descriptionText){var n=new G.DictionaryPropertySet;n.setValue(L.Properties.imageAltTextDescription,t),e._descriptionText=t,e.get_ActionManager().processActionWithData(N.u.setImageAltTextDescription,2,n,null),e.UpdateReactPane()}}},e.prototype.OnCropSpinButtonChange=function(){var e=this;return function(t,n){var r=new G.DictionaryPropertySet;switch(n){case 0:e._topCrop=t,r.setValue(L.Properties.imageCropActionTop,t),e.get_ActionManager().processActionWithData(S.u.imageCropTopFromSpinners,2,r,null);break;case 1:e._bottomCrop=t,r.setValue(L.Properties.imageCropActionBottom,t),e.get_ActionManager().processActionWithData(S.u.imageCropBottomFromSpinners,2,r,null);break;case 2:e._leftCrop=t,r.setValue(L.Properties.imageCropActionLeft,t),e.get_ActionManager().processActionWithData(S.u.imageCropLeftFromSpinners,2,r,null);break;case 3:e._rightCrop=t,r.setValue(L.Properties.imageCropActionRight,t),e.get_ActionManager().processActionWithData(S.u.imageCropRightFromSpinners,2,r,null)}e.PollForStateAndUpdate()}},e.prototype.OnRotationSpinButtonChange=function(){var e=this;return function(t){e._rotationAngle=t;var n=new G.DictionaryPropertySet;n.setValue(L.Properties.imageRotateActionType,0),n.setValue(L.Properties.imageRotateAngle,t),e.get_ActionManager().processActionWithData(N.u.imageRotate,2,n,null)}},e.prototype.PollForStateAndUpdate=function(){var e=!1;e=this.QueryIsEnabled()||e,e=this.QueryImageAltTextTitle()||e,e=this.QueryImageAltTextDescription()||e,e=this.QueryImageCropDimensions()||e,(e=this.QueryImageRotationAngle()||e)&&this.UpdateReactPane()},e.prototype.QueryIsEnabled=function(){var e=2===this.get_ActionManager().processActionWithData(N.u.editAltText,1,null,null),t=e!==this._disabled;return this._disabled=e,t},e.prototype.QueryImageAltTextTitle=function(){var e=new G.DictionaryPropertySet;this.get_ActionManager().processActionWithData(N.u.queryImageAltTextTitle,2,e,null);var t=e.getValueWithDefault(String,L.Properties.imageAltTextTitle,""),n=t!==this._titleText;return this._titleText=t,n},e.prototype.QueryImageAltTextDescription=function(){var e=new G.DictionaryPropertySet;this.get_ActionManager().processActionWithData(N.u.queryImageAltTextDescription,2,e,null);var t=e.getValueWithDefault(String,L.Properties.imageAltTextDescription,""),n=t!==this._descriptionText;return this._descriptionText=t,n},e.prototype.QueryImageCropDimensions=function(){var e=new G.DictionaryPropertySet;this.get_ActionManager().processActionWithData(S.u.queryImageCropTop,2,e,null);var t=e.getValueWithDefault(Number,L.Properties.imageCropActionTop,0),n=e.getValueWithDefault(Number,L.Properties.imageCropActionBottom,0),r=e.getValueWithDefault(Number,L.Properties.imageCropActionLeft,0),i=e.getValueWithDefault(Number,L.Properties.imageCropActionRight,0),o=t!==this._topCrop||n!==this._bottomCrop||r!==this._leftCrop||i!==this._rightCrop;return this._topCrop=t,this._bottomCrop=n,this._leftCrop=r,this._rightCrop=i,o},e.prototype.QueryImageRotationAngle=function(){var e=new G.DictionaryPropertySet;this.get_ActionManager().processActionWithData(N.u.queryImageAngle,2,e,null);var t=e.getValueWithDefault(Number,L.Properties.imageRotateAngle,0),n=t!==this._rotationAngle;return this._rotationAngle=t,n},e}();(0,r.l)(V,"a4bc6b9f$ReactFormatPicturePane",null,[o,Sys.IDisposable]),n.d(t,{WordEditorFormatPicturePackage:function(){return j}});var j=function(){function e(){this._container=null,this._formatPictureActor=null}return e.prototype.get_name=function(){return"WordEditor.FormatPicture"},e.prototype.configure=function(e){var t=this;this._container=e,this._container.register(i).singleInstance().usingFactory((function(){return new b(t._container.resolve(o),v.App.get_wordEditorFormatPicturePaneTabsIsEnabled())})),d.AFrameworkApplication.get_activeFrame()&&d.AFrameworkApplication.get_activeFrame().get_applicationInstance()&&d.AFrameworkApplication.get_activeFrame().get_applicationInstance().get_isReactFormatPictureTaskPaneEnabled()?this._container.register(o).singleInstance().usingFactory((function(){return new V(y.a.get_instance(),new c.q(a.k,(function(){return h.FocusManager.instance()})),new c.q(s.k,(function(){return d.AFrameworkApplication.get_activeFrame().get_theF6Manager()})),new c.q(p.ActionManager,(function(){return d.AFrameworkApplication.get_theActionManager()})),g.s.get_instance())})):this._container.register(o).singleInstance().usingFactory((function(){return new O(y.a.get_instance(),new c.q(a.k,(function(){return h.FocusManager.instance()})),new c.q(s.k,(function(){return d.AFrameworkApplication.get_activeFrame().get_theF6Manager()})),g.s.get_instance(),_.n.cancelEvent,v.App.get_wordEditorFormatPicturePaneTabsIsEnabled(),v.App.get_wordEditorImageCropIsEnabled(),v.App.get_wordEditorImageRotateIsEnabled())})),this._container.register(T).singleInstance().usingFactory((function(){return new T(d.AFrameworkApplication.get_theActionManager(),t._container.resolve(i),v.App.get_wordEditorFormatPicturePaneTabsIsEnabled())}))},e.prototype.init=function(){(v.App.get_wordEditorImageCropIsEnabled()||v.App.get_wordEditorImageRotateIsEnabled())&&(this._formatPictureActor=this._container.resolve(T),this._formatPictureActor.RegisterActions(),m.App.get_activeAppFrame().updateCommandUI(!1))},e.prototype.dispose=function(){this._formatPictureActor&&this._formatPictureActor.dispose()},e.main=function(){f.o.get_instance().registerPackage(new e,0,!1)},e}();(0,r.l)(j,"68959691$WordEditorFormatPicturePackage",null,[l.u,u.s])},9168:function(e,t,n){"use strict";n.d(t,{o:function(){return d}});var r=n(6068),i=n(1822),o=n(8540),a=n(4192),s=n(3752),l=n(9755),u=n(9495),c=n(423),d=function(){function e(e,t,n,r,i,o,a,s){this._mergeState=null,this._baseObjects=null,this._favoredObjects=null,this._unfavoredObjects=null,this._mergeStateForMergeWithoutHints=null,this._favoredObjectsForMergeWithoutHints=null,this._unfavoredObjectsForMergeWithoutHints=null,this._featureEnableLookup=null,this._mergeState=e,this._baseObjects=t,this._favoredObjects=n,this._unfavoredObjects=r,this._mergeStateForMergeWithoutHints=i,this._favoredObjectsForMergeWithoutHints=o,this._unfavoredObjectsForMergeWithoutHints=a,this._featureEnableLookup=s||this.CreateDefaultFeatureEnableLookup()}return e.prototype.CreateDefaultFeatureEnableLookup=function(){var e=this;return function(t){return!!e._mergeState.runtime.FeatureHelper&&e._mergeState.runtime.FeatureHelper.isFeatureEnabled(t)}},e.prototype.DoesGraphContainUpdateHintsContainerNodes=function(){return!!this._mergeState.runtime.BaseObjects.get_item(s.c.updateHintsContainerNodeObjectId)},e.prototype.UseUpdateHintsForMerge=function(){var e;if(1===this._mergeState.input.Source||2===this._mergeState.input.Source)e=90;else if(4===this._mergeState.input.Source||3===this._mergeState.input.Source)e=42;else{if(5!==this._mergeState.input.Source)return!1;e=134}return this.DoesGraphContainUpdateHintsContainerNodes()&&this._featureEnableLookup(e)},e.prototype.StringFormat=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return String.format.apply(null,[e].concat(t))},e.prototype.GetParagraphMerger=function(e,t){var r=this._mergeState,i=this._favoredObjects,o=this._unfavoredObjects;e||(r=this._mergeStateForMergeWithoutHints||this._mergeState,i=this._favoredObjectsForMergeWithoutHints||i,o=this._unfavoredObjectsForMergeWithoutHints||o);var a=u.ParagraphMergeUtils.GetMergeableObjectIdList(this._baseObjects),s=u.ParagraphMergeUtils.GetMergeableObjectIdList(i),c=u.ParagraphMergeUtils.GetMergeableObjectIdList(o);return t.val=this.StringFormat("[MergeSource: {0}] [BaseRevisionId: {1}] [FavoredRevisionId: {2}] [UnfavoredRevisionId: {3}] [BaseObjects: {4}] [FavoredObjects: {5}] [UnfavoredObjects: {6}]",r.input.Source,r.runtime.CommonBaseLastChange.get_id(),r.runtime.FavoredRevisionId,r.runtime.UnfavoredRevisionId,a.logString(" "),s.logString(" "),c.logString(" ")),e?new l.i(r,this._baseObjects,i,o,this.CreateDefaultFeatureEnableLookup(),null,null):new(n(26).ParagraphMerge)(r,this._baseObjects,i,o,this.CreateDefaultFeatureEnableLookup(),null)},e.prototype.tryDoMerge=function(e){var t,n=this.UseUpdateHintsForMerge(),r=this.GetParagraphMerger(n,(0,i.m)((function(){return t}),(function(e){return t=e})));o.p.get_instance().traceTag(18994389,1,3,"ParagraphMergeSelector TryDoMerge: [UseHints: {0}] {1}",n,t);var l=r.tryDoMerge(e),c=n&&!l&&r.get_retryMergeWithoutHints(),d=!!this._mergeState.runtime.BaseObjects.get_item(s.c.updateHintsContainerNodeObjectId)&&(n&&!l||!n);if(c&&(l=(r=this.GetParagraphMerger(!1,(0,i.m)((function(){return t}),(function(e){return t=e})))).tryDoMerge(e),o.p.get_instance().traceTag(18994390,1,l?3:2,"ParagraphMergeSelector TryDoMerge Fallback: [Success: {0}] {1}",l,t)),d){var p=new a.s;u.ParagraphMergeUtils.ResetUpdateHintContainerDueToFailedMerge(this._mergeState,p)}return l},e.prototype.updateCpAccordingToIncomingChange=function(e,t,n,r){var a,s=this.UseUpdateHintsForMerge()&&this._featureEnableLookup(135),l=this.GetParagraphMerger(s,(0,i.m)((function(){return a}),(function(e){return a=e}))),u=l.updateCpAccordingToIncomingChange(e,t,n,r);return o.p.get_instance().traceTag(18994391,1,3,"ParagraphMergeSelector UpdateCpAccordingToIncomingChange: [UseHints: {0}] {1}",s,a),s&&!u&&l.get_retryMergeWithoutHints()&&(u=(l=this.GetParagraphMerger(!1,(0,i.m)((function(){return a}),(function(e){return a=e})))).updateCpAccordingToIncomingChange(e,t,n,r),o.p.get_instance().traceTag(18994392,1,u?3:2,"ParagraphMergeSelector UpdateCpAccordingToIncomingChange Fallback: [Success: {0}] {1}",u,a)),u},e}();(0,c.l)(d,"cd3ec1c7$ParagraphMergeSelector",null,[r.v])},9200:function(e,t,n){"use strict";n.r(t);var r=n(1526),i=n(423),o=n(1775),a=n(5019),s=(0,i.y)("7e80c288$ICurrentPageManager"),l=n(1782),u=(0,i.y)("528f56ec$IPageEndMarkers"),c=(0,i.y)("125e1ce5$IPageAdornmentManager"),d=(0,i.y)("15657312$IOutlineManager"),p=(0,i.y)("8c16b1a1$IPageManager"),g=n(2638),h=n(5112),_=n(773),f=(0,i.y)("df92e25$IPageEndMarkerPositionUpdater"),m=(0,i.y)("9d52a4f3$IPageEndMarkerPositionComparer"),y=n(6455),v=n(5534),S=n(1227),I=n(5662),C=(0,i.y)("d7af2b13$IPageAdornmentAnimationManager"),T=(0,i.y)("664fd9cc$IPageAdornmentContentManager"),b=n(363),A=n(8192),M=n(3362),P=n(2575),F=n(8468),w=n(3772),R=n(2753),E=n(8631),k=n(213),D=n(6382),O=n(1408),U=n(9423),x=n(6709),L=n(7801),N=n(6654),B=n(1185),H=n(3380),$=n(5419),G=n(8506),W=n(8047),V=n(1613),j=(0,i.y)("1f6c0abf$IPageElementManager"),q=n(2464),z=n(2879),K=n(5989),Q=n(4072),Z=n(5934),J=n(9802),X=n(5321),Y=function(){function e(e,t,n,r,i,o,a,s){this._actionManager=null,this._selectionManager=null,this._pendingTask=null,this._taskManager=null,this._documentSizeManager=null,this._lazyPageView=null,this._characterPointConverter=null,this._currentPage=1,this._pages=null,this._statusBarUser=null,this._isCurrentPageBrsEnabled=!1,this._eventSource=new Q.f,this._lastKnownIpPosition=-1,this._actionManager=e,this._selectionManager=t,this._taskManager=n,this._documentSizeManager=r,this._lazyPageView=i,this._characterPointConverter=o,this._statusBarUser=a,this._isCurrentPageBrsEnabled=s,this.enable()}return e.prototype.get_currentPage=function(){return this._currentPage},e.prototype.set_currentPage=function(t){return this._currentPage!==t&&(this._currentPage=t,this._eventSource.raiseEvent(e.OnCurrentPageUpdatedKey,null,null),this.get_isPageMarkersRenderDone()&&this.updatePageNumber()),t},e.prototype.get_isPageMarkersRenderDone=function(){var e=D.w.get_instance().tryResolve(u);return!e||e.get_isPageMarkersRenderDone()},e.prototype.get_pageView=function(){return this._lazyPageView.get_value()},e.prototype.get_cpuMeter=function(){return q.r.get_instance()},e.prototype.add_currentPageUpdated=function(t){this._eventSource.addHandler(e.OnCurrentPageUpdatedKey,t)},e.prototype.remove_currentPageUpdated=function(t){this._eventSource.removeHandler(e.OnCurrentPageUpdatedKey,t)},e.prototype.updatePageNumber=function(){var e=this;this.get_cpuMeter().profileFunction((function(){e._statusBarUser.pollControl(e._isCurrentPageBrsEnabled?X.t.pageCountButtonId:X.t.pageCountLabelId)}),"CurrentPageCalculator:PollStatusBarToUpdatePageNumbers")},e.prototype.enable=function(){this._selectionManager.add_processSetSelectionFinished(i.i(this,this.OnProcessSetSelectionFinished,"OnProcessSetSelectionFinished")),this.calculateCurrentPage()},e.prototype.OnProcessSetSelectionFinished=function(e,t){this.calculateCurrentPage()},e.prototype.calculateCurrentPage=function(){var t=this;if(!this._pages||this._pages.get_count()<=1)this.set_currentPage(1);else{var n=this._selectionManager.get_selectionCollection().get_currentSelection();if(n){var r=n.isForward?n.get_lastContext():n.get_firstContext();if(r&&!(r.get_cpBegin()<0)){var i=r.get_node();i&&Z.ParagraphReader.isParagraphNode(i)&&this.isInMainDocument(i)&&(this._pendingTask&&(this._taskManager.deleteTask(this._pendingTask),this._pendingTask=null),this._pendingTask=new z.c(2,1,e.Delay,(function(e){t.FindCurrentPageFromIp(e,r)}),62,null,!1),this._taskManager.addTask(this._pendingTask))}}}},e.prototype.isInMainDocument=function(e){var t=J.g.createFromNode(e);return!(t.tryToRootAtAncestorOfType(35)||t.tryToRootAtAncestorOfType(37)||t.tryToRootAtAncestorOfType(39))},e.prototype.updatePageElements=function(e){this._pages=e,this.UpdateCurrentPage(this._lastKnownIpPosition)},e.prototype.UpdateCurrentPage=function(e){if(-1!==this._lastKnownIpPosition){var t=this.FindCurrentPageFromPosition(this._lastKnownIpPosition);-1!==t&&this.set_currentPage(t)}},e.prototype.FindCurrentPageFromIp=function(e,t){this._pendingTask===e&&(this._pendingTask=null,this._lastKnownIpPosition=this.GetAbsoluteCpTopPosition(t),-1!==this._lastKnownIpPosition&&this.UpdateCurrentPage(this._lastKnownIpPosition))},e.prototype.FindCurrentPageFromPosition=function(e){if(!this._pages)return-1;for(var t=0;t<this._pages.get_count();t++){var n=this._pages.get_item(t);if(e>n.get_absoluteTop()&&e<n.get_absoluteTop()+n.get_height())return n.get_pageNumber()}return-1},e.prototype.GetAbsoluteCpTopPosition=function(e){var t=this.GetParagraphViewElementFromGraphNodeContext(e);if(!t||!t.get_htmlElement())return-1;var n=t.getBounds(),r=this.GetCpBoundsFromGraphNodeContext(e,t);if(!r)return-1;var i=K.g.getRelativeLocation(this._documentSizeManager.get_pageContentContainer(),t.get_htmlElement()).y;return r.y+Math.floor(r.height/2)-n.y+i},e.prototype.GetParagraphViewElementFromGraphNodeContext=function(e){return e.get_node().getHtmlViewElement(this.get_pageView().get_viewId())},e.prototype.GetCpBoundsFromGraphNodeContext=function(e,t){var n=this._characterPointConverter?this._characterPointConverter.convertGncToBrowserCp(e,!0):e.get_cpBegin();return H.n.boundsFromCp(t,n,!1,!1,!1,null)},e.prototype.disable=function(){this._selectionManager.remove_processSetSelectionFinished(i.i(this,this.OnProcessSetSelectionFinished,"OnProcessSetSelectionFinished"))},e.OnCurrentPageUpdatedKey="X",e.Delay=400,e}();(0,i.l)(Y,"3e5b2e4e$CurrentPageCalculator",null,[l.y,j]);var ee=function(){function e(t,n){this._isCurrentPageModeEnabled=!0,e._currentPageCalculator=t,this._isCurrentPageModeEnabled=n}return e.prototype.get_CurrentPageCalculator=function(){return e._currentPageCalculator},e.prototype.get_isCurrentPageModeEnabled=function(){return this._isCurrentPageModeEnabled},e.prototype.set_isCurrentPageModeEnabled=function(e){return this._isCurrentPageModeEnabled=e,e},e.prototype.get_currentPage=function(){return this.get_CurrentPageCalculator().get_currentPage()},e.prototype.enableCurrentPageMode=function(){this.set_isCurrentPageModeEnabled(!0),this.get_CurrentPageCalculator().enable()},e.prototype.disableCurrentPageMode=function(){this.set_isCurrentPageModeEnabled(!1),this.get_CurrentPageCalculator().disable()},e._currentPageCalculator=null,e}();(0,i.l)(ee,"90c03b81$CurrentPageManager",null,[s]);var te=n(6720),ne=n(7597),re=n(9154),ie=n(3545),oe=function(e){function t(t,n){var r=e.call(this)||this;return r.documentBottom=0,r.newContentRendered=!1,r.documentBottom=t,r.newContentRendered=n,r}return(0,ie.t)(t,e),t}(Sys.EventArgs);(0,i.l)(oe,"c8643be5$DocumentBottomChangeEventArgs",Sys.EventArgs,[]);var ae=function(e){function t(t,n,r){var i=e.call(this)||this;return i.delta=0,i.pageContentSize=0,i.newContentRendered=!1,i.delta=t,i.pageContentSize=n,i.newContentRendered=r,i}return(0,ie.t)(t,e),t}(Sys.EventArgs);(0,i.l)(ae,"96ca65a$PageContentSizeChangeEventArgs",Sys.EventArgs,[]);var se=function(){function e(e,t){this._pageContentContainerDomElement=null,this._lazyPageView=null,this._outlineManager=null,this._outlineGroupsExpectedRendered=null,this._newContentWasRendered=!1,this._previousPageContentSize=-1,this._previousDocumentBottom=-1,this._eventSource=new Q.f,this._lazyPageView=e,this._outlineManager=t,this._outlineGroupsExpectedRendered=new te.c(Object),this.get_PageView().add_onAfterValidateEvent(i.i(this,this.PageViewOnAfterValidate,"PageViewOnAfterValidate")),this.HookupOutlineGroupPropertyChangedEvent()}return e.prototype.get_PageView=function(){return this._lazyPageView.get_value()},e.prototype.get_pageContentContainer=function(){if(!this._pageContentContainerDomElement){var e=this.get_PageView().get_targetNode().getHtmlViewElement(this.get_PageView().get_viewId());this._pageContentContainerDomElement=e.get_pageContentContainer(),ne.ULS.shipAssertTag(34136386,336,!!this._pageContentContainerDomElement,null)}return this._pageContentContainerDomElement},e.prototype.add_onPageContentSizeChange=function(t){this._eventSource.addHandler(e.OnPageContentSizeChangeKey,t)},e.prototype.remove_onPageContentSizeChange=function(t){this._eventSource.removeHandler(e.OnPageContentSizeChangeKey,t)},e.prototype.add_onDocumentBottomChange=function(t){this._eventSource.addHandler(e.OnDocumentBottomChangeKey,t)},e.prototype.remove_onDocumentBottomChange=function(t){this._eventSource.removeHandler(e.OnDocumentBottomChangeKey,t)},e.prototype.getAbsoluteBottomOfDocument=function(){return this.get_pageContentContainer().clientHeight},e.prototype.PageViewOnAfterValidate=function(){this._newContentWasRendered=this.CheckForNewlyRenderedOutlineGroups(),this.CheckForDocumentSizeChanges()},e.prototype.CheckForDocumentSizeChanges=function(){this.CheckForDocumentBottomChange(),this.CheckForPageContentSizeChange()},e.prototype.CheckForDocumentBottomChange=function(){var t=this.getAbsoluteBottomOfDocument();t!==this._previousDocumentBottom&&(this._eventSource.raiseEvent(e.OnDocumentBottomChangeKey,new oe(t,this._newContentWasRendered),null),this._previousDocumentBottom=t)},e.prototype.CheckForPageContentSizeChange=function(){var t=this.get_pageContentContainer().clientHeight;if(t!==this._previousPageContentSize){if(-1!==this._previousPageContentSize){var n=t-this._previousPageContentSize;this._eventSource.raiseEvent(e.OnPageContentSizeChangeKey,new ae(n,t,this._newContentWasRendered),null)}this._previousPageContentSize=t}},e.prototype.CheckForNewlyRenderedOutlineGroups=function(){for(var e=!1,t=this._outlineGroupsExpectedRendered.get_count()-1;t>=0;t--){this._outlineGroupsExpectedRendered.get_item(t).hasChildNodes()&&(this._outlineGroupsExpectedRendered.removeAt(t),e=!0)}return e},e.prototype.HookupOutlineGroupPropertyChangedEvent=function(){U.App.theNotebookManager.get_theGraph().getSpecificEventHandlers(23).add_onPropertyChanged(i.i(this,this.OutlineGroupOnPropertyChanged,"OutlineGroupOnPropertyChanged"))},e.prototype.OutlineGroupOnPropertyChanged=function(e,t){if(t.get_property()===re.p.forceRenderChildren){var n=t.get_node();if(n)if(n.getValueWithDefault(Boolean,re.p.forceRenderChildren,!1)){var r=n.getHtmlViewElement(this.get_PageView().get_viewId());if(r){var i=r.get_htmlElement();i&&this._outlineGroupsExpectedRendered.add(i)}}}},e.OnPageContentSizeChangeKey="OnPageContentSizeChangeKey",e.OnDocumentBottomChangeKey="OnDocumentBottomChangeKey",e}();(0,i.l)(se,"b907ba71$DocumentSizeManager",null,[]);var le=n(4364),ue=n(4782),ce=function(){function e(e){this._lazyPageView=null,this._lazyPageView=e}return e.prototype.get_pageView=function(){var e=this._lazyPageView.get_value();return ne.ULS.shipAssertTag(37820298,336,e.get_isPageView(),"OutlineManager.PageView is not a PageView."),e},e.prototype.setOutlineMinHeight=function(t,n){var r=n+le.j.twipsToPixels(e.get_WordSectionReader().getPageHeight(t),1,!0);t.getHtmlViewElement(this.get_pageView().get_viewId()).get_htmlElement().firstChild.style.minHeight=r+"px"},e.prototype.getFirstWordSection=function(){var e=J.g.createFromNode(this.get_pageView().get_targetNode());return e.tryToRootAtPageContent(),e.goToFirstChild(),ne.ULS.shipAssertTag(37820299,336,10===e.get_currentINode().get_type(),null),e.get_currentINode()},e.prototype.getLastWordSection=function(){var e=J.g.createFromNode(this.get_pageView().get_targetNode());return e.tryToRootAtPageContent(),e.goToLastChild(),ne.ULS.shipAssertTag(37820300,336,10===e.get_currentINode().get_type(),null),e.get_currentINode()},e.prototype.getPreviousWordSection=function(e){var t=J.g.createFromNode(this.get_pageView().get_targetNode());t.tryToRootAtPageContent(),t.goToFirstChild();for(var n=t.get_currentINode(),r=null;e!==n&&t.goToNextSibling();)r=n,n=t.get_currentINode();return ne.ULS.shipAssertTag(37820301,336,10===t.get_currentINode().get_type(),null),r},e.get_WordSectionReader=function(){return ue.p.get_instance()},e}();(0,i.l)(ce,"ce235c5b$OutlineManager",null,[d]);var de=function(){function e(){this._maxWidth=0}return e.prototype.setMaxWidth=function(e){this._maxWidth=e},e.prototype.showAdornment=function(t){var n=this;t&&(t.style.width=this._maxWidth+"px",window.setTimeout((function(){n.ShowAdornmentText(t)}),e.TransitionDuration))},e.prototype.hideAdornment=function(e){e&&(e.style.width="0px",this.HideAdornmentText(e))},e.prototype.updateAdornmentVisibility=function(e,t){t?this.showAdornment(e):this.hideAdornment(e)},e.prototype.ShowAdornmentText=function(e){e&&(e.style.width===this._maxWidth+"px"&&(this.GetChildDiv(e).style.visibility="visible"))},e.prototype.HideAdornmentText=function(e){e&&(this.GetChildDiv(e).style.visibility="hidden")},e.prototype.GetChildDiv=function(e){var t=e.childNodes;return ne.ULS.shipAssertTag(24958351,336,1===t.length,"Expected 1 child div in the page adornment, found "+t.length),t[0]},e.TransitionDuration=250,e}();(0,i.l)(de,"b686013a$PageAdornmentAnimationManager",null,[C]);var pe,ge=n(1614),he=n(2506);!function(e){e[e.sameAllPages=1]="sameAllPages",e[e.differentFirstPage=2]="differentFirstPage",e[e.differentEvenOdd=3]="differentEvenOdd",e[e.differentFirstEvenOdd=4]="differentFirstEvenOdd"}(pe||(pe={})),(0,i.h)("37fa24f7$HeaderFooterTemplateMode",pe);var _e=function(){function e(e){this._outlineToHeaderFooterKindToContentMap=null,this._outlineToTemplateModeMap=null,this._headerFooterReader=null,this._headerFooterReader=e,this._outlineToHeaderFooterKindToContentMap=new ge.u(ge.u.$$(Boolean)),this._outlineToTemplateModeMap=new ge.u(pe)}return e.prototype.computeContent=function(e){var t=J.g.createFromNode(e);if(t.tryToRootAtPageContent()&&t.getChildCount()){t.goToFirstChild();do{10===t.get_currentNodeType()&&this.PopulateHeaderFooterKindToContentMap(t.get_currentNode()),t.goToNextSiblingOrReturnToParent()}while(8!==t.get_currentNodeType())}},e.prototype.shouldExtendHeaderInContainer=function(e){var t=e.get_pageNumber(),n=this.GetSectionNumber(e.get_topOutlineNode());if(!this._outlineToHeaderFooterKindToContentMap.containsKey(n))return ne.ULS.sendTraceTag(24958352,336,10,"OutlineToHeaderFooterKindToContentMap does not contain a value for the section "+n),!1;var r=this._outlineToHeaderFooterKindToContentMap.get_item(n);ne.ULS.shipAssertTag(24958353,336,this._outlineToTemplateModeMap.containsKey(n),"Outline to template mode map doesn't contain the section key in PageAdornmentContentManager.ShouldShowHeaderForPage().");var i=this._outlineToTemplateModeMap.get_item(n);return this.HeaderHasContent(r,t,i)},e.prototype.shouldExtendFooterInContainer=function(e){var t=e.get_pageNumber(),n=this.GetSectionNumber(e.get_topOutlineNode());if(!this._outlineToHeaderFooterKindToContentMap.containsKey(n))return ne.ULS.sendTraceTag(24958354,336,10,"OutlineToHeaderFooterKindToContentMap does not contain a value for the section "+n),!1;var r=this._outlineToHeaderFooterKindToContentMap.get_item(n);ne.ULS.shipAssertTag(24958355,336,this._outlineToTemplateModeMap.containsKey(n),"Outline to template mode map doesn't contain the section key in PageAdornmentContentManager.ShouldShowFooterForPage().");var i=this._outlineToTemplateModeMap.get_item(n);return this.FooterHasContent(r,t,i)},e.prototype.getTemplateSelectionFromContainer=function(e){if(!e)return ne.ULS.sendTraceTag(24979136,336,10,"Null container input into GetTemplateSelectionFromContainer."),0;var t=e.get_bottomOutlineNode();if(!t)return ne.ULS.sendTraceTag(24979137,336,10,String.format("Container of page number {0} has a null EndSectionNode.",e.get_pageNumber())),0;var n=this._headerFooterReader.getHeaderFooterContainerNodeFromWordSectionNode(t);if(!n)return ne.ULS.sendTraceTag(24979138,336,10,"Header footer container node expected not to be null."),0;var r=this._headerFooterReader.getTemplateMode(n),i=1===e.get_pageNumber(),o=!(e.get_pageNumber()%2);return 1===r?1:2===r?i?2:1:3===r?o?3:4:i?2:o?3:4},e.prototype.PopulateHeaderFooterKindToContentMap=function(e){if(10===e.get_type()){var t=new ge.u(Boolean),n=this._headerFooterReader.getHeaderFooterContainerNodeFromWordSectionNode(e);ne.ULS.shipAssertTag(24958356,336,!!n,"Header footer container node expected to not be null in PageAdornmentContentManager.PopulateHeaderFooterKindToContentMap().");var r=this._headerFooterReader.getTemplateMode(n),i=this.GetSectionNumber(e);this.UpdateSectionToTemplateMode(i,r),this.UpdateSectionToHeaderFooterContentMap(i,t);var o=J.g.createFromNode(n);if(o.getChildCount()){o.goToFirstChild();do{var a=o.get_currentNode(),s=this.GetHeaderFooterKind(a),l=this._headerFooterReader.headerFooterNodeHasContent(a);t.add(s,l),o.goToNextSiblingOrReturnToParent()}while(36===o.get_currentNodeType())}}},e.prototype.UpdateSectionToTemplateMode=function(e,t){this._outlineToTemplateModeMap.containsKey(e)?this._outlineToTemplateModeMap.set_item(e,t):this._outlineToTemplateModeMap.add(e,t)},e.prototype.UpdateSectionToHeaderFooterContentMap=function(e,t){this._outlineToHeaderFooterKindToContentMap.containsKey(e)?this._outlineToHeaderFooterKindToContentMap.set_item(e,t):this._outlineToHeaderFooterKindToContentMap.add(e,t)},e.prototype.GetHeaderFooterKind=function(e){return ne.ULS.shipAssertTag(24958357,336,36===e.get_type(),"Expected node of type HeaderFooter but received node of type "+e.get_type()),e.getValueWithDefault(Number,he.j.headerFooterKind,0)},e.prototype.GetSectionNumber=function(e){return ne.ULS.shipAssertTag(24958358,336,10===e.get_type(),"Expected node of type Outline but received node of type "+e.get_type()),e.getValueWithDefault(Number,he.j.sectionNumber,0)},e.prototype.HeaderHasContent=function(e,t,n){var r=1===t,i=!(t%2);switch(n){case 2:if(r){if(e.containsKey(2))return e.get_item(2)}else if(e.containsKey(0))return e.get_item(0);break;case 3:if(i){if(e.containsKey(1))return e.get_item(1)}else if(e.containsKey(0))return e.get_item(0);break;case 4:if(r){if(e.containsKey(2))return e.get_item(2)}else if(i){if(e.containsKey(1))return e.get_item(1)}else if(e.containsKey(0))return e.get_item(0);break;case 1:if(e.containsKey(0))return e.get_item(0)}return!1},e.prototype.FooterHasContent=function(e,t,n){var r=1===t,i=!(t%2);switch(n){case 2:if(r){if(e.containsKey(5))return e.get_item(5)}else if(e.containsKey(3))return e.get_item(3);break;case 3:if(i){if(e.containsKey(4))return e.get_item(4)}else if(e.containsKey(3))return e.get_item(3);break;case 4:if(r){if(e.containsKey(5))return e.get_item(5)}else if(i){if(e.containsKey(4))return e.get_item(4)}else if(e.containsKey(3))return e.get_item(3);break;case 1:if(e.containsKey(3))return e.get_item(3)}return!1},e}();(0,i.l)(_e,"13451ac5$PageAdornmentContentManager",null,[T]);var fe=n(1822),me=n(5516),ye=n(2664),ve=n(1135),Se=n(3795),Ie=n(6410),Ce=(0,i.y)("b88d24f1$IPageAdornmentContainer"),Te=function(){function e(e,t,n,r,i,o,a,s,l){this._pageNumber=0,this._top=0,this.height=0,this._topOutlineNode=null,this._bottomOutlineNode=null,this.containerDomElement=null,this.headerLabelDomElement=null,this.footerLabelDomElement=null,this.pageNumberLabelDomElement=null,this.ValidateConstructorParameters(e,t,n,o,a,s,l),this._pageNumber=e,this._top=t,this.height=n,this._topOutlineNode=r,this._bottomOutlineNode=i,this.containerDomElement=o,this.headerLabelDomElement=a,this.footerLabelDomElement=s,this.pageNumberLabelDomElement=l}return e.prototype.get_pageNumber=function(){return this._pageNumber},e.prototype.get_top=function(){return this._top},e.prototype.get_height=function(){return this.height},e.prototype.get_topOutlineNode=function(){return this._topOutlineNode},e.prototype.get_bottomOutlineNode=function(){return this._bottomOutlineNode},e.prototype.setTop=function(e){this._top!==e&&(this.containerDomElement.style.top=e+"px",this._top=e)},e.prototype.setHeight=function(e){this.get_height()!==e&&(this.containerDomElement.style.height=e+"px",this.height=e)},e.prototype.ValidateConstructorParameters=function(e,t,n,r,i,o,a){ne.ULS.shipAssertTag(37244961,336,e>0,"PageAdornmentContainer: pageNumber parameter value {0} is unexpected value.",e),ne.ULS.shipAssertTag(37244962,336,t>=0,"PageAdornmentContainer: top parameter value {0} is unexpected value.",t),ne.ULS.shipAssertTag(37244963,336,n>=0,"PageAdornmentContainer: height parameter value {0} is unexpected value.",n,t),ne.ULS.shipAssertTag(37244992,336,!!r,"PageAdornmentContainer: containerDomElement parameter is null."),ne.ULS.shipAssertTag(37244993,336,!!i,"PageAdornmentContainer: headerLabelDomElement parameter is null."),ne.ULS.shipAssertTag(37244994,336,!!o,"PageAdornmentContainer: footerLabelDomElement parameter is null."),ne.ULS.shipAssertTag(37244995,336,!!a,"PageAdornmentContainer: pageNumberLabelDomElement parameter is null.")},e}();(0,i.l)(Te,"ec639dd8$PageAdornmentContainer",null,[Ce]);var be=function(){function e(e,t,n,r,o,a,s,l,u,c,d){this._lazyPageView=null,this._clickInputManager=null,this._contextMenuInputManager=null,this._basicInputManager=null,this._actionManager=null,this._mouseInputManager=null,this._animationManager=null,this._contentManager=null,this._adornmentContainerMap=null,this._headerFooterControlOwnerEvent=null,this._taskManager=null,this._registerEventHandlerQueue=null,this._taskRegisterEventHandlers=null,this._isVisible=!1,this._headerFooterLabelWidthPx=0,this._totalPageCount=0,this._isDismissHandled=!1,this.HeaderFooterPaneIsDisplayed=!1,this._lazyPageView=e,this._clickInputManager=t,this._contextMenuInputManager=n,this._basicInputManager=r,this._actionManager=o,this._mouseInputManager=a,this._isVisible=s,this._animationManager=l,this._contentManager=u,this._headerFooterControlOwnerEvent=c,this._taskManager=d,this._registerEventHandlerQueue=[],this._adornmentContainerMap=new Se.e(Number,Te),this._headerFooterControlOwnerEvent.add_onDismissEventHandler(i.i(this,this.HeaderFooterDismissedEvent,"HeaderFooterDismissedEvent"))}return e.prototype.get_isPositionLeftOfCanvasEnabled=function(){return P.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PositionPageAdornmentContainerLeftOfCanvasIsEnabled")},e.prototype.get_pageView=function(){return this._lazyPageView.get_value()},e.prototype.showPageAdornments=function(){try{this.ShowPageAdornmentsInternal()}catch(e){ne.ULS.shipAssertTag(37244997,336,!1,"Exception was caught in ShowPageAdornments. Message: {0} Stack: {1}",e.message,e.stack)}},e.prototype.hidePageAdornments=function(){try{this.HidePageAdornmentsInternal()}catch(e){ne.ULS.shipAssertTag(37244998,336,!1,"Exception was caught in HidePageAdornments. Message: {0} Stack: {1}",e.message,e.stack)}},e.prototype.computeContent=function(){try{this.ComputeContentInternal()}catch(e){ne.ULS.shipAssertTag(37244999,336,!1,"Exception was caught in HidePageAdornments. Message: {0} Stack: {1}",e.message,e.stack)}},e.prototype.setTotalPageCount=function(e){this._totalPageCount=e},e.prototype.updatePageElements=function(e){try{this.UpdatePageElementsInternal(e)}catch(e){ne.ULS.shipAssertTag(37245e3,336,!1,"Exception was caught in UpdatePageElements. Message: {0}",e.message)}},e.prototype.dispose=function(){try{this.UnregisterAllEventHandlers(),this._headerFooterControlOwnerEvent&&this._headerFooterControlOwnerEvent.remove_onDismissEventHandler(i.i(this,this.HeaderFooterDismissedEvent,"HeaderFooterDismissedEvent"))}catch(e){ne.ULS.shipAssertTag(37245001,336,!1,"Exception was caught in PageAdornmentManager.Dispose. Message: {0} Stack: {1}",e.message,e.stack)}},e.prototype.OnHeaderFooterClickEvent=function(e){var t=e.get_caughtElement();return this.OnAdornmentClicked(t),!0},e.prototype.OnAdornmentClicked=function(e){var t=this.IsHeaderAdornment(e),n=this.GetContainerFromElement(e);if(!n)return ne.ULS.sendTraceTag(37245002,336,10,"GetContainerFromElement returned a null container for element with id "+e.id),void this._actionManager.processAction(me.u.insertHeaderFooter,2,null);var r=this._contentManager.getTemplateSelectionFromContainer(n);this._actionManager.processActionWithData(t?me.u.viewHeader:me.u.viewFooter,2,r,null),this.HeaderFooterPaneIsDisplayed=!0},e.prototype.OnMouseDown=function(e){return!0},e.prototype.HeaderFooterDismissedEvent=function(e,t){var n=this;this._isDismissHandled||(this.HeaderFooterPaneIsDisplayed=!1,this._isDismissHandled=!0,window.setTimeout((function(){n._isDismissHandled=!1}),500),this.UpdateAllAdornmentsBasedOnContent())},e.prototype.OnMouseHoverOver=function(e){if(!this.HeaderFooterPaneIsDisplayed){var t=e.get_caughtElement();this._animationManager.showAdornment(t)}return!0},e.prototype.OnMouseHoverLeave=function(e){if(!this.HeaderFooterPaneIsDisplayed){var t=e.get_caughtElement();this.ShouldStayVisible(t)||this._animationManager.hideAdornment(t)}return!0},e.prototype.UnregisterAllEventHandlers=function(){for(var e=function(e){var n;t._adornmentContainerMap.tryGetValue(e,(0,fe.m)((function(){return n}),(function(e){return n=e})))&&t.UnregisterEventHandlers(n)},t=this,n=1;n<=this._totalPageCount;n++)e(n)},e.prototype.UnregisterEventHandlers=function(t){if(t){var n=t.headerLabelDomElement,r=t.footerLabelDomElement;Ie.s.isValidElement(n)&&Ie.s.isValidElement(r)?(this._mouseInputManager.unregisterHandler(ve.d.mouseEnter,n,i.i(this,this.OnMouseHoverOver,"OnMouseHoverOver")),this._mouseInputManager.unregisterHandler(ve.d.mouseEnter,r,i.i(this,this.OnMouseHoverOver,"OnMouseHoverOver")),this._mouseInputManager.unregisterHandler(ve.d.mouseLeave,n,i.i(this,this.OnMouseHoverLeave,"OnMouseHoverLeave")),this._mouseInputManager.unregisterHandler(ve.d.mouseLeave,r,i.i(this,this.OnMouseHoverLeave,"OnMouseHoverLeave")),this._clickInputManager.unregisterHandler(ve.d.click,n,i.i(this,this.OnHeaderFooterClickEvent,"OnHeaderFooterClickEvent")),this._clickInputManager.unregisterHandler(ve.d.click,r,i.i(this,this.OnHeaderFooterClickEvent,"OnHeaderFooterClickEvent")),this._contextMenuInputManager.unregisterHandler(n,e.OnContextMenuEvent),this._contextMenuInputManager.unregisterHandler(r,e.OnContextMenuEvent),this._basicInputManager.unregisterHandler(ve.d.mouseDown,n,i.i(this,this.OnMouseDown,"OnMouseDown")),this._basicInputManager.unregisterHandler(ve.d.mouseDown,r,i.i(this,this.OnMouseDown,"OnMouseDown"))):ne.ULS.sendTraceTag(37245003,336,15,"Invalid DOM element for the given adornment container in PageAdornmentManager.")}},e.prototype.QueueRegisterEventHandlers=function(e){Array.enqueue(this._registerEventHandlerQueue,e),this._taskRegisterEventHandlers||(this._taskRegisterEventHandlers=new z.c(2,1,50,i.i(this,this.RegisterEventHandlersTask,"RegisterEventHandlersTask"),0,null,!1),this._taskManager.addTask(this._taskRegisterEventHandlers))},e.prototype.RegisterEventHandlersTask=function(e){for(var t=Array.dequeue(this._registerEventHandlerQueue);t;)this.RegisterEventHandlers(t),t=Array.dequeue(this._registerEventHandlerQueue);this._taskRegisterEventHandlers=null},e.prototype.RegisterEventHandlers=function(t){if(t){var n=t.headerLabelDomElement,r=t.footerLabelDomElement;Ie.s.isValidElement(n)&&Ie.s.isValidElement(r)?(this._mouseInputManager.registerHandler(ve.d.mouseEnter,n,i.i(this,this.OnMouseHoverOver,"OnMouseHoverOver")),this._mouseInputManager.registerHandler(ve.d.mouseEnter,r,i.i(this,this.OnMouseHoverOver,"OnMouseHoverOver")),this._mouseInputManager.registerHandler(ve.d.mouseLeave,n,i.i(this,this.OnMouseHoverLeave,"OnMouseHoverLeave")),this._mouseInputManager.registerHandler(ve.d.mouseLeave,r,i.i(this,this.OnMouseHoverLeave,"OnMouseHoverLeave")),this._clickInputManager.registerHandler(ve.d.click,n,i.i(this,this.OnHeaderFooterClickEvent,"OnHeaderFooterClickEvent")),this._clickInputManager.registerHandler(ve.d.click,r,i.i(this,this.OnHeaderFooterClickEvent,"OnHeaderFooterClickEvent")),this._contextMenuInputManager.registerHandler(n,e.OnContextMenuEvent),this._contextMenuInputManager.registerHandler(r,e.OnContextMenuEvent),this._basicInputManager.registerHandler(ve.d.mouseDown,n,i.i(this,this.OnMouseDown,"OnMouseDown")),this._basicInputManager.registerHandler(ve.d.mouseDown,r,i.i(this,this.OnMouseDown,"OnMouseDown"))):ne.ULS.sendTraceTag(37245004,336,15,"Invalid DOM element for the given adornment container in PageAdornmentManager.")}},e.prototype.ShowPageAdornmentsInternal=function(){if(!this._isVisible){for(var e=function(e){var n;t._adornmentContainerMap.tryGetValue(e,(0,fe.m)((function(){return n}),(function(e){return n=e})))&&(n.containerDomElement.style.display="block")},t=this,n=1;n<=this._totalPageCount;n++)e(n);this._isVisible=!0}},e.prototype.HidePageAdornmentsInternal=function(){if(this._isVisible){for(var e=function(e){var n;t._adornmentContainerMap.tryGetValue(e,(0,fe.m)((function(){return n}),(function(e){return n=e})))&&(n.containerDomElement.style.display="none")},t=this,n=1;n<=this._totalPageCount;n++)e(n);this._isVisible=!1}},e.prototype.ComputeContentInternal=function(){this._contentManager.computeContent(this.get_pageView().get_targetNode())},e.prototype.UpdatePageElementsInternal=function(e){var t=0,n=new te.c(Number);this.computeContent();for(var r=this.GetLastExistingPageNumber(),i=e.$$lge();i.$$mn();){var o=i.$$cu(),a=o.get_pageNumber();this.PageContainsValidContainer(o)||this.RemoveAdornmentContainer(o.get_pageNumber()),this._adornmentContainerMap.containsKey(a)?this.UpdateContainerForPage(o):this.CreateContainerForPage(o),t=a,n.add(a)}for(a=1;a<=t;a++)n.contains(a)||this.RemoveAdornmentContainer(a);for(a=t+1;a<=r;a++)this.RemoveAdornmentContainer(a)},e.prototype.PageContainsValidContainer=function(e){return!!this._adornmentContainerMap.containsKey(e.get_pageNumber())&&this._adornmentContainerMap.get_item(e.get_pageNumber()).get_topOutlineNode().get_id()===e.get_topOutlineNode().get_id()},e.prototype.GetLastExistingPageNumber=function(){for(var e=0,t=this._adornmentContainerMap.get_keys(),n=0;n<t.get_length();n++){var r=this._adornmentContainerMap.get_item(t.get_item(n)).get_pageNumber();r>e&&(e=r)}return e},e.prototype.CreateContainerForPage=function(e){var t=e.get_topOutlineNode().getHtmlViewElement(this.get_pageView().get_viewId());if(t){var n=e.get_pageNumber(),r=t.get_displayWrapperDiv(),i=this.CreateContainerElement(n,e.get_top(),e.get_height(),r,e.get_topOutlineNode(),e.get_bottomOutlineNode());this.QueueRegisterEventHandlers(i),this.UpdateAdornmentBasedOnContent(i),this.UpdateVisibilityBasedOnHeight(i),this._adornmentContainerMap.add(n,i)}},e.prototype.CreateContainerElement=function(t,n,r,i,o,a){var s=ye.j.createUnselectableDomElement("div","",e.PageAdornmentContainerStyleName);s.style.top=n+"px",s.style.height=r+"px",i.appendChild(s),this.CalculateHeaderFooterLabelWidth(s,WordEditorIntl.WordEditorStrings.l_Header,WordEditorIntl.WordEditorStrings.l_Footer);var l=this.CreatePageNumberLabelDomElement(t);s.appendChild(l);var u=this.CreateHeaderLabelDomElement(t);s.appendChild(u);var c=this.CreateFooterLabelDomElement(t);s.appendChild(c);var d=this.get_isPositionLeftOfCanvasEnabled()?e.ContainerPositionLeftStyleName:e.ContainerPositionRightStyleName;return Sys.UI.DomElement.addCssClass(s,d),Sys.UI.DomElement.addCssClass(u,d),Sys.UI.DomElement.addCssClass(c,d),P.AFrameworkApplication.get_isRtl()&&(Sys.UI.DomElement.addCssClass(s,e.RtlStyleName),Sys.UI.DomElement.addCssClass(u,e.RtlStyleName),Sys.UI.DomElement.addCssClass(c,e.RtlStyleName)),new Te(t,n,r,o,a,s,u,c,l)},e.prototype.CreateHeaderLabelDomElement=function(t){var n="h"+t,r=ye.j.createUnselectableDomElement("div",n,e.PageHeaderLabelStyleName),i=ye.j.createUnselectableDomElement("span","","");return i.innerText=WordEditorIntl.WordEditorStrings.l_Header,i.style.whiteSpace="nowrap",r.appendChild(i),r},e.prototype.CreateFooterLabelDomElement=function(t){var n="f"+t,r=ye.j.createUnselectableDomElement("div",n,e.PageFooterLabelStyleName),i=ye.j.createUnselectableDomElement("span","","");return i.innerText=WordEditorIntl.WordEditorStrings.l_Footer,i.style.whiteSpace="nowrap",r.appendChild(i),r},e.prototype.CreatePageNumberLabelDomElement=function(t){var n=ye.j.createUnselectableDomElement("div","",e.PageNumberLabelStyleName);return n.innerText=t.toString(),n},e.prototype.CalculateHeaderFooterLabelWidth=function(e,t,n){if(!this._headerFooterLabelWidthPx){var r=ye.j.createUnselectableDomElement("p","","");r.innerText=t,r.style.whiteSpace="nowrap",r.style.visibility="hidden",e.appendChild(r);var i=ye.j.createUnselectableDomElement("p","","");i.innerText=n,i.style.whiteSpace="nowrap",i.style.visibility="hidden",e.appendChild(i),this._headerFooterLabelWidthPx=e.clientWidth,this._animationManager.setMaxWidth(this._headerFooterLabelWidthPx),e.removeChild(r),e.removeChild(i)}},e.prototype.RemoveAdornmentContainer=function(e){if(this._adornmentContainerMap.containsKey(e)){var t=this._adornmentContainerMap.get_item(e);this.UnregisterEventHandlers(t),Ie.s.removeElement(t.containerDomElement),this._adornmentContainerMap.remove(e)}},e.prototype.UpdateContainerForPage=function(e){if(this._adornmentContainerMap.containsKey(e.get_pageNumber())){var t=this._adornmentContainerMap.get(e.get_pageNumber());t.setTop(e.get_top()),t.setHeight(e.get_height()),this.UpdateAdornmentBasedOnContent(t),this.UpdateVisibilityBasedOnHeight(t)}else ne.ULS.sendTraceTag(37245005,324,15,"We called UpdateContainerForPage, but a container doesn't exist for the given page.")},e.prototype.UpdateAllAdornmentsBasedOnContent=function(){this.computeContent();for(var e=function(e){var n;t._adornmentContainerMap.tryGetValue(e,(0,fe.m)((function(){return n}),(function(e){return n=e})))&&(t.UpdateAdornmentBasedOnContent(n),t.UpdateVisibilityBasedOnHeight(n))},t=this,n=1;n<=this._totalPageCount;n++)e(n)},e.prototype.UpdateAdornmentBasedOnContent=function(e){var t=e.headerLabelDomElement,n=e.footerLabelDomElement,r=this._contentManager.shouldExtendHeaderInContainer(e),i=this._contentManager.shouldExtendFooterInContainer(e);this.UpdateTooltipForContainer(e,r,i),this._animationManager.updateAdornmentVisibility(t,r),this._animationManager.updateAdornmentVisibility(n,i)},e.prototype.UpdateTooltipForContainer=function(e,t,n){var r=e.headerLabelDomElement,i=e.footerLabelDomElement;3!==P.AFrameworkApplication.get_theActionManager().get_mode()?(r.title=WordEditorIntl.WordEditorStrings.l_OpenHeader,i.title=WordEditorIntl.WordEditorStrings.l_OpenFooter):(r.title=t?WordEditorIntl.WordEditorStrings.l_EditHeader:WordEditorIntl.WordEditorStrings.l_AddHeader,i.title=n?WordEditorIntl.WordEditorStrings.l_EditFooter:WordEditorIntl.WordEditorStrings.l_AddFooter)},e.prototype.ShouldStayVisible=function(e){var t=this.GetContainerFromElement(e);if(!t)return ne.ULS.sendTraceTag(37245006,336,10,"GetContainerFromElement returned null."),!1;if(this.IsHeaderAdornment(e)){if(this._contentManager.shouldExtendHeaderInContainer(t))return!0}else if(this._contentManager.shouldExtendFooterInContainer(t))return!0;return!1},e.prototype.GetContainerFromElement=function(e){var t=e.id,n=t.substring(1,t.length),r=Number.parseInvariant(n);return this._adornmentContainerMap.containsKey(r)?this._adornmentContainerMap.get_item(r):(ne.ULS.sendTraceTag(37245007,336,10,"Adornment container map does not contain the page number "+r),null)},e.prototype.IsHeaderAdornment=function(e){return e.id.length?"h"===e.id.substring(0,1):(ne.ULS.sendTraceTag(37245008,336,10,"Empty ID found for adornment"),!0)},e.prototype.UpdateVisibilityBasedOnHeight=function(t){var n=t.get_height();n<e.MinimumPageHeightToRenderHeaderFooter?(Sys.UI.DomElement.addCssClass(t.headerLabelDomElement,e.HiddenStyleName),Sys.UI.DomElement.addCssClass(t.footerLabelDomElement,e.HiddenStyleName)):(Sys.UI.DomElement.removeCssClass(t.headerLabelDomElement,e.HiddenStyleName),Sys.UI.DomElement.removeCssClass(t.footerLabelDomElement,e.HiddenStyleName)),n<e.MinimumPageHeightToRenderPageNumber?(Sys.UI.DomElement.addCssClass(t.pageNumberLabelDomElement,e.HiddenStyleName),Sys.UI.DomElement.addCssClass(t.containerDomElement,e.HiddenStyleName)):(Sys.UI.DomElement.removeCssClass(t.pageNumberLabelDomElement,e.HiddenStyleName),Sys.UI.DomElement.removeCssClass(t.containerDomElement,e.HiddenStyleName))},e.OnContextMenuEvent=function(e){return!0},e.PageAdornmentContainerStyleName="PageAdornmentContainer",e.PageNumberLabelStyleName="PageAdornmentNumberLabel",e.PageHeaderLabelStyleName="PageAdornmentHeaderLabel",e.PageFooterLabelStyleName="PageAdornmentFooterLabel",e.ContainerPositionLeftStyleName="PositionLeft",e.ContainerPositionRightStyleName="PositionRight",e.RtlStyleName="Rtl",e.HiddenStyleName="Hidden",e.MinimumPageHeightToRenderHeaderFooter=120,e.MinimumPageHeightToRenderPageNumber=50,e}();(0,i.l)(be,"d9a8a84c$PageAdornmentManager",null,[c,Sys.IDisposable,j]);var Ae=function(){function e(e,t){this._pageElementManagers=null,this._pageElementManagers=new te.c(j),this._pageElementManagers.add(e),this._pageElementManagers.add(t)}return e.prototype.get_pageElementManagers=function(){return this._pageElementManagers},e}();(0,i.l)(Ae,"84a17394$PageElementManagerList",null,[]);var Me=n(3625),Pe=function(){function e(e){this._zoomManager=null,this._pageEndDomElements=null,this._zoomManager=e,this._pageEndDomElements=[]}return e.prototype.removeAllPageEnds=function(){for(var e=0,t=this._pageEndDomElements.length;e<t;e++){var n=this._pageEndDomElements[e];Ie.s.removeElement(n)}Array.clear(this._pageEndDomElements)},e.prototype.getDomElementForPageEnd=function(e,t,n,r,i,o){var a=i.x-o.x,s=o.x+o.width-(i.x+i.width),l=r.x-o.x,u=o.x+o.width-r.x-r.width,c=Math.min(l,a),d=Math.min(u,s),p=this.GetPageEndMarker(e,l,u,c,d,n);return this.AdjustPositionForInAppZoom((0,fe.m)((function(){return t}),(function(e){return t=e})),(0,fe.m)((function(){return a}),(function(e){return a=e})),(0,fe.m)((function(){return s}),(function(e){return s=e}))),p.style.left=-a+"px",p.style.right=-s+"px",p.style.top=t+"px",Array.add(this._pageEndDomElements,p),Me.j.setIgnoredByView(p,!0),p},e.prototype.getDomElementForPageEndOutline=function(e,t,n,r,i,o){var a=r.x-o.x,s=o.x+o.width-(r.x+r.width),l=i.x-o.x,u=o.x+o.width-(i.x+i.width),c=Math.min(a,l),d=Math.min(s,u),p=t+(i.y-o.y);this.AdjustPositionForInAppZoom((0,fe.m)((function(){return p}),(function(e){return p=e})),(0,fe.m)((function(){return c}),(function(e){return c=e})),(0,fe.m)((function(){return d}),(function(e){return d=e})));var g=this.GetPageEndMarker(e,c,d,c,d,n);return g.style.top=p+"px",g.style.zIndex="0",Array.add(this._pageEndDomElements,g),Me.j.setIgnoredByView(g,!0),g},e.prototype.getPageBreakBorderSpan=function(t){return t?t.querySelector(e.PageBreakBorderSpanSelectorString):null},e.prototype.GetPageEndMarker=function(t,n,r,i,o,a){return t?e.GetTablePageEndMarker(n,r,i,o,a):e.GetParaPageEndMarker(i,o,a)},e.prototype.AdjustPositionForInAppZoom=function(e,t,n){t.val=t.val/this._zoomManager.get_instance().get_currentZoom(),n.val=n.val/this._zoomManager.get_instance().get_currentZoom(),e.val=e.val/this._zoomManager.get_instance().get_currentZoom()},e.prototype.isHardBreakVirtualized=function(e){if(!this.IsValidHardBreak(e))return!1;if(!this.PageEndMarkerExistsInGraph(e))return!1;var t=this.getPageBreakDomElement(e);return!t||!t.offsetParent},e.prototype.isHardBreakDeleted=function(e){return!!this.IsValidHardBreak(e)&&!this.PageEndMarkerExistsInGraph(e)},e.prototype.logToBrowserConsole=function(e){},e.prototype.getPageBreakDomElement=function(e){if(!e.get_parentDomElement())return null;var t=null;if(e.get_isHardBreak()&&!e.get_isSectionBreak()){var n=this.getPageBreakBorderSpan(e.get_parentDomElement());n&&(t=n)}else t=e.get_parentDomElement();return t},e.prototype.IsValidHardBreak=function(e){return!!e.get_isHardBreak()&&(!e.get_isSectionBreak()&&!!e.get_paragraphNode())},e.prototype.PageEndMarkerExistsInGraph=function(e){var t=e.get_paragraphNode();return!!t&&!!t.get_anchor()},e.prototype.calculateRelativeDomPosition=function(e,t){return(K.g.getBoundingTop(e)-K.g.getBoundingTop(t))/this._zoomManager.get_instance().get_currentZoom()},e.prototype.calculatePageEndMarkerTopRelativeToOutline=function(e,t){return(K.g.getBoundingTop(e)-K.g.getBoundingTop(t))/this._zoomManager.get_instance().get_currentZoom()},e.prototype.makePageEndsStale=function(){this.UpdatePageEnds(!1)},e.prototype.makePageEndsCurrent=function(){this.UpdatePageEnds(!0)},e.prototype.UpdatePageEnds=function(t){for(var n=0,r=this._pageEndDomElements.length;n<r;n++){var i=this._pageEndDomElements[n];i.id===e.PageEndMarkerIdForPara?e.UpdateParaMarker(i,t):i.id===e.PageEndMarkerIdForTable&&e.UpdateTableMarker(i,t)}},e.GetParaPageEndMarker=function(t,n,r){e._updatedParaMarkerElement||(e._updatedParaMarkerElement=ye.j.createUnselectableDomElement("div",e.PageEndMarkerIdForPara,e.PageEndRootStyleName),e._updatedParaMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndCurrentStyleName+" "+e.FullWidthStyleName)),e._updatedParaMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndStaleStyleName+" "+e.LeftWingStyleName)),e._updatedParaMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndStaleStyleName+" "+e.RightWingStyleName)));var i=e._updatedParaMarkerElement.cloneNode(!0);return i.childNodes[1].style.width=t-e.WingPadding+"px",i.childNodes[2].style.width=n-e.WingPadding+"px",e.UpdateParaMarker(i,r),i},e.GetTablePageEndMarker=function(t,n,r,i,o){e._updatedTableMarkerElement||(e._updatedTableMarkerElement=ye.j.createUnselectableDomElement("div",e.PageEndMarkerIdForTable,e.PageEndRootStyleName),e._updatedTableMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndCurrentStyleName+" "+e.LeftWingStyleName)),e._updatedTableMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndCurrentStyleName+" "+e.RightWingStyleName)),e._updatedTableMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndStaleStyleName+" "+e.LeftWingStyleName)),e._updatedTableMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndStaleStyleName+" "+e.RightWingStyleName)));var a=e._updatedTableMarkerElement.cloneNode(!0),s=r-e.WingPadding,l=i-e.WingPadding;return a.childNodes[0].style.width=t+"px",a.childNodes[1].style.width=n+"px",a.childNodes[2].style.width=s+"px",a.childNodes[3].style.width=l+"px",e.UpdateTableMarker(a,o),a},e.GetHybridPageEndMarker=function(t,n,r){e._updatedHybridMarkerElement||(e._updatedHybridMarkerElement=ye.j.createUnselectableDomElement("div",e.PageEndMarkerIdForPara,e.PageEndRootStyleName),e._updatedHybridMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndCurrentStyleName+" "+e.FullWidthStyleName)),e._updatedHybridMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndCurrentStyleName+" "+e.LeftWingStyleName)),e._updatedHybridMarkerElement.appendChild(ye.j.createUnselectableDomElement("div","",e.PageEndCurrentStyleName+" "+e.RightWingStyleName)));var i=e._updatedHybridMarkerElement.cloneNode(!0);return i.childNodes[1].style.width=t-e.WingPadding+"px",i.childNodes[2].style.width=n-e.WingPadding+"px",e.UpdateParaMarker(i,r),i},e.UpdateParaMarker=function(t,n){n?e.MakeParaMarkerCurrent(t):e.MakeParaMarkerStale(t)},e.MakeParaMarkerStale=function(e){e.childNodes[0].style.display="none",e.childNodes[1].style.display="block",e.childNodes[2].style.display="block"},e.MakeParaMarkerCurrent=function(e){e.childNodes[0].style.display="block",e.childNodes[1].style.display="none",e.childNodes[2].style.display="none"},e.UpdateTableMarker=function(t,n){n?e.MakeTableMarkerCurrent(t):e.MakeTableMarkerStale(t)},e.MakeTableMarkerStale=function(e){e.childNodes[0].style.display="none",e.childNodes[1].style.display="none",e.childNodes[2].style.display="block",e.childNodes[3].style.display="block"},e.MakeTableMarkerCurrent=function(e){e.childNodes[0].style.display="block",e.childNodes[1].style.display="block",e.childNodes[2].style.display="none",e.childNodes[3].style.display="none"},e.PageEndMarkerIdForPara="PageEndMarker.Para",e.PageEndMarkerIdForTable="PageEndMarker.Table",e.PageEndRootStyleName="PageEndMarker",e.PageEndCurrentStyleName="Current",e.PageEndStaleStyleName="Stale",e.LeftWingStyleName="LeftWing",e.RightWingStyleName="RightWing",e.FullWidthStyleName="FullWidth",e.PageBreakBorderSpanSelectorString=".PageBreakBorderSpan",e.WingPadding=10,e._updatedParaMarkerElement=null,e._updatedTableMarkerElement=null,e._updatedHybridMarkerElement=null,e}();(0,i.l)(Pe,"40d2bbd4$PageEndDOMHelper",null,[]);var Fe=function(){function e(e,t){this._zoomManager=null,this._stopwatchBuilder=null,this._previousPageEndMarkerPositions=null,this._previousPageEndMarkersInViewport=null,this._zoomManager=e,this._stopwatchBuilder=t}return e.prototype.storePositions=function(e,t){try{this.StorePositionsInternal(e,t)}catch(e){ne.ULS.sendTraceTag(35005339,336,10,"Exception was caught in PageEndMarkerPositionComparer.StorePositions. Message: {0}",e.message)}},e.prototype.comparePositions=function(e,t,n,r,i,o,a){try{var s=this._stopwatchBuilder.makeAndStartStopwatch("Task","ComparePositions");this.ComparePositionsInternal(e,t,n,r,i,o,a),s.stop(),ne.ULS.sendTraceTag(35005340,336,50,"ComparePositions stopwatch stopped: {0}",s.get_ageInMilliseconds())}catch(e){ne.ULS.sendTraceTag(35005341,336,10,"Exception was caught in PageEndMarkerPositionComparer.ComparePositions. Message: {0}",e.message)}},e.prototype.StorePositionsInternal=function(e,t){this._previousPageEndMarkerPositions=e,this._previousPageEndMarkersInViewport=t},e.prototype.ComparePositionsInternal=function(e,t,n,r,i,o,a){var s=this._previousPageEndMarkerPositions,l=e;if(s&&l){var u=s.get_count(),c=l.get_count();if(u&&c){var d=this.FindInOrderDistancePairs(s,l);if(d.get_count()){var p=this.ComputeAverage(d)/this._zoomManager.get_currentZoom(),g=this.ComputeStandardDeviation(d)/this._zoomManager.get_currentZoom(),h=this.FindShortestDistancePairs(s,l);if(h.get_count()){for(var _=this.ComputeAverage(h)/this._zoomManager.get_currentZoom(),f=this.ComputeStandardDeviation(h)/this._zoomManager.get_currentZoom(),m=!0,y=0;y<d.get_count();y++)if(d.get_item(y)){m=!1;break}var v=0,S=0;this._previousPageEndMarkersInViewport&&t&&(v=this.CalculateAverageDeltaInViewport(this._previousPageEndMarkersInViewport,t),S=t.get_count()-this._previousPageEndMarkersInViewport.get_count());var I={FlightEnabled:n,HardPageBreakExists:i,EstimatedPageCount:u,CalculatedPageCount:c,InOrderAverageDelta:p,InOrderStandardDeviation:g,ShortestAverageDelta:_,ShortestStandardDeviation:f,PositionsShouldBeUpdated:r,DocumentHeightChanged:o,DeltasAllZero:m,HeaderFooterOpenSinceLastResponse:a,DeltaInViewport:v,ChangeInViewportMarkerCount:S};if(ne.ULS.sendTraceTag(35005343,336,50,"{0}",I),!o&&!a&&!m){ne.ULS.sendTraceTag(36557839,336,15,"Assumed redundant pagination request but there were changes in the page end marker positions.");var C=d.toArray().toString(),T=h.toArray().toString();ne.ULS.sendTraceTag(35726603,336,50,"{0} {1}",C,T)}}}}}else ne.ULS.sendTraceTag(35005342,336,10,"estimatedPositions or calculatedPositions are null in PageEndMarkerPositionComparer.ComparePositionsInternal.")},e.prototype.CalculateAverageDeltaInViewport=function(e,t){for(var n=new te.c(Number),r=e.$$lge();r.$$mn();){var i=r.$$cu();n.add(i.get_top())}if(!n.get_count())return-1;for(var o=new te.c(Number),a=t.$$lge();a.$$mn();){var s=a.$$cu();o.add(s.get_top())}if(!o.get_count())return-1;var l=this.FindShortestDistancePairs(n,o);return this.ComputeAverage(l)/this._zoomManager.get_currentZoom()},e.prototype.ComputeAverage=function(e){if(!e.get_count())return 0;for(var t=0,n=0;n<e.get_count();n++)t+=e.get_item(n);return t/e.get_count()},e.prototype.ComputeStandardDeviation=function(e){if(!e.get_count())return 0;for(var t=this.ComputeAverage(e),n=0,r=0;r<e.get_count();r++){var i=e.get_item(r)-t;n+=i*i}var o=n/e.get_count();return Math.sqrt(o)},e.prototype.FindInOrderDistancePairs=function(e,t){var n=new te.c(Number);if(!e.get_count()||!t.get_count())return n;e.Sc((function(e,t){return e-t})),t.Sc((function(e,t){return e-t}));for(var r=Math.min(e.get_count(),t.get_count()),i=0;i<r;i++){var o=Math.abs(e.get_item(i)-t.get_item(i));n.add(o)}return n},e.prototype.FindShortestDistancePairs=function(e,t){var n=new te.c(Number);if(!e.get_count()||!t.get_count())return n;for(var r=e.get_count()<=t.get_count(),i=r?e:t,o=r?t:e,a=0;a<i.get_count();a++){for(var s=i.get_item(a),l=Math.abs(s-o.get_item(0)),u=0,c=1;c<o.get_count();c++){var d=o.get_item(c),p=Math.abs(s-d);p<l&&(l=p,u=c)}n.add(l),o.removeAt(u)}return n},e}();(0,i.l)(Fe,"73803e1a$PageEndMarkerPositionComparer",null,[m]);var we=n(5214),Re=n(1664),Ee=n(1308),ke=n(7159),De=function(){function e(e,t,n,r,i,o,a,s,l,u){this.top=0,this.pageNumber=0,this.isHardBreak=!1,this.isSectionBreak=!1,this.parentDomElement=null,this.outlineNode=null,this.outlineGroupNode=null,this.outlineGroupRelativeTop=0,this.paragraphNode=null,this.pageEnd=null,this.top=e,this.pageNumber=t,this.isHardBreak=n,this.isSectionBreak=r,this.parentDomElement=i,this.outlineNode=o,this.outlineGroupNode=a,this.outlineGroupRelativeTop=s,this.paragraphNode=l,this.pageEnd=u}return e.prototype.get_top=function(){return this.top},e.prototype.get_pageNumber=function(){return this.pageNumber},e.prototype.get_isHardBreak=function(){return this.isHardBreak},e.prototype.get_isSectionBreak=function(){return this.isSectionBreak},e.prototype.get_parentDomElement=function(){return this.parentDomElement},e.prototype.get_outlineNode=function(){return this.outlineNode},e.prototype.get_outlineGroupNode=function(){return this.outlineGroupNode},e.prototype.get_outlineGroupRelativeTop=function(){return this.outlineGroupRelativeTop},e.prototype.get_paragraphNode=function(){return this.paragraphNode},e.prototype.get_pageEnd=function(){return this.pageEnd},e.prototype.setTop=function(e){this.top=e},e.prototype.setPageNumber=function(e){this.pageNumber=e},e.prototype.setOutlineGroupRelativeTop=function(e){this.outlineGroupRelativeTop=e},e}();(0,i.l)(De,"a7b82a56$PageEndMarker",null,[]);var Oe=function(){return function(){this.domElement=null,this.newPosition=0}}();(0,i.l)(Oe,"bed55ba5$PageEndMarkerToRestore",null,[]);var Ue=function(){function e(e,t,n,r,i,o,a){this._lazyPageView=null,this._zoomManager=null,this._outlineManager=null,this._pageEndDomHelper=null,this._pageFullHeightPositionUpdater=null,this._pageFullHeightManager=null,this._graphInstance=null,this._pageEndMarkers=null,this._pageEndMarkersToRestore=null,this._uniqueIdToUnrenderedPageEndMarker=null,this._virtualizedOutlineGroupsWithHardBreaks=null,this._pageFullHeightRenderingIsEnabled=!1,this._outlineGroupsExpectedRendered=null,this._lazyPageView=e,this._zoomManager=t,this._outlineManager=n,this._pageEndDomHelper=r,this._pageFullHeightPositionUpdater=i,this._pageFullHeightManager=o,this._graphInstance=a,this._pageEndMarkers=new te.c(De),this._pageEndMarkersToRestore=new te.c(Oe),this._uniqueIdToUnrenderedPageEndMarker=new ge.u(De),this._virtualizedOutlineGroupsWithHardBreaks=new Re.e(Ee.h,new ke.h),this._outlineGroupsExpectedRendered=new te.c(Object),this._pageFullHeightRenderingIsEnabled=!!i,this.HookupOutlineGroupPropertyChangedEvent()}return e.prototype.get_pageView=function(){var e=this._lazyPageView.get_value();return ne.ULS.shipAssertTag(37052750,336,e.get_isPageView(),"PageEndMarkerPositionUpdater.PageView is not a PageView."),e},e.prototype.updateMarkers=function(e){try{this.UpdateMarkersInternal(e)}catch(e){this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38405270,336,10,"Exception caught in PageEndMarkerPositionUpdater.UpdateMarkers. Exception: {0}",e.message)}},e.prototype.addRenderedMarker=function(e){try{this.AddRenderedMarkerInternal(e)}catch(e){this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38405271,336,10,"Exception caught in PageEndMarkerPositionUpdater.AddRenderedMarker. Exception: {0}",e.message)}},e.prototype.calculatePositions=function(e){try{return this.CalculatePositionsInternal(e)}catch(e){this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(37052752,336,10,"Exception caught in PageEndMarkerPositionUpdater.CalculatePositions. Exception: {0}",e.message)}return!1},e.prototype.restorePositions=function(){try{this.RestorePositionsInternal()}catch(e){this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(37052753,336,10,"Exception caught in PageEndMarkerPositionUpdater.RestorePositions. Exception: {0}",e.message)}},e.prototype.getRenderedPageEndMarkers=function(){try{return this.GetRenderedPageEndMarkersInternal()}catch(e){return this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38405273,336,10,"Exception caught in PageEndMarkerPositionUpdater.GetRenderedPageEndMarkers. Exception: {0}",e.message),null}},e.prototype.updateSectionLastPageHeight=function(){try{this.UpdateSectionLastPageHeightInternal()}catch(e){this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(37820302,336,10,"Exception caught in PageEndMarkerPositionUpdater.UpdateSectionLastPageHeight. Exception: {0}",e.message)}},e.prototype.checkVirtualizedHardBreaks=function(){try{return this.CheckVirtualizedHardBreaksInternal()}catch(e){return this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38405274,336,10,"Exception caught in PageEndMarkerPositionUpdater.CheckVirtualizedHardBreaks. Exception: {0}",e.message),!1}},e.prototype.insertOrDeleteRenderedMarkers=function(e){try{this.InsertOrDeleteRenderedMarkersInternal(e)}catch(e){this._pageEndDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38916953,336,10,"Exception caught in PageEndMarkerPositionUpdater.InsertOrDeleteRenderedMarkers. Exception: {0}",e.message)}},e.prototype.UpdateMarkersInternal=function(e){if(e){this.ClearPositions();for(var t=0;t<e.length;t++){var n=t+1,r=e[t],i=this.ConstructUnrenderedPageEndMarker(r,n);this._pageEndMarkers.add(i),this._uniqueIdToUnrenderedPageEndMarker.add(n,i)}}},e.prototype.InsertOrDeleteRenderedMarkersInternal=function(e){for(var t=!1,n=e.$$lge();n.$$mn();){var r=n.$$cu();if(r)if(r.pageCount>0)for(var i=r.insertedPages.$$lge();i.$$mn();){var o=i.$$cu(),a=r.outlineGroupNode;t=this.AddPageEndDetails(o,a)||t}else if(r.pageCount<0){t=!0;for(var s=r.deletedPages.$$lge();s.$$mn();){o=s.$$cu();this.DeletePageEndMarker(o.pageNumber)}}}t&&this.RenumberPageEndMarkers()},e.prototype.AddRenderedMarkerInternal=function(e){var t=e.paragraphNode,n=this.GetContainingOutlineGroupNode(t);this.AddPageEndDetails(e,n)&&this.RenumberPageEndMarkers()},e.prototype.DeletePageEndMarker=function(e){var t=e-1;return!(t<0||this._pageEndMarkers.get_count()<=t)&&(this._pageEndMarkers.removeAt(t),this._uniqueIdToUnrenderedPageEndMarker.containsKey(e)&&this._uniqueIdToUnrenderedPageEndMarker.remove(e),!0)},e.prototype.GetRenderedPageEndMarkersInternal=function(){for(var e=new te.c(De),t=this._pageEndMarkers.$$lge();t.$$mn();){var n=t.$$cu();this.IsPageEndMarkerRendered(n)&&e.add(n)}return e},e.prototype.GetAllPageEndMarkers=function(){return this._pageEndMarkers},e.prototype.AddPageEndDetails=function(e,t){if(!e)return ne.ULS.sendTraceTag(38385033,336,15,"pageEndDetails is null in PageEndMarkerPositionUpdater.AddRenderedMarkerInternal."),!1;var n,r=this.ConstructRenderedPageEndMarker(e,t),i=e.isClientOnly?-1:e.pageNumber,o=!1;if(this._uniqueIdToUnrenderedPageEndMarker.containsKey(i)){n=this._uniqueIdToUnrenderedPageEndMarker.get_item(i).get_pageNumber(),r.setPageNumber(n);var a=n-1;this._pageEndMarkers.set_item(a,r),this._uniqueIdToUnrenderedPageEndMarker.remove(i)}else{a=(n=r.get_pageNumber())-1;this._pageEndMarkers.insert(a,r),o=!0}return o},e.prototype.ConstructUnrenderedPageEndMarker=function(e,t){var n=e.HardBreak;return new De(0,t,n,!1,null,null,null,0,null,null)},e.prototype.ConstructRenderedPageEndMarker=function(e,t){var n=e.pageEndDomElement,r=e.pageNumber,i=e.pageEnd,o=!!i&&i.HardBreak,a=e.isSectionBreak,s=e.paragraphNode,l=this.GetOutlineGroupNodeDomElement(t),u=e.outlineNode,c=this.GetOutlineNodeDomElement(u);if(!c)return ne.ULS.sendTraceTag(37782370,336,15,"Given an outline node with a null DOM element in ConstructPageEndMarker."),null;var d=null;o&&(d=this._pageEndDomHelper.getPageBreakBorderSpan(e.pageEndDomElement));var p=this._pageEndDomHelper.calculateRelativeDomPosition(d||n,l),g=this._pageEndDomHelper.calculatePageEndMarkerTopRelativeToOutline(d||n,c);return new De(g,r,o,a,n,u,t,p,s,i)},e.prototype.CalculatePositionsInternal=function(e){return this._pageEndMarkersToRestore=new te.c(Oe),this._pageFullHeightRenderingIsEnabled&&this._pageFullHeightPositionUpdater.reset(),this.RemoveDeletedPageEndMarkers(),this.SortPageEndMarkers(),this.AdjustPositionsForHardBreaks(),this.CalculatePageEndMarkersForRestoration(e),this._pageEndMarkersToRestore.get_count()>0},e.prototype.RemoveDeletedPageEndMarkers=function(){for(var e=0;e<this._pageEndMarkers.get_count();e++){var t=this._pageEndMarkers.get_item(e);this._pageEndDomHelper.isHardBreakVirtualized(t)?this.LogVirtualizedHardBreak(t):(this._pageEndDomHelper.isHardBreakDeleted(t)||this.IsPageEndMarkerRendered(t)&&!this.GetOutlineNodeDomElement(t.get_outlineNode()))&&this.RemovePageEndMarker(t)}},e.prototype.AdjustPositionsForHardBreaks=function(){for(var e=0,t=null,n=0,r=0,i=0;i<this._pageEndMarkers.get_count();i++){var o=this._pageEndMarkers.get_item(i);if(this.IsPageEndMarkerRendered(o)){o.get_isHardBreak()&&(r+=this.CalculatePageFullHeightDelta(o,n,r)),t&&t.get_id()===o.get_outlineNode().get_id()||(t=o.get_outlineNode(),e=0,r=0),o.get_isHardBreak()&&!o.get_isSectionBreak()&&(e=this.CalculatePageEndMarkerDelta(o));var a=o.get_top()+e+r;o.setTop(a),n=a}}this.CalculatePageFullHeightDelta(null,n,r),this.RemoveCoveredPageEndMarkers()},e.prototype.CalculatePageFullHeightDelta=function(e,t,n){var r=null;return this._pageFullHeightRenderingIsEnabled&&(r=this._pageFullHeightPositionUpdater.calculatePageFullHeight(e,t,n)),r?r.delta:0},e.prototype.RestorePositionsInternal=function(){if(this._pageEndMarkersToRestore){for(var e=0;e<this._pageEndMarkersToRestore.get_count();e++){var t=this._pageEndMarkersToRestore.get_item(e);Ie.s.setElementStyleTopInPixels(t.domElement,t.newPosition)}this._pageFullHeightRenderingIsEnabled&&this._pageFullHeightPositionUpdater.restorePageFullHeights()}},e.prototype.UpdateSectionLastPageHeightInternal=function(){if(!this._pageFullHeightRenderingIsEnabled){var e=this._outlineManager.getLastWordSection();if(this._pageEndMarkers.get_count()){for(var t=this._outlineManager.getFirstWordSection(),n=0;n<this._pageEndMarkers.get_count();n++){var r=this._pageEndMarkers.get_item(n);if(this.IsPageEndMarkerRendered(r)&&r.get_isSectionBreak()){var i=this._outlineManager.getPreviousWordSection(r.get_outlineNode()),o=n>0?this._pageEndMarkers.get_item(n-1).get_outlineNode():t,a=n&&i.get_id()===o.get_id()?this._pageEndMarkers.get_item(n-1).get_top():0;this._outlineManager.setOutlineMinHeight(i,a)}}var s=this._pageEndMarkers.get_item(this._pageEndMarkers.get_count()-1);s.get_isSectionBreak()?this._outlineManager.setOutlineMinHeight(e,0):this._outlineManager.setOutlineMinHeight(e,s.get_top())}else this._outlineManager.setOutlineMinHeight(e,0)}},e.prototype.SortPageEndMarkers=function(){this._pageEndMarkers.Sc((function(e,t){return e.get_pageNumber()-t.get_pageNumber()}))},e.prototype.RenumberPageEndMarkers=function(){for(var e=0;e<this._pageEndMarkers.get_count();e++){var t=e+1;this._pageEndMarkers.get_item(e).setPageNumber(t)}},e.prototype.CalculatePageEndMarkerDelta=function(e){return e?this.CalculatePositionInOutline(e)-e.get_top():(ne.ULS.sendTraceTag(37306776,336,15,"CalculatePageEndMarkerDelta called with a null PageEndMarker."),0)},e.prototype.CalculatePositionInOutlineGroup=function(e){if(!e)return 0;var t=this.GetOutlineGroupNodeDomElement(e.get_outlineGroupNode());return t?this._pageEndDomHelper.calculateRelativeDomPosition(this._pageEndDomHelper.getPageBreakDomElement(e),t):0},e.prototype.CalculatePositionInOutline=function(e){if(!e)return 0;var t=this._pageEndDomHelper.getPageBreakDomElement(e),n=this.GetOutlineNodeDomElement(e.get_outlineNode());return n?this._pageEndDomHelper.calculatePageEndMarkerTopRelativeToOutline(t,n):(ne.ULS.sendTraceTag(37782371,336,50,"The given pageEndMarker contains an outline node with a null DOM element in CalculatePageEndMarkerPosition."),0)},e.prototype.RemoveCoveredPageEndMarkers=function(){for(var e=0,t=!1,n=null,r=!1,i=this._pageEndMarkers.get_count()-1;i>=0;i--){var o=this._pageEndMarkers.get_item(i);if(this.IsPageEndMarkerRendered(o))if(n&&n.get_id()===o.get_outlineNode().get_id()||(t=!n,n=o.get_outlineNode(),e=this.GetOutlineNodeHeight(n)),o.get_isHardBreak())t=!1,e=o.get_top();else{if(this._pageFullHeightRenderingIsEnabled&&t)continue;o.get_top()>e&&(this.RemovePageEndMarker(o),Ie.s.removeElement(this._pageEndDomHelper.getPageBreakDomElement(o)),r=!0)}}r&&this.RenumberPageEndMarkers()},e.prototype.RemovePageEndMarker=function(e){this._pageEndMarkers.contains(e)&&(this._pageFullHeightRenderingIsEnabled&&this._pageFullHeightManager.removePageEndDetails(e),this._pageEndMarkers.remove(e))},e.prototype.IsPageEndMarkerRendered=function(e){if(!e)return ne.ULS.sendTraceTag(38385035,324,50,"PageEndMarker is null in IsPageEndMarkerRendered."),!1;var t=this._pageEndDomHelper.getPageBreakDomElement(e);return!(!t||!t.offsetParent)},e.prototype.CheckVirtualizedHardBreaksInternal=function(){for(var e=!1,t=this._outlineGroupsExpectedRendered.get_count()-1;t>=0;t--){this._outlineGroupsExpectedRendered.get_item(t).hasChildNodes()&&(this._outlineGroupsExpectedRendered.removeAt(t),e=!0)}return e},e.prototype.LogVirtualizedHardBreak=function(e){var t=e.get_paragraphNode(),n=this.GetContainingOutlineGroupNode(t);n&&(this._virtualizedOutlineGroupsWithHardBreaks.contains(n.get_id())||this._virtualizedOutlineGroupsWithHardBreaks.add(n.get_id()))},e.prototype.HookupOutlineGroupPropertyChangedEvent=function(){this._graphInstance&&this._graphInstance.getSpecificEventHandlers(23).add_onPropertyChanged(i.i(this,this.OutlineGroupOnPropertyChanged,"OutlineGroupOnPropertyChanged"))},e.prototype.OutlineGroupOnPropertyChanged=function(e,t){if(t.get_property()===re.p.forceRenderChildren){var n=t.get_node();if(n)if(n.getValueWithDefault(Boolean,re.p.forceRenderChildren,!1)&&this._virtualizedOutlineGroupsWithHardBreaks.contains(n.get_id())){var r=n.getHtmlViewElement(this.get_pageView().get_viewId());if(r){var i=r.get_htmlElement();i&&(this._virtualizedOutlineGroupsWithHardBreaks.remove(n.get_id()),this._outlineGroupsExpectedRendered.add(i))}}}},e.prototype.CalculatePageEndMarkersForRestoration=function(e){for(var t=this._pageEndMarkers.get_count()-1;t>=0;t--){var n=this._pageEndMarkers.get_item(t);this.IsPageEndMarkerRendered(n)&&this.CalculatePageEndMarkerForRestoration(n,e)}},e.prototype.CalculatePageEndMarkerForRestoration=function(t,n){var r=this.CalculatePositionInOutline(t),i=this.CalculatePositionInOutlineGroup(t);if(t.get_isHardBreak())t.setTop(r),t.setOutlineGroupRelativeTop(i);else{var o=void 0;if(n)o=r-t.get_top();else o=i-t.get_outlineGroupRelativeTop();t.setTop(r-o),t.setOutlineGroupRelativeTop(i-o),Math.abs(o)>e.PIXEL_THRESHOLD&&this.SetRestorePageEndMarker(this._pageEndDomHelper.getPageBreakDomElement(t),o)}},e.prototype.GetOutlineNodeDomElement=function(e){if(!e)return null;var t=e.getHtmlViewElement(this.get_pageView().get_viewId());return t?t.get_htmlElement():(ne.ULS.sendTraceTag(37782401,336,50,"outlineNodeHtmlViewElement is null in GetOutlineNodeTop."),null)},e.prototype.GetOutlineGroupNodeDomElement=function(e){if(!e)return null;var t=e.getHtmlViewElement(this.get_pageView().get_viewId());return t?t.get_htmlElement():null},e.prototype.GetContainingOutlineGroupNode=function(e){var t=J.g.createFromNode(e);return t.tryToRootAtAncestorOfType(23)?t.returnToAncestorOfType(23):null},e.prototype.GetOutlineNodeBounds=function(e){if(!e)return null;var t=e.getHtmlViewElement(this.get_pageView().get_viewId());if(!t)return ne.ULS.sendTraceTag(37888197,336,50,"outlineNodeHtmlViewElement is null in GetOutlineNodeBounds."),null;var n=t.get_htmlElement();return K.g.getElementBounds(n)},e.prototype.GetOutlineNodeHeight=function(e){var t=this.GetOutlineNodeBounds(e);return t?t.height/this._zoomManager.get_currentZoom():0},e.prototype.SetRestorePageEndMarker=function(e,t){var n=(Ie.s.getElementStyleTopInPixels(e)-t)*this._zoomManager.get_currentZoom();this._pageEndMarkersToRestore.add((0,we.m)(new Oe,{domElement:e,newPosition:n}))},e.prototype.ClearPositions=function(){this._pageEndMarkers=new te.c(De),this._uniqueIdToUnrenderedPageEndMarker=new ge.u(De)},e.PIXEL_THRESHOLD=1,e.HiddenStyleString="Hidden",e}();(0,i.l)(Ue,"cf9ff20c$PageEndMarkerPositionUpdater",null,[f]);var xe=n(7236),Le=n(5541),Ne=n(3850),Be=n(4520),He=function(){return function(){this.ParaId=0,this.CP=0,this.PageEndType=0,this.HardBreak=!1}}();(0,i.l)(He,"5ced7434$PageEnd",null,[]);var $e,Ge=n(5848),We=n(1973),Ve=n(3367),je=n(3687),qe=function(){function e(e,t,n,r,i,o,a,s,l,u,c){this.position=0,this.pageNumber=0,this.paragraphNode=null,this.pageEnd=null,this.pageEndDomElement=null,this.outlineNode=null,this.isSectionBreak=!1,this.isLastPage=!1,this.isTopOfDocument=!1,this.isClientOnly=!1,this.isPlaceHolder=!1,this.ValidateConstructorParameters(t,n,r,i,o,l,c),this.position=e,this.pageNumber=t,this.paragraphNode=n,this.pageEnd=r,this.pageEndDomElement=i,this.outlineNode=o,this.isLastPage=a,this.isTopOfDocument=s,this.isClientOnly=l,this.isSectionBreak=u,this.isPlaceHolder=c}return e.prototype.setPageNumber=function(e){this.pageNumber=e},e.prototype.ValidateConstructorParameters=function(e,t,n,r,i,o,a){a||(ne.ULS.shipAssertTag(38326881,336,!!i,"PageEndDetails: outlineNode parameter value is null."),ne.ULS.shipAssertTag(24126528,336,e>=0,"PageEndDetails: pageNumber parameter value {0} is unexpected value.",e),ne.ULS.shipAssertTag(24126529,336,!!t||o,"PageEndDetails: paragraphNode parameter is null for a page that is not client-only."),ne.ULS.shipAssertTag(24126530,336,!!n||o,"PageEndDetails: pageEnd parameter is null for a page that is not client-only."),ne.ULS.shipAssertTag(24126531,336,!!r||o,"PageEndDetails: pageEndDomElement parameter is null for a page that is not client-only."))},e.createInstanceForLastPage=function(t,n){return e.createClientOnly(0,t,null,n,!0,!1)},e.createInstanceForTopOfDocument=function(t){return e.createClientOnly(0,0,null,t,!1,!0)},e.createClientOnly=function(t,n,r,i,o,a){return new e(t,n,null,null,r,i,o,a,!0,!1,!1)},e.createPlaceHolder=function(t,n){return new e(0,t,null,n,null,null,!1,!1,!1,!1,!0)},e}();(0,i.l)(qe,"5ce88136$PageEndDetails",null,[]),function(e){e[e.para=0]="para",e[e.tableSplit=1]="tableSplit",e[e.tableRowSplit=2]="tableRowSplit"}($e||($e={})),(0,i.h)("90d690cd$PageEndType",$e);var ze=function(){function e(t,n,r,o,a,s,l,u,c,d,p,g,h,_,f,m,y,v,S,I,C){this._lazyPageView=null,this._lazyObjectSpace=null,this._pageAdornmentManager=null,this._pageEndMarkerPositionUpdater=null,this._pageEndMarkerPositionComparer=null,this._pageManager=null,this._getPageEndPositionFromCp=null,this._paragraphWordIdMapping=null,this._taskManager=null,this._getHalfLeadingVerticalSpace=null,this._contentEditableViewEventSource=null,this._stopwatchBuilder=null,this._pageFullHeightManager=null,this._pageLevelDeltaMetric=null,this._paginationDeltaMetric=null,this._currentPageCalculator=null,this._nodesWaitingForViewElement=null,this._pageEndsAvailableForDelayedRender=null,this._pageEndsCurrent=!0,this._pageEndsHidden=!1,this._pageEnds=null,this._totalPageCount=0,this._hardPageBreakInDocument=!1,this._pageEndMarkerPositionsShouldBeUpdated=!1,this._pageEndMarkerPositionUpdaterFlightEnabled=!1,this._documentHeightChanged=!1,this._outlineGroupsWithPageEndDetails=null,this._headerFooterShowing=!1,this._headerFooterOpenSinceLastResponse=!1,this._pageViewEventHandlersAttached=!1,this._renderPageEndsForOutlineGroupTask=null,this._renderAllPageEndsTask=null,this._isPageMarkersRenderDone=!0,this._lazyPageView=t,this._lazyObjectSpace=n,this._pageAdornmentManager=r,this._pageEndMarkerPositionUpdater=o,this._pageEndMarkerPositionComparer=a,this._pageManager=s,e._pageEndDomHelper=u,this._getPageEndPositionFromCp=c,this._paragraphWordIdMapping=d,this._taskManager=p,this._getHalfLeadingVerticalSpace=g,this._stopwatchBuilder=_,this._pageFullHeightManager=m,this._pageLevelDeltaMetric=y,this._paginationDeltaMetric=v,this._currentPageCalculator=S,this._nodesWaitingForViewElement=new Se.e(Ee.h,te.c.$$(He)),this._pageEndsAvailableForDelayedRender=new te.c(He),this._pageEnds=new te.c(He),this._outlineGroupsWithPageEndDetails=new Se.e(Ee.h,Ne.f.$$(qe)),this._contentEditableViewEventSource=h,this._contentEditableViewEventSource.add_onContentDirtied(i.i(this,this.OnContentDirtied,"OnContentDirtied")),this._pageEndsHidden=!I,this._pageEndMarkerPositionUpdaterFlightEnabled=C,f&&(f.add_onShowEventHandler(i.i(this,this.OnHeaderFooterShow,"OnHeaderFooterShow")),f.add_onDismissEventHandler(i.i(this,this.OnHeaderFooterDismiss,"OnHeaderFooterDismiss"))),l&&l.add_onPageContentSizeChange(i.i(this,this.OnPageContentSizeChange,"OnPageContentSizeChange"))}return e.prototype.get_isPageMarkersRenderDone=function(){return this._isPageMarkersRenderDone},e.prototype.get_pageEnds=function(){return this._pageEnds},e.prototype.get_outlineGroupsWithPageEndDetails=function(){return this._outlineGroupsWithPageEndDetails},e.prototype.get_pageView=function(){return this._lazyPageView.get_value()},e.prototype.get_ObjectSpace=function(){return this._lazyObjectSpace.get_value()},e.prototype.OnContentDirtied=function(e,t){this.makePageEndsStale()},e.prototype.OnHeaderFooterDismiss=function(e,t){this._headerFooterShowing=!1},e.prototype.OnHeaderFooterShow=function(e,t){this._headerFooterShowing=!0,this._headerFooterOpenSinceLastResponse=!0},e.prototype.updateMarkers=function(t,n){var r=this._stopwatchBuilder.makeAndStartStopwatch("Task","UpdateMarkers");this.StorePageEndMarkerPositionsForTelemetry(),this._pageEndsCurrent=n,e._pageEndDomHelper.removeAllPageEnds(),this._nodesWaitingForViewElement=new Se.e(Ee.h,te.c.$$(He)),this._pageEndsAvailableForDelayedRender.clear(),this._pageEnds.clear(),this._outlineGroupsWithPageEndDetails=new Se.e(Ee.h,Ne.f.$$(qe)),this._hardPageBreakInDocument=!1,this._isPageMarkersRenderDone=!1,this._pageEndMarkerPositionUpdater&&this._pageEndMarkerPositionUpdater.updateMarkers(t),this.EnsurePageViewEventHandlersAttached();this._totalPageCount;this._totalPageCount=t.length+1,this._pageFullHeightManager&&this._pageFullHeightManager.reset(t),this._pageAdornmentManager&&(this._pageAdornmentManager.setTotalPageCount(this._totalPageCount),this._pageAdornmentManager.computeContent());for(var i=0,o=t;i<o.length;i++){var a=o[i];this._pageEnds.add(a),this.RenderPageEndMarkerAndFullPageHeight(a)}if(n&&this._pageEndMarkerPositionUpdater&&this._pageLevelDeltaMetric&&this._pageLevelDeltaMetric.get_isEnabled()){var s=this._pageEndMarkerPositionUpdater.getRenderedPageEndMarkers();this._pageLevelDeltaMetric.calculate(s)}this.ComparePageEndMarkerPositionsForTelemetry(),this._pageEndMarkerPositionsShouldBeUpdated=!1,this._documentHeightChanged=!1,this._headerFooterOpenSinceLastResponse=this._headerFooterShowing,je.WoncaApp.get_instance().get_imageOverflowIsEnabled()&&e.get_ImageOverflowUpdateHeightIsEnabled()&&this._pageEndMarkerPositionUpdater.updateSectionLastPageHeight(),this._pageManager.updatePageBoundariesOnSwordResponse(this._pageEndMarkerPositionUpdater.getRenderedPageEndMarkers(),this._pageEnds.get_count()),this._isPageMarkersRenderDone=!0,this._currentPageCalculator&&this._currentPageCalculator.updatePageNumber(),r.stop(),ne.ULS.sendTraceTag(25048922,336,50,"UpdateMarkers stopwatch stopped: {0}",{DurationInMs:r.get_ageInMilliseconds(),TotalPageCount:this._totalPageCount,AvgDurationPerPageInMs:r.get_ageInMilliseconds()/this._totalPageCount})},e.prototype.GetPageEndMarkersInViewport=function(){var e=this._pageEndMarkerPositionUpdater.getRenderedPageEndMarkers();if(!e)return null;for(var t=Ie.s.getViewPortHeight(),n=new te.c(De),r=e.$$lge();r.$$mn();){var i=r.$$cu();this.IsPageEndMarkerInViewport(i,t)&&n.add(i)}return n},e.prototype.IsPageEndMarkerInViewport=function(t,n){if(!t)return!1;var r=e._pageEndDomHelper.getPageBreakDomElement(t);if(!r)return!1;var i=K.g.getBoundingTop(r);return i>=0&&i<=n},e.prototype.GetAbsolutePageEndMarkerPositions=function(){var e=new te.c(Number);if(!this._outlineGroupsWithPageEndDetails)return ne.ULS.sendTraceTag(35005382,336,10,"_outlineGroupsWithPageEndDetails is null in PageEndMarkers.GetAbsolutePageEndMarkerPositions."),e;for(var t=this._outlineGroupsWithPageEndDetails.get_keys(),n=0;n<t.get_length();n++){var r=t.get_item(n),i=this._outlineGroupsWithPageEndDetails.get_item(r);if(i)for(var o=0;o<i.get_count();o++){var a=i.get_item(o);if(!a.pageEnd.HardBreak&&!Sys.UI.DomElement.containsCssClass(a.pageEndDomElement,"Hidden")){var s=K.g.getBoundingTop(a.pageEndDomElement);e.add(s)}}}return e},e.prototype.StorePageEndMarkerPositionsForTelemetry=function(){var e=this.GetAbsolutePageEndMarkerPositions(),t=this.GetPageEndMarkersInViewport();this._pageEndMarkerPositionComparer.storePositions(e,t),this._paginationDeltaMetric&&this._paginationDeltaMetric.get_isEnabled()&&this._paginationDeltaMetric.storePositions(t)},e.prototype.ComparePageEndMarkerPositionsForTelemetry=function(){if(!(this._totalPageCount>25)){var e=this.GetAbsolutePageEndMarkerPositions(),t=this.GetPageEndMarkersInViewport();this._pageEndMarkerPositionComparer.comparePositions(e,t,this._pageEndMarkerPositionUpdaterFlightEnabled,this._pageEndMarkerPositionsShouldBeUpdated,this._hardPageBreakInDocument,this._documentHeightChanged,this._headerFooterOpenSinceLastResponse),this._paginationDeltaMetric&&this._paginationDeltaMetric.get_isEnabled()&&this._paginationDeltaMetric.calculate(t)}},e.prototype.EnsurePageViewEventHandlersAttached=function(){this._pageViewEventHandlersAttached||(this.get_pageView().add_onAfterValidateEvent(i.i(this,this.PageViewOnAfterValidateEvent,"PageViewOnAfterValidateEvent")),this.get_pageView().add_onViewElementCreatedEvent(i.i(this,this.PageViewOnViewElementCreatedEvent,"PageViewOnViewElementCreatedEvent")),this.get_pageView().add_onInteractiveViewResize(i.i(this,this.redrawAllPageEnds,"redrawAllPageEnds")),this._pageViewEventHandlersAttached=!0)},e.prototype.RenderPageEndMarkerAndFullPageHeight=function(t){if(this._pageEndsHidden)return!0;var n=this.RenderPageEndMarker(t);return!!n&&(this._pageFullHeightManager&&this._pageFullHeightManager.handlePageFullHeight(n),this._pageEndMarkerPositionUpdater&&(this._pageEndMarkerPositionUpdater.addRenderedMarker(n),this._pageManager.updatePageBoundaries(this._pageEndMarkerPositionUpdater.getRenderedPageEndMarkers()),je.WoncaApp.get_instance().get_imageOverflowIsEnabled()&&e.get_ImageOverflowUpdateHeightIsEnabled()&&this._pageEndMarkerPositionUpdater.updateSectionLastPageHeight()),!0)},e.prototype.RenderPageEndMarker=function(e){var t,n,r,i=e.ParaId,o=(e.PageEndType,e.CP,this.GetParagraphNode(i));if(!o)return null;if(!o.get_anchor()||!o.get_containingGraph())return this.AddToWaitList(e,o),null;if(e.HardBreak){var a=Z.ParagraphReader.getNextOrPreviousParagraph(o,!0,!0,!0);if(this.ParagraphContainsHardPageBreak(a)&&(o=a),!this.tryGetHardBreakPosition(e,o,(0,fe.m)((function(){return t}),(function(e){return t=e})),(0,fe.m)((function(){return n}),(function(e){return n=e})),(0,fe.m)((function(){return r}),(function(e){return r=e}))))return null;this._hardPageBreakInDocument=!0}else if(!this.RenderPageEndMarkerForSoftBreak(e,o,(0,fe.m)((function(){return t}),(function(e){return t=e})),(0,fe.m)((function(){return n}),(function(e){return n=e})),(0,fe.m)((function(){return r}),(function(e){return r=e}))))return null;return this.addPageEndDetails(o,e,t,n,r)},e.prototype.ParagraphContainsHardPageBreak=function(t){if(!t)return!1;var n=t.getHtmlViewElement(this.get_pageView().get_viewId());if(!n)return!1;var r=n.get_htmlElement();return!!e._pageEndDomHelper.getPageBreakBorderSpan(r)},e.prototype.RenderPageEndMarkerForSoftBreak=function(t,n,r,i,o){var a,s,l=t.PageEndType;if(r.val=0,i.val=null,o.val=null,l){if(!this.getPageEndPositionForTable(t,n,(0,fe.m)((function(){return a}),(function(e){return a=e})),(0,fe.m)((function(){return s}),(function(e){return s=e}))))return!1}else if(!this.getPageEndPositionForParagraph(t,n,(0,fe.m)((function(){return a}),(function(e){return a=e})),(0,fe.m)((function(){return s}),(function(e){return s=e}))))return!1;var u=J.g.createFromNode(n);u.tryToRootAtOutlineAncestor(),i.val=u.returnToAncestorOfType(23);var c=i.val.getHtmlViewElement(this.get_pageView().get_viewId()).getBounds(),d=u.returnToOutlineNode().getHtmlViewElement(this.get_pageView().get_viewId());if(!d)return ne.ULS.sendTraceTag(50997218,314,50,"outlineGroupViewElement is null for ViewId: {0}.",this.get_pageView().get_viewId()),!1;var p=d.getBounds();r.val=a-c.y;var g=e._pageEndDomHelper.getDomElementForPageEndOutline(l,r.val,this._pageEndsCurrent,s,c,p);return d.get_displayWrapperDiv().appendChild(g),o.val=g,!0},e.prototype.tryGetHardBreakPosition=function(t,n,r,i,o){i.val=null;var a=n.getHtmlViewElement(this.get_pageView().get_viewId());if(r.val=0,o.val=null,this.IsWaitingForViewElement(t,a,n))return!1;i.val=e.NavigateToContainingOutlineGroup(n);var s=i.val.getHtmlViewElement(this.get_pageView().get_viewId());if(!s)return ne.ULS.sendTraceTag(50446550,314,15,"outlineGroupViewElement is null for ViewId: {0}.",this.get_pageView().get_viewId()),!1;var l=s.getBounds(),u=H.n.boundsFromCp(a,t.CP,!1,!1,!1,null);return r.val=u.y-l.y,o.val=this.GetHardBreakElement(t,n),!0},e.prototype.GetHardBreakElement=function(e,t){return t.getHtmlViewElement(this.get_pageView().get_viewId()).get_htmlElement()},e.prototype.GetParagraphNode=function(e){var t=this._paragraphWordIdMapping.getParagraphNodeByWordId(e);if(t!==Ee.h.get_nil()){var n=this.get_ObjectSpace().getObject(t);if(n)return n}return ne.ULS.sendTraceTag(6398172,336,10,"PageEndMarkers: Cannot find graph node for para Id {0} objectId {1}",e,t),null},e.prototype.getPageEndPositionForParagraph=function(e,t,n,r){var i=e.CP;n.val=0,r.val=null;var o=t.getHtmlViewElement(this.get_pageView().get_viewId());return!this.IsWaitingForViewElement(e,o,t)&&(r.val=o.getBounds(),n.val=i?this._getPageEndPositionFromCp((0,Le.e)(xe.e,o),i):r.val.y-this._getHalfLeadingVerticalSpace(o),!0)},e.prototype.getPageEndPositionForTable=function(e,t,n,r){r.val=null,n.val=0;var i=e.PageEndType,o=J.g.createFromNode(t);if(o.tryToRootAtOutlineAncestor(),!Be.TableReader.isInTable(o))return ne.ULS.sendTraceTag(6398173,336,50,"PageEndMarkers: Para {0} has moved out from inside the table, treating as normal paragraph.",e.ParaId),this.getPageEndPositionForParagraph(e,t,n,r);if(1===i){Ge.TableNavigator.returnToContainingRow(o);var a=o.get_currentNode().getHtmlViewElement(this.get_pageView().get_viewId());if(this.IsWaitingForViewElement(e,a,t))return!1;n.val=a.getBounds().y}else{var s=t.getHtmlViewElement(this.get_pageView().get_viewId());if(this.IsWaitingForViewElement(e,s,t))return!1;n.val=this._getPageEndPositionFromCp((0,Le.e)(xe.e,s),e.CP)}n.val-=1;var l=null,u=null;do{l=u,u=o.returnToAncestorOfType(14)}while(u);(o=J.g.createFromNode(l)).tryToRootAtOutlineAncestor(),Ge.TableNavigator.moveToFirstRow(o);var c=o.get_currentNode().getHtmlViewElement(this.get_pageView().get_viewId());return r.val=c.getBounds(),!0},e.prototype.IsWaitingForViewElement=function(e,t,n){if(!t||t.needsUpdate(16))return this.AddToWaitList(e,n),!0;var r=t.getBounds();return!r.width&&!r.height&&(this.AddPageEndForDelayedRender(e),!0)},e.prototype.AddPageEndForDelayedRender=function(e){return!this._pageEndsAvailableForDelayedRender.contains(e)&&(this._pageEndsAvailableForDelayedRender.add(e),!0)},e.prototype.AddToWaitList=function(e,t){var n=t.get_id();this._nodesWaitingForViewElement.containsKey(n)||this._nodesWaitingForViewElement.set_item(n,new te.c(He)),this._nodesWaitingForViewElement.get_item(n).add(e)},e.prototype.PageViewOnAfterValidateEvent=function(){for(var e=this._pageEndsAvailableForDelayedRender.get_count()-1;e>=0;e--){var t=this._pageEndsAvailableForDelayedRender.get_item(e);this.RenderPageEndMarkerAndFullPageHeight(t)&&this._pageEndsAvailableForDelayedRender.removeAt(e)}this.CheckVirtualizedHardBreaks()},e.prototype.CheckVirtualizedHardBreaks=function(){this._pageEndMarkerPositionUpdater&&(this._pageEndMarkerPositionUpdater.checkVirtualizedHardBreaks()&&this.UpdatePageEndMarkerPositions(!1))},e.prototype.OnPageContentSizeChange=function(t,n){if(!(Math.abs(n.delta)<=e.PageContentSizeChangeThreshold)){this._documentHeightChanged=!0;var r=!n.newContentRendered;this.UpdatePageEndMarkerPositions(r)}},e.prototype.UpdatePageEndMarkerPositions=function(t){this._pageEndMarkerPositionUpdater&&(this._pageEndMarkerPositionUpdater.calculatePositions(t)&&(this._pageEndMarkerPositionsShouldBeUpdated=!0),this._pageEndMarkerPositionUpdaterFlightEnabled&&this._pageEndMarkerPositionUpdater.restorePositions(),this._pageManager.updatePageBoundaries(this._pageEndMarkerPositionUpdater.getRenderedPageEndMarkers()),je.WoncaApp.get_instance().get_imageOverflowIsEnabled()&&e.get_ImageOverflowUpdateHeightIsEnabled()&&this._pageEndMarkerPositionUpdater.updateSectionLastPageHeight())},e.prototype.PageViewOnViewElementCreatedEvent=function(e,t){try{var n=t.get_id();if(this._nodesWaitingForViewElement.containsKey(n)){for(var r=this._nodesWaitingForViewElement.get_item(n),i=0;i<r.get_count();i++)this.AddPageEndForDelayedRender(r.get_item(i));this._nodesWaitingForViewElement.remove(n)}}catch(e){}},e.prototype.makePageEndsStale=function(){this._pageEndsCurrent&&(this._pageEndsCurrent=!1,e._pageEndDomHelper.makePageEndsStale())},e.prototype.makePageEndsCurrent=function(){this._pageEndsCurrent||(this._pageEndsCurrent=!0,e._pageEndDomHelper.makePageEndsCurrent())},e.prototype.showPageEnds=function(){this._pageEndsHidden=!1,this._pageEnds&&this.updateMarkers(this._pageEnds.toArray(),this._pageEndsCurrent),this._pageAdornmentManager&&this._pageAdornmentManager.showPageAdornments()},e.prototype.hidePageEnds=function(){this._pageEndsHidden=!0,e._pageEndDomHelper.removeAllPageEnds(),this._pageAdornmentManager&&this._pageAdornmentManager.hidePageAdornments(),this._pageFullHeightManager&&this._pageFullHeightManager.hidePageFullHeights()},e.prototype.addPageEndDetails=function(e,t,n,r,i){var o=this._pageEnds.indexOf(t)+1;if(o<0)return null;var a=$.d.get_instance().navigateToWordSectionNode(e),s=this.IsSectionBreak(t,e),l=new qe(n,o,e,t,i,a,!e||!t||!i,!1,!1,s,!1);return this._outlineGroupsWithPageEndDetails.containsKey(r.get_id())||this._outlineGroupsWithPageEndDetails.set_item(r.get_id(),new te.c(qe)),this._outlineGroupsWithPageEndDetails.get_item(r.get_id()).add(l),l},e.prototype.IsSectionBreak=function(e,t){if(!e||!e.HardBreak)return!1;var n=J.g.createFromNode(t);return n.tryToRootAtAncestorOfType(7),!n.goToPreviousSibling()&&(n.returnToAncestorOfType(23),!n.goToPreviousSibling())},e.prototype.redrawPageEnds=function(t){if(this._pageEndsCurrent)if(t.get_anchor()&&t.get_containingGraph()){var n=e.NavigateToContainingOutlineGroup(t);n&&(this._renderPageEndsForOutlineGroupTask&&this._renderPageEndsForOutlineGroupTask.customData&&this._renderPageEndsForOutlineGroupTask.customData.get_id()===n.get_id()||(this._renderPageEndsForOutlineGroupTask=(0,we.m)(new z.c(3,1,500,i.i(this,this.RedrawPageEndsForOutlineGroup,"RedrawPageEndsForOutlineGroup"),0,null,!1),{customData:n}),this._taskManager.addTask(this._renderPageEndsForOutlineGroupTask)))}else ne.ULS.sendTraceTag(6607198,336,10,"PageEndMarkers: Invalid node while redrawing page ends for outline group")},e.prototype.RedrawPageEndsForOutlineGroup=function(e){if(e===this._renderPageEndsForOutlineGroupTask&&(this._renderPageEndsForOutlineGroupTask=null),this._pageEndsCurrent){var t=e.customData,n=this._outlineGroupsWithPageEndDetails.get(t.get_id());if(n){this._outlineGroupsWithPageEndDetails.set_item(t.get_id(),new te.c(qe)),ne.ULS.sendTraceTag(6558539,336,50,"PageEndMarkers: Redraw page ends for Outline Group [Count: {0}] [Outline group: {1}]",n.get_count(),t.get_id()),this._pageAdornmentManager&&this._pageAdornmentManager.computeContent();for(var r=0;r<n.get_count();r++){var i=n.get_item(r),o=i.pageEnd;if(!o.HardBreak){var a=i.pageEndDomElement;Ie.s.removeElement(a),this.RenderPageEndMarkerAndFullPageHeight(o)}}}}},e.prototype.redrawAllPageEnds=function(){this._pageEndsCurrent&&!this._renderAllPageEndsTask&&this._pageEnds&&this._pageEnds.get_count()>0&&(this._renderAllPageEndsTask=new z.c(3,1,500,i.i(this,this.RedrawAllPageEndsInDocument,"RedrawAllPageEndsInDocument"),0,null,!1),this._taskManager.addTask(this._renderAllPageEndsTask))},e.prototype.RedrawAllPageEndsInDocument=function(e){this._renderAllPageEndsTask=null,this._pageEndsCurrent&&this._pageEnds&&this._pageEnds.get_count()>0&&(ne.ULS.sendTraceTag(6579856,336,50,"PageEndMarkers: Redraw all page ends in the document"),this.updateMarkers(this._pageEnds.toArray(),this._pageEndsCurrent))},e.prototype.dispose=function(){this.get_pageView()&&(this.get_pageView().remove_onAfterValidateEvent(i.i(this,this.PageViewOnAfterValidateEvent,"PageViewOnAfterValidateEvent")),this.get_pageView().remove_onViewElementCreatedEvent(i.i(this,this.PageViewOnViewElementCreatedEvent,"PageViewOnViewElementCreatedEvent")),this.get_pageView().remove_onInteractiveViewResize(i.i(this,this.redrawAllPageEnds,"redrawAllPageEnds"))),this._contentEditableViewEventSource.remove_onContentDirtied(i.i(this,this.OnContentDirtied,"OnContentDirtied"))},e.get_TrackChangeIsEnabled=function(){return W.App.get_wordEditorTrackChangeFeatureIsEnabledForModel()},e.get_WordEditorCommentImprovementIsEnabled=function(){return P.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorCommentImprovementIsEnabled")},e.get_ImageOverflowUpdateHeightIsEnabled=function(){return null==e._imageOverflowUpdateHeightIsEnabled&&(e._imageOverflowUpdateHeightIsEnabled=P.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ImageOverflowUpdateHeightIsEnabled")),e._imageOverflowUpdateHeightIsEnabled},e.getHalfLeadingVerticalSpace=function(t){var n=0;try{var r=t.get_htmlElement(),i=r.firstChild,o=Ie.s.parseCssSize(i.style.marginTop),a=0,s=r.parentNode,l=e.GetPreviousOutlineElement(s);if(l){var u=l.firstChild;if(u&&Sys.UI.DomElement.containsCssClass(u,"ParaWrappingDiv")){var c=u.firstChild;a=Ie.s.parseCssSize(c.style.marginBottom)}}n=Math.max(o,a)/2}catch(e){}return n},e.GetPreviousOutlineElement=function(t){var n=t.previousSibling;if(!n){var r=t.parentNode;if(Ie.s.isListTag(r))if(e.get_TrackChangeIsEnabled()||e.get_WordEditorCommentImprovementIsEnabled()){var i=r.parentNode;i&&(n=i.previousSibling)}else n=r.previousSibling}if(!n){var o=t.parentNode;Sys.UI.DomElement.containsCssClass(o,Ve.g.outlineGroupClassName)||ne.ULS.sendTraceTag(19711369,314,15,"Expected OutlineGroup but encountered a {0} element with classname {1}.",o.tagName,o.className);var a=o.previousSibling;if(a&&a.hasChildNodes()){n=a.lastChild;do{if(Sys.UI.DomElement.containsCssClass(n,"OutlineElement")||Ie.s.isListTag(n)||(e.get_TrackChangeIsEnabled()||e.get_WordEditorCommentImprovementIsEnabled())&&Sys.UI.DomElement.containsCssClass(n,We.n.listContainerWrapperClassName))break;n=n.previousSibling}while(n)}}if(n){if((e.get_TrackChangeIsEnabled()||e.get_WordEditorCommentImprovementIsEnabled())&&Sys.UI.DomElement.containsCssClass(n,We.n.listContainerWrapperClassName))return n.lastChild.lastChild;if(Ie.s.isListTag(n))return n.lastChild}return n},e.NavigateToContainingOutlineGroup=function(e){var t=J.g.createFromNode(e);return t.tryToRootAtAncestorOfType(23)?t.returnToAncestorOfType(23):null},e.PageContentSizeChangeThreshold=1,e._pageEndDomHelper=null,e._imageOverflowUpdateHeightIsEnabled=null,e}();(0,i.l)(ze,"28bffe5$PageEndMarkers",null,[u,v.x,Sys.IDisposable]);var Ke=n(3626),Qe=function(){function e(e,t,n){this._lazyPageView=null,this._zoomManager=null,this._pageEndDomHelper=null,this.OutlineElementClassName=".Outline",this._lazyPageView=e,this._zoomManager=t,this._pageEndDomHelper=n}return e.prototype.get_PageView=function(){var e=this._lazyPageView.get_value();return ne.ULS.shipAssertTag(38416594,336,e.get_isPageView(),"Invalid PageView."),e},e.prototype.getContainingOutlineDom=function(e){var t;return(t=e.outlineNode)?this.getOutlineDOMFromNode(t):(ne.ULS.shipAssertTag(38336522,336,!0,"Error getting last Outline DOM."),null)},e.prototype.getOutlineDOMFromNode=function(e){var t,n;return(t=e.getHtmlViewElement(this.get_PageView().get_viewId()))&&(n=t.get_htmlElement())?n.querySelector(this.OutlineElementClassName):(ne.ULS.shipAssertTag(39662425,336,!0,"Error getting last Outline DOM."),null)},e.prototype.getContainingOutlineWrapperElementDom=function(e){var t,n=Ke.OutlineElementNavigator.getContainingOutlineElementNode(e.paragraphNode);return n&&(t=n.getHtmlViewElement(this.get_PageView().get_viewId()))?t.get_displayWrapperDiv():(ne.ULS.shipAssertTag(38336525,336,!0,"Error calculating containing OE DOM."),null)},e.prototype.calculateContentHeight=function(e,t){var n=this.GetWhiteSpace(e);return this.CalculatePageHeightInDom(e,t)-n},e.prototype.getDocumentPageSize=function(e){return this.getOutlinePageSize(e.outlineNode,e.pageNumber)},e.prototype.getOutlinePageSize=function(e,t){if(!e)return-1;var n=e.getValueWithDefault(Number,he.j.pageHeight,-1),r=le.j.twipsToPixels(n,1,!0),i=e.getValueWithDefault(Number,he.j.marginTop,-1),o=le.j.twipsToPixels(i,1,!0),a=e.getValueWithDefault(Number,he.j.marginBottom,-1),s=le.j.twipsToPixels(a,1,!0);return 1===t?r-s:r-(o+s)},e.prototype.deletePageEndDetailsDomElement=function(e){if(e){var t=e.pageEndDomElement;Ie.s.removeElement(t)}},e.prototype.getPositionInOutline=function(e){if(e.isTopOfDocument||e.isSectionBreak)return 0;if(e.isLastPage){var t=this.getContainingOutlineDom(e);return K.g.getElementBounds(t).height/this._zoomManager.get_currentZoom()}var n=this.getContainingOutlineDom(e),r=this.GetPageEndDomElement(e);return this._pageEndDomHelper.calculatePageEndMarkerTopRelativeToOutline(r,n)},e.prototype.createClientOnlyPageEndMarkerDomElement=function(e,t,n){var r=n.getHtmlViewElement(this.get_PageView().get_viewId()).getBounds(),i=e.getHtmlViewElement(this.get_PageView().get_viewId()),o=i.getBounds(),a=t,s=r;r.y=o.y,a*=this._zoomManager.get_currentZoom();var l=this._pageEndDomHelper.getDomElementForPageEndOutline(0,a,!1,s,r,o);return i.get_displayWrapperDiv().appendChild(l),l},e.prototype.insertWhiteSpace=function(e,t){if(e&&!e.isPlaceHolder)if(e.isLastPage)this.getContainingOutlineDom(e).style.paddingBottom=t+"px";else if(e.pageEnd&&e.pageEnd.HardBreak){if(e.isSectionBreak){var n=this.GetPreviousOutlineDom(e);return void(n&&(n.style.paddingBottom=t+"px"))}var r=this.getContainingOutlineWrapperElementDom(e);r&&(r.style.paddingTop=t+"px")}else ne.ULS.shipAssertTag(39077394,336,!1,"Applying blank space on a page which is not hard break or last page.")},e.prototype.adjustForSectionBreakDelta=function(e,t){var n=this.getContainingOutlineDom(t),r=this.getContainingOutlineDom(e);return K.g.getBoundingTop(n)-K.g.getBoundingTop(r)},e.prototype.getPreviousOutlineNode=function(e){var t=J.g.createFromNode(e.outlineNode);return t.tryToRootAtAncestorOfType(7),t.goToPreviousSibling()},e.prototype.isPageEndDetailsRendered=function(e){if(!e||e.isPlaceHolder)return!1;if(e.isLastPage||e.isTopOfDocument)return!0;var t=this.GetPageEndDomElement(e);return!!t&&Ie.s.elementAttached(t)},e.prototype.logToBrowserConsole=function(e){this._pageEndDomHelper.logToBrowserConsole(e)},e.prototype.GetPreviousOutlineDom=function(e){var t=this.getPreviousOutlineNode(e);if(t){var n=t.getViewElement(this.get_PageView().get_viewId()).get_htmlElement();return n||(ne.ULS.shipAssertTag(39126080,336,!0,"Section dom is null."),null)}return null},e.prototype.GetPageEndDomElement=function(e){return e.pageEnd&&e.pageEnd.HardBreak&&!e.isSectionBreak?this._pageEndDomHelper.getPageBreakBorderSpan(e.pageEndDomElement):e.pageEndDomElement},e.prototype.GetWhiteSpace=function(e){if(e.isLastPage){var t=this.getContainingOutlineDom(e);return t?Ie.s.getPixelSize(t.style.paddingBottom):(ne.ULS.shipAssertTag(38336528,336,!0,"Last outline dom is null."),-1)}if(e.pageEnd&&e.pageEnd.HardBreak){if(e.isSectionBreak){var n=this.GetPreviousOutlineDom(e);return n?Ie.s.getPixelSize(n.style.paddingBottom):-1}var r=this.getContainingOutlineWrapperElementDom(e);return r?Ie.s.getPixelSize(r.style.paddingTop):(ne.ULS.shipAssertTag(38336529,336,!0,"Containing outline element Dom is null."),-1)}return 0},e.prototype.CalculatePageHeightInDom=function(e,t){return this.getPositionInOutline(e)-t},e}();(0,i.l)(Qe,"cc5bb497$PageFullHeightDOMHelper",null,[]);var Ze=function(){return function(){this.pageCount=0,this.whiteSpaceHeight=0,this.delta=0,this.pageEndDetail=null,this.prevPagePositionInOutline=0,this.expectedPageHeight=0,this.outlineGroupNode=null,this.contentHeight=0,this.insertedPages=new te.c(qe),this.deletedPages=new te.c(qe),this.newPositions=new te.c(Number)}}();(0,i.l)(Ze,"e203af39$PageFullHeightInfo",null,[]);var Je=function(){function e(e,t){this._pageHeightStorage=null,this._pageFullHeightDomHelper=null,this._pageHeightStorage=e,this._pageFullHeightDomHelper=t}return e.prototype.calculatePageFullHeightInfo=function(e,t){try{return this.CalculatePageFullHeightInfoInternal(e,t)}catch(e){return this._pageFullHeightDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38416595,336,10,"Exception caught in CalculatePageFullHeightInfo. Exception: {0}",e.message),null}},e.prototype.CalculatePageFullHeightInfoInternal=function(e,t){ne.ULS.shipAssertTag(38416596,336,e.isLastPage||e.pageEnd.HardBreak,null);var n=this._pageFullHeightDomHelper.getPositionInOutline(e),r=this._pageFullHeightDomHelper.calculateContentHeight(e,t),i=this._pageHeightStorage.calculateAndStorePageHeightIfNeeded(e,r),o=(0,we.m)(new Ze,{contentHeight:r,expectedPageHeight:i,pageEndDetail:e});this.UpdateInfoForInsertOrDeletePages(o),o.whiteSpaceHeight=o.expectedPageHeight-o.contentHeight;var a=t+i+o.delta;return o.delta=a-n,o},e.prototype.UpdateInfoForInsertOrDeletePages=function(e){e.contentHeight>e.expectedPageHeight?this.UpdateInfoForInsertPages(e):e.contentHeight<0&&this.UpdateInfoForDeletePages(e)},e.prototype.UpdateInfoForDeletePages=function(e){for(var t=e.pageEndDetail.pageNumber;e.contentHeight<0;)e.pageCount--,e.delta-=this._pageHeightStorage.getExpectedPageHeight(t),e.contentHeight+=this._pageHeightStorage.getExpectedPageHeight(t-1),t--;e.expectedPageHeight=this._pageHeightStorage.getExpectedPageHeight(t)},e.prototype.UpdateInfoForInsertPages=function(e){var t=this._pageFullHeightDomHelper.getDocumentPageSize(e.pageEndDetail);e.pageCount=Math.floor((e.contentHeight-e.expectedPageHeight)/t)+1,e.delta=e.pageCount*t,e.contentHeight-=e.expectedPageHeight+(e.pageCount-1)*t,e.expectedPageHeight=t},e}();(0,i.l)(Je,"3dec16c5$PageFullHeightInfoCalculator",null,[]);var Xe=(0,i.y)("55793e8d$IPageFullHeightManager"),Ye=function(){function e(e,t,n,r){this._pageHeightStorage=null,this._pageFullHeightRenderer=null,this._wordSectionNavigator=null,this._pageFullHeightDomHelper=null,this._totalPageCount=0,this._renderedPages=null,this._waitingForPreviousPage=null,this._pageHeightStorage=e,this._pageFullHeightRenderer=t,this._wordSectionNavigator=n,this._pageFullHeightDomHelper=r,this._renderedPages=new te.c(qe)}return e.prototype.get_renderedPages=function(){return this._renderedPages},e.prototype.handlePageFullHeight=function(e){try{this.HandlePageFullHeightInternal(e)}catch(e){this._pageFullHeightDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38148114,336,10,"Exception caught in HandlePageFullHeight. Exception: {0}",e.message)}},e.prototype.reset=function(e){try{this.ResetInternal(e)}catch(e){this._pageFullHeightDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38637723,336,10,"Exception caught in PageFullHeightManager.Reset. Exception: {0}",e.message)}},e.prototype.hidePageFullHeights=function(){try{this.HidePageFullHeightsInternal()}catch(e){this._pageFullHeightDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(39153856,336,10,"Exception caught in PageFullHeightManager.HidePageFullHeights. Exception: {0}",e.message)}},e.prototype.insertOrDeleteRenderedPages=function(e){try{this.InsertOrDeleteRenderedPagesInternal(e)}catch(e){this._pageFullHeightDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38916954,336,10,"Exception caught in PageFullHeightManager.InsertOrDeleteRenderedPages. Exception: {0}",e.message)}},e.prototype.removePageEndDetails=function(e){try{this.RemovePageEndDetailsInternal(e)}catch(e){this._pageFullHeightDomHelper.logToBrowserConsole("Pagination: "+e.message+" "+e.stack),ne.ULS.sendTraceTag(39387716,336,10,"Exception caught in PageFullHeightManager.RemovePageEndDetails. Exception: {0}",e.message)}},e.prototype.InitializeFirstAndLastPageEndDetails=function(){var e=this._wordSectionNavigator.getFirstOutline(),t=this._wordSectionNavigator.getLastOutline(),n=qe.createInstanceForTopOfDocument(e),r=qe.createInstanceForLastPage(this._totalPageCount,t);this._renderedPages.set_item(0,n),this.HandlePageFullHeightInternal(r)},e.prototype.ResetLastSectionMinHieght=function(){var e=$.d.get_instance().getLastOutline(),t=this._pageFullHeightDomHelper.getOutlineDOMFromNode(e).parentNode;t&&""!==t.style.minHeight&&(t.style.minHeight="")},e.prototype.InitializeRenderedPages=function(e){this._renderedPages=new te.c(qe),this._renderedPages.add(null);for(var t=0;t<e.length;t++){var n=t+1,r=qe.createPlaceHolder(n,e[t]);this._renderedPages.add(r)}this._renderedPages.add(qe.createPlaceHolder(e.length+1,null))},e.prototype.InitializePageHeights=function(e){this._pageHeightStorage.resetPageHeights(e)},e.prototype.ResetWhiteSpacesInDom=function(){if(this._renderedPages)for(var e=this._renderedPages.$$lge();e.$$mn();){var t=e.$$cu();t&&this.IsHardBreakOrLastPage(t)&&this._pageFullHeightDomHelper.insertWhiteSpace(t,0)}},e.prototype.HandlePageFullHeightInternal=function(e){this.VerifyPageEndDetails(e);var t=this.GetPreviousPageEndDetail(e);if(this._pageFullHeightDomHelper.isPageEndDetailsRendered(t)){var n=this._pageFullHeightDomHelper.getPositionInOutline(t);e.outlineNode!==t.outlineNode&&(n+=this._pageFullHeightDomHelper.adjustForSectionBreakDelta(e,t)),this.CalculateAndStorePageHeight(e,n),this.IsHardBreakOrLastPage(e)&&this.RenderPageFullHeight(e,n)}else this._waitingForPreviousPage.add(e),this._waitingForPreviousPage.get_count()>20&&ne.ULS.sendTraceTag(39982428,336,15,"Count of _waitingForPreviousPage is "+this._waitingForPreviousPage.get_count());this._renderedPages.set_item(e.pageNumber,e),this.HandleNextPageFullHeightIfNeeded(e)},e.prototype.VerifyPageEndDetails=function(e){if(e)e.pageNumber},e.prototype.HidePageFullHeightsInternal=function(){this.ResetWhiteSpacesInDom()},e.prototype.ResetInternal=function(e){this._totalPageCount=e.length+1,this._waitingForPreviousPage=new te.c(qe),this.InitializeRenderedPages(e),this.InitializePageHeights(this._totalPageCount),this.InitializeFirstAndLastPageEndDetails(),this.ResetLastSectionMinHieght(),this.VerifyPageCollectionsConsistency()},e.prototype.InsertOrDeleteRenderedPagesInternal=function(e){this._pageHeightStorage.updatePageHeights(e);for(var t=e.$$lge();t.$$mn();){var n=t.$$cu();if(!n)return void ne.ULS.sendTraceTag(38916955,336,10,"info is null.");if(n.pageCount>0)for(var r=n.pageEndDetail.pageNumber,i=n.insertedPages.$$lge();i.$$mn();){var o=i.$$cu();this._renderedPages.insert(r,o),r++}else if(n.pageCount<0)for(var a=n.deletedPages.$$lge();a.$$mn();){o=a.$$cu();this._renderedPages.remove(o),this._waitingForPreviousPage.contains(o)&&this._waitingForPreviousPage.remove(o)}}this.RenumberPages(),this.VerifyPageCollectionsConsistency()},e.prototype.RemovePageEndDetailsInternal=function(e){var t=e.get_pageNumber();this._pageHeightStorage.removePageHeight(t),this._renderedPages.removeAt(t);for(var n=this._waitingForPreviousPage.$$lge();n.$$mn();){var r=n.$$cu();r.pageNumber===t&&this._waitingForPreviousPage.remove(r)}this.RenumberPages(),this.VerifyPageCollectionsConsistency()},e.prototype.CalculateAndStorePageHeight=function(e,t){var n=this._pageFullHeightDomHelper.calculateContentHeight(e,t);this._pageHeightStorage.calculateAndStorePageHeightIfNeeded(e,n)},e.prototype.RenderPageFullHeight=function(e,t){e.pageEnd&&e.pageEnd.HardBreak||this._pageFullHeightRenderer.renderPageFullHeight(e,t)},e.prototype.HandleNextPageFullHeightIfNeeded=function(e){for(var t=e.pageNumber+1,n=this._waitingForPreviousPage.$$lge();n.$$mn();){var r=n.$$cu();if(r&&r.pageNumber===t)return this.HandlePageFullHeightInternal(r),void this._waitingForPreviousPage.remove(r)}},e.prototype.RenumberPages=function(){for(var e=0;e<this._renderedPages.get_count();e++){var t=this._renderedPages.get_item(e);if(t){var n=e;t.setPageNumber(n)}}},e.prototype.IsHardBreakOrLastPage=function(e){var t=this.GetPageBreakType(e);return 2===t||1===t},e.prototype.GetPreviousPageEndDetail=function(e){var t=e.pageNumber-1;return this._renderedPages.get_item(t)},e.prototype.GetPageBreakType=function(e){return e.isLastPage?2:e.pageEnd&&e.pageEnd.HardBreak?1:0},e.prototype.VerifyPageCollectionsConsistency=function(){},e}();(0,i.l)(Ye,"70323ae4$PageFullHeightManager",null,[Xe]);var et=function(){function e(e,t,n,r){this._pageFullHeightRenderer=null,this._pageHeightStorage=null,this._wordSectionNavigator=null,this._pageFullHeightDomHelper=null,this._pageFullHeightRenderer=e,this._pageHeightStorage=t,this._wordSectionNavigator=n,this._pageFullHeightDomHelper=r}return e.prototype.create=function(){return new Ye(this._pageHeightStorage,this._pageFullHeightRenderer,this._wordSectionNavigator,this._pageFullHeightDomHelper)},e}();(0,i.l)(et,"10d2c010$PageFullHeightManagerFactory",null,[]);var tt=(0,i.y)("306ab524$IPageFullHeightPositionUpdater"),nt=n(1525),rt=n(2305),it=function(){function e(e,t,n,r,i){this._pageFullHeightManager=null,this._pageEndMarkerPositionUpdater=null,this._pageFullHeightInfoCalculator=null,this._pageFullHeightRenderer=null,this._pageFullHeightDomHelper=null,this._pageFullHeightInfosToRestore=null,this._pageFullHeightManager=e,this._pageEndMarkerPositionUpdater=t,this._pageFullHeightInfoCalculator=n,this._pageFullHeightRenderer=r,this._pageFullHeightDomHelper=i}return e.prototype.reset=function(){this._pageFullHeightInfosToRestore=new te.c(Ze)},e.prototype.calculatePageFullHeight=function(e,t,n){try{return this.CalculatePageFullHeightInternal(e,t,n)}catch(e){return ne.ULS.sendTraceTag(38897350,336,10,"Exception caught in PageFullHeightPositionUpdater.CalculatePageFullHeight. Exception: {0}",e.message),null}},e.prototype.restorePageFullHeights=function(){try{this.RestorePageFullHeightsInternal()}catch(e){ne.ULS.sendTraceTag(38897351,336,10,"Exception caught in PageFullHeightPositionUpdater.RestorePageFullHeights. Exception: {0}",e.message)}},e.prototype.CalculatePageFullHeightInternal=function(t,n,r){if(!this._pageFullHeightManager.get_renderedPages().get_count())return null;var i=!t,o=this.GetPageEndDetail(t,i);if(!o||o.isPlaceHolder)return ne.ULS.sendTraceTag(38897352,336,10,"PageEndDetail is null for the given PageEndMarker"),null;if(o.pageEnd&&o.pageEnd.HardBreak)return null;var a=this._pageFullHeightManager.get_renderedPages().get_item(o.pageNumber-1);if(this._pageFullHeightDomHelper.isPageEndDetailsRendered(a)){var s=n-r;o.outlineNode!==a.outlineNode&&(s+=this._pageFullHeightDomHelper.adjustForSectionBreakDelta(o,a));var l=this._pageFullHeightInfoCalculator.calculatePageFullHeightInfo(o,s);if(l&&Math.abs(l.delta)>e.MinDelta)return l.prevPagePositionInOutline=s,l.outlineGroupNode=this.GetOutlineGroupNode(t,o),this._pageFullHeightInfosToRestore.add(l),this.UpdateInfoForDeletePages(l),l}return null},e.prototype.GetOutlineGroupNode=function(e,t){if(t&&t.isLastPage){var n=t.outlineNode,r=(0,Le.e)(rt.ParagraphNode,Z.ParagraphReader.getLastParagraphUnderNode(n,!0,!1)),i=J.g.createFromNode(r);i.tryToRootAtPageContent();var o=(0,Le.e)(nt.m,i.returnToAncestorOfType(23));return o}return e&&e.get_isHardBreak()?e.get_outlineGroupNode():null},e.prototype.RestorePageFullHeightsInternal=function(){this._pageFullHeightInfosToRestore.Sc((function(e,t){return t.pageEndDetail.pageNumber-e.pageEndDetail.pageNumber}));for(var e=this._pageFullHeightInfosToRestore.$$lge();e.$$mn();){var t=e.$$cu();this._pageFullHeightRenderer.renderPageFullHeightInfo(t)}this.UpdatePagesForInsertOrDelete()},e.prototype.UpdatePagesForInsertOrDelete=function(){this._pageEndMarkerPositionUpdater.get_value().insertOrDeleteRenderedMarkers(this._pageFullHeightInfosToRestore),this._pageFullHeightManager.insertOrDeleteRenderedPages(this._pageFullHeightInfosToRestore)},e.prototype.GetPageEndDetail=function(e,t){if(t)return this._pageFullHeightManager.get_renderedPages().get_item(this._pageFullHeightManager.get_renderedPages().get_count()-1);var n=e.get_pageNumber();return this._pageFullHeightManager.get_renderedPages().get_item(n)},e.prototype.UpdateInfoForDeletePages=function(e){for(var t=e.pageEndDetail.pageNumber,n=-e.pageCount,r=0;r<n;r++)t--,e.deletedPages.add(this._pageFullHeightManager.get_renderedPages().get_item(t))},e.MinDelta=1,e}();(0,i.l)(it,"f4e26fad$PageFullHeightPositionUpdater",null,[tt]);var ot=function(){function e(e,t,n,r,i){this._pageFullHeightManager=null,this._pageEndMarkerPositionUpdater=null,this._pageFullHeightInfoCalculator=null,this._pageFullHeightRenderer=null,this._pageFullHeightDomHelper=null,this._pageFullHeightManager=e,this._pageEndMarkerPositionUpdater=t,this._pageFullHeightInfoCalculator=n,this._pageFullHeightRenderer=r,this._pageFullHeightDomHelper=i}return e.prototype.create=function(){return new it(this._pageFullHeightManager,this._pageEndMarkerPositionUpdater,this._pageFullHeightInfoCalculator,this._pageFullHeightRenderer,this._pageFullHeightDomHelper)},e}();(0,i.l)(ot,"a30da619$PageFullHeightPositionUpdaterFactory",null,[]);var at=function(){function e(e,t){this._pageFullHeightDomHelper=null,this._pageFullHeightInfoCalculator=null,this._pageFullHeightDomHelper=e,this._pageFullHeightInfoCalculator=t}return e.prototype.renderPageFullHeight=function(e,t){try{this.RenderPageFullHeightInternal(e,t)}catch(e){this._pageFullHeightDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38285912,336,10,"Exception caught in RenderPageFullHeight. Exception: {0}",e.message)}},e.prototype.renderPageFullHeightInfo=function(e){try{this.RenderPageFullHeightInfoInternal(e)}catch(e){this._pageFullHeightDomHelper.logToBrowserConsole(e.message+" "+e.stack),ne.ULS.sendTraceTag(38855577,336,10,"Exception caught in RenderPageFullHeightInfo. Exception: {0}",e.message)}},e.prototype.RenderPageFullHeightInternal=function(e,t){ne.ULS.shipAssertTag(38285913,336,e.isLastPage||e.pageEnd.HardBreak,null);var n=this._pageFullHeightInfoCalculator.calculatePageFullHeightInfo(e,t);this.renderPageFullHeightInfo(n)},e.prototype.RenderPageFullHeightInfoInternal=function(e){this.RenderPageFullHeightInDom(e),this.RenderInsertedOrDeletedPages(e)},e.prototype.RenderInsertedOrDeletedPages=function(e){e.pageCount>0?this.InsertPageEndDetailsInDom(e):e.pageCount<0&&this.DeletePageEndDetailsFromDom(e)},e.prototype.RenderPageFullHeightInDom=function(e){var t=e.pageEndDetail,n=e.whiteSpaceHeight;this._pageFullHeightDomHelper.insertWhiteSpace(t,n)},e.prototype.InsertPageEndDetailsInDom=function(e){for(var t=e.prevPagePositionInOutline+e.expectedPageHeight,n=0;n<e.pageCount;n++){var r=e.pageEndDetail.pageNumber+n,i=e.pageEndDetail.isSectionBreak?this._pageFullHeightDomHelper.getPreviousOutlineNode(e.pageEndDetail):e.pageEndDetail.outlineNode,o=e.outlineGroupNode,a=this.CreateClientOnlyPageEndDetails(i,o,t,r);e.insertedPages.add(a),e.newPositions.add(t),t+=e.expectedPageHeight}},e.prototype.DeletePageEndDetailsFromDom=function(e){for(var t=e.deletedPages.$$lge();t.$$mn();){var n=t.$$cu();this._pageFullHeightDomHelper.deletePageEndDetailsDomElement(n)}},e.prototype.CreateClientOnlyPageEndDetails=function(e,t,n,r){var i=this._pageFullHeightDomHelper.createClientOnlyPageEndMarkerDomElement(e,n,t);return qe.createClientOnly(n,r,i,e,!1,!1)},e}();(0,i.l)(at,"9304ccca$PageFullHeightRenderer",null,[]);var st=n(9713),lt=(0,i.y)("7fc9e931$IFidelityMetricResult"),ut=function(){function e(e){this.$$pf_RawScore=0,this.set_rawScore(e)}return e.prototype.get_rawScore=function(){return this.$$pf_RawScore},e.prototype.set_rawScore=function(e){return this.$$pf_RawScore=e,e},e}();(0,i.l)(ut,"6b86aa15$PageHeightDeltaResult",null,[lt]);var ct=function(){function e(e,t,n,r){var i=this;this._pageFullHeightDomHelper=null,this._stopwatchBuilder=null,this._fidelityMetricResult=null,this._isEnabled=!1,this._pageFullHeightDomHelper=t,this._stopwatchBuilder=n,this._isEnabled=e.getBooleanAppSetting("WordEditorFidelityPageHeightDeltaIsEnabled"),r.execute((function(e){e.register(i)}))}return e.prototype.get_metricName=function(){return e.METRIC_NAME},e.prototype.get_result=function(){return this._fidelityMetricResult},e.prototype.get_normalizationStrategy=function(){return 1},e.prototype.get_scoreThreshold=function(){return e.SCORE_THRESHOLD},e.prototype.get_isEnabled=function(){return this._isEnabled},e.prototype.notifyDataRead=function(){this._fidelityMetricResult=null},e.prototype.calculate=function(e){try{var t=this._stopwatchBuilder.makeAndStartStopwatch("Task","Calculate");this.CalculateInternal(e),t.stop(),ne.ULS.sendTraceTag(39188044,336,50,"PageHeightDeltaMetric.Calculate stopwatch stopped: {0}",t.get_ageInMilliseconds())}catch(e){ne.ULS.sendTraceTag(39188045,324,10,"Exception caught in PageHeightDeltaMetric.Calculate. Exception: {0}",e.message)}},e.prototype.CalculateInternal=function(t){this._fidelityMetricResult=null;var n=this.CalculateRawScore(t);n!==e.INVALID_RESULT&&(this._fidelityMetricResult=new ut(n))},e.prototype.CalculateRawScore=function(t){if(!t.get_count())return e.INVALID_RESULT;for(var n=0,r=0,i=t.$$lge();i.$$mn();){var o=i.$$cu(),a=this.CalculatePageHeightDelta(o);a!==e.INVALID_RESULT&&(n+=a,r++)}return r?n/r:e.INVALID_RESULT},e.prototype.CalculatePageHeightDelta=function(t){if(!t.get_isExactPage())return e.INVALID_RESULT;var n=this._pageFullHeightDomHelper.getOutlinePageSize(t.get_bottomOutlineNode(),t.get_pageNumber());if(-1===n)return e.INVALID_RESULT;var r=t.get_height();return Math.abs(r-n)},e.INVALID_RESULT=-1,e.METRIC_NAME="PageHeightDelta",e.SCORE_THRESHOLD=500,e}();(0,i.l)(ct,"72715ed8$PageHeightDeltaMetric",null,[st.a]);var dt=function(){function e(e){this._pageFullHeightDomHelper=null,this._expectedPageHeights=null,this._pageFullHeightDomHelper=e}return e.prototype.getExpectedPageHeight=function(e){return this._expectedPageHeights.get_item(e-1)},e.prototype.resetPageHeights=function(t){this._expectedPageHeights=new te.c(Number);for(var n=0;n<t;n++)this._expectedPageHeights.add(e.NonRenderedPageHeight)},e.prototype.calculateAndStorePageHeightIfNeeded=function(e,t){if(this.IsPageHeightStoredAlready(e))return this._expectedPageHeights.get_item(e.pageNumber-1);var n=this.CalculateExpectedPageHeight(e,t);return this.storePageHeight(e,n),n},e.prototype.updatePageHeights=function(e){for(var t=e.$$lge();t.$$mn();){var n=t.$$cu();this.UpdatePageHeightInfo(n)}},e.prototype.storePageHeight=function(e,t){this._expectedPageHeights.set_item(e.pageNumber-1,t)},e.prototype.removePageHeight=function(e){this._expectedPageHeights.removeAt(e-1)},e.prototype.UpdatePageHeightInfo=function(e){if(e)if(e.pageCount>0)for(var t=e.pageEndDetail.pageNumber,n=0;n<e.pageCount;n++)this._expectedPageHeights.insert(t,e.expectedPageHeight);else if(e.pageCount<0){var r=-e.pageCount;for(t=e.pageEndDetail.pageNumber-r,n=0;n<r;n++)this._expectedPageHeights.removeAt(t)}},e.prototype.IsPageHeightStoredAlready=function(t){return this._expectedPageHeights.get_item(t.pageNumber-1)!==e.NonRenderedPageHeight},e.prototype.CalculateExpectedPageHeight=function(e,t){var n;if(e.isLastPage||e.pageEnd.HardBreak){var r=this._pageFullHeightDomHelper.getDocumentPageSize(e);n=t<r?r:t}else n=t;return n},e.NonRenderedPageHeight=-1,e}();(0,i.l)(dt,"9283fedd$PageHeightStorage",null,[]);var pt=function(){function e(e){this.$$pf_RawScore=0,this.set_rawScore(e)}return e.prototype.get_rawScore=function(){return this.$$pf_RawScore},e.prototype.set_rawScore=function(e){return this.$$pf_RawScore=e,e},e}();(0,i.l)(pt,"d8541e3c$PageLevelDeltaResult",null,[lt]);var gt=function(){function e(e,t,n,r,i){var o=this;this._lazyPageView=null,this._textMetricsAdapter=null,this._stopwatchBuilder=null,this._fidelityMetricResult=null,this._isEnabled=!1,this._lazyPageView=t,this._textMetricsAdapter=n,this._stopwatchBuilder=r,this._isEnabled=e.getBooleanAppSetting("WordEditorFidelityPageLevelDeltaIsEnabled"),i.execute((function(e){e.register(o)}))}return e.prototype.get_pageView=function(){var e=this._lazyPageView.get_value();return ne.ULS.shipAssertTag(39081438,336,e.get_isPageView(),"PageLevelDeltaMetric.PageView is not a PageView."),e},e.prototype.get_metricName=function(){return e.METRIC_NAME},e.prototype.get_result=function(){return this._fidelityMetricResult},e.prototype.get_normalizationStrategy=function(){return 0},e.prototype.get_scoreThreshold=function(){return e.SCORE_THRESHOLD},e.prototype.get_isEnabled=function(){return this._isEnabled},e.prototype.notifyDataRead=function(){this._fidelityMetricResult=null},e.prototype.calculate=function(e){try{var t=this._stopwatchBuilder.makeAndStartStopwatch("Task","Calculate");this.CalculateInternal(e),t.stop(),ne.ULS.sendTraceTag(39081439,336,50,"PageLevelDeltaMetric.Calculate stopwatch stopped: {0}",t.get_ageInMilliseconds())}catch(e){ne.ULS.sendTraceTag(39081440,324,10,"Exception caught in PageLevelDeltaMetric.Calculate. Exception: {0}",e.message)}},e.prototype.CalculateInternal=function(t){this._fidelityMetricResult=null;var n=this.CalculateRawScore(t);n!==e.INVALID_RESULT&&(this._fidelityMetricResult=new pt(n))},e.prototype.CalculateRawScore=function(t){if(!t.get_count())return e.INVALID_RESULT;for(var n=0,r=0,i=t.$$lge();i.$$mn();){var o=i.$$cu(),a=this.CalculatePageLevelDelta(o);a!==e.INVALID_RESULT&&(n+=a,r++)}return r?n/r:e.INVALID_RESULT},e.prototype.CalculatePageLevelDelta=function(t){if(t.get_isHardBreak())return e.INVALID_RESULT;var n=t.get_pageEnd().CP,r=t.get_paragraphNode();ne.ULS.shipAssertTag(39081441,336,!!r,null);var o=r.getHtmlViewElement(this.get_pageView().get_viewId());ne.ULS.shipAssertTag(39081442,324,i.r(xe.e,o),null);var a,s,l,u,c,d=Ie.s.getElementText(o.get_htmlElement()).length;if(this.CalculateLineBoundaries(o,d,n,(0,fe.m)((function(){return l}),(function(e){return l=e})),(0,fe.m)((function(){return a}),(function(e){return a=e})),(0,fe.m)((function(){return u}),(function(e){return u=e})),(0,fe.m)((function(){return s}),(function(e){return s=e})),(0,fe.m)((function(){return c}),(function(e){return c=e}))),!u||!c)return ne.ULS.sendTraceTag(39081443,336,50,"There was a problem calculating the line boundaries in PageLevelDeltaMetric.CalculatePageLevelDelta."),e.INVALID_RESULT;var p=l.x-u.x,g=c.x-l.x;return Math.min(p,g)},e.prototype.CalculateLineBoundaries=function(e,t,n,r,i,o,a,s){if(i.val=a.val=n,r.val=o.val=s.val=null,n>t)ne.ULS.sendTraceTag(39081472,336,50,"cp > paragraph text length in FidelityTelemetryManager.CalculatePageLevelDelta.");else{r.val=this._textMetricsAdapter.boundsFromCp(e,n,!1,!1,!1,null);for(var l=0,u=n;l<=u;){var c=Math.floor((l+u)/2),d=this._textMetricsAdapter.boundsFromCp(e,c,!1,!1,!1,null);if(l===u){i.val=c,o.val=d;break}d.y+d.height<=r.val.y?l=c+1:u=c}for(var p=n,g=t;p<=g;){c=Math.ceil((p+g)/2),d=this._textMetricsAdapter.boundsFromCp(e,c,!1,!1,!1,null);if(p===g){a.val=c,s.val=d;break}d.y>=r.val.y+r.val.height?g=c-1:p=c}}},e.INVALID_RESULT=-1,e.METRIC_NAME="PageLevelDelta",e.SCORE_THRESHOLD=60,e}();(0,i.l)(gt,"4a059d11$PageLevelDeltaMetric",null,[st.a]);var ht=function(){function e(e,t,n,r,i,o,a){this.pageNumber=0,this.top=0,this.absoluteTop=0,this.height=0,this.topOutlineNode=null,this.bottomOutlineNode=null,this.isExactPage=!1,this.pageNumber=e,this.top=t,this.absoluteTop=n,this.height=r,this.topOutlineNode=i,this.bottomOutlineNode=o,this.isExactPage=a}return e.prototype.get_pageNumber=function(){return this.pageNumber},e.prototype.get_top=function(){return this.top},e.prototype.get_absoluteTop=function(){return this.absoluteTop},e.prototype.get_height=function(){return this.height},e.prototype.get_topOutlineNode=function(){return this.topOutlineNode},e.prototype.get_bottomOutlineNode=function(){return this.bottomOutlineNode},e.prototype.get_isExactPage=function(){return this.isExactPage},e}();(0,i.l)(ht,"609f2a9b$Page",null,[]);var _t=function(){function e(e,t,n,r,i){this._lazyPageView=null,this._documentSizeManager=null,this._pageElementManagerList=null,this._outlineManager=null,this._pageHeightDeltaMetric=null,this._outlineTopMap=null,this._swordMarkerCount=0,this._lazyPageView=e,this._documentSizeManager=t,this._pageElementManagerList=n,this._outlineManager=r,this._pageHeightDeltaMetric=i}return e.prototype.get_pageView=function(){var e=this._lazyPageView.get_value();return ne.ULS.shipAssertTag(37007393,336,e.get_isPageView(),"PageManager.PageView is not a PageView."),e},e.prototype.updatePageBoundaries=function(e){var t=this.ReconstructPages(e);this.UpdatePageElementManagers(t)},e.prototype.updatePageBoundariesOnSwordResponse=function(e,t){this._swordMarkerCount=t;var n=this.ReconstructPages(e);this.UpdatePageElementManagers(n),this._pageHeightDeltaMetric.get_isEnabled()&&this._pageHeightDeltaMetric.calculate(n)},e.prototype.ReconstructPages=function(t){var n=new te.c(ht);this._outlineTopMap=new Se.e(Ee.h,Number);var r=new te.c(ht);if(!t)return n;for(var i=0,o=null,a=0;a<t.get_count();a++){var s=t.get_item(a),l=s.get_pageNumber(),u=this.CreatePage(l,o,s);n.add(u),!e._negativePageHeightErrorLogged&&u.get_height()<0&&r.add(u),i=l,o=s}var c=this.CreatePage(i+1,o,null);n.add(c),!e._negativePageHeightErrorLogged&&c.get_height()<0&&r.add(c);for(var d=r.$$lge();d.$$mn();){u=d.$$cu();e._negativePageHeightErrorLogged=!0,ne.ULS.shipAssertTag(50968670,336,!1,"Page: height parameter value is negative for page "+u.get_pageNumber())}return n},e.prototype.CreatePage=function(e,t,n){var r,i=t?t.get_outlineNode():this._outlineManager.getFirstWordSection(),o=n?n.get_outlineNode():this._outlineManager.getLastWordSection(),a=this.GetOutlineTop(i),s=this.GetOutlineTop(o),l=t?this.CalculatePageBoundary(t):0,u=l+a,c=n?this.CalculatePageBoundary(n):this._documentSizeManager.getAbsoluteBottomOfDocument()-s;i.get_id()===o.get_id()?r=c-l:r=c+s-u;var d=t?t.get_pageNumber():0,p=n?n.get_pageNumber():this._swordMarkerCount+1;return new ht(e,l,u,r,i,o,p===d+1)},e.prototype.CalculatePageBoundary=function(e){return e.get_isSectionBreak()?0:e.get_top()},e.prototype.UpdatePageElementManagers=function(e){if(this._pageElementManagerList.get_pageElementManagers())for(var t=this._pageElementManagerList.get_pageElementManagers().$$lge();t.$$mn();){var n=t.$$cu();n&&n.updatePageElements(e)}},e.prototype.GetOutlineTop=function(e){if(this._outlineTopMap||(this._outlineTopMap=new Se.e(Ee.h,Number)),this._outlineTopMap.containsKey(e.get_id()))return this._outlineTopMap.get_item(e.get_id());var t=e.getHtmlViewElement(this.get_pageView().get_viewId());if(!t)return ne.ULS.sendTraceTag(37052758,336,15,"OutlineViewElement is null in PageManager.GetOutlineTop."),0;var n=t.get_htmlElement(),r=K.g.getRelativeLocation(this._documentSizeManager.get_pageContentContainer(),n).y;return this._outlineTopMap.set_item(e.get_id(),r),r},e._negativePageHeightErrorLogged=!1,e}();(0,i.l)(_t,"75c23508$PageManager",null,[p]);var ft=n(9643),mt=n(4178),yt=n(6363),vt=n(1751),St=function(){function e(e,t,n,r,i,o,a){this._statusBarUser=null,this._paginationReplicator=null,this._actionManager=null,this._lazyPageEndMarkers=null,this._currentPageManager=null,this._isCurrentPageBrsEnabled=!1,this._activeFrame=null,this._actionManager=e,this._statusBarUser=t,this._paginationReplicator=n,this._currentPageManager=r,this._lazyPageEndMarkers=i,this._isCurrentPageBrsEnabled=o,this._activeFrame=a}return e.prototype.get_PageEndMarkers=function(){return this._lazyPageEndMarkers.get_value()},e.prototype.get_wordEditorCurrentPageNumberIsEnabled=function(){return e.get_FeatureHelper().isFeatureEnabled(35)},e.prototype.registerActions=function(){this._actionManager.addActionWithFlags(me.u.queryTotalPageCount,vt.d.application,i.i(this,this.queryTotalPageCount,"queryTotalPageCount"),96),this._actionManager.addActionWithFlags(me.u.queryViewPageEnds,vt.d.application,i.i(this,this.queryViewPageEnds,"queryViewPageEnds"),96),this._actionManager.addActionWithFlags(me.u.toggleTotalPageCount,vt.d.application,i.i(this,this.toggleTotalPageCount,"toggleTotalPageCount"),8)},e.prototype.toggleTotalPageCount=function(e,t,n,r,i){return 1===n?32:(this._currentPageManager.get_isCurrentPageModeEnabled()?(this._currentPageManager.disableCurrentPageMode(),this.get_PageEndMarkers()&&this.get_PageEndMarkers().hidePageEnds()):(this._currentPageManager.enableCurrentPageMode(),this.get_PageEndMarkers()&&this.get_PageEndMarkers().showPageEnds()),this._activeFrame.updateCommandUI(!1),r.dataValue1=this._currentPageManager.get_isCurrentPageModeEnabled()?1:0,32)},e.prototype.queryTotalPageCount=function(e,t,n,r,i){if(1===n)return 32;var o,a=this._paginationReplicator.get_totalPageCount();if(-1===a)o="";else if(this._isCurrentPageBrsEnabled&&this._currentPageManager.get_isCurrentPageModeEnabled()){var s=this._currentPageManager.get_currentPage();o=String.format(WordEditorIntl.WordEditorStrings.l_CurrentPageAndCount,s,a)}else o=1===a?String.format(WordEditorIntl.WordEditorStrings.l_TotalPageCountSingular,a):String.format(WordEditorIntl.WordEditorStrings.l_TotalPageCount,a);var l=i;return this._isCurrentPageBrsEnabled?(l[ft.f.Visible]=!0,l[ft.f.LabelText]=o):(l[mt.i.Visible]=!0,l[mt.i.Value]=o),32},e.prototype.queryViewPageEnds=function(e,t,n,r,i){return 1===n?32:(i[yt.e.On]=this._currentPageManager.get_isCurrentPageModeEnabled(),32)},e.get_FeatureHelper=function(){return e._featureHelper||(e._featureHelper=D.w.get_instance().resolve(o.d))},e._featureHelper=null,e}();(0,i.l)(St,"4a8d08f$PaginationActor",null,[]);var It=function(){function e(e){this.$$pf_RawScore=0,this.set_rawScore(e)}return e.prototype.get_rawScore=function(){return this.$$pf_RawScore},e.prototype.set_rawScore=function(e){return this.$$pf_RawScore=e,e},e}();(0,i.l)(It,"25a8c6b5$PaginationDeltaResult",null,[lt]);var Ct=function(){function e(e,t,n){var r=this;this._stopwatchBuilder=null,this._fidelityMetricResult=null,this._isEnabled=!1,this._previousPageEndMarkersInViewport=null,this._stopwatchBuilder=t,this._isEnabled=e.getBooleanAppSetting("WordEditorFidelityPaginationDeltaIsEnabled"),n.execute((function(e){e.register(r)}))}return e.prototype.get_metricName=function(){return e.METRIC_NAME},e.prototype.get_result=function(){return this._fidelityMetricResult},e.prototype.get_normalizationStrategy=function(){return 1},e.prototype.get_scoreThreshold=function(){return e.SCORE_THRESHOLD},e.prototype.get_isEnabled=function(){return this._isEnabled},e.prototype.notifyDataRead=function(){this._fidelityMetricResult=null},e.prototype.calculate=function(e){try{var t=this._stopwatchBuilder.makeAndStartStopwatch("Task","Calculate");this.CalculateInternal(e),t.stop(),ne.ULS.sendTraceTag(39686614,336,50,"PaginationDeltaMetric.Calculate stopwatch stopped: {0}",t.get_ageInMilliseconds())}catch(e){ne.ULS.sendTraceTag(39686615,324,10,"Exception caught in PaginationDeltaMetric.Calculate. Exception: {0}",e.message)}},e.prototype.storePositions=function(e){this._previousPageEndMarkersInViewport=e},e.prototype.CalculateInternal=function(t){this._fidelityMetricResult=null;var n=this.CalculateRawScore(this._previousPageEndMarkersInViewport,t);n!==e.INVALID_RESULT&&(this._fidelityMetricResult=new It(n))},e.prototype.CalculateRawScore=function(t,n){if(!t||!n)return e.INVALID_RESULT;if(!t.get_count()||!n.get_count())return e.INVALID_RESULT;for(var r=new te.c(Number),i=t.$$lge();i.$$mn();){var o=i.$$cu();r.add(o.get_top())}for(var a=new te.c(Number),s=n.$$lge();s.$$mn();){var l=s.$$cu();a.add(l.get_top())}var u=this.FindShortestDistancePairs(r,a);return this.ComputeAverage(u)},e.prototype.ComputeAverage=function(e){if(!e.get_count())return 0;for(var t=0,n=0;n<e.get_count();n++)t+=e.get_item(n);return t/e.get_count()},e.prototype.FindShortestDistancePairs=function(e,t){var n=new te.c(Number);if(!e.get_count()||!t.get_count())return n;for(var r=e.get_count()<=t.get_count(),i=r?e:t,o=r?t:e,a=0;a<i.get_count();a++){for(var s=i.get_item(a),l=Math.abs(s-o.get_item(0)),u=0,c=1;c<o.get_count();c++){var d=o.get_item(c),p=Math.abs(s-d);p<l&&(l=p,u=c)}n.add(l),o.removeAt(u)}return n},e.INVALID_RESULT=-1,e.METRIC_NAME="PaginationDelta",e.SCORE_THRESHOLD=200,e}();(0,i.l)(Ct,"caad7e38$PaginationDeltaMetric",null,[st.a]);var Tt=n(906),bt=n(6853),At=n(2585),Mt=n(3190),Pt=n(1183),Ft=function(e){function t(){var t=e.call(this)||this;return t.FileId=null,t.LastKnownPaginationRevision=null,t}return(0,ie.t)(t,e),t.prototype.getClassId=function(){return 36},t.constructRequest=function(e,n){var r=new t;return r.FileId=e,r.LastKnownPaginationRevision=Pt.j.serialize(n),r},t}(Mt.b);(0,i.l)(Ft,"12f4a335$PaginationRequest",Mt.b,[]);var wt=n(4537),Rt=function(e){function t(n,r,o,a,s,l){var u=e.call(this)||this;return u._actionManager=null,u._graphSpaceReplicator=null,u._lazyPageEndMarkers=null,u._currentPageCalculator=null,u._replicationScheduler=null,u._lcLocationInfo=null,u._countOfFailedAttempts=0,u._latestClientRevision=null,u._latestPaginationRevision=null,u._graphSpaceListenerRegistered=!1,u._totalPageCount=-1,u._actionManager=n,u._lazyPageEndMarkers=r,u._currentPageCalculator=o,u._replicationScheduler=a,u._lcLocationInfo=l||wt.n.get_instance(),u._latestPaginationRevision=Ee.h.get_nil(),u._latestClientRevision=Ee.h.get_nil(),s.CWR(Function,(function(e){return s.get_result().add_onKickedOut(i.i(u,u.onKickedOut,"onKickedOut"))})),u.DisableReplication(),u.replicationTimer=new At.e(t.ReplicationInterval,null),u.replicationTimer.decreaseToMinSpeed(),u._replicationScheduler.register(u),u}return(0,ie.t)(t,e),t.prototype.get_nameForLogging=function(){return"Pagination"},t.prototype.get_PageEndMarkers=function(){return this._lazyPageEndMarkers.get_value()},t.prototype.get_CurrentPageCalculator=function(){return this._currentPageCalculator},t.prototype.get_totalPageCount=function(){return this._totalPageCount},t.prototype.set_totalPageCount=function(e){return this._totalPageCount!==e&&(this._totalPageCount=e,this._currentPageCalculator.updatePageNumber()),e},t.prototype.onKickedOut=function(e,t){ne.ULS.sendTraceTag(7422755,336,50,"PaginationReplicator: disabling replication as user kicked out"),this.DisableReplicationPermanently()},t.prototype.onGraphSpaceReplicatorAvailable=function(e){this._graphSpaceReplicator=e,this._graphSpaceReplicator.add_onAfterReplication(i.i(this,this.OnGraphSpaceReplication,"OnGraphSpaceReplication"));var t=this._graphSpaceReplicator.get_node();this.AddGraphSpaceListener(t)},t.prototype.OnGraphSpaceReplication=function(e,t){var n=this._graphSpaceReplicator.get_lastReplicated();Ee.h.areEqual(n,this._latestClientRevision)||(this._latestClientRevision=n,this.onLatestClientRevisionUpdated(this._latestPaginationRevision,this._latestClientRevision))},t.prototype.onLatestClientRevisionUpdated=function(e,t){Ee.h.areEqual(e,t)?(this.get_PageEndMarkers()&&this.get_PageEndMarkers().makePageEndsCurrent(),this.DisableReplication()):(this.get_PageEndMarkers()&&this.get_PageEndMarkers().makePageEndsStale(),this.StartReplicationImmediately())},t.prototype.EnableReplication=function(){this.set_enabled(2)},t.prototype.DisableReplication=function(){this.set_enabled(0)},t.prototype.StartReplicationImmediately=function(){this._countOfFailedAttempts=0,this.EnableReplication(),this.forceInbound(null,null,null)},t.prototype.hasChangesToInbound=function(){return!U.App.get_lostSession()&&!U.App.get_theCoauthManager().get_isKickedOut()&&(!!(2&this.get_enabled())&&this.replicationTimer.hasRequestIntervalElapsed())},t.prototype.forceInbound=function(e,t,n){this.replicationTimer.forceReplication(),this._replicationScheduler.runReplicationTaskImmediately()},t.prototype.forceOutbound=function(e,t,n){},t.prototype.hasChangesToReplicate=function(){return!(!this.get_currentOperation()||2!==this.get_currentOperation().status)||this.hasChangesToInbound()},t.prototype.replicateChanges=function(){if(1===this._state)this.get_currentOperation().set_requestObject(Ft.constructRequest(P.AFrameworkApplication.get_rootQuerySignature(),this._latestPaginationRevision)),this.get_currentOperation().status=1,this._state=3;else if(3===this._state&&this.get_currentOperation()&&2===this.get_currentOperation().status){if(P.AFrameworkApplication.isShuttingDown)return void(this._state=4);if(this.replicationTimer.updateLastReplicationAttempt(),this.replicationTimer.increaseToMaxSpeed(),this._state=1,this._countOfFailedAttempts++,2!==this.get_currentOperation().statusCode)return void this.DisableReplicationIfMaxFailedAttempts();if(1!==(this.get_currentOperation().get_responseObjects()?this.get_currentOperation().get_responseObjects().length:0))return void this.DisableReplicationIfMaxFailedAttempts();var e=this.get_currentOperation().get_responseObjects()[0];if(this._lcLocationInfo.updateLocalCobaltLocationInfoIfNecessary(e),104===e.StatusCode)return void this.DisableReplicationPermanently();if(101===e.StatusCode)return void this.DisableReplicationIfMaxFailedAttempts();if(3===e.StatusCode)return void this.DisableReplicationIfMaxFailedAttempts();if(e.StatusCode)return void this.DisableReplicationIfMaxFailedAttempts();if(!e.PageEnds)return void this.DisableReplicationIfMaxFailedAttempts();this.set_totalPageCount(e.PageEnds.length+1),this._latestPaginationRevision=Pt.j.toExtendedGuid(e.LastKnownPaginationRevision),ne.ULS.sendTraceTag(7479449,336,50,"PaginationReplicator: Start rendering page ends on client after successful replication. [PageCount: {0}] for [Revision: {1}].",this._totalPageCount,this._latestPaginationRevision),this.get_PageEndMarkers()&&(this.get_PageEndMarkers().updateMarkers(e.PageEnds,Ee.h.areEqual(this._latestPaginationRevision,this._latestClientRevision)),this.get_CurrentPageCalculator()&&this.get_CurrentPageCalculator().calculateCurrentPage()),ne.ULS.sendTraceTag(5870302,336,50,"PaginationReplicator: Finished rendering page ends on client after successful replication. [PageCount: {0}] for [Revision: {1}].",this._totalPageCount,this._latestPaginationRevision),this.DisableReplicationIfLatestRevision()}},t.prototype.DisableReplicationPermanently=function(){this._graphSpaceReplicator&&this._graphSpaceReplicator.remove_onAfterReplication(i.i(this,this.OnGraphSpaceReplication,"OnGraphSpaceReplication")),this.DisableReplication()},t.prototype.DisableReplicationIfMaxFailedAttempts=function(){this._countOfFailedAttempts>t.MaxFailedAttempts&&this.DisableReplication()},t.prototype.DisableReplicationIfLatestRevision=function(){Ee.h.areEqual(this._latestPaginationRevision,this._latestClientRevision)&&this.DisableReplication()},t.prototype.dispose=function(){this._graphSpaceReplicator&&(this._graphSpaceReplicator.remove_onAfterReplication(i.i(this,this.OnGraphSpaceReplication,"OnGraphSpaceReplication")),this._graphSpaceReplicator.get_node()&&this.RemoveGraphSpaceListener(this._graphSpaceReplicator.get_node()),this._graphSpaceReplicator=null)},t.prototype.AddGraphSpaceListener=function(e){e&&(e.addListener(this),this._graphSpaceListenerRegistered=!0)},t.prototype.RemoveGraphSpaceListener=function(e){this._graphSpaceListenerRegistered&&e&&(e.removeListener(this),this._graphSpaceListenerRegistered=!1)},t.prototype.onGraphSpaceShutdown=function(e){this.RemoveGraphSpaceListener(e)},t.prototype.onBeforeLoadContent=function(e){},t.prototype.onAfterLoadContent=function(e,t){var n=e.get_contentObjectSpace().get_currentRevision();if(n){var r=n.get_id();this.onContentRevisionUpdated(this._latestPaginationRevision,r)}},t.prototype.onAfterFirstSaveContent=function(e){},t.prototype.onContentRevisionUpdated=function(e,t){Ee.h.areEqual(e,t)&&this.get_PageEndMarkers()&&this.get_PageEndMarkers().makePageEndsCurrent()},t.ReplicationInterval=1e3,t.MaxFailedAttempts=60,t}(bt.q);(0,i.l)(Rt,"12c59a2d$PaginationReplicator",bt.q,[a.m,Sys.IDisposable,Tt.f]);var Et=n(523),kt=function(){function e(){this._container=null,this._featureHelper=null,this._replicator=null,this._currentPageManager=null,this._currentPageCalculator=null,this._pageEndMarkers=null,this._pageAdornmentManager=null,this._loaded=!1}return e.prototype.get_name=function(){return"WordEditor.Pagination"},e.prototype.get_wordEditorPaginationIsEnabled=function(){return this._featureHelper.isFeatureEnabled(97)},e.prototype.get_wordEditorPageEndsIsEnabled=function(){return this._featureHelper.isFeatureEnabled(95)},e.prototype.get_isCurrentPageBrsEnabled=function(){return this._featureHelper.isFeatureEnabled(35)},e.prototype.get_wordEditorPaginationIsDefaultOn=function(){return P.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorPaginationIsDefaultOn")},e.prototype.get_wordEditorPageEndMarkerPositionUpdaterIsEnabled=function(){return P.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordEditorPageEndMarkerPositionUpdaterIsEnabled")},e.prototype.configure=function(e){var t=this;this._container=e,this._featureHelper=this._container.resolve(o.d),this._container.register(Ae).singleInstance().usingFactory((function(){var e=t.get_isCurrentPageBrsEnabled()?t._container.resolve(Y):null;return new Ae(t._container.resolve(be),e)})),this._container.register(ce).as(d).singleInstance().usingFactory((function(){return new ce(new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})))})),this._container.register(_t).as(p).singleInstance().usingFactory((function(){return new _t(new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),t._container.resolve(se),t._container.resolve(Ae),t._container.resolve(ce),t._container.resolve(ct))})),this._container.register(a.m).singleInstance().usingFactory((function(){var e=t.get_isCurrentPageBrsEnabled()?t._container.resolve(Y):null;return new Rt(P.AFrameworkApplication.get_theActionManager(),new M.q(u,(function(){return t.get_wordEditorPageEndsIsEnabled()?t._container.resolve(u):null})),e,W.App.theCoauthReplicationScheduler,U.App.get_theCoauthManagerAsync(),null)})),this._container.register(s).singleInstance().usingFactory((function(){var e=t.get_isCurrentPageBrsEnabled()?t._container.resolve(Y):null;return new ee(e,t.get_wordEditorPaginationIsDefaultOn())})),this._container.register(gt).singleInstance().usingFactory((function(){return new gt(P.AFrameworkApplication.appSettingsManager,new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),t._container.resolve(g.d),new O.s,t._container.resolveFuture(h.x))})),this._container.register(ct).singleInstance().usingFactory((function(){return new ct(P.AFrameworkApplication.appSettingsManager,t._container.resolve(Qe),new O.s,t._container.resolveFuture(h.x))})),this._container.register(Ct).singleInstance().usingFactory((function(){return new Ct(P.AFrameworkApplication.appSettingsManager,new O.s,t._container.resolveFuture(h.x))})),this._container.register(dt).singleInstance().usingFactory((function(){return new dt(t._container.resolve(Qe))})),this._container.register(Qe).singleInstance().usingFactory((function(){return new Qe(new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),t._container.resolve(_.w),t._container.resolve(Pe))})),this._container.register(Je).singleInstance().usingFactory((function(){return new Je(t._container.resolve(dt),t._container.resolve(Qe))})),this._container.register(at).singleInstance().usingFactory((function(){return new at(t._container.resolve(Qe),t._container.resolve(Je))})),this._container.register(ot).singleInstance().usingFactory((function(){return new ot(t._container.resolve(Ye),t._container.resolveLazy(Ue),t._container.resolve(Je),t._container.resolve(at),t._container.resolve(Qe))})),this._container.register(it).singleInstance().usingFactory((function(){return t._container.resolve(ot).create()})),this._container.register(Ue).as(f).singleInstance().usingFactory((function(){return new Ue(new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),t._container.resolve(_.w),t._container.resolve(ce),t._container.resolve(Pe),t._container.resolve(it),t._container.resolve(Ye),U.App.theNotebookManager.get_theGraph())})),this._container.register(et).singleInstance().usingFactory((function(){return new et(t._container.resolve(at),t._container.resolve(dt),$.d.get_instance(),t._container.resolve(Qe))})),this._container.register(Ye).singleInstance().usingFactory((function(){return t._container.resolve(et).create()})),this._container.register(Fe).as(m).singleInstance().usingFactory((function(){return new Fe(t._container.resolve(_.w),new O.s)})),this._container.register(St).singleInstance().usingFactory((function(){return new St(P.AFrameworkApplication.get_theActionManager(),t._container.resolve(y.f),t._container.resolve(a.m),t._container.resolve(s),new M.q(u,(function(){return t.get_wordEditorPageEndsIsEnabled()?t._container.resolve(u):null})),t.get_isCurrentPageBrsEnabled(),P.AFrameworkApplication.get_activeFrame())})),this._container.register(se).singleInstance().usingFactory((function(){return new se(new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),t._container.resolve(ce))})),this._container.register(Y).as(l.y).singleInstance().usingFactory((function(){return new Y(P.AFrameworkApplication.get_theActionManager(),N.SelectionManager.get_instance(),k.y.get_instance(),t._container.resolve(se),new M.q(L.t,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),t._container.tryResolve(B.i),t._container.resolve(y.f),t.get_isCurrentPageBrsEnabled())})),this._container.register(ze).as(u).as(v.x).singleInstance().usingFactory((function(){return t._pageEndMarkers=new ze(new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),new M.q(S.f,(function(){return U.App.get_activeAppFrame().workspace.get_activePage().get_contentObjectSpace()})),t._container.resolve(c),t._container.resolve(f),t._container.resolve(m),t._container.resolve(p),t._container.resolve(se),t._container.resolve(Pe),H.n.getPageEndPositionFromCp,t._container.resolve(Et.h),k.y.get_instance(),ze.getHalfLeadingVerticalSpace,t._container.resolve(x.a),new O.s,t._container.resolve(I.f),t._container.resolve(Ye),t._container.resolve(gt),t._container.resolve(Ct),t.get_isCurrentPageBrsEnabled()?t._container.resolve(l.y):null,t.get_wordEditorPaginationIsDefaultOn(),t.get_wordEditorPageEndMarkerPositionUpdaterIsEnabled()),t._pageEndMarkers})),this._container.register(Pe).singleInstance().usingFactory((function(){return new Pe(t._container.resolveFuture(_.w))})),this._container.register(de).as(C).singleInstance().usingFactory((function(){return new de})),this._container.register(_e).as(T).singleInstance().usingFactory((function(){return new _e(t._container.resolve(V.a))})),this._container.register(be).as(c).singleInstance().usingFactory((function(){return t._pageAdornmentManager=new be(new M.q(G.g,(function(){return U.App.get_activeAppFrame().workspace.get_contentView()})),w.s.get_instance(),R.r.get_instance(),F.z.get_instance(),P.AFrameworkApplication.get_theActionManager(),E.p.get_instance(),t.get_wordEditorPaginationIsDefaultOn(),t._container.resolve(C),t._container.resolve(T),t._container.resolve(I.f),k.y.get_instance()),t._pageAdornmentManager}))},e.prototype.init=function(){var e=this;this._featureHelper.get_graphFeaturesNodeTask().CW((function(t){e.OnAfterGraphFeaturesNodeLoaded()}))},e.prototype.OnAfterGraphFeaturesNodeLoaded=function(){if(this.get_wordEditorPaginationIsEnabled()){var e=U.App.get_activeAppFrame().workspace;e.get_isAppInteractive()?this.AppIsInteractive():e.add_appIsInteractive(i.i(this,this.AppIsInteractiveEventHandling,"AppIsInteractiveEventHandling"))}},e.prototype.AppIsInteractiveEventHandling=function(e,t){this.AppIsInteractive()},e.prototype.AppIsInteractive=function(){this._loaded||(this._loaded=!0,this._replicator=D.w.get_instance().resolve(a.m),this._currentPageManager=D.w.get_instance().resolve(s),this.get_isCurrentPageBrsEnabled()&&(this._currentPageCalculator=D.w.get_instance().resolve(l.y)),D.w.get_instance().resolve(St).registerActions())},e.prototype.dispose=function(){this._pageAdornmentManager&&(this._pageAdornmentManager.dispose(),this._pageAdornmentManager=null),this._pageEndMarkers&&(this._pageEndMarkers.dispose(),this._pageEndMarkers=null),this._replicator&&(this._replicator.dispose(),this._replicator=null),this._currentPageCalculator&&(this._currentPageCalculator.disable(),this._currentPageCalculator=null),this._currentPageManager&&(this._currentPageManager=null)},e}();(0,i.l)(kt,"d17b43c1$PackageManager",null,[b.u,A.s]),n.d(t,{Program:function(){return Dt}});var Dt=function(){function e(){}return e.main=function(){r.o.get_instance().registerPackage(new kt,0,!1)},e}();(0,i.l)(Dt,"4b9dbd5c$Program",null,[])},9452:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var r=(0,n(423).y)("be7e089$IRandomSamplerFactory")},9495:function(e,t,n){"use strict";n.r(t);var r=n(423),i=n(5214),o=n(1822),a=n(4455),s=n(2506),l=n(1308),u=n(5656),c=n(3748),d=n(5479),p=n(8540),g=n(3752),h=n(1388),_=n(3545),f=n(7114),m=function(e){function t(){var t=e.call(this)||this;return t.revision=null,t}return(0,_.t)(t,e),t.prototype.get_failureType=function(){return"CreateMergeBlock"},t.prototype.getFailureDetail=function(){return this.detail.set_item("Type",this.get_failureType()),this.detail.set_item("Revision",this.revision),this.detail},t}(f.w);(0,r.l)(m,"f93cf8c0$CreateMergeBlockFailureDetail",f.w,[]);var y=n(5902),v=n(4680),S=n(8466),I=n(1244),C=n(833),T=n(1098);n.d(t,{ParagraphMergeUtils:function(){return b}});var b=function(){function e(){}return e.CreateMergeBlocksForGraphObjects=function(e,t,n,r,i,a,s,l){l.val="";for(var u=new d.o(h.AMergeBlock,null),c=function(c){var d,p,g=y.b.GetCreator(t,n.get_item(c),r,i,a,s,e);return g?(g.GetMergeBlockList((0,o.m)((function(){return p}),(function(e){return p=e})),(0,o.m)((function(){return d}),(function(e){return d=e}))),p?(l.val+=d,void u.insertRange(u.get_length(),p)):{value:null}):{value:null}},p=0;p<n.get_length();p++){var g=c(p);if("object"==typeof g)return g.value}return u},e.CreateMergeBlocksForMergeInputObjects=function(t,n,r,o,a,s,l,u,c,d,g,h,_,f){return c.val=null,d.val=null,g.val=null,h.val=null,_.val=null,f.val=null,c.val=e.CreateMergeBlocksForGraphObjects(n,(function(e){return t.runtime.BaseObjects.get_item(e)}),r,1,s,l,u,h),c.val?(d.val=e.CreateMergeBlocksForGraphObjects(n,(function(e){return t.runtime.FavoredObjects.get_item(e)||t.runtime.BaseObjects.get_item(e)}),o,2,s,l,u,_),d.val?(g.val=e.CreateMergeBlocksForGraphObjects(n,(function(e){return t.runtime.UnfavoredObjects.get_item(e)||t.runtime.BaseObjects.get_item(e)}),a,4,s,l,u,f),!!g.val||(p.p.get_instance().traceTag(17044301,1,1,"ParagraphMergeUtils:CreateMergeBlocksForMergeInputObjects returned failure as we were unable to create merge blocks for unfavoured revision"),t.logger.logMergeFailureDetail((0,i.m)(new m,{revision:"Unfavored"})),!1)):(p.p.get_instance().traceTag(17044300,1,1,"ParagraphMergeUtils:CreateMergeBlocksForMergeInputObjects returned failure as we were unable to create merge blocks for favoured revision"),t.logger.logMergeFailureDetail((0,i.m)(new m,{revision:"Favored"})),!1)):(p.p.get_instance().traceTag(17044299,1,1,"ParagraphMergeUtils:CreateMergeBlocksForMergeInputObjects returned failure as we were unable to create merge blocks for base revision"),t.logger.logMergeFailureDetail((0,i.m)(new m,{revision:"Base"})),!1)},e.CombineGranularMergeBlocks=function(e,t){for(var n=new d.o(h.AMergeBlock,null),r=0;r<e.get_length();){var i=e.get_item(r);if(1===i.get_type()||4===i.get_type()||2===i.get_type())n.add(i),r++;else if(3===i.get_type()){var o=i,a="";a+=o.get_character(),r++;for(var s=o.isPendingProofing,l=!1;r<e.get_length();r++){var u=e.get_item(r);if(3===u.get_type()){var c=u;o.runId===c.runId&&o.get_formatId().equals(c.get_formatId())&&o.newlyTypedRun===c.newlyTypedRun&&(o.hasSpellingError===c.hasSpellingError||o.hasGrammarError===c.hasGrammarError)&&o.runMergeBlockTrackedChangeInfo.isEquivalentTo(c.runMergeBlockTrackedChangeInfo)&&(!t||o.changeId&&o.changeId.equals(c.changeId))?(a+=c.get_character(),c.isPendingProofing&&(s=!0)):l=!0}else l=!0;if(l){var g=new T.q(null,o.source,o.graphNodeId,o.paraId,o.runId,o.get_formatId(),a,o.newlyTypedRun,!0,s,o.hasSpellingError,o.hasGrammarError,o.proofingErrorHint,o.runMergeBlockTrackedChangeInfo,o.changeId);n.add(g);break}}}}return p.p.get_instance().traceTag(17044302,1,3,"CombineGranularMergeBlocks: List of non granular merge blocks after merge {0}",n.logString(" ")),n},e.CombineGranularMergeBlocksEmptyListFix=function(t,n){for(var r=new d.o(h.AMergeBlock,null),i=0;i<t.get_length();){var o=t.get_item(i);if(1===o.get_type()||4===o.get_type()||2===o.get_type())r.add(o),i++;else if(3===o.get_type()){var a=o,s=a.get_character().toString();i++;for(var l=a.isPendingProofing;i<t.get_length();i++){var u=t.get_item(i);if(3===u.get_type()){var c=u;if(e.ShouldJoinCharacterMergeBlock(a,c,n)){s+=c.get_character(),c.isPendingProofing&&(l=!0);continue}}break}var g=new T.q(null,a.source,a.graphNodeId,a.paraId,a.runId,a.get_formatId(),s,a.newlyTypedRun,!0,l,a.hasSpellingError,a.hasGrammarError,a.proofingErrorHint,a.runMergeBlockTrackedChangeInfo,a.changeId);r.add(g)}}return p.p.get_instance().traceTag(50931345,1,3,"CombineGranularMergeBlocks: List of non granular merge blocks after merge {0}",r.logString(" ")),r},e.ShouldJoinCharacterMergeBlock=function(e,t,n){return e.runId===t.runId&&e.get_formatId().equals(t.get_formatId())&&e.newlyTypedRun===t.newlyTypedRun&&(e.hasSpellingError===t.hasSpellingError||e.hasGrammarError===t.hasGrammarError)&&e.runMergeBlockTrackedChangeInfo.isEquivalentTo(t.runMergeBlockTrackedChangeInfo)&&(!n||!!e.changeId&&e.changeId.equals(t.changeId))},e.SetPropertiesOnMergableObjectSpaceObject=function(t,n,r,i,o,l,u,c,d,p,g,h,_,f,m,y){t.setPropertyString(r.mergeableObject,a.b.richEditTextUnicode,o),t.setPropertyUint32(r.mergeableObject,s.j.wordId,i),t.setPropertyUint32s(r.mergeableObject,s.j.runIds,l),t.setPropertyUint32s(r.mergeableObject,s.j.paraIds,u),t.setPropertyObjectIds(r.mergeableObject,a.b.textRunFormatting,d),t.hasProperty(r.mergeableObject,s.j.textId)&&t.setPropertyUint32(r.mergeableObject,s.j.textId,e.GenerateNewTextId()),n&&n(14)&&t.setPropertyObjectIds(r.mergeableObject,s.j.changeIds,y);for(var v=!1,S=0;S<p.get_length();S++)if(p.get_item(S)){v=!0;break}v&&t.setPropertyBools(r.mergeableObject,s.j.newlyTypedRuns,p),e.CalculateAndSetProofingProperties(n,t,r,g,h,_,f),e.CalculateAndSetTrackedChangesProperties(t,r,m),r.addTouchedProperty(a.b.richEditTextUnicode),r.addTouchedProperty(s.j.wordId),r.addTouchedProperty(s.j.runIds),r.addTouchedProperty(s.j.paraIds),r.addTouchedProperty(a.b.textRunFormatting),r.addTouchedProperty(s.j.newlyTypedRuns),r.addTouchedProperty(a.b.textRunIndex),r.addTouchedProperty(a.b.spellErrorRuns),r.addTouchedProperty(s.j.grammarErrorRuns),r.addTouchedProperty(s.j.proofingErrorHints),r.addTouchedProperty(a.b.notProofedRuns),r.addTouchedProperty(s.j.changeIds),t.hasProperty(r.mergeableObject,s.j.textId)&&r.addTouchedProperty(s.j.textId),c.get_length()>0?t.setPropertyUint32s(r.mergeableObject,a.b.textRunIndex,c):r.mergeableObject.removeProperty(a.b.textRunIndex)},e.CalculateAndSetProofingProperties=function(t,n,r,i,o,l,u){if(t(107)){var c=i.contains(!0,(function(e,t){return t}));e.SetProofingProperty(n,r,a.b.notProofedRuns,c?i:null);var d=function(t,o){e.SetProofingProperty(n,r,t,e.ResetProofingErrorRunIfUnproofed(i,o))};d(a.b.spellErrorRuns,o),d(s.j.grammarErrorRuns,l);for(var p=!1,g=0;g<u.get_length();g++)0!==u.get_item(g)&&(p=!0);p?n.setPropertyUint32s(r.mergeableObject,s.j.proofingErrorHints,u):r.mergeableObject.removeProperty(s.j.proofingErrorHints)}},e.CalculateAndSetTrackedChangesProperties=function(t,n,i){var o=function(e){return e},a=r.i(t,t.setPropertyBools,"setPropertyBools");e.CalculateAndSetTrackedChangesPropertiesHelper(Boolean,n,i.insertedRuns,o,a,s.j.insertedTrackedChangesRuns),e.CalculateAndSetTrackedChangesPropertiesHelper(Boolean,n,i.deletedRuns,o,a,s.j.deletedTrackedChangesRuns),e.CalculateAndSetTrackedChangesPropertiesHelper(Boolean,n,i.previousRunFormattings,o,a,s.j.previousRunFormattingIsTracked);var u=function(e){return e.length>0},c=r.i(t,t.setPropertyStrings,"setPropertyStrings");e.CalculateAndSetTrackedChangesPropertiesHelper(String,n,i.insertedAuthors,u,c,s.j.insertedTrackedChangesRunsAuthors),e.CalculateAndSetTrackedChangesPropertiesHelper(String,n,i.deletedAuthors,u,c,s.j.deletedTrackedChangesRunsAuthors),e.CalculateAndSetTrackedChangesPropertiesHelper(String,n,i.previousRunFormattingAuthors,u,c,s.j.trackedPreviousRunFormattingAuthors);var d=function(e){return!!e},p=r.i(t,t.setPropertyListOfMilliseconds,"setPropertyListOfMilliseconds");if(e.CalculateAndSetTrackedChangesPropertiesHelper(Number,n,i.insertedTimestampsInEpoch,d,p,s.j.insertedTrackedChangesRunsTimestamps),e.CalculateAndSetTrackedChangesPropertiesHelper(Number,n,i.deletedTimestampsInEpoch,d,p,s.j.deletedTrackedChangesRunsTimestamps),e.CalculateAndSetTrackedChangesPropertiesHelper(Number,n,i.previousRunFormattingTimestampsInEpoch,d,p,s.j.trackedPreviousRunFormattingTimestamps),i.previousRunFormattings.any(o)){e.CalculateAndSetTrackedChangesPropertiesHelper(l.h,n,i.previousRunFormattingIds,(function(e){return!0}),r.i(t,t.setPropertyObjectIds,"setPropertyObjectIds"),s.j.trackedPreviousRunFormatting)}else n.mergeableObject.removeProperty(s.j.trackedPreviousRunFormatting)},e.ResetProofingErrorRunIfUnproofed=function(e,t){for(var n=new d.o(Boolean,null),r=!1,i=0;i<e.get_length();i++){var o=t.get_item(i)&&!e.get_item(i);n.add(o),r=o||r}return r?n:null},e.SetProofingProperty=function(e,t,n,r){r?e.setPropertyBools(t.mergeableObject,n,r):t.mergeableObject.removeProperty(n)},e.GenerateNewTextId=function(){return u.s.randomUInt31()},e.GetObjectFromMergeState=function(e,t){return e.runtime.FavoredObjects.getOrElse(t,e.runtime.BaseObjects.get_item(t)||e.runtime.UnfavoredObjects.get(t))},e.GetMergeableObjectsFromMergeBlocks=function(t,n,r,o,a,s){s.val=new d.o(C.o,null);var u,c=!!r&&r(14);if(t.runtime.FeatureHelper.isFeatureEnabled(84)){var g=e.CombineGranularMergeBlocksEmptyListFix(o,c),h=e.CombineGranularMergeBlocks(o,c);g.get_length()!==h.get_length()&&t.runtime.FeatureHelper.logUniqueFeatureUsage(84),u=g}else u=e.CombineGranularMergeBlocks(o,c);var _=0,f="",m=new d.o(Number,null),y=new d.o(Number,null),v=new d.o(Number,null),T=new d.o(l.h,null),b=new d.o(Boolean,null),A=new d.o(Boolean,null),M=new d.o(Boolean,null),P=new d.o(Boolean,null),F=new d.o(Number,null),w=new S.x,R=new d.o(l.h,null),E=u.get_item(u.get_length()-1);if(2!==E.get_type()&&4!==E.get_type())return p.p.get_instance().traceTag(17044304,1,2,"GetMergeableObjectsFromMergeBlocks: Last merge block not an EOP or table but is [Type: {0}] instead",E.get_type()),t.logger.logMergeFailureDetail((0,i.m)(new I.h,{funcSource:"GetMergeableObjectsFromMergeBlocks",eventId:"bbbnq",info:String.format("Last merge block is not EOP or table but {0}",E.get_type())})),!1;for(var k=0,D=0;D<u.get_length();D++){var O=u.get_item(D),U=null;if(1===O.get_type()||3===O.get_type())f+=(U=O).get_text();else if(4===O.get_type()){var x=O.graphNodeId,L=e.GetObjectFromMergeState(t,x),N=new C.o(L,!0);s.val.add(N);continue}if(U?(m.add(U.runId),y.add(U.paraId),k+=U.get_text().length,v.add(k),T.add(U.get_formatId()),b.add(U.newlyTypedRun),A.add(U.isPendingProofing),M.add(U.hasSpellingError),P.add(U.hasGrammarError),F.add(U.proofingErrorHint),w.insertedRuns.add(U.runMergeBlockTrackedChangeInfo.get_hasInsertion()),w.deletedRuns.add(U.runMergeBlockTrackedChangeInfo.get_hasDeletion()),w.previousRunFormattings.add(U.runMergeBlockTrackedChangeInfo.get_hasPreviousFormatting()),w.insertedAuthors.add(U.runMergeBlockTrackedChangeInfo.insertion.author),w.deletedAuthors.add(U.runMergeBlockTrackedChangeInfo.deletion.author),w.previousRunFormattingAuthors.add(U.runMergeBlockTrackedChangeInfo.previousFormatting.author),w.insertedTimestampsInEpoch.add(U.runMergeBlockTrackedChangeInfo.insertion.millisecondsSinceEpoch),w.deletedTimestampsInEpoch.add(U.runMergeBlockTrackedChangeInfo.deletion.millisecondsSinceEpoch),w.previousRunFormattingTimestampsInEpoch.add(U.runMergeBlockTrackedChangeInfo.previousFormatting.millisecondsSinceEpoch),w.previousRunFormattingIds.add(U.runMergeBlockTrackedChangeInfo.previousFormatting.previousRunFormattingId),c&&R.add(U.changeId)):m.get_length()||(m.add(0),y.add(0),v.add(0),T.add(l.h.get_nil()),b.add(!1),A.add(!1),M.add(!1),P.add(!1),F.add(0),w.insertedRuns.add(!1),w.deletedRuns.add(!1),w.previousRunFormattings.add(!1),w.insertedAuthors.add(""),w.deletedAuthors.add(""),w.previousRunFormattingAuthors.add(""),w.insertedTimestampsInEpoch.add(0),w.deletedTimestampsInEpoch.add(0),w.previousRunFormattingTimestampsInEpoch.add(0),w.previousRunFormattingIds.add(l.h.get_nil())),2===O.get_type()){var B=O,H=B.wordId;v.deleteAt(v.get_length()-1);var $=a.get_item(_);if(!$)return p.p.get_instance().traceTag(17044307,1,2,"GetMergeableObjectsFromMergeBlocks: Failed to get a paragraphId. [ParagraphIdx: {0}] [ParagraphIds.Count: {1}] [MergeBlocks.Length: {2}] [CombinedMergeBlockIdx: {3}] [CombinedMergeBlocks.Length: {4}]",_,a.get_length(),o.get_length(),D,u.get_length()),t.logger.logMergeFailureDetail((0,i.m)(new I.h,{funcSource:"GetMergeableObjectsFromMergeBlocks",eventId:"bbbnt",info:"Failed to get ParaId"})),p.p.get_instance().traceMultiPartMessageTag(17044308,1,3,"GetMergeableObjectsFromMergeBlocks Paragraphs",a.logString(" ")),p.p.get_instance().traceMultiPartMessageTag(17044309,1,3,"GetMergeableObjectsFromMergeBlocks MergeBlocks",o.logString(" ")),p.p.get_instance().traceMultiPartMessageTag(17044310,1,3,"GetMergeableObjectsFromMergeBlocks CombinedMergeBlocks",u.logString(" ")),!1;var G=e.GetObjectFromMergeState(t,$);if(G){N=new C.o(G.cloneForMerge(),!0);e.SetPropertiesOnMergableObjectSpaceObject(n,r,N,B.wordId,f,m,y,v,T,b,A,M,P,F,w,R),s.val.add(N)}p.p.get_instance().traceTag(17044312,1,3,"Merge result for: [GraphNode: {0}] [WordId: {1}] [RunIds: {2}] [ParaIds: {3}] [RunIndices: {4}] [ProofingRequired: {5}] [HasSpellingError: {6}] [HasGrammarError: {7}] [FormattingIds: {8}] {9} [ProofingErrorHint: {10}]",B.graphNodeId,H,m.logString(" "),y.logString(" "),v.logString(" "),A.logString(" "),M.logString(" "),P.logString(" "),T.logString(" "),"",F.logString(" ")),_++,f="",m=new d.o(Number,null),y=new d.o(Number,null),v=new d.o(Number,null),T=new d.o(l.h,null),b=new d.o(Boolean,null),A=new d.o(Boolean,null),M=new d.o(Boolean,null),P=new d.o(Boolean,null),F=new d.o(Number,null),w.reset(),k=0,R=new d.o(l.h,null)}}return!0},e.ResetUpdateHintContainerDueToFailedMerge=function(e,t){for(var n=e.runtime.MergedObjects.get_item(g.c.updateHintsContainerNodeObjectId),r=t.getPropertyObjectIds(n.mergeableObject,s.j.updateHintNodes),i=0;i<r.get_length();i++)e.runtime.MergedObjects.remove(r.get_item(i));t.setPropertyObjectIds(n.mergeableObject,s.j.updateHintNodes,new d.o(l.h,null)),t.setPropertyString(n.mergeableObject,s.j.updateHintsContainerNodeBaseRevision,l.h.get_nil().toString()),n.addTouchedProperty(s.j.updateHintNodes),n.addTouchedProperty(s.j.updateHintsContainerNodeBaseRevision)},e.InitializeUpdateHintsContainerNodeForMerge=function(e,t){if(e.runtime.MergedObjects.containsKey(g.c.updateHintsContainerNodeObjectId))return null;var n=new C.o(e.runtime.BaseObjects.get_item(g.c.updateHintsContainerNodeObjectId).cloneForMerge(),!0);return t.setPropertyString(n.mergeableObject,s.j.updateHintsContainerNodeBaseRevision,e.output.MergedRevisions.last().get_id().toString()),t.setPropertyObjectIds(n.mergeableObject,s.j.updateHintNodes,new d.o(l.h,null)),n.addTouchedProperty(s.j.updateHintNodes),n.addTouchedProperty(s.j.updateHintsContainerNodeBaseRevision),e.runtime.MergedObjects.set_item(g.c.updateHintsContainerNodeObjectId,n),n},e.GetMergeableObjectIdList=function(e){var t=new d.o(l.h,null);return e.forEach((function(e){return t.add(e.get_id()),!0})),t},e.LogFailedObjects=function(e,t,n,r){var i=0;n.forEach((function(n){(v.e.log(n,t+i++,1),393230===n.get_runtimeClassId())&&e.getPropertyObjectIds(n,a.b.textRunFormatting).forEach((function(e){return r.add(e),!0}));return!0}))},e.LogFailedFormattingObjects=function(t,n,r){var i=new c.f(l.h),a=0;r.forEach((function(r){return!!i.contains(r)||(i.add(r),!!e.LogFormattingObject(n,"BaseFormatting_",(0,o.m)((function(){return a}),(function(e){return a=e})),r,(function(e){return t.runtime.BaseObjects.get_item(e)}))||(!!e.LogFormattingObject(n,"FavoredFormatting_",(0,o.m)((function(){return a}),(function(e){return a=e})),r,(function(e){return t.runtime.FavoredObjects.get_item(e)}))||(!!e.LogFormattingObject(n,"ConflictingFormatting_",(0,o.m)((function(){return a}),(function(e){return a=e})),r,(function(e){return t.runtime.UnfavoredObjects.get_item(e)}))||(a++,!0))))}))},e.LogFormattingObject=function(e,t,n,r,i){var o=i(r);return!(!o||(v.e.log(o,t+n.val,1),1179649!==o.get_runtimeClassId()))&&(n.val++,!0)},e.doesGraphContainUpdateHintsContainerNodes=function(e,t){return!!e.runtime.BaseObjects.get_item(g.c.updateHintsContainerNodeObjectId)},e.CalculateAndSetTrackedChangesPropertiesHelper=function(e,t,n,r,i,o){n.any(r)?(i(t.mergeableObject,o,n),t.addTouchedProperty(o)):t.mergeableObject.removeProperty(o)},e}();(0,r.l)(b,"c59a10a5$ParagraphMergeUtils",null,[])},9562:function(e,t,n){"use strict";n.r(t);var r=n(3545),i=n(7772),o=n(2407),a=n(423),s=(0,a.y)("a667a89e$IBox4PresenceUser"),l=n(7065),u=n(877),c=function(){return function(e,t,n,r,i,o,a,s,l,u,c){this.clientId=e,this.SkypeChatThreadId=n,this.chatThreadDiscoveryUri=r,this.inChat=i,this.localColbaltSessionId=t,this.capabilities=o,this.email=a,this.isReadOnly=s,this.userName=l,this.isAnonymous=u,this.presenceStatus=c}}();(0,a.l)(c,"b9094d5f$SerializablePresenceUserData",null,[]),n.d(t,{PresenceUser:function(){return d}});var d=function(e){function t(t,n,r,i,o,a,s,l,u,c,d,p,g){var h=this;return h.$$pf_LocalCobaltSessionId=null,(h=e.call(this,t,n,r,i,a,s,l,u,c,d,p,0,null)||this).set_localCobaltSessionId(o),h.set_presenceStatus(g),h}return(0,r.t)(t,e),t.prototype.get_localCobaltSessionId=function(){return this.$$pf_LocalCobaltSessionId},t.prototype.set_localCobaltSessionId=function(e){return this.$$pf_LocalCobaltSessionId=e,e},t.prototype.hasAssignedColor=function(){return!!this.get_color()},t.prototype.getData=function(){return new c(this.get_clientId(),this.get_localCobaltSessionId(),this.get_chatThreadId(),this.get_chatThreadDiscoveryUri(),this.get_inChat(),this.get_capabilities().capabilities,this.get_email(),this.get_isReadOnly(),this.get_userName(),this.get_isAnonymous(),this.get_presenceStatus())},t.prototype.getPresenceUserFromDictEntry=function(e){var t=e.value;return t?t.get_user():null},t.prototype.clone=function(){return new t(this.get_clientId(),this.get_userName(),this.get_color(),this.get_capabilities().clone(),this.get_localCobaltSessionId(),this.get_chatThreadId(),this.get_email(),this.get_client(),this.get_chatThreadDiscoveryUri(),this.get_isAnonymous(),this.get_inChat(),this.get_isReadOnly(),this.get_presenceStatus())},t.createFromPlainData=function(e){if(!e.clientId)return null;var n=isUndefined(e.capabilities)?0:e.capabilities;return new t(e.clientId,e.userName,null,new u.w(n),e.localColbaltSessionId,e.SkypeChatThreadId,e.email,null,e.chatThreadDiscoveryUri,e.isAnonymous,e.inChat,e.isReadOnly,e.presenceStatus)},t.createFromPlainRttData=function(e,n,r,i,o,a,s,l,c,d,p,g,h){if(!e)return null;var _=isUndefined(i)?0:i;return new t(e,n,r,new u.w(_),o,a,s,l,c,g,d,p,h)},t.defaultUserColor=13421772,t.defaultUserColorHex="0xcccccc",t.defaultUserColorCss="#cccccc",t}(l.PresenceUser);(0,a.l)(d,"9e8e0ff6$PresenceUser",l.PresenceUser,[o.r,s,i.t])},9580:function(e,t,n){"use strict";n.d(t,{l:function(){return r}});var r=(0,n(423).y)("71f32559$ITriePrefixVisitor")},9695:function(e,t,n){"use strict";n.r(t);var r=n(5526),i=n(4424),o=n(3019),a=n(363),s=n(8192),l=n(3545),u=n(2494),c=n(8530),d=n(423),p=function(e){function t(){var t=e.call(this)||this;return t.set_buttonsOption(0),t.setButtonText(1,CommonUIStrings.l_DialogClose),t}return(0,l.t)(t,e),t.prototype.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ErrorSavingToOneDrive,null)},t}(c.StandardDialog);(0,d.l)(p,"38c835fb$ErrorDialog",c.StandardDialog,[u.v]);var g=n(6684),h=n(6978),_=n(3603),f=n(8939),m=n(2132),y=n(2575),v=n(1526),S=n(8056),I=n(4311);n.d(t,{PackageManager:function(){return C}});var C=function(){function e(){this._container=null}return e.prototype.get_name=function(){return"Common.App.SaveToCloudStorage"},e.prototype.init=function(){y.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")&&this._container.resolve(h.j).registerActions()},e.prototype.dispose=function(){},e.prototype.configure=function(e){this._container=e,this._container.register(_.m).as(r.j).usingFactory((function(){return new _.m(y.AFrameworkApplication.get_theActionManager(),S.SignOutResponse.get_instance(),y.AFrameworkApplication.get_activeFrame().get_applicationInstance())})).singleInstance(),this._container.register(f.p).as(i.p).usingFactory((function(){return new f.p(y.AFrameworkApplication.appSettingsManager)})).singleInstance(),this._container.register(h.j).usingFactory((function(){return new h.j(e.resolve(g.a),e.resolve(o.v),y.AFrameworkApplication.appSettingsManager,y.AFrameworkApplication.get_activeFrame().get_theStopwatchBuilder())})).singleInstance(),this._container.register(m.t).usingFactory((function(){return new m.t(e.resolve(f.p),(function(){return new I.c(!1)}),(function(){return new p}),y.AFrameworkApplication.get_activeFrame(),y.AFrameworkApplication.get_activeFrame().get_theStopwatchBuilder())})).singleInstance(),this._container.register(g.a).usingFactory((function(){return new g.a(e.resolve(_.m),S.SignOutResponse.get_instance(),e.resolve(m.t),y.AFrameworkApplication.appSettingsManager,y.AFrameworkApplication.get_environment(),(function(){return new p}))})).singleInstance()},e.main=function(){v.o.get_instance().registerPackage(new e,0,!1)},e}();(0,d.l)(C,"f375e4e2$PackageManager",null,[a.u,s.s])},9697:function(e,t,n){"use strict";n.r(t);var r=n(423),i=(0,r.y)("e0437433$IVersionHistoryDialogActor"),o=(0,r.y)("b503334c$IVersionHistoryDialogFactory"),a=(0,r.y)("434eda0a$IVersionHistorySelectionHandler"),s=n(363),l=n(8192),u=n(7597),c=n(3518),d=n(3362),p=n(9910),g=n(2575),h=n(8530),_=n(2192),f=function(){function e(e,t){this._actionManager=null,this._isVersionHistorySupported=null,this._isVersionHistorySupported=e,this._actionManager=t}return e.prototype.registerActions=function(){this.get_ActionManager().addAction(p.b.versionHistory,_.m.frame,r.i(this,this.VersionHistory,"VersionHistory"))},e.prototype.isVersionHistoryEnabled=function(){return this._isVersionHistorySupported()?32:8},e.prototype.VersionHistory=function(e,t,n,i,o){return 1===n?this.isVersionHistoryEnabled():g.AFrameworkApplication.executeVersionHistory?(u.ULS.sendTraceTag(38908761,202,50,"VersionHistoryActor:VersionHistory - Version History Attempt"),g.AFrameworkApplication.executeVersionHistory(r.i(this,this.OnVersionHistorySuccess,"OnVersionHistorySuccess"),r.i(this,this.OnVersionHistoryFailure,"OnVersionHistoryFailure")),32):8},e.prototype.OnVersionHistorySuccess=function(e){e?e.OperationResult?u.ULS.sendTraceTag(38908763,202,10,"VersionHistoryActor:OnVersionHistorySuccess - Unknown failed operation result"):this.get_ActionManager().processActionWithData(p.b.updateVersionsPane,2,e,null):u.ULS.sendTraceTag(38908762,202,10,"VersionHistoryActor:OnVersionHistorySuccess - Got null response")},e.prototype.OnVersionHistoryFailure=function(e){var t=new h.StandardDialog;t.set_buttonsOption(0),u.ULS.sendTraceTag(38908764,202,15,"VersionHistoryActor:OnVersionHistoryFailure - {0}",{Result:e}),t.showInformation("We Couldn't get the Version History","We're sorry, but we couldn't get the version history for the file. Please try again in a few minutes, or refresh the page and try again.",null)},e.prototype.get_ActionManager=function(){return this._actionManager.get_value()},e.get_instance=function(){return e._instance||(e._instance=e.GetAnInstanceWithResolvedDependecies())},e.GetAnInstanceWithResolvedDependecies=function(){return new e(g.AFrameworkApplication.isVersionHistorySupported,new d.q(c.v,(function(){return g.AFrameworkApplication.get_theActionManager()})))},e._instance=null,e}();(0,r.l)(f,"8f48f7d2$VersionHistoryActor",null,[]);var m=n(3386),y=function(){function e(e,t){this._actionManager=null,this._versionHistoryDialogFactory=null,this._versionHistoryDialog=null,this._actionManager=e,this._versionHistoryDialogFactory=t}return e.prototype.registerActions=function(){this._actionManager.addAction(p.b.showVersionHistoryDialog,_.m.frame,r.i(this,this.ShowVersionHistoryDialogAction,"ShowVersionHistoryDialogAction")),this._actionManager.addAction(p.b.updateVersionsPane,_.m.frame,r.i(this,this.UpdateVersionsPaneAction,"UpdateVersionsPaneAction"))},e.prototype.ShowVersionHistoryDialogAction=function(e,t,n,r,i){var o=32;if(2===n){var a=this._actionManager.processAction(p.b.versionHistory,2,null);if(u.ULS.sendTraceTag(39679138,202,50,"ShowVersionHistoryDialogAction: ProcessAction returns versionHistoryResponse {0}.",a),32!==a)o=8;else{if(this._versionHistoryDialog=this._versionHistoryDialogFactory.get_value().create(),!this._versionHistoryDialog)return u.ULS.sendTraceTag(38908765,202,50,"VersionHistoryDialogActor:ShowVersionHistoryDialogAction - VersionHistoryDialogFactory should be initialized"),8;m.s.addAppPLTEventToLog("ShowVersionHistoryDialog");var s=new Date;u.ULS.sendTraceTag(39679139,202,50,"ShowVersionHistoryDialogAction: start to show dialog. StartTime: {0}.",s),this.showVersionHistoryDialogImpl()}}return o},e.prototype.UpdateVersionsPaneAction=function(e,t,n,r,i){return 2===n&&this._versionHistoryDialog.updateVersionsPane(i),32},e.prototype.showVersionHistoryDialogImpl=function(){this._versionHistoryDialog.showVersionHistoryDialog()},e}();(0,r.l)(y,"735cc1fa$VersionHistoryDialogActor",null,[i]);var v=n(3545),S=(0,r.y)("8453a9f8$IVersionHistoryDialog"),I=n(8027),C=function(){function e(){}return e.get_dialogHtml=function(){return e.DialogHtmlFormat},e.DialogHtmlFormat="<div class='VersionHistoryDialog' id='versionhistorydialog'> <div class='VersionHistoryViewPane' id='versionhistoryviewpane'> </div> <div class='VersionHistoryVersionsPane' id='versionhistoryversionspane'> </div> </div>",e}();(0,r.l)(C,"a15e42e8$VersionHistoryDialogHtml",null,[]);var T=function(){return function(e,t,n){this.sectionElement=null,this.imageHolder=null,this.imageElement=null,this.sectionElement=e,this.imageHolder=t,this.imageElement=n}}();(0,r.l)(T,"852b4946$SectionInfo",null,[]);var b=n(3258),A=function(){function e(e){this.spinnerId=null,this.spinnerElement=null,this.spinnerId=e,this.spinnerElement=document.createElement("div"),this.spinnerElement.id=this.spinnerId,this.spinnerElement.style.position="relative",this.spinnerElement.style.width="24px",this.spinnerElement.style.height="100%",this.spinnerElement.style.margin="0 auto";var t=document.createElement("div");t.style.position="absolute",t.style.display="block",t.style.top="50%",this.spinnerElement.appendChild(t);var n=document.createElement("img");n.src=b.h.commonImage("progress.gif"),t.appendChild(n)}return e.prototype.show=function(){this.spinnerElement.style.display="block"},e.prototype.hide=function(){this.spinnerElement.style.display="none"},e}();(0,r.l)(A,"466bc2a4$VersionHistorySpinner",null,[]);var M=n(9354),P=n(1135),F=n(5989),w=n(6410),R=n(6020),E=function(e){function t(n){var i=this;return i._viewUrl=null,i._viewContainer=null,i._viewPane=null,i._versionsPane=null,i._versionViewerSpinner=null,i._versionsPaneSpinner=null,i._currentVersionSection=null,i._currentVersionContainer=null,i._olderVersionsSection=null,i._olderVersionsContainer=null,i._versionViewerContainer=null,i._selectionHandler=null,i._arrowClickHandler=null,i._arrowKeyHandler=null,i._versionClickHandler=null,i._versionKeyHandler=null,i.sectionInfoList=[],i.versionList=[],(i=e.call(this)||this)._selectionHandler=n,i._arrowClickHandler=r.i(i,i.ArrowClickHandler,"ArrowClickHandler"),i._arrowKeyHandler=r.i(i,i.ArrowKeyHandler,"ArrowKeyHandler"),i._versionClickHandler=r.i(i,i.VersionClickHandler,"VersionClickHandler"),i._versionKeyHandler=r.i(i,i.VersionKeyHandler,"VersionKeyHandler"),i.set_dialogHtml(C.get_dialogHtml()),i.set_buttonsOption(0),i.set_dialogId(t._dialogId),i.setButtonText(1,CommonUIStrings.l_DialogClose),i}return(0,v.t)(t,e),t.prototype.ArrowClickHandler=function(e){return this.ChangeArrowState(e),!0},t.prototype.ArrowKeyHandler=function(e){return this.keyHandlerWithAction(e,r.i(this,this.ChangeArrowState,"ChangeArrowState"))},t.prototype.VersionClickHandler=function(e){return this.UpdateViewContainer(e),!0},t.prototype.VersionKeyHandler=function(e){return this.keyHandlerWithAction(e,r.i(this,this.UpdateViewContainer,"UpdateViewContainer"))},t.prototype.UpdateViewContainer=function(e){var t=e.userData;if(this._selectionHandler.onVersionHistorySelected(t[0],t[1],this._viewContainer),document.getElementById("versionTimeStamp"))document.getElementById("versionTimeStamp").innerText=new Date(t[0].Time.toString()).toLocaleString("en-US",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).toString();else{var n=document.createElement("div");n.id="versionTimeStamp",n.innerText=new Date(t[0].Time.toString()).toLocaleString("en-US",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).toString(),n.style.paddingLeft="40%",document.getElementById("WACDialogTitlePanel").appendChild(n)}},t.prototype.ChangeArrowState=function(e){var n=e.userData;"visible"===n.sectionElement.style.visibility?(n.sectionElement.style.visibility="hidden",n.imageElement.className=M.ImageClusteringHelper.getImageClass(t._downArrowIconCssClass),n.imageElement.title=CommonUIStrings.l_Expand,n.imageHolder.title=CommonUIStrings.l_Expand):(n.sectionElement.style.visibility="visible",n.imageElement.className=M.ImageClusteringHelper.getImageClass(t._upArrowIconCssClass),n.imageElement.title=CommonUIStrings.l_Collapse,n.imageHolder.title=CommonUIStrings.l_Collapse)},t.prototype.reSizeDialog=function(){e.prototype.reSizeDialog.call(this),this.resetDialogStyle(),this._divMessageBox.style.width=F.g.getElementBounds(document.getElementById(t._wacInnerFrameId)).width+"px",this._divMessageBox.style.height=F.g.getElementBounds(document.getElementById(t._wacInnerFrameId)).height+F.g.getElementBounds(document.getElementById(t._wacStatusBarContainer)).height+"px",this.ResizeViewContainer()},t.prototype.ResizeViewContainer=function(){this._viewContainer&&this._viewContainer.style&&(this._viewContainer.style.width=F.g.getElementBounds(document.getElementById(t._viewHeaderId)).width+"px",this._viewContainer.style.height=parseInt(this._divMessageBox.style.height)-F.g.getElementBounds(document.getElementById(t._viewContainerId)).y-parseInt(this._viewContainer.style.marginBottom)+"px",this.centerDialog())},t.prototype.createSectionHeader=function(e,n,r,i,o,a){var s=document.createElement("div");i&&(s.id=i),o&&s.setAttribute(R.t.ariaLabelledByAttribute,o),a&&(s.tabIndex=0);var l=document.createElement("span");return l.className=t._sectionNameCssClass,l.innerText=e,r&&(l.id=r),s.appendChild(l),s.appendChild(n),s},t.prototype.CreateCollapsibleSectionHeader=function(e,n,r){var i=this.createSectionHeader(n,r,null,null,null,!1),o=this._document.createElement("div");o.className=t._arrowHolderCssClass,o.id=t._arrowId+e,o.setAttribute(R.t.ariaRoleAttribute,R.t.ariaButtonRole),o.tabIndex=0,i.insertBefore(o,r);var a=M.ImageClusteringHelper.createClusteredImage(16,16,t._arrowIconName,t._arrowImageCssClass,!0,"");o.appendChild(a);var s=a.childNodes[0];s.className=M.ImageClusteringHelper.getImageClass(t._upArrowIconCssClass),s.title=CommonUIStrings.l_Collapse,o.title=CommonUIStrings.l_Collapse,r.style.visibility="visible";var l=new T(r,o,s);return Array.add(this.sectionInfoList,l),this._clickManager.registerHandlerWithData(P.d.click,o,this._arrowClickHandler,l),this._keyInputManager.registerHandlerWithData(P.d.keyDown,o,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(P.d.keyPress,o,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(P.d.keyUp,o,this._arrowKeyHandler,l),i},t.prototype.createVersion=function(e,n){var r=document.createElement("div");r.id=e.Time.toString(),r.tabIndex=0;var i=document.createElement("span");i.className=t._sectionNameCssClass,i.innerText=new Date(e.Time.toString()).toLocaleString("en-US",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).toString(),r.appendChild(i),e.VersionElement=r,Array.add(this.versionList,e);var o=[e,n];return this._clickManager.registerHandlerWithData(P.d.click,r,this._versionClickHandler,o),this._keyInputManager.registerHandlerWithData(P.d.keyDown,r,this._versionKeyHandler,o),this._keyInputManager.registerHandlerWithData(P.d.keyPress,r,this._versionKeyHandler,o),this._keyInputManager.registerHandlerWithData(P.d.keyUp,r,this._versionKeyHandler,o),r},t.prototype.fancyCreateVersion=function(e,t){var n=document.createElement("div");n.id=e.Time.toString(),n.style.cssText="display:flex;direction:inherit;flex-direction:row;box-sizing:border-box;align-items:stretch;flex-wrap:nowrap;width:268px;max-width:268px;padding-top:0px;padding-right:0px;padding-bottom:0px;padding-left:0px;margin-top:9px;margin-bottom:9px;margin-right:9px;margin-left:9px;background-color:rgb(248, 248, 248);cursor:default;position:relative;box-shadow:rgba(0, 0, 0, 0.1) 0px 16px 24px;overflow:hidden;border-width:1px;border-style:solid;border-image:initial;border-color:rgb(234, 234, 234);outline:transparent dotted 2px;";var r=e.AuthorID?e.AuthorID:"GuestUser",i=r.length>2?r.substring(0,2):"G1";n.innerHTML=String.format('<div style="display: flex; direction: inherit; flex-direction: column; flex-grow: 1; max-width: 266px; outline: none;">\r\n                                     <div style="display: flex; flex-wrap: nowrap; flex-direction: column; flex-grow: 1; max-width: 266px; outline: none;">\r\n                                     <div style="display: flex; direction: inherit; flex-grow: 1; flex-direction: row; flex-wrap: nowrap; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;\r\n                                                  position: relative; background-color: rgb(255, 255, 255); overflow: hidden; border-width: 0px; border-style: initial; border-color: initial; border-image: initial;">\r\n                                     <div style="position: absolute; left: 2px; top: 0px; right: 0px; bottom: 0px; width: 1px; background-color: transparent; display: none; outline: none;"></div>\r\n                                     <div style="margin-top: 8px; margin-right: 8px; margin-bottom: 8px; margin-left: 6px;">\r\n                                     <div style="font-family: inherit;-webkit-font-smoothing: antialiased;font-size: 14px;font-weight: 400;box-shadow: none;margin-top: 0px;margin-right: 0px;margin-bottom: 0px;margin-left: 0px;\r\n                                               padding-top: 0px;padding-right: 0px;padding-bottom: 0px;padding-left: 0px;box-sizing: border-box;color: rgb(51, 51, 51);position: relative;height: 24px;min-width: 24px;display: flex;\r\n                                               align-items: center;justify-content: center;">\r\n                                     <div style="font-family: \'Segoe UI\', \'Segoe UI Web (West European)\', \'Segoe UI\', -apple-system, BlinkMacSystemFont, Roboto, \'Helvetica Neue\', sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; font-weight: 400;">\r\n                                     <div style="position: relative; text-align: center; height: 24px; width: 24px; flex: 0 0 auto;">\r\n                                     <div style="color: rgb(255, 255, 255); font-size: 11px; font-weight: 400; line-height: 24px; height: 24px; background-color: rgb(96, 60, 186); border-radius: 50%;"><span>{0}</span></div></div></div></div></div>\r\n                                     <div style="display: flex; direction: inherit; flex-direction: column; flex-grow: 1; margin-top: 8px;">\r\n                                     <div style="display: flex; direction: inherit; flex-direction: row; flex-wrap: nowrap; overflow: hidden;">\r\n                                     <div style="color: rgb(51, 51, 51); font-weight: 600; font-family: inherit; font-size: 12px; line-height: 15px; align-self: baseline; text-overflow: ellipsis; white-space: nowrap;\r\n                                               max-width: 176px; padding-right: 1px; padding-left: 0px; margin-left: 3px; padding-bottom: 1px; user-select: text; overflow: hidden; flex: 4 1 176px;">{1}</div></div>\r\n                                     <div style="display: flex; margin-right: 9px; background-color: transparent; max-width: 213px; padding-top: 1px; padding-right: 1px; padding-bottom: 1px;\r\n                                               padding-left: 1px; user-select: text; border-width: 0px; border-style: initial; border-color: initial; border-image: initial;">\r\n                                     <div style="box-sizing: border-box; flex-grow: 1; overflow-y: hidden; position: relative; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 2px;\r\n                                               padding-right: 2px; padding-bottom: 2px; padding-left: 2px; font-family: inherit; font-size: 12px; font-weight: normal; line-height: 1.5; cursor: text; color: rgb(51, 51, 51);">\r\n                                     <p>{2}</p></div></div></div></div>\r\n                                     <div style="height: 1px; background-color: rgb(234, 234, 234);"></div></div>\r\n                                     <div style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; width: 1px; background-color: transparent; display: none; outline: none;"></div></div>',i,new Date(e.Time.toString()).toLocaleString("en-US",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).toString(),r),e.VersionElement=n,Array.add(this.versionList,e);var o=[e,t];return this._clickManager.registerHandlerWithData(P.d.click,n,this._versionClickHandler,o),this._keyInputManager.registerHandlerWithData(P.d.keyDown,n,this._versionKeyHandler,o),this._keyInputManager.registerHandlerWithData(P.d.keyPress,n,this._versionKeyHandler,o),this._keyInputManager.registerHandlerWithData(P.d.keyUp,n,this._versionKeyHandler,o),n},t.prototype.dispose=function(){if(this.sectionInfoList){for(var t=0;t<this.sectionInfoList.length;++t)this._clickManager.unregisterHandler(P.d.click,this.sectionInfoList[t].imageHolder,this._arrowClickHandler),this._keyInputManager.unregisterHandler(P.d.keyDown,this.sectionInfoList[t].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(P.d.keyPress,this.sectionInfoList[t].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(P.d.keyUp,this.sectionInfoList[t].imageHolder,this._arrowKeyHandler);this.sectionInfoList=null,this._arrowClickHandler=null,this._arrowKeyHandler=null}if(this.versionList){for(t=0;t<this.versionList.length;++t)this._clickManager.unregisterHandler(P.d.click,this.versionList[t].VersionElement,this._versionClickHandler),this._keyInputManager.unregisterHandler(P.d.keyDown,this.versionList[t].VersionElement,this._versionKeyHandler),this._keyInputManager.unregisterHandler(P.d.keyPress,this.versionList[t].VersionElement,this._versionKeyHandler),this._keyInputManager.unregisterHandler(P.d.keyUp,this.versionList[t].VersionElement,this._versionKeyHandler);this.versionList=null,this._versionClickHandler=null,this._versionKeyHandler=null}this._viewPane=null,this._versionsPane=null,this._currentVersionSection=null,this._olderVersionsSection=null,this._viewContainer=null,e.prototype.dispose.call(this)},t.prototype.showVersionHistoryDialog=function(){this.showDialog("Version History",null),this._viewPane=document.getElementById("versionhistoryviewpane"),this._viewPane.style.width="79%",this._viewPane.style.position="relative",w.s.setElementCssFloat(this._viewPane,"left"),this._viewPane.style.marginTop="1%",this._versionsPane=document.getElementById("versionhistoryversionspane"),this._versionsPane.style.width="19%",w.s.setElementCssFloat(this._versionsPane,"right"),this._versionsPane.style.marginLeft="1%",this._versionsPane.style.marginTop="1%",this._viewContainer=document.createElement("div"),this._viewContainer.id=t._viewContainerId,this._viewContainer.style.width="100%",this._viewContainer.style.height="100%",this._viewContainer.style.border="none",this._viewContainer.style.marginBottom="15px",this._viewContainer.tabIndex=-1,this._viewContainer.style.overflow="hidden",this._versionViewerContainer=this.createSectionHeader("View",this._viewContainer,t._viewId,t._viewHeaderId,t._viewId,!0),this._viewPane.appendChild(this._versionViewerContainer),this._versionViewerSpinner=new A(t.versionViewerSpinnerElementId),this._versionsPaneSpinner=new A(t.versionsPaneSpinnerElementId),this._currentVersionSection=document.createElement("div"),this._currentVersionSection.className=t._currentVersionSectionCssClass,this._versionViewerSpinner.hide(),this._versionsPane.appendChild(this._versionsPaneSpinner.spinnerElement),this._viewContainer.appendChild(this._versionViewerSpinner.spinnerElement),this._currentVersionContainer=this.createSectionHeader("Current Version",this._currentVersionSection,null,null,null,!1),this._versionsPane.appendChild(this._currentVersionContainer),this._olderVersionsSection=document.createElement("div"),this._olderVersionsContainer=this.CreateCollapsibleSectionHeader(t._olderVersionsSectionId,"Older Versions",this._olderVersionsSection),this._versionsPane.appendChild(this._olderVersionsContainer),this._currentVersionContainer.style.display="none",this._olderVersionsContainer.style.display="none",this.reSizeDialog(),this._selectionHandler.resetAppVersionController(this._viewContainer)},t.prototype.updateVersionsPane=function(e){this._versionsPaneSpinner.hide(),this._versionViewerSpinner.show(),this._currentVersionContainer.style.display="block",this._olderVersionsContainer.style.display="block",this.ResizeViewContainer(),this.UpdateCurrentVersionSection(e),this.UpdateOlderVersionsSection(e);var t=[e.Versions[0],e.Versions.length>1?e.Versions[1]:null];this._selectionHandler.onVersionHistorySelected(t[0],t[1],this._viewContainer)},t.prototype.UpdateCurrentVersionSection=function(e){this._currentVersionSection.hasChildNodes()?this._currentVersionSection.replaceChild(this.fancyCreateVersion(e.Versions[0],e.Versions.length>1?e.Versions[1]:null),this._currentVersionSection.firstChild):this._currentVersionSection.appendChild(this.fancyCreateVersion(e.Versions[0],e.Versions.length>1?e.Versions[1]:null))},t.prototype.UpdateOlderVersionsSection=function(e){if(!(e.Versions.length<=1))for(var t=1;t<e.Versions.length;t++)this._olderVersionsSection.appendChild(this.fancyCreateVersion(e.Versions[t],e.Versions.length>t+1?e.Versions[t+1]:null))},t.versionViewerSpinnerElementId="VersionHistoryViewerSpinner",t.versionsPaneSpinnerElementId="VersionHistoryPaneSpinner",t._dialogId="VersionHistoryDialog",t._wacInnerFrameId="WACInnerFrame",t._wacStatusBarContainer="WACStatusBarContainer",t._arrowIconName="UpArrowServer",t._viewId="View",t._arrowId="Arrow",t._viewHeaderId="ViewHeader",t._viewContainerId="VersionHistoryViewContainer",t._olderVersionsSectionId="OlderVersions",t._currentVersionSectionCssClass="EmbedDimensionSection",t._sectionNameCssClass="EmbedSectionName UIFontBold",t._upArrowIconCssClass="OutlookSearchChevronUp_16x16x32",t._downArrowIconCssClass="OutlookSearchChevronDown_16x16x32",t._arrowHolderCssClass="WACGlyph EmbedArrowHolder",t._arrowImageCssClass="EmbedArrowIcon",t}(I.o);(0,r.l)(E,"11f65611$VersionHistoryDialog",I.o,[S]);var k=function(){function e(e){this._selectionHandler=null,this._initialized=!1,this._selectionHandler=e,this._initialized=!1}return e.prototype.Initialize=function(){this._initialized=!0},e.prototype.create=function(){return this._initialized?new E(this._selectionHandler):null},e}();(0,r.l)(k,"b8c91be5$VersionHistoryDialogFactory",null,[o]);var D=function(){function e(){this._container=null,this._appSettingsManager=null}return e.prototype.get_name=function(){return"Common.App.VersionHistory"},e.prototype.configure=function(e){var t=this;this._container=e,this._appSettingsManager=g.AFrameworkApplication.appSettingsManager,this._container.register(y).as(i).usingFactory((function(){return new y(g.AFrameworkApplication.get_theActionManager(),t._container.resolveLazy(o))})).singleInstance(),this._container.register(k).as(o).usingFactory((function(){return new k(t._container.resolve(a))})).singleInstance()},e.prototype.init=function(){this._appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(r.i(this,this.OnFullAppSettingsReady,"OnFullAppSettingsReady"))},e.prototype.OnFullAppSettingsReady=function(){g.AFrameworkApplication.isVersionHistorySupported()?this._appSettingsManager.getBooleanAppSetting("AppSupportsReactVersionHistory")?u.ULS.sendTraceTag(39890946,202,50,"VersionHistoryPackageManager:OnFullAppSettingsReady - Not initializing the VersionHistory package because the react package is enabled"):(u.ULS.sendTraceTag(38908760,202,50,"VersionHistoryPackageManager:OnFullAppSettingsReady - Initializing the VersionHistory package"),f.get_instance().registerActions(),this._container.resolve(k).Initialize(),this._container.resolve(i).registerActions()):u.ULS.sendTraceTag(38908759,202,50,"VersionHistoryPackageManager:OnFullAppSettingsReady - Not initializing the VersionHistory package because the feature is disabled")},e.prototype.dispose=function(){},e}();(0,r.l)(D,"d93e3928$PackageManager",null,[s.u,l.s]);var O=n(1526);n.d(t,{Program:function(){return U}});var U=function(){function e(){}return e.main=function(){O.o.get_instance().registerPackage(new D,7,!1)},e}();(0,r.l)(U,"87156c35$Program",null,[])},9713:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var r=(0,n(423).y)("99bd0298$IFidelityMetric")},9755:function(e,t,n){"use strict";var r=n(6189),i=n(6068),o=n(1822),a=n(2506),s=n(1308),l=n(3795),u=n(3748),c=n(5479),d=n(8540),p=n(5999),g=n(4192),h=n(3752),_=n(262),f=n(1388),m=n(423),y=function(){function e(){}return e.TryFindMergeBlockToSplit=function(t,n,r,i,a,s){i.val=0,a.val=!1,s.val=0;var l=0;if(!e.TryGetFirstIdxForGraphNodeId(t,n,(0,o.m)((function(){return l}),(function(e){return l=e}))))return d.p.get_instance().traceTag(18969440,1,4,"TryFindMergeBlockToSplit: Unable to find MergeBlock for [GraphNodeId: {0}] [MergeBlocks: {1}]",n,t.logString(" ")),!1;if(!r&&2===t.get_item(l).get_type())return i.val=l,!0;if(!t.get_item(l).isTextOrCharacterRun())return d.p.get_instance().shipAssertTag(17044256,1,!1,"TryFindMergeBlockToSplit: MergeBlock that at [Index: {0}] is of Unexpected type [MergeBlocks: {1}]",l,t.logString(" ")),!1;var u,c=!1,p=0;for(u=l;u<t.get_length()&&t.get_item(u).graphNodeId.equals(n);u++){if(r===p){c=!0;break}if(r>p&&r<p+t.get_item(u).get_length()){c=!0,a.val=!0,s.val=r-p;break}p+=t.get_item(u).get_length()}return c||r!==p||(c=!0),c&&(i.val=u),c},e.TrySplitMergeBlockInListAtIndexAndCp=function(e,t,n){var r;return e.get_item(t).isTextOrCharacterRun()&&e.get_item(t).splitAtIndex(n,(0,o.m)((function(){return r}),(function(e){return r=e})))?(e.insertRange(t+1,r),e.deleteAt(t),!0):(d.p.get_instance().traceTag(18969441,1,4,"TrySplitMergeBlockInListAtIndexAndCp: Unable to split at [Index: {0}] [Cp: {1}] [MergeBlocks: {2}]",t,n,e.logString(" ")),!1)},e.TrySplitMergeBlockListAtCp=function(t,n,r,i){var a,s,l;return i.val=0,!!e.TryFindMergeBlockToSplit(t,n,r,(0,o.m)((function(){return a}),(function(e){return a=e})),(0,o.m)((function(){return l}),(function(e){return l=e})),(0,o.m)((function(){return s}),(function(e){return s=e})))&&(l?e.TrySplitMergeBlockInListAtIndexAndCp(t,a,s)?(i.val=a+1,!0):(d.p.get_instance().traceTag(18969442,1,4,"TrySplitMergeBlockListAtCp: Unable to split at [GraphNodeId: {0}] [Cp: {1}] [MergeBlocks: {2}]",n,s,t.logString(" ")),!1):(i.val=a,!0))},e.TryGetFirstIdxForGraphNodeId=function(e,t,n){n.val=0;for(var r=0;r<e.get_length();r++)if(e.get_item(r).graphNodeId.equals(t))return n.val=r,!0;return d.p.get_instance().traceTag(18969443,1,4,"TryGetFirstIdxForGraphNodeId: Unable to find first idx [GraphNodeId: {0}] [MergeBlocks: {1}]",t,e.logString(" ")),!1},e.TryGetIdxNextEop=function(e,t,n){n.val=-1;for(var r=t;r<e.get_length();r++)if(2===e.get_item(r).get_type())return n.val=r,!0;return d.p.get_instance().traceTag(18969472,1,4,"TryGetIdxNextEop: Unable to find first idx [Index: {0}] [MergeBlocks: {1}]",t,e.logString(" ")),!1},e.TryGetIdxNextEopForGraphNodeId=function(e,t,n,r){r.val=-1;for(var i=n;i<e.get_length();i++)if(2===e.get_item(i).get_type()&&e.get_item(i).graphNodeId.equals(t))return r.val=i,!0;return d.p.get_instance().traceTag(18969473,1,4,"TryGetIdxNextEopForGraphNodeId: Unable to find EOP [GraphNodeId: {0}] [Index: {1}] [MergeBlocks: {2}]",t,n,e.logString(" ")),!1},e.TryGetTextLengthForParaId=function(t,n,r){var i;if(r.val=0,!e.TryGetFirstIdxForGraphNodeId(t,n,(0,o.m)((function(){return i}),(function(e){return i=e}))))return d.p.get_instance().traceTag(17342616,1,2,"Unable to find [GraphNodeId: {0}] [MergeBlocks: {1}]",n,t),!1;for(var a=i;a<t.get_length();a++)if(6!==t.get_item(a).get_type()){if(2===t.get_item(a).get_type())return!0;d.p.get_instance().shipAssertTag(17342617,1,t.get_item(a).isTextOrCharacterRun(),"We found something other than text with type "+t.get_item(a).get_type()),d.p.get_instance().shipAssertTag(17877021,1,t.get_item(a).graphNodeId.equals(n),"Unexpected GraphNodeId {0} for ParaId {1}",t.get_item(a).graphNodeId,n),r.val=r.val+t.get_item(a).get_length()}return d.p.get_instance().traceTag(18969474,1,4,"Unable to find [GraphNodeId: {0}] [MergeBlocks: {1}]",n,t),!1},e.Clone=function(e){for(var t=new c.o(f.AMergeBlock,null),n=0;n<e.get_length();n++)t.add(e.get_item(n).clone());return t},e}();(0,m.l)(y,"267b1d1d$MergeBlockListExtensions",null,[]);var v=n(1071),S=function(){function e(e,t,n,r){this.graphNodeId=null,this.type=0,this.text=null,this.wordId=null,this.graphNodeId=e,this.type=t,this.text=n,this.wordId=r}return e.prototype.isEqual=function(e){return e.graphNodeId.equals(this.graphNodeId)&&this.type===e.type&&this.wordId===e.wordId&&v.f.AreEquivalentStrings_IgnoreNbsp(this.text,e.text)},e.prototype.toString=function(){var e=String.format("[GraphNodeId: {0}] [WordId: {1}] [MergeBlockType: {2}]",this.graphNodeId,this.wordId,this.type);return e+=String.format(" [TextLength: {0}]",this.text.length)},e}();(0,m.l)(S,"1f8a7611$MergeBlockValidationState",null,[]);var I=n(5214),C=n(6096),T=n(8651),b=n(6639),A=n(7542),M=n(8465),P=n(6313),F=n(6849),w=n(3320),R=function(){function e(e,t,n,r){this.paraId=null,this.cp=0,this.baseMergeBlock=null,this.updatedFormattingMergeBlock=null,this.paraId=e,this.cp=t,this.baseMergeBlock=n,this.updatedFormattingMergeBlock=r}return e.prototype.get_paraId=function(){return this.paraId},e.prototype.get_cp=function(){return this.cp},e.prototype.get_baseMergeBlock=function(){return this.baseMergeBlock},e.prototype.get_updatedFormattingMergeBlock=function(){return this.updatedFormattingMergeBlock},e}();(0,m.l)(R,"5c9f7ec4$MergedListBlocksWithUpdateFormattingIds",null,[]);var E=n(3545),k=function(e){function t(t,n){var r=this;return r.wordId=0,r=e.call(this,6,t,n)||this}return(0,E.t)(t,e),t.prototype.toString=function(){var t=e.prototype.toString.call(this);return String.format("{0} [GraphNodeId: {1}]",t,this.graphNodeId)},t.prototype.getBlockTypeString=function(){return"Selection"},t.prototype.clone=function(){return new t(this.source,this.graphNodeId)},t.prototype.isEquivalentTo=function(e,t,n,r){return!1},t.prototype.get_length=function(){return 0},t}(f.AMergeBlock);(0,m.l)(k,"614e74b5$SelectionMergeBlock",f.AMergeBlock,[]);var D=n(4130),O=function(e){function t(t,n,r,i){var o=this;return o.$$pf_Text=null,o.updateHintId=null,(o=e.call(this,5,t,n)||this).set_text(r),o.updateHintId=i,o}return(0,E.t)(t,e),t.prototype.get_text=function(){return this.$$pf_Text},t.prototype.set_text=function(e){return this.$$pf_Text=e,e},t.prototype.get_updateHintId=function(){return this.updateHintId},t.prototype.clone=function(){return new t(this.source,this.graphNodeId,this.get_text(),this.get_updateHintId())},t.prototype.get_supportsSplitIntoMoreGranularBlocks=function(){return!(!this.get_text()||!this.get_text().length)},t.prototype.toString=function(){var t=e.prototype.toString.call(this);return String.format("{0}",t)},t}(D.ATextMergeBlock);(0,m.l)(O,"3716a462$UpdateHintTextMergeBlock",D.ATextMergeBlock,[]);var U=function(){function e(t,n,r){this.base=null,this.derived=null,this._mergeState=null,this.mergeConflict=!1,this._cancellableFavoredUpdateHints=new u.f(s.h),this._removedMergeBlocksForCancelledHints=new l.e(s.h,p.u.$$(f.AMergeBlock)),this._mergeState=t,this.base=n,this.derived=y.Clone(n),this._cancellableFavoredUpdateHints=r,e.ConnectMergeBlockLists(this.base,this.derived)}return e.prototype.get_mergeConflict=function(){return this.mergeConflict},e.prototype.applyUpdateHintToDerived=function(e){switch(e.get_type()){case 1:return this.ApplyInsertTextHintToDerived(e);case 2:return this.ApplyDeleteTextHintToDerived(e);case 3:return this.ApplySplitParaHintToDerived(e);case 4:return this.ApplyMergeParaHintToDerived(e);case 5:return this.ApplyAddParaHintToDerived(e);case 6:return this.ApplyDeleteParaHintToDerived(e);default:return!1}},e.prototype.applyUpdateHintToBaseAndDerived=function(e,t){switch(e.get_type()){case 1:return this.ApplyInsertTextHintToBaseAndDerived(e,t);case 2:return this.ApplyDeleteTextHintToBaseAndDerived(e,t);case 3:return this.ApplySplitParaHintToBaseAndDerived(e,t);case 4:return this.ApplyMergeParaHintToBaseAndDerived(e,t);case 5:return this.ApplyAddParaHintToBaseAndDerived(e,t);case 6:return this.ApplyDeleteParaHintToBaseAndDerived(e,t);default:return t.val=null,!1}},e.prototype.ApplyInsertTextHintToDerived=function(e){var t,n,r;if(!this.SplitTwinListAtCpForHint(e.get_paraId(),!1,e.get_cp(),!1,(0,o.m)((function(){return n}),(function(e){return n=e})),(0,o.m)((function(){return t}),(function(e){return t=e})),(0,o.m)((function(){return r}),(function(e){return r=e}))))return!1;var i=new O(2,e.get_paraId(),e.get_text(),e.get_id());return this.InsertBlocksInDerivedForFavoredUpdateHint(e,n,i),!0},e.prototype.ApplyDeleteTextHintToDerived=function(e){var t,n,r,i,a,s;return!!this.SplitTwinListAtCpForHint(e.get_paraId(),!1,e.get_cp(),!1,(0,o.m)((function(){return n}),(function(e){return n=e})),(0,o.m)((function(){return t}),(function(e){return t=e})),(0,o.m)((function(){return r}),(function(e){return r=e})))&&(!!this.SplitTwinListAtCpForHint(e.get_paraId(),!1,e.get_cp()+e.get_text().length,!1,(0,o.m)((function(){return a}),(function(e){return a=e})),(0,o.m)((function(){return i}),(function(e){return i=e})),(0,o.m)((function(){return s}),(function(e){return s=e})))&&(this.DeleteBlocksFromDerivedForFavoredUpdateHint(e,n,a),!0))},e.prototype.ApplySplitParaHintToDerived=function(e){var t,n,r;if(!this.GetIndicesAndCpForSplitPara(e,!1,(0,o.m)((function(){return t}),(function(e){return t=e})),(0,o.m)((function(){return n}),(function(e){return n=e})),(0,o.m)((function(){return r}),(function(e){return r=e}))))return!1;var i=new w.u(2,e.get_aboveParaId(),e.get_aboveWordId());return this.InsertBlocksInDerivedForFavoredUpdateHint(e,t,i),!0},e.prototype.ApplyMergeParaHintToDerived=function(e){var t;return!!this.GetIndicesForMergePara(e,this.derived,"Derived",(0,o.m)((function(){return t}),(function(e){return t=e})))&&(this.DeleteBlocksFromDerivedForFavoredUpdateHint(e,t,t+1),!0)},e.prototype.ApplyAddParaHintToDerived=function(e){var t,n;return!!this.GetMergeBlockAndIndexToInsertForAddPara(e,!1,(0,o.m)((function(){return t}),(function(e){return t=e})),(0,o.m)((function(){return n}),(function(e){return n=e})))&&(this.InsertBlocksInDerivedForFavoredUpdateHint(e,n,t),!0)},e.prototype.ApplyDeleteParaHintToDerived=function(e){var t;return!!this.GetIndexForDeletePara(e,this.derived,"Derived",(0,o.m)((function(){return t}),(function(e){return t=e})))&&(this.DeleteBlocksFromDerivedForFavoredUpdateHint(e,t,t+1),!0)},e.prototype.ApplyInsertCpPlaceHolderHintToDerived=function(e,t){var n,r,i;if(!this.SplitTwinListAtCpForHint(e,!1,t,!0,(0,o.m)((function(){return r}),(function(e){return r=e})),(0,o.m)((function(){return n}),(function(e){return n=e})),(0,o.m)((function(){return i}),(function(e){return i=e}))))return!1;var a=new k(2,e);return this.derived.insert(r,a),!0},e.prototype.ApplyInsertTextHintToBaseAndDerived=function(t,n){if(n.val=null,e.IsEmptyRunUpdateHint(t.get_text().length))return!1;var r,i,a,s;if(!this.SplitTwinListAtCpForHint(t.get_paraId(),!0,t.get_cp(),!1,(0,o.m)((function(){return r}),(function(e){return r=e})),(0,o.m)((function(){return i}),(function(e){return i=e})),(0,o.m)((function(){return a}),(function(e){return a=e}))))return!1;y.TryGetIdxNextEop(this.derived,i,(0,o.m)((function(){return s}),(function(e){return s=e})));var l=this.derived.get_item(s).graphNodeId,u=new O(4,t.get_paraId(),t.get_text(),t.get_id()),c=new O(4,l,t.get_text(),t.get_id());return this.ConnectMergeBlocks(u,c),this.base.insert(r,u),this.derived.insert(i,c),n.val=new A.s(l,a,t.get_text(),t.get_id(),t.get_inverseOfUpdateHintId()),!0},e.prototype.ApplyDeleteTextHintToBaseAndDerived=function(t,n){if(n.val=null,e.IsEmptyRunUpdateHint(t.get_text().length))return!1;var r,i,a,s,l,u;if(!this.SplitTwinListAtCpForHint(t.get_paraId(),!0,t.get_cp(),!1,(0,o.m)((function(){return r}),(function(e){return r=e})),(0,o.m)((function(){return i}),(function(e){return i=e})),(0,o.m)((function(){return a}),(function(e){return a=e}))))return!1;if(!this.SplitTwinListAtCpForHint(t.get_paraId(),!0,t.get_cp()+t.get_text().length,!1,(0,o.m)((function(){return s}),(function(e){return s=e})),(0,o.m)((function(){return l}),(function(e){return l=e})),(0,o.m)((function(){return u}),(function(e){return u=e}))))return!1;for(var c,p="",g=l-1;g>=i;g--)if(6!==this.derived.get_item(g).get_type()){if(!this.derived.get_item(g).twin)return d.p.get_instance().traceTag(17044294,1,2,"ApplyDeleteTextHintToBaseAndDerived: The range of merge blocks, that we are trying to delete in Base has new content in Derived"),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bbbng"})),this.mergeConflict=!0,!1;p=this.derived.get_item(g).get_text()+p,this.derived.deleteAt(g)}for(g=s-1;g>=r;g--)this.base.deleteAt(g);y.TryGetIdxNextEop(this.derived,i,(0,o.m)((function(){return c}),(function(e){return c=e})));var h=this.derived.get_item(c).graphNodeId;return n.val=new b.DeleteTextUpdateHint(h,a,p,t.get_id(),t.get_inverseOfUpdateHintId()),!0},e.prototype.ApplySplitParaHintToBaseAndDerived=function(e,t){var n,r,i,a;if(t.val=null,!this.GetIndicesAndCpForSplitPara(e,!0,(0,o.m)((function(){return n}),(function(e){return n=e})),(0,o.m)((function(){return r}),(function(e){return r=e})),(0,o.m)((function(){return i}),(function(e){return i=e}))))return!1;if(!y.TryGetIdxNextEop(this.derived,r,(0,o.m)((function(){return a}),(function(e){return a=e}))))return d.p.get_instance().traceTag(17342618,1,2,"ApplySplitParaHintToBaseAndDerived: Could not find corrsponding block in derived list."),!1;var s,l,u,c,p=this.derived.get_item(a).graphNodeId,g=this.derived.get_item(a).wordId;this.GetNewParaIdsAndWordIdsForSplitPara(e,a,(0,o.m)((function(){return s}),(function(e){return s=e})),(0,o.m)((function(){return l}),(function(e){return l=e})),(0,o.m)((function(){return u}),(function(e){return u=e})),(0,o.m)((function(){return c}),(function(e){return c=e}))),this.ChangeParaIdAndWordIdAfterSplit(this.derived,s,l,c,r);var h=new w.u(4,e.get_aboveParaId(),e.get_aboveWordId()),_=new w.u(4,s,u);return this.ConnectMergeBlocks(h,_),this.base.insert(n,h),this.derived.insert(r,_),t.val=new P.s(p,g,i,s,u,l,c,e.get_id(),e.get_inverseOfUpdateHintId()),!0},e.prototype.ApplyMergeParaHintToBaseAndDerived=function(e,t){var n,r,i,a,s,l,u,c,p,g;return t.val=null,!!this.GetIndicesForMergePara(e,this.base,"Base",(0,o.m)((function(){return n}),(function(e){return n=e})))&&(this.base.get_item(n).twin&&y.TryGetIdxNextEopForGraphNodeId(this.derived,this.base.get_item(n).twin.graphNodeId,0,(0,o.m)((function(){return r}),(function(e){return r=e})))?y.TryGetIdxNextEop(this.derived,r+1,(0,o.m)((function(){return i}),(function(e){return i=e})))?(this.GetCurrentMergedParaIdAndWordId(e,r,i,(0,o.m)((function(){return a}),(function(e){return a=e})),(0,o.m)((function(){return u}),(function(e){return u=e})),(0,o.m)((function(){return s}),(function(e){return s=e})),(0,o.m)((function(){return c}),(function(e){return c=e})),(0,o.m)((function(){return l}),(function(e){return l=e})),(0,o.m)((function(){return p}),(function(e){return p=e}))),!!y.TryGetTextLengthForParaId(this.derived,a,(0,o.m)((function(){return g}),(function(e){return g=e})))&&(this.ChangeParaIdAndWordIdAfterMerge(this.derived,a,u,r),this.derived.deleteAt(r),this.base.deleteAt(n),t.val=new M.MergeParagraphUpdateHint(s,c,g,l,p,a,u,e.get_id(),e.get_inverseOfUpdateHintId()),!0)):(d.p.get_instance().traceTag(17342620,1,2,"ApplyMergeParaHintToBaseAndDerived: We don't support operation as the below para on derived after merge is null"),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bckc2"})),this.mergeConflict=!0,!1):(d.p.get_instance().traceTag(17342619,1,2,"ApplyMergeParaHintToBaseAndDerived: We don't support operation where same para was deleted or split para was deleted by one"),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bckc1"})),this.mergeConflict=!0,!1))},e.prototype.ApplyAddParaHintToBaseAndDerived=function(e,t){var n,r,i;if(t.val=null,!this.GetMergeBlockAndIndexToInsertForAddPara(e,!0,(0,o.m)((function(){return i}),(function(e){return i=e})),(0,o.m)((function(){return n}),(function(e){return n=e}))))return!1;if(!this.GetIndexInSecondary(this.base,this.derived,n,!0,(0,o.m)((function(){return r}),(function(e){return r=e}))))return d.p.get_instance().traceTag(17146332,1,2,"ApplyAddParaHintToBaseAndDerived: We could not find the corresponding index in the Derived list."),!1;if(r>0&&2!==this.derived.get_item(r-1).get_type())return d.p.get_instance().traceTag(17342621,1,2,"ApplyAddParaHintToBaseAndDerived: We cannot insert a new para in a middle of an existing para"),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bckc3"})),this.mergeConflict=!0,!1;var a=null;if(!this.GetAboveParaIdFromDerived(r,(0,o.m)((function(){return a}),(function(e){return a=e}))))return!1;var s=new w.u(4,e.get_paraId(),e.get_wordId());return this.ConnectMergeBlocks(i,s),this.base.insert(n,i),this.derived.insert(r,s),t.val=new C.AddParagraphUpdateHint(e.get_paraId(),e.get_wordId(),a,e.get_id(),e.get_inverseOfUpdateHintId()),!0},e.prototype.ApplyDeleteParaHintToBaseAndDerived=function(e,t){var n,r;if(t.val=null,!this.GetIndexForDeletePara(e,this.base,"Base",(0,o.m)((function(){return r}),(function(e){return r=e}))))return!1;if(!this.base.get_item(r).twin||!this.base.get_item(r).twin.graphNodeId.equals(e.get_paraId()))return d.p.get_instance().traceTag(17135243,1,2,"ApplyDeleteParaHintToBaseAndDerived: We don't support operation where same para was deleted or split para was deleted by one"),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bbx0l"})),this.mergeConflict=!0,!1;if(!this.GetIndexInSecondary(this.base,this.derived,r,!0,(0,o.m)((function(){return n}),(function(e){return n=e}))))return d.p.get_instance().traceTag(17135244,1,2,"ApplyDeleteParaHintToBaseAndDerived: Possibly bad merge hints provided"),!1;if(n>0&&2!==this.derived.get_item(n).get_type())return d.p.get_instance().traceTag(17135245,1,2,"ApplyDeleteParaHintToBaseAndDerived: Detected new or leftover content in the list"),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bbx0n"})),this.mergeConflict=!0,!1;var i=this.derived.get_item(n).graphNodeId,a=this.derived.get_item(n).wordId;this.derived.deleteAt(n),this.base.deleteAt(r);var s=null;return this.GetAboveParaIdFromDerived(n,(0,o.m)((function(){return s}),(function(e){return s=e}))),n>0&&6===this.derived.get_item(n-1).get_type()&&this.PositionSelectionMergeBlockOnParagraphDelete(n-1,s),t.val=new T.a(i,a,s,e.get_id(),e.get_inverseOfUpdateHintId()),!0},e.prototype.ApplyInsertCpPlaceHolderHintToBaseAndDerived=function(e,t){var n,r,i,a;if(!this.SplitTwinListAtCpForHint(e,!0,t,!0,(0,o.m)((function(){return n}),(function(e){return n=e})),(0,o.m)((function(){return r}),(function(e){return r=e})),(0,o.m)((function(){return i}),(function(e){return i=e}))))return!1;y.TryGetIdxNextEop(this.derived,r,(0,o.m)((function(){return a}),(function(e){return a=e})));var s=this.derived.get_item(a).graphNodeId,l=new k(4,e),u=new k(4,s);return this.ConnectMergeBlocks(l,u),this.base.insert(n,l),this.derived.insert(r,u),!0},e.prototype.GetCurrentMergedParaIdAndWordId=function(e,t,n,r,i,o,a,s,l){e.get_mergedParaId().equals(e.get_paraId())?r.val=this.derived.get_item(t).graphNodeId:r.val=this.derived.get_item(n).graphNodeId,e.get_mergedWordId()===e.get_wordId()?i.val=this.derived.get_item(t).wordId:i.val=this.derived.get_item(n).wordId,o.val=this.derived.get_item(t).graphNodeId,a.val=this.derived.get_item(t).wordId,s.val=this.derived.get_item(n).graphNodeId,l.val=this.derived.get_item(n).wordId},e.prototype.GetNewParaIdsAndWordIdsForSplitPara=function(e,t,n,r,i,o){var a=e.get_paraId().equals(e.get_aboveParaId())?e.get_belowParaId():e.get_aboveParaId(),s=e.get_wordId()===e.get_aboveWordId()?e.get_belowWordId():e.get_aboveWordId();e.get_paraId().equals(e.get_aboveParaId())?(n.val=this.derived.get_item(t).graphNodeId,r.val=a):(n.val=a,r.val=this.derived.get_item(t).graphNodeId),e.get_wordId()===e.get_aboveWordId()?(i.val=this.derived.get_item(t).wordId,o.val=s):(i.val=s,o.val=this.derived.get_item(t).wordId)},e.prototype.ChangeParaIdsUntilNextEopAndSetWordId=function(e,t,n,r){for(var i=r;i<e.get_length();i++){if(!e.get_item(i).isTextOrCharacterRun()&&6!==e.get_item(i).get_type()&&2!==e.get_item(i).get_type())return void d.p.get_instance().shipAssertTag(17311188,1,!1,"Found merge block of type "+e.get_item(i).get_type());if(e.get_item(i).graphNodeId=t,2===e.get_item(i).get_type())return void(e.get_item(i).wordId=n)}},e.prototype.ChangeParaIdAndWordIdAfterSplit=function(t,n,r,i,o){this.ChangeParaIdsUntilNextEopAndSetWordId(t,r,i,o),e.ChangeParaIdsUntilPrevEop(t,n,o)},e.prototype.ChangeParaIdAndWordIdAfterMerge=function(t,n,r,i){this.ChangeParaIdsUntilNextEopAndSetWordId(t,n,r,i+1),e.ChangeParaIdsUntilPrevEop(t,n,i-1)},e.prototype.GetIndicesForMergePara=function(e,t,n,r){var i=-1;return y.TryGetIdxNextEopForGraphNodeId(t,e.get_paraId(),0,r)?y.TryGetIdxNextEop(t,r.val+1,(0,o.m)((function(){return i}),(function(e){return i=e})))&&t.get_item(i).graphNodeId.equals(e.get_belowParaId())?(this.ChangeParaIdAndWordIdAfterMerge(t,e.get_mergedParaId(),e.get_mergedWordId(),r.val),!0):(d.p.get_instance().traceTag(17342623,1,2,"GetIndicesForMergePara: Failed to find index "+r.val+"1 in "+n+" of length "+t.get_length()),!1):(d.p.get_instance().traceTag(17342622,1,2,"GetIndicesForMergePara: Failed to find index of EOP in "+n+"for GraphNodeId "+e.get_paraId()),!1)},e.prototype.GetIndicesAndCpForSplitPara=function(e,t,n,r,i){var o=t?this.base:this.derived,a=t?"Base":"Derived";return this.SplitTwinListAtCpForHint(e.get_paraId(),t,e.get_cp(),!1,n,r,i)?(this.ChangeParaIdAndWordIdAfterSplit(o,e.get_aboveParaId(),e.get_belowParaId(),e.get_belowWordId(),n.val),!0):(d.p.get_instance().traceTag(17311189,1,2,"GetIndicesAndCpForSplitPara: Failed to find indices and Cp for "+a),!1)},e.prototype.GetIndexForDeletePara=function(e,t,n,r){var i;return r.val=-1,y.TryGetFirstIdxForGraphNodeId(t,e.get_paraId(),(0,o.m)((function(){return i}),(function(e){return i=e})))?2!==t.get_item(i).get_type()?(d.p.get_instance().traceTag(17156034,1,2,"GetIndexForDeletePara: Found merge block that is not a zero length merge block "+n),!1):(r.val=i,!0):(d.p.get_instance().traceTag(17156033,1,2,"GetIndexForDeletePara: Failed to find the para in "+n),!1)},e.prototype.PositionSelectionMergeBlockOnParagraphDelete=function(e,t){var n=this.derived.get_item(e);if(t){var r;y.TryGetIdxNextEopForGraphNodeId(this.derived,t,0,(0,o.m)((function(){return r}),(function(e){return r=e})));var i=n.clone();i.graphNodeId=t,this.derived.deleteAt(e),this.derived.insert(r,i)}else this.derived.get_length()>e&&(this.derived.get_item(e+1).isTextOrCharacterRun()||2===this.derived.get_item(e+1).get_type())&&(n.graphNodeId=this.derived.get_item(e+1).graphNodeId)},e.prototype.GetMergeBlockAndIndexToInsertForAddPara=function(e,t,n,r){var i=t?this.base:this.derived,o=t?4:2,a=t?"Base":"Derived";if(n.val=new w.u(o,e.get_paraId(),e.get_wordId()),e.get_aboveParaId()){if(!y.TryGetIdxNextEopForGraphNodeId(i,e.get_aboveParaId(),0,r))return d.p.get_instance().traceTag(17146333,1,2,"GetMergeBlockAndIndexToInsertForAddPara: We could not find [AboveParaId: {0}] in {1}",e.get_aboveParaId(),a),!1;r.val=r.val+1}else r.val=0;return!0},e.prototype.GetAboveParaIdFromDerived=function(e,t){t.val=null;var n=e-1;return-1===n||(6===this.derived.get_item(n).get_type()&&n--,2===this.derived.get_item(n).get_type()||4===this.derived.get_item(n).get_type()?(t.val=this.derived.get_item(n).graphNodeId,!0):(d.p.get_instance().traceTag(17342934,1,2,"GetAboveParaIdFromDerived: We found an unexpected block [Type: {0}] above",this.derived.get_item(e-1).get_type()),!1))},e.prototype.GetIndexInSecondary=function(e,t,n,r,i){var o=!0;if(i.val=-1,n>e.get_length())return d.p.get_instance().traceTag(17146334,1,2,"GetIndexInSecondary: Index supplied for the primary is out of bounds"),!1;if(n<e.get_length()){if(n>-1&&n<e.get_length()&&!e.get_item(n).twin){o=!1;for(var a=n+1;a<e.get_length();a++)if(e.get_item(a).twin){n=a,o=!0;break}}if(!o)return!1;o=!1;for(a=0;e.get_item(n)&&a<t.get_length();a++)if(t.get_item(a).twin===e.get_item(n)){i.val=a,o=!0;break}if(!o)return!1}else i.val=t.get_length();if(i.val>0&&r&&!t.get_item(i.val-1).twin){for(a=i.val-1;a>=0&&!t.get_item(a).twin;a--);i.val=a+1,6===t.get_item(i.val).get_type()&&5!==this._mergeState.input.Source&&i.val++}return!0},e.prototype.SplitTwinListAtCpForHint=function(e,t,n,r,i,a,s){var l=this.base,u=this.derived;t||(l=this.derived,u=this.base),i.val=0,a.val=0,s.val=0;var c,p,g=!1,h=0;if(!y.TryFindMergeBlockToSplit(l,e,n,(0,o.m)((function(){return c}),(function(e){return c=e})),(0,o.m)((function(){return g}),(function(e){return g=e})),(0,o.m)((function(){return h}),(function(e){return h=e}))))return d.p.get_instance().traceTag(17044295,1,2,"SplitTwinListAtCpForHint: Unable to find the merge block to split at given Cp. It most likely means that our update hints are not complete"),!1;if(c>=0&&c<l.get_length()&&!l.get_item(c).twin&&g&&!r)return d.p.get_instance().traceTag(17044296,1,2,"SplitTwinListAtCpForHint: We are trying to split a merge block that is deleted in the other revision. Failing merge"),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bbbni"})),this.mergeConflict=!0,!1;if(r&&!l.get_item(c)&&c--,r&&g&&!l.get_item(c).twin&&(g=!1,h=0),!t&&!y.TryGetFirstIdxForGraphNodeId(u,e,(0,o.m)((function(){return p}),(function(e){return p=e}))))return i.val=c,!0;if(!this.GetIndexInSecondary(l,u,c,t&&!g,(0,o.m)((function(){return p}),(function(e){return p=e}))))return d.p.get_instance().traceTag(17156037,1,2,"SplitTwinListAtCpForHint: We are trying to find index in derived when the para most likley doesn't exist."),this._mergeState.logger.logMergeFailureDetail((0,I.m)(new F.y,{funcSource:"ParagraphMergeUsingHintsTwinList",eventId:"bb25f"})),this.mergeConflict=!0,!1;if(g&&(!y.TrySplitMergeBlockInListAtIndexAndCp(l,c,h)||!y.TrySplitMergeBlockInListAtIndexAndCp(u,p,h)))return d.p.get_instance().shipAssertTag(17044297,1,!1,"SplitTwinListAtCpForHint: Unable find the twin in secondary or unable to split the lists when a split was needed"),!1;if(i.val=c,a.val=p,g&&(this.ConnectMergeBlocks(l.get_item(c),u.get_item(p)),this.ConnectMergeBlocks(l.get_item(c+1),u.get_item(p+1)),i.val=c+1,a.val=p+1),a.val>=u.get_length())return d.p.get_instance().shipAssertTag(17311190,1,!1,"SplitTwinListAtCpForHint: We are in bad state. indexInSecondary was "+a.val+" secondaryList length was "+u.get_length()),!1;for(var _=0;_<a.val;_++)u.get_item(_).graphNodeId.equals(u.get_item(a.val).graphNodeId)&&(s.val+=u.get_item(_).get_length());return!0},e.prototype.DeleteBlocksFromDerivedForFavoredUpdateHint=function(e,t,n){this._cancellableFavoredUpdateHints.contains(e.get_id())&&this._removedMergeBlocksForCancelledHints.set_item(e.get_id(),new c.o(f.AMergeBlock,null));for(var r=n-1;r>=t;r--)this._cancellableFavoredUpdateHints.contains(e.get_id())?this._removedMergeBlocksForCancelledHints.get_item(e.get_id()).insert(this._removedMergeBlocksForCancelledHints.get_item(e.get_id()).get_length(),this.derived.get_item(r)):this.derived.get_item(r).twin&&(this.derived.get_item(r).twin.twin=null),this.derived.deleteAt(r)},e.prototype.InsertBlocksInDerivedForFavoredUpdateHint=function(e,t,n){if(this._removedMergeBlocksForCancelledHints.containsKey(e.get_inverseOfUpdateHintId())){for(var r=this._removedMergeBlocksForCancelledHints.get_item(e.get_inverseOfUpdateHintId()),i=0;i<r.get_length();i++)r.get_item(i).graphNodeId=n.graphNodeId,m.r(w.u,n)&&m.r(w.u,r.get_item(i))&&(r.get_item(i).wordId=n.wordId);this.derived.insertRange(t,this._removedMergeBlocksForCancelledHints.get_item(e.get_inverseOfUpdateHintId())),this._removedMergeBlocksForCancelledHints.remove(e.get_inverseOfUpdateHintId())}else this.derived.insert(t,n)},e.prototype.ConnectMergeBlocks=function(e,t){e.twin=t,t.twin=e},e.prototype.GetTwinInDeriveForBlockInBase=function(e,t,n){if(t.val=-1,n.val=-1,!e.twin)return!1;var r,i=0,a=!1;if(!y.TryGetFirstIdxForGraphNodeId(this.derived,e.twin.graphNodeId,(0,o.m)((function(){return r}),(function(e){return r=e}))))return!1;for(var s=r;s<this.derived.get_length();s++){if(e.twin===this.derived.get_item(s)){t.val=s,n.val=i,a=!0;break}i+=this.derived.get_item(s).get_length()}return a},e.prototype.findMergeBlocksInUnfavoredWithUpdatedFormattingInfo=function(e,t){t.val=new c.o(R,null);for(var n=0,r=0,i=function(){if(r>=a.base.get_length())return d.p.get_instance().shipAssertTag(17335388,1,!1,"FindMergeBlocksInUnfavoredWithUpdatedFormattingInfo: idxBase out of range"),{value:!1};if(e.get_item(n).get_length()>a.base.get_item(r).get_length()){if(!y.TrySplitMergeBlockInListAtIndexAndCp(e,n,a.base.get_item(r).get_length()))return d.p.get_instance().traceTag(17335389,1,2,"FindMergeBlocksInUnfavoredWithUpdatedFormattingInfo: Unable to split UnfavoredRevision MergeBlock [Idx: {0}] at [Cp: {1}]",n,a.base.get_item(r).get_length()),{value:!1}}else if(e.get_item(n).get_length()<a.base.get_item(r).get_length()){var i=!!a.base.get_item(r).twin,s=0;if(i&&!a.GetIndexInSecondary(a.base,a.derived,r,!1,(0,o.m)((function(){return s}),(function(e){return s=e}))))return d.p.get_instance().shipAssertTag(17335390,1,!1,"FindMergeBlocksInUnfavoredWithUpdatedFormattingInfo: Base Merge Block at [Idx: {0}] has a Twin, but we are unable to find it",r),{value:!1};if(!y.TrySplitMergeBlockInListAtIndexAndCp(a.base,r,e.get_item(n).get_length())||i&&!y.TrySplitMergeBlockInListAtIndexAndCp(a.derived,s,e.get_item(n).get_length()))return d.p.get_instance().traceTag(17335391,1,2,"FindMergeBlocksInUnfavoredWithUpdatedFormattingInfo: Unable to split Base and/or Derived Merge blocks"),{value:!1};i&&(a.ConnectMergeBlocks(a.base.get_item(r),a.derived.get_item(s)),a.ConnectMergeBlocks(a.base.get_item(r+1),a.derived.get_item(s+1)))}if(a.base.get_item(r).twin&&5!==a.base.get_item(r).get_type()&&a.base.get_item(r).isTextOrCharacterRun()){var l=a.base.get_item(r),u=e.get_item(n);if(!l.get_formatId().equals(u.get_formatId())){var c,p;if(!a.GetTwinInDeriveForBlockInBase(a.base.get_item(r),(0,o.m)((function(){return c}),(function(e){return c=e})),(0,o.m)((function(){return p}),(function(e){return p=e}))))return{value:!1};t.val.add(new R(a.derived.get_item(c).graphNodeId,p,l,u))}}n++,r++},a=this;n<e.get_length();){var s=i();if("object"==typeof s)return s.value}return!0},e.ChangeParaIdsUntilPrevEop=function(e,t,n){for(var r=n-1;r>=0;r--){if(!e.get_item(r).isTextOrCharacterRun()&&6!==e.get_item(r).get_type())return void d.p.get_instance().shipAssertTag(17311187,1,2===e.get_item(r).get_type()||4===e.get_item(r).get_type(),"Found merge block of type "+e.get_item(r).get_type());e.get_item(r).graphNodeId=t}},e.IsEmptyRunUpdateHint=function(e){return!e&&(d.p.get_instance().traceTag(17156036,1,2,"IsEmptyRunUpdateHint: We are trying to insert an empty run. It is likely we have bad merge hints."),!0)},e.ConnectMergeBlockLists=function(e,t){for(var n=0;n<e.get_length();n++)e.get_item(n).twin=t.get_item(n),t.get_item(n).twin=e.get_item(n)},e}();(0,m.l)(U,"d1f597da$ParagraphMergeUsingHintsTwinList",null,[]);var x=n(9495),L=n(833);n.d(t,{i:function(){return N}});var N=function(){function e(e,t,n,i,o,a,l){this._mergeState=null,this._baseObjects=null,this._unfavoredObjects=null,this._favoredObjects=null,this._baseObjectIds=null,this._unfavoredObjectIds=null,this._favoredObjectIds=null,this._mergeableObjectUtilities=null,this._baseRevisionMergeBlocks=null,this._favoredRevisionMergeBlocks=null,this._unfavoredRevisionMergeBlocks=null,this._mergeTwinList=null,this._featureEnableLookup=null,this._updateHintFactory=null,this._initialized=!1,this._failureReason=0,this._favoredUpdateHints=new c.o(r.z,null),this._unfavoredUpdateHints=new c.o(r.z,null),this._mergeState=e,this._baseObjects=t,this._unfavoredObjects=i,this._favoredObjects=n,this._featureEnableLookup=o,this._baseObjectIds=new u.f(s.h);for(var d=0;d<this._baseObjects.get_length();d++)this._baseObjectIds.add(this._baseObjects.get_item(d).get_id());this._favoredObjectIds=new u.f(s.h);for(d=0;d<this._favoredObjects.get_length();d++)this._favoredObjectIds.add(this._favoredObjects.get_item(d).get_id());this._unfavoredObjectIds=new u.f(s.h);for(d=0;d<this._unfavoredObjects.get_length();d++)this._unfavoredObjectIds.add(this._unfavoredObjects.get_item(d).get_id());this._mergeableObjectUtilities=a||new g.s,this._updateHintFactory=l||_.y.get_instance(),this._failureReason=0}return e.prototype.get_retryMergeWithoutHints=function(){return 1!==this._failureReason},e.prototype.InitializeUpdateHints=function(){var e=this,t=!0;if(this._mergeState.runtime.FavoredObjects.containsKey(h.c.updateHintsContainerNodeObjectId)){var n=this._mergeState.runtime.FavoredObjects.get_item(h.c.updateHintsContainerNodeObjectId);t=this.ValidateUpdateHintsContainerBaseId(n,this._mergeState.runtime.CommonBaseLastChange.get_id(),"favored")&&this.InitializeUpdateHintsListForParagraphs(n,this._baseObjectIds,this._favoredObjectIds,this._mergeState.runtime.FavoredObjects,"favored",(0,o.m)((function(){return e._favoredUpdateHints}),(function(t){return e._favoredUpdateHints=t})))}if(t&&this._mergeState.runtime.UnfavoredObjects.containsKey(h.c.updateHintsContainerNodeObjectId)){var r=this._mergeState.runtime.UnfavoredObjects.get_item(h.c.updateHintsContainerNodeObjectId);t=this.ValidateUpdateHintsContainerBaseId(r,this._mergeState.runtime.CommonBaseLastChange.get_id(),"unfavored")&&this.InitializeUpdateHintsListForParagraphs(r,this._baseObjectIds,this._unfavoredObjectIds,this._mergeState.runtime.UnfavoredObjects,"unfavored",(0,o.m)((function(){return e._unfavoredUpdateHints}),(function(t){return e._unfavoredUpdateHints=t})))}if(t&&this._mergeState.input.IgnoreConflictsInLastServerRevision){var i=this._mergeState.input.TheirChanges.last().getMergeableObject(h.c.updateHintsContainerNodeObjectId);t=this.ValidateUpdateHintsContainerBaseId(i,this._mergeState.input.TheirChanges.last().get_baseMergeableRevision().get_id(),"alreadyMerged")}return t},e.prototype.InitializeCancellableUpdateHintsInFavored=function(){for(var e=new u.f(s.h),t=this._favoredUpdateHints.shallowClone(),n=0;n<t.get_length()-1;){var r=t.get_item(n),i=void 0,o=!1;for(i=n+1;i<t.get_length();i++){var a=t.get_item(i);if(r.isInverse(a)){e.add(r.get_id()),t.deleteAt(i),t.deleteAt(n),o=!0;break}}o||n++}return e},e.prototype.ValidateUpdateHintsContainerBaseId=function(e,t,n){var r=this._mergeableObjectUtilities.getPropertyString(e,a.j.updateHintsContainerNodeBaseRevision),i=s.h.createFromString(r);return!!t.equals(i)||(this.SetMergeFailureReason(2),d.p.get_instance().traceTag(17162307,1,2,"ParagraphMergeUsingHints: ValidateUpdateHintsContainerBaseId returned failure [MergeBaseId: {0}] [UpdateHintsContainerBaseId: {1}] [RevisionType: {2}]",this._mergeState.runtime.CommonBaseLastChange.get_id(),i,n),!1)},e.prototype.InitializeUpdateHintsListForParagraphs=function(e,t,n,i,o,l){l.val=new c.o(r.z,null);for(var u=this._mergeableObjectUtilities.getPropertyObjectIds(e,a.j.updateHintNodes).shallowClone(),p=0;p<u.get_length();p++){if(!i.containsKey(u.get_item(p)))return d.p.get_instance().traceTag(17044257,1,2,"ParagraphMergeUsingHints: InitializeUpdateHintsListForParagraphs unable to find [UpdateHintObject: {0}] in [RevisionType: {1}]",u.get_item(p),o),!1;var g=i.get_item(u.get_item(p)),h=s.h.createFromString(this._mergeableObjectUtilities.getPropertyString(g,a.j.updateHintParaId));if(t.contains(h)||n.contains(h)){var _=this._updateHintFactory.getUpdateHintFromObject(g);if(!_)return d.p.get_instance().traceTag(17044258,1,2,"ParagraphMergeUsingHints: InitializeUpdateHintsListForParagraphs unable to create a updateHint for [UpdateHintObject: {0}]  in [RevisionType: {1}]",g.get_id(),o),!1;l.val.add(_)}}return u.get_length()>0&&d.p.get_instance().traceTag(17162308,1,4,"ParagraphMergeUsingHints: InitializeUpdateHintsListForParagraphs for [RevisionType: {0}] [UpdateHintIds: {1}] [UpdateHints: {2}]",o,u.logString(" "),l.val.logString(" ")),!0},e.prototype.InitializeMergeBlocksForMerge=function(){var e,t,n,r=this;return!!x.ParagraphMergeUtils.CreateMergeBlocksForMergeInputObjects(this._mergeState,this._mergeableObjectUtilities,this._baseObjects,this._favoredObjects,this._unfavoredObjects,!0,!0,this._featureEnableLookup(14),(0,o.m)((function(){return r._baseRevisionMergeBlocks}),(function(e){return r._baseRevisionMergeBlocks=e})),(0,o.m)((function(){return r._favoredRevisionMergeBlocks}),(function(e){return r._favoredRevisionMergeBlocks=e})),(0,o.m)((function(){return r._unfavoredRevisionMergeBlocks}),(function(e){return r._unfavoredRevisionMergeBlocks=e})),(0,o.m)((function(){return e}),(function(t){return e=t})),(0,o.m)((function(){return t}),(function(e){return t=e})),(0,o.m)((function(){return n}),(function(e){return n=e})))},e.prototype.InitializeTwinTextMergeBlocks=function(e){var t,n=this,r=x.ParagraphMergeUtils.CreateMergeBlocksForGraphObjects(this._mergeableObjectUtilities,(function(e){return n._mergeState.runtime.BaseObjects.get_item(e)}),this._baseObjects,1,!0,!0,this._featureEnableLookup(14),(0,o.m)((function(){return t}),(function(e){return t=e})));return r?(this._mergeTwinList=new U(this._mergeState,r,e),!0):(d.p.get_instance().traceTag(17044259,1,2,"InitializeTwinTextMergeBlocks:Unable to create merge blocks for the base or derived"),!1)},e.prototype.Initialize=function(){if(this._initialized)return!1;if(this._initialized=!0,!this.InitializeUpdateHints())return!1;if(!this.InitializeMergeBlocksForMerge())return!1;var e=this.InitializeCancellableUpdateHintsInFavored();return!!this.InitializeTwinTextMergeBlocks(e)},e.prototype.GetMergeBlockValidationStateFromMergeBlockList=function(e){for(var t=new c.o(S,null),n="",r=0;r<e.get_length();r++){var i=e.get_item(r);i.isTextOrCharacterRun()?n+=e.get_item(r).get_text():2===i.get_type()?(t.add(new S(i.graphNodeId,i.get_type(),n,i.wordId)),n=""):4===i.get_type()&&(t.add(new S(i.graphNodeId,i.get_type(),null,null)),n="")}return t},e.prototype.ValidateUpdateHintsAreComplete=function(e,t,n){var r=this.GetMergeBlockValidationStateFromMergeBlockList(t),i=this.GetMergeBlockValidationStateFromMergeBlockList(e),o=r.get_length()===i.get_length();if(o)for(var a=0;a<r.get_length();a++)if(!r.get_item(a).isEqual(i.get_item(a))){o=!1;break}return o||(this.SetMergeFailureReason(4),d.p.get_instance().traceTag(17044288,1,2,"ValidateUpdateHintsAreComplete: Validation of update hints from [Revision: {0}] was unsuccessful [MergeValidationState: {1}] [RevisionValidationState: {2}]",n,i.logString(" "),r.logString(" "))),o},e.prototype.ApplyUpdateHints=function(e,t,n,r){var i=this.ApplyUpdateHintsInternal(e,t,n,r);return i||this.SetMergeFailureReason(this._mergeTwinList.get_mergeConflict()?1:3),i},e.prototype.ApplyUpdateHintsInternal=function(e,t,n,i){i.val=new c.o(r.z,null);for(var a=!0,s=0,l=null,u=function(e){var t;(l=p._favoredUpdateHints.get_item(e),s<p._unfavoredUpdateHints.get_length()&&l.get_id().equals(p._unfavoredUpdateHints.get_item(s).get_id())&&5!==p._mergeState.input.Source)?(a=p._mergeTwinList.applyUpdateHintToBaseAndDerived(l,(0,o.m)((function(){return t}),(function(e){return t=e}))),s++):a=p._mergeTwinList.applyUpdateHintToDerived(l)},p=this,g=0;g<this._favoredUpdateHints.get_length()&&a;g++)u(g);if(!a)return d.p.get_instance().traceTag(17044289,1,2,"ApplyUpdateHints: Failed to apply favored [UpdateHint: {0}]",l.toString()),!1;if(!this.ValidateUpdateHintsAreComplete(this._mergeTwinList.derived,this._favoredRevisionMergeBlocks,"Favored"))return!1;if(e&&1===this._mergeState.input.MergeHint&&!this._mergeTwinList.ApplyInsertCpPlaceHolderHintToDerived(t,n))return d.p.get_instance().traceTag(17409920,1,2,"ApplyUpdateHints: Unable to insert placeholder Cp in [ParaId: {0}] [Cp: {1}]",t,n),!1;a=!0;var h=new c.o(r.z,null),_=function(e){var t;l=f._unfavoredUpdateHints.get_item(e),(a=f._mergeTwinList.applyUpdateHintToBaseAndDerived(l,(0,o.m)((function(){return t}),(function(e){return t=e}))))&&t&&h.add(t)},f=this;for(g=s;g<this._unfavoredUpdateHints.get_length()&&a;g++)_(g);return a?!!this.ValidateUpdateHintsAreComplete(this._mergeTwinList.base,this._unfavoredRevisionMergeBlocks,"Unfavored")&&(e&&2===this._mergeState.input.MergeHint&&!this._mergeTwinList.ApplyInsertCpPlaceHolderHintToBaseAndDerived(t,n)?(d.p.get_instance().traceTag(17409921,1,2,"ApplyUpdateHints: Unable to insert placeholder Cp in [ParaId: {0}] [Cp: {1}]",t,n),!1):(i.val=h,!0)):(d.p.get_instance().traceTag(17044291,1,2,"ApplyUpdateHints: Failed to apply unfavored [UpdateHint: {0}] [Type: {1}]",l.get_id(),l.get_type()),!1)},e.prototype.GetMergeBlocksToInsertForUnfavoredUpdateHints=function(e){var t=0,n=0,r=0,i=s.h.get_nil();e.val=new l.e(s.h,p.u.$$(f.AMergeBlock));for(var a=function(){var a=u._mergeTwinList.base.get_item(r);if(i.equals(a.graphNodeId)||(t=0,i=a.graphNodeId),5===a.get_type()){var s,l;n=t+a.get_length();var p=y.Clone(u._unfavoredRevisionMergeBlocks);if(!y.TrySplitMergeBlockListAtCp(p,a.graphNodeId,t,(0,o.m)((function(){return s}),(function(e){return s=e})))||!y.TrySplitMergeBlockListAtCp(p,a.graphNodeId,n,(0,o.m)((function(){return l}),(function(e){return l=e}))))return d.p.get_instance().traceTag(17335384,1,2,"GetMergeBlocksToInsertForUnfavoredUpdateHints: Unable to extract merge blocks from unfavored to insert in favored for [UpdateHintId: {0}]",a.get_updateHintId()),{value:!1};for(var g=new c.o(f.AMergeBlock,null),h=s;h<l;h++)g.add(p.get_item(h));e.val.set_item(a.get_updateHintId(),g)}t+=a.get_length(),r++},u=this;r<this._mergeTwinList.base.get_length();){var g=a();if("object"==typeof g)return g.value}return!0},e.prototype.ApplyMergedUnfavoredHintsToFavoredToMergeFavoredFormattingChanges=function(e,t){var n;if(t.val=new c.o(f.AMergeBlock,null),!this.GetMergeBlocksToInsertForUnfavoredUpdateHints((0,o.m)((function(){return n}),(function(e){return n=e}))))return!1;var r=new U(this._mergeState,y.Clone(this._favoredRevisionMergeBlocks),new u.f(s.h));d.p.get_instance().traceTag(18989576,1,4,"ApplyMergedUnfavoredHintsToFavoredToMergeFavoredFormattingChanges: Apply merged [UpdateHints: {0}] to favored [MergeBlocks: {1}]",e.logString(" "),this._favoredRevisionMergeBlocks.logString(" "));for(var i=0;i<e.get_length();i++)if(!r.applyUpdateHintToDerived(e.get_item(i)))return!1;for(i=r.derived.get_length()-1;i>=0;i--)if(5===r.derived.get_item(i).get_type()){var a=r.derived.get_item(i).get_updateHintId();r.derived.deleteAt(i),r.derived.insertRange(i,n.get_item(a))}return!!this.ValidateUpdateHintsAreComplete(this._mergeTwinList.derived,r.derived,"Merged")&&(t.val=r.derived,!0)},e.prototype.ApplyUnfavoredFormattingChanges=function(e){var t;if(!this._mergeTwinList.findMergeBlocksInUnfavoredWithUpdatedFormattingInfo(y.Clone(this._unfavoredRevisionMergeBlocks),(0,o.m)((function(){return t}),(function(e){return t=e}))))return!1;for(var n=function(n){var r,i,a=t.get_item(n);if(!y.TrySplitMergeBlockListAtCp(e,a.get_paraId(),a.get_cp(),(0,o.m)((function(){return r}),(function(e){return r=e})))||!y.TrySplitMergeBlockListAtCp(e,a.get_paraId(),a.get_cp()+a.get_updatedFormattingMergeBlock().get_length(),(0,o.m)((function(){return i}),(function(e){return i=e}))))return d.p.get_instance().traceTag(17335386,1,2,"ApplyUnfavoredFormattingChanges: Unable to find corresponding merge blocks with update formatting in merged list"),{value:!1};for(var s=!1,l=r;l<i&&!s;l++)s=!a.get_baseMergeBlock().get_formatId().equals(e.get_item(l).get_formatId());if(s)return"continue";for(l=r;l<i;l++)e.deleteAt(r);e.insert(r,a.get_updatedFormattingMergeBlock())},r=0;r<t.get_length();r++){var i=n(r);if("object"==typeof i)return i.value}return!0},e.prototype.GetPartialMergeResultForUpdateHintNodes=function(t,n,r){var i;r.val=new c.o(L.o,null),n.val=this._mergeState.runtime.MergedObjects.get_item(h.c.updateHintsContainerNodeObjectId),e.GetAlreadyMergedUpdateHintFromLastServerRevision(this._mergeState,this._mergeableObjectUtilities,(0,o.m)((function(){return i}),(function(e){return i=e})));for(var l=new c.o(s.h,null),u=0;u<t.get_length();u++)if(!i.contains(t.get_item(u).get_id(),(function(e,t){return e.equals(t)}))){if(this._mergeState.runtime.MergedObjects.containsKey(t.get_item(u).get_id()))return d.p.get_instance().shipAssertTag(17044293,1,!1,"[UpdateHint: {0}] is already in the merged object. Failing merge.",t.get_item(u).get_id()),!1;l.add(t.get_item(u).get_id());for(var p=t.get_item(u).getNodeForUpdateHint(),g=new L.o(p,!0),_=0,f=p.listProperties();_<f.length;_++){var m=f[_];g.addTouchedProperty(m)}r.val.add(g)}var y=this._mergeableObjectUtilities.getPropertyObjectIds(n.val.mergeableObject,a.j.updateHintNodes);return y.insertRange(y.get_length(),l),this._mergeableObjectUtilities.setPropertyObjectIds(n.val.mergeableObject,a.j.updateHintNodes,y),!0},e.prototype.GetExceptionLog=function(e){return String.format("Name: {0}, Message: {1}, Stack: {2}",e.name,e.message,e.stack)},e.prototype.SetMergeFailureReason=function(e){this._failureReason||(this._failureReason=e)},e.prototype.tryDoMerge=function(e){var t,n,r;e.val=null;try{if(this.TryDoMergeInternal((0,o.m)((function(){return t}),(function(e){return t=e})),e,(0,o.m)((function(){return n}),(function(e){return n=e})),(0,o.m)((function(){return r}),(function(e){return r=e})))){this._mergeState.runtime.MergedObjects.set_item(n.mergeableObject.get_id(),n);for(var i=0;i<r.get_length();i++){var s=r.get_item(i);this._mergeState.runtime.MergedObjects.set_item(s.mergeableObject.get_id(),s)}var l=n.mergeableObject,u=this._mergeableObjectUtilities.getPropertyObjectIds(l,a.j.updateHintNodes),c=this._mergeableObjectUtilities.getPropertyString(l,a.j.updateHintsContainerNodeBaseRevision);return d.p.get_instance().traceTag(17162312,1,4,"ParagraphMergeUsingHints returned success [UpdateHintsContainerNodeIds: {0}] [UpdateHintsContainerBaseId: {1}]",u.logString(" "),c),!0}}catch(e){d.p.get_instance().traceTag(17162313,1,2,"ParagraphMergeUsingHints Crashed! Retrying ParagraphMerge [{0}]",this.GetExceptionLog(e))}return this.SetMergeFailureReason(5),d.p.get_instance().traceTag(17409922,1,2,"TryDoMerge: ParagraphMergeUsingHints returned failure [MergeFailureReason:{0}] [RetryMergeWithoutHints:{1}]",this._failureReason,this.get_retryMergeWithoutHints()),this.LogFailedParagraphMerge(),!1},e.prototype.TryDoMergeInternal=function(e,t,n,r){t.val=null,n.val=null,r.val=null;var i=!1;i=this.Initialize();var a=null;i=i&&this.ApplyUpdateHints(!1,s.h.get_nil(),0,(0,o.m)((function(){return a}),(function(e){return a=e})));var l=new c.o(f.AMergeBlock,null);(i=i&&this.ApplyMergedUnfavoredHintsToFavoredToMergeFavoredFormattingChanges(a,(0,o.m)((function(){return l}),(function(e){return l=e}))))&&(this.ApplyUnfavoredFormattingChanges(l)||d.p.get_instance().traceTag(17162314,1,2,"TryDoMerge: Failed to apply unfavored formatting changes. We will let the merge succeed anyways"));for(var u=new c.o(s.h,null),p=0;p<l.get_length();p++)2===l.get_item(p).get_type()&&u.add(l.get_item(p).graphNodeId);return i=(i=i&&x.ParagraphMergeUtils.GetMergeableObjectsFromMergeBlocks(this._mergeState,this._mergeableObjectUtilities,this._featureEnableLookup,l,u,t))&&this.GetPartialMergeResultForUpdateHintNodes(a,n,r),e.val=!!this._mergeTwinList&&this._mergeTwinList.get_mergeConflict(),i},e.prototype.LogFailedParagraphMerge=function(){var e=new c.o(s.h,null);x.ParagraphMergeUtils.LogFailedObjects(this._mergeableObjectUtilities,"BaseObjects_",this._baseObjects,e),x.ParagraphMergeUtils.LogFailedObjects(this._mergeableObjectUtilities,"FavoredObjects_",this._favoredObjects,e),x.ParagraphMergeUtils.LogFailedObjects(this._mergeableObjectUtilities,"ConflictObjects_",this._unfavoredObjects,e)},e.prototype.CalculatePositionOfPlaceHolderCp=function(e,t){e.val=s.h.get_nil(),t.val=-1;for(var n=0,r=0;r<this._mergeTwinList.derived.get_length();r++){var i=this._mergeTwinList.derived.get_item(r);if(i.isTextOrCharacterRun())n+=i.get_length();else{if(6===i.get_type())return e.val=i.graphNodeId,t.val=n,!0;n=0}}return d.p.get_instance().traceTag(17409923,1,2,"CalculatePositionOfPlaceHolderCp: Unable to find placeholder Cp"),!1},e.prototype.updateCpAccordingToIncomingChange=function(e,t,n,r){r.val=t,n.val=e;try{var i=this.Initialize(),a=null;if(i=(i=i&&this.ApplyUpdateHints(!0,e,t,(0,o.m)((function(){return a}),(function(e){return a=e}))))&&this.CalculatePositionOfPlaceHolderCp(n,r))return d.p.get_instance().traceTag(17409924,1,4,"UpdateCpAccordingToIncomingChange returned success [ResultObjectId: {0}] [ResultCp: {1}]",n.val,r.val),!0}catch(e){d.p.get_instance().traceTag(17409925,1,2,"UpdateCpAccordingToIncomingChange Crashed! Retrying using the old method [{0}]",this.GetExceptionLog(e))}return this.SetMergeFailureReason(5),d.p.get_instance().traceTag(17409926,1,2,"UpdateCpAccordingToIncomingChange: ParagraphMergeUsingHints returned failure [MergeFailureReason:{0}] [RetryMergeWithoutHints:{1}]",this._failureReason,this.get_retryMergeWithoutHints()),this.LogFailedParagraphMerge(),!1},e.GetAlreadyMergedUpdateHintFromLastServerRevision=function(e,t,n){if(n.val=new c.o(s.h,null),!e.input.IgnoreConflictsInLastServerRevision)return!0;var r=e.input.TheirChanges.last().getMergeableObject(h.c.updateHintsContainerNodeObjectId);return n.val=t.getPropertyObjectIds(r,a.j.updateHintNodes),!0},e.preProcessUpdateHintsContainer=function(e){if(!x.ParagraphMergeUtils.doesGraphContainUpdateHintsContainerNodes(e,null))return!0;var t=new g.s;return e.runtime.MergedObjects.set_item(h.c.updateHintsContainerNodeObjectId,x.ParagraphMergeUtils.InitializeUpdateHintsContainerNodeForMerge(e,t)),!0},e.postProcessUpdateHintsContainer=function(t){if(!t.runtime.MergedObjects.containsKey(h.c.updateHintsContainerNodeObjectId))return!0;if(!t.runtime.UnfavoredObjects.containsKey(h.c.updateHintsContainerNodeObjectId))return!0;var n=new g.s,r=t.runtime.MergedObjects.get_item(h.c.updateHintsContainerNodeObjectId),i=n.getPropertyString(r.mergeableObject,a.j.updateHintsContainerNodeBaseRevision);if(s.h.createFromString(i).equals(s.h.get_nil()))return!0;var l,u=n.getPropertyObjectIds(r.mergeableObject,a.j.updateHintNodes),c=n.getPropertyObjectIds(t.runtime.UnfavoredObjects.get_item(h.c.updateHintsContainerNodeObjectId),a.j.updateHintNodes);e.GetAlreadyMergedUpdateHintFromLastServerRevision(t,n,(0,o.m)((function(){return l}),(function(e){return l=e})));for(var d=0;d<c.get_length();d++)u.contains(c.get_item(d),(function(e,t){return e.equals(t)}))||l.contains(c.get_item(d),(function(e,t){return e.equals(t)}))||(u.add(c.get_item(d)),t.runtime.MergedObjects.set_item(c.get_item(d),new L.o(t.runtime.UnfavoredObjects.get_item(c.get_item(d)).cloneForMerge(),!0)));return n.setPropertyObjectIds(r.mergeableObject,a.j.updateHintNodes,u),!0},e}();(0,m.l)(N,"a797ba1c$ParagraphMergeUsingHints",null,[i.v])},9795:function(e,t,n){"use strict";n.d(t,{k:function(){return r}});var r=(0,n(423).y)("83b5f65$IGestureInputManager")},9882:function(e,t,n){"use strict";n.r(t),t.default=window.InteractivePerfTaskPaneData={name:"CommandUI",attrs:{xmlns:"http://schemas.microsoft.com/sharepoint/"},children:[{name:"TaskPane",attrs:{Id:"InteractivePerfTaskPane",Title:"Interactive Perf TaskPane",Width:"400"},children:[{name:"Groups",attrs:{},children:[{name:"Group",attrs:{Id:"TypingSpeedMeterGroup"}},{name:"Group",attrs:{Id:"CpuMeterGroup"}},{name:"Group",attrs:{Id:"RenderGroup"}}]}]}]}},9921:function(e,t,n){"use strict";n.d(t,{z:function(){return r}});var r=(0,n(423).y)("7a4faf86$IListValue")},9961:function(e,t,n){"use strict";n.d(t,{l:function(){return a}});var r=n(3545),i=n(4072),o=n(423),a=function(e){function t(t){var n=e.call(this)||this;return n.element=null,n.element=t,n}return(0,r.t)(t,e),t.prototype.get_visible=function(){return"visible"===this.element.style.visibility},t.prototype.set_visible=function(e){return this.element.style.visibility=e?"visible":"hidden",e},t.prototype.get_rtl=function(){return"rtl"===this.element.dir.toLowerCase()},t.prototype.set_rtl=function(e){return this.element.dir=e?"rtl":"ltr",e},t.prototype.get_zIndex=function(){return this.element.style.zIndex},t.prototype.set_zIndex=function(e){return this.element.style.zIndex=String(e),e},t.prototype.dispose=function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,e.prototype.dispose.call(this)},t.prototype.createElement=function(e){return this.element.ownerDocument.createElement(e)},t.prototype.stopPropagationAndPreventDefaultBehavior=function(e){return!0},t.createRtlFriendlyClassName=function(e,t){return e+(t?"Rtl":"")},t}(i.f);(0,o.l)(a,"fe423129$BasePresenceControl",i.f,[Sys.IDisposable])},9974:function(e,t,n){"use strict";var r=n(423),i=(0,r.y)("f7815243$ISequentialIdGenerator");n.d(t,{q:function(){return o}});var o=function(){function e(){this._ssidRtt=0,this._ssidPresence=0,this._ssidRtt=this._ssidPresence=0}return e.prototype.getNextPacketIdForRttOp=function(){return this._ssidRtt===Number.MAX_VALUE&&(this._ssidRtt=0),this._ssidRtt++,this._ssidRtt},e.prototype.getNextPacketIdForPresence=function(){return this._ssidPresence===Number.MAX_VALUE&&(this._ssidPresence=0),this._ssidPresence++,this._ssidPresence},e.get_instance=function(){return e._ssidGenerator},e._ssidGenerator=new e,e}();(0,r.l)(o,"5965f9f4$StrictlySequentialIdGenerator",null,[i])},9988:function(e,t,n){"use strict";var r=n(3545),i=n(423),o=n(4956),a=n(4925),s=n(1822),l=n(9961),u=n(3517),c=n(7597),d=n(1331),p=n(4556),g=function(){function e(){}return e.getDancingDots=function(t,n,r,i){return e.GetDancingDotsSvg(t,n,r,i)},e.GetDancingDotsSvg=function(t,n,r,i){var o=document.createElementNS(e.XmlNamespace,"svg");return o.setAttribute("viewBox",String.format(e.DancingDotsViewBoxString,e.ViewBoxWidth,e.ViewBoxHeight)),o.appendChild(e.GetSvgGroup(t,n,r,i)),o},e.GetSvgGroup=function(t,n,r,i){var o=e.ViewBoxWidth/t,a=n/2*o,s=e.ViewBoxHeight/2,l=0;i&&(l=(t-3*n-4*r)*o/2);var u=document.createElementNS(e.XmlNamespace,"g");u.setAttribute("class",e.DancingDotsClassName),u.setAttribute("fill",e.DancingDotsColor);for(var c=1;c<=3;c++){var d=l+(c*(n+r)-n/2)*o;u.appendChild(e.GetCircle(c,a,d,s))}return u},e.GetCircle=function(t,n,r,i){var o=document.createElementNS(e.XmlNamespace,"circle");return o.setAttribute("class",String.format("{0}-{1}",e.CircleClassNamePrefix,t)),o.setAttribute("cx",String.format("{0}",r)),o.setAttribute("cy",String.format("{0}",i)),o.setAttribute("r",String.format("{0}",n)),o},e.XmlNamespace="http://www.w3.org/2000/svg",e.DancingDotsClassName="prDancingDots",e.CircleClassNamePrefix="prAnimateCircle",e.DancingDotsViewBoxString="0 0 {0} {1}",e.DancingDotsColor="#FFFFFF",e.ViewBoxHeight=40,e.ViewBoxWidth=120,e}();(0,i.l)(g,"a1d3d815$ModernPresenceTooltipDancingDots",null,[]);var h=n(9354),_=n(2753),f=n(1135),m=n(25),y=n(6410),v=n(6020),S=n(3258),I=n(6378),C=function(e){function t(n,r){var i=e.call(this,n)||this;return i._clickInputManager=null,i._pointerInputManager=null,i._contextMenuInputManager=null,i._settings=null,i._span=null,i._img=null,i._editingIcon=null,i._dimension=0,i._rtl=!1,i._useIdleTooltip=!1,i._class=null,i._fadeOutTimeout=0,i._fadeOutElement=null,i.user=null,i.state=0,i._rtl=r.get(Boolean,8),i._dimension=r.get(Number,6),i._useIdleTooltip=r.get(Boolean,15),i._settings=r,i._fadeOutTimeout=0,i.element=n,i.element.className=t.FlyoutContainerClassName,i._span=document.createElement("span"),i.element.appendChild(i._span),i._editingIcon=g.getDancingDots(r.get(Number,6),4,2,!0),i.RegisterHandlers(r),i.state=5,i}return(0,r.t)(t,e),t.prototype.add_InteractivityChanged=function(e){this.addHandler(d.q.InteractivityChangedEventKey,e)},t.prototype.remove_InteractivityChanged=function(e){this.removeHandler(d.q.InteractivityChangedEventKey,e)},t.prototype.get_user=function(){return this.user},t.prototype.get_state=function(){return this.state},t.prototype.dispose=function(){this.element&&(this._clickInputManager.unregisterHandler(f.d.click,this.element,i.i(this,this.OnClick,"OnClick")),this._clickInputManager.unregisterHandler(f.d.doubleClick,this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),this._pointerInputManager.unregisterHandler(f.d.pointerDown,this.element,i.i(this,this.OnPointerDown,"OnPointerDown")),this._pointerInputManager.unregisterHandler(f.d.pointerOut,this.element,i.i(this,this.OnPointerOut,"OnPointerOut")),this._pointerInputManager.unregisterHandler(f.d.pointerOver,this.element,i.i(this,this.OnPointerOver,"OnPointerOver")),this._contextMenuInputManager.unregisterHandler(this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior"))),e.prototype.dispose.call(this)},t.prototype.RegisterHandlers=function(e){this._clickInputManager=e.get(p.p,10),this._clickInputManager.registerHandler(f.d.click,this.element,i.i(this,this.OnClick,"OnClick")),this._clickInputManager.registerHandler(f.d.doubleClick,this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior")),this._pointerInputManager=e.get(o.k,9),this._pointerInputManager.registerHandler(f.d.pointerOver,this.element,i.i(this,this.OnPointerOver,"OnPointerOver")),this._pointerInputManager.registerHandler(f.d.pointerOut,this.element,i.i(this,this.OnPointerOut,"OnPointerOut")),this._pointerInputManager.registerHandler(f.d.pointerDown,this.element,i.i(this,this.OnPointerDown,"OnPointerDown")),this._contextMenuInputManager=e.get(_.r,13),this._contextMenuInputManager.registerHandler(this.element,i.i(this,this.stopPropagationAndPreventDefaultBehavior,"stopPropagationAndPreventDefaultBehavior"))},t.prototype.Hide=function(e){this._useIdleTooltip&&e?this.ShowIdleTooltipFlyout(e):(this.set_visible(!1),this.state=5)},t.prototype.ShowIdleTooltipFlyout=function(e){this.Show(e,0,t._idleTooltipFlyoutOffsetHeight,4,!1,0)},t.prototype.ShowCollapsedFlyout=function(e,n,r,i,o,a,s){var l=i?2:o?1:0;this.Show(e,n,r+t._expandedAndCollapsedTooltipFlyoutOffsetHeight,l,a,s)},t.prototype.ShowExpandedFlyout=function(e,n,r,i,o){this.Show(e,n,r+t._expandedAndCollapsedTooltipFlyoutOffsetHeight,3,i,o)},t.prototype.Show=function(e,t,n,r,i,o){!e||r===this.get_state()&&this.HasSameCssPosition(t,n)||(this.AddClassesForState(r,i),this.AddUser(e,r),this.state=r,4===o||!o&&!this._rtl?this.element.style.left=t+"px":this.element.style.right=t+"px",this.element.style.top=n+"px",this.set_visible(!0))},t.prototype.AddUser=function(e,n){if(this.user=e,y.s.clearElement(this._span),m.o.clearStyles(this._span),this._span.id=t._flyoutIdPrefix+e.get_clientId(),this._span.style.backgroundColor=e.get_color(),4!==n?(this._span.style.height=this._dimension+"px",this._span.style.lineHeight=this._dimension+"px",m.o.setStyle(this._span,"border-radius",this._dimension+"px")):this._rtl?this._span.style.right="0px":this._span.style.left="0px",2!==n)if(4===n)y.s.setElementText(this._span,"");else if(1===n)this._span.appendChild(this._editingIcon);else{var r=I.l.getInitials(e.get_userName(),!1,!1);if(!e.get_isAnonymous()&&r||n){var i=e.get_userName();n||(i=r,m.o.setStyle(this._span,"text-align","center")),y.s.setElementText(this._span,i),this._span.setAttribute("dir","auto")}else this._img||(this._img=this.CreateAnonymousImageTag()),this._span.appendChild(this._img)}},t.prototype.OnClick=function(e){return this.get_state()?(3===this.get_state()&&c.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill."),!1):(this.raiseEvent(d.q.InteractivityChangedEventKey,new d.q(1,e),null),!0)},t.prototype.OnPointerOut=function(e){return 3===this.get_state()&&this.raiseEvent(d.q.InteractivityChangedEventKey,new d.q(3,e),null),!1},t.prototype.OnPointerOver=function(e){return 3!==e.get_inputSource()&&this.raiseEvent(d.q.InteractivityChangedEventKey,new d.q(2,e),null),!1},t.prototype.OnPointerDown=function(e){return 3!==e.get_inputSource()?this.stopPropagationAndPreventDefaultBehavior(e):(this.raiseEvent(d.q.InteractivityChangedEventKey,new d.q(4,e),null),!1)},t.prototype.CreateAnonymousImageTag=function(){var e=document.createElement("img");return e.setAttribute("src",S.h.commonImage("doughperson_white_glyph.svg")),e.setAttribute("Unselectable","on"),e.setAttribute(v.t.ariaRoleAttribute,v.t.ariaPresentationRole),h.ImageClusteringHelper.createClusteredImageFromClusterWithImageClass(this._dimension,this._dimension,null,null,t.FlyoutImageClassName,"",!1,"",this.element.ownerDocument,e)},t.prototype.AddClassesForState=function(e,n){if(!this.IsCollapsedState(this.get_state())||!this.IsCollapsedState(e))switch(Sys.UI.DomElement.removeCssClass(this.element,this._class),this.get_state()){case 4:3===e?this.AddClassesToFlyoutElement(t.FlyoutExpandedClassName,t.FlyoutFromIdleClassName):this.IsCollapsedState(e)&&this.AddClassesToFlyoutElement(t.FlyoutCollapsedClassName,t.FlyoutFromIdleClassName);break;case 3:4===e?this.AddClassesToFlyoutElement(t.FlyoutIdleClassName,t.FlyoutFromExpandedClassName):this.IsCollapsedState(e)&&(n&&this.RemoveFadeOutElement(),this.AddClassesToFlyoutElement(t.FlyoutCollapsedClassName,t.FlyoutFromExpandedClassName,n?t.FlyoutFromStackedClassName:""));break;case 0:case 1:case 2:4===e?this.AddClassesToFlyoutElement(t.FlyoutIdleClassName,t.FlyoutFromCollapsedClassName):3===e&&(n&&this.AddFadeOutElement(),this.AddClassesToFlyoutElement(t.FlyoutExpandedClassName,t.FlyoutFromCollapsedClassName,n?t.FlyoutStackedClassName:""));break;default:4===e?this.AddClassesToFlyoutElement(t.FlyoutIdleClassName):3===e?this.AddClassesToFlyoutElement(t.FlyoutExpandedClassName):this.IsCollapsedState(e)&&this.AddClassesToFlyoutElement(t.FlyoutCollapsedClassName)}},t.prototype.AddClassesToFlyoutElement=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._class=e.join(" "),Sys.UI.DomElement.addCssClass(this.element,this._class)},t.prototype.AddFadeOutElement=function(){var e=this;this._fadeOutTimeout=window.setTimeout((function(){e.element&&(e._fadeOutElement=e.element.cloneNode(!0),e.element.parentNode.appendChild(e._fadeOutElement),e.element.style.zIndex="2",e._fadeOutElement.style.zIndex="1")}),t._fadeOutElementTimeoutMs)},t.prototype.RemoveFadeOutElement=function(){var e=this;window.clearTimeout(this._fadeOutTimeout),this._fadeOutElement&&(Sys.UI.DomElement.removeCssClass(this._fadeOutElement,t.FlyoutFromCollapsedClassName+" "+t.FlyoutStackedClassName),Sys.UI.DomElement.addCssClass(this._fadeOutElement,t.FlyoutFadeOutClassName),u.Task.delay(t._fadeOutElementTimeoutMs).CW((function(t){e.element.parentNode===e._fadeOutElement.parentNode&&e.element.parentNode.removeChild(e._fadeOutElement)})),m.o.removeStyle(this.element,"z-index"))},t.prototype.IsCollapsedState=function(e){return!e||1===e||2===e},t.prototype.HasSameCssPosition=function(e,t){var n=m.o.parseIntDefaultZero(this.element.style.left),r=m.o.parseIntDefaultZero(this.element.style.top);return n===e&&r===t},t.prototype.rerenderForDirection=function(e){if(3===e&&m.o.checkStyleExist(this.element,"left")){var t=m.o.parseIntDefaultZero(this.element.style.left);m.o.removeStyle(this.element,"left"),this.element.style.right=-1*t+"px"}else if(4===e&&m.o.checkStyleExist(this.element,"right")){var n=m.o.parseIntDefaultZero(this.element.style.right);m.o.removeStyle(this.element,"right"),this.element.style.left=-1*n+"px"}},t.FlyoutContainerClassName="prModernFlyout UIFont",t.FlyoutIdleClassName="flyoutIdle",t.FlyoutExpandedClassName="flyoutExpanded",t.FlyoutCollapsedClassName="flyoutCollapsed",t.FlyoutFromIdleClassName="flyoutFromIdle",t.FlyoutFromExpandedClassName="flyoutFromExpanded",t.FlyoutFromCollapsedClassName="flyoutFromCollapsed",t.FlyoutStackedClassName="flyoutStacked",t.FlyoutFromStackedClassName="flyoutFromStacked",t.FlyoutFadeOutClassName="flyoutFadeOut",t.FlyoutImageClassName="cui-img-cont-float cui-img-20by20",t._flyoutIdPrefix="fly_",t._idleTooltipFlyoutOffsetHeight=15,t._expandedAndCollapsedTooltipFlyoutOffsetHeight=20,t._fadeOutElementTimeoutMs=300,t}(l.l);(0,i.l)(C,"d58103ab$ModernPresenceTooltipFlyoutControl",l.l,[]);var T=function(){return function(e,t,n,r){this.offsetTop=0,this.offsetLeft=0,this.verticalDirection=0,this.horizontalDirection=0,this.offsetTop=e,this.offsetLeft=t,this.verticalDirection=n,this.horizontalDirection=r}}();(0,i.l)(T,"a500d9db$FlyoutsPositioningInfo",null,[]);var b=n(5989),A=function(){function e(e,t){this._isRtl=!1,this._flipHorizontalDirection=!1,this._isRtl=e,this._flipHorizontalDirection=t}return e.prototype.getLaunchOffsetForViewport=function(e,t,n,r,i,o){var a=o.y,s=o.height,l=this.GetBoundingY(i),u=l+t,c=e*t+(e-1)*r,d=null,p=null;if(1===e||this.CanFitLaunchingDown(l,c,a,s))d=new T(0,0,2,4);else{var g=(d=this.FitFlyoutVertically(u,c,a,s)).offsetTop-l;d.offsetTop=g}if(this._flipHorizontalDirection)p=new T(0,0,2,this._isRtl?4:3);else{var h=this.GetBoundingX(i,o),_=Math.max(0,o.x),f=o.width,m=h,y=h+t;this.CanFitLaunchingInDefaultDirection(m,n,_,f)?p=new T(0,0,2,this._isRtl?3:4):this.CanFitLaunchingInFlippedDirection(y,n,_)&&(p=new T(0,0,2,this._isRtl?4:3)),p||(p=this.FitFlyoutHorizontally(m,y,n,_,f))}return new T(d.offsetTop,p.offsetLeft,d.verticalDirection,p.horizontalDirection)},e.prototype.GetBoundingY=function(e){return b.g.getBoundingTop(e)},e.prototype.GetBoundingX=function(e,t){return this._isRtl?t.width-b.g.getBoundingRight(e):b.g.getBoundingLeft(e)},e.prototype.CanFitLaunchingDown=function(e,t,n,r){return e+t<=n+r},e.prototype.FitFlyoutVertically=function(e,t,n,r){var i=1,o=Math.max(n,e-t);t>e-n&&(i=2,o=t<r?r-t:n);return new T(o,0,i,4)},e.prototype.CanFitLaunchingInDefaultDirection=function(e,t,n,r){return e+t<=n+r},e.prototype.CanFitLaunchingInFlippedDirection=function(e,t,n){return t<=e-n},e.prototype.FitFlyoutHorizontally=function(e,t,n,r,i){var o,a;return i-t>=e-r?(a=t,o=4):(a=e,o=3),new T(0,a,2,o)},e}();(0,i.l)(A,"646cfebf$ModernPresenceTooltipPositioner",null,[]);var M=function(){function e(t,n,r,i,o,a,s){this._flyouts=null,this._parent=null,this._rtl=!1,this._collapsedTooltipSize=0,this._collapsedPadding=0,this._idleTooltipSize=0,this._targetSize=0,this.element=null,this._flyouts=t,this._parent=n,this._collapsedTooltipSize=r,this._collapsedPadding=i,this._idleTooltipSize=o,this._targetSize=a,this._rtl=s,this.element=document.createElement("div"),this.get_element().className=e.TouchTargetClassName}return e.prototype.get_element=function(){return this.element},e.prototype.update=function(e,t){if(3!==e)if(5!==e&&this._flyouts&&this._flyouts.length){var n=0,r=0,i=0,o=0;4===e?(i=this._idleTooltipSize,o=(this._targetSize-i)/2,this.get_element().style.height=this._targetSize+"px",this.get_element().style.width=this._targetSize+"px",n=m.o.parseIntDefaultZero(this._flyouts[0].element.style.top),r=m.o.parseIntDefaultZero(this._rtl?this._flyouts[0].element.style.right:this._flyouts[0].element.style.left)):(i=this._collapsedTooltipSize,o=(this._targetSize-i)/2,this.get_element().style.height=this._targetSize+"px",this.get_element().style.width=this.GetCollapsedWidth()+2*o+"px",n=m.o.parseIntDefaultZero(this._flyouts[this._flyouts.length-1].element.style.top),r=this.CalculateTargetXOffset(this._flyouts[this._flyouts.length-1].element,i,t)),m.o.setStyle(this.get_element(),"border-radius",this._targetSize+"px"),this.get_element().style.top=n-o-i+"px",this._rtl?this.get_element().style.right=r-o+"px":this.get_element().style.left=r-o+"px",this.get_element().parentNode||this._parent.insertBefore(this.get_element(),this._parent.firstChild)}else this.get_element().parentNode&&this.get_element().parentNode.removeChild(this.get_element())},e.prototype.CalculateTargetXOffset=function(e,t,n){return this._rtl&&!n?m.o.parseIntDefaultZero(e.style.right):this._rtl||n?this._rtl&&n?-m.o.parseIntDefaultZero(e.style.left)-t:-m.o.parseIntDefaultZero(e.style.right)-t:m.o.parseIntDefaultZero(e.style.left)},e.prototype.GetCollapsedWidth=function(){return this._flyouts&&this._flyouts.length?this._collapsedTooltipSize+Math.min(this._flyouts.length-1,2)*this._collapsedPadding:0},e.TouchTargetClassName="prTouchTarget",e}();(0,i.l)(M,"f1f24fc0$ModernPresenceTooltipTarget",null,[]);var P=n(7413),F=n(2953);n.d(t,{b:function(){return w}});var w=function(e){function t(n,r,a){var s=e.call(this,n)||this;return s.get_element=s.get_Element$2,s._isRtl=!1,s._forcedExpandedFlyout=!1,s._showingAllFlyouts=!1,s._inSelectionMode=!1,s._inCollapseTimeout=!1,s._size=0,s._lastPrimaryFlyoutIndex=0,s._renderedInNonDefaultOrientation=!1,s._hidesInIdleMode=!1,s._flipHorizontalDirection=!1,s._pendingDispose=!1,s._idToFlyout=null,s._flyoutContainer=null,s._hitTarget=null,s._activeEditorIds=null,s._idsToRemove=null,s._positioner=null,s._activeFlyoutOrientation=0,s._pointerInputManager=null,s._settings=null,s._viewportBoundsCallback=null,s.flyouts=null,s.defaultZIndex=0,s.bubbleDimension=0,s._users=[],s._idToFlyout={},s._settings=a,s._isRtl=a.get(Boolean,8),s._hidesInIdleMode=a.get(Boolean,15),s.defaultZIndex=a.get(Number,12),s.bubbleDimension=a.get(Number,6),s._size=r,s._viewportBoundsCallback=a.get(Function,16),s._flipHorizontalDirection=a.get(Boolean,17),s._lastPrimaryFlyoutIndex=0,s._positioner=new A(s._isRtl,s._flipHorizontalDirection),s._activeFlyoutOrientation=s.GetDefaultFlyoutDirection(),s._pendingDispose=!1,s._activeEditorIds=[],s._idsToRemove=[],s.element.id=t.GenerateId(),s.element.className=l.l.createRtlFriendlyClassName(t.PresenceTooltipClassName,s._isRtl),s.get_defaultZIndex()&&s.set_zIndex(s.get_defaultZIndex()),s.set_rtl(s._isRtl),s.SetControlDimensions(r),s._flyoutContainer=s.createElement("div"),s._flyoutContainer.className=t.FlyoutContainerClassName,s.element.appendChild(s._flyoutContainer),s.flyouts=[],s._hitTarget=new M(s.get_flyouts(),s.element,s.bubbleDimension,t.HorizontalPaddingBetweenUsers,t.IdleTooltipSize,t.TouchTargetSize,s._isRtl),s._pointerInputManager=a.get(o.k,9),s._pointerInputManager.registerHandler(f.d.pointerDown,s._hitTarget.get_element(),i.i(s,s.OnTouchTarget,"OnTouchTarget")),s}return(0,r.t)(t,e),t.prototype.get_presenceUserList=function(){return F.p.clone(this._users)},t.prototype.get_flyouts=function(){return this.flyouts},t.prototype.get_defaultZIndex=function(){return this.defaultZIndex},t.prototype.get_Element$2=function(){return this.element},t.prototype.add_interactivityChanged=function(e){this.addHandler(d.q.InteractivityChangedEventKey,e)},t.prototype.remove_interactivityChanged=function(e){this.removeHandler(d.q.InteractivityChangedEventKey,e)},t.prototype.dispose=function(){if(3!==this.GetFrontFlyoutState()){if(this.get_flyouts())for(var t=0,n=this.get_flyouts();t<n.length;t++){var r=n[t];r.remove_InteractivityChanged(i.i(this,this.OnInteractivityChanged,"OnInteractivityChanged")),P.d.safeDispose(r)}this.flyouts=null,this._pointerInputManager.unregisterHandler(f.d.pointerDown,this._hitTarget.get_element(),i.i(this,this.OnTouchTarget,"OnTouchTarget")),e.prototype.dispose.call(this)}else this._pendingDispose=!0},t.prototype.showIconOnly=function(){this.CollapseFlyouts(!1),this.set_visible(!0),this._forcedExpandedFlyout=!1},t.prototype.showIconAndText=function(){this.set_visible(!0),this.ExpandFlyouts(),this._forcedExpandedFlyout=!0},t.prototype.showAllIconsAndTexts=function(){this.set_visible(!0),this.ExpandFlyouts(),this._forcedExpandedFlyout=!1},t.prototype.hide=function(){this.RemovePendingUsers(5),this.HideAllFlyouts(),this.set_visible(!1),this._forcedExpandedFlyout=!1,this._hitTarget.update(this.GetFrontFlyoutState(),this._renderedInNonDefaultOrientation)},t.prototype.addUser=function(e){e.get_clientId()||e.set_clientId((t._instanceCounter++).toString());var n=0;if(e.get_clientId()in this._idToFlyout&&(n=this.FindUserIndex(e.get_clientId()))>=0){var r=this._users[n];if(r.get_color()===e.get_color()&&r.get_userName()===e.get_userName())return;this.removeUser(e.get_clientId())}var o=new C(this.createElement("div"),this._settings);o.add_InteractivityChanged(i.i(this,this.OnInteractivityChanged,"OnInteractivityChanged")),this._flyoutContainer.insertBefore(o.element,this._flyoutContainer.firstChild),this._idToFlyout[e.get_clientId()]=o,Array.add(this._users,e),Array.add(this.get_flyouts(),o),this.CollapseFlyouts(!1),this.set_visible(!0)},t.prototype.removeUser=function(e){3!==this.GetFrontFlyoutState()?(this.HideAllFlyouts(),this.RemoveUserInternal(e),this._users.length<=0?this.hide():this.showIconOnly()):Array.add(this._idsToRemove,e)},t.prototype.setUserEditingState=function(e,t){t?this.AddActiveEditor(e):this.RemoveActiveEditor(e)},t.prototype.setSelectionMode=function(e){e!==this._inSelectionMode&&(this._inSelectionMode=e,this.SetSelectionUiTreatment(e))},t.prototype.isPointInControl=function(e,t){for(var n=0;n<this.get_flyouts().length;n++){var r=this.get_flyouts()[n];if(r.get_visible()){var i=this.AddBufferToBounds(b.g.getElementBounds(r.element),t,!this._isRtl);if(b.g.isPointInBounds(i,e))return!0}}return!1},t.prototype.eventHappenedInsideControl=function(e){var n=t.GetRelatedTargetFromEvent(e);if(this._flyoutContainer!==n&&y.s.isDescendantOf(this._flyoutContainer,n))return!0;for(var r=0,i=this.get_flyouts();r<i.length;r++){var o=i[r];if(y.s.isDescendantOf(o.element,n))return!0}return!1},t.prototype.positionOnDiv=function(e,n){var r,i;r=this._isRtl?0:e-this._size,i=-this.bubbleDimension-t.PaddingAroundControls,this.position(r,i)},t.prototype.position=function(e,t){this.element.style.top=t+"px",this.element.style.left=e+"px"},t.prototype.CollapseFlyouts=function(e){if(!e||this._inCollapseTimeout){this._inSelectionMode&&this.SetSelectionUiTreatment(!0);var n=Math.min(t.MaxUsersToShow,this.get_flyouts().length)-1,r=0,i=1,o=0;this._renderedInNonDefaultOrientation&&(r=this._activeFlyoutOrientation,i=-1,o=-this.bubbleDimension);for(var a=this.get_flyouts().length-1;a>n;a--)this.get_flyouts()[a].ShowCollapsedFlyout(this._users[a],n*-t.HorizontalPaddingBetweenUsers*i+o,0,!0,!1,!0,r);for(a=n;a>=0;a--)this.get_flyouts()[a].ShowCollapsedFlyout(this._users[a],a*-t.HorizontalPaddingBetweenUsers*i+o,0,a>0,Array.contains(this._activeEditorIds,this._users[a].get_clientId()),a!==this._lastPrimaryFlyoutIndex,r);this._lastPrimaryFlyoutIndex=0,this._hitTarget.update(0,this._renderedInNonDefaultOrientation),this.set_zIndex(this.get_defaultZIndex()),this.RemovePendingUsers(0),this._pendingDispose&&this.dispose()}},t.prototype.ExpandFlyouts=function(){var e,n,r;this._inSelectionMode&&this.SetSelectionUiTreatment(!1),this.set_zIndex(this.get_defaultZIndex()+1),this.SetLaunchOffset((0,s.m)((function(){return n}),(function(e){return n=e})),(0,s.m)((function(){return e}),(function(t){return e=t})),(0,s.m)((function(){return r}),(function(e){return r=e})));for(var i=0;i<this.get_flyouts().length;i++)this.get_flyouts()[i].ShowExpandedFlyout(this._users[i],n,e+(this.bubbleDimension+t.VerticalPaddingBetweenUsers)*i,i!==this._lastPrimaryFlyoutIndex,r)},t.prototype.HideAllFlyouts=function(){for(var e=0;e<this.get_flyouts().length;e++)this.get_flyouts()[e].Hide(this._users[e]);this.set_zIndex(this.get_defaultZIndex()),this._showingAllFlyouts=!1,this._pendingDispose&&this.dispose()},t.prototype.CollapseHideFlyouts=function(e){var t=this;e?(this._inCollapseTimeout=!0,u.Task.delay(e).CW((function(e){t._hidesInIdleMode?t.HideWithDelay():t.CollapseFlyouts(!0),t._inCollapseTimeout=!1}))):this._hidesInIdleMode?this.hide():this.CollapseFlyouts(!1)},t.prototype.HideWithDelay=function(){this._inCollapseTimeout&&this.hide()},t.prototype.UpdateFlyout=function(e){e<0||e>=this.get_flyouts().length||(this.get_flyouts()[e].get_visible()&&this._users.length>0?this.get_flyouts()[e].ShowExpandedFlyout(this._users[e],0,0,!1,0):this.get_flyouts()[e].Hide(this._users[e]))},t.prototype.AreAllFlyoutsVisible=function(){if(!this._showingAllFlyouts)return!1;for(var e=0,t=0,n=this.get_flyouts();t<n.length;t++){n[t].get_visible()&&e++}return this._showingAllFlyouts=e>0&&e===this._users.length,this._showingAllFlyouts},t.prototype.OnInteractivityChanged=function(e,n){var r=this,i=this.GetFrontFlyoutState();2===n.type||4===n.type&&3!==i?(this._inCollapseTimeout&&(this._inCollapseTimeout=!1),3!==i&&(this.ExpandFlyouts(),3===n.eventArgs.get_inputSource()&&this.CollapseHideFlyouts(t.CollapseTouchDelayMs))):4===n.type&&3===i?(this._inCollapseTimeout&&(this._inCollapseTimeout=!1),this.CollapseHideFlyouts(0),this._forcedExpandedFlyout=!1):3===n.type&&3===i&&(this._forcedExpandedFlyout||(this.get_flyouts().length>1?(this._inCollapseTimeout=!0,u.Task.delay(t.CollapseDelayMs).CW((function(e){r.CollapseFlyouts(!0),r._inCollapseTimeout=!1}))):this.CollapseHideFlyouts(0))),this.raiseEvent(d.q.InteractivityChangedEventKey,n,null)},t.prototype.OnTouchTarget=function(e){return 3===e.get_inputSource()&&this.OnInteractivityChanged(this,new d.q(4,e)),!1},t.prototype.SetControlDimensions=function(e){this.element.style.width=e+"px",this.element.style.height=this.bubbleDimension+"px"},t.prototype.RemoveUserInternal=function(e){this.RemoveActiveEditor(e);var t=this.FindUserIndex(e);if(!(t<0)){var n=this._users[t];Array.removeAt(this._users,t),delete this._idToFlyout[n.get_clientId()],this.UpdateFlyout(t);var r=this.get_flyouts()[t];this._flyoutContainer.removeChild(r.element),Array.removeAt(this.get_flyouts(),t),r.dispose()}},t.prototype.RemovePendingUsers=function(e){if(this._idsToRemove.length){this.HideAllFlyouts();for(var t=0;t<this._idsToRemove.length;t++)this.RemoveUserInternal(this._idsToRemove[t]);Array.clear(this._idsToRemove),this._users.length<=0||5===e?this.hide():e||this.showIconOnly()}},t.prototype.FindUserIndex=function(e){for(var t=0;t<this._users.length;t++)if(this._users[t].get_clientId()===e)return t;return-1},t.prototype.FindUserByFlyout=function(e){for(var t=0;t<this.get_flyouts().length;t++)if(this.get_flyouts()[t]===e)return this._users[t];return null},t.prototype.AddBufferToBounds=function(e,t,n){var r=e.height+2*t,i=e.width+t,o=e.y-t,a=n?e.x:e.x-t;return new Sys.UI.Bounds(a,o,i,r)},t.prototype.MoveUserToFront=function(e){if(e in this._idToFlyout){var t=this.FindUserIndex(e);if(t){var n=this._users[t],r=this._idToFlyout[e];Array.removeAt(this._users,t),Array.insert(this._users,0,n),Array.removeAt(this.get_flyouts(),t),Array.insert(this.get_flyouts(),0,r),this._flyoutContainer.removeChild(r.element),this._flyoutContainer.appendChild(r.element),this.CollapseFlyouts(!1)}}},t.prototype.AddActiveEditor=function(e){if(-1!==this.FindUserIndex(e)){if(Array.contains(this._activeEditorIds,e)){if(this._users[0].get_clientId()===e)return;Array.remove(this._activeEditorIds,e)}Array.add(this._activeEditorIds,e),this.MoveUserToFront(e),1!==this.GetFrontFlyoutState()&&this.CollapseFlyouts(!1)}else c.ULS.sendTraceTag(41706451,302,15,"Cannot set active editor because client id is invalid")},t.prototype.RemoveActiveEditor=function(e){if(-1!==this.FindUserIndex(e)){if(Array.contains(this._activeEditorIds,e)){if(Array.remove(this._activeEditorIds,e),this._users[0].get_clientId()===e&&this._activeEditorIds.length>0){var t=this._activeEditorIds[this._activeEditorIds.length-1];this.MoveUserToFront(t)}this._users[0].get_clientId()===e&&1===this.GetFrontFlyoutState()&&this.CollapseFlyouts(!1)}}else c.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid")},t.prototype.SetSelectionUiTreatment=function(e){e?Sys.UI.DomElement.addCssClass(this._flyoutContainer,t.FlyoutContainerBackgroundCssClassName):Sys.UI.DomElement.removeCssClass(this._flyoutContainer,t.FlyoutContainerBackgroundCssClassName)},t.prototype.GetFrontFlyoutState=function(){return this.get_flyouts()&&this.get_flyouts().length>0?this.get_flyouts()[0].get_state():5},t.prototype.SetLaunchOffset=function(e,n,r){if(e.val=0,n.val=0,r.val=this._activeFlyoutOrientation,this._viewportBoundsCallback){var i=this._viewportBoundsCallback(this);if(!i)return;var o=this._positioner.getLaunchOffsetForViewport(this.get_flyouts().length,this.bubbleDimension,t.MaxFlyoutWidth,t.VerticalPaddingBetweenUsers,this.element,i);n.val=o.offsetTop,this._lastPrimaryFlyoutIndex=this.GetIndexOfPrimaryFlyout(o.verticalDirection,o.offsetTop),r.val=o.horizontalDirection,r.val!==this._activeFlyoutOrientation&&(this.RerenderForDirection(r.val),this.element.dir=3===r.val?"rtl":"ltr",this._activeFlyoutOrientation=r.val),r.val!==this.GetDefaultFlyoutDirection()?(e.val=-this.bubbleDimension,this._renderedInNonDefaultOrientation=!0):this._renderedInNonDefaultOrientation=!1}},t.prototype.GetIndexOfPrimaryFlyout=function(e,n){if(1===e)return this.get_flyouts().length-1;var r=Math.abs(n);return r>0?r/(this.bubbleDimension+t.VerticalPaddingBetweenUsers):0},t.prototype.RerenderForDirection=function(e){for(var t=0;t<this.get_flyouts().length;t++)this.get_flyouts()[t].rerenderForDirection(e)},t.prototype.GetDefaultFlyoutDirection=function(){return this._isRtl?3:4},t.GenerateId=function(){return String.format("{0}-{1}",t.PresencetooltipIdPrefix,t._instanceCounter++)},t.GetRelatedTargetFromEvent=function(e){return e.innerEvent.rawEvent.relatedTarget},t.PresencetooltipIdPrefix="presencetooltip",t.PresenceTooltipClassName="prControl",t.FlyoutContainerClassName="prFlyoutContainer",t.FlyoutContainerBackgroundCssClassName="prBackgroundSelection",t.PaddingAroundControls=2,t.HorizontalPaddingBetweenUsers=4,t.VerticalPaddingBetweenUsers=2,t.MaxFlyoutWidth=150,t.MaxUsersToShow=3,t.CollapseDelayMs=250,t.CollapseTouchDelayMs=2e3,t.IdleTooltipSize=6,t.TouchTargetSize=32,t._instanceCounter=0,t}(l.l);(0,i.l)(w,"b622cef6$ModernPresenceTooltipControl",l.l,[a.x,Sys.IDisposable])}}]);
//# sourceMappingURL=https://wordwebclientbuilds.blob.core.windows.net/official/16.0.12209.32652/WordEditorDS.box4.dll3.js.map